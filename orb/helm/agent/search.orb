* Search Agent

  An Agent providing history-search functionality.

#!lua
local meta = assert(require "core:cluster" . Meta)
local ResultListAgent = require "helm:agent/result-list"
local SearchAgent = meta(getmetatable(ResultListAgent))
#/lua


*** SearchAgent:update()

Updates the history results based on the current contents of the Txtbuf.

#!lua
function SearchAgent.update(agent, modeS)
   local frag = agent.searchText()
   if agent.last_collection
      and agent.last_collection.lit_frag == frag then
      return
   end
   agent.last_collection = modeS.hist:search(frag)
   agent:contentsChanged()
end
#/lua


*** accept()

#!lua
function SearchAgent.accept(agent)
   local suggestion = agent.last_collection:selectedItem()
   agent.replaceToken(suggestion)
   -- yield(Message{sendto = "maestro.agents.edit", method = "replaceToken", n = 1, suggestion})
end
#/lua


#!lua
local constructor = assert(require "core:cluster" . constructor)
return constructor(SearchAgent)
#/lua
