digraph lpegNode {

node [fontname=Helvetica]
edge [style=dashed]

doc_0 [label="doc - 130"]


doc_0 -> { section_1}
{rank=same; section_1}

section_1 [label="section: 1-112"]


// END RANK doc_0

section_1 -> { header_2 prose_3 prose_4 prose_5 prose_6 prose_7 codeblock_8 section_9 section_10}
{rank=same; header_2 prose_3 prose_4 prose_5 prose_6 prose_7 codeblock_8 section_9 section_10}

header_2 [label="1 : Color"]

prose_3 [label="prose"]

prose_4 [label="prose"]

prose_5 [label="prose"]

prose_6 [label="prose"]

prose_7 [label="prose"]

codeblock_8 [label="code block 20-72"]

section_9 [label="section: 75-112"]

section_10 [label="section: 113-115"]


// END RANK section_1

header_2 -> leaf_11
leaf_11  [color=Gray,shape=rectangle,fontname=Inconsolata,label="* Color"]
// END RANK header_2

prose_3 -> { raw_12}
{rank=same; raw_12}

raw_12 [label="raw"]


// END RANK prose_3

raw_12 -> leaf_13
leaf_13  [color=Gray,shape=rectangle,fontname=Inconsolata,label="


Colorizer and all-purpose pretty printer.
"]
// END RANK raw_12

prose_4 -> { raw_14 prespace_15 literal_16 raw_17}
{rank=same; raw_14 prespace_15 literal_16 raw_17}

raw_14 [label="raw"]

prespace_15 [label="prespace"]

literal_16 [label="literal"]

raw_17 [label="raw"]


// END RANK prose_4

raw_14 -> leaf_18
leaf_18  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
The main event is"]
// END RANK raw_14

prespace_15 -> leaf_19
leaf_19  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_15

literal_16 -> leaf_20
leaf_20  [color=Gray,shape=rectangle,fontname=Inconsolata,label="ts(value)"]
// END RANK literal_16

raw_17 -> leaf_21
leaf_21  [color=Gray,shape=rectangle,fontname=Inconsolata,label=", which unwraps tables, looks up
names for things, and otherwise makes itself useful.
"]
// END RANK raw_17

prose_5 -> { raw_22 prespace_23 literal_24 raw_25 prespace_26 literal_27 raw_28}
{rank=same; raw_22 prespace_23 literal_24 raw_25 prespace_26 literal_27 raw_28}

raw_22 [label="raw"]

prespace_23 [label="prespace"]

literal_24 [label="literal"]

raw_25 [label="raw"]

prespace_26 [label="prespace"]

literal_27 [label="literal"]

raw_28 [label="raw"]


// END RANK prose_5

raw_22 -> leaf_29
leaf_29  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
The"]
// END RANK raw_22

prespace_23 -> leaf_30
leaf_30  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_23

literal_24 -> leaf_31
leaf_31  [color=Gray,shape=rectangle,fontname=Inconsolata,label="color"]
// END RANK literal_24

raw_25 -> leaf_32
leaf_32  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" table can be overridden by the user, but this must
be on the field level.  A local pointer to the table is retained for
efficiency of coding and execution.  Same with the"]
// END RANK raw_25

prespace_26 -> leaf_33
leaf_33  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_26

literal_27 -> leaf_34
leaf_34  [color=Gray,shape=rectangle,fontname=Inconsolata,label="color.hints"]
// END RANK literal_27

raw_28 -> leaf_35
leaf_35  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" table, change
references at the value level.
"]
// END RANK raw_28

prose_6 -> { raw_36 prespace_37 literal_38 raw_39 prespace_40 literal_41 raw_42}
{rank=same; raw_36 prespace_37 literal_38 raw_39 prespace_40 literal_41 raw_42}

raw_36 [label="raw"]

prespace_37 [label="prespace"]

literal_38 [label="literal"]

raw_39 [label="raw"]

prespace_40 [label="prespace"]

literal_41 [label="literal"]

raw_42 [label="raw"]


// END RANK prose_6

raw_36 -> leaf_43
leaf_43  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
The third relevant field is a method,"]
// END RANK raw_36

prespace_37 -> leaf_44
leaf_44  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_37

literal_38 -> leaf_45
leaf_45  [color=Gray,shape=rectangle,fontname=Inconsolata,label="C.allNames()"]
// END RANK literal_38

raw_39 -> leaf_46
leaf_46  [color=Gray,shape=rectangle,fontname=Inconsolata,label=".  There is an"]
// END RANK raw_39

prespace_40 -> leaf_47
leaf_47  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_40

literal_41 -> leaf_48
leaf_48  [color=Gray,shape=rectangle,fontname=Inconsolata,label="anti_G"]
// END RANK literal_41

raw_42 -> leaf_49
leaf_49  [color=Gray,shape=rectangle,fontname=Inconsolata,label="
object, this method populates it with every reachable name for an object,
keyed with the value itself.
"]
// END RANK raw_42

prose_7 -> { prespace_50 literal_51 raw_52 prespace_53 literal_54 raw_55}
{rank=same; prespace_50 literal_51 raw_52 prespace_53 literal_54 raw_55}

prespace_50 [label="prespace"]

literal_51 [label="literal"]

raw_52 [label="raw"]

prespace_53 [label="prespace"]

literal_54 [label="literal"]

raw_55 [label="raw"]


// END RANK prose_7

prespace_50 -> leaf_56
leaf_56  [color=Gray,shape=rectangle,fontname=Inconsolata,label=""]
// END RANK prespace_50

literal_51 -> leaf_57
leaf_57  [color=Gray,shape=rectangle,fontname=Inconsolata,label="C.clearNames()"]
// END RANK literal_51

raw_52 -> leaf_58
leaf_58  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" sets this table to"]
// END RANK raw_52

prespace_53 -> leaf_59
leaf_59  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_53

literal_54 -> leaf_60
leaf_60  [color=Gray,shape=rectangle,fontname=Inconsolata,label="{}"]
// END RANK literal_54

raw_55 -> leaf_61
leaf_61  [color=Gray,shape=rectangle,fontname=Inconsolata,label=".
"]
// END RANK raw_55

codeblock_8 -> leaf_62
leaf_62  [color=Gray,shape=rectangle,fontname=Inconsolata,label="local a = require \"anterm\"

local core = require \"core\"

local WIDE_TABLE = 200 -- should be tty-specific

local C = {}

local thread_shade = a.fg24(240, 50, 100)

local function thread_color(str)
   return a.italic .. thread_shade .. str .. a.clear
end

C.color = {}
C.color.number = a.fg(42)
C.color.string = a.fg(222)
C.color.stresc = a.fg(225)
C.color.table  = a.fg(64)
C.color.func   = a.fg24(210,12,120)
C.color.truth  = a.fg(231)
C.color.falsehood  = a.fg(94)
C.color.nilness    = a.fg(93)
C.color.thread     = thread_color
C.color.coro       = thread_color
C.color.field      = a.fg(111)
C.color.userdata   = a.fg24(230, 145, 23)
C.color.cdata      = a.fg24(200, 115, 0)
C.color.metatable  = a.fg24(242, 0, 234)
C.color.meta       = C.color.metatable

C.color[\"function\"] = C.color.func
C.color[\"true\"]     = C.color.truth
C.color[\"false\"]    = C.color.falsehood
C.color[\"nil\"]      = C.color.nilness

C.color.operator = a.fg24(220, 40, 150)
C.color.keyword = a.fg24(100, 210, 100)
C.color.comment = a.fg24(128,128,128)


C.color.alert      = a.fg24(250, 0, 40)
C.color.base       = a.fg24(200, 200, 200)
C.color.search_hl = a.fg24(30, 230, 100)
C.color.error = a.bg24(50,0,0)
C.color.bold = a.bold

C.color.highlight = a.bg24(70, 70, 70)


C.depth = 4 -- table print depth"]
// END RANK codeblock_8

section_9 -> { header_63 prose_64 codeblock_65 structure_66 codeblock_67}
{rank=same; header_63 prose_64 codeblock_65 structure_66 codeblock_67}

header_63 [label="2 : no_color"]

prose_64 [label="prose"]

codeblock_65 [label="code block 80-100"]

structure_66 [label="structure"]

codeblock_67 [label="code block 107-111"]


// END RANK section_9

header_63 -> leaf_68
leaf_68  [color=Gray,shape=rectangle,fontname=Inconsolata,label="** no_color"]
// END RANK header_63

prose_64 -> { raw_69}
{rank=same; raw_69}

raw_69 [label="raw"]


// END RANK prose_64

raw_69 -> leaf_70
leaf_70  [color=Gray,shape=rectangle,fontname=Inconsolata,label="

As a generally-useful measure, we need an object that behaves like a
colorizer but which doesn't actually apply color.
"]
// END RANK raw_69

codeblock_65 -> leaf_71
leaf_71  [color=Gray,shape=rectangle,fontname=Inconsolata,label="local no_color = {}
-- if field accessed, pass through
local function _no_c_index(nc, _)
   return nc
end

local function _no_c_call(_, str)
   return str or \"\"
end

local function _no_c_concat(head, tail)
   head = type(head) == \"string\" and head or \"\"
   tail = type(tail) == \"string\" and tail or \"\"
   return head .. tail
end

C.no_color = setmetatable({}, { __index  = _no_c_index,
                                __call   = _no_c_call,
                                __concat = _no_c_concat, })"]
// END RANK codeblock_65

structure_66 -> { hashline_72}
{rank=same; hashline_72}

hashline_72 [label="hashline"]


// END RANK structure_66

hashline_72 -> { hashtag_73}
{rank=same; hashtag_73}

hashtag_73 [label="hashtag"]


// END RANK hashline_72

hashtag_73 -> leaf_74
leaf_74  [color=Gray,shape=rectangle,fontname=Inconsolata,label="todo"]
// END RANK hashtag_73

codeblock_67 -> leaf_75
leaf_75  [color=Gray,shape=rectangle,fontname=Inconsolata,label="function C.color.err()
  error \"error in color\"
end"]
// END RANK codeblock_67

section_10 -> { header_76 prose_77 section_78}
{rank=same; header_76 prose_77 section_78}

header_76 [label="2 : ts(value)"]

prose_77 [label="prose"]

section_78 [label="section: 116-130"]


// END RANK section_10

header_76 -> leaf_79
leaf_79  [color=Gray,shape=rectangle,fontname=Inconsolata,label="** ts(value)"]
// END RANK header_76

prose_77 -> { raw_80}
{rank=same; raw_80}

raw_80 [label="raw"]


// END RANK prose_77

raw_80 -> leaf_81
leaf_81  [color=Gray,shape=rectangle,fontname=Inconsolata,label="

"]
// END RANK raw_80

section_78 -> { header_82 prose_83 codeblock_84 codeblock_85}
{rank=same; header_82 prose_83 codeblock_84 codeblock_85}

header_82 [label="4 : setup"]

prose_83 [label="prose"]

codeblock_84 [label="code block 120-126"]

codeblock_85 [label="code block 128-130"]


// END RANK section_78

header_82 -> leaf_86
leaf_86  [color=Gray,shape=rectangle,fontname=Inconsolata,label="**** setup"]
// END RANK header_82

prose_83 -> { raw_87 prespace_88 literal_89 raw_90}
{rank=same; raw_87 prespace_88 literal_89 raw_90}

raw_87 [label="raw"]

prespace_88 [label="prespace"]

literal_89 [label="literal"]

raw_90 [label="raw"]


// END RANK prose_83

raw_87 -> leaf_91
leaf_91  [color=Gray,shape=rectangle,fontname=Inconsolata,label="

Localize a few values and create an anti-"]
// END RANK raw_87

prespace_88 -> leaf_92
leaf_92  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" "]
// END RANK prespace_88

literal_89 -> leaf_93
leaf_93  [color=Gray,shape=rectangle,fontname=Inconsolata,label="_G"]
// END RANK literal_89

raw_90 -> leaf_94
leaf_94  [color=Gray,shape=rectangle,fontname=Inconsolata,label=" table.
"]
// END RANK raw_90

codeblock_84 -> leaf_95
leaf_95  [color=Gray,shape=rectangle,fontname=Inconsolata,label="C.color.hints = { field = C.color.field,
                  fn    = C.color.func,
                  mt    = C.color.mt }

local hints = C.color.hints"]
// END RANK codeblock_84

codeblock_85 -> leaf_96
leaf_96  [color=Gray,shape=rectangle,fontname=Inconsolata,label="return C"]
// END RANK codeblock_85


}
