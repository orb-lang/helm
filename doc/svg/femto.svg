<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="4535pt" height="2562pt"
 viewBox="0.00 0.00 4534.50 2562.43" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2558.432)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2558.432 4530.5,-2558.432 4530.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="593.5" cy="-2536.432" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="593.5" y="-2532.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 303</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="593.5" cy="-2464.432" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="593.5" y="-2460.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;159</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M593.5,-2518.2633C593.5,-2510.5629 593.5,-2501.4063 593.5,-2492.8486"/>
<polygon fill="#000000" stroke="#000000" points="597.0001,-2492.8452 593.5,-2482.8452 590.0001,-2492.8453 597.0001,-2492.8452"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="413.5" cy="-2392.432" rx="47.4168" ry="18"/>
<text text-anchor="middle" x="413.5" y="-2388.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Femto</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M556.2039,-2449.5135C526.9345,-2437.8058 486.1825,-2421.505 455.7178,-2409.3191"/>
<polygon fill="#000000" stroke="#000000" points="456.8003,-2405.9825 446.2157,-2405.5182 454.2006,-2412.4819 456.8003,-2405.9825"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="511.5" cy="-2392.432" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="511.5" y="-2388.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M573.6501,-2447.0028C562.5588,-2437.2641 548.6239,-2425.0285 536.7613,-2414.6126"/>
<polygon fill="#000000" stroke="#000000" points="538.764,-2411.7134 528.9403,-2407.7454 534.1454,-2416.9735 538.764,-2411.7134"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="593.5" cy="-2392.432" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="593.5" y="-2388.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M593.5,-2446.2633C593.5,-2438.5629 593.5,-2429.4063 593.5,-2420.8486"/>
<polygon fill="#000000" stroke="#000000" points="597.0001,-2420.8452 593.5,-2410.8452 590.0001,-2420.8453 597.0001,-2420.8452"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="818.5" cy="-2392.432" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="818.5" y="-2388.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 9&#45;35</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M636.3504,-2450.7198C673.6112,-2438.7964 727.6778,-2421.4951 767.2268,-2408.8394"/>
<polygon fill="#000000" stroke="#000000" points="768.4923,-2412.1093 776.9498,-2405.728 766.3589,-2405.4424 768.4923,-2412.1093"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="2187.5" cy="-2392.432" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2187.5" y="-2388.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 160&#45;167</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M658.4588,-2461.4978C910.0368,-2450.1342 1820.2688,-2409.0196 2103.071,-2396.2456"/>
<polygon fill="#000000" stroke="#000000" points="2103.4338,-2399.7328 2113.2657,-2395.7851 2103.1179,-2392.74 2103.4338,-2399.7328"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="449.5,-2338.432 377.5,-2338.432 377.5,-2302.432 449.5,-2302.432 449.5,-2338.432"/>
<text text-anchor="middle" x="413.5" y="-2316.932" font-family="Inconsolata" font-size="14.00" fill="#000000">* &#160;Femto</text>
</g>
<!-- header_2&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>header_2&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M413.5,-2374.2633C413.5,-2366.5629 413.5,-2357.4063 413.5,-2348.8486"/>
<polygon fill="#000000" stroke="#000000" points="417.0001,-2348.8452 413.5,-2338.8452 410.0001,-2348.8453 417.0001,-2348.8452"/>
</g>
<!-- raw_8 -->
<g id="node9" class="node">
<title>raw_8</title>
<ellipse fill="none" stroke="#000000" cx="502.5" cy="-2320.432" rx="27" ry="18"/>
<text text-anchor="middle" x="502.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;raw_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M509.2289,-2374.2633C508.2664,-2366.5629 507.1218,-2357.4063 506.0521,-2348.8486"/>
<polygon fill="#000000" stroke="#000000" points="509.5151,-2348.3339 504.8017,-2338.8452 502.5691,-2349.2022 509.5151,-2348.3339"/>
</g>
<!-- raw_10 -->
<g id="node11" class="node">
<title>raw_10</title>
<ellipse fill="none" stroke="#000000" cx="583.5" cy="-2320.432" rx="27" ry="18"/>
<text text-anchor="middle" x="583.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_10 -->
<g id="edge10" class="edge">
<title>prose_4&#45;&gt;raw_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M590.9766,-2374.2633C589.9071,-2366.5629 588.6353,-2357.4063 587.4468,-2348.8486"/>
<polygon fill="#000000" stroke="#000000" points="590.8999,-2348.2686 586.0574,-2338.8452 583.9664,-2349.2317 590.8999,-2348.2686"/>
</g>
<!-- header_12 -->
<g id="node13" class="node">
<title>header_12</title>
<ellipse fill="none" stroke="#000000" cx="713.5" cy="-2320.432" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="713.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : includes</text>
</g>
<!-- section_5&#45;&gt;header_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;header_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M794.147,-2375.7327C779.7322,-2365.8483 761.2981,-2353.2078 745.6936,-2342.5075"/>
<polygon fill="#000000" stroke="#000000" points="747.5856,-2339.5612 737.3589,-2336.7924 743.6269,-2345.3343 747.5856,-2339.5612"/>
</g>
<!-- prose_13 -->
<g id="node14" class="node">
<title>prose_13</title>
<ellipse fill="none" stroke="#000000" cx="818.5" cy="-2320.432" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="818.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_13 -->
<g id="edge13" class="edge">
<title>section_5&#45;&gt;prose_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M818.5,-2374.2633C818.5,-2366.5629 818.5,-2357.4063 818.5,-2348.8486"/>
<polygon fill="#000000" stroke="#000000" points="822.0001,-2348.8452 818.5,-2338.8452 815.0001,-2348.8453 822.0001,-2348.8452"/>
</g>
<!-- codeblock_14 -->
<g id="node15" class="node">
<title>codeblock_14</title>
<ellipse fill="none" stroke="#000000" cx="958.5" cy="-2320.432" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="958.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;33</text>
</g>
<!-- section_5&#45;&gt;codeblock_14 -->
<g id="edge14" class="edge">
<title>section_5&#45;&gt;codeblock_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M848.8779,-2376.809C868.8623,-2366.5313 895.2711,-2352.9497 917.1604,-2341.6924"/>
<polygon fill="#000000" stroke="#000000" points="918.9407,-2344.7125 926.2329,-2337.0265 915.7392,-2338.4875 918.9407,-2344.7125"/>
</g>
<!-- section_15 -->
<g id="node16" class="node">
<title>section_15</title>
<ellipse fill="none" stroke="#000000" cx="1187.5" cy="-2320.432" rx="70.655" ry="18"/>
<text text-anchor="middle" x="1187.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;159</text>
</g>
<!-- section_5&#45;&gt;section_15 -->
<g id="edge15" class="edge">
<title>section_5&#45;&gt;section_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M869.4205,-2382.4963C935.0376,-2369.6929 1049.2402,-2347.4095 1121.4681,-2333.3162"/>
<polygon fill="#000000" stroke="#000000" points="1122.2272,-2336.7342 1131.3718,-2331.3838 1120.8866,-2329.8638 1122.2272,-2336.7342"/>
</g>
<!-- header_27 -->
<g id="node28" class="node">
<title>header_27</title>
<ellipse fill="none" stroke="#000000" cx="2056.5" cy="-2320.432" rx="80.7697" ry="18"/>
<text text-anchor="middle" x="2056.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : onkey(err, key)</text>
</g>
<!-- section_6&#45;&gt;header_27 -->
<g id="edge27" class="edge">
<title>section_6&#45;&gt;header_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2157.446,-2375.9137C2139.1043,-2365.8328 2115.456,-2352.8353 2095.6596,-2341.9548"/>
<polygon fill="#000000" stroke="#000000" points="2097.3173,-2338.8721 2086.8678,-2337.1227 2093.9456,-2345.0066 2097.3173,-2338.8721"/>
</g>
<!-- prose_28 -->
<g id="node29" class="node">
<title>prose_28</title>
<ellipse fill="none" stroke="#000000" cx="2187.5" cy="-2320.432" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2187.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_28 -->
<g id="edge28" class="edge">
<title>section_6&#45;&gt;prose_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2187.5,-2374.2633C2187.5,-2366.5629 2187.5,-2357.4063 2187.5,-2348.8486"/>
<polygon fill="#000000" stroke="#000000" points="2191.0001,-2348.8452 2187.5,-2338.8452 2184.0001,-2348.8453 2191.0001,-2348.8452"/>
</g>
<!-- prose_29 -->
<g id="node30" class="node">
<title>prose_29</title>
<ellipse fill="none" stroke="#000000" cx="2323.5" cy="-2320.432" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2323.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_29 -->
<g id="edge29" class="edge">
<title>section_6&#45;&gt;prose_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2218.7011,-2375.9137C2240.3847,-2364.4342 2269.2121,-2349.1726 2291.1436,-2337.5618"/>
<polygon fill="#000000" stroke="#000000" points="2292.8794,-2340.6032 2300.0797,-2332.831 2289.6041,-2334.4166 2292.8794,-2340.6032"/>
</g>
<!-- section_30 -->
<g id="node31" class="node">
<title>section_30</title>
<ellipse fill="none" stroke="#000000" cx="3218.5" cy="-2320.432" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3218.5" y="-2316.232" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 168&#45;303</text>
</g>
<!-- section_6&#45;&gt;section_30 -->
<g id="edge30" class="edge">
<title>section_6&#45;&gt;section_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2259.9979,-2387.3691C2445.9506,-2374.383 2939.0185,-2339.9496 3135.7485,-2326.2109"/>
<polygon fill="#000000" stroke="#000000" points="3136.0064,-2329.7015 3145.7382,-2325.5133 3135.5187,-2322.7185 3136.0064,-2329.7015"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="443,-2157.333 0,-2157.333 0,-2085.5307 443,-2085.5307 443,-2157.333"/>
<text text-anchor="middle" x="221.5" y="-2093.9318" font-family="Inconsolata" font-size="14.00" fill="#000000">I just got orb stood up in the pylon bootloader distribution.</text>
</g>
<!-- raw_8&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>raw_8&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M483.6265,-2307.066C442.7026,-2278.0843 344.3484,-2208.4313 280.4376,-2163.1706"/>
<polygon fill="#000000" stroke="#000000" points="282.2295,-2160.1508 272.0458,-2157.2276 278.1839,-2165.8634 282.2295,-2160.1508"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="645.5,-2149.3333 461.5,-2149.3333 461.5,-2093.5303 645.5,-2093.5303 645.5,-2149.3333"/>
<text text-anchor="middle" x="553.5" y="-2117.9318" font-family="Inconsolata" font-size="14.00" fill="#000000">I am excited about this.</text>
</g>
<!-- raw_10&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>raw_10&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M580.7848,-2302.4211C575.9346,-2270.248 565.6857,-2202.264 559.222,-2159.3875"/>
<polygon fill="#000000" stroke="#000000" points="562.6571,-2158.6944 557.7054,-2149.3279 555.7353,-2159.7379 562.6571,-2158.6944"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="763.5,-2139.4318 663.5,-2139.4318 663.5,-2103.4318 763.5,-2103.4318 763.5,-2139.4318"/>
<text text-anchor="middle" x="713.5" y="-2117.9318" font-family="Inconsolata" font-size="14.00" fill="#000000">** &#160;includes</text>
</g>
<!-- header_12&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>header_12&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M713.5,-2302.4211C713.5,-2267.7295 713.5,-2191.4007 713.5,-2149.8089"/>
<polygon fill="#000000" stroke="#000000" points="717.0001,-2149.5454 713.5,-2139.5454 710.0001,-2149.5454 717.0001,-2149.5454"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="808.5" cy="-2121.4318" rx="27" ry="18"/>
<text text-anchor="middle" x="808.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_13&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_13&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M817.5949,-2302.4211C815.8479,-2267.6556 811.9997,-2191.0757 809.9127,-2149.5439"/>
<polygon fill="#000000" stroke="#000000" points="813.4078,-2149.3571 809.4102,-2139.5454 806.4166,-2149.7085 813.4078,-2149.3571"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1087,-2266.4321 854,-2266.4321 854,-1976.4315 1087,-1976.4315 1087,-2266.4321"/>
<text text-anchor="middle" x="970.5" y="-2251.232" font-family="Inconsolata" font-size="14.00" fill="#000000">sql = require &quot;sqlite&quot;</text>
<text text-anchor="middle" x="970.5" y="-2219.8319" font-family="Inconsolata" font-size="14.00" fill="#000000">lfs = require &quot;lfs&quot;</text>
<text text-anchor="middle" x="970.5" y="-2204.4319" font-family="Inconsolata" font-size="14.00" fill="#000000">ffi = require &quot;ffi&quot;</text>
<text text-anchor="middle" x="970.5" y="-2173.0319" font-family="Inconsolata" font-size="14.00" fill="#000000">ffi.reflect = require &quot;reflect&quot;</text>
<text text-anchor="middle" x="970.5" y="-2141.6318" font-family="Inconsolata" font-size="14.00" fill="#000000">uv = require &quot;luv&quot;</text>
<text text-anchor="middle" x="970.5" y="-2110.2318" font-family="Inconsolata" font-size="14.00" fill="#000000">L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="970.5" y="-2078.8318" font-family="Inconsolata" font-size="14.00" fill="#000000">a = require &quot;anterm&quot;</text>
<text text-anchor="middle" x="970.5" y="-2047.4317" font-family="Inconsolata" font-size="14.00" fill="#000000">c = require &quot;color&quot;</text>
<text text-anchor="middle" x="970.5" y="-2016.0317" font-family="Inconsolata" font-size="14.00" fill="#000000">core = require &quot;core&quot;</text>
<text text-anchor="middle" x="970.5" y="-1984.6317" font-family="Inconsolata" font-size="14.00" fill="#000000">watch = require &quot;watcher&quot;</text>
</g>
<!-- codeblock_14&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_14&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M959.5861,-2302.4211C960.0101,-2295.3889 960.5373,-2286.646 961.1294,-2276.8283"/>
<polygon fill="#000000" stroke="#000000" points="964.6332,-2276.8685 961.7416,-2266.676 957.6459,-2276.4471 964.6332,-2276.8685"/>
</g>
<!-- header_20 -->
<g id="node21" class="node">
<title>header_20</title>
<ellipse fill="none" stroke="#000000" cx="1143.5" cy="-2121.4318" rx="38.2457" ry="18"/>
<text text-anchor="middle" x="1143.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : utils</text>
</g>
<!-- section_15&#45;&gt;header_20 -->
<g id="edge20" class="edge">
<title>section_15&#45;&gt;header_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1183.5177,-2302.4211C1175.8309,-2267.6556 1158.8986,-2191.0757 1149.7157,-2149.5439"/>
<polygon fill="#000000" stroke="#000000" points="1153.0815,-2148.5539 1147.505,-2139.5454 1146.2465,-2150.0652 1153.0815,-2148.5539"/>
</g>
<!-- prose_21 -->
<g id="node22" class="node">
<title>prose_21</title>
<ellipse fill="none" stroke="#000000" cx="1231.5" cy="-2121.4318" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1231.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_15&#45;&gt;prose_21 -->
<g id="edge21" class="edge">
<title>section_15&#45;&gt;prose_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1191.4823,-2302.4211C1199.1691,-2267.6556 1216.1014,-2191.0757 1225.2843,-2149.5439"/>
<polygon fill="#000000" stroke="#000000" points="1228.7535,-2150.0652 1227.495,-2139.5454 1221.9185,-2148.5539 1228.7535,-2150.0652"/>
</g>
<!-- codeblock_22 -->
<g id="node23" class="node">
<title>codeblock_22</title>
<ellipse fill="none" stroke="#000000" cx="1468.5" cy="-2121.4318" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="1468.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;157</text>
</g>
<!-- section_15&#45;&gt;codeblock_22 -->
<g id="edge22" class="edge">
<title>section_15&#45;&gt;codeblock_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1214.9995,-2303.6503C1231.8011,-2293.2278 1253.6163,-2279.3913 1272.5,-2266.432 1332.1999,-2225.4616 1399.631,-2174.5013 1437.8046,-2145.1955"/>
<polygon fill="#000000" stroke="#000000" points="1440.1555,-2147.8028 1445.9478,-2138.9315 1435.8875,-2142.2544 1440.1555,-2147.8028"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1082.5,-1051.2162 534.5,-1051.2162 534.5,-980.6155 1082.5,-980.6155 1082.5,-1051.2162"/>
<text text-anchor="middle" x="808.5" y="-1004.1159" font-family="Inconsolata" font-size="14.00" fill="#000000">This all goes into global space for now. &#160;Our more sophisticated loader will</text>
<text text-anchor="middle" x="808.5" y="-988.7158" font-family="Inconsolata" font-size="14.00" fill="#000000">handle namespace isolation. Meanwhile we&#39;re building a repl, so.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M808.5,-2103.1659C808.5,-1978.4888 808.5,-1252.0887 808.5,-1061.6262"/>
<polygon fill="#000000" stroke="#000000" points="812.0001,-1061.4062 808.5,-1051.4062 805.0001,-1061.4063 812.0001,-1061.4062"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1186.5,-1033.9158 1100.5,-1033.9158 1100.5,-997.9158 1186.5,-997.9158 1186.5,-1033.9158"/>
<text text-anchor="middle" x="1143.5" y="-1012.4159" font-family="Inconsolata" font-size="14.00" fill="#000000">**** utils</text>
</g>
<!-- header_20&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>header_20&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1143.5,-2103.1659C1143.5,-1974.3113 1143.5,-1202.7349 1143.5,-1044.3289"/>
<polygon fill="#000000" stroke="#000000" points="1147.0001,-1044.0005 1143.5,-1034.0006 1140.0001,-1044.0006 1147.0001,-1044.0005"/>
</g>
<!-- raw_24 -->
<g id="node25" class="node">
<title>raw_24</title>
<ellipse fill="none" stroke="#000000" cx="1231.5" cy="-1015.9158" rx="27" ry="18"/>
<text text-anchor="middle" x="1231.5" y="-1011.7158" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_21&#45;&gt;raw_24 -->
<g id="edge24" class="edge">
<title>prose_21&#45;&gt;raw_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1231.5,-2103.1659C1231.5,-1974.3113 1231.5,-1202.7349 1231.5,-1044.3289"/>
<polygon fill="#000000" stroke="#000000" points="1235.0001,-1044.0005 1231.5,-1034.0006 1228.0001,-1044.0006 1235.0001,-1044.0005"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="1866.5,-1940.4475 1276.5,-1940.4475 1276.5,-91.3842 1866.5,-91.3842 1866.5,-1940.4475"/>
<text text-anchor="middle" x="1571.5" y="-1909.2317" font-family="Inconsolata" font-size="14.00" fill="#000000">local usecolors</text>
<text text-anchor="middle" x="1571.5" y="-1893.8316" font-family="Inconsolata" font-size="14.00" fill="#000000">stdout = &quot;&quot;</text>
<text text-anchor="middle" x="1571.5" y="-1862.4316" font-family="Inconsolata" font-size="14.00" fill="#000000">if uv.guess_handle(1) == &quot;tty&quot; then</text>
<text text-anchor="middle" x="1571.5" y="-1847.0316" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;stdout = uv.new_tty(1, false)</text>
<text text-anchor="middle" x="1571.5" y="-1831.6315" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;usecolors = true</text>
<text text-anchor="middle" x="1571.5" y="-1816.2315" font-family="Inconsolata" font-size="14.00" fill="#000000">else</text>
<text text-anchor="middle" x="1571.5" y="-1800.8315" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;stdout = uv.new_pipe(false)</text>
<text text-anchor="middle" x="1571.5" y="-1785.4314" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;uv.pipe_open(utils.stdout, 1)</text>
<text text-anchor="middle" x="1571.5" y="-1770.0314" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;usecolors = false</text>
<text text-anchor="middle" x="1571.5" y="-1754.6314" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-1723.2313" font-family="Inconsolata" font-size="14.00" fill="#000000">if not usecolors then</text>
<text text-anchor="middle" x="1571.5" y="-1707.8313" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;c.ts = tostring</text>
<text text-anchor="middle" x="1571.5" y="-1692.4313" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; #todo make this properly black and white ts</text>
<text text-anchor="middle" x="1571.5" y="-1677.0312" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-1645.6312" font-family="Inconsolata" font-size="14.00" fill="#000000">function print(...)</text>
<text text-anchor="middle" x="1571.5" y="-1630.2312" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local n = select(&#39;#&#39;, ...)</text>
<text text-anchor="middle" x="1571.5" y="-1614.8312" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local arguments = {...}</text>
<text text-anchor="middle" x="1571.5" y="-1599.4311" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for i = 1, n do</text>
<text text-anchor="middle" x="1571.5" y="-1584.0311" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;arguments[i] = tostring(arguments[i])</text>
<text text-anchor="middle" x="1571.5" y="-1568.6311" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1571.5" y="-1553.231" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;uv.write(stdout, table.concat(arguments, &quot;\t&quot;) .. &quot;\n&quot;)</text>
<text text-anchor="middle" x="1571.5" y="-1537.831" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-1506.431" font-family="Inconsolata" font-size="14.00" fill="#000000">function write(str)</text>
<text text-anchor="middle" x="1571.5" y="-1491.0309" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;uv.write(stdout, str)</text>
<text text-anchor="middle" x="1571.5" y="-1475.6309" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-1428.2309" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; &#160;*** tty setup</text>
<text text-anchor="middle" x="1571.5" y="-1396.8308" font-family="Inconsolata" font-size="14.00" fill="#000000">if uv.guess_handle(0) ~= &quot;tty&quot; or</text>
<text text-anchor="middle" x="1571.5" y="-1381.4308" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;uv.guess_handle(1) ~= &quot;tty&quot; then</text>
<text text-anchor="middle" x="1571.5" y="-1366.0308" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; Entry point for other consumers!</text>
<text text-anchor="middle" x="1571.5" y="-1350.6307" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;error &quot;stdio must be a tty&quot;</text>
<text text-anchor="middle" x="1571.5" y="-1335.2307" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-1303.8307" font-family="Inconsolata" font-size="14.00" fill="#000000">local stdin = uv.new_tty(0, true)</text>
<text text-anchor="middle" x="1571.5" y="-1256.4307" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;[[</text>
<text text-anchor="middle" x="1571.5" y="-1225.0306" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;ll keep this around for a bit, it looks nice</text>
<text text-anchor="middle" x="1571.5" y="-1177.6306" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;]]</text>
<text text-anchor="middle" x="1571.5" y="-1146.2306" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; &#160;*** utilities</text>
<text text-anchor="middle" x="1571.5" y="-1114.8305" font-family="Inconsolata" font-size="14.00" fill="#000000">local function gatherResults(success, ...)</text>
<text text-anchor="middle" x="1571.5" y="-1099.4305" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local n = select(&#39;#&#39;, ...)</text>
<text text-anchor="middle" x="1571.5" y="-1084.0305" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return success, { n = n, ... }</text>
<text text-anchor="middle" x="1571.5" y="-1068.6304" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-1037.2304" font-family="Inconsolata" font-size="14.00" fill="#000000">local function printResults(results)</text>
<text text-anchor="middle" x="1571.5" y="-1021.8304" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for i = 1, results.n do</text>
<text text-anchor="middle" x="1571.5" y="-1006.4303" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;results[i] = c.ts(results[i])</text>
<text text-anchor="middle" x="1571.5" y="-991.0303" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1571.5" y="-975.6303" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;print(table.concat(results, &#39;\t&#39;))</text>
<text text-anchor="middle" x="1571.5" y="-960.2303" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-928.8302" font-family="Inconsolata" font-size="14.00" fill="#000000">local buffer = &#39;&#39;</text>
<text text-anchor="middle" x="1571.5" y="-897.4302" font-family="Inconsolata" font-size="14.00" fill="#000000">local function evaluateLine(line)</text>
<text text-anchor="middle" x="1571.5" y="-882.0302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if string.byte(line) == 17 then &#45;&#45; ^Q</text>
<text text-anchor="middle" x="1571.5" y="-866.6301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;uv.stop()</text>
<text text-anchor="middle" x="1571.5" y="-851.2301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 0</text>
<text text-anchor="middle" x="1571.5" y="-835.8301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1571.5" y="-820.43" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local chunk &#160;= buffer .. line</text>
<text text-anchor="middle" x="1571.5" y="-805.03" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local f, err = loadstring(&#39;return &#39; .. chunk, &#39;REPL&#39;) &#45;&#45; first we prefix return</text>
<text text-anchor="middle" x="1571.5" y="-773.63" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not f then</text>
<text text-anchor="middle" x="1571.5" y="-758.2299" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;f, err = loadstring(chunk, &#39;REPL&#39;) &#45;&#45; try again without return</text>
<text text-anchor="middle" x="1571.5" y="-742.8299" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1571.5" y="-711.4299" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if f then</text>
<text text-anchor="middle" x="1571.5" y="-696.0298" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;buffer = &#39;&#39;</text>
<text text-anchor="middle" x="1571.5" y="-680.6298" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, results = gatherResults(xpcall(f, debug.traceback))</text>
<text text-anchor="middle" x="1571.5" y="-649.2298" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success then</text>
<text text-anchor="middle" x="1571.5" y="-633.8298" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; successful call</text>
<text text-anchor="middle" x="1571.5" y="-618.4297" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if results.n &gt; 0 then</text>
<text text-anchor="middle" x="1571.5" y="-603.0297" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;printResults(results)</text>
<text text-anchor="middle" x="1571.5" y="-587.6297" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1571.5" y="-572.2296" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="1571.5" y="-556.8296" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; error</text>
<text text-anchor="middle" x="1571.5" y="-541.4296" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print(results[1])</text>
<text text-anchor="middle" x="1571.5" y="-526.0295" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1571.5" y="-510.6295" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1571.5" y="-495.2295" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if err:match &quot;&#39;&lt;eof&gt;&#39;$&quot; then</text>
<text text-anchor="middle" x="1571.5" y="-479.8294" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Lua expects some more input; stow it away for next time</text>
<text text-anchor="middle" x="1571.5" y="-464.4294" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;buffer = chunk .. &#39;\n&#39;</text>
<text text-anchor="middle" x="1571.5" y="-449.0294" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &#39;...&#39;</text>
<text text-anchor="middle" x="1571.5" y="-433.6293" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="1571.5" y="-418.2293" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print(err)</text>
<text text-anchor="middle" x="1571.5" y="-402.8293" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;buffer = &#39;&#39;</text>
<text text-anchor="middle" x="1571.5" y="-387.4293" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1571.5" y="-372.0292" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1571.5" y="-340.6292" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#39;👉 &#160;&#39;</text>
<text text-anchor="middle" x="1571.5" y="-316.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function displayPrompt(prompt)</text>
<text text-anchor="middle" x="1571.5" y="-269.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;uv.write(stdout, prompt)</text>
<text text-anchor="middle" x="1571.5" y="-254.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1571.5" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function onread(err, line)</text>
<text text-anchor="middle" x="1571.5" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if err then error(err) end</text>
<text text-anchor="middle" x="1571.5" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if line then</text>
<text text-anchor="middle" x="1571.5" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local prompt = evaluateLine(line)</text>
<text text-anchor="middle" x="1571.5" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;displayPrompt(prompt)</text>
<text text-anchor="middle" x="1571.5" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="1571.5" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;uv.close(stdin)</text>
<text text-anchor="middle" x="1571.5" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1571.5" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_22&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_22&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1470.2018,-2103.1659C1472.6968,-2076.3867 1477.7782,-2021.8475 1484.3956,-1950.8216"/>
<polygon fill="#000000" stroke="#000000" points="1487.8966,-1950.9729 1485.3394,-1940.6913 1480.9268,-1950.3234 1487.8966,-1950.9729"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="1258.5,-45.7 1204.5,-45.7 1204.5,-9.7 1258.5,-9.7 1258.5,-45.7"/>
</g>
<!-- raw_24&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>raw_24&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1231.5,-997.491C1231.5,-877.1117 1231.5,-203.0722 1231.5,-56.03"/>
<polygon fill="#000000" stroke="#000000" points="1235.0001,-55.9978 1231.5,-45.9979 1228.0001,-55.9979 1235.0001,-55.9978"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2127.5,-2139.4318 1985.5,-2139.4318 1985.5,-2103.4318 2127.5,-2103.4318 2127.5,-2139.4318"/>
<text text-anchor="middle" x="2056.5" y="-2117.9318" font-family="Inconsolata" font-size="14.00" fill="#000000">** onkey(err, key)</text>
</g>
<!-- header_27&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>header_27&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2056.5,-2302.4211C2056.5,-2267.7295 2056.5,-2191.4007 2056.5,-2149.8089"/>
<polygon fill="#000000" stroke="#000000" points="2060.0001,-2149.5454 2056.5,-2139.5454 2053.0001,-2149.5454 2060.0001,-2149.5454"/>
</g>
<!-- raw_32 -->
<g id="node33" class="node">
<title>raw_32</title>
<ellipse fill="none" stroke="#000000" cx="2180.5" cy="-2121.4318" rx="27" ry="18"/>
<text text-anchor="middle" x="2180.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_28&#45;&gt;raw_32 -->
<g id="edge32" class="edge">
<title>prose_28&#45;&gt;raw_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2186.8665,-2302.4211C2185.6435,-2267.6556 2182.9498,-2191.0757 2181.4889,-2149.5439"/>
<polygon fill="#000000" stroke="#000000" points="2184.9866,-2149.4162 2181.1372,-2139.5454 2177.991,-2149.6623 2184.9866,-2149.4162"/>
</g>
<!-- raw_34 -->
<g id="node35" class="node">
<title>raw_34</title>
<ellipse fill="none" stroke="#000000" cx="2549.5" cy="-2121.4318" rx="27" ry="18"/>
<text text-anchor="middle" x="2549.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_29&#45;&gt;raw_34 -->
<g id="edge34" class="edge">
<title>prose_29&#45;&gt;raw_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2340.8586,-2305.1472C2380.8362,-2269.9456 2479.4783,-2183.0882 2525.3378,-2142.7074"/>
<polygon fill="#000000" stroke="#000000" points="2527.8111,-2145.1931 2533.0032,-2135.9577 2523.1851,-2139.9395 2527.8111,-2145.1931"/>
</g>
<!-- header_36 -->
<g id="node37" class="node">
<title>header_36</title>
<ellipse fill="none" stroke="#000000" cx="3018.5" cy="-2121.4318" rx="67.748" ry="18"/>
<text text-anchor="middle" x="3018.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : onkey state</text>
</g>
<!-- section_30&#45;&gt;header_36 -->
<g id="edge36" class="edge">
<title>section_30&#45;&gt;header_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3168.3051,-2306.917C3144.0845,-2298.4167 3115.9265,-2285.3911 3095.5,-2266.432 3060.2489,-2233.7131 3038.015,-2181.1301 3026.9532,-2149.0841"/>
<polygon fill="#000000" stroke="#000000" points="3030.2274,-2147.8381 3023.7519,-2139.4524 3023.5847,-2150.0459 3030.2274,-2147.8381"/>
</g>
<!-- prose_37 -->
<g id="node38" class="node">
<title>prose_37</title>
<ellipse fill="none" stroke="#000000" cx="3136.5" cy="-2121.4318" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3136.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_30&#45;&gt;prose_37 -->
<g id="edge37" class="edge">
<title>section_30&#45;&gt;prose_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3202.2337,-2302.5857C3193.8353,-2292.5723 3184.0124,-2279.4947 3177.5,-2266.432 3158.4763,-2228.2734 3147.0571,-2179.9294 3141.2704,-2149.8361"/>
<polygon fill="#000000" stroke="#000000" points="3144.6437,-2148.8279 3139.3897,-2139.6275 3137.7595,-2150.0962 3144.6437,-2148.8279"/>
</g>
<!-- prose_38 -->
<g id="node39" class="node">
<title>prose_38</title>
<ellipse fill="none" stroke="#000000" cx="3218.5" cy="-2121.4318" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3218.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_30&#45;&gt;prose_38 -->
<g id="edge38" class="edge">
<title>section_30&#45;&gt;prose_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3218.5,-2302.4211C3218.5,-2267.7295 3218.5,-2191.4007 3218.5,-2149.8089"/>
<polygon fill="#000000" stroke="#000000" points="3222.0001,-2149.5454 3218.5,-2139.5454 3215.0001,-2149.5454 3222.0001,-2149.5454"/>
</g>
<!-- codeblock_39 -->
<g id="node40" class="node">
<title>codeblock_39</title>
<ellipse fill="none" stroke="#000000" cx="3414.5" cy="-2121.4318" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3414.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 174&#45;225</text>
</g>
<!-- section_30&#45;&gt;codeblock_39 -->
<g id="edge39" class="edge">
<title>section_30&#45;&gt;codeblock_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3235.8937,-2302.772C3270.8205,-2267.3106 3349.575,-2187.3506 3389.8169,-2146.4927"/>
<polygon fill="#000000" stroke="#000000" points="3392.34,-2148.9188 3396.8635,-2139.3382 3387.3527,-2144.0068 3392.34,-2148.9188"/>
</g>
<!-- codeblock_40 -->
<g id="node41" class="node">
<title>codeblock_40</title>
<ellipse fill="none" stroke="#000000" cx="3769.5" cy="-2121.4318" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3769.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;262</text>
</g>
<!-- section_30&#45;&gt;codeblock_40 -->
<g id="edge40" class="edge">
<title>section_30&#45;&gt;codeblock_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3288.92,-2313.9427C3349.1408,-2306.8669 3437.4044,-2292.8342 3510.5,-2266.432 3597.1926,-2235.1185 3689.18,-2176.7761 3736.7415,-2144.4616"/>
<polygon fill="#000000" stroke="#000000" points="3738.8199,-2147.2804 3745.094,-2138.743 3734.8654,-2141.5044 3738.8199,-2147.2804"/>
</g>
<!-- codeblock_41 -->
<g id="node42" class="node">
<title>codeblock_41</title>
<ellipse fill="none" stroke="#000000" cx="4152.5" cy="-2121.4318" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4152.5" y="-2117.2318" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 264&#45;303</text>
</g>
<!-- section_30&#45;&gt;codeblock_41 -->
<g id="edge41" class="edge">
<title>section_30&#45;&gt;codeblock_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3293.186,-2317.7881C3439.7025,-2312.013 3759.7467,-2296.3323 3865.5,-2266.432 3962.7455,-2238.9371 4065.9717,-2177.8211 4118.0932,-2144.3821"/>
<polygon fill="#000000" stroke="#000000" points="4120.1204,-2147.2393 4126.6149,-2138.8684 4116.3177,-2141.3622 4120.1204,-2147.2393"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2370,-1043.8173 1885,-1043.8173 1885,-988.0144 2370,-988.0144 2370,-1043.8173"/>
<text text-anchor="middle" x="2127.5" y="-996.4159" font-family="Inconsolata" font-size="14.00" fill="#000000">We buffer escape sequences, which terminate in an alphabetic value.</text>
</g>
<!-- raw_32&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>raw_32&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2179.6243,-2103.1659C2173.5637,-1976.749 2137.845,-1231.6991 2129.3243,-1053.9692"/>
<polygon fill="#000000" stroke="#000000" points="2132.8116,-1053.6182 2128.8367,-1043.7974 2125.8197,-1053.9535 2132.8116,-1053.6182"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2936.5,-1051.2162 2388.5,-1051.2162 2388.5,-980.6155 2936.5,-980.6155 2936.5,-1051.2162"/>
<text text-anchor="middle" x="2662.5" y="-1020.1159" font-family="Inconsolata" font-size="14.00" fill="#000000">No special effort to detect &quot;^[[&quot; (as opposed to just &quot;^[&quot;) is made, that is</text>
<text text-anchor="middle" x="2662.5" y="-1004.7158" font-family="Inconsolata" font-size="14.00" fill="#000000">handled at the recognizer layer.</text>
</g>
<!-- raw_34&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>raw_34&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2551.367,-2103.1659C2564.1109,-1978.4888 2638.3597,-1252.0887 2657.8277,-1061.6262"/>
<polygon fill="#000000" stroke="#000000" points="2661.3373,-1061.7103 2658.8724,-1051.4062 2654.3736,-1060.9985 2661.3373,-1061.7103"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="3082.5,-1033.9158 2954.5,-1033.9158 2954.5,-997.9158 3082.5,-997.9158 3082.5,-1033.9158"/>
<text text-anchor="middle" x="3018.5" y="-1012.4159" font-family="Inconsolata" font-size="14.00" fill="#000000">**** onkey state</text>
</g>
<!-- header_36&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>header_36&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3018.5,-2103.1659C3018.5,-1974.3113 3018.5,-1202.7349 3018.5,-1044.3289"/>
<polygon fill="#000000" stroke="#000000" points="3022.0001,-1044.0005 3018.5,-1034.0006 3015.0001,-1044.0006 3022.0001,-1044.0005"/>
</g>
<!-- raw_43 -->
<g id="node44" class="node">
<title>raw_43</title>
<ellipse fill="none" stroke="#000000" cx="3127.5" cy="-1015.9158" rx="27" ry="18"/>
<text text-anchor="middle" x="3127.5" y="-1011.7158" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_37&#45;&gt;raw_43 -->
<g id="edge43" class="edge">
<title>prose_37&#45;&gt;raw_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3136.3513,-2103.1659C3135.3023,-1974.3113 3129.0209,-1202.7349 3127.7313,-1044.3289"/>
<polygon fill="#000000" stroke="#000000" points="3131.2286,-1043.9717 3127.6472,-1034.0006 3124.2288,-1044.0288 3131.2286,-1043.9717"/>
</g>
<!-- raw_45 -->
<g id="node46" class="node">
<title>raw_45</title>
<ellipse fill="none" stroke="#000000" cx="3199.5" cy="-1015.9158" rx="27" ry="18"/>
<text text-anchor="middle" x="3199.5" y="-1011.7158" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_38&#45;&gt;raw_45 -->
<g id="edge45" class="edge">
<title>prose_38&#45;&gt;raw_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3218.1861,-2103.1659C3215.9715,-1974.3113 3202.7108,-1202.7349 3199.9883,-1044.3289"/>
<polygon fill="#000000" stroke="#000000" points="3203.4822,-1043.9389 3199.8108,-1034.0006 3196.4833,-1044.0593 3203.4822,-1043.9389"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="3702,-1406.5173 3245,-1406.5173 3245,-625.3144 3702,-625.3144 3702,-1406.5173"/>
<text text-anchor="middle" x="3473.5" y="-1391.5165" font-family="Inconsolata" font-size="14.00" fill="#000000">local keybuf = {}</text>
<text text-anchor="middle" x="3473.5" y="-1376.1165" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub, byte = string.sub, string.byte</text>
<text text-anchor="middle" x="3473.5" y="-1360.7165" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = table.concat</text>
<text text-anchor="middle" x="3473.5" y="-1329.3164" font-family="Inconsolata" font-size="14.00" fill="#000000">local linebuf = { line = &quot;&quot;,</text>
<text text-anchor="middle" x="3473.5" y="-1313.9164" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ndx &#160;= 0 }</text>
<text text-anchor="middle" x="3473.5" y="-1282.5164" font-family="Inconsolata" font-size="14.00" fill="#000000">local max_row, mac_col = 0, 0</text>
<text text-anchor="middle" x="3473.5" y="-1267.1163" font-family="Inconsolata" font-size="14.00" fill="#000000">local finding_max = false</text>
<text text-anchor="middle" x="3473.5" y="-1235.7163" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cursor_pos(str)</text>
<text text-anchor="middle" x="3473.5" y="-1220.3163" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;str = sub(str, 3, &#45;2)</text>
<text text-anchor="middle" x="3473.5" y="-1204.9162" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local row, col = core.cleave(str, &quot;;&quot;)</text>
<text text-anchor="middle" x="3473.5" y="-1189.5162" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return tonumber(row), tonumber(col)</text>
<text text-anchor="middle" x="3473.5" y="-1174.1162" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3473.5" y="-1142.7162" font-family="Inconsolata" font-size="14.00" fill="#000000">local _row = 1</text>
<text text-anchor="middle" x="3473.5" y="-1127.3161" font-family="Inconsolata" font-size="14.00" fill="#000000">local function colwrite(str)</text>
<text text-anchor="middle" x="3473.5" y="-1111.9161" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local dash = a.stash() .. a.jump(_row, 80) .. str .. a.pop()</text>
<text text-anchor="middle" x="3473.5" y="-1096.5161" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(dash)</text>
<text text-anchor="middle" x="3473.5" y="-1081.116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;_row = _row + 1</text>
<text text-anchor="middle" x="3473.5" y="-1065.716" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3473.5" y="-1034.316" font-family="Inconsolata" font-size="14.00" fill="#000000">local function process_escapes(seq)</text>
<text text-anchor="middle" x="3473.5" y="-1018.9159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local term = sub(seq, &#45;1)</text>
<text text-anchor="middle" x="3473.5" y="-1003.5159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if term == &quot;R&quot; and finding_max then</text>
<text text-anchor="middle" x="3473.5" y="-988.1159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;max_row, max_col = cursor_pos(seq)</text>
<text text-anchor="middle" x="3473.5" y="-972.7158" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;write(a.pop())</text>
<text text-anchor="middle" x="3473.5" y="-957.3158" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;finding_max = false</text>
<text text-anchor="middle" x="3473.5" y="-941.9158" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif term == &quot;A&quot; then</text>
<text text-anchor="middle" x="3473.5" y="-926.5157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; up</text>
<text text-anchor="middle" x="3473.5" y="-911.1157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif term == &quot;B&quot; then</text>
<text text-anchor="middle" x="3473.5" y="-895.7157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; down</text>
<text text-anchor="middle" x="3473.5" y="-880.3157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif term == &quot;C&quot; then</text>
<text text-anchor="middle" x="3473.5" y="-864.9156" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; left</text>
<text text-anchor="middle" x="3473.5" y="-849.5156" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif term == &quot;D&quot; then</text>
<text text-anchor="middle" x="3473.5" y="-834.1156" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; right</text>
<text text-anchor="middle" x="3473.5" y="-818.7155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3473.5" y="-803.3155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return write(seq)</text>
<text text-anchor="middle" x="3473.5" y="-787.9155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3473.5" y="-772.5154" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3473.5" y="-741.1154" font-family="Inconsolata" font-size="14.00" fill="#000000">local function recognize(seq)</text>
<text text-anchor="middle" x="3473.5" y="-725.7154" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This front matter belongs in the escape handling code.</text>
<text text-anchor="middle" x="3473.5" y="-710.3153" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if byte(seq) == 27 then</text>
<text text-anchor="middle" x="3473.5" y="-694.9153" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;process_escapes(seq)</text>
<text text-anchor="middle" x="3473.5" y="-679.5153" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return</text>
<text text-anchor="middle" x="3473.5" y="-664.1153" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3473.5" y="-648.7152" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(seq)</text>
<text text-anchor="middle" x="3473.5" y="-633.3152" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_39&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>codeblock_39&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3415.4748,-2103.1659C3419.7631,-2022.8148 3437.3894,-1692.541 3452.1015,-1416.8719"/>
<polygon fill="#000000" stroke="#000000" points="3455.6075,-1416.8498 3452.6455,-1406.6775 3448.6175,-1416.4767 3455.6075,-1416.8498"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="4142.5,-1281.5171 3720.5,-1281.5171 3720.5,-750.3146 4142.5,-750.3146 4142.5,-1281.5171"/>
<text text-anchor="middle" x="3931.5" y="-1266.5164" font-family="Inconsolata" font-size="14.00" fill="#000000">local function onkey(err, key)</text>
<text text-anchor="middle" x="3931.5" y="-1251.1163" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if err then error(err) end</text>
<text text-anchor="middle" x="3931.5" y="-1235.7163" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; ^Q to quit</text>
<text text-anchor="middle" x="3931.5" y="-1220.3163" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if key == &quot;\17&quot; then</text>
<text text-anchor="middle" x="3931.5" y="-1204.9162" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;femto.disableRawMode()</text>
<text text-anchor="middle" x="3931.5" y="-1189.5162" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;uv.stop()</text>
<text text-anchor="middle" x="3931.5" y="-1174.1162" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 0</text>
<text text-anchor="middle" x="3931.5" y="-1158.7162" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3931.5" y="-1143.3161" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if key == &quot;\27&quot; then</text>
<text text-anchor="middle" x="3931.5" y="-1127.9161" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;keybuf[#keybuf + 1] &#160;= key</text>
<text text-anchor="middle" x="3931.5" y="-1112.5161" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return</text>
<text text-anchor="middle" x="3931.5" y="-1097.116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3931.5" y="-1081.716" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #keybuf &gt; 0 then</text>
<text text-anchor="middle" x="3931.5" y="-1066.316" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char = byte(key)</text>
<text text-anchor="middle" x="3931.5" y="-1050.9159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; esc [0&#45;9]</text>
<text text-anchor="middle" x="3931.5" y="-1035.5159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if #keybuf == 1 and</text>
<text text-anchor="middle" x="3931.5" y="-1020.1159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;char &gt;= 48 and char &lt;= 57 then</text>
<text text-anchor="middle" x="3931.5" y="-1004.7158" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local esc_val = &quot;\27&quot; .. key</text>
<text text-anchor="middle" x="3931.5" y="-989.3158" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;keybuf[1] = nil</text>
<text text-anchor="middle" x="3931.5" y="-973.9158" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return recognize(esc_val)</text>
<text text-anchor="middle" x="3931.5" y="-958.5157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3931.5" y="-943.1157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; [A&#45;Za&#45;z]</text>
<text text-anchor="middle" x="3931.5" y="-927.7157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if (char &gt;= 65 and char &lt;= 90)</text>
<text text-anchor="middle" x="3931.5" y="-912.3157" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or (char &gt;= 97 and char &lt;= 122) then</text>
<text text-anchor="middle" x="3931.5" y="-896.9156" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local esc_val = concat(keybuf) .. key</text>
<text text-anchor="middle" x="3931.5" y="-881.5156" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i, _ in ipairs(keybuf) do keybuf[i] = nil end</text>
<text text-anchor="middle" x="3931.5" y="-866.1156" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return recognize(esc_val)</text>
<text text-anchor="middle" x="3931.5" y="-850.7155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3931.5" y="-835.3155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;keybuf[#keybuf + 1] = key</text>
<text text-anchor="middle" x="3931.5" y="-819.9155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return</text>
<text text-anchor="middle" x="3931.5" y="-804.5154" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3931.5" y="-789.1154" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3931.5" y="-773.7154" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return recognize(key)</text>
<text text-anchor="middle" x="3931.5" y="-758.3153" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_40&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_40&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3772.1767,-2103.1659C3785.8068,-2010.1512 3848.5138,-1582.2283 3891.0735,-1291.7935"/>
<polygon fill="#000000" stroke="#000000" points="3894.5919,-1291.9225 3892.5788,-1281.5206 3887.6658,-1290.9075 3894.5919,-1291.9225"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4526.5,-1323.3745 4160.5,-1323.3745 4160.5,-708.4572 4526.5,-708.4572 4526.5,-1323.3745"/>
<text text-anchor="middle" x="4343.5" y="-1307.9451" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; Alternate screen</text>
<text text-anchor="middle" x="4343.5" y="-1276.545" font-family="Inconsolata" font-size="14.00" fill="#000000">coroutine.wrap(function()</text>
<text text-anchor="middle" x="4343.5" y="-1261.145" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Get names for as many values as possible</text>
<text text-anchor="middle" x="4343.5" y="-1245.745" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; into the colorizer</text>
<text text-anchor="middle" x="4343.5" y="-1230.3449" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;c.allNames()</text>
<text text-anchor="middle" x="4343.5" y="-1214.9449" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This switches screens and does a wipe,</text>
<text text-anchor="middle" x="4343.5" y="-1199.5449" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; then puts the cursor at 1,1.</text>
<text text-anchor="middle" x="4343.5" y="-1184.1448" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write &#39;\27[?47h\27[2J\27[H&#39;</text>
<text text-anchor="middle" x="4343.5" y="-1168.7448" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;print &quot;an repl, plz reply uwu 👀&quot;</text>
<text text-anchor="middle" x="4343.5" y="-1144.5161" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;displayPrompt &#39;👉 &#160;&#39;</text>
<text text-anchor="middle" x="4343.5" y="-1120.2873" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Crude hack to choose raw mode at runtime</text>
<text text-anchor="middle" x="4343.5" y="-1104.8873" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if arg[1] == &quot;&#45;r&quot; then</text>
<text text-anchor="middle" x="4343.5" y="-1089.4872" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;femto.enableRawMode()</text>
<text text-anchor="middle" x="4343.5" y="-1074.0872" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;uv.read_start(stdin, onkey)</text>
<text text-anchor="middle" x="4343.5" y="-1058.6872" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;finding_max = true</text>
<text text-anchor="middle" x="4343.5" y="-1043.2872" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; stash cursor</text>
<text text-anchor="middle" x="4343.5" y="-1027.8871" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;write(a.stash())</text>
<text text-anchor="middle" x="4343.5" y="-1012.4871" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Jump to bottom right and report position.</text>
<text text-anchor="middle" x="4343.5" y="-997.0871" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;write(&quot;\27[999C\27[999B\27[6n&quot;)</text>
<text text-anchor="middle" x="4343.5" y="-981.687" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; the story continues in onkey...</text>
<text text-anchor="middle" x="4343.5" y="-966.287" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4343.5" y="-950.887" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;uv.read_start(stdin, onread)</text>
<text text-anchor="middle" x="4343.5" y="-935.4869" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4343.5" y="-920.0869" font-family="Inconsolata" font-size="14.00" fill="#000000">end)()</text>
<text text-anchor="middle" x="4343.5" y="-856.6869" font-family="Inconsolata" font-size="14.00" fill="#000000">local retcode = uv.run(&#39;default&#39;)</text>
<text text-anchor="middle" x="4343.5" y="-841.2868" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; Restore</text>
<text text-anchor="middle" x="4343.5" y="-825.8868" font-family="Inconsolata" font-size="14.00" fill="#000000">print &#39;\27[?47l&#39;</text>
<text text-anchor="middle" x="4343.5" y="-794.4868" font-family="Inconsolata" font-size="14.00" fill="#000000">if retcode ~= 0 then</text>
<text text-anchor="middle" x="4343.5" y="-779.0867" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;error(retcode)</text>
<text text-anchor="middle" x="4343.5" y="-763.6867" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4343.5" y="-732.2867" font-family="Inconsolata" font-size="14.00" fill="#000000">print(&quot;kthxbye&quot;)</text>
<text text-anchor="middle" x="4343.5" y="-716.8867" font-family="Inconsolata" font-size="14.00" fill="#000000">return retcode</text>
</g>
<!-- codeblock_41&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_41&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4155.6558,-2103.1659C4170.971,-2014.521 4238.8393,-1621.6966 4288.6157,-1333.5887"/>
<polygon fill="#000000" stroke="#000000" points="4292.125,-1333.8345 4290.3786,-1323.3846 4285.2272,-1332.6427 4292.125,-1333.8345"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3157.5,-55.6015 2805.5,-55.6015 2805.5,.2015 3157.5,.2015 3157.5,-55.6015"/>
<text text-anchor="middle" x="2981.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a stateful event loop, no way around it.</text>
</g>
<!-- raw_43&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>raw_43&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3129.1141,-997.6456C3138.9957,-881.9743 3187.786,-251.1564 3091.5,-91.4 3084.2583,-79.3848 3073.8302,-69.4088 3062.2447,-61.2003"/>
<polygon fill="#000000" stroke="#000000" points="3063.9103,-58.1065 3053.6331,-55.5317 3060.0615,-63.9535 3063.9103,-58.1065"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="3513.5,-47.6021 3175.5,-47.6021 3175.5,-7.7979 3513.5,-7.7979 3513.5,-47.6021"/>
<text text-anchor="middle" x="3344.5" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">State is maintained in the following upvalues.</text>
</g>
<!-- raw_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>raw_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3197.8941,-997.6506C3188.0631,-882.0097 3139.5312,-251.3472 3235.5,-91.4 3245.5831,-74.595 3261.9198,-61.7582 3278.9116,-52.1677"/>
<polygon fill="#000000" stroke="#000000" points="3280.6291,-55.2186 3287.8273,-47.4445 3277.3522,-49.033 3280.6291,-55.2186"/>
</g>
</g>
</svg>
