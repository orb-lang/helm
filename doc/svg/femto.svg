<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="1835pt" height="2749pt"
 viewBox="0.00 0.00 1835.00 2749.03" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2745.0298)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2745.0298 1831,-2745.0298 1831,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="512.5" cy="-2723.0298" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="512.5" y="-2718.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 169</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="512.5" cy="-2651.0298" rx="55.6456" ry="18"/>
<text text-anchor="middle" x="512.5" y="-2646.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;8</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M512.5,-2704.8611C512.5,-2697.1607 512.5,-2688.0041 512.5,-2679.4464"/>
<polygon fill="#000000" stroke="#000000" points="516.0001,-2679.443 512.5,-2669.443 509.0001,-2679.4431 516.0001,-2679.443"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="373.5" cy="-2579.0298" rx="47.4168" ry="18"/>
<text text-anchor="middle" x="373.5" y="-2574.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Femto</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M482.681,-2635.5839C461.6476,-2624.689 433.3222,-2610.0168 410.7936,-2598.3473"/>
<polygon fill="#000000" stroke="#000000" points="412.3354,-2595.2043 401.8461,-2593.7126 409.1157,-2601.4199 412.3354,-2595.2043"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="471.5" cy="-2579.0298" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="471.5" y="-2574.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M502.3652,-2633.232C497.5632,-2624.7993 491.7315,-2614.5583 486.4358,-2605.2585"/>
<polygon fill="#000000" stroke="#000000" points="489.3667,-2603.3322 481.3768,-2596.3743 483.2838,-2606.7962 489.3667,-2603.3322"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="553.5" cy="-2579.0298" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="553.5" y="-2574.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M522.6348,-2633.232C527.4368,-2624.7993 533.2685,-2614.5583 538.5642,-2605.2585"/>
<polygon fill="#000000" stroke="#000000" points="541.7162,-2606.7962 543.6232,-2596.3743 535.6333,-2603.3322 541.7162,-2606.7962"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="817.5" cy="-2579.0298" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="817.5" y="-2574.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 9&#45;29</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M557.8322,-2640.3284C611.6384,-2627.6266 701.4352,-2606.4287 760.0588,-2592.5896"/>
<polygon fill="#000000" stroke="#000000" points="760.9789,-2595.9687 769.9072,-2590.2648 759.3706,-2589.156 760.9789,-2595.9687"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="409.5,-2525.0298 337.5,-2525.0298 337.5,-2489.0298 409.5,-2489.0298 409.5,-2525.0298"/>
<text text-anchor="middle" x="373.5" y="-2503.5298" font-family="Inconsolata" font-size="14.00" fill="#000000">* &#160;Femto</text>
</g>
<!-- header_2&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>header_2&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M373.5,-2560.8611C373.5,-2553.1607 373.5,-2544.0041 373.5,-2535.4464"/>
<polygon fill="#000000" stroke="#000000" points="377.0001,-2535.443 373.5,-2525.443 370.0001,-2535.4431 377.0001,-2535.443"/>
</g>
<!-- raw_7 -->
<g id="node8" class="node">
<title>raw_7</title>
<ellipse fill="none" stroke="#000000" cx="462.5" cy="-2507.0298" rx="27" ry="18"/>
<text text-anchor="middle" x="462.5" y="-2502.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_7 -->
<g id="edge7" class="edge">
<title>prose_3&#45;&gt;raw_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M469.2289,-2560.8611C468.2664,-2553.1607 467.1218,-2544.0041 466.0521,-2535.4464"/>
<polygon fill="#000000" stroke="#000000" points="469.5151,-2534.9317 464.8017,-2525.443 462.5691,-2535.8 469.5151,-2534.9317"/>
</g>
<!-- raw_9 -->
<g id="node10" class="node">
<title>raw_9</title>
<ellipse fill="none" stroke="#000000" cx="553.5" cy="-2507.0298" rx="27" ry="18"/>
<text text-anchor="middle" x="553.5" y="-2502.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_9 -->
<g id="edge9" class="edge">
<title>prose_4&#45;&gt;raw_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M553.5,-2560.8611C553.5,-2553.1607 553.5,-2544.0041 553.5,-2535.4464"/>
<polygon fill="#000000" stroke="#000000" points="557.0001,-2535.443 553.5,-2525.443 550.0001,-2535.4431 557.0001,-2535.443"/>
</g>
<!-- header_11 -->
<g id="node12" class="node">
<title>header_11</title>
<ellipse fill="none" stroke="#000000" cx="712.5" cy="-2507.0298" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="712.5" y="-2502.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : includes</text>
</g>
<!-- section_5&#45;&gt;header_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;header_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M793.147,-2562.3305C778.7322,-2552.4461 760.2981,-2539.8056 744.6936,-2529.1053"/>
<polygon fill="#000000" stroke="#000000" points="746.5856,-2526.1589 736.3589,-2523.3902 742.6269,-2531.9321 746.5856,-2526.1589"/>
</g>
<!-- prose_12 -->
<g id="node13" class="node">
<title>prose_12</title>
<ellipse fill="none" stroke="#000000" cx="817.5" cy="-2507.0298" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="817.5" y="-2502.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;prose_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M817.5,-2560.8611C817.5,-2553.1607 817.5,-2544.0041 817.5,-2535.4464"/>
<polygon fill="#000000" stroke="#000000" points="821.0001,-2535.443 817.5,-2525.443 814.0001,-2535.4431 821.0001,-2535.443"/>
</g>
<!-- codeblock_13 -->
<g id="node14" class="node">
<title>codeblock_13</title>
<ellipse fill="none" stroke="#000000" cx="945.5" cy="-2507.0298" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="945.5" y="-2502.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;27</text>
</g>
<!-- section_5&#45;&gt;codeblock_13 -->
<g id="edge13" class="edge">
<title>section_5&#45;&gt;codeblock_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M845.9073,-2563.0506C863.9187,-2552.9192 887.4447,-2539.6859 907.1084,-2528.625"/>
<polygon fill="#000000" stroke="#000000" points="908.8378,-2531.668 915.8377,-2523.7148 905.406,-2525.567 908.8378,-2531.668"/>
</g>
<!-- section_14 -->
<g id="node15" class="node">
<title>section_14</title>
<ellipse fill="none" stroke="#000000" cx="1127.5" cy="-2507.0298" rx="70.655" ry="18"/>
<text text-anchor="middle" x="1127.5" y="-2502.8298" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 30&#45;169</text>
</g>
<!-- section_5&#45;&gt;section_14 -->
<g id="edge14" class="edge">
<title>section_5&#45;&gt;section_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M865.5974,-2567.8588C919.2927,-2555.3876 1006.36,-2535.1655 1065.2211,-2521.4945"/>
<polygon fill="#000000" stroke="#000000" points="1066.1926,-2524.8621 1075.1415,-2519.1904 1064.6089,-2518.0436 1066.1926,-2524.8621"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="443,-2391.0308 0,-2391.0308 0,-2319.2285 443,-2319.2285 443,-2391.0308"/>
<text text-anchor="middle" x="221.5" y="-2327.6297" font-family="Inconsolata" font-size="14.00" fill="#000000">I just got orb stood up in the pylon bootloader distribution.</text>
</g>
<!-- raw_7&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>raw_7&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M442.778,-2494.5991C409.1273,-2473.3894 339.1899,-2429.3085 286.8971,-2396.3489"/>
<polygon fill="#000000" stroke="#000000" points="288.6631,-2393.3248 278.337,-2390.9535 284.9306,-2399.2466 288.6631,-2393.3248"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="645.5,-2383.0311 461.5,-2383.0311 461.5,-2327.2282 645.5,-2327.2282 645.5,-2383.0311"/>
<text text-anchor="middle" x="553.5" y="-2351.6297" font-family="Inconsolata" font-size="14.00" fill="#000000">I am excited about this.</text>
</g>
<!-- raw_9&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>raw_9&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M553.5,-2489.0083C553.5,-2465.5285 553.5,-2423.8631 553.5,-2393.2315"/>
<polygon fill="#000000" stroke="#000000" points="557.0001,-2392.9048 553.5,-2382.9049 550.0001,-2392.9049 557.0001,-2392.9048"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="763.5,-2373.1296 663.5,-2373.1296 663.5,-2337.1296 763.5,-2337.1296 763.5,-2373.1296"/>
<text text-anchor="middle" x="713.5" y="-2351.6297" font-family="Inconsolata" font-size="14.00" fill="#000000">** &#160;includes</text>
</g>
<!-- header_11&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>header_11&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M712.6186,-2489.0083C712.7899,-2462.9977 713.108,-2414.67 713.3116,-2383.7479"/>
<polygon fill="#000000" stroke="#000000" points="716.8124,-2383.6242 713.3784,-2373.6014 709.8125,-2383.5781 716.8124,-2383.6242"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="808.5" cy="-2355.1296" rx="27" ry="18"/>
<text text-anchor="middle" x="808.5" y="-2350.9296" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_12&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_12&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M816.4322,-2489.0083C814.8828,-2462.8571 811.9967,-2414.1469 810.166,-2383.248"/>
<polygon fill="#000000" stroke="#000000" points="813.6518,-2382.9031 809.5664,-2373.1276 806.664,-2383.3172 813.6518,-2382.9031"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1037.5,-2452.93 853.5,-2452.93 853.5,-2257.3293 1037.5,-2257.3293 1037.5,-2452.93"/>
<text text-anchor="middle" x="945.5" y="-2437.8298" font-family="Inconsolata" font-size="14.00" fill="#000000">sql = require &quot;sqlite&quot;</text>
<text text-anchor="middle" x="945.5" y="-2406.4297" font-family="Inconsolata" font-size="14.00" fill="#000000">lfs = require &quot;lfs&quot;</text>
<text text-anchor="middle" x="945.5" y="-2391.0297" font-family="Inconsolata" font-size="14.00" fill="#000000">ffi = require &quot;ffi&quot;</text>
<text text-anchor="middle" x="945.5" y="-2359.6297" font-family="Inconsolata" font-size="14.00" fill="#000000">uv = require &quot;luv&quot;</text>
<text text-anchor="middle" x="945.5" y="-2328.2296" font-family="Inconsolata" font-size="14.00" fill="#000000">L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="945.5" y="-2296.8296" font-family="Inconsolata" font-size="14.00" fill="#000000">a = require &quot;src/anterm&quot;</text>
<text text-anchor="middle" x="945.5" y="-2265.4296" font-family="Inconsolata" font-size="14.00" fill="#000000">c = require &quot;src/color&quot;</text>
</g>
<!-- codeblock_13&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>codeblock_13&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M945.5,-2489.0083C945.5,-2481.8176 945.5,-2472.9212 945.5,-2463.1585"/>
<polygon fill="#000000" stroke="#000000" points="949.0001,-2463.138 945.5,-2453.138 942.0001,-2463.1381 949.0001,-2463.138"/>
</g>
<!-- header_19 -->
<g id="node20" class="node">
<title>header_19</title>
<ellipse fill="none" stroke="#000000" cx="1110.5" cy="-2355.1296" rx="38.2457" ry="18"/>
<text text-anchor="middle" x="1110.5" y="-2350.9296" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : utils</text>
</g>
<!-- section_14&#45;&gt;header_19 -->
<g id="edge19" class="edge">
<title>section_14&#45;&gt;header_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1125.4831,-2489.0083C1122.5564,-2462.8571 1117.105,-2414.1469 1113.6469,-2383.248"/>
<polygon fill="#000000" stroke="#000000" points="1117.1048,-2382.6763 1112.5143,-2373.1276 1110.1483,-2383.4549 1117.1048,-2382.6763"/>
</g>
<!-- prose_20 -->
<g id="node21" class="node">
<title>prose_20</title>
<ellipse fill="none" stroke="#000000" cx="1198.5" cy="-2355.1296" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1198.5" y="-2350.9296" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_14&#45;&gt;prose_20 -->
<g id="edge20" class="edge">
<title>section_14&#45;&gt;prose_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1138.287,-2488.8018C1144.2402,-2478.458 1151.5998,-2465.1866 1157.5,-2453.0298 1168.8568,-2429.6301 1180.1545,-2402.2713 1188.0056,-2382.4332"/>
<polygon fill="#000000" stroke="#000000" points="1191.2819,-2383.6652 1191.6735,-2373.0776 1184.7649,-2381.1101 1191.2819,-2383.6652"/>
</g>
<!-- codeblock_21 -->
<g id="node22" class="node">
<title>codeblock_21</title>
<ellipse fill="none" stroke="#000000" cx="1433.5" cy="-2355.1296" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="1433.5" y="-2350.9296" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 32&#45;169</text>
</g>
<!-- section_14&#45;&gt;codeblock_21 -->
<g id="edge21" class="edge">
<title>section_14&#45;&gt;codeblock_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1160.9019,-2491.1196C1183.2081,-2480.4469 1213.172,-2466.0185 1239.5,-2453.0298 1292.2774,-2426.9925 1352.7689,-2396.3357 1391.9765,-2376.3571"/>
<polygon fill="#000000" stroke="#000000" points="1393.662,-2379.4264 1400.9809,-2371.7658 1390.4822,-2373.1903 1393.662,-2379.4264"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1049.5,-1181.9151 501.5,-1181.9151 501.5,-1111.3144 1049.5,-1111.3144 1049.5,-1181.9151"/>
<text text-anchor="middle" x="775.5" y="-1134.8148" font-family="Inconsolata" font-size="14.00" fill="#000000">This all goes into global space for now. &#160;Our more sophisticated loader will</text>
<text text-anchor="middle" x="775.5" y="-1119.4148" font-family="Inconsolata" font-size="14.00" fill="#000000">handle namespace isolation. Meanwhile we&#39;re building a repl, so.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M808.0079,-2337.1081C804.42,-2205.7135 782.2712,-1394.589 776.7472,-1192.2877"/>
<polygon fill="#000000" stroke="#000000" points="780.2386,-1191.9214 776.4668,-1182.0207 773.2412,-1192.1126 780.2386,-1191.9214"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1153.5,-1164.6148 1067.5,-1164.6148 1067.5,-1128.6148 1153.5,-1128.6148 1153.5,-1164.6148"/>
<text text-anchor="middle" x="1110.5" y="-1143.1148" font-family="Inconsolata" font-size="14.00" fill="#000000">**** utils</text>
</g>
<!-- header_19&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>header_19&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1110.5,-2337.1081C1110.5,-2201.5629 1110.5,-1342.666 1110.5,-1174.9796"/>
<polygon fill="#000000" stroke="#000000" points="1114.0001,-1174.7403 1110.5,-1164.7403 1107.0001,-1174.7404 1114.0001,-1174.7403"/>
</g>
<!-- raw_23 -->
<g id="node24" class="node">
<title>raw_23</title>
<ellipse fill="none" stroke="#000000" cx="1198.5" cy="-1146.6148" rx="27" ry="18"/>
<text text-anchor="middle" x="1198.5" y="-1142.4148" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_20&#45;&gt;raw_23 -->
<g id="edge23" class="edge">
<title>prose_20&#45;&gt;raw_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1198.5,-2337.1081C1198.5,-2201.5629 1198.5,-1342.666 1198.5,-1174.9796"/>
<polygon fill="#000000" stroke="#000000" points="1202.0001,-1174.7403 1198.5,-1164.7403 1195.0001,-1174.7404 1202.0001,-1174.7403"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="1827,-2221.3443 1244,-2221.3443 1244,-71.8852 1827,-71.8852 1827,-2221.3443"/>
<text text-anchor="middle" x="1535.5" y="-2190.0295" font-family="Inconsolata" font-size="14.00" fill="#000000">local usecolors</text>
<text text-anchor="middle" x="1535.5" y="-2174.6295" font-family="Inconsolata" font-size="14.00" fill="#000000">stdout = &quot;&quot;</text>
<text text-anchor="middle" x="1535.5" y="-2143.2295" font-family="Inconsolata" font-size="14.00" fill="#000000">if uv.guess_handle(1) == &quot;tty&quot; then</text>
<text text-anchor="middle" x="1535.5" y="-2127.8294" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;stdout = uv.new_tty(1, false)</text>
<text text-anchor="middle" x="1535.5" y="-2112.4294" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;usecolors = true</text>
<text text-anchor="middle" x="1535.5" y="-2097.0294" font-family="Inconsolata" font-size="14.00" fill="#000000">else</text>
<text text-anchor="middle" x="1535.5" y="-2081.6294" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;stdout = uv.new_pipe(false)</text>
<text text-anchor="middle" x="1535.5" y="-2066.2293" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;uv.pipe_open(utils.stdout, 1)</text>
<text text-anchor="middle" x="1535.5" y="-2050.8293" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;usecolors = false</text>
<text text-anchor="middle" x="1535.5" y="-2035.4293" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-2004.0292" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; Print replacement that goes through libuv. &#160;This is useful on windows</text>
<text text-anchor="middle" x="1535.5" y="-1988.6292" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; to use libuv&#39;s code to translate ansi escape codes to windows API calls.</text>
<text text-anchor="middle" x="1535.5" y="-1973.2292" font-family="Inconsolata" font-size="14.00" fill="#000000">function print(...)</text>
<text text-anchor="middle" x="1535.5" y="-1957.8291" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local n = select(&#39;#&#39;, ...)</text>
<text text-anchor="middle" x="1535.5" y="-1942.4291" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local arguments = {...}</text>
<text text-anchor="middle" x="1535.5" y="-1927.0291" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for i = 1, n do</text>
<text text-anchor="middle" x="1535.5" y="-1911.629" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;arguments[i] = tostring(arguments[i])</text>
<text text-anchor="middle" x="1535.5" y="-1896.229" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1535.5" y="-1880.829" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;uv.write(stdout, table.concat(arguments, &quot;\t&quot;) .. &quot;\n&quot;)</text>
<text text-anchor="middle" x="1535.5" y="-1865.4289" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-1834.0289" font-family="Inconsolata" font-size="14.00" fill="#000000">function write(str)</text>
<text text-anchor="middle" x="1535.5" y="-1818.6289" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;uv.write(stdout, str)</text>
<text text-anchor="middle" x="1535.5" y="-1803.2289" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-1755.8288" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; &#160;*** tty setup</text>
<text text-anchor="middle" x="1535.5" y="-1724.4288" font-family="Inconsolata" font-size="14.00" fill="#000000">if uv.guess_handle(0) ~= &quot;tty&quot; or</text>
<text text-anchor="middle" x="1535.5" y="-1709.0288" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;uv.guess_handle(1) ~= &quot;tty&quot; then</text>
<text text-anchor="middle" x="1535.5" y="-1693.6287" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; Entry point for other consumers!</text>
<text text-anchor="middle" x="1535.5" y="-1678.2287" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;error &quot;stdio must be a tty&quot;</text>
<text text-anchor="middle" x="1535.5" y="-1662.8287" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-1631.4286" font-family="Inconsolata" font-size="14.00" fill="#000000">local stdin = uv.new_tty(0, true)</text>
<text text-anchor="middle" x="1535.5" y="-1584.0286" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;[[</text>
<text text-anchor="middle" x="1535.5" y="-1552.6286" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;ll keep this around for a bit, it looks nice</text>
<text text-anchor="middle" x="1535.5" y="-1505.2285" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;]]</text>
<text text-anchor="middle" x="1535.5" y="-1473.8285" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; &#160;*** utilities</text>
<text text-anchor="middle" x="1535.5" y="-1442.4285" font-family="Inconsolata" font-size="14.00" fill="#000000">local function gatherResults(success, ...)</text>
<text text-anchor="middle" x="1535.5" y="-1427.0284" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local n = select(&#39;#&#39;, ...)</text>
<text text-anchor="middle" x="1535.5" y="-1411.6284" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return success, { n = n, ... }</text>
<text text-anchor="middle" x="1535.5" y="-1396.2284" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-1364.8284" font-family="Inconsolata" font-size="14.00" fill="#000000">local function printResults(results)</text>
<text text-anchor="middle" x="1535.5" y="-1349.4283" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for i = 1, results.n do</text>
<text text-anchor="middle" x="1535.5" y="-1334.0283" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;results[i] = c.ts(results[i])</text>
<text text-anchor="middle" x="1535.5" y="-1318.6283" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1535.5" y="-1303.2282" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;print(table.concat(results, &#39;\t&#39;))</text>
<text text-anchor="middle" x="1535.5" y="-1287.8282" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-1256.4282" font-family="Inconsolata" font-size="14.00" fill="#000000">local buffer = &#39;&#39;</text>
<text text-anchor="middle" x="1535.5" y="-1225.0281" font-family="Inconsolata" font-size="14.00" fill="#000000">local function evaluateLine(line)</text>
<text text-anchor="middle" x="1535.5" y="-1209.6281" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if line == &quot;&lt;3\n&quot; then</text>
<text text-anchor="middle" x="1535.5" y="-1194.2281" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;print(&quot;I &quot; .. a.red(&quot;â™¥&quot;) .. &quot; you too!&quot;)</text>
<text text-anchor="middle" x="1535.5" y="-1177.0879" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &#39;&gt;&#39;</text>
<text text-anchor="middle" x="1535.5" y="-1161.6879" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1535.5" y="-1146.2879" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local chunk &#160;= buffer .. line</text>
<text text-anchor="middle" x="1535.5" y="-1130.8878" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local f, err = loadstring(&#39;return &#39; .. chunk, &#39;REPL&#39;) &#45;&#45; first we prefix return</text>
<text text-anchor="middle" x="1535.5" y="-1099.4878" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if not f then</text>
<text text-anchor="middle" x="1535.5" y="-1084.0878" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;f, err = loadstring(chunk, &#39;REPL&#39;) &#45;&#45; try again without return</text>
<text text-anchor="middle" x="1535.5" y="-1068.6878" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1535.5" y="-1037.2877" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if f then</text>
<text text-anchor="middle" x="1535.5" y="-1021.8877" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;buffer = &#39;&#39;</text>
<text text-anchor="middle" x="1535.5" y="-1006.4877" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local success, results = gatherResults(xpcall(f, debug.traceback))</text>
<text text-anchor="middle" x="1535.5" y="-975.0876" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if success then</text>
<text text-anchor="middle" x="1535.5" y="-959.6876" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; successful call</text>
<text text-anchor="middle" x="1535.5" y="-944.2876" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results.n &gt; 0 then</text>
<text text-anchor="middle" x="1535.5" y="-928.8875" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;printResults(results)</text>
<text text-anchor="middle" x="1535.5" y="-913.4875" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1535.5" y="-898.0875" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="1535.5" y="-882.6874" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; error</text>
<text text-anchor="middle" x="1535.5" y="-867.2874" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;print(results[1])</text>
<text text-anchor="middle" x="1535.5" y="-851.8874" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1535.5" y="-836.4873" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="1535.5" y="-805.0873" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if err:match &quot;&#39;&lt;eof&gt;&#39;$&quot; then</text>
<text text-anchor="middle" x="1535.5" y="-789.6873" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Lua expects some more input; stow it away for next time</text>
<text text-anchor="middle" x="1535.5" y="-774.2873" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;buffer = chunk .. &#39;\n&#39;</text>
<text text-anchor="middle" x="1535.5" y="-758.8872" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return &#39;...&#39;</text>
<text text-anchor="middle" x="1535.5" y="-743.4872" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="1535.5" y="-728.0872" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;print(err)</text>
<text text-anchor="middle" x="1535.5" y="-712.6871" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;buffer = &#39;&#39;</text>
<text text-anchor="middle" x="1535.5" y="-697.2871" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1535.5" y="-681.8871" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1535.5" y="-650.487" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return &#39;ðŸ‘‰ &#39;</text>
<text text-anchor="middle" x="1535.5" y="-626.2583" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-594.8583" font-family="Inconsolata" font-size="14.00" fill="#000000">local function displayPrompt(prompt)</text>
<text text-anchor="middle" x="1535.5" y="-579.4582" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;uv.write(stdout, prompt)</text>
<text text-anchor="middle" x="1535.5" y="-564.0582" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-532.6582" font-family="Inconsolata" font-size="14.00" fill="#000000">local function onread(err, line)</text>
<text text-anchor="middle" x="1535.5" y="-517.2581" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if err then error(err) end</text>
<text text-anchor="middle" x="1535.5" y="-501.8581" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if line then</text>
<text text-anchor="middle" x="1535.5" y="-486.4581" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local prompt = evaluateLine(line)</text>
<text text-anchor="middle" x="1535.5" y="-471.058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;displayPrompt(prompt)</text>
<text text-anchor="middle" x="1535.5" y="-455.658" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="1535.5" y="-440.258" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;uv.close(stdin)</text>
<text text-anchor="middle" x="1535.5" y="-424.8579" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1535.5" y="-409.4579" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1535.5" y="-378.0579" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; Alternate screen</text>
<text text-anchor="middle" x="1535.5" y="-346.6578" font-family="Inconsolata" font-size="14.00" fill="#000000">coroutine.wrap(function()</text>
<text text-anchor="middle" x="1535.5" y="-331.2578" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This switches screens and does a wipe,</text>
<text text-anchor="middle" x="1535.5" y="-315.8578" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; then puts the cursor at 1,1.</text>
<text text-anchor="middle" x="1535.5" y="-300.4578" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write &#39;\27[?47h\27[2J\27[H&#39;</text>
<text text-anchor="middle" x="1535.5" y="-285.0577" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;print &quot;an repl, plz reply uwu ðŸ‘€&quot;</text>
<text text-anchor="middle" x="1535.5" y="-260.829" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;displayPrompt &#39;ðŸ‘‰ &#39;</text>
<text text-anchor="middle" x="1535.5" y="-236.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;uv.read_start(stdin, onread)</text>
<text text-anchor="middle" x="1535.5" y="-221.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">end)()</text>
<text text-anchor="middle" x="1535.5" y="-189.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">uv.run(&#39;default&#39;)</text>
<text text-anchor="middle" x="1535.5" y="-158.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; Restore</text>
<text text-anchor="middle" x="1535.5" y="-127.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">print &#39;\27[?47l&#39;</text>
<text text-anchor="middle" x="1535.5" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">print(&quot;kthxbye&quot;)</text>
<text text-anchor="middle" x="1535.5" y="-80.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return 0</text>
</g>
<!-- codeblock_21&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_21&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1435.021,-2337.1081C1436.7425,-2316.7117 1439.8464,-2279.9363 1443.9259,-2231.6017"/>
<polygon fill="#000000" stroke="#000000" points="1447.4293,-2231.7078 1444.7828,-2221.4489 1440.4541,-2231.1191 1447.4293,-2231.7078"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="1225.5,-36 1171.5,-36 1171.5,0 1225.5,0 1225.5,-36"/>
</g>
<!-- raw_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>raw_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1198.5,-1128.4298C1198.5,-998.1562 1198.5,-207.4258 1198.5,-46.551"/>
<polygon fill="#000000" stroke="#000000" points="1202.0001,-46.0742 1198.5,-36.0742 1195.0001,-46.0742 1202.0001,-46.0742"/>
</g>
</g>
</svg>
