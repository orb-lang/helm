<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="15402pt" height="2655pt"
 viewBox="0.00 0.00 15402.30 2654.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2650.604)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2650.604 15398.2972,-2650.604 15398.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2628.604" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1916" y="-2624.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 515</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2556.604" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1916" y="-2552.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;429</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2610.4354C1916,-2602.735 1916,-2593.5784 1916,-2585.0207"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2585.0173 1916,-2575.0173 1912.5001,-2585.0173 1919.5001,-2585.0173"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-2484.604" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1423" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.742,-2550.8376C1771.438,-2542.7044 1622.1023,-2526.1782 1496,-2502.604 1489.769,-2501.4392 1483.2751,-2500.0685 1476.8422,-2498.6121"/>
<polygon fill="#000000" stroke="#000000" points="1477.3647,-2495.1399 1466.8303,-2496.27 1475.7702,-2501.9559 1477.3647,-2495.1399"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1537" cy="-2484.604" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1537" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.6473,-2550.8587C1785.6726,-2543.605 1674.1491,-2528.7923 1581,-2502.604 1577.9982,-2501.7601 1574.924,-2500.7732 1571.8643,-2499.7039"/>
<polygon fill="#000000" stroke="#000000" points="1572.8384,-2496.3308 1562.2464,-2496.0822 1570.3715,-2502.8818 1572.8384,-2496.3308"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1622" cy="-2484.604" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1622" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1858.8831,-2547.6223C1807.2649,-2538.741 1729.5556,-2523.4583 1664,-2502.604 1661.5525,-2501.8254 1659.0524,-2500.9559 1656.552,-2500.0309"/>
<polygon fill="#000000" stroke="#000000" points="1657.6046,-2496.6835 1647.0181,-2496.263 1655.0318,-2503.1936 1657.6046,-2496.6835"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1705" cy="-2484.604" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1705" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1870.7661,-2543.4354C1836.4995,-2533.1505 1788.4123,-2518.0539 1747,-2502.604 1744.7423,-2501.7617 1742.4291,-2500.8659 1740.1053,-2499.9411"/>
<polygon fill="#000000" stroke="#000000" points="1741.188,-2496.6021 1730.6082,-2496.0392 1738.5278,-2503.077 1741.188,-2496.6021"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1788" cy="-2484.604" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1788" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1886.9548,-2540.2661C1866.998,-2529.0404 1840.5,-2514.1353 1819.947,-2502.5742"/>
<polygon fill="#000000" stroke="#000000" points="1821.3986,-2499.3751 1810.9669,-2497.5229 1817.9668,-2505.4761 1821.3986,-2499.3751"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2484.604" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1916" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2538.4354C1916,-2530.735 1916,-2521.5784 1916,-2513.0207"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2513.0173 1916,-2503.0173 1912.5001,-2513.0173 1919.5001,-2513.0173"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2130" cy="-2484.604" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2130" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1957.5151,-2542.6363C1991.3229,-2531.2617 2039.3025,-2515.1191 2076.0788,-2502.7457"/>
<polygon fill="#000000" stroke="#000000" points="2077.2896,-2506.0312 2085.6515,-2499.525 2075.0574,-2499.3967 2077.2896,-2506.0312"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2484.604" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;231</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1977.2733,-2550.0875C2101.3869,-2536.8878 2382.1528,-2507.028 2517.3937,-2492.6449"/>
<polygon fill="#000000" stroke="#000000" points="2518.0882,-2496.0908 2527.6619,-2491.5528 2517.3478,-2489.1301 2518.0882,-2496.0908"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7176" cy="-2484.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7176" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 282&#45;317</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.029,-2555.7002C2539.7647,-2548.0658 6458.0244,-2494.4318 7090.0265,-2485.7808"/>
<polygon fill="#000000" stroke="#000000" points="7090.4664,-2489.2753 7100.4176,-2485.6386 7090.3706,-2482.2759 7090.4664,-2489.2753"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11204" cy="-2484.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11204" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 373&#45;429</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1981.8595,-2556.0935C2762.3154,-2550.0434 10232.4913,-2492.1351 11118.3001,-2485.2684"/>
<polygon fill="#000000" stroke="#000000" points="11118.4443,-2488.7675 11128.4168,-2485.1899 11118.3899,-2481.7677 11118.4443,-2488.7675"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="13036" cy="-2484.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13036" y="-2480.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 430&#45;481</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.0829,-2556.3383C2597.909,-2553.8382 7397.2978,-2533.8449 11288,-2502.604 11926.32,-2497.4786 12695.7294,-2488.6244 12949.9142,-2485.6287"/>
<polygon fill="#000000" stroke="#000000" points="12950.2275,-2489.1253 12960.1855,-2485.5075 12950.1449,-2482.1258 12950.2275,-2489.1253"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1468.5,-2383.0039 1375.5,-2383.0039 1375.5,-2347.0039 1468.5,-2347.0039 1468.5,-2383.0039"/>
<text text-anchor="middle" x="1422" y="-2361.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1422.8481,-2466.4393C1422.6859,-2447.0333 1422.4265,-2416.014 1422.2373,-2393.3818"/>
<polygon fill="#000000" stroke="#000000" points="1425.7369,-2393.3099 1422.1533,-2383.3395 1418.7371,-2393.3685 1425.7369,-2393.3099"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1514" cy="-2365.0039" rx="27" ry="18"/>
<text text-anchor="middle" x="1514" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1533.5567,-2466.6987C1529.8135,-2447.2342 1523.7818,-2415.8694 1519.4058,-2393.1138"/>
<polygon fill="#000000" stroke="#000000" points="1522.7924,-2392.1907 1517.4669,-2383.0317 1515.9184,-2393.5127 1522.7924,-2392.1907"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1586" cy="-2365.0039" rx="27" ry="18"/>
<text text-anchor="middle" x="1586" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1616.6104,-2466.6987C1610.7251,-2447.1462 1601.2251,-2415.5853 1594.3684,-2392.8055"/>
<polygon fill="#000000" stroke="#000000" points="1597.6602,-2391.5984 1591.4264,-2383.0317 1590.9573,-2393.6161 1597.6602,-2391.5984"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1658" cy="-2365.0039" rx="27" ry="18"/>
<text text-anchor="middle" x="1658" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1698.065,-2466.9566C1690.3243,-2447.2591 1677.705,-2415.1469 1668.6975,-2392.2257"/>
<polygon fill="#000000" stroke="#000000" points="1671.8785,-2390.7507 1664.9635,-2382.7237 1665.3635,-2393.311 1671.8785,-2390.7507"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1730" cy="-2365.0039" rx="27" ry="18"/>
<text text-anchor="middle" x="1730" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1779.5663,-2467.2131C1769.9445,-2447.3722 1754.0994,-2414.6987 1742.9184,-2391.6426"/>
<polygon fill="#000000" stroke="#000000" points="1745.9566,-2389.8863 1738.4439,-2382.4158 1739.6582,-2392.9408 1745.9566,-2389.8863"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057,-2430.7043 1775,-2430.7043 1775,-2299.3035 2057,-2299.3035 2057,-2430.7043"/>
<text text-anchor="middle" x="1916" y="-2415.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1916" y="-2400.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1916" y="-2384.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1916" y="-2369.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1916" y="-2353.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1916" y="-2338.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1916" y="-2323.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1916" y="-2307.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2466.4393C1916,-2459.1644 1916,-2450.2573 1916,-2440.7719"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2440.7218 1916,-2430.7219 1912.5001,-2440.7219 1919.5001,-2440.7218"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2383.0039 2075.5,-2383.0039 2075.5,-2347.0039 2266.5,-2347.0039 2266.5,-2383.0039"/>
<text text-anchor="middle" x="2171" y="-2361.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2136.227,-2466.4393C2142.9097,-2446.9455 2153.6096,-2415.7331 2161.3769,-2393.0751"/>
<polygon fill="#000000" stroke="#000000" points="2164.7823,-2393.9342 2164.7144,-2383.3395 2158.1606,-2391.6641 2164.7823,-2393.9342"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2365.0039" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2540.569,-2472.528C2507.7843,-2463.6928 2465.4023,-2449.8701 2431,-2430.604 2411.3309,-2419.5888 2391.9201,-2403.2895 2377.3823,-2389.694"/>
<polygon fill="#000000" stroke="#000000" points="2379.4802,-2386.857 2369.8364,-2382.4698 2374.6394,-2391.9134 2379.4802,-2386.857"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2562.6368,-2468.2619C2546.6527,-2458.6892 2527.4321,-2445.5526 2513,-2430.604 2501.8906,-2419.097 2492.2443,-2404.0992 2485.1042,-2391.3488"/>
<polygon fill="#000000" stroke="#000000" points="2488.1857,-2389.689 2480.3629,-2382.5438 2482.0224,-2393.0078 2488.1857,-2389.689"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2365.0039" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;141</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2466.4393C2593,-2447.0333 2593,-2416.014 2593,-2393.3818"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2393.3395 2593,-2383.3395 2589.5001,-2393.3396 2596.5001,-2393.3395"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2365.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 142&#45;220</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2632.7017,-2469.5777C2690.133,-2447.841 2796.3573,-2407.6371 2859.0409,-2383.9125"/>
<polygon fill="#000000" stroke="#000000" points="2860.5997,-2387.0649 2868.7133,-2380.2517 2858.1218,-2380.5181 2860.5997,-2387.0649"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-2365.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3963" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;231</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2660.0054,-2478.7545C2888.1147,-2458.8407 3634.0436,-2393.7216 3882.022,-2372.0732"/>
<polygon fill="#000000" stroke="#000000" points="3882.3866,-2375.5548 3892.0443,-2371.1983 3881.7777,-2368.5813 3882.3866,-2375.5548"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4840" cy="-2365.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4840" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 232&#45;281</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.4147,-2483.1226C2873.7216,-2478.4544 3515.5884,-2462.4358 4047,-2430.604 4308.2496,-2414.9551 4617.13,-2386.5406 4760.0626,-2372.8254"/>
<polygon fill="#000000" stroke="#000000" points="4760.445,-2376.3049 4770.064,-2371.8637 4759.7749,-2369.337 4760.445,-2376.3049"/>
</g>
<!-- header_88 -->
<g id="node89" class="node">
<title>header_88</title>
<ellipse fill="none" stroke="#000000" cx="6977" cy="-2365.0039" rx="107.339" ry="18"/>
<text text-anchor="middle" x="6977" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;header_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7147.9102,-2467.7219C7113.0959,-2446.7983 7053.6297,-2411.0588 7014.8262,-2387.7377"/>
<polygon fill="#000000" stroke="#000000" points="7016.2896,-2384.5337 7005.9155,-2382.3823 7012.6837,-2390.5335 7016.2896,-2384.5337"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7135" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7135" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7169.773,-2466.4393C7163.0515,-2446.8321 7152.2659,-2415.3697 7144.4879,-2392.6808"/>
<polygon fill="#000000" stroke="#000000" points="7147.705,-2391.2722 7141.1513,-2382.9477 7141.0833,-2393.5423 7147.705,-2391.2722"/>
</g>
<!-- prose_90 -->
<g id="node91" class="node">
<title>prose_90</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7217" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;prose_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7182.227,-2466.4393C7188.9485,-2446.8321 7199.7341,-2415.3697 7207.5121,-2392.6808"/>
<polygon fill="#000000" stroke="#000000" points="7210.9167,-2393.5423 7210.8487,-2382.9477 7204.295,-2391.2722 7210.9167,-2393.5423"/>
</g>
<!-- section_91 -->
<g id="node92" class="node">
<title>section_91</title>
<ellipse fill="none" stroke="#000000" cx="7804" cy="-2365.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7804" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 292&#45;317</text>
</g>
<!-- section_10&#45;&gt;section_91 -->
<g id="edge91" class="edge">
<title>section_10&#45;&gt;section_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7235.0807,-2473.3523C7351.4995,-2451.1808 7610.0282,-2401.9451 7734.4495,-2378.2495"/>
<polygon fill="#000000" stroke="#000000" points="7735.4502,-2381.6219 7744.6188,-2376.3128 7734.1405,-2374.7455 7735.4502,-2381.6219"/>
</g>
<!-- section_92 -->
<g id="node93" class="node">
<title>section_92</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2365.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9340" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 318&#45;372</text>
</g>
<!-- section_10&#45;&gt;section_92 -->
<g id="edge92" class="edge">
<title>section_10&#45;&gt;section_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7249.5516,-2480.539C7577.8074,-2462.3969 8908.0524,-2388.8768 9256.2491,-2369.6327"/>
<polygon fill="#000000" stroke="#000000" points="9256.4708,-2373.1258 9266.2623,-2369.0792 9256.0844,-2366.1365 9256.4708,-2373.1258"/>
</g>
<!-- header_140 -->
<g id="node141" class="node">
<title>header_140</title>
<ellipse fill="none" stroke="#000000" cx="10367" cy="-2365.0039" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10367" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_140 -->
<g id="edge140" class="edge">
<title>section_11&#45;&gt;header_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11130.479,-2480.4749C10987.0246,-2472.0683 10674.6014,-2451.9469 10569,-2430.604 10516.5798,-2420.0095 10458.7172,-2400.3625 10418.4058,-2385.3215"/>
<polygon fill="#000000" stroke="#000000" points="10419.3972,-2381.9548 10408.8054,-2381.7026 10416.9281,-2388.5049 10419.3972,-2381.9548"/>
</g>
<!-- prose_141 -->
<g id="node142" class="node">
<title>prose_141</title>
<ellipse fill="none" stroke="#000000" cx="10610" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10610" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_141 -->
<g id="edge141" class="edge">
<title>section_11&#45;&gt;prose_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11146.2344,-2472.9731C11026.4436,-2448.8536 10753.5682,-2393.9109 10650.4635,-2373.1511"/>
<polygon fill="#000000" stroke="#000000" points="10650.9485,-2369.6786 10640.4543,-2371.1358 10649.5667,-2376.5409 10650.9485,-2369.6786"/>
</g>
<!-- prose_142 -->
<g id="node143" class="node">
<title>prose_142</title>
<ellipse fill="none" stroke="#000000" cx="11056" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11056" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_142 -->
<g id="edge142" class="edge">
<title>section_11&#45;&gt;prose_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11182.4795,-2467.2131C11156.0651,-2445.8674 11111.2709,-2409.6688 11082.6903,-2386.5726"/>
<polygon fill="#000000" stroke="#000000" points="11084.7115,-2383.7059 11074.7338,-2380.1428 11080.3117,-2389.1504 11084.7115,-2383.7059"/>
</g>
<!-- prose_143 -->
<g id="node144" class="node">
<title>prose_143</title>
<ellipse fill="none" stroke="#000000" cx="11204" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11204" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_143 -->
<g id="edge143" class="edge">
<title>section_11&#45;&gt;prose_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11204,-2466.4393C11204,-2447.0333 11204,-2416.014 11204,-2393.3818"/>
<polygon fill="#000000" stroke="#000000" points="11207.5001,-2393.3395 11204,-2383.3395 11200.5001,-2393.3396 11207.5001,-2393.3395"/>
</g>
<!-- prose_144 -->
<g id="node145" class="node">
<title>prose_144</title>
<ellipse fill="none" stroke="#000000" cx="11286" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11286" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_144 -->
<g id="edge144" class="edge">
<title>section_11&#45;&gt;prose_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11218.0822,-2466.9049C11226.1929,-2456.5052 11236.4429,-2443.0052 11245,-2430.604 11253.8135,-2417.8313 11263.0235,-2403.2245 11270.4766,-2391.0414"/>
<polygon fill="#000000" stroke="#000000" points="11273.6046,-2392.6331 11275.798,-2382.2678 11267.6195,-2389.003 11273.6046,-2392.6331"/>
</g>
<!-- prose_145 -->
<g id="node146" class="node">
<title>prose_145</title>
<ellipse fill="none" stroke="#000000" cx="11368" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11368" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_145 -->
<g id="edge145" class="edge">
<title>section_11&#45;&gt;prose_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11252.7315,-2470.7896C11277.008,-2462.1342 11305.654,-2449.061 11327,-2430.604 11339.2625,-2420.0011 11349.0762,-2404.8132 11356.0243,-2391.721"/>
<polygon fill="#000000" stroke="#000000" points="11359.2172,-2393.1617 11360.5711,-2382.6538 11352.9598,-2390.0239 11359.2172,-2393.1617"/>
</g>
<!-- prose_146 -->
<g id="node147" class="node">
<title>prose_146</title>
<ellipse fill="none" stroke="#000000" cx="11450" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11450" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_146 -->
<g id="edge146" class="edge">
<title>section_11&#45;&gt;prose_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11264.5801,-2473.7717C11316.4067,-2463.5913 11386.1458,-2447.4388 11409,-2430.604 11422.2261,-2420.8615 11432.1731,-2405.4536 11438.9552,-2392.018"/>
<polygon fill="#000000" stroke="#000000" points="11442.2519,-2393.2318 11443.3359,-2382.6926 11435.9162,-2390.2555 11442.2519,-2393.2318"/>
</g>
<!-- codeblock_147 -->
<g id="node148" class="node">
<title>codeblock_147</title>
<ellipse fill="none" stroke="#000000" cx="11681" cy="-2365.0039" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11681" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 390&#45;427</text>
</g>
<!-- section_11&#45;&gt;codeblock_147 -->
<g id="edge147" class="edge">
<title>section_11&#45;&gt;codeblock_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11268.7207,-2475.2043C11327.288,-2466.0433 11415.6519,-2450.5848 11491,-2430.604 11539.149,-2417.8358 11592.676,-2398.9108 11630.6134,-2384.6647"/>
<polygon fill="#000000" stroke="#000000" points="11632.28,-2387.7764 11640.3954,-2380.9653 11629.8038,-2381.2289 11632.28,-2387.7764"/>
</g>
<!-- header_168 -->
<g id="node169" class="node">
<title>header_168</title>
<ellipse fill="none" stroke="#000000" cx="12782" cy="-2365.0039" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="12782" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_168 -->
<g id="edge168" class="edge">
<title>section_12&#45;&gt;header_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12999.8916,-2468.7208C12975.9965,-2458.1202 12944.0197,-2443.7628 12916,-2430.604 12885.2005,-2416.1398 12850.725,-2399.2461 12824.4566,-2386.2251"/>
<polygon fill="#000000" stroke="#000000" points="12825.6853,-2382.9275 12815.172,-2381.6147 12822.572,-2389.1971 12825.6853,-2382.9275"/>
</g>
<!-- prose_169 -->
<g id="node170" class="node">
<title>prose_169</title>
<ellipse fill="none" stroke="#000000" cx="12957" cy="-2365.0039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12957" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_169 -->
<g id="edge169" class="edge">
<title>section_12&#45;&gt;prose_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13024.1729,-2466.6987C13010.8731,-2446.5637 12989.1618,-2413.6944 12974.0351,-2390.7938"/>
<polygon fill="#000000" stroke="#000000" points="12976.8263,-2388.6691 12968.3944,-2382.2541 12970.9855,-2392.5272 12976.8263,-2388.6691"/>
</g>
<!-- codeblock_170 -->
<g id="node171" class="node">
<title>codeblock_170</title>
<ellipse fill="none" stroke="#000000" cx="13106" cy="-2365.0039" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13106" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 432&#45;445</text>
</g>
<!-- section_12&#45;&gt;codeblock_170 -->
<g id="edge170" class="edge">
<title>section_12&#45;&gt;codeblock_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13046.4797,-2466.6987C13058.0781,-2446.8819 13076.8961,-2414.7301 13090.2659,-2391.8868"/>
<polygon fill="#000000" stroke="#000000" points="13093.418,-2393.4301 13095.4487,-2383.0317 13087.3767,-2389.8942 13093.418,-2393.4301"/>
</g>
<!-- section_171 -->
<g id="node172" class="node">
<title>section_171</title>
<ellipse fill="none" stroke="#000000" cx="13550" cy="-2365.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13550" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 448&#45;481</text>
</g>
<!-- section_12&#45;&gt;section_171 -->
<g id="edge171" class="edge">
<title>section_12&#45;&gt;section_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13090.0355,-2472.0308C13185.5721,-2449.8008 13383.8455,-2403.6656 13486.0355,-2379.8875"/>
<polygon fill="#000000" stroke="#000000" points="13486.9706,-2383.2635 13495.9172,-2377.5882 13485.3842,-2376.4456 13486.9706,-2383.2635"/>
</g>
<!-- section_172 -->
<g id="node173" class="node">
<title>section_172</title>
<ellipse fill="none" stroke="#000000" cx="14484" cy="-2365.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14484" y="-2360.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 482&#45;515</text>
</g>
<!-- section_12&#45;&gt;section_172 -->
<g id="edge172" class="edge">
<title>section_12&#45;&gt;section_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13107.8065,-2478.673C13351.3619,-2458.5561 14145.1454,-2392.9922 14402.5878,-2371.7283"/>
<polygon fill="#000000" stroke="#000000" points="14402.9381,-2375.2114 14412.6161,-2370.9 14402.3619,-2368.2351 14402.9381,-2375.2114"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2017.2044 0,-2017.2044 0,-1945.4021 324,-1945.4021 324,-2017.2044"/>
<text text-anchor="middle" x="162" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1509.2631,-2347.0265C1504.1163,-2331.4527 1494.2259,-2309.8317 1477,-2299.4038 1368.2075,-2233.5447 442.8129,-2327.547 333,-2263.4038 243.8629,-2211.3376 195.4749,-2092.7406 174.643,-2027.1117"/>
<polygon fill="#000000" stroke="#000000" points="177.9499,-2025.9584 171.6508,-2017.4395 171.2626,-2028.0272 177.9499,-2025.9584"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2008.6037 342.5,-2008.6037 342.5,-1954.0028 897.5,-1954.0028 897.5,-2008.6037"/>
<text text-anchor="middle" x="620" y="-1977.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1962.1033" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1581.4695,-2347.1408C1576.5146,-2331.644 1566.9248,-2310.0717 1550,-2299.4038 1428.9306,-2223.0923 1037.8862,-2321.2833 907,-2263.4038 785.5562,-2209.6998 686.2455,-2080.2461 643.1426,-2017.1208"/>
<polygon fill="#000000" stroke="#000000" points="645.933,-2014.9988 637.4372,-2008.6686 640.1311,-2018.9152 645.933,-2014.9988"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2008.6037 916,-2008.6037 916,-1954.0028 1464,-1954.0028 1464,-2008.6037"/>
<text text-anchor="middle" x="1190" y="-1977.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1962.1033" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1652.7687,-2347.2607C1647.4348,-2332.278 1637.6842,-2311.4009 1622,-2299.4038 1567.8877,-2258.0124 1532.4435,-2296.6881 1473,-2263.4038 1359.1128,-2199.6346 1259.7632,-2077.2192 1215.1004,-2016.8092"/>
<polygon fill="#000000" stroke="#000000" points="1217.8991,-2014.707 1209.1654,-2008.7092 1212.2526,-2018.8443 1217.8991,-2014.707"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2016.6036 1482,-2016.6036 1482,-1946.0029 2030,-1946.0029 2030,-2016.6036"/>
<text text-anchor="middle" x="1756" y="-1985.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1970.1033" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.2192,-2347.0119C1735.0887,-2289.9065 1747.1752,-2111.537 1752.9147,-2026.8347"/>
<polygon fill="#000000" stroke="#000000" points="1756.4146,-2026.9543 1753.5987,-2016.7406 1749.4306,-2026.481 1756.4146,-2026.9543"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-1999.3033 2048,-1999.3033 2048,-1963.3033 2162,-1963.3033 2162,-1999.3033"/>
<text text-anchor="middle" x="2105" y="-1977.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2335.8279,-2347.3155C2320.8942,-2332.7754 2298.0823,-2312.5052 2275,-2299.4038 2232.4615,-2275.259 2203.7529,-2299.732 2171,-2263.4038 2105.481,-2190.7327 2101.4258,-2065.6122 2103.2559,-2009.7161"/>
<polygon fill="#000000" stroke="#000000" points="2106.7623,-2009.6336 2103.6839,-1999.4959 2099.7684,-2009.3406 2106.7623,-2009.6336"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2465.6617,-2347.3315C2459.2854,-2332.1816 2447.9512,-2311.0181 2431,-2299.4038 2360.8192,-2251.3185 2301.2543,-2325.4035 2243,-2263.4038 2176.9366,-2193.093 2190.7515,-2065.7576 2200.9924,-2009.4177"/>
<polygon fill="#000000" stroke="#000000" points="2204.4591,-2009.9237 2202.9056,-1999.4434 2197.5844,-2008.605 2204.4591,-2009.9237"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-1981.3033" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2575.1932,-2347.5377C2559.758,-2333.1333 2536.2962,-2312.9373 2513,-2299.4038 2474.317,-2276.9315 2449.6157,-2296.0237 2419,-2263.4038 2350.7009,-2190.6336 2335.3873,-2065.5646 2331.9711,-2009.6989"/>
<polygon fill="#000000" stroke="#000000" points="2335.4543,-2009.287 2331.4343,-1999.4845 2328.464,-2009.6544 2335.4543,-2009.287"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2571.4018,-2347.6701C2550.0218,-2329.2 2518.2078,-2297.9113 2502,-2263.4038 2461.7119,-2177.6278 2458.1886,-2062.4354 2458.9766,-2009.7515"/>
<polygon fill="#000000" stroke="#000000" points="2462.4813,-2009.5645 2459.1985,-1999.4912 2455.483,-2009.4131 2462.4813,-2009.5645"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-1981.3033" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;139</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2346.7554C2593,-2285.1484 2593,-2084.5441 2593,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2009.6635 2593,-1999.6635 2589.5001,-2009.6636 2596.5001,-2009.6635"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-1981.3033" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.2139,-2346.7952C2892.6706,-2326.5749 2878.7441,-2292.8921 2868,-2263.4038 2834.3428,-2171.0282 2799.7366,-2059.5982 2784.3028,-2008.866"/>
<polygon fill="#000000" stroke="#000000" points="2787.6445,-2007.8246 2781.3925,-1999.271 2780.9458,-2009.8564 2787.6445,-2007.8246"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2346.7554C2909,-2285.1484 2909,-2084.5441 2909,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-2009.6635 2909,-1999.6635 2905.5001,-2009.6636 2912.5001,-2009.6635"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2917.7551,-2347.102C2927.1467,-2327.1504 2941.8121,-2293.7015 2950,-2263.4038 2974.5903,-2172.412 2985.2847,-2060.6733 2989.1491,-2009.4188"/>
<polygon fill="#000000" stroke="#000000" points="2992.641,-2009.6557 2989.8725,-1999.4289 2985.6593,-2009.15 2992.641,-2009.6557"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3212" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3212" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;218</text>
</g>
<!-- section_27&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2934.0621,-2347.9093C2960.403,-2329.1637 3002.09,-2297.2207 3032,-2263.4038 3106.4615,-2179.2159 3171.1766,-2061.1671 3198.3525,-2008.5129"/>
<polygon fill="#000000" stroke="#000000" points="3201.5428,-2009.9615 3202.9838,-1999.4651 3195.3117,-2006.7719 3201.5428,-2009.9615"/>
</g>
<!-- header_50 -->
<g id="node51" class="node">
<title>header_50</title>
<ellipse fill="none" stroke="#000000" cx="3722" cy="-1981.3033" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3722" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_50 -->
<g id="edge50" class="edge">
<title>section_28&#45;&gt;header_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3951.6993,-2347.0119C3912.9679,-2285.3469 3785.4225,-2082.2794 3739.0482,-2008.446"/>
<polygon fill="#000000" stroke="#000000" points="3741.8394,-2006.3095 3733.5567,-1999.7029 3735.9117,-2010.0327 3741.8394,-2006.3095"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3963" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_28&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963,-2346.7554C3963,-2285.1484 3963,-2084.5441 3963,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="3966.5001,-2009.6635 3963,-1999.6635 3959.5001,-2009.6636 3966.5001,-2009.6635"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4045" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4045" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_28&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3971.7551,-2347.102C3981.1467,-2327.1504 3995.8121,-2293.7015 4004,-2263.4038 4028.5903,-2172.412 4039.2847,-2060.6733 4043.1491,-2009.4188"/>
<polygon fill="#000000" stroke="#000000" points="4046.641,-2009.6557 4043.8725,-1999.4289 4039.6593,-2009.15 4046.641,-2009.6557"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="4183" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4183" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;229</text>
</g>
<!-- section_28&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_28&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3991.2725,-2348.2257C4019.0279,-2330.4136 4060.7664,-2299.8334 4086,-2263.4038 4142.8336,-2181.3534 4169.0699,-2062.9636 4178.5676,-2009.45"/>
<polygon fill="#000000" stroke="#000000" points="4182.0596,-2009.7938 4180.2968,-1999.3467 4175.1599,-2008.6129 4182.0596,-2009.7938"/>
</g>
<!-- header_60 -->
<g id="node61" class="node">
<title>header_60</title>
<ellipse fill="none" stroke="#000000" cx="4594" cy="-1981.3033" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4594" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_60 -->
<g id="edge60" class="edge">
<title>section_29&#45;&gt;header_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4812.8433,-2348.1267C4785.5671,-2330.0204 4743.8366,-2299.0167 4717,-2263.4038 4654.9017,-2180.9975 4616.496,-2062.3784 4601.3766,-2009.0823"/>
<polygon fill="#000000" stroke="#000000" points="4604.7143,-2008.0208 4598.663,-1999.3241 4597.9702,-2009.8963 4604.7143,-2008.0208"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4758" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4758" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_29&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4831.2449,-2347.102C4821.8533,-2327.1504 4807.1879,-2293.7015 4799,-2263.4038 4774.4097,-2172.412 4763.7153,-2060.6733 4759.8509,-2009.4188"/>
<polygon fill="#000000" stroke="#000000" points="4763.3407,-2009.15 4759.1275,-1999.4289 4756.359,-2009.6557 4763.3407,-2009.15"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="4840" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4840" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_29&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4840,-2346.7554C4840,-2285.1484 4840,-2084.5441 4840,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="4843.5001,-2009.6635 4840,-1999.6635 4836.5001,-2009.6636 4843.5001,-2009.6635"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5466" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5466" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_29&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4867.7062,-2348.0217C4970.2503,-2285.1682 5327.8407,-2065.9867 5435.2567,-2000.1471"/>
<polygon fill="#000000" stroke="#000000" points="5437.3019,-2002.9987 5443.9987,-1994.7887 5433.6438,-1997.0306 5437.3019,-2002.9987"/>
</g>
<!-- prose_64 -->
<g id="node65" class="node">
<title>prose_64</title>
<ellipse fill="none" stroke="#000000" cx="5694" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5694" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_64 -->
<g id="edge64" class="edge">
<title>section_29&#45;&gt;prose_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4913.8787,-2361.2305C5066.3244,-2352.2588 5409.634,-2325.5776 5507,-2263.4038 5604.875,-2200.9049 5663.0807,-2066.7747 5684.534,-2008.862"/>
<polygon fill="#000000" stroke="#000000" points="5687.8874,-2009.881 5688.0014,-1999.2868 5681.3056,-2007.4975 5687.8874,-2009.881"/>
</g>
<!-- codeblock_65 -->
<g id="node66" class="node">
<title>codeblock_65</title>
<ellipse fill="none" stroke="#000000" cx="5985" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5985" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;279</text>
</g>
<!-- section_29&#45;&gt;codeblock_65 -->
<g id="edge65" class="edge">
<title>section_29&#45;&gt;codeblock_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4915.4759,-2363.3154C5104.4132,-2358.0094 5592.7756,-2337.3289 5735,-2263.4038 5850.5062,-2203.3662 5937.4565,-2066.2976 5970.4857,-2008.164"/>
<polygon fill="#000000" stroke="#000000" points="5973.6643,-2009.6511 5975.4962,-1999.2158 5967.5566,-2006.2311 5973.6643,-2009.6511"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1882,-912.6029 1544,-912.6029 1544,-856.7999 1882,-856.7999 1882,-912.6029"/>
<text text-anchor="middle" x="1713" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.2563,-1963.2928C2221.8797,-1913.3547 2243.7571,-1772.0285 2171,-1699.2027 2082.322,-1610.4411 1983.913,-1747.5212 1891,-1663.2027 1670.0544,-1462.6948 1694.7899,-1049.1619 1708.2864,-922.4418"/>
<polygon fill="#000000" stroke="#000000" points="1711.7714,-922.77 1709.3923,-912.4457 1704.8138,-922.0002 1711.7714,-922.77"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2042,-902.7014 1900,-902.7014 1900,-866.7014 2042,-866.7014 2042,-902.7014"/>
<text text-anchor="middle" x="1971" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.2909,-1963.113C2331.0355,-1912.7086 2322.9315,-1770.2873 2243,-1699.2027 2178.1235,-1641.5069 2109.7931,-1727.0866 2051,-1663.2027 1848.0014,-1442.6272 1935.4878,-1024.0011 1963.5354,-912.542"/>
<polygon fill="#000000" stroke="#000000" points="1966.9573,-913.2877 1966.0523,-902.7315 1960.1769,-911.548 1966.9573,-913.2877"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2087" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2087" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2463.9125,-1963.2189C2473.587,-1913.089 2492.8096,-1771.3122 2419,-1699.2027 2324.2054,-1606.5915 2213.139,-1760.3512 2123,-1663.2027 2019.9424,-1552.1311 2069.6575,-1039.5187 2083.7102,-912.9927"/>
<polygon fill="#000000" stroke="#000000" points="2087.2019,-913.262 2084.8434,-902.933 2080.2459,-912.4783 2087.2019,-913.262"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2680,-1663.2041 2132,-1663.2041 2132,-106.1988 2680,-106.1988 2680,-1663.2041"/>
<text text-anchor="middle" x="2406" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2406" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2406" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2406" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2406" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2406" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2406" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2406" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2406" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2406" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2406" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2406" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2406" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2406" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2406" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2406" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2406" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2406" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2406" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2406" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2406" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2406" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2406" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2406" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2406" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2406" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2406" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2406" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2406" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2406" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2406" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2406" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2406" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2406" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2406" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2406" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2406" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2406" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2406" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2406" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2406" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2406" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2406" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2406" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2406" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2406" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2406" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2406" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2406" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2406" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.9103,-1963.1846C2582.7236,-1921.0408 2563.7175,-1809.5855 2540.507,-1673.4751"/>
<polygon fill="#000000" stroke="#000000" points="2543.888,-1672.4803 2538.7567,-1663.2109 2536.9876,-1673.657 2543.888,-1672.4803"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2114,-53.1 2060,-53.1 2060,-17.1 2114,-17.1 2114,-53.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2087,-866.5632C2087,-758.2631 2087,-197.2221 2087,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2090.5001,-63.4293 2087,-53.4293 2083.5001,-63.4293 2090.5001,-63.4293"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="2854,-902.7014 2698,-902.7014 2698,-866.7014 2854,-866.7014 2854,-902.7014"/>
<text text-anchor="middle" x="2776" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>header_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776,-1963.1846C2776,-1835.505 2776,-1071.6417 2776,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="2779.5001,-913.0583 2776,-903.0584 2772.5001,-913.0584 2779.5001,-913.0583"/>
</g>
<!-- raw_45 -->
<g id="node46" class="node">
<title>raw_45</title>
<ellipse fill="none" stroke="#000000" cx="2899" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2899" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;raw_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.8348,-1963.1846C2907.6705,-1835.505 2900.7047,-1071.6417 2899.2616,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="2902.7585,-913.026 2899.1674,-903.0584 2895.7588,-913.0899 2902.7585,-913.026"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_42&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.6695,-1963.1846C2988.3409,-1835.505 2974.4094,-1071.6417 2971.5232,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="2975.0167,-912.9928 2971.3348,-903.0584 2968.0178,-913.1206 2975.0167,-912.9928"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="3571.5,-1412.5035 3016.5,-1412.5035 3016.5,-356.8993 3571.5,-356.8993 3571.5,-1412.5035"/>
<text text-anchor="middle" x="3294" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3294" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3294" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3294" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3294" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3294" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3294" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3294" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3294" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3294" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3294" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3294" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3294" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3294" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3294" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3294" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3294" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3294" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3294" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3294" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3294" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3294" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3294" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3294" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3294" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3294" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3294" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3294" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3294" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3294" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3294" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3294" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3294" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3294" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3294" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3294" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3294" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3294" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3294" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3294" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3294" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3294" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3294" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3294" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3294" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3294" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3294" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3294" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3294" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3294" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3294" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_43&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3213.3548,-1963.1846C3218.3176,-1896.8166 3236.1339,-1658.5561 3253.7622,-1422.809"/>
<polygon fill="#000000" stroke="#000000" points="3257.2662,-1422.8858 3254.5217,-1412.6526 3250.2857,-1422.3637 3257.2662,-1422.8858"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2677,-63.0015 2157,-63.0015 2157,-7.1986 2677,-7.1986 2677,-63.0015"/>
<text text-anchor="middle" x="2417" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>raw_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.093,-866.5278C2912.8891,-760.4937 2966.925,-222.4545 2863,-106.2001 2854.7496,-96.9708 2746.0706,-79.5409 2638.0717,-64.2491"/>
<polygon fill="#000000" stroke="#000000" points="2638.3528,-60.7542 2627.9621,-62.8235 2637.3754,-67.6856 2638.3528,-60.7542"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3194.5,-62.4005 2695.5,-62.4005 2695.5,-7.7996 3194.5,-7.7996 3194.5,-62.4005"/>
<text text-anchor="middle" x="2945" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2945" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2970.4449,-866.5632C2967.2032,-760.635 2950.7067,-221.5794 2946.1611,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2949.647,-72.525 2945.8427,-62.6367 2942.6503,-72.7391 2949.647,-72.525"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="3920.5,-902.7014 3589.5,-902.7014 3589.5,-866.7014 3920.5,-866.7014 3920.5,-902.7014"/>
<text text-anchor="middle" x="3755" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_50&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_50&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3722.5452,-1963.1846C3726.3875,-1835.505 3749.3744,-1071.6417 3754.1367,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="3757.6451,-913.1591 3754.4476,-903.0584 3750.6483,-912.9485 3757.6451,-913.1591"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="3966" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3966" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_51&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963.0496,-1963.1846C3963.3989,-1835.505 3965.4886,-1071.6417 3965.9215,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="3969.4223,-913.0679 3965.9498,-903.0584 3962.4223,-913.0487 3969.4223,-913.0679"/>
</g>
<!-- raw_57 -->
<g id="node58" class="node">
<title>raw_57</title>
<ellipse fill="none" stroke="#000000" cx="4040" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4040" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;raw_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4044.9174,-1963.1846C4044.3352,-1835.505 4040.8524,-1071.6417 4040.1308,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="4043.6294,-913.0423 4040.0837,-903.0584 4036.6294,-913.0742 4043.6294,-913.0423"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4210,-902.7014 4156,-902.7014 4156,-866.7014 4210,-866.7014 4210,-902.7014"/>
</g>
<!-- codeblock_53&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>codeblock_53&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4183,-1963.1846C4183,-1835.505 4183,-1071.6417 4183,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="4186.5001,-913.0583 4183,-903.0584 4179.5001,-913.0584 4186.5001,-913.0583"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3579,-63.0015 3213,-63.0015 3213,-7.1986 3579,-7.1986 3579,-63.0015"/>
<text text-anchor="middle" x="3396" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_55&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>raw_55&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.158,-866.4429C3980.3209,-759.9257 4036.0427,-219.6034 3929,-106.2001 3876.6957,-50.7878 3663.4211,-81.0594 3588,-70.2001 3575.9584,-68.4663 3563.518,-66.5285 3551.0275,-64.4779"/>
<polygon fill="#000000" stroke="#000000" points="3551.4451,-60.9994 3541.0063,-62.811 3550.2964,-67.9045 3551.4451,-60.9994"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="3942.5,-55.0021 3597.5,-55.0021 3597.5,-15.198 3942.5,-15.198 3942.5,-55.0021"/>
<text text-anchor="middle" x="3770" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_57&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>raw_57&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4045.7198,-866.9385C4074.0949,-775.1152 4191.0126,-349.1899 4002,-106.2001 3986.5094,-86.2857 3934.7245,-69.4415 3884.0003,-57.1541"/>
<polygon fill="#000000" stroke="#000000" points="3884.7537,-53.7358 3874.2161,-54.8355 3883.1396,-60.5471 3884.7537,-53.7358"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4703.5,-902.7014 4484.5,-902.7014 4484.5,-866.7014 4703.5,-866.7014 4703.5,-902.7014"/>
<text text-anchor="middle" x="4594" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>header_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4594,-1963.1846C4594,-1835.505 4594,-1071.6417 4594,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="4597.5001,-913.0583 4594,-903.0584 4590.5001,-913.0584 4597.5001,-913.0583"/>
</g>
<!-- raw_67 -->
<g id="node68" class="node">
<title>raw_67</title>
<ellipse fill="none" stroke="#000000" cx="4753" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4753" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_67 -->
<g id="edge67" class="edge">
<title>prose_61&#45;&gt;raw_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4757.9174,-1963.1846C4757.3352,-1835.505 4753.8524,-1071.6417 4753.1308,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="4756.6294,-913.0423 4753.0837,-903.0584 4749.6294,-913.0742 4756.6294,-913.0423"/>
</g>
<!-- raw_69 -->
<g id="node70" class="node">
<title>raw_69</title>
<ellipse fill="none" stroke="#000000" cx="4832" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4832" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_69 -->
<g id="edge69" class="edge">
<title>prose_62&#45;&gt;raw_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4839.8678,-1963.1846C4838.9364,-1835.505 4833.3638,-1071.6417 4832.2093,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="4835.7069,-913.0325 4832.1339,-903.0584 4828.7071,-913.0837 4835.7069,-913.0325"/>
</g>
<!-- raw_71 -->
<g id="node72" class="node">
<title>raw_71</title>
<ellipse fill="none" stroke="#000000" cx="5143" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5143" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_71 -->
<g id="edge71" class="edge">
<title>prose_63&#45;&gt;raw_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5452.9343,-1964.5148C5418.1843,-1918.9445 5323.0059,-1787.9637 5277,-1663.2027 5173.7643,-1383.2431 5149.2166,-1016.8304 5144.1731,-913.1353"/>
<polygon fill="#000000" stroke="#000000" points="5147.6564,-912.6906 5143.6966,-902.8636 5140.6639,-913.015 5147.6564,-912.6906"/>
</g>
<!-- prespace_72 -->
<g id="node73" class="node">
<title>prespace_72</title>
<ellipse fill="none" stroke="#000000" cx="5332" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5332" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_72 -->
<g id="edge72" class="edge">
<title>prose_63&#45;&gt;prespace_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5460.427,-1963.2333C5445.8133,-1915.0369 5406.2589,-1779.194 5388,-1663.2027 5342.2562,-1372.612 5333.824,-1015.0344 5332.3175,-913.0492"/>
<polygon fill="#000000" stroke="#000000" points="5335.8157,-912.8857 5332.179,-902.9346 5328.8164,-912.9816 5335.8157,-912.8857"/>
</g>
<!-- literal_73 -->
<g id="node74" class="node">
<title>literal_73</title>
<ellipse fill="none" stroke="#000000" cx="5428" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5428" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_73 -->
<g id="edge73" class="edge">
<title>prose_63&#45;&gt;literal_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5465.3721,-1963.1846C5460.9477,-1835.505 5434.478,-1071.6417 5428.9941,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="5432.4804,-912.9311 5428.6361,-903.0584 5425.4846,-913.1736 5432.4804,-912.9311"/>
</g>
<!-- raw_74 -->
<g id="node75" class="node">
<title>raw_74</title>
<ellipse fill="none" stroke="#000000" cx="5504" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5504" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_74 -->
<g id="edge74" class="edge">
<title>prose_63&#45;&gt;raw_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5466.6279,-1963.1846C5471.0523,-1835.505 5497.522,-1071.6417 5503.0059,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="5506.5154,-913.1736 5503.3639,-903.0584 5499.5196,-912.9311 5506.5154,-913.1736"/>
</g>
<!-- prespace_75 -->
<g id="node76" class="node">
<title>prespace_75</title>
<ellipse fill="none" stroke="#000000" cx="5595" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5595" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_75 -->
<g id="edge75" class="edge">
<title>prose_63&#45;&gt;prespace_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5471.2735,-1963.2095C5485.1042,-1914.955 5522.5551,-1778.9823 5540,-1663.2027 5583.8248,-1372.3435 5592.8735,-1014.9528 5594.6117,-913.0305"/>
<polygon fill="#000000" stroke="#000000" points="5598.1129,-912.9773 5594.774,-902.9224 5591.1138,-912.8649 5598.1129,-912.9773"/>
</g>
<!-- literal_76 -->
<g id="node77" class="node">
<title>literal_76</title>
<ellipse fill="none" stroke="#000000" cx="5691" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5691" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_76 -->
<g id="edge76" class="edge">
<title>prose_63&#45;&gt;literal_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5479.5128,-1964.7176C5515.3119,-1919.6507 5612.424,-1789.8085 5650,-1663.2027 5733.785,-1380.9033 5704.7686,-1016.1279 5694.1695,-912.9772"/>
<polygon fill="#000000" stroke="#000000" points="5697.6215,-912.3374 5693.0906,-902.7603 5690.6602,-913.0726 5697.6215,-912.3374"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="5767" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5767" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_63&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5473.4727,-1963.6612C5494.761,-1915.2702 5560.2274,-1778.7682 5653,-1699.2027 5681.982,-1674.3467 5709.6848,-1694.8798 5731,-1663.2027 5815.4114,-1537.7568 5779.8704,-1037.9501 5769.4874,-913.0844"/>
<polygon fill="#000000" stroke="#000000" points="5772.95,-912.4935 5768.62,-902.8239 5765.9749,-913.0832 5772.95,-912.4935"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5839" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5839" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_64&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_64&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5701.967,-1963.8497C5723.08,-1916.6279 5780.3956,-1781.9122 5803,-1663.2027 5858.0041,-1374.3421 5845.5626,-1014.8599 5840.549,-912.8507"/>
<polygon fill="#000000" stroke="#000000" points="5844.0383,-912.5503 5840.0341,-902.7413 5837.0473,-912.9064 5844.0383,-912.5503"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6390,-1127.7024 5884,-1127.7024 5884,-641.7005 6390,-641.7005 6390,-1127.7024"/>
<text text-anchor="middle" x="6137" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6137" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6137" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6137" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6137" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6137" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6137" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6137" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6137" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6137" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6137" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6137" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6137" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6137" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6137" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6137" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6137" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6137" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6137" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_65&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>codeblock_65&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5987.5114,-1963.1846C6000.6054,-1868.7183 6061.9706,-1426.0001 6101.8945,-1137.9699"/>
<polygon fill="#000000" stroke="#000000" points="6105.3993,-1138.1757 6103.3055,-1127.7898 6098.4656,-1137.2145 6105.3993,-1138.1757"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="4235.5,-63.0015 3960.5,-63.0015 3960.5,-7.1986 4235.5,-7.1986 4235.5,-63.0015"/>
<text text-anchor="middle" x="4098" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_67&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>raw_67&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4755.0652,-866.7361C4766.826,-760.7481 4821.066,-217.9513 4712,-106.2001 4675.6503,-68.9555 4296.4136,-78.2685 4245,-70.2001 4235.3768,-68.6899 4225.4532,-66.8796 4215.5187,-64.8879"/>
<polygon fill="#000000" stroke="#000000" points="4216.0923,-61.4326 4205.5913,-62.8401 4214.6781,-68.2882 4216.0923,-61.4326"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="4816,-70.3004 4254,-70.3004 4254,.1003 4816,.1003 4816,-70.3004"/>
<text text-anchor="middle" x="4535" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4535" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4535" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_69&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>raw_69&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4837.6886,-866.832C4865.8873,-774.4774 4981.802,-346.3259 4789,-106.2001 4778.9107,-93.6344 4755.1698,-82.6038 4726.0465,-73.214"/>
<polygon fill="#000000" stroke="#000000" points="4727.0003,-69.8454 4716.4122,-70.2232 4724.9249,-76.5307 4727.0003,-69.8454"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5354,-62.4005 4834,-62.4005 4834,-7.7996 5354,-7.7996 5354,-62.4005"/>
<text text-anchor="middle" x="5094" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5094" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5141.9539,-866.5632C5135.8446,-760.635 5104.755,-221.5794 5096.1882,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="5099.6582,-72.4186 5095.5882,-62.6367 5092.6698,-72.8217 5099.6582,-72.4186"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5426,-53.1 5372,-53.1 5372,-17.1 5426,-17.1 5426,-53.1"/>
<text text-anchor="middle" x="5399" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>prespace_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5332.7569,-866.5464C5336.4407,-780.9458 5353.7264,-409.1554 5388,-106.2001 5389.6016,-92.0433 5391.9597,-76.387 5394.0822,-63.3778"/>
<polygon fill="#000000" stroke="#000000" points="5397.5929,-63.6037 5395.788,-53.1637 5390.6885,-62.4506 5397.5929,-63.6037"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5509.5,-53.1 5444.5,-53.1 5444.5,-17.1 5509.5,-17.1 5509.5,-53.1"/>
<text text-anchor="middle" x="5477" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>literal_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5428.432,-866.5619C5430.5738,-781.0313 5441.049,-409.5083 5468,-106.2001 5469.2561,-92.0638 5471.1796,-76.4098 5472.9263,-63.3967"/>
<polygon fill="#000000" stroke="#000000" points="5476.4365,-63.5623 5474.3335,-53.1783 5469.5019,-62.6073 5476.4365,-63.5623"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5796,-54.4006 5528,-54.4006 5528,-15.7995 5796,-15.7995 5796,-54.4006"/>
<text text-anchor="middle" x="5662" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5662" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>raw_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5502.5697,-866.7002C5494.6419,-762.7666 5459.2925,-239.4258 5540,-106.2001 5552.6148,-85.3766 5573.8026,-70.0093 5595.0134,-58.9987"/>
<polygon fill="#000000" stroke="#000000" points="5596.6488,-62.0949 5604.0802,-54.5434 5593.5617,-55.8124 5596.6488,-62.0949"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5868,-53.1 5814,-53.1 5814,-17.1 5868,-17.1 5868,-53.1"/>
<text text-anchor="middle" x="5841" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>prespace_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5593.5385,-866.6033C5585.4039,-760.9991 5549.6202,-224.9911 5651,-106.2001 5696.6294,-52.7342 5743.3552,-103.9723 5805,-70.2001 5809.8804,-67.5264 5814.5625,-64.0077 5818.8426,-60.2306"/>
<polygon fill="#000000" stroke="#000000" points="5821.288,-62.7347 5826.0683,-53.2795 5816.4351,-57.69 5821.288,-62.7347"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="5944,-53.1 5886,-53.1 5886,-17.1 5944,-17.1 5944,-53.1"/>
<text text-anchor="middle" x="5915" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>literal_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5689.1556,-866.6474C5678.7883,-761.2947 5631.6944,-226.4751 5731,-106.2001 5773.5511,-54.6639 5818.15,-101.8741 5877,-70.2001 5882.0415,-67.4867 5886.9286,-63.948 5891.4255,-60.1634"/>
<polygon fill="#000000" stroke="#000000" points="5894.0184,-62.5356 5899.0477,-53.2106 5889.301,-57.364 5894.0184,-62.5356"/>
</g>
<!-- leaf_84 -->
<g id="node85" class="node">
<title>leaf_84</title>
<polygon fill="none" stroke="#c0c0c0" points="6048,-53.1 5962,-53.1 5962,-17.1 6048,-17.1 6048,-53.1"/>
<text text-anchor="middle" x="6005" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_77&#45;&gt;leaf_84 -->
<g id="edge84" class="edge">
<title>raw_77&#45;&gt;leaf_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5765.0433,-866.6449C5754.0231,-761.278 5703.6542,-226.3913 5803,-106.2001 5846.6795,-53.3555 5890.2501,-97.8206 5953,-70.2001 5959.9222,-67.1532 5966.9149,-63.1768 5973.4307,-58.9993"/>
<polygon fill="#000000" stroke="#000000" points="5975.6313,-61.737 5981.9687,-53.2466 5971.7198,-55.9318 5975.6313,-61.737"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6600,-62.4005 6066,-62.4005 6066,-7.7996 6600,-7.7996 6600,-62.4005"/>
<text text-anchor="middle" x="6333" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6333" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_85&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>raw_85&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5836.8999,-866.5214C5825.0637,-760.4515 5770.8382,-222.2425 5875,-106.2001 5883.5356,-96.6909 5996.3899,-79.1101 6107.9239,-63.8105"/>
<polygon fill="#000000" stroke="#000000" points="6108.5818,-67.2532 6118.016,-62.4318 6107.6343,-60.3177 6108.5818,-67.2532"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="7072.5,-1999.3033 6881.5,-1999.3033 6881.5,-1963.3033 7072.5,-1963.3033 7072.5,-1999.3033"/>
<text text-anchor="middle" x="6977" y="-1977.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_88&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>header_88&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6977,-2346.7554C6977,-2285.1484 6977,-2084.5441 6977,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="6980.5001,-2009.6635 6977,-1999.6635 6973.5001,-2009.6636 6980.5001,-2009.6635"/>
</g>
<!-- raw_94 -->
<g id="node95" class="node">
<title>raw_94</title>
<ellipse fill="none" stroke="#000000" cx="7127" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="7127" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_94 -->
<g id="edge94" class="edge">
<title>prose_89&#45;&gt;raw_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7134.6195,-2346.7554C7133.335,-2285.1484 7129.1525,-2084.5441 7127.5932,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="7131.0906,-2009.5884 7127.3828,-1999.6635 7124.0921,-2009.7344 7131.0906,-2009.5884"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="7217" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_90&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-2346.7554C7217,-2285.1484 7217,-2084.5441 7217,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-2009.6635 7217,-1999.6635 7213.5001,-2009.6636 7220.5001,-2009.6635"/>
</g>
<!-- header_98 -->
<g id="node99" class="node">
<title>header_98</title>
<ellipse fill="none" stroke="#000000" cx="7655" cy="-1981.3033" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7655" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_91&#45;&gt;header_98 -->
<g id="edge98" class="edge">
<title>section_91&#45;&gt;header_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7796.6444,-2347.0569C7788.3625,-2326.7853 7774.553,-2292.7891 7763,-2263.4038 7726.4686,-2170.4856 7684.5415,-2059.7501 7665.4485,-2009.0886"/>
<polygon fill="#000000" stroke="#000000" points="7668.6368,-2007.6234 7661.8367,-1999.4987 7662.086,-2010.0906 7668.6368,-2007.6234"/>
</g>
<!-- prose_99 -->
<g id="node100" class="node">
<title>prose_99</title>
<ellipse fill="none" stroke="#000000" cx="7804" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7804" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_99 -->
<g id="edge99" class="edge">
<title>section_91&#45;&gt;prose_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7804,-2346.7554C7804,-2285.1484 7804,-2084.5441 7804,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="7807.5001,-2009.6635 7804,-1999.6635 7800.5001,-2009.6636 7807.5001,-2009.6635"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8191" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_91&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7821.8897,-2347.2668C7884.9982,-2284.6963 8097.2195,-2074.2842 8167.8884,-2004.2179"/>
<polygon fill="#000000" stroke="#000000" points="8170.3984,-2006.6579 8175.0354,-1997.1317 8165.4699,-2001.687 8170.3984,-2006.6579"/>
</g>
<!-- codeblock_101 -->
<g id="node102" class="node">
<title>codeblock_101</title>
<ellipse fill="none" stroke="#000000" cx="8525" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8525" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 301&#45;315</text>
</g>
<!-- section_91&#45;&gt;codeblock_101 -->
<g id="edge101" class="edge">
<title>section_91&#45;&gt;codeblock_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7876.3113,-2359.5374C7964.9181,-2350.2944 8117.3783,-2325.986 8232,-2263.4038 8354.9538,-2196.2723 8463.3015,-2063.7737 8505.8419,-2007.5357"/>
<polygon fill="#000000" stroke="#000000" points="8508.9022,-2009.2882 8512.0964,-1999.1863 8503.2998,-2005.0913 8508.9022,-2009.2882"/>
</g>
<!-- header_124 -->
<g id="node125" class="node">
<title>header_124</title>
<ellipse fill="none" stroke="#000000" cx="9145" cy="-1981.3033" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9145" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_92&#45;&gt;header_124 -->
<g id="edge124" class="edge">
<title>section_92&#45;&gt;header_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9330.8563,-2347.0119C9299.5094,-2285.3307 9196.2627,-2082.1726 9158.7646,-2008.3878"/>
<polygon fill="#000000" stroke="#000000" points="9161.7747,-2006.5855 9154.1239,-1999.2564 9155.5344,-2009.7569 9161.7747,-2006.5855"/>
</g>
<!-- prose_125 -->
<g id="node126" class="node">
<title>prose_125</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9340" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_125 -->
<g id="edge125" class="edge">
<title>section_92&#45;&gt;prose_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340,-2346.7554C9340,-2285.1484 9340,-2084.5441 9340,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="9343.5001,-2009.6635 9340,-1999.6635 9336.5001,-2009.6636 9343.5001,-2009.6635"/>
</g>
<!-- prose_126 -->
<g id="node127" class="node">
<title>prose_126</title>
<ellipse fill="none" stroke="#000000" cx="9455" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9455" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_126 -->
<g id="edge126" class="edge">
<title>section_92&#45;&gt;prose_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9348.1159,-2346.9099C9356.948,-2326.79 9371.126,-2293.1947 9381,-2263.4038 9411.3385,-2171.8688 9437.4929,-2060.3951 9448.8972,-2009.312"/>
<polygon fill="#000000" stroke="#000000" points="9452.3568,-2009.8773 9451.1031,-1999.3569 9445.5225,-2008.3629 9452.3568,-2009.8773"/>
</g>
<!-- codeblock_127 -->
<g id="node128" class="node">
<title>codeblock_127</title>
<ellipse fill="none" stroke="#000000" cx="9712" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9712" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 327&#45;370</text>
</g>
<!-- section_92&#45;&gt;codeblock_127 -->
<g id="edge127" class="edge">
<title>section_92&#45;&gt;codeblock_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9371.811,-2348.5303C9405.0015,-2330.4167 9457.4743,-2299.1007 9496,-2263.4038 9583.9283,-2181.9317 9662.8316,-2061.5924 9695.7434,-2008.3429"/>
<polygon fill="#000000" stroke="#000000" points="9698.9222,-2009.8544 9701.1662,-1999.4999 9692.9548,-2006.195 9698.9222,-2009.8544"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6921.5,-920.0018 6408.5,-920.0018 6408.5,-849.4011 6921.5,-849.4011 6921.5,-920.0018"/>
<text text-anchor="middle" x="6665" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6665" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_94&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_94&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7130.1688,-1963.2407C7137.7277,-1913.7748 7151.2947,-1774.7805 7081,-1699.2027 7034.0129,-1648.6843 6981.0241,-1709.6402 6930,-1663.2027 6707.6834,-1460.8707 6671.8031,-1064.7546 6666.0702,-930.4746"/>
<polygon fill="#000000" stroke="#000000" points="6669.5547,-930.0063 6665.6677,-920.1503 6662.56,-930.2791 6669.5547,-930.0063"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="7494.5,-927.9017 6939.5,-927.9017 6939.5,-841.5011 7494.5,-841.5011 7494.5,-927.9017"/>
<text text-anchor="middle" x="7217" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7217" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7217" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-1963.1846C7217,-1841.2364 7217,-1138.9383 7217,-938.2491"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-937.9645 7217,-927.9645 7213.5001,-937.9645 7220.5001,-937.9645"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7619.5,-902.7014 7512.5,-902.7014 7512.5,-866.7014 7619.5,-866.7014 7619.5,-902.7014"/>
<text text-anchor="middle" x="7566" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_98&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>header_98&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7653.5,-1963.015C7649.5043,-1914.2843 7638.2753,-1777.2477 7629,-1663.2027 7605.1377,-1369.8013 7576.4419,-1014.18 7568.27,-912.8544"/>
<polygon fill="#000000" stroke="#000000" points="7571.7523,-912.4927 7567.4597,-902.8065 7564.775,-913.0555 7571.7523,-912.4927"/>
</g>
<!-- raw_103 -->
<g id="node104" class="node">
<title>raw_103</title>
<ellipse fill="none" stroke="#000000" cx="7665" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7665" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_103 -->
<g id="edge103" class="edge">
<title>prose_99&#45;&gt;raw_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7800.3747,-1963.2831C7790.8797,-1917.7806 7763.1423,-1795.0463 7722,-1699.2027 7714.6934,-1682.1815 7706.246,-1680.9676 7701,-1663.2027 7617.6287,-1380.8781 7649.9672,-1016.1203 7661.5543,-912.9755"/>
<polygon fill="#000000" stroke="#000000" points="7665.0637,-913.0942 7662.7316,-902.7592 7658.1097,-912.2927 7665.0637,-913.0942"/>
</g>
<!-- prespace_104 -->
<g id="node105" class="node">
<title>prespace_104</title>
<ellipse fill="none" stroke="#000000" cx="7756" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7756" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_104 -->
<g id="edge104" class="edge">
<title>prose_99&#45;&gt;prespace_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7803.2069,-1963.1846C7797.6182,-1835.505 7764.1827,-1071.6417 7757.2557,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="7760.7376,-912.8957 7756.8035,-903.0584 7753.7443,-913.2019 7760.7376,-912.8957"/>
</g>
<!-- literal_105 -->
<g id="node106" class="node">
<title>literal_105</title>
<ellipse fill="none" stroke="#000000" cx="7852" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7852" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_105 -->
<g id="edge105" class="edge">
<title>prose_99&#45;&gt;literal_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7804.7931,-1963.1846C7810.3818,-1835.505 7843.8173,-1071.6417 7850.7443,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="7854.2557,-913.2019 7851.1965,-903.0584 7847.2624,-912.8957 7854.2557,-913.2019"/>
</g>
<!-- raw_106 -->
<g id="node107" class="node">
<title>raw_106</title>
<ellipse fill="none" stroke="#000000" cx="7928" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7928" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_106 -->
<g id="edge106" class="edge">
<title>prose_99&#45;&gt;raw_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7810.5092,-1963.3296C7827.539,-1915.3689 7873.3764,-1780.0526 7892,-1663.2027 7938.2304,-1373.1392 7931.9416,-1015.1947 7928.9618,-913.0857"/>
<polygon fill="#000000" stroke="#000000" points="7932.4563,-912.8469 7928.652,-902.9586 7925.4595,-913.061 7932.4563,-912.8469"/>
</g>
<!-- prespace_111 -->
<g id="node112" class="node">
<title>prespace_111</title>
<ellipse fill="none" stroke="#000000" cx="8019" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8019" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_111 -->
<g id="edge111" class="edge">
<title>prose_100&#45;&gt;prespace_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8182.6751,-1963.8804C8160.5878,-1916.7349 8100.4542,-1782.1918 8075,-1663.2027 8013.3951,-1375.2223 8016.029,-1015.1258 8018.2304,-912.9109"/>
<polygon fill="#000000" stroke="#000000" points="8021.7324,-912.8595 8018.4661,-902.7807 8014.7343,-912.6966 8021.7324,-912.8595"/>
</g>
<!-- literal_112 -->
<g id="node113" class="node">
<title>literal_112</title>
<ellipse fill="none" stroke="#000000" cx="8115" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8115" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_112 -->
<g id="edge112" class="edge">
<title>prose_100&#45;&gt;literal_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8188.5372,-1963.0529C8182.0601,-1914.4152 8164.4021,-1777.5862 8155,-1663.2027 8130.9315,-1370.3922 8118.9189,-1014.3596 8115.8232,-912.8953"/>
<polygon fill="#000000" stroke="#000000" points="8119.3197,-912.7235 8115.5202,-902.8334 8112.3229,-912.9343 8119.3197,-912.7235"/>
</g>
<!-- raw_113 -->
<g id="node114" class="node">
<title>raw_113</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8191" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_113 -->
<g id="edge113" class="edge">
<title>prose_100&#45;&gt;raw_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191,-1963.1846C8191,-1835.505 8191,-1071.6417 8191,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="8194.5001,-913.0583 8191,-903.0584 8187.5001,-913.0584 8194.5001,-913.0583"/>
</g>
<!-- prespace_114 -->
<g id="node115" class="node">
<title>prespace_114</title>
<ellipse fill="none" stroke="#000000" cx="8282" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8282" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_114 -->
<g id="edge114" class="edge">
<title>prose_100&#45;&gt;prespace_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8193.3397,-1963.0422C8199.5156,-1914.3782 8216.5005,-1777.4907 8227,-1663.2027 8253.9092,-1370.2939 8274.7314,-1014.3297 8280.4394,-912.8885"/>
<polygon fill="#000000" stroke="#000000" points="8283.938,-913.009 8281.0027,-902.8289 8276.949,-912.6176 8283.938,-913.009"/>
</g>
<!-- literal_115 -->
<g id="node116" class="node">
<title>literal_115</title>
<ellipse fill="none" stroke="#000000" cx="8378" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8378" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_115 -->
<g id="edge115" class="edge">
<title>prose_100&#45;&gt;literal_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8201.6934,-1964.2261C8230.028,-1917.939 8306.9233,-1785.3372 8337,-1663.2027 8407.3343,-1377.5914 8387.7974,-1015.8415 8380.2905,-913.0731"/>
<polygon fill="#000000" stroke="#000000" points="8383.7645,-912.5957 8379.5228,-902.887 8376.7843,-913.1218 8383.7645,-912.5957"/>
</g>
<!-- raw_116 -->
<g id="node117" class="node">
<title>raw_116</title>
<ellipse fill="none" stroke="#000000" cx="8454" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8454" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_116 -->
<g id="edge116" class="edge">
<title>prose_100&#45;&gt;raw_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8207.4004,-1965.7031C8251.4273,-1922.6022 8371.9812,-1796.2483 8418,-1663.2027 8514.4318,-1384.4071 8472.7165,-1015.7964 8458.2223,-912.5948"/>
<polygon fill="#000000" stroke="#000000" points="8461.6803,-912.0514 8456.7931,-902.651 8454.7515,-913.0473 8461.6803,-912.0514"/>
</g>
<!-- leaf_123 -->
<g id="node124" class="node">
<title>leaf_123</title>
<polygon fill="none" stroke="#c0c0c0" points="8942.5,-981.6022 8499.5,-981.6022 8499.5,-787.8007 8942.5,-787.8007 8942.5,-981.6022"/>
<text text-anchor="middle" x="8721" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8721" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8721" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8721" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8721" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8721" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8721" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8721" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8721" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8721" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8721" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_101&#45;&gt;leaf_123 -->
<g id="edge123" class="edge">
<title>codeblock_101&#45;&gt;leaf_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8528.2384,-1963.1846C8548.3909,-1850.4336 8657.2155,-1241.5698 8701.8665,-991.7514"/>
<polygon fill="#000000" stroke="#000000" points="8705.3718,-992.032 8703.6859,-981.5721 8698.481,-990.8003 8705.3718,-992.032"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7401.5,-63.0015 7112.5,-63.0015 7112.5,-7.1986 7401.5,-7.1986 7401.5,-63.0015"/>
<text text-anchor="middle" x="7257" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>raw_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7667.0567,-866.5357C7678.6427,-760.5472 7731.6384,-222.7227 7628,-106.2001 7595.514,-69.6755 7458.962,-79.6356 7411,-70.2001 7402.594,-68.5464 7393.946,-66.7735 7385.2405,-64.9353"/>
<polygon fill="#000000" stroke="#000000" points="7385.9071,-61.4988 7375.3969,-62.8349 7384.4463,-68.3447 7385.9071,-61.4988"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7474,-53.1 7420,-53.1 7420,-17.1 7474,-17.1 7474,-53.1"/>
<text text-anchor="middle" x="7447" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>prespace_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7757.6018,-866.5035C7766.5384,-760.3313 7806.1596,-221.6392 7701,-106.2001 7634.8688,-33.6045 7570.6329,-114.5164 7483,-70.2001 7477.9367,-67.6396 7473.1238,-64.1165 7468.7605,-60.2847"/>
<polygon fill="#000000" stroke="#000000" points="7471.0551,-57.6347 7461.4352,-53.1953 7466.187,-62.6648 7471.0551,-57.6347"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="7546,-53.1 7492,-53.1 7492,-17.1 7546,-17.1 7546,-53.1"/>
<text text-anchor="middle" x="7519" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>literal_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7853.9977,-866.4902C7865.2347,-760.2426 7916.3911,-221.1942 7811,-106.2001 7733.3691,-21.4957 7658.1458,-120.8195 7555,-70.2001 7549.9064,-67.7004 7545.0786,-64.2072 7540.7099,-60.3862"/>
<polygon fill="#000000" stroke="#000000" points="7543.0044,-57.7362 7533.3839,-53.2982 7538.137,-62.767 7543.0044,-57.7362"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="7783.5,-54.4006 7564.5,-54.4006 7564.5,-15.7995 7783.5,-15.7995 7783.5,-54.4006"/>
<text text-anchor="middle" x="7674" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7674" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_106&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>raw_106&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7929.8451,-866.4177C7940.1076,-760.8946 7986.3746,-230.1203 7892,-106.2001 7887.3853,-100.1407 7810.3581,-75.9102 7749.1585,-57.4036"/>
<polygon fill="#000000" stroke="#000000" points="7750.0704,-54.023 7739.4857,-54.4862 7748.049,-60.7248 7750.0704,-54.023"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="7856,-53.1 7802,-53.1 7802,-17.1 7856,-17.1 7856,-53.1"/>
</g>
<!-- prespace_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>prespace_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8024.0908,-866.7515C8048.9892,-774.8733 8149.4286,-352.013 7964,-106.2001 7935.8048,-68.8232 7904.6487,-95.0996 7865,-70.2001 7860.4954,-67.3712 7856.0954,-63.9002 7852.0056,-60.2531"/>
<polygon fill="#000000" stroke="#000000" points="7854.222,-57.5297 7844.577,-53.1452 7849.3826,-62.5875 7854.222,-57.5297"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8037.5,-53.1 7874.5,-53.1 7874.5,-17.1 8037.5,-17.1 8037.5,-53.1"/>
<text text-anchor="middle" x="7956" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>literal_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116.2728,-866.7115C8123.2978,-762.8416 8154.1851,-239.7985 8074,-106.2001 8061.0762,-84.6674 8038.903,-68.8372 8017.242,-57.6541"/>
<polygon fill="#000000" stroke="#000000" points="8018.5394,-54.3925 8008.0185,-53.1427 8015.4637,-60.6806 8018.5394,-54.3925"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8400.5,-54.4006 8055.5,-54.4006 8055.5,-15.7995 8400.5,-15.7995 8400.5,-54.4006"/>
<text text-anchor="middle" x="8228" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8228" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>raw_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191.7899,-866.5632C8196.4958,-758.5056 8220.8303,-199.7321 8226.7169,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8230.2153,-64.6746 8227.1538,-54.5318 8223.2219,-64.37 8230.2153,-64.6746"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="8473,-53.1 8419,-53.1 8419,-17.1 8473,-17.1 8473,-53.1"/>
<text text-anchor="middle" x="8446" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>prespace_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8277.3644,-866.5557C8255.1962,-775.4379 8167.9041,-362.0821 8338,-106.2001 8357.5861,-76.7359 8380.0853,-90.5886 8409,-70.2001 8413.2332,-67.2152 8417.4637,-63.7616 8421.4719,-60.2093"/>
<polygon fill="#000000" stroke="#000000" points="8423.9057,-62.7256 8428.8477,-53.354 8419.1401,-57.5982 8423.9057,-62.7256"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="8545,-53.1 8491,-53.1 8491,-17.1 8545,-17.1 8545,-53.1"/>
<text text-anchor="middle" x="8518" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_115&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>literal_115&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8376.6413,-866.676C8369.1294,-762.6063 8335.9171,-238.6287 8418,-106.2001 8435.1936,-78.4608 8455.8732,-89.7571 8482,-70.2001 8485.9832,-67.2185 8489.9774,-63.8245 8493.7802,-60.3496"/>
<polygon fill="#000000" stroke="#000000" points="8496.4405,-62.6486 8501.2523,-53.2095 8491.6044,-57.5877 8496.4405,-62.6486"/>
</g>
<!-- leaf_122 -->
<g id="node123" class="node">
<title>leaf_122</title>
<polygon fill="none" stroke="#c0c0c0" points="8999,-54.4006 8563,-54.4006 8563,-15.7995 8999,-15.7995 8999,-54.4006"/>
<text text-anchor="middle" x="8781" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8781" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_116&#45;&gt;leaf_122 -->
<g id="edge122" class="edge">
<title>raw_116&#45;&gt;leaf_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8452.0506,-866.651C8441.0721,-761.3184 8390.9002,-226.5942 8490,-106.2001 8508.2778,-83.9948 8565.0792,-67.7053 8623.7052,-56.3646"/>
<polygon fill="#000000" stroke="#000000" points="8624.712,-59.7366 8633.8912,-54.4459 8623.4161,-52.8576 8624.712,-59.7366"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="9151.5,-902.7014 8960.5,-902.7014 8960.5,-866.7014 9151.5,-866.7014 9151.5,-902.7014"/>
<text text-anchor="middle" x="9056" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_124&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>header_124&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9143.5295,-1963.1846C9133.167,-1835.505 9071.172,-1071.6417 9058.3283,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="9061.7874,-912.7424 9057.4898,-903.0584 9054.8103,-913.3087 9061.7874,-912.7424"/>
</g>
<!-- raw_129 -->
<g id="node130" class="node">
<title>raw_129</title>
<ellipse fill="none" stroke="#000000" cx="9197" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9197" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_129 -->
<g id="edge129" class="edge">
<title>prose_125&#45;&gt;raw_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9336.0495,-1963.2955C9325.7483,-1917.8214 9295.9279,-1795.1477 9254,-1699.2027 9246.5827,-1682.2294 9238.246,-1680.9676 9233,-1663.2027 9149.6287,-1380.8781 9181.9672,-1016.1203 9193.5543,-912.9755"/>
<polygon fill="#000000" stroke="#000000" points="9197.0637,-913.0942 9194.7316,-902.7592 9190.1097,-912.2927 9197.0637,-913.0942"/>
</g>
<!-- prespace_130 -->
<g id="node131" class="node">
<title>prespace_130</title>
<ellipse fill="none" stroke="#000000" cx="9288" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9288" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_125&#45;&gt;prespace_130 -->
<g id="edge130" class="edge">
<title>prose_125&#45;&gt;prespace_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9339.1408,-1963.1846C9333.0864,-1835.505 9296.8646,-1071.6417 9289.3603,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="9292.8403,-912.8813 9288.8705,-903.0584 9285.8482,-913.213 9292.8403,-912.8813"/>
</g>
<!-- literal_131 -->
<g id="node132" class="node">
<title>literal_131</title>
<ellipse fill="none" stroke="#000000" cx="9384" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9384" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_125&#45;&gt;literal_131 -->
<g id="edge131" class="edge">
<title>prose_125&#45;&gt;literal_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340.727,-1963.1846C9345.85,-1835.505 9376.4992,-1071.6417 9382.8489,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="9386.3596,-913.1907 9383.2634,-903.0584 9379.3653,-912.91 9386.3596,-913.1907"/>
</g>
<!-- raw_132 -->
<g id="node133" class="node">
<title>raw_132</title>
<ellipse fill="none" stroke="#000000" cx="9460" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9460" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_132 -->
<g id="edge132" class="edge">
<title>prose_125&#45;&gt;raw_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9344.5862,-1963.4567C9356.07,-1918.8502 9387.0726,-1798.9219 9414,-1699.2027 9418.3291,-1683.1711 9421.3777,-1679.6002 9424,-1663.2027 9470.3834,-1373.1636 9463.9881,-1015.2021 9460.9724,-913.0874"/>
<polygon fill="#000000" stroke="#000000" points="9464.4668,-912.8467 9460.659,-902.9598 9457.4701,-913.0633 9464.4668,-912.8467"/>
</g>
<!-- raw_137 -->
<g id="node138" class="node">
<title>raw_137</title>
<ellipse fill="none" stroke="#000000" cx="9532" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9532" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_126&#45;&gt;raw_137 -->
<g id="edge137" class="edge">
<title>prose_126&#45;&gt;raw_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9457.8827,-1963.0713C9465.4501,-1914.4787 9485.9864,-1777.7505 9496,-1663.2027 9521.5793,-1370.5941 9529.6639,-1014.421 9531.5306,-912.9093"/>
<polygon fill="#000000" stroke="#000000" points="9535.0312,-912.9036 9531.7104,-902.8426 9528.0323,-912.7785 9535.0312,-912.9036"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="10083,-1212.8028 9577,-1212.8028 9577,-556.6001 10083,-556.6001 10083,-1212.8028"/>
<text text-anchor="middle" x="9830" y="-1197.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9830" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="9830" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9830" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="9830" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9830" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9830" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9830" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9830" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9830" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="9830" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="9830" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9830" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9830" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9830" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="9830" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9830" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="9830" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9830" y="-873.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="9830" y="-858.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9830" y="-843.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-827.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9830" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9830" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="9830" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9830" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return &quot;{ &#160;}&quot;</text>
<text text-anchor="middle" x="9830" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="9830" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="9830" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase</text>
<text text-anchor="middle" x="9830" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="9830" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="9830" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="9830" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-564.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_127&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>codeblock_127&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9713.9497,-1963.1846C9723.156,-1877.6282 9763.1004,-1506.4155 9793.5784,-1223.1764"/>
<polygon fill="#000000" stroke="#000000" points="9797.0684,-1223.4555 9794.6585,-1213.1384 9790.1086,-1222.7065 9797.0684,-1223.4555"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9264.5,-63.0015 9017.5,-63.0015 9017.5,-7.1986 9264.5,-7.1986 9264.5,-63.0015"/>
<text text-anchor="middle" x="9141" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_129&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_129&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9197.5622,-866.4528C9199.9142,-780.4306 9206.7926,-407.028 9160,-106.2001 9158.2886,-95.1975 9155.5405,-83.4464 9152.6599,-72.7314"/>
<polygon fill="#000000" stroke="#000000" points="9155.9551,-71.5189 9149.887,-62.834 9149.2146,-73.4074 9155.9551,-71.5189"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9337,-53.1 9283,-53.1 9283,-17.1 9337,-17.1 9337,-53.1"/>
<text text-anchor="middle" x="9310" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_130&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>prespace_130&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9288.4697,-866.5632C9291.2741,-758.2631 9305.8019,-197.2221 9309.2604,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9312.7652,-63.5166 9309.5254,-53.4293 9305.7676,-63.3353 9312.7652,-63.5166"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9413,-53.1 9355,-53.1 9355,-17.1 9413,-17.1 9413,-53.1"/>
<text text-anchor="middle" x="9384" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>literal_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9384,-866.5632C9384,-758.2631 9384,-197.2221 9384,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9387.5001,-63.4293 9384,-53.4293 9380.5001,-63.4293 9387.5001,-63.4293"/>
</g>
<!-- leaf_136 -->
<g id="node137" class="node">
<title>leaf_136</title>
<polygon fill="none" stroke="#c0c0c0" points="9958.5,-62.3005 9431.5,-62.3005 9431.5,-7.8996 9958.5,-7.8996 9958.5,-62.3005"/>
<text text-anchor="middle" x="9695" y="-47.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9695" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9695" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_132&#45;&gt;leaf_136 -->
<g id="edge136" class="edge">
<title>raw_132&#45;&gt;leaf_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9458.2076,-866.4573C9448.2418,-761.1569 9403.3621,-231.4239 9496,-106.2001 9507.0161,-91.309 9540.3028,-77.1033 9576.5773,-65.359"/>
<polygon fill="#000000" stroke="#000000" points="9577.8774,-68.6189 9586.3598,-62.2708 9575.77,-61.9437 9577.8774,-68.6189"/>
</g>
<!-- leaf_138 -->
<g id="node139" class="node">
<title>leaf_138</title>
<polygon fill="none" stroke="#c0c0c0" points="10489.5,-62.4005 9976.5,-62.4005 9976.5,-7.7996 10489.5,-7.7996 10489.5,-62.4005"/>
<text text-anchor="middle" x="10233" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10233" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_137&#45;&gt;leaf_138 -->
<g id="edge138" class="edge">
<title>raw_137&#45;&gt;leaf_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9529.791,-866.4204C9517.3344,-759.7754 9460.1772,-218.8489 9568,-106.2001 9598.7794,-74.0431 9922.7585,-75.1128 9967,-70.2001 9985.0519,-68.1956 10003.7758,-65.9874 10022.5481,-63.684"/>
<polygon fill="#000000" stroke="#000000" points="10023.1752,-67.1333 10032.6707,-62.4336 10022.317,-60.1861 10023.1752,-67.1333"/>
</g>
<!-- leaf_148 -->
<g id="node149" class="node">
<title>leaf_148</title>
<polygon fill="none" stroke="#c0c0c0" points="10377.5,-1999.3033 10186.5,-1999.3033 10186.5,-1963.3033 10377.5,-1963.3033 10377.5,-1999.3033"/>
<text text-anchor="middle" x="10282" y="-1977.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_140&#45;&gt;leaf_148 -->
<g id="edge148" class="edge">
<title>header_140&#45;&gt;leaf_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10363.0143,-2347.0119C10349.4373,-2285.7236 10304.9175,-2084.7556 10288.3158,-2009.8138"/>
<polygon fill="#000000" stroke="#000000" points="10291.6561,-2008.7092 10286.076,-1999.7029 10284.8218,-2010.2232 10291.6561,-2008.7092"/>
</g>
<!-- raw_149 -->
<g id="node150" class="node">
<title>raw_149</title>
<ellipse fill="none" stroke="#000000" cx="10423" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="10423" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_149 -->
<g id="edge149" class="edge">
<title>prose_141&#45;&gt;raw_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10582.934,-2355.0604C10547.9331,-2340.6625 10488.0303,-2310.4649 10459,-2263.4038 10409.0438,-2182.4195 10413.9012,-2063.4906 10419.3546,-2009.6454"/>
<polygon fill="#000000" stroke="#000000" points="10422.8587,-2009.7997 10420.4725,-1999.4771 10415.9006,-2009.0347 10422.8587,-2009.7997"/>
</g>
<!-- prespace_150 -->
<g id="node151" class="node">
<title>prespace_150</title>
<ellipse fill="none" stroke="#000000" cx="10514" cy="-1981.3033" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10514" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_141&#45;&gt;prespace_150 -->
<g id="edge150" class="edge">
<title>prose_141&#45;&gt;prespace_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10601.9309,-2347.3568C10593.0506,-2327.354 10578.863,-2293.598 10570,-2263.4038 10543.2162,-2172.1575 10525.2899,-2060.543 10517.8661,-2009.3688"/>
<polygon fill="#000000" stroke="#000000" points="10521.3204,-2008.8 10516.4419,-1999.3952 10514.3907,-2009.7896 10521.3204,-2008.8"/>
</g>
<!-- literal_151 -->
<g id="node152" class="node">
<title>literal_151</title>
<ellipse fill="none" stroke="#000000" cx="10610" cy="-1981.3033" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10610" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_141&#45;&gt;literal_151 -->
<g id="edge151" class="edge">
<title>prose_141&#45;&gt;literal_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10610,-2346.7554C10610,-2285.1484 10610,-2084.5441 10610,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="10613.5001,-2009.6635 10610,-1999.6635 10606.5001,-2009.6636 10613.5001,-2009.6635"/>
</g>
<!-- raw_152 -->
<g id="node153" class="node">
<title>raw_152</title>
<ellipse fill="none" stroke="#000000" cx="10687" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="10687" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_152 -->
<g id="edge152" class="edge">
<title>prose_141&#45;&gt;raw_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10618.4377,-2347.4585C10627.6484,-2327.5468 10642.1312,-2293.8722 10650,-2263.4038 10673.4748,-2172.5082 10682.4871,-2061.0922 10685.5724,-2009.7225"/>
<polygon fill="#000000" stroke="#000000" points="10689.085,-2009.5992 10686.1593,-1999.4164 10682.0964,-2009.2013 10689.085,-2009.5992"/>
</g>
<!-- raw_157 -->
<g id="node158" class="node">
<title>raw_157</title>
<ellipse fill="none" stroke="#000000" cx="11023" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="11023" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_142&#45;&gt;raw_157 -->
<g id="edge157" class="edge">
<title>prose_142&#45;&gt;raw_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11054.4526,-2347.0119C11049.1815,-2285.7236 11031.8974,-2084.7556 11025.452,-2009.8138"/>
<polygon fill="#000000" stroke="#000000" points="11028.9265,-2009.3661 11024.5824,-1999.7029 11021.9523,-2009.966 11028.9265,-2009.3661"/>
</g>
<!-- raw_159 -->
<g id="node160" class="node">
<title>raw_159</title>
<ellipse fill="none" stroke="#000000" cx="11214" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="11214" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_143&#45;&gt;raw_159 -->
<g id="edge159" class="edge">
<title>prose_143&#45;&gt;raw_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11204.4756,-2346.7554C11206.0812,-2285.1484 11211.3093,-2084.5441 11213.2585,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="11216.7597,-2009.7514 11213.5215,-1999.6635 11209.7621,-2009.5689 11216.7597,-2009.7514"/>
</g>
<!-- raw_161 -->
<g id="node162" class="node">
<title>raw_161</title>
<ellipse fill="none" stroke="#000000" cx="11296" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="11296" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_144&#45;&gt;raw_161 -->
<g id="edge161" class="edge">
<title>prose_144&#45;&gt;raw_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11286.4756,-2346.7554C11288.0812,-2285.1484 11293.3093,-2084.5441 11295.2585,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="11298.7597,-2009.7514 11295.5215,-1999.6635 11291.7621,-2009.5689 11298.7597,-2009.7514"/>
</g>
<!-- raw_163 -->
<g id="node164" class="node">
<title>raw_163</title>
<ellipse fill="none" stroke="#000000" cx="11373" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="11373" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_145&#45;&gt;raw_163 -->
<g id="edge163" class="edge">
<title>prose_145&#45;&gt;raw_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11368.2378,-2346.7554C11369.0406,-2285.1484 11371.6547,-2084.5441 11372.6293,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="11376.1301,-2009.7083 11372.7607,-1999.6635 11369.1306,-2009.617 11376.1301,-2009.7083"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="11450" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="11450" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_146&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_146&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11450,-2346.7554C11450,-2285.1484 11450,-2084.5441 11450,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="11453.5001,-2009.6635 11450,-1999.6635 11446.5001,-2009.6636 11453.5001,-2009.6635"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="12050.5,-2263.5043 11495.5,-2263.5043 11495.5,-1699.1022 12050.5,-1699.1022 12050.5,-2263.5043"/>
<text text-anchor="middle" x="11773" y="-2232.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="11773" y="-2216.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="11773" y="-2201.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="11773" y="-2186.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="11773" y="-2170.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="11773" y="-2155.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="11773" y="-2139.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function addTo(index)</text>
<text text-anchor="middle" x="11773" y="-2124.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-2093.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11773" y="-2077.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11773" y="-2062.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11773" y="-2046.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11773" y="-2015.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11773" y="-2000.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1969.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="11773" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="11773" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="11773" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="11773" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="11773" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="11773" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11773" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11773" y="-1846.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11773" y="-1830.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11773" y="-1815.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11773" y="-1799.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1784.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1769.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1753.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="11773" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="11773" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="11773" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_147&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>codeblock_147&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11685.314,-2347.0119C11689.2256,-2330.6978 11695.5102,-2304.4868 11702.9663,-2273.3901"/>
<polygon fill="#000000" stroke="#000000" points="11706.3883,-2274.1286 11705.3165,-2263.5881 11699.5813,-2272.4964 11706.3883,-2274.1286"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="10467,-912.6029 10101,-912.6029 10101,-856.7999 10467,-856.7999 10467,-912.6029"/>
<text text-anchor="middle" x="10284" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_149&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>raw_149&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10420.7034,-1963.1846C10404.8172,-1837.8553 10311.233,-1099.5488 10288.8211,-922.7362"/>
<polygon fill="#000000" stroke="#000000" points="10292.2678,-922.0936 10287.538,-912.6132 10285.3233,-922.9739 10292.2678,-922.0936"/>
</g>
<!-- leaf_154 -->
<g id="node155" class="node">
<title>leaf_154</title>
<polygon fill="none" stroke="#c0c0c0" points="10539,-902.7014 10485,-902.7014 10485,-866.7014 10539,-866.7014 10539,-902.7014"/>
<text text-anchor="middle" x="10512" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_150&#45;&gt;leaf_154 -->
<g id="edge154" class="edge">
<title>prespace_150&#45;&gt;leaf_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10513.967,-1963.1846C10513.7341,-1835.505 10512.3409,-1071.6417 10512.0523,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="10515.5518,-913.0519 10512.0335,-903.0584 10508.5518,-913.0648 10515.5518,-913.0519"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="10643,-902.7014 10557,-902.7014 10557,-866.7014 10643,-866.7014 10643,-902.7014"/>
<text text-anchor="middle" x="10600" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_151&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>literal_151&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10609.8348,-1963.1846C10608.6705,-1835.505 10601.7047,-1071.6417 10600.2616,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="10603.7585,-913.026 10600.1674,-903.0584 10596.7588,-913.0899 10603.7585,-913.026"/>
</g>
<!-- leaf_156 -->
<g id="node157" class="node">
<title>leaf_156</title>
<polygon fill="none" stroke="#c0c0c0" points="10715,-902.7014 10661,-902.7014 10661,-866.7014 10715,-866.7014 10715,-902.7014"/>
<text text-anchor="middle" x="10688" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_152&#45;&gt;leaf_156 -->
<g id="edge156" class="edge">
<title>raw_152&#45;&gt;leaf_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10687.0165,-1963.1846C10687.133,-1835.505 10687.8295,-1071.6417 10687.9738,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="10691.474,-913.0616 10687.9833,-903.0584 10684.474,-913.0551 10691.474,-913.0616"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11246.5,-904.6035 10733.5,-904.6035 10733.5,-864.7993 11246.5,-864.7993 11246.5,-904.6035"/>
<text text-anchor="middle" x="10990" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_157&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>raw_157&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11022.4548,-1963.1846C11018.625,-1835.9217 10995.7754,-1076.6216 10990.9105,-914.9579"/>
<polygon fill="#000000" stroke="#000000" points="10994.4034,-914.6659 10990.6041,-904.7757 10987.4066,-914.8765 10994.4034,-914.6659"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11427.5,-904.6035 11264.5,-904.6035 11264.5,-864.7993 11427.5,-864.7993 11427.5,-904.6035"/>
<text text-anchor="middle" x="11346" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_159&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_159&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11216.4329,-1963.0241C11222.899,-1914.3156 11240.9755,-1777.3289 11255,-1663.2027 11290.8267,-1371.6595 11330.9355,-1018.2664 11342.6324,-914.6142"/>
<polygon fill="#000000" stroke="#000000" points="11346.1232,-914.8911 11343.766,-904.5618 11339.1673,-914.1066 11346.1232,-914.8911"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="11972.5,-919.9018 11445.5,-919.9018 11445.5,-849.501 11972.5,-849.501 11972.5,-919.9018"/>
<text text-anchor="middle" x="11709" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11709" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11709" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_161&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>raw_161&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11292.8769,-1963.3399C11285.5007,-1914.717 11272.1744,-1778.8481 11337,-1699.2027 11366.5548,-1662.8914 11403.0849,-1696.4984 11436,-1663.2027 11647.5152,-1449.2419 11695.7244,-1062.2439 11706.2153,-930.2416"/>
<polygon fill="#000000" stroke="#000000" points="11709.7191,-930.3233 11706.9872,-920.0868 11702.7393,-929.7927 11709.7191,-930.3233"/>
</g>
<!-- leaf_164 -->
<g id="node165" class="node">
<title>leaf_164</title>
<polygon fill="none" stroke="#c0c0c0" points="12419.5,-904.6035 11990.5,-904.6035 11990.5,-864.7993 12419.5,-864.7993 12419.5,-904.6035"/>
<text text-anchor="middle" x="12205" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection</text>
</g>
<!-- raw_163&#45;&gt;leaf_164 -->
<g id="edge164" class="edge">
<title>raw_163&#45;&gt;leaf_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11368.9495,-1963.3594C11358.7525,-1912.9758 11337.962,-1769.3239 11414,-1699.2027 11506.8129,-1613.6121 11882.5924,-1742.2972 11981,-1663.2027 12222.3063,-1469.2543 12214.2484,-1033.2368 12207.252,-914.8508"/>
<polygon fill="#000000" stroke="#000000" points="12210.7348,-914.4668 12206.6075,-904.709 12203.7489,-914.9109 12210.7348,-914.4668"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="12944,-912.0018 12438,-912.0018 12438,-857.401 12944,-857.401 12944,-912.0018"/>
<text text-anchor="middle" x="12691" y="-880.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="12691" y="-865.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_165&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_165&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11445.4965,-1963.3126C11434.0512,-1912.8057 11409.8697,-1768.8609 11486,-1699.2027 11563.2765,-1628.4959 12344.0863,-1725.8893 12428,-1663.2027 12674.7881,-1478.843 12692.3684,-1051.6238 12691.8256,-922.3999"/>
<polygon fill="#000000" stroke="#000000" points="12695.324,-922.1908 12691.7415,-912.22 12688.3243,-922.2486 12695.324,-922.1908"/>
</g>
<!-- leaf_173 -->
<g id="node174" class="node">
<title>leaf_173</title>
<polygon fill="none" stroke="#c0c0c0" points="12846.5,-1999.3033 12697.5,-1999.3033 12697.5,-1963.3033 12846.5,-1963.3033 12846.5,-1999.3033"/>
<text text-anchor="middle" x="12772" y="-1977.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_168&#45;&gt;leaf_173 -->
<g id="edge173" class="edge">
<title>header_168&#45;&gt;leaf_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12781.5244,-2346.7554C12779.9188,-2285.1484 12774.6907,-2084.5441 12772.7415,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="12776.2379,-2009.5689 12772.4785,-1999.6635 12769.2403,-2009.7514 12776.2379,-2009.5689"/>
</g>
<!-- raw_174 -->
<g id="node175" class="node">
<title>raw_174</title>
<ellipse fill="none" stroke="#000000" cx="12892" cy="-1981.3033" rx="27" ry="18"/>
<text text-anchor="middle" x="12892" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_169&#45;&gt;raw_174 -->
<g id="edge174" class="edge">
<title>prose_169&#45;&gt;raw_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12951.0379,-2347.221C12944.4993,-2327.0965 12934.1236,-2293.2317 12928,-2263.4038 12909.1756,-2171.7105 12898.4886,-2061.1088 12894.2107,-2009.8953"/>
<polygon fill="#000000" stroke="#000000" points="12897.6733,-2009.2943 12893.3718,-1999.612 12890.6965,-2009.8635 12897.6733,-2009.2943"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="13317,-2082.6836 12937,-2082.6836 12937,-1879.9229 13317,-1879.9229 13317,-2082.6836"/>
<text text-anchor="middle" x="13127" y="-2067.5434" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="13127" y="-2052.1434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13127" y="-2036.7433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13127" y="-2021.3433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13127" y="-2005.9433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="13127" y="-1987.1833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="13127" y="-1968.4233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="13127" y="-1953.0232" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13127" y="-1937.6232" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="13127" y="-1918.8632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13127" y="-1903.4632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="13127" y="-1888.0631" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_170&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>codeblock_170&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13106.9987,-2346.7554C13109.4579,-2301.8238 13115.9635,-2182.9571 13120.893,-2092.8866"/>
<polygon fill="#000000" stroke="#000000" points="13124.3887,-2093.0603 13121.4405,-2082.8839 13117.3991,-2092.6777 13124.3887,-2093.0603"/>
</g>
<!-- header_177 -->
<g id="node178" class="node">
<title>header_177</title>
<ellipse fill="none" stroke="#000000" cx="13417" cy="-1981.3033" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="13417" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_171&#45;&gt;header_177 -->
<g id="edge177" class="edge">
<title>section_171&#45;&gt;header_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13542.2139,-2346.7952C13533.6706,-2326.5749 13519.7441,-2292.8921 13509,-2263.4038 13475.3428,-2171.0282 13440.7366,-2059.5982 13425.3028,-2008.866"/>
<polygon fill="#000000" stroke="#000000" points="13428.6445,-2007.8246 13422.3925,-1999.271 13421.9458,-2009.8564 13428.6445,-2007.8246"/>
</g>
<!-- prose_178 -->
<g id="node179" class="node">
<title>prose_178</title>
<ellipse fill="none" stroke="#000000" cx="13550" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13550" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_178 -->
<g id="edge178" class="edge">
<title>section_171&#45;&gt;prose_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13550,-2346.7554C13550,-2285.1484 13550,-2084.5441 13550,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="13553.5001,-2009.6635 13550,-1999.6635 13546.5001,-2009.6636 13553.5001,-2009.6635"/>
</g>
<!-- prose_179 -->
<g id="node180" class="node">
<title>prose_179</title>
<ellipse fill="none" stroke="#000000" cx="13665" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13665" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_179 -->
<g id="edge179" class="edge">
<title>section_171&#45;&gt;prose_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13558.1159,-2346.9099C13566.948,-2326.79 13581.126,-2293.1947 13591,-2263.4038 13621.3385,-2171.8688 13647.4929,-2060.3951 13658.8972,-2009.312"/>
<polygon fill="#000000" stroke="#000000" points="13662.3568,-2009.8773 13661.1031,-1999.3569 13655.5225,-2008.3629 13662.3568,-2009.8773"/>
</g>
<!-- codeblock_180 -->
<g id="node181" class="node">
<title>codeblock_180</title>
<ellipse fill="none" stroke="#000000" cx="13862" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13862" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 455&#45;479</text>
</g>
<!-- section_171&#45;&gt;codeblock_180 -->
<g id="edge180" class="edge">
<title>section_171&#45;&gt;codeblock_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13584.4991,-2348.8299C13618.6442,-2331.4876 13670.7755,-2301.2655 13706,-2263.4038 13779.9532,-2183.9137 13831.4077,-2062.8992 13851.9941,-2008.943"/>
<polygon fill="#000000" stroke="#000000" points="13855.3479,-2009.9675 13855.5875,-1999.3754 13848.7949,-2007.5063 13855.3479,-2009.9675"/>
</g>
<!-- header_193 -->
<g id="node194" class="node">
<title>header_193</title>
<ellipse fill="none" stroke="#000000" cx="14257" cy="-1981.3033" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="14257" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_172&#45;&gt;header_193 -->
<g id="edge193" class="edge">
<title>section_172&#45;&gt;header_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14455.896,-2348.1076C14428.2718,-2330.2036 14386.6332,-2299.5534 14361,-2263.4038 14302.8119,-2181.343 14273.2933,-2062.9584 14262.2557,-2009.4481"/>
<polygon fill="#000000" stroke="#000000" points="14265.6283,-2008.4643 14260.2343,-1999.3454 14258.7644,-2009.8377 14265.6283,-2008.4643"/>
</g>
<!-- prose_194 -->
<g id="node195" class="node">
<title>prose_194</title>
<ellipse fill="none" stroke="#000000" cx="14402" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14402" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_194 -->
<g id="edge194" class="edge">
<title>section_172&#45;&gt;prose_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14475.2449,-2347.102C14465.8533,-2327.1504 14451.1879,-2293.7015 14443,-2263.4038 14418.4097,-2172.412 14407.7153,-2060.6733 14403.8509,-2009.4188"/>
<polygon fill="#000000" stroke="#000000" points="14407.3407,-2009.15 14403.1275,-1999.4289 14400.359,-2009.6557 14407.3407,-2009.15"/>
</g>
<!-- prose_195 -->
<g id="node196" class="node">
<title>prose_195</title>
<ellipse fill="none" stroke="#000000" cx="14484" cy="-1981.3033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14484" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_195 -->
<g id="edge195" class="edge">
<title>section_172&#45;&gt;prose_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14484,-2346.7554C14484,-2285.1484 14484,-2084.5441 14484,-2009.7538"/>
<polygon fill="#000000" stroke="#000000" points="14487.5001,-2009.6635 14484,-1999.6635 14480.5001,-2009.6636 14487.5001,-2009.6635"/>
</g>
<!-- codeblock_196 -->
<g id="node197" class="node">
<title>codeblock_196</title>
<ellipse fill="none" stroke="#000000" cx="14679" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14679" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 488&#45;502</text>
</g>
<!-- section_172&#45;&gt;codeblock_196 -->
<g id="edge196" class="edge">
<title>section_172&#45;&gt;codeblock_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14493.1437,-2347.0119C14524.4906,-2285.3307 14627.7373,-2082.1726 14665.2354,-2008.3878"/>
<polygon fill="#000000" stroke="#000000" points="14668.4656,-2009.7569 14669.8761,-1999.2564 14662.2253,-2006.5855 14668.4656,-2009.7569"/>
</g>
<!-- codeblock_197 -->
<g id="node198" class="node">
<title>codeblock_197</title>
<ellipse fill="none" stroke="#000000" cx="14992" cy="-1981.3033" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="14992" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 504&#45;511</text>
</g>
<!-- section_172&#45;&gt;codeblock_197 -->
<g id="edge197" class="edge">
<title>section_172&#45;&gt;codeblock_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14545.0444,-2354.3766C14607.4637,-2341.1961 14704.9412,-2314.004 14775,-2263.4038 14873.4907,-2192.2685 14948.7005,-2063.988 14978.2898,-2008.3095"/>
<polygon fill="#000000" stroke="#000000" points="14981.4173,-2009.8819 14982.9628,-1999.4004 14975.2182,-2006.6304 14981.4173,-2009.8819"/>
</g>
<!-- codeblock_198 -->
<g id="node199" class="node">
<title>codeblock_198</title>
<ellipse fill="none" stroke="#000000" cx="15307" cy="-1981.3033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15307" y="-1977.1033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 513&#45;515</text>
</g>
<!-- section_172&#45;&gt;codeblock_198 -->
<g id="edge198" class="edge">
<title>section_172&#45;&gt;codeblock_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14555.9179,-2359.4606C14695.9169,-2347.6195 14999.1189,-2316.5197 15088,-2263.4038 15193.4027,-2200.4145 15266.7891,-2066.0555 15294.6153,-2008.4477"/>
<polygon fill="#000000" stroke="#000000" points="15297.8556,-2009.7835 15298.9846,-1999.249 15291.5326,-2006.7801 15297.8556,-2009.7835"/>
</g>
<!-- leaf_175 -->
<g id="node176" class="node">
<title>leaf_175</title>
<polygon fill="none" stroke="#c0c0c0" points="13016,-902.7014 12962,-902.7014 12962,-866.7014 13016,-866.7014 13016,-902.7014"/>
</g>
<!-- raw_174&#45;&gt;leaf_175 -->
<g id="edge175" class="edge">
<title>raw_174&#45;&gt;leaf_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12891.3865,-1963.0891C12890.4526,-1917.1377 12891.7751,-1793.4483 12928,-1699.2027 12934.9889,-1681.02 12946.7505,-1681.6527 12953,-1663.2027 13047.5387,-1384.1044 13007.2755,-1016.4302 12993.1512,-912.8978"/>
<polygon fill="#000000" stroke="#000000" points="12996.6065,-912.3338 12991.757,-902.914 12989.6738,-913.302 12996.6065,-912.3338"/>
</g>
<!-- leaf_181 -->
<g id="node182" class="node">
<title>leaf_181</title>
<polygon fill="none" stroke="#c0c0c0" points="13302,-902.7014 13146,-902.7014 13146,-866.7014 13302,-866.7014 13302,-902.7014"/>
<text text-anchor="middle" x="13224" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_177&#45;&gt;leaf_181 -->
<g id="edge181" class="edge">
<title>header_177&#45;&gt;leaf_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13411.7588,-1963.3048C13398.5467,-1918.3517 13362.3342,-1797.6947 13326,-1699.2027 13320.0008,-1682.9407 13315.3394,-1679.9841 13311,-1663.2027 13237.0053,-1377.0494 13225.9439,-1015.6778 13224.2905,-913.036"/>
<polygon fill="#000000" stroke="#000000" points="13227.7878,-912.8115 13224.1447,-902.8627 13220.7885,-912.9119 13227.7878,-912.8115"/>
</g>
<!-- raw_182 -->
<g id="node183" class="node">
<title>raw_182</title>
<ellipse fill="none" stroke="#000000" cx="13347" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13347" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_178&#45;&gt;raw_182 -->
<g id="edge182" class="edge">
<title>prose_178&#45;&gt;raw_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13553.3362,-1963.088C13561.2371,-1913.8305 13575.6782,-1776.5085 13508,-1699.2027 13469.9181,-1655.7035 13418.8243,-1708.5794 13383,-1663.2027 13289.206,-1544.399 13331.8659,-1038.5722 13344.1039,-913.0018"/>
<polygon fill="#000000" stroke="#000000" points="13347.6223,-912.9886 13345.1243,-902.6925 13340.6563,-912.2991 13347.6223,-912.9886"/>
</g>
<!-- prespace_183 -->
<g id="node184" class="node">
<title>prespace_183</title>
<ellipse fill="none" stroke="#000000" cx="13438" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13438" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_178&#45;&gt;prespace_183 -->
<g id="edge183" class="edge">
<title>prose_178&#45;&gt;prespace_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13548.7117,-1963.1986C13545.194,-1918.0031 13533.9042,-1796.8366 13508,-1699.2027 13503.5975,-1682.6096 13497.769,-1679.9512 13494,-1663.2027 13429.3442,-1375.8919 13434.1074,-1015.3281 13437.0215,-912.9568"/>
<polygon fill="#000000" stroke="#000000" points="13440.5244,-912.9123 13437.3293,-902.8108 13433.5276,-912.7 13440.5244,-912.9123"/>
</g>
<!-- literal_184 -->
<g id="node185" class="node">
<title>literal_184</title>
<ellipse fill="none" stroke="#000000" cx="13534" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13534" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_178&#45;&gt;literal_184 -->
<g id="edge184" class="edge">
<title>prose_178&#45;&gt;literal_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13549.7356,-1963.1846C13547.8727,-1835.505 13536.7276,-1071.6417 13534.4186,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="13537.9135,-913.0062 13534.2678,-903.0584 13530.9142,-913.1084 13537.9135,-913.0062"/>
</g>
<!-- raw_185 -->
<g id="node186" class="node">
<title>raw_185</title>
<ellipse fill="none" stroke="#000000" cx="13610" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13610" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_178&#45;&gt;raw_185 -->
<g id="edge185" class="edge">
<title>prose_178&#45;&gt;raw_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13551.566,-1963.0272C13555.6985,-1914.3265 13567.0557,-1777.3571 13574,-1663.2027 13591.835,-1370.0202 13605.3098,-1014.2465 13608.9939,-912.8695"/>
<polygon fill="#000000" stroke="#000000" points="13612.4937,-912.9364 13609.3573,-902.8164 13605.4982,-912.6834 13612.4937,-912.9364"/>
</g>
<!-- raw_190 -->
<g id="node191" class="node">
<title>raw_190</title>
<ellipse fill="none" stroke="#000000" cx="13682" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13682" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_190 -->
<g id="edge190" class="edge">
<title>prose_179&#45;&gt;raw_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13665.2809,-1963.1846C13667.2602,-1835.505 13679.102,-1071.6417 13681.5553,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="13685.0599,-913.1114 13681.7154,-903.0584 13678.0607,-913.0029 13685.0599,-913.1114"/>
</g>
<!-- leaf_192 -->
<g id="node193" class="node">
<title>leaf_192</title>
<polygon fill="none" stroke="#c0c0c0" points="14115.4016,-1072.3422 13726.5984,-1072.3422 13726.5984,-697.0606 14115.4016,-697.0606 14115.4016,-1072.3422"/>
<text text-anchor="middle" x="13921" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="13921" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="13921" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13921" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="13921" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13921" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="13921" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13921" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13921" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="13921" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13921" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="13921" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="13921" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="13921" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="13921" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="13921" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_180&#45;&gt;leaf_192 -->
<g id="edge192" class="edge">
<title>codeblock_180&#45;&gt;leaf_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13862.9748,-1963.1846C13868.3934,-1862.4726 13895.1083,-1365.9369 13910.3303,-1083.0141"/>
<polygon fill="#000000" stroke="#000000" points="13913.8469,-1082.7977 13910.8893,-1072.6241 13906.857,-1082.4216 13913.8469,-1082.7977"/>
</g>
<!-- leaf_186 -->
<g id="node187" class="node">
<title>leaf_186</title>
<polygon fill="none" stroke="#c0c0c0" points="13359.5,-63.0015 12888.5,-63.0015 12888.5,-7.1986 13359.5,-7.1986 13359.5,-63.0015"/>
<text text-anchor="middle" x="13124" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_182&#45;&gt;leaf_186 -->
<g id="edge186" class="edge">
<title>raw_182&#45;&gt;leaf_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13348.7539,-866.4855C13358.503,-761.3436 13402.3695,-232.3524 13311,-106.2001 13300.7109,-91.9941 13269.4311,-77.93 13235.3259,-66.1073"/>
<polygon fill="#000000" stroke="#000000" points="13236.241,-62.7221 13225.6467,-62.8339 13233.9984,-69.3531 13236.241,-62.7221"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="13432,-53.1 13378,-53.1 13378,-17.1 13432,-17.1 13432,-53.1"/>
</g>
<!-- prespace_183&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>prespace_183&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13437.2955,-866.5632C13433.0889,-758.2631 13411.2971,-197.2221 13406.1093,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13409.5975,-63.2859 13405.7119,-53.4293 13402.6028,-63.5576 13409.5975,-63.2859"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13550,-53.1 13450,-53.1 13450,-17.1 13550,-17.1 13550,-53.1"/>
<text text-anchor="middle" x="13500" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_184&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>literal_184&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13533.2741,-866.5632C13528.9401,-758.2631 13506.4879,-197.2221 13501.143,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13504.6307,-63.2813 13500.7335,-53.4293 13497.6363,-63.5613 13504.6307,-63.2813"/>
</g>
<!-- leaf_189 -->
<g id="node190" class="node">
<title>leaf_189</title>
<polygon fill="none" stroke="#c0c0c0" points="13808,-53.1 13568,-53.1 13568,-17.1 13808,-17.1 13808,-53.1"/>
<text text-anchor="middle" x="13688" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_185&#45;&gt;leaf_189 -->
<g id="edge189" class="edge">
<title>raw_185&#45;&gt;leaf_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13607.6974,-866.6335C13597.2861,-779.9167 13558.7878,-398.5735 13646,-106.2001 13650.7281,-90.3494 13659.7253,-74.3445 13668.1832,-61.5439"/>
<polygon fill="#000000" stroke="#000000" points="13671.114,-63.4589 13673.8935,-53.2351 13665.345,-59.4941 13671.114,-63.4589"/>
</g>
<!-- leaf_191 -->
<g id="node192" class="node">
<title>leaf_191</title>
<polygon fill="none" stroke="#c0c0c0" points="14213.5,-55.0021 13826.5,-55.0021 13826.5,-15.198 14213.5,-15.198 14213.5,-55.0021"/>
<text text-anchor="middle" x="14020" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_190&#45;&gt;leaf_191 -->
<g id="edge191" class="edge">
<title>raw_190&#45;&gt;leaf_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13680.0356,-866.6385C13668.9714,-761.2351 13618.3945,-226.1761 13718,-106.2001 13730.0433,-91.6938 13819.2481,-71.7875 13897.6095,-56.7271"/>
<polygon fill="#000000" stroke="#000000" points="13898.4304,-60.1337 13907.5976,-54.8221 13897.1189,-53.2576 13898.4304,-60.1337"/>
</g>
<!-- leaf_199 -->
<g id="node200" class="node">
<title>leaf_199</title>
<polygon fill="none" stroke="#c0c0c0" points="14342,-902.7014 14172,-902.7014 14172,-866.7014 14342,-866.7014 14342,-902.7014"/>
<text text-anchor="middle" x="14257" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_193&#45;&gt;leaf_199 -->
<g id="edge199" class="edge">
<title>header_193&#45;&gt;leaf_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14257,-1963.1846C14257,-1835.505 14257,-1071.6417 14257,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="14260.5001,-913.0583 14257,-903.0584 14253.5001,-913.0584 14260.5001,-913.0583"/>
</g>
<!-- raw_200 -->
<g id="node201" class="node">
<title>raw_200</title>
<ellipse fill="none" stroke="#000000" cx="14394" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14394" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_194&#45;&gt;raw_200 -->
<g id="edge200" class="edge">
<title>prose_194&#45;&gt;raw_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14401.8678,-1963.1846C14400.9364,-1835.505 14395.3638,-1071.6417 14394.2093,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="14397.7069,-913.0325 14394.1339,-903.0584 14390.7071,-913.0837 14397.7069,-913.0325"/>
</g>
<!-- raw_202 -->
<g id="node203" class="node">
<title>raw_202</title>
<ellipse fill="none" stroke="#000000" cx="14466" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14466" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_195&#45;&gt;raw_202 -->
<g id="edge202" class="edge">
<title>prose_195&#45;&gt;raw_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14483.7026,-1963.1846C14481.6068,-1835.505 14469.0685,-1071.6417 14466.4709,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="14469.9651,-912.9995 14466.3013,-903.0584 14462.966,-913.1145 14469.9651,-912.9995"/>
</g>
<!-- leaf_204 -->
<g id="node205" class="node">
<title>leaf_204</title>
<polygon fill="none" stroke="#c0c0c0" points="14961,-988.9019 14511,-988.9019 14511,-780.5009 14961,-780.5009 14961,-988.9019"/>
<text text-anchor="middle" x="14736" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="14736" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="14736" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="14736" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="14736" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14736" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="14736" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="14736" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="14736" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="14736" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="14736" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14736" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="14736" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_196&#45;&gt;leaf_204 -->
<g id="edge204" class="edge">
<title>codeblock_196&#45;&gt;leaf_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14679.9418,-1963.1846C14685.7446,-1851.5457 14716.8286,-1253.5324 14730.046,-999.2475"/>
<polygon fill="#000000" stroke="#000000" points="14733.5422,-999.4102 14730.5661,-989.242 14726.5516,-999.0468 14733.5422,-999.4102"/>
</g>
<!-- leaf_205 -->
<g id="node206" class="node">
<title>leaf_205</title>
<polygon fill="none" stroke="#c0c0c0" points="15247,-935.1024 14979,-935.1024 14979,-834.3004 15247,-834.3004 15247,-935.1024"/>
<text text-anchor="middle" x="15113" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="15113" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="15113" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="15113" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="15113" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15113" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_197&#45;&gt;leaf_205 -->
<g id="edge205" class="edge">
<title>codeblock_197&#45;&gt;leaf_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14993.9992,-1963.1846C15007.3023,-1842.6214 15083.1954,-1154.8154 15106.3158,-945.2793"/>
<polygon fill="#000000" stroke="#000000" points="15109.8231,-945.4048 15107.4411,-935.0812 15102.8653,-944.637 15109.8231,-945.4048"/>
</g>
<!-- leaf_206 -->
<g id="node207" class="node">
<title>leaf_206</title>
<polygon fill="none" stroke="#c0c0c0" points="15351,-902.7014 15265,-902.7014 15265,-866.7014 15351,-866.7014 15351,-902.7014"/>
<text text-anchor="middle" x="15308" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_198&#45;&gt;leaf_206 -->
<g id="edge206" class="edge">
<title>codeblock_198&#45;&gt;leaf_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15307.0165,-1963.1846C15307.133,-1835.505 15307.8295,-1071.6417 15307.9738,-913.3889"/>
<polygon fill="#000000" stroke="#000000" points="15311.474,-913.0616 15307.9833,-903.0584 15304.474,-913.0551 15311.474,-913.0616"/>
</g>
<!-- leaf_201 -->
<g id="node202" class="node">
<title>leaf_201</title>
<polygon fill="none" stroke="#c0c0c0" points="14556,-63.0015 14232,-63.0015 14232,-7.1986 14556,-7.1986 14556,-63.0015"/>
<text text-anchor="middle" x="14394" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_200&#45;&gt;leaf_201 -->
<g id="edge201" class="edge">
<title>raw_200&#45;&gt;leaf_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14394,-866.5632C14394,-760.6464 14394,-221.6953 14394,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="14397.5001,-73.0758 14394,-63.0758 14390.5001,-73.0759 14397.5001,-73.0758"/>
</g>
<!-- leaf_203 -->
<g id="node204" class="node">
<title>leaf_203</title>
<polygon fill="none" stroke="#c0c0c0" points="14772,-55.0021 14574,-55.0021 14574,-15.198 14772,-15.198 14772,-55.0021"/>
<text text-anchor="middle" x="14673" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_202&#45;&gt;leaf_203 -->
<g id="edge203" class="edge">
<title>raw_202&#45;&gt;leaf_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14464.3052,-866.5276C14454.8888,-761.6229 14412.5782,-233.7404 14502,-106.2001 14508.6773,-96.6764 14562.4439,-75.2015 14607.9306,-58.3295"/>
<polygon fill="#000000" stroke="#000000" points="14609.3192,-61.548 14617.4914,-54.8051 14606.898,-54.98 14609.3192,-61.548"/>
</g>
</g>
</svg>
