<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="6413pt" height="1367pt"
 viewBox="0.00 0.00 6413.30 1366.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1362.8019)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1362.8019 6409.2972,-1362.8019 6409.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1340.8019" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1433" y="-1336.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 217</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1268.8019" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1433" y="-1264.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;132</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1433,-1322.6333C1433,-1314.9329 1433,-1305.7763 1433,-1297.2186"/>
<polygon fill="#000000" stroke="#000000" points="1436.5001,-1297.2152 1433,-1287.2152 1429.5001,-1297.2152 1436.5001,-1297.2152"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1079" cy="-1196.8019" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1079" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1376.6436,-1259.5102C1318.582,-1249.6306 1225.5848,-1232.9516 1146,-1214.8019 1141.3285,-1213.7366 1136.491,-1212.5677 1131.6518,-1211.3531"/>
<polygon fill="#000000" stroke="#000000" points="1132.3256,-1207.9126 1121.7692,-1208.8145 1130.5839,-1214.6925 1132.3256,-1207.9126"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1187" cy="-1196.8019" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1187" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1381.3638,-1257.5594C1339.5034,-1247.8845 1279.2574,-1232.6817 1228,-1214.8019 1225.7705,-1214.0242 1223.4928,-1213.1776 1221.2098,-1212.2895"/>
<polygon fill="#000000" stroke="#000000" points="1222.4846,-1209.0295 1211.9043,-1208.4743 1219.8291,-1215.5063 1222.4846,-1209.0295"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1269" cy="-1196.8019" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1269" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1398.2198,-1253.5326C1370.38,-1241.3102 1331.5246,-1224.2518 1303.7047,-1212.0382"/>
<polygon fill="#000000" stroke="#000000" points="1304.9243,-1208.7512 1294.3609,-1207.936 1302.1103,-1215.1607 1304.9243,-1208.7512"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1351" cy="-1196.8019" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1351" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1413.1501,-1251.3727C1402.0588,-1241.634 1388.1239,-1229.3985 1376.2613,-1218.9826"/>
<polygon fill="#000000" stroke="#000000" points="1378.264,-1216.0833 1368.4403,-1212.1153 1373.6454,-1221.3434 1378.264,-1216.0833"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1196.8019" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1433" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1433,-1250.6333C1433,-1242.9329 1433,-1233.7763 1433,-1225.2186"/>
<polygon fill="#000000" stroke="#000000" points="1436.5001,-1225.2152 1433,-1215.2152 1429.5001,-1225.2152 1436.5001,-1225.2152"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1603" cy="-1196.8019" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1603" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;20</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1469.0526,-1253.5326C1494.4235,-1242.7873 1528.6201,-1228.304 1556.11,-1216.6612"/>
<polygon fill="#000000" stroke="#000000" points="1557.6852,-1219.7951 1565.5284,-1212.6723 1554.9552,-1213.3494 1557.6852,-1219.7951"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="1820" cy="-1196.8019" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1820" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 22&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1487.6268,-1258.6388C1556.2206,-1245.8772 1674.0237,-1223.9603 1749.3919,-1209.9383"/>
<polygon fill="#000000" stroke="#000000" points="1750.0875,-1213.3691 1759.2786,-1208.0989 1748.8071,-1206.4871 1750.0875,-1213.3691"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2804" cy="-1196.8019" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2804" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 27&#45;132</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1497.7449,-1265.4018C1723.7746,-1253.5315 2477.452,-1213.9511 2724.6907,-1200.967"/>
<polygon fill="#000000" stroke="#000000" points="2724.8746,-1204.4622 2734.6772,-1200.4425 2724.5074,-1197.4719 2724.8746,-1204.4622"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="4285" cy="-1196.8019" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4285" y="-1192.6019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 133&#45;193</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1498.6115,-1267.1455C1876.4241,-1257.6075 3772.5311,-1209.7394 4199.513,-1198.9601"/>
<polygon fill="#000000" stroke="#000000" points="4199.7161,-1202.4562 4209.6246,-1198.7048 4199.5394,-1195.4584 4199.7161,-1202.4562"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="1125.5,-1133.7019 1032.5,-1133.7019 1032.5,-1097.7019 1125.5,-1097.7019 1125.5,-1133.7019"/>
<text text-anchor="middle" x="1079" y="-1112.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>header_2&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1079,-1178.3991C1079,-1168.2702 1079,-1155.4818 1079,-1144.1006"/>
<polygon fill="#000000" stroke="#000000" points="1082.5001,-1143.7525 1079,-1133.7525 1075.5001,-1143.7526 1082.5001,-1143.7525"/>
</g>
<!-- raw_12 -->
<g id="node13" class="node">
<title>raw_12</title>
<ellipse fill="none" stroke="#000000" cx="1179" cy="-1115.7019" rx="27" ry="18"/>
<text text-anchor="middle" x="1179" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_12 -->
<g id="edge12" class="edge">
<title>prose_3&#45;&gt;raw_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1185.2245,-1178.8032C1184.2166,-1168.5849 1182.9323,-1155.5653 1181.7924,-1144.0094"/>
<polygon fill="#000000" stroke="#000000" points="1185.263,-1143.5388 1180.7982,-1133.9307 1178.2968,-1144.2261 1185.263,-1143.5388"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1260" cy="-1115.7019" rx="27" ry="18"/>
<text text-anchor="middle" x="1260" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_4&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1267.0026,-1178.8032C1265.8686,-1168.5849 1264.4238,-1155.5653 1263.1414,-1144.0094"/>
<polygon fill="#000000" stroke="#000000" points="1266.6046,-1143.4837 1262.0229,-1133.9307 1259.6473,-1144.2558 1266.6046,-1143.4837"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1341" cy="-1115.7019" rx="27" ry="18"/>
<text text-anchor="middle" x="1341" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_5&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1348.7807,-1178.8032C1347.5119,-1168.5135 1345.8929,-1155.3831 1344.4606,-1143.7672"/>
<polygon fill="#000000" stroke="#000000" points="1347.9107,-1143.1468 1343.2131,-1133.6503 1340.9633,-1144.0035 1347.9107,-1143.1468"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-1115.7019" rx="27" ry="18"/>
<text text-anchor="middle" x="1423" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_6&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1430.7807,-1178.8032C1429.5119,-1168.5135 1427.8929,-1155.3831 1426.4606,-1143.7672"/>
<polygon fill="#000000" stroke="#000000" points="1429.9107,-1143.1468 1425.2131,-1133.6503 1422.9633,-1144.0035 1429.9107,-1143.1468"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1750,-1142.9024 1468,-1142.9024 1468,-1088.5014 1750,-1088.5014 1750,-1142.9024"/>
<text text-anchor="middle" x="1609" y="-1127.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">local Linebuf = require &quot;linebuf&quot;</text>
<text text-anchor="middle" x="1609" y="-1112.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1609" y="-1096.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>codeblock_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1604.3316,-1178.8032C1604.8985,-1171.1406 1605.5819,-1161.9027 1606.2489,-1152.888"/>
<polygon fill="#000000" stroke="#000000" points="1609.7403,-1153.1319 1606.9877,-1142.9009 1602.7594,-1152.6154 1609.7403,-1153.1319"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1959.5,-1133.7019 1768.5,-1133.7019 1768.5,-1097.7019 1959.5,-1097.7019 1959.5,-1133.7019"/>
<text text-anchor="middle" x="1864" y="-1112.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_8&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1829.765,-1178.8032C1835.4786,-1168.2721 1842.8064,-1154.7656 1849.2155,-1142.9524"/>
<polygon fill="#000000" stroke="#000000" points="1852.4177,-1144.3895 1854.1101,-1133.9307 1846.2649,-1141.0514 1852.4177,-1144.3895"/>
</g>
<!-- header_22 -->
<g id="node23" class="node">
<title>header_22</title>
<ellipse fill="none" stroke="#000000" cx="2210" cy="-1115.7019" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2210" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:load()</text>
</g>
<!-- section_9&#45;&gt;header_22 -->
<g id="edge22" class="edge">
<title>section_9&#45;&gt;header_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2740.3137,-1188.9339C2658.8109,-1178.7685 2513.2883,-1160.2946 2389,-1142.8019 2355.5796,-1138.0982 2318.7027,-1132.5726 2287.1489,-1127.742"/>
<polygon fill="#000000" stroke="#000000" points="2287.5176,-1124.2577 2277.1023,-1126.2 2286.4556,-1131.1767 2287.5176,-1124.2577"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-1115.7019" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2430" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2750.0166,-1185.0959C2674.2064,-1168.6568 2537.9235,-1139.1046 2470.3108,-1124.4431"/>
<polygon fill="#000000" stroke="#000000" points="2470.9732,-1121.0054 2460.4586,-1122.3067 2469.4897,-1127.8465 2470.9732,-1121.0054"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="2804" cy="-1115.7019" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2804" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 32&#45;70</text>
</g>
<!-- section_9&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2804,-1178.3991C2804,-1168.2702 2804,-1155.4818 2804,-1144.1006"/>
<polygon fill="#000000" stroke="#000000" points="2807.5001,-1143.7525 2804,-1133.7525 2800.5001,-1143.7526 2807.5001,-1143.7525"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="3017" cy="-1115.7019" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3017" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2843.5645,-1181.7377C2882.7705,-1166.81 2942.3291,-1144.133 2980.4494,-1129.6186"/>
<polygon fill="#000000" stroke="#000000" points="2982.0253,-1132.7637 2990.1254,-1125.9344 2979.5345,-1126.2219 2982.0253,-1132.7637"/>
</g>
<!-- codeblock_26 -->
<g id="node27" class="node">
<title>codeblock_26</title>
<ellipse fill="none" stroke="#000000" cx="3217" cy="-1115.7019" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3217" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 72&#45;89</text>
</g>
<!-- section_9&#45;&gt;codeblock_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;codeblock_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2860.1288,-1185.78C2934.7899,-1171.119 3066.7299,-1145.2101 3147.5678,-1129.3362"/>
<polygon fill="#000000" stroke="#000000" points="3148.513,-1132.7175 3157.6512,-1127.3561 3147.1642,-1125.8487 3148.513,-1132.7175"/>
</g>
<!-- codeblock_27 -->
<g id="node28" class="node">
<title>codeblock_27</title>
<ellipse fill="none" stroke="#000000" cx="3536" cy="-1115.7019" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="3536" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 91&#45;130</text>
</g>
<!-- section_9&#45;&gt;codeblock_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;codeblock_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2869.4076,-1189.8922C2964.7734,-1179.7793 3147.5641,-1160.2513 3303,-1142.8019 3352.8414,-1137.2067 3408.6525,-1130.723 3453.1544,-1125.5006"/>
<polygon fill="#000000" stroke="#000000" points="3453.8163,-1128.947 3463.3397,-1124.3042 3452.9996,-1121.9948 3453.8163,-1128.947"/>
</g>
<!-- header_42 -->
<g id="node43" class="node">
<title>header_42</title>
<ellipse fill="none" stroke="#000000" cx="4011" cy="-1115.7019" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="4011" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_10&#45;&gt;header_42 -->
<g id="edge42" class="edge">
<title>section_10&#45;&gt;header_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4237.5857,-1182.768C4191.0607,-1168.9972 4119.9897,-1147.9613 4069.872,-1133.1272"/>
<polygon fill="#000000" stroke="#000000" points="4070.7235,-1129.7292 4060.1414,-1130.247 4068.7368,-1136.4413 4070.7235,-1129.7292"/>
</g>
<!-- prose_43 -->
<g id="node44" class="node">
<title>prose_43</title>
<ellipse fill="none" stroke="#000000" cx="4202" cy="-1115.7019" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4202" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_43 -->
<g id="edge43" class="edge">
<title>section_10&#45;&gt;prose_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4266.9902,-1179.2044C4254.7944,-1167.2878 4238.563,-1151.4279 4225.3724,-1138.5393"/>
<polygon fill="#000000" stroke="#000000" points="4227.6095,-1135.8317 4218.0109,-1131.3463 4222.7173,-1140.8384 4227.6095,-1135.8317"/>
</g>
<!-- codeblock_44 -->
<g id="node45" class="node">
<title>codeblock_44</title>
<ellipse fill="none" stroke="#000000" cx="4355" cy="-1115.7019" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4355" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 135&#45;161</text>
</g>
<!-- section_10&#45;&gt;codeblock_44 -->
<g id="edge44" class="edge">
<title>section_10&#45;&gt;codeblock_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4300.5353,-1178.8032C4310.0511,-1167.7785 4322.3815,-1153.4928 4332.903,-1141.3029"/>
<polygon fill="#000000" stroke="#000000" points="4335.6237,-1143.5074 4339.5082,-1133.6503 4330.3246,-1138.9335 4335.6237,-1143.5074"/>
</g>
<!-- section_45 -->
<g id="node46" class="node">
<title>section_45</title>
<ellipse fill="none" stroke="#000000" cx="4772" cy="-1115.7019" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4772" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 164&#45;193</text>
</g>
<!-- section_10&#45;&gt;section_45 -->
<g id="edge45" class="edge">
<title>section_10&#45;&gt;section_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4347.1735,-1186.4482C4437.4455,-1171.4152 4604.4231,-1143.6084 4699.946,-1127.701"/>
<polygon fill="#000000" stroke="#000000" points="4700.5232,-1131.1532 4709.8124,-1126.058 4699.3733,-1124.2483 4700.5232,-1131.1532"/>
</g>
<!-- section_46 -->
<g id="node47" class="node">
<title>section_46</title>
<ellipse fill="none" stroke="#000000" cx="5750" cy="-1115.7019" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5750" y="-1111.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 194&#45;217</text>
</g>
<!-- section_10&#45;&gt;section_46 -->
<g id="edge46" class="edge">
<title>section_10&#45;&gt;section_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4358.6536,-1192.7246C4605.7214,-1179.0473 5404.1776,-1134.8461 5665.9963,-1120.3522"/>
<polygon fill="#000000" stroke="#000000" points="5666.4086,-1123.8348 5676.1998,-1119.7873 5666.0216,-1116.8455 5666.4086,-1123.8348"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-791.6024 0,-791.6024 0,-719.8001 324,-719.8001 324,-791.6024"/>
<text text-anchor="middle" x="162" y="-728.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>raw_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1161.1554,-1102.1443C1153.2617,-1096.9155 1143.6029,-1091.5039 1134,-1088.6018 1048.7195,-1062.8292 409.11,-1098.908 333,-1052.6018 240.4372,-996.2857 193.0243,-869.8002 173.3722,-801.5101"/>
<polygon fill="#000000" stroke="#000000" points="176.6282,-800.1574 170.5628,-791.4706 169.8871,-802.0438 176.6282,-800.1574"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-783.0017 342.5,-783.0017 342.5,-728.4008 897.5,-728.4008 897.5,-783.0017"/>
<text text-anchor="middle" x="620" y="-751.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-736.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1241.615,-1102.1947C1233.7858,-1097.1068 1224.3205,-1091.7861 1215,-1088.6018 1084.5802,-1044.0458 1030.5342,-1113.7073 907,-1052.6018 784.5615,-992.0383 685.3939,-857.1553 642.6835,-792.1334"/>
<polygon fill="#000000" stroke="#000000" points="645.4174,-789.917 637.035,-783.4372 639.547,-793.73 645.4174,-789.917"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-783.0017 916,-783.0017 916,-728.4008 1464,-728.4008 1464,-783.0017"/>
<text text-anchor="middle" x="1190" y="-751.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-736.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1333.717,-1098.3383C1310.4408,-1042.8455 1237.5057,-868.96 1205.4143,-792.4506"/>
<polygon fill="#000000" stroke="#000000" points="1208.6235,-791.0529 1201.5279,-783.185 1202.1683,-793.7605 1208.6235,-791.0529"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-791.0016 1482,-791.0016 1482,-720.4009 2030,-720.4009 2030,-791.0016"/>
<text text-anchor="middle" x="1756" y="-759.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new linebuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-744.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1437.3086,-1100.2331C1485.3671,-1048.2779 1642.1337,-878.8002 1716.3552,-798.5606"/>
<polygon fill="#000000" stroke="#000000" points="1719.0527,-800.7987 1723.2738,-791.081 1713.914,-796.0454 1719.0527,-800.7987"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2197.5,-773.7013 2048.5,-773.7013 2048.5,-737.7013 2197.5,-737.7013 2197.5,-773.7013"/>
<text text-anchor="middle" x="2123" y="-752.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:load()</text>
</g>
<!-- header_22&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>header_22&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2205.566,-1097.3545C2191.3706,-1038.6147 2146.9736,-854.9027 2129.8403,-784.0061"/>
<polygon fill="#000000" stroke="#000000" points="2133.1762,-782.9097 2127.425,-774.0117 2126.3721,-784.5541 2133.1762,-782.9097"/>
</g>
<!-- raw_29 -->
<g id="node30" class="node">
<title>raw_29</title>
<ellipse fill="none" stroke="#000000" cx="2243" cy="-755.7013" rx="27" ry="18"/>
<text text-anchor="middle" x="2243" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_23&#45;&gt;raw_29 -->
<g id="edge29" class="edge">
<title>prose_23&#45;&gt;raw_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2398.3201,-1111.8439C2363.167,-1105.7616 2307.6325,-1090.4372 2279,-1052.6018 2217.6269,-971.5026 2229.096,-840.6905 2237.8686,-783.7189"/>
<polygon fill="#000000" stroke="#000000" points="2241.3543,-784.0901 2239.5109,-773.6569 2234.4457,-782.9624 2241.3543,-784.0901"/>
</g>
<!-- prespace_30 -->
<g id="node31" class="node">
<title>prespace_30</title>
<ellipse fill="none" stroke="#000000" cx="2334" cy="-755.7013" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2334" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_23&#45;&gt;prespace_30 -->
<g id="edge30" class="edge">
<title>prose_23&#45;&gt;prespace_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2416.9084,-1098.9806C2408.0012,-1086.7818 2396.6629,-1069.494 2390,-1052.6018 2352.9069,-958.5621 2339.9253,-837.8468 2335.7741,-783.9161"/>
<polygon fill="#000000" stroke="#000000" points="2339.2511,-783.4718 2335.0368,-773.7512 2332.2695,-783.9783 2339.2511,-783.4718"/>
</g>
<!-- literal_31 -->
<g id="node32" class="node">
<title>literal_31</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-755.7013" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2430" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_23&#45;&gt;literal_31 -->
<g id="edge31" class="edge">
<title>prose_23&#45;&gt;literal_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2430,-1097.3545C2430,-1038.7353 2430,-855.6567 2430,-784.4442"/>
<polygon fill="#000000" stroke="#000000" points="2433.5001,-784.0117 2430,-774.0117 2426.5001,-784.0118 2433.5001,-784.0117"/>
</g>
<!-- raw_32 -->
<g id="node33" class="node">
<title>raw_32</title>
<ellipse fill="none" stroke="#000000" cx="2506" cy="-755.7013" rx="27" ry="18"/>
<text text-anchor="middle" x="2506" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_23&#45;&gt;raw_32 -->
<g id="edge32" class="edge">
<title>prose_23&#45;&gt;raw_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2443.4359,-1099.1099C2452.5053,-1086.9721 2463.896,-1069.7039 2470,-1052.6018 2503.6373,-958.3579 2507.0315,-837.7458 2506.6543,-783.8787"/>
<polygon fill="#000000" stroke="#000000" points="2510.1522,-783.6831 2506.5313,-773.7263 2503.1528,-783.768 2510.1522,-783.6831"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="3057,-1038.7022 2551,-1038.7022 2551,-472.7003 3057,-472.7003 3057,-1038.7022"/>
<text text-anchor="middle" x="2804" y="-1023.5017" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 50</text>
<text text-anchor="middle" x="2804" y="-992.1017" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2804" y="-976.7017" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE repl (</text>
<text text-anchor="middle" x="2804" y="-961.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2804" y="-945.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">project TEXT,</text>
<text text-anchor="middle" x="2804" y="-930.5016" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2804" y="-915.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP);</text>
<text text-anchor="middle" x="2804" y="-899.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-868.3015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line_stmt = [[</text>
<text text-anchor="middle" x="2804" y="-852.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES(?, ?);</text>
<text text-anchor="middle" x="2804" y="-837.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-806.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2804" y="-790.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2804" y="-775.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-743.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2804" y="-728.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT line FROM repl</text>
<text text-anchor="middle" x="2804" y="-713.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %s</text>
<text text-anchor="middle" x="2804" y="-697.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2804" y="-682.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2804" y="-666.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-635.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-620.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-588.701" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2804" y="-573.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2804" y="-557.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2804" y="-542.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2804" y="-527.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-511.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-496.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2804" y="-480.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_24&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2804,-1097.3545C2804,-1085.6486 2804,-1068.9796 2804,-1049.2294"/>
<polygon fill="#000000" stroke="#000000" points="2807.5001,-1048.9642 2804,-1038.9643 2800.5001,-1048.9643 2807.5001,-1048.9642"/>
</g>
<!-- raw_38 -->
<g id="node39" class="node">
<title>raw_38</title>
<ellipse fill="none" stroke="#000000" cx="3102" cy="-755.7013" rx="27" ry="18"/>
<text text-anchor="middle" x="3102" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_38 -->
<g id="edge38" class="edge">
<title>prose_25&#45;&gt;raw_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3033.274,-1099.8901C3044.4476,-1087.9918 3058.5563,-1070.6865 3066,-1052.6018 3104.0877,-960.0669 3105.2315,-838.5907 3103.47,-784.192"/>
<polygon fill="#000000" stroke="#000000" points="3106.9573,-783.7934 3103.0757,-773.9353 3099.9625,-784.0624 3106.9573,-783.7934"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="3429,-883.2017 3147,-883.2017 3147,-628.2008 3429,-628.2008 3429,-883.2017"/>
<text text-anchor="middle" x="3288" y="-868.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local STATCOL = 81</text>
<text text-anchor="middle" x="3288" y="-852.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local STAT_TOP = 1</text>
<text text-anchor="middle" x="3288" y="-837.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local STAT_RUN = 2</text>
<text text-anchor="middle" x="3288" y="-805.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">local function colwrite(str, col, row)</text>
<text text-anchor="middle" x="3288" y="-790.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;col = col or STATCOL</text>
<text text-anchor="middle" x="3288" y="-775.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;row = row or STAT_TOP</text>
<text text-anchor="middle" x="3288" y="-759.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local dash = a.stash()</text>
<text text-anchor="middle" x="3288" y="-744.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.cursor.hide()</text>
<text text-anchor="middle" x="3288" y="-728.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.jump(row, col)</text>
<text text-anchor="middle" x="3288" y="-713.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.erase.right()</text>
<text text-anchor="middle" x="3288" y="-698.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. str</text>
<text text-anchor="middle" x="3288" y="-682.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.pop()</text>
<text text-anchor="middle" x="3288" y="-667.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.cursor.show()</text>
<text text-anchor="middle" x="3288" y="-651.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(dash)</text>
<text text-anchor="middle" x="3288" y="-636.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_26&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>codeblock_26&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3220.6185,-1097.3545C3228.0302,-1059.7738 3245.5306,-971.0392 3260.8385,-893.4219"/>
<polygon fill="#000000" stroke="#000000" points="3264.2885,-894.017 3262.7896,-883.5287 3257.4208,-892.6625 3264.2885,-894.017"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="3904.5,-1052.5025 3447.5,-1052.5025 3447.5,-458.9001 3904.5,-458.9001 3904.5,-1052.5025"/>
<text text-anchor="middle" x="3676" y="-1037.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3676" y="-1022.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.home_dir .. &quot;/.bridge&quot;)</text>
<text text-anchor="middle" x="3676" y="-1006.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3676" y="-991.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_names = conn:exec(get_tables)</text>
<text text-anchor="middle" x="3676" y="-975.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not table_names or not has(table_names.name, &quot;repl&quot;) then</text>
<text text-anchor="middle" x="3676" y="-960.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, err = sql.pexec(conn, create_repl_table)</text>
<text text-anchor="middle" x="3676" y="-945.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; success is nil for creation, false for error</text>
<text text-anchor="middle" x="3676" y="-929.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success == false then</text>
<text text-anchor="middle" x="3676" y="-914.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="3676" y="-898.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-883.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-868.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt = conn:prepare(insert_line_stmt)</text>
<text text-anchor="middle" x="3676" y="-852.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_stmt = sql.format(get_recent, historian.project,</text>
<text text-anchor="middle" x="3676" y="-837.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3676" y="-821.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local values, err = sql.pexec(conn, pop_stmt)</text>
<text text-anchor="middle" x="3676" y="-806.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if values then</text>
<text text-anchor="middle" x="3676" y="-791.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.values = values</text>
<text text-anchor="middle" x="3676" y="-775.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local off = #values[1] + 1</text>
<text text-anchor="middle" x="3676" y="-760.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(values[1]) do</text>
<text text-anchor="middle" x="3676" y="-744.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[off &#45; i] = Linebuf(v)</text>
<text text-anchor="middle" x="3676" y="-729.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-714.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3676" y="-698.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="3676" y="-683.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return values</text>
<text text-anchor="middle" x="3676" y="-667.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-652.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3676" y="-621.001" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, linebuf)</text>
<text text-anchor="middle" x="3676" y="-605.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="3676" y="-590.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt:bind(historian.project, lb)</text>
<text text-anchor="middle" x="3676" y="-574.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local err = historian.insert_stmt:step()</text>
<text text-anchor="middle" x="3676" y="-559.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not err then</text>
<text text-anchor="middle" x="3676" y="-544.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="3676" y="-528.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3676" y="-513.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;error(error)</text>
<text text-anchor="middle" x="3676" y="-497.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-482.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="3676" y="-467.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_27&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>codeblock_27&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3543.1351,-1097.3545C3546.6547,-1088.3041 3551.328,-1076.287 3556.8168,-1062.1729"/>
<polygon fill="#000000" stroke="#000000" points="3560.1751,-1063.1938 3560.5376,-1052.6052 3553.651,-1060.6566 3560.1751,-1063.1938"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2292,-285.0018 1926,-285.0018 1926,-229.1989 2292,-229.1989 2292,-285.0018"/>
<text text-anchor="middle" x="2109" y="-237.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">This is where we either create query or create our</text>
</g>
<!-- raw_29&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>raw_29&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2242.7657,-737.5539C2241.7282,-690.5203 2236.1269,-561.2059 2206,-458.8007 2188.1822,-398.2356 2153.9093,-333.3026 2131.2454,-293.9417"/>
<polygon fill="#000000" stroke="#000000" points="2134.0875,-291.8666 2126.0329,-284.9836 2128.0372,-295.3872 2134.0875,-291.8666"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2364,-275.1004 2310,-275.1004 2310,-239.1004 2364,-239.1004 2364,-275.1004"/>
<text text-anchor="middle" x="2337" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>prespace_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2334.1085,-737.6612C2334.5588,-662.8368 2336.2812,-376.5588 2336.8306,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="2340.3313,-285.1371 2336.8916,-275.1161 2333.3314,-285.0949 2340.3313,-285.1371"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2466.5,-275.1004 2387.5,-275.1004 2387.5,-239.1004 2466.5,-239.1004 2466.5,-275.1004"/>
<text text-anchor="middle" x="2427" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">~/.bridge</text>
</g>
<!-- literal_31&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>literal_31&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2429.8915,-737.6612C2429.4412,-662.8368 2427.7188,-376.5588 2427.1694,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="2430.6686,-285.0949 2427.1084,-275.1161 2423.6687,-285.1371 2430.6686,-285.0949"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2571,-277.0024 2485,-277.0024 2485,-237.1983 2571,-237.1983 2571,-277.0024"/>
<text text-anchor="middle" x="2528" y="-261.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> database.</text>
</g>
<!-- raw_32&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>raw_32&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2506.796,-737.6612C2510.0749,-663.3485 2522.5567,-380.4647 2526.6738,-287.1572"/>
<polygon fill="#000000" stroke="#000000" points="2530.1781,-287.1349 2527.1224,-276.9903 2523.1849,-286.8263 2530.1781,-287.1349"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3218.5,-277.0024 2985.5,-277.0024 2985.5,-237.1983 3218.5,-237.1983 3218.5,-277.0024"/>
<text text-anchor="middle" x="3102" y="-245.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">bring in colwrite for diagnosis</text>
</g>
<!-- raw_38&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>raw_38&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3102,-737.6612C3102,-663.3485 3102,-380.4647 3102,-287.1572"/>
<polygon fill="#000000" stroke="#000000" points="3105.5001,-286.9903 3102,-276.9903 3098.5001,-286.9903 3105.5001,-286.9903"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="4071.5,-773.7013 3922.5,-773.7013 3922.5,-737.7013 4071.5,-737.7013 4071.5,-773.7013"/>
<text text-anchor="middle" x="3997" y="-752.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_42&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>header_42&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4010.2865,-1097.3545C4008.0022,-1038.6147 4000.8578,-854.9027 3998.1007,-784.0061"/>
<polygon fill="#000000" stroke="#000000" points="4001.5981,-783.8681 3997.7121,-774.0117 3994.6034,-784.1402 4001.5981,-783.8681"/>
</g>
<!-- raw_48 -->
<g id="node49" class="node">
<title>raw_48</title>
<ellipse fill="none" stroke="#000000" cx="4117" cy="-755.7013" rx="27" ry="18"/>
<text text-anchor="middle" x="4117" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_43&#45;&gt;raw_48 -->
<g id="edge48" class="edge">
<title>prose_43&#45;&gt;raw_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4185.726,-1099.8901C4174.5524,-1087.9918 4160.4437,-1070.6865 4153,-1052.6018 4114.9123,-960.0669 4113.7685,-838.5907 4115.53,-784.192"/>
<polygon fill="#000000" stroke="#000000" points="4119.0375,-784.0624 4115.9243,-773.9353 4112.0427,-783.7934 4119.0375,-784.0624"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="4605.5,-952.202 4162.5,-952.202 4162.5,-559.2005 4605.5,-559.2005 4605.5,-952.202"/>
<text text-anchor="middle" x="4384" y="-937.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="4384" y="-921.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="4384" y="-906.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="4384" y="-890.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4384" y="-875.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="4384" y="-860.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf = &quot;&quot;</text>
<text text-anchor="middle" x="4384" y="-844.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.up then</text>
<text text-anchor="middle" x="4384" y="-829.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor + delta]:clone()</text>
<text text-anchor="middle" x="4384" y="-813.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4384" y="-798.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor &#45; delta]:clone()</text>
<text text-anchor="middle" x="4384" y="-783.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4384" y="-767.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; delta</text>
<text text-anchor="middle" x="4384" y="-752.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="4384" y="-736.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.up = true</text>
<text text-anchor="middle" x="4384" y="-721.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;colwrite(tostring(linebuf) .. &quot; &quot;</text>
<text text-anchor="middle" x="4384" y="-706.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. tostring(historian[historian.cursor])</text>
<text text-anchor="middle" x="4384" y="-690.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot; &quot; .. historian.cursor</text>
<text text-anchor="middle" x="4384" y="-675.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot; &quot; .. delta, nil, 4)</text>
<text text-anchor="middle" x="4384" y="-659.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor &lt;= #historian.values[1] then</text>
<text text-anchor="middle" x="4384" y="-644.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;colwrite(historian.values[1][historian.cursor], nil, 5)</text>
<text text-anchor="middle" x="4384" y="-629.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4384" y="-613.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;colwrite(&quot;&quot;, nil, 5)</text>
<text text-anchor="middle" x="4384" y="-598.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4384" y="-582.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return linebuf</text>
<text text-anchor="middle" x="4384" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_44&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_44&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4356.478,-1097.3545C4358.623,-1070.7264 4362.8369,-1018.4164 4367.3351,-962.5764"/>
<polygon fill="#000000" stroke="#000000" points="4370.8337,-962.7336 4368.148,-952.4849 4363.8563,-962.1715 4370.8337,-962.7336"/>
</g>
<!-- header_51 -->
<g id="node52" class="node">
<title>header_51</title>
<ellipse fill="none" stroke="#000000" cx="4706" cy="-755.7013" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="4706" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_45&#45;&gt;header_51 -->
<g id="edge51" class="edge">
<title>section_45&#45;&gt;header_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4768.6363,-1097.3545C4757.8674,-1038.6147 4724.1869,-854.9027 4711.1892,-784.0061"/>
<polygon fill="#000000" stroke="#000000" points="4714.6029,-783.2166 4709.3569,-774.0117 4707.7176,-784.479 4714.6029,-783.2166"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4839" cy="-755.7013" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4839" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_45&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_45&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4780.5049,-1097.5899C4785.9982,-1085.1812 4792.8674,-1068.2071 4797,-1052.6018 4822.6211,-955.852 4833.4473,-836.9693 4837.2503,-783.7635"/>
<polygon fill="#000000" stroke="#000000" points="4840.7458,-783.9469 4837.9388,-773.7307 4833.7622,-783.4676 4840.7458,-783.9469"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="5076" cy="-755.7013" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5076" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 169&#45;191</text>
</g>
<!-- section_45&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_45&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4808.0601,-1099.8753C4830.482,-1088.8362 4858.9476,-1072.5328 4880,-1052.6018 4968.0082,-969.2819 5036.2517,-839.2616 5063.3249,-783.0804"/>
<polygon fill="#000000" stroke="#000000" points="5066.6117,-784.3189 5067.7515,-773.7855 5060.2918,-781.309 5066.6117,-784.3189"/>
</g>
<!-- header_64 -->
<g id="node65" class="node">
<title>header_64</title>
<ellipse fill="none" stroke="#000000" cx="5500" cy="-755.7013" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="5500" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_46&#45;&gt;header_64 -->
<g id="edge64" class="edge">
<title>section_46&#45;&gt;header_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5707.4298,-1100.7447C5683.0439,-1090.3867 5653.3427,-1074.4963 5633,-1052.6018 5557.7206,-971.5799 5519.7894,-840.7993 5506.1147,-783.7828"/>
<polygon fill="#000000" stroke="#000000" points="5509.5188,-782.9681 5503.8401,-774.0236 5502.7015,-784.5571 5509.5188,-782.9681"/>
</g>
<!-- prose_65 -->
<g id="node66" class="node">
<title>prose_65</title>
<ellipse fill="none" stroke="#000000" cx="5674" cy="-755.7013" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5674" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_46&#45;&gt;prose_65 -->
<g id="edge65" class="edge">
<title>section_46&#45;&gt;prose_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5743.6378,-1097.6439C5739.3818,-1085.1154 5733.8726,-1067.9807 5730,-1052.6018 5705.4346,-955.047 5686.2463,-837.0257 5678.1657,-783.9566"/>
<polygon fill="#000000" stroke="#000000" points="5681.6075,-783.3075 5676.6557,-773.9411 5674.6857,-784.3511 5681.6075,-783.3075"/>
</g>
<!-- codeblock_66 -->
<g id="node67" class="node">
<title>codeblock_66</title>
<ellipse fill="none" stroke="#000000" cx="5826" cy="-755.7013" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5826" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 196&#45;204</text>
</g>
<!-- section_46&#45;&gt;codeblock_66 -->
<g id="edge66" class="edge">
<title>section_46&#45;&gt;codeblock_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5753.8733,-1097.3545C5766.2739,-1038.6147 5805.0575,-854.9027 5820.0246,-784.0061"/>
<polygon fill="#000000" stroke="#000000" points="5823.4933,-784.5191 5822.1345,-774.0117 5816.6443,-783.0731 5823.4933,-784.5191"/>
</g>
<!-- codeblock_67 -->
<g id="node68" class="node">
<title>codeblock_67</title>
<ellipse fill="none" stroke="#000000" cx="6089" cy="-755.7013" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6089" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 206&#45;213</text>
</g>
<!-- section_46&#45;&gt;codeblock_67 -->
<g id="edge67" class="edge">
<title>section_46&#45;&gt;codeblock_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5809.871,-1104.6782C5845.6324,-1095.6157 5890.1451,-1079.7074 5922,-1052.6018 6010.8033,-977.0386 6061.8769,-841.76 6080.663,-783.568"/>
<polygon fill="#000000" stroke="#000000" points="6084.0266,-784.5392 6083.6988,-773.9495 6077.3512,-782.4323 6084.0266,-784.5392"/>
</g>
<!-- codeblock_68 -->
<g id="node69" class="node">
<title>codeblock_68</title>
<ellipse fill="none" stroke="#000000" cx="6318" cy="-755.7013" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6318" y="-751.5013" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 215&#45;217</text>
</g>
<!-- section_46&#45;&gt;codeblock_68 -->
<g id="edge68" class="edge">
<title>section_46&#45;&gt;codeblock_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5825.0378,-1113.3844C5934.1788,-1108.6116 6129.7373,-1094.3384 6185,-1052.6018 6274.5007,-985.0074 6305.1773,-843.6334 6314.4361,-783.6117"/>
<polygon fill="#000000" stroke="#000000" points="6317.8998,-784.1143 6315.8804,-773.7137 6310.9731,-783.1036 6317.8998,-784.1143"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4144,-275.1004 4090,-275.1004 4090,-239.1004 4144,-239.1004 4144,-275.1004"/>
</g>
<!-- raw_48&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>raw_48&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4117,-737.6612C4117,-662.8368 4117,-376.5588 4117,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="4120.5001,-285.1161 4117,-275.1161 4113.5001,-285.1162 4120.5001,-285.1161"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="4607,-275.1004 4451,-275.1004 4451,-239.1004 4607,-239.1004 4607,-275.1004"/>
<text text-anchor="middle" x="4529" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_51&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_51&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4701.0131,-737.4204C4688.0948,-690.5982 4651.8974,-562.7313 4614,-458.8007 4590.9365,-395.5509 4559.085,-323.2423 4541.6554,-284.7069"/>
<polygon fill="#000000" stroke="#000000" points="4544.6669,-282.8734 4537.3449,-275.2158 4538.2934,-285.7681 4544.6669,-282.8734"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="4652" cy="-257.1004" rx="27" ry="18"/>
<text text-anchor="middle" x="4652" y="-252.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_52&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4842.3282,-737.7953C4850.6134,-687.3451 4866.7726,-542.2853 4797,-458.8007 4764.283,-419.654 4722.1314,-460.7205 4688,-422.8007 4653.7316,-384.7287 4649.4157,-321.8614 4650.1668,-285.4932"/>
<polygon fill="#000000" stroke="#000000" points="4653.6781,-285.2319 4650.535,-275.1141 4646.6826,-284.9837 4653.6781,-285.2319"/>
</g>
<!-- prespace_56 -->
<g id="node57" class="node">
<title>prespace_56</title>
<ellipse fill="none" stroke="#000000" cx="4743" cy="-257.1004" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="4743" y="-252.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_52&#45;&gt;prespace_56 -->
<g id="edge56" class="edge">
<title>prose_52&#45;&gt;prespace_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4837.201,-737.4965C4832.4243,-690.853 4818.3127,-563.3707 4797,-458.8007 4784.1954,-395.9753 4763.3075,-323.6814 4751.6182,-284.9922"/>
<polygon fill="#000000" stroke="#000000" points="4754.8392,-283.5545 4748.5794,-275.0067 4748.1424,-285.5925 4754.8392,-283.5545"/>
</g>
<!-- literal_57 -->
<g id="node58" class="node">
<title>literal_57</title>
<ellipse fill="none" stroke="#000000" cx="4839" cy="-257.1004" rx="31.481" ry="18"/>
<text text-anchor="middle" x="4839" y="-252.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_52&#45;&gt;literal_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;literal_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4839,-737.6612C4839,-662.8368 4839,-376.5588 4839,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="4842.5001,-285.1161 4839,-275.1161 4835.5001,-285.1162 4842.5001,-285.1161"/>
</g>
<!-- raw_58 -->
<g id="node59" class="node">
<title>raw_58</title>
<ellipse fill="none" stroke="#000000" cx="4915" cy="-257.1004" rx="27" ry="18"/>
<text text-anchor="middle" x="4915" y="-252.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_58 -->
<g id="edge58" class="edge">
<title>prose_52&#45;&gt;raw_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4841.7498,-737.6612C4853.155,-662.8368 4896.7914,-376.5588 4910.7082,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="4914.207,-285.5294 4912.2539,-275.1161 4907.2869,-284.4745 4914.207,-285.5294"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="5389.5,-423.0013 4960.5,-423.0013 4960.5,-91.1995 5389.5,-91.1995 5389.5,-423.0013"/>
<text text-anchor="middle" x="5175" y="-407.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="5175" y="-392.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="5175" y="-376.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="5175" y="-361.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="5175" y="-346.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5175" y="-330.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf</text>
<text text-anchor="middle" x="5175" y="-315.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not historian.up then</text>
<text text-anchor="middle" x="5175" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor &#45; delta]:clone()</text>
<text text-anchor="middle" x="5175" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="5175" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor + delta]:clone()</text>
<text text-anchor="middle" x="5175" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5175" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + delta</text>
<text text-anchor="middle" x="5175" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[&quot;delta&quot;] = delta</text>
<text text-anchor="middle" x="5175" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="5175" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="5175" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (delta &gt; 0) and #linebuf.line &gt; 0 then</text>
<text text-anchor="middle" x="5175" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, true</text>
<text text-anchor="middle" x="5175" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="5175" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, false</text>
<text text-anchor="middle" x="5175" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5175" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_53&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>codeblock_53&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5079.5819,-737.6612C5089.2997,-688.7191 5116.9802,-549.3095 5140.0405,-433.1693"/>
<polygon fill="#000000" stroke="#000000" points="5143.5299,-433.5667 5142.0445,-423.0765 5136.6639,-432.2034 5143.5299,-433.5667"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4699,-55.6015 4221,-55.6015 4221,.2015 4699,.2015 4699,-55.6015"/>
<text text-anchor="middle" x="4460" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next linebuf in history, and a second flag to tell the</text>
</g>
<!-- raw_55&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>raw_55&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4653.2,-239.0662C4654.4134,-205.8758 4652.2542,-134.5712 4616,-91.4 4605.3279,-78.6919 4591.7257,-68.4879 4577.0158,-60.3023"/>
<polygon fill="#000000" stroke="#000000" points="4578.2154,-56.9807 4567.73,-55.4621 4574.9798,-63.1881 4578.2154,-56.9807"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="4771,-45.7 4717,-45.7 4717,-9.7 4771,-9.7 4771,-45.7"/>
</g>
<!-- prespace_56&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>prespace_56&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4743.0785,-239.0997C4743.2515,-199.4137 4743.6668,-104.128 4743.8757,-56.219"/>
<polygon fill="#000000" stroke="#000000" points="4747.3768,-55.9497 4743.9205,-45.9345 4740.3769,-55.9191 4747.3768,-55.9497"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4889,-45.7 4789,-45.7 4789,-9.7 4889,-9.7 4889,-45.7"/>
<text text-anchor="middle" x="4839" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_57&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>literal_57&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4839,-239.0997C4839,-199.4137 4839,-104.128 4839,-56.219"/>
<polygon fill="#000000" stroke="#000000" points="4842.5001,-55.9344 4839,-45.9345 4835.5001,-55.9345 4842.5001,-55.9344"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="5147,-45.7 4907,-45.7 4907,-9.7 5147,-9.7 5147,-45.7"/>
<text text-anchor="middle" x="5027" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_58&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>raw_58&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4915.1848,-239.0311C4916.2841,-207.0002 4922.1475,-139.1453 4951,-91.4 4960.291,-76.0253 4974.6341,-62.6012 4988.3674,-52.0919"/>
<polygon fill="#000000" stroke="#000000" points="4990.7828,-54.6616 4996.7889,-45.9336 4986.6509,-49.0112 4990.7828,-54.6616"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="5578,-275.1004 5408,-275.1004 5408,-239.1004 5578,-239.1004 5578,-275.1004"/>
<text text-anchor="middle" x="5493" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_64&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>header_64&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5499.7467,-737.6612C5498.6962,-662.8368 5494.6771,-376.5588 5493.3953,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="5496.8931,-285.066 5493.2529,-275.1161 5489.8937,-285.1643 5496.8931,-285.066"/>
</g>
<!-- raw_70 -->
<g id="node71" class="node">
<title>raw_70</title>
<ellipse fill="none" stroke="#000000" cx="5623" cy="-257.1004" rx="27" ry="18"/>
<text text-anchor="middle" x="5623" y="-252.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_65&#45;&gt;raw_70 -->
<g id="edge70" class="edge">
<title>prose_65&#45;&gt;raw_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5672.1548,-737.6612C5664.5012,-662.8368 5635.2189,-376.5588 5625.88,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="5629.3422,-284.7081 5624.8428,-275.1161 5622.3786,-285.4204 5629.3422,-284.7081"/>
</g>
<!-- leaf_72 -->
<g id="node73" class="node">
<title>leaf_72</title>
<polygon fill="none" stroke="#c0c0c0" points="5999.5,-314.9007 5668.5,-314.9007 5668.5,-199.3 5999.5,-199.3 5999.5,-314.9007"/>
<text text-anchor="middle" x="5834" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, linebuf)</text>
<text text-anchor="middle" x="5834" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = linebuf</text>
<text text-anchor="middle" x="5834" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="5834" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="5834" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:persist(linebuf)</text>
<text text-anchor="middle" x="5834" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="5834" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_66&#45;&gt;leaf_72 -->
<g id="edge72" class="edge">
<title>codeblock_66&#45;&gt;leaf_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5826.2895,-737.6612C5827.3472,-671.7363 5831.0387,-441.6666 5832.9037,-325.4256"/>
<polygon fill="#000000" stroke="#000000" points="5836.4065,-325.2744 5833.0675,-315.2195 5829.4074,-325.162 5836.4065,-325.2744"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="6286,-307.5013 6018,-307.5013 6018,-206.6994 6286,-206.6994 6286,-307.5013"/>
<text text-anchor="middle" x="6152" y="-292.1005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="6152" y="-276.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="6152" y="-261.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="6152" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="6152" y="-230.5003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6152" y="-215.1003" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_67&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>codeblock_67&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6091.2794,-737.6612C6099.7934,-670.2789 6129.9748,-431.4141 6144.3195,-317.8863"/>
<polygon fill="#000000" stroke="#000000" points="6147.8342,-317.9892 6145.6155,-307.6293 6140.8894,-317.1116 6147.8342,-317.9892"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="6390,-275.1004 6304,-275.1004 6304,-239.1004 6390,-239.1004 6390,-275.1004"/>
<text text-anchor="middle" x="6347" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_68&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>codeblock_68&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6319.0493,-737.6612C6323.4013,-662.8368 6340.052,-376.5588 6345.3624,-285.2567"/>
<polygon fill="#000000" stroke="#000000" points="6348.8655,-285.3025 6345.9522,-275.1161 6341.8773,-284.896 6348.8655,-285.3025"/>
</g>
<!-- leaf_71 -->
<g id="node72" class="node">
<title>leaf_71</title>
<polygon fill="none" stroke="#c0c0c0" points="5650,-45.7 5596,-45.7 5596,-9.7 5650,-9.7 5650,-45.7"/>
</g>
<!-- raw_70&#45;&gt;leaf_71 -->
<g id="edge71" class="edge">
<title>raw_70&#45;&gt;leaf_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5623,-239.0997C5623,-199.4137 5623,-104.128 5623,-56.219"/>
<polygon fill="#000000" stroke="#000000" points="5626.5001,-55.9344 5623,-45.9345 5619.5001,-55.9345 5626.5001,-55.9344"/>
</g>
</g>
</svg>
