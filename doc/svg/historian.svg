<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="18461pt" height="2879pt"
 viewBox="0.00 0.00 18461.00 2879.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2875.4044)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2875.4044 18457,-2875.4044 18457,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2853.4044" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1787" y="-2849.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 589</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2781.4044" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1787" y="-2777.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;483</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2835.2358C1787,-2827.5354 1787,-2818.3787 1787,-2809.821"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2809.8176 1787,-2799.8177 1783.5001,-2809.8177 1790.5001,-2809.8176"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1168" cy="-2709.4044" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1168" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1725.4565,-2774.8517C1633.9363,-2765.0265 1456.5725,-2745.675 1306,-2727.4044 1281.4502,-2724.4255 1254.4713,-2720.9513 1230.9302,-2717.854"/>
<polygon fill="#000000" stroke="#000000" points="1231.0962,-2714.3456 1220.7241,-2716.5065 1230.1799,-2721.2854 1231.0962,-2714.3456"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1347" cy="-2709.4044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1347" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1726.8328,-2774.0768C1654.436,-2764.8918 1529.3399,-2747.8465 1423,-2727.4044 1411.0534,-2725.1078 1398.1458,-2722.2102 1386.4181,-2719.4148"/>
<polygon fill="#000000" stroke="#000000" points="1387.0127,-2715.9576 1376.4695,-2717.0022 1385.363,-2722.7604 1387.0127,-2715.9576"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1464" cy="-2709.4044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1464" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.5408,-2771.6357C1677.8804,-2761.8138 1594.4109,-2745.5579 1523,-2727.4044 1516.1661,-2725.6671 1508.9445,-2723.6328 1501.9868,-2721.5691"/>
<polygon fill="#000000" stroke="#000000" points="1502.6431,-2718.1107 1492.0577,-2718.5557 1500.6102,-2724.809 1502.6431,-2718.1107"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1564" cy="-2709.4044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1564" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1742.3852,-2768.0547C1707.3486,-2757.4322 1657.3972,-2741.9814 1614,-2727.4044 1609.6517,-2725.9438 1605.1065,-2724.3716 1600.6048,-2722.7863"/>
<polygon fill="#000000" stroke="#000000" points="1601.5075,-2719.3924 1590.9128,-2719.3329 1599.1579,-2725.9864 1601.5075,-2719.3924"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1655" cy="-2709.4044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1655" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1757.3766,-2765.2462C1736.5856,-2753.9057 1708.7908,-2738.7449 1687.4091,-2727.0821"/>
<polygon fill="#000000" stroke="#000000" points="1688.8366,-2723.8739 1678.3816,-2722.158 1685.4846,-2730.0192 1688.8366,-2723.8739"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2709.4044" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1787" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2763.2358C1787,-2755.5354 1787,-2746.3787 1787,-2737.821"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2737.8176 1787,-2727.8177 1783.5001,-2737.8177 1790.5001,-2737.8176"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2066" cy="-2709.4044" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2066" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 31&#45;33</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1834.9618,-2769.0272C1881.7022,-2756.9651 1952.9893,-2738.5684 2004.0105,-2725.4017"/>
<polygon fill="#000000" stroke="#000000" points="2005.1231,-2728.7293 2013.9312,-2722.8415 2003.3739,-2721.9514 2005.1231,-2728.7293"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2709.4044" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;226</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1849.5748,-2775.8146C1995.3393,-2762.7934 2357.1653,-2730.4715 2516.0774,-2716.2759"/>
<polygon fill="#000000" stroke="#000000" points="2516.5979,-2719.7434 2526.2468,-2715.3675 2515.975,-2712.7712 2516.5979,-2719.7434"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7307" cy="-2709.4044" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7307" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 284&#45;319</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.8377,-2780.5456C2426.4627,-2773.0636 6570.374,-2719.0126 7221.1088,-2710.5247"/>
<polygon fill="#000000" stroke="#000000" points="7221.3907,-2714.0214 7231.3442,-2710.3912 7221.2993,-2707.022 7221.3907,-2714.0214"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11890" cy="-2709.4044" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11890" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 396&#45;463</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.8447,-2780.9352C2671.9167,-2775.098 10873.0109,-2716.6521 11804.0846,-2710.0167"/>
<polygon fill="#000000" stroke="#000000" points="11804.4045,-2713.5146 11814.3793,-2709.9433 11804.3545,-2706.5148 11804.4045,-2713.5146"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="15218" cy="-2709.4044" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15218" y="-2705.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 484&#45;554</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.6648,-2781.0626C2495.4669,-2777.7151 7731.6302,-2750.4184 11974,-2727.4044 13229.0835,-2720.5958 14757.3061,-2712.0009 15132.0392,-2709.8892"/>
<polygon fill="#000000" stroke="#000000" points="15132.2817,-2713.388 15142.2618,-2709.8316 15132.2422,-2706.3881 15132.2817,-2713.388"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1209.5,-2576.7042 1116.5,-2576.7042 1116.5,-2540.7042 1209.5,-2540.7042 1209.5,-2576.7042"/>
<text text-anchor="middle" x="1163" y="-2555.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.3969,-2691.2264C1166.5372,-2665.3161 1164.9516,-2617.5259 1163.9379,-2586.9713"/>
<polygon fill="#000000" stroke="#000000" points="1167.435,-2586.8251 1163.6053,-2576.9467 1160.4389,-2587.0573 1167.435,-2586.8251"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1255" cy="-2558.7042" rx="27" ry="18"/>
<text text-anchor="middle" x="1255" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1327.9913,-2694.8388C1316.0186,-2684.8388 1300.9919,-2670.6559 1291,-2655.4044 1277.0392,-2634.0949 1267.4798,-2606.6197 1261.74,-2586.4051"/>
<polygon fill="#000000" stroke="#000000" points="1265.0694,-2585.3089 1259.0835,-2576.567 1258.3114,-2587.1337 1265.0694,-2585.3089"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1327" cy="-2558.7042" rx="27" ry="18"/>
<text text-anchor="middle" x="1327" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1435.5777,-2700.5134C1413.0939,-2692.1509 1382.3621,-2677.5652 1363,-2655.4044 1345.9597,-2635.9011 1336.6846,-2607.5855 1331.8386,-2586.6312"/>
<polygon fill="#000000" stroke="#000000" points="1335.2362,-2585.7801 1329.7457,-2576.7189 1328.3872,-2587.2263 1335.2362,-2585.7801"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1399" cy="-2558.7042" rx="27" ry="18"/>
<text text-anchor="middle" x="1399" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1535.8285,-2700.5453C1502.4164,-2689.5504 1449.4236,-2670.4176 1435,-2655.4044 1416.951,-2636.6176 1407.7908,-2607.9687 1403.245,-2586.7256"/>
<polygon fill="#000000" stroke="#000000" points="1406.6383,-2585.8366 1401.3155,-2576.676 1399.7639,-2587.1566 1406.6383,-2585.8366"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1471" cy="-2558.7042" rx="27" ry="18"/>
<text text-anchor="middle" x="1471" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1627.6371,-2699.5011C1585.0185,-2684.0653 1507.5624,-2655.9631 1507,-2655.4044 1488.5183,-2637.0431 1479.417,-2608.3362 1475.0028,-2586.9637"/>
<polygon fill="#000000" stroke="#000000" points="1478.3932,-2586.0475 1473.1442,-2576.8443 1471.5084,-2587.3121 1478.3932,-2586.0475"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057.5,-2655.605 1516.5,-2655.605 1516.5,-2461.8035 2057.5,-2461.8035 2057.5,-2655.605"/>
<text text-anchor="middle" x="1787" y="-2640.2044" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf &#160;= require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2624.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">local Rainbuf = require &quot;rainbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2609.4043" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= assert(sql, &quot;sql must be in bridge _G&quot;)</text>
<text text-anchor="middle" x="1787" y="-2594.0043" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= (require &quot;color&quot;).color</text>
<text text-anchor="middle" x="1787" y="-2562.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1787" y="-2547.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">local repr &#160;&#160;&#160;= require &quot;repr&quot;</text>
<text text-anchor="middle" x="1787" y="-2531.8042" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1787" y="-2516.4042" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1787" y="-2501.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints, &quot;must have string.codepoints&quot;)</text>
<text text-anchor="middle" x="1787" y="-2485.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1787" y="-2470.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2691.2264C1787,-2684.138 1787,-2675.412 1787,-2665.8494"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2665.6148 1787,-2655.6148 1783.5001,-2665.6149 1790.5001,-2665.6148"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2576.7042 2075.5,-2576.7042 2075.5,-2540.7042 2266.5,-2540.7042 2266.5,-2576.7042"/>
<text text-anchor="middle" x="2171" y="-2555.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2078.4572,-2691.5253C2096.7509,-2665.2695 2131.0148,-2616.0926 2152.3267,-2585.5048"/>
<polygon fill="#000000" stroke="#000000" points="2155.3865,-2587.2357 2158.2315,-2577.03 2149.6431,-2583.234 2155.3865,-2587.2357"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2558.7042" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2535.7611,-2698.7305C2502.9874,-2690.6518 2462.2926,-2677.131 2431,-2655.4044 2404.4905,-2636.9988 2382.3237,-2607.0747 2368.4791,-2585.3842"/>
<polygon fill="#000000" stroke="#000000" points="2371.3093,-2583.3067 2363.0668,-2576.6499 2365.3591,-2586.9938 2371.3093,-2583.3067"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2560.4768,-2693.2483C2544.4684,-2683.9742 2525.8911,-2671.0545 2513,-2655.4044 2496.3379,-2635.1762 2485.462,-2607.1832 2479.127,-2586.519"/>
<polygon fill="#000000" stroke="#000000" points="2482.4407,-2585.3788 2476.2989,-2576.7458 2475.7166,-2587.3246 2482.4407,-2585.3788"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2558.7042" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 40&#45;144</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2691.2264C2593,-2665.3161 2593,-2617.5259 2593,-2586.9713"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2586.9466 2593,-2576.9467 2589.5001,-2586.9467 2596.5001,-2586.9466"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2991" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 145&#45;215</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2632.6168,-2694.4037C2705.6419,-2666.7532 2861.3035,-2607.813 2941.2877,-2577.5275"/>
<polygon fill="#000000" stroke="#000000" points="2942.5434,-2580.7946 2950.656,-2573.9802 2940.0646,-2574.2482 2942.5434,-2580.7946"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="4147" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4147" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 216&#45;226</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2659.2763,-2702.9772C2909.2271,-2678.7381 3794.3676,-2592.901 4066.6821,-2566.4931"/>
<polygon fill="#000000" stroke="#000000" points="4067.2647,-2569.9531 4076.8802,-2565.5041 4066.589,-2562.9858 4067.2647,-2569.9531"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4967" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4967" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 227&#45;283</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.4867,-2707.9993C2935.8023,-2702.4281 3919.4185,-2680.9477 4231,-2655.4044 4475.4212,-2635.3669 4763.1403,-2591.6877 4894.7356,-2570.5855"/>
<polygon fill="#000000" stroke="#000000" points="4895.3819,-2574.0266 4904.6992,-2568.983 4894.2703,-2567.1154 4895.3819,-2574.0266"/>
</g>
<!-- header_99 -->
<g id="node100" class="node">
<title>header_99</title>
<ellipse fill="none" stroke="#000000" cx="7108" cy="-2558.7042" rx="107.339" ry="18"/>
<text text-anchor="middle" x="7108" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_99 -->
<g id="edge99" class="edge">
<title>section_10&#45;&gt;header_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7279.5362,-2692.371C7263.3663,-2682.0844 7242.6829,-2668.4747 7225,-2655.4044 7193.532,-2632.1448 7159.2047,-2603.3333 7135.9226,-2583.2364"/>
<polygon fill="#000000" stroke="#000000" points="7138.0191,-2580.4217 7128.1709,-2576.5147 7133.4331,-2585.7104 7138.0191,-2580.4217"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="7266" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7266" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_10&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7302.0544,-2691.2264C7295.0052,-2665.3161 7282.0032,-2617.5259 7273.6904,-2586.9713"/>
<polygon fill="#000000" stroke="#000000" points="7276.9656,-2585.6771 7270.9631,-2576.9467 7270.2111,-2587.5148 7276.9656,-2585.6771"/>
</g>
<!-- prose_101 -->
<g id="node102" class="node">
<title>prose_101</title>
<ellipse fill="none" stroke="#000000" cx="7348" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7348" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_101 -->
<g id="edge101" class="edge">
<title>section_10&#45;&gt;prose_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7311.9456,-2691.2264C7318.9948,-2665.3161 7331.9968,-2617.5259 7340.3096,-2586.9713"/>
<polygon fill="#000000" stroke="#000000" points="7343.7889,-2587.5148 7343.0369,-2576.9467 7337.0344,-2585.6771 7343.7889,-2587.5148"/>
</g>
<!-- section_102 -->
<g id="node103" class="node">
<title>section_102</title>
<ellipse fill="none" stroke="#000000" cx="7935" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7935" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 294&#45;319</text>
</g>
<!-- section_10&#45;&gt;section_102 -->
<g id="edge102" class="edge">
<title>section_10&#45;&gt;section_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7360.272,-2696.6208C7475.6138,-2668.9424 7748.0175,-2603.5741 7871.8091,-2573.8681"/>
<polygon fill="#000000" stroke="#000000" points="7872.6261,-2577.2714 7881.5333,-2571.5345 7870.9926,-2570.4647 7872.6261,-2577.2714"/>
</g>
<!-- section_103 -->
<g id="node104" class="node">
<title>section_103</title>
<ellipse fill="none" stroke="#000000" cx="9467" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9467" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 320&#45;395</text>
</g>
<!-- section_10&#45;&gt;section_103 -->
<g id="edge103" class="edge">
<title>section_10&#45;&gt;section_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7379.4847,-2704.3472C7705.7833,-2681.5819 9037.4956,-2588.6701 9384.1769,-2564.4827"/>
<polygon fill="#000000" stroke="#000000" points="9384.6565,-2567.9578 9394.3886,-2563.7702 9384.1693,-2560.9748 9384.6565,-2567.9578"/>
</g>
<!-- header_151 -->
<g id="node152" class="node">
<title>header_151</title>
<ellipse fill="none" stroke="#000000" cx="10547" cy="-2558.7042" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10547" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_151 -->
<g id="edge151" class="edge">
<title>section_11&#45;&gt;header_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11814.5862,-2707.5725C11576.6792,-2701.5519 10851.6396,-2681.2721 10749,-2655.4044 10687.5696,-2639.9225 10622.5068,-2604.975 10583.3209,-2581.6124"/>
<polygon fill="#000000" stroke="#000000" points="10584.7804,-2578.4051 10574.4106,-2576.2329 10581.1624,-2584.3977 10584.7804,-2578.4051"/>
</g>
<!-- prose_152 -->
<g id="node153" class="node">
<title>prose_152</title>
<ellipse fill="none" stroke="#000000" cx="10790" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10790" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_152 -->
<g id="edge152" class="edge">
<title>section_11&#45;&gt;prose_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11823.2876,-2700.9183C11741.442,-2690.4576 11598.4626,-2672.022 11476,-2655.4044 11231.4759,-2622.2237 10938.2742,-2580.1168 10831.4773,-2564.7033"/>
<polygon fill="#000000" stroke="#000000" points="10831.8347,-2561.2187 10821.4372,-2563.2536 10830.8343,-2568.1469 10831.8347,-2561.2187"/>
</g>
<!-- prose_153 -->
<g id="node154" class="node">
<title>prose_153</title>
<ellipse fill="none" stroke="#000000" cx="11517" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11517" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_153 -->
<g id="edge153" class="edge">
<title>section_11&#45;&gt;prose_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11817.2768,-2704.4246C11762.8105,-2698.3737 11687.7182,-2684.9887 11628,-2655.4044 11591.9441,-2637.5424 11558.2546,-2605.077 11537.6577,-2582.7258"/>
<polygon fill="#000000" stroke="#000000" points="11540.2356,-2580.3583 11530.9359,-2575.2822 11535.0404,-2585.0497 11540.2356,-2580.3583"/>
</g>
<!-- prose_154 -->
<g id="node155" class="node">
<title>prose_154</title>
<ellipse fill="none" stroke="#000000" cx="11669" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11669" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_154 -->
<g id="edge154" class="edge">
<title>section_11&#45;&gt;prose_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11865.0781,-2692.4101C11823.8905,-2664.3242 11741.8306,-2608.3675 11698.0679,-2578.5257"/>
<polygon fill="#000000" stroke="#000000" points="11699.8281,-2575.4897 11689.5942,-2572.7475 11695.8843,-2581.273 11699.8281,-2575.4897"/>
</g>
<!-- prose_155 -->
<g id="node156" class="node">
<title>prose_155</title>
<ellipse fill="none" stroke="#000000" cx="11890" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11890" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_155 -->
<g id="edge155" class="edge">
<title>section_11&#45;&gt;prose_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11890,-2691.2264C11890,-2665.3161 11890,-2617.5259 11890,-2586.9713"/>
<polygon fill="#000000" stroke="#000000" points="11893.5001,-2586.9466 11890,-2576.9467 11886.5001,-2586.9467 11893.5001,-2586.9466"/>
</g>
<!-- prose_156 -->
<g id="node157" class="node">
<title>prose_156</title>
<ellipse fill="none" stroke="#000000" cx="12090" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12090" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_156 -->
<g id="edge156" class="edge">
<title>section_11&#45;&gt;prose_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11912.9425,-2692.1172C11949.9361,-2664.2425 12022.6284,-2609.4688 12062.3977,-2579.5026"/>
<polygon fill="#000000" stroke="#000000" points="12064.7127,-2582.1406 12070.593,-2573.3274 12060.5002,-2576.55 12064.7127,-2582.1406"/>
</g>
<!-- prose_157 -->
<g id="node158" class="node">
<title>prose_157</title>
<ellipse fill="none" stroke="#000000" cx="13067" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13067" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_157 -->
<g id="edge157" class="edge">
<title>section_11&#45;&gt;prose_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11956.653,-2700.8703C12172.7761,-2673.1984 12850.2866,-2586.4517 13025.3706,-2564.0344"/>
<polygon fill="#000000" stroke="#000000" points="13025.989,-2567.4838 13035.4635,-2562.7421 13025.0999,-2560.5405 13025.989,-2567.4838"/>
</g>
<!-- prose_158 -->
<g id="node159" class="node">
<title>prose_158</title>
<ellipse fill="none" stroke="#000000" cx="13230" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13230" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_158 -->
<g id="edge158" class="edge">
<title>section_11&#45;&gt;prose_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11965.5162,-2708.7544C12214.7579,-2706.237 13001.4134,-2695.1916 13108,-2655.4044 13148.7204,-2640.2041 13186.4255,-2605.9397 13208.8338,-2582.5623"/>
<polygon fill="#000000" stroke="#000000" points="13211.5468,-2584.7858 13215.829,-2575.0949 13206.4381,-2580.0001 13211.5468,-2584.7858"/>
</g>
<!-- codeblock_159 -->
<g id="node160" class="node">
<title>codeblock_159</title>
<ellipse fill="none" stroke="#000000" cx="13501" cy="-2558.7042" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13501" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 417&#45;461</text>
</g>
<!-- section_11&#45;&gt;codeblock_159 -->
<g id="edge159" class="edge">
<title>section_11&#45;&gt;codeblock_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11965.6669,-2708.027C12235.8356,-2702.8914 13143.6357,-2683.6904 13271,-2655.4044 13341.0732,-2639.842 13416.8016,-2603.9081 13461.5018,-2580.4972"/>
<polygon fill="#000000" stroke="#000000" points="13463.356,-2583.4758 13470.5561,-2575.7035 13460.0807,-2577.2893 13463.356,-2583.4758"/>
</g>
<!-- section_160 -->
<g id="node161" class="node">
<title>section_160</title>
<ellipse fill="none" stroke="#000000" cx="14356" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14356" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 464&#45;483</text>
</g>
<!-- section_11&#45;&gt;section_160 -->
<g id="edge160" class="edge">
<title>section_11&#45;&gt;section_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11965.4011,-2707.9748C12251.888,-2702.3942 13272.9774,-2681.112 13597,-2655.4044 13849.953,-2635.3354 14148.0119,-2591.3749 14283.0196,-2570.3521"/>
<polygon fill="#000000" stroke="#000000" points="14283.8955,-2573.7578 14293.2357,-2568.7565 14282.8153,-2566.8416 14283.8955,-2573.7578"/>
</g>
<!-- header_196 -->
<g id="node197" class="node">
<title>header_196</title>
<ellipse fill="none" stroke="#000000" cx="14815" cy="-2558.7042" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="14815" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_196 -->
<g id="edge196" class="edge">
<title>section_12&#45;&gt;header_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15146.9989,-2703.1965C15091.7573,-2696.4627 15014.1401,-2682.7588 14951,-2655.4044 14909.3218,-2637.3481 14867.6843,-2605.1391 14841.6697,-2582.8847"/>
<polygon fill="#000000" stroke="#000000" points="14843.9604,-2580.2385 14834.115,-2576.3245 14839.3707,-2585.5238 14843.9604,-2580.2385"/>
</g>
<!-- prose_197 -->
<g id="node198" class="node">
<title>prose_197</title>
<ellipse fill="none" stroke="#000000" cx="14992" cy="-2558.7042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14992" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_197 -->
<g id="edge197" class="edge">
<title>section_12&#45;&gt;prose_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15186.2765,-2692.877C15167.2786,-2682.6576 15142.8485,-2668.9439 15122,-2655.4044 15084.9094,-2631.3169 15044.3424,-2600.3415 15018.5597,-2580.0247"/>
<polygon fill="#000000" stroke="#000000" points="15020.4212,-2577.0342 15010.4092,-2573.5686 15016.0748,-2582.5214 15020.4212,-2577.0342"/>
</g>
<!-- codeblock_198 -->
<g id="node199" class="node">
<title>codeblock_198</title>
<ellipse fill="none" stroke="#000000" cx="15218" cy="-2558.7042" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15218" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 486&#45;500</text>
</g>
<!-- section_12&#45;&gt;codeblock_198 -->
<g id="edge198" class="edge">
<title>section_12&#45;&gt;codeblock_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15218,-2691.2264C15218,-2665.3161 15218,-2617.5259 15218,-2586.9713"/>
<polygon fill="#000000" stroke="#000000" points="15221.5001,-2586.9466 15218,-2576.9467 15214.5001,-2586.9467 15221.5001,-2586.9466"/>
</g>
<!-- section_199 -->
<g id="node200" class="node">
<title>section_199</title>
<ellipse fill="none" stroke="#000000" cx="15666" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15666" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 503&#45;535</text>
</g>
<!-- section_12&#45;&gt;section_199 -->
<g id="edge199" class="edge">
<title>section_12&#45;&gt;section_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15261.7718,-2694.6802C15344.3243,-2666.9109 15522.7488,-2606.8917 15612.3571,-2576.7488"/>
<polygon fill="#000000" stroke="#000000" points="15613.6883,-2579.9939 15622.0505,-2573.4881 15611.4565,-2573.3592 15613.6883,-2579.9939"/>
</g>
<!-- section_200 -->
<g id="node201" class="node">
<title>section_200</title>
<ellipse fill="none" stroke="#000000" cx="16476" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="16476" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 536&#45;554</text>
</g>
<!-- section_12&#45;&gt;section_200 -->
<g id="edge200" class="edge">
<title>section_12&#45;&gt;section_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15288.6418,-2702.9425C15390.6173,-2693.4535 15584.9561,-2674.7675 15750,-2655.4044 15988.1639,-2627.4628 16269.4176,-2588.2114 16401.0288,-2569.4766"/>
<polygon fill="#000000" stroke="#000000" points="16401.6008,-2572.9306 16411.007,-2568.0547 16400.6132,-2566.0006 16401.6008,-2572.9306"/>
</g>
<!-- section_201 -->
<g id="node202" class="node">
<title>section_201</title>
<ellipse fill="none" stroke="#000000" cx="17599" cy="-2558.7042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="17599" y="-2554.5042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 555&#45;589</text>
</g>
<!-- section_12&#45;&gt;section_201 -->
<g id="edge201" class="edge">
<title>section_12&#45;&gt;section_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15293.3739,-2707.761C15497.5035,-2703.0098 16078.1048,-2687.5026 16560,-2655.4044 16919.3348,-2631.4698 17347.1111,-2586.3976 17520.3612,-2567.4478"/>
<polygon fill="#000000" stroke="#000000" points="17520.85,-2570.9153 17530.4092,-2566.3468 17520.0875,-2563.957 17520.85,-2570.9153"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2126.8045 0,-2126.8045 0,-2055.0022 324,-2055.0022 324,-2126.8045"/>
<text text-anchor="middle" x="162" y="-2063.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1253.8181,-2540.5227C1251.2733,-2517.9307 1243.2548,-2480.1485 1218,-2462.0041 1138.0747,-2404.5812 415.8659,-2479.0953 333,-2426.0041 230.3145,-2360.2147 186.4519,-2212.1292 170.2315,-2136.7939"/>
<polygon fill="#000000" stroke="#000000" points="173.5872,-2135.7397 168.1229,-2126.6627 166.734,-2137.1661 173.5872,-2135.7397"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2118.2038 342.5,-2118.2038 342.5,-2063.603 897.5,-2063.603 897.5,-2118.2038"/>
<text text-anchor="middle" x="620" y="-2087.1034" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-2071.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1325.8146,-2540.3568C1323.2997,-2517.9565 1315.4551,-2480.7475 1291,-2462.0041 1222.9747,-2409.8664 983.1003,-2465.4314 907,-2426.0041 774.5428,-2357.3783 677.5181,-2199.2247 638.6757,-2127.4806"/>
<polygon fill="#000000" stroke="#000000" points="641.5988,-2125.5246 633.7977,-2118.3556 635.4255,-2128.8247 641.5988,-2125.5246"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2118.2038 916,-2118.2038 916,-2063.603 1464,-2063.603 1464,-2118.2038"/>
<text text-anchor="middle" x="1190" y="-2087.1034" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-2071.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1392.9125,-2541.0707C1386.0668,-2521.5604 1374.4098,-2489.271 1363,-2462.0041 1310.9549,-2337.6276 1241.064,-2193.8411 1208.3411,-2127.682"/>
<polygon fill="#000000" stroke="#000000" points="1211.3653,-2125.9021 1203.7894,-2118.4956 1205.093,-2129.0099 1211.3653,-2125.9021"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2126.2037 1482,-2126.2037 1482,-2055.603 2030,-2055.603 2030,-2126.2037"/>
<text text-anchor="middle" x="1756" y="-2095.1034" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-2079.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1476.3015,-2540.7055C1482.459,-2520.8754 1493.5166,-2488.3074 1507,-2462.0041 1571.4025,-2336.3675 1670.0565,-2201.8395 1721.73,-2134.5383"/>
<polygon fill="#000000" stroke="#000000" points="1724.7641,-2136.335 1728.0961,-2126.2778 1719.2196,-2132.0621 1724.7641,-2136.335"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-2108.9034 2048,-2108.9034 2048,-2072.9034 2162,-2072.9034 2162,-2108.9034"/>
<text text-anchor="middle" x="2105" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2342.893,-2540.816C2329.8404,-2519.2339 2305.1752,-2483.2128 2275,-2462.0041 2234.9825,-2433.8776 2203.1056,-2462.9056 2171,-2426.0041 2093.186,-2336.566 2096.6596,-2182.4351 2101.9134,-2119.2128"/>
<polygon fill="#000000" stroke="#000000" points="2105.4053,-2119.4596 2102.8277,-2109.1832 2098.4342,-2118.8241 2105.4053,-2119.4596"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2469.5344,-2540.6687C2465.5191,-2518.5901 2455.3979,-2481.7131 2431,-2462.0041 2364.8217,-2408.5441 2300.6343,-2488.5806 2243,-2426.0041 2163.3722,-2339.5481 2186.5434,-2182.4424 2200.2133,-2118.7957"/>
<polygon fill="#000000" stroke="#000000" points="2203.6998,-2119.2427 2202.4687,-2108.7197 2196.8688,-2117.7137 2203.6998,-2119.2427"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-2090.9034" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2582.1678,-2540.6113C2568.4941,-2519.1613 2543.0887,-2483.607 2513,-2462.0041 2476.6597,-2435.9126 2448.8646,-2459.3131 2419,-2426.0041 2338.7193,-2336.4642 2330.1603,-2182.3905 2330.2619,-2119.1981"/>
<polygon fill="#000000" stroke="#000000" points="2333.7619,-2119.2053 2330.3543,-2109.1734 2326.7622,-2119.1407 2333.7619,-2119.2053"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2576.6462,-2540.9823C2555.5059,-2516.9358 2519.3536,-2471.7063 2502,-2426.0041 2461.0489,-2318.1557 2458.236,-2178.1415 2459.1273,-2119.1108"/>
<polygon fill="#000000" stroke="#000000" points="2462.6276,-2119.125 2459.3285,-2109.0569 2455.629,-2118.9849 2462.6276,-2119.125"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2090.9034" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 42&#45;142</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2540.6525C2593,-2469.3184 2593,-2206.72 2593,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2119.1536 2593,-2109.1536 2589.5001,-2119.1537 2596.5001,-2119.1536"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-2090.9034" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2969.4045,-2541.2829C2941.8467,-2517.9068 2894.5736,-2473.7676 2868,-2426.0041 2810.1518,-2322.0275 2786.8324,-2179.3677 2779.1738,-2119.3416"/>
<polygon fill="#000000" stroke="#000000" points="2782.612,-2118.6229 2777.9213,-2109.123 2775.664,-2119.4746 2782.612,-2118.6229"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2984.2467,-2540.516C2975.109,-2515.1992 2958.9264,-2467.7398 2950,-2426.0041 2926.0462,-2314.0074 2914.7725,-2177.7445 2910.7776,-2119.5138"/>
<polygon fill="#000000" stroke="#000000" points="2914.2513,-2119.0001 2910.0945,-2109.2548 2907.2667,-2119.4653 2914.2513,-2119.0001"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2991,-2540.6525C2991,-2469.3184 2991,-2206.72 2991,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="2994.5001,-2119.1536 2991,-2109.1536 2987.5001,-2119.1537 2994.5001,-2119.1536"/>
</g>
<!-- structure_43 -->
<g id="node44" class="node">
<title>structure_43</title>
<ellipse fill="none" stroke="#000000" cx="3086" cy="-2090.9034" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="3086" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_27&#45;&gt;structure_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;structure_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2997.5271,-2540.4654C3006.4023,-2515.0898 3022.2817,-2467.5625 3032,-2426.0041 3058.2196,-2313.8805 3075.8744,-2177.6845 3082.763,-2119.4924"/>
<polygon fill="#000000" stroke="#000000" points="3086.2766,-2119.579 3083.9602,-2109.2405 3079.3239,-2118.7671 3086.2766,-2119.579"/>
</g>
<!-- prose_44 -->
<g id="node45" class="node">
<title>prose_44</title>
<ellipse fill="none" stroke="#000000" cx="3181" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3181" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_44 -->
<g id="edge44" class="edge">
<title>section_27&#45;&gt;prose_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3019.9754,-2542.0761C3054.9335,-2520.3007 3112.4368,-2478.63 3140,-2426.0041 3193.7607,-2323.3594 3188.9393,-2179.4062 3183.9545,-2119.1591"/>
<polygon fill="#000000" stroke="#000000" points="3187.4149,-2118.5601 3183.0359,-2108.9126 3180.4429,-2119.1852 3187.4149,-2118.5601"/>
</g>
<!-- codeblock_45 -->
<g id="node46" class="node">
<title>codeblock_45</title>
<ellipse fill="none" stroke="#000000" cx="3399" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3399" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 159&#45;213</text>
</g>
<!-- section_27&#45;&gt;codeblock_45 -->
<g id="edge45" class="edge">
<title>section_27&#45;&gt;codeblock_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3031.8844,-2543.5297C3081.9644,-2523.2366 3166.9163,-2483.0774 3222,-2426.0041 3313.1356,-2331.5765 3369.7063,-2180.8662 3390.2489,-2118.9016"/>
<polygon fill="#000000" stroke="#000000" points="3393.6831,-2119.6589 3393.4521,-2109.0665 3387.0273,-2117.491 3393.6831,-2119.6589"/>
</g>
<!-- header_57 -->
<g id="node58" class="node">
<title>header_57</title>
<ellipse fill="none" stroke="#000000" cx="3906" cy="-2090.9034" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3906" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_57 -->
<g id="edge57" class="edge">
<title>section_28&#45;&gt;header_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4137.7002,-2540.6525C4100.7592,-2468.947 3964.2546,-2203.9803 3919.9703,-2118.0209"/>
<polygon fill="#000000" stroke="#000000" points="3922.9633,-2116.188 3915.2721,-2108.9013 3916.7405,-2119.3939 3922.9633,-2116.188"/>
</g>
<!-- prose_58 -->
<g id="node59" class="node">
<title>prose_58</title>
<ellipse fill="none" stroke="#000000" cx="4147" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4147" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_58 -->
<g id="edge58" class="edge">
<title>section_28&#45;&gt;prose_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4147,-2540.6525C4147,-2469.3184 4147,-2206.72 4147,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="4150.5001,-2119.1536 4147,-2109.1536 4143.5001,-2119.1537 4150.5001,-2119.1536"/>
</g>
<!-- prose_59 -->
<g id="node60" class="node">
<title>prose_59</title>
<ellipse fill="none" stroke="#000000" cx="4229" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4229" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_59 -->
<g id="edge59" class="edge">
<title>section_28&#45;&gt;prose_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4153.7533,-2540.516C4162.891,-2515.1992 4179.0736,-2467.7398 4188,-2426.0041 4211.9538,-2314.0074 4223.2275,-2177.7445 4227.2224,-2119.5138"/>
<polygon fill="#000000" stroke="#000000" points="4230.7333,-2119.4653 4227.9055,-2109.2548 4223.7487,-2119.0001 4230.7333,-2119.4653"/>
</g>
<!-- codeblock_60 -->
<g id="node61" class="node">
<title>codeblock_60</title>
<ellipse fill="none" stroke="#000000" cx="4367" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4367" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 222&#45;224</text>
</g>
<!-- section_28&#45;&gt;codeblock_60 -->
<g id="edge60" class="edge">
<title>section_28&#45;&gt;codeblock_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4168.4941,-2541.226C4195.9423,-2517.7884 4243.0969,-2473.5828 4270,-2426.0041 4328.7941,-2322.0253 4354.5696,-2179.3667 4363.3061,-2119.3413"/>
<polygon fill="#000000" stroke="#000000" points="4366.8163,-2119.5128 4364.7432,-2109.1228 4359.8845,-2118.5379 4366.8163,-2119.5128"/>
</g>
<!-- header_67 -->
<g id="node68" class="node">
<title>header_67</title>
<ellipse fill="none" stroke="#000000" cx="4674" cy="-2090.9034" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4674" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_67 -->
<g id="edge67" class="edge">
<title>section_29&#45;&gt;header_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4936.6829,-2542.2182C4899.0059,-2520.3023 4835.0449,-2478.1951 4797,-2426.0041 4724.5084,-2326.558 4690.4703,-2179.7615 4678.8475,-2118.9098"/>
<polygon fill="#000000" stroke="#000000" points="4682.2574,-2118.1016 4676.993,-2108.9073 4675.3747,-2119.3778 4682.2574,-2118.1016"/>
</g>
<!-- prose_68 -->
<g id="node69" class="node">
<title>prose_68</title>
<ellipse fill="none" stroke="#000000" cx="4838" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4838" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_68 -->
<g id="edge68" class="edge">
<title>section_29&#45;&gt;prose_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4951.1771,-2540.8863C4930.7247,-2516.7335 4895.7541,-2471.3866 4879,-2426.0041 4839.0615,-2317.8213 4836.2954,-2177.9867 4837.1541,-2119.0571"/>
<polygon fill="#000000" stroke="#000000" points="4840.6541,-2119.087 4837.3485,-2109.021 4833.6554,-2118.9513 4840.6541,-2119.087"/>
</g>
<!-- prose_69 -->
<g id="node70" class="node">
<title>prose_69</title>
<ellipse fill="none" stroke="#000000" cx="4920" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4920" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_69 -->
<g id="edge69" class="edge">
<title>section_29&#45;&gt;prose_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4965.1863,-2540.6525C4958.0113,-2469.2379 4931.5765,-2206.1269 4922.8305,-2119.0758"/>
<polygon fill="#000000" stroke="#000000" points="4926.2905,-2118.5013 4921.8083,-2108.9013 4919.3255,-2119.2011 4926.2905,-2118.5013"/>
</g>
<!-- structure_70 -->
<g id="node71" class="node">
<title>structure_70</title>
<ellipse fill="none" stroke="#000000" cx="5015" cy="-2090.9034" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="5015" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_29&#45;&gt;structure_70 -->
<g id="edge70" class="edge">
<title>section_29&#45;&gt;structure_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4968.8522,-2540.6525C4976.1799,-2469.2379 5003.1772,-2206.1269 5012.1093,-2119.0758"/>
<polygon fill="#000000" stroke="#000000" points="5015.6142,-2119.2064 5013.1533,-2108.9013 5008.6507,-2118.4918 5015.6142,-2119.2064"/>
</g>
<!-- prose_71 -->
<g id="node72" class="node">
<title>prose_71</title>
<ellipse fill="none" stroke="#000000" cx="5590" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5590" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_71 -->
<g id="edge71" class="edge">
<title>section_29&#45;&gt;prose_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4989.9118,-2541.5002C5086.2109,-2469.1906 5457.9981,-2190.0215 5562.5223,-2111.536"/>
<polygon fill="#000000" stroke="#000000" points="5564.7968,-2114.2049 5570.6919,-2105.4016 5560.5936,-2108.6073 5564.7968,-2114.2049"/>
</g>
<!-- prose_72 -->
<g id="node73" class="node">
<title>prose_72</title>
<ellipse fill="none" stroke="#000000" cx="5818" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5818" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_72 -->
<g id="edge72" class="edge">
<title>section_29&#45;&gt;prose_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5037.3184,-2552.1113C5188.1042,-2536.8045 5536.5121,-2494.828 5631,-2426.0041 5739.655,-2346.861 5793.1982,-2184.3115 5811.0077,-2118.9925"/>
<polygon fill="#000000" stroke="#000000" points="5814.4724,-2119.5819 5813.6532,-2109.0188 5807.7063,-2117.7872 5814.4724,-2119.5819"/>
</g>
<!-- codeblock_73 -->
<g id="node74" class="node">
<title>codeblock_73</title>
<ellipse fill="none" stroke="#000000" cx="6111" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6111" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 246&#45;281</text>
</g>
<!-- section_29&#45;&gt;codeblock_73 -->
<g id="edge73" class="edge">
<title>section_29&#45;&gt;codeblock_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5040.9568,-2554.8745C5229.073,-2544.0168 5720.6753,-2508.3281 5859,-2426.0041 5986.0274,-2350.4036 6070.0975,-2183.8779 6099.4292,-2118.2549"/>
<polygon fill="#000000" stroke="#000000" points="6102.6896,-2119.5352 6103.5121,-2108.9723 6096.2821,-2116.7168 6102.6896,-2119.5352"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1990,-976.9029 1652,-976.9029 1652,-921.0999 1990,-921.0999 1990,-976.9029"/>
<text text-anchor="middle" x="1821" y="-929.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.4632,-2073.1493C2224.1644,-2018.0223 2254.4482,-1847.9782 2171,-1755.8027 2118.5833,-1697.9042 2054.7923,-1774.4559 1999,-1719.8027 1788.5526,-1513.6518 1805.8014,-1111.8213 1816.9249,-986.9529"/>
<polygon fill="#000000" stroke="#000000" points="1820.4324,-987.0341 1817.8761,-976.7523 1813.4627,-986.3841 1820.4324,-987.0341"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2150,-967.0014 2008,-967.0014 2008,-931.0014 2150,-931.0014 2150,-967.0014"/>
<text text-anchor="middle" x="2079" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.4762,-2072.7824C2331.9399,-2018.0305 2326.055,-1852.1665 2243,-1755.8027 2216.4824,-1725.0359 2183.0823,-1752.5108 2159,-1719.8027 1983.9539,-1482.0582 2050.223,-1085.5263 2072.7194,-977.1232"/>
<polygon fill="#000000" stroke="#000000" points="2076.1584,-977.7775 2074.8106,-967.2688 2069.3109,-976.3244 2076.1584,-977.7775"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2195" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="2195" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.2179,-2073.0465C2476.1537,-2017.619 2504.0493,-1846.7914 2419,-1755.8027 2360.9065,-1693.6523 2286.7201,-1784.0896 2231,-1719.8027 2132.8472,-1606.5594 2178.7583,-1102.5334 2191.8929,-977.2602"/>
<polygon fill="#000000" stroke="#000000" points="2195.3758,-977.6051 2192.9534,-967.291 2188.4151,-976.8646 2195.3758,-977.6051"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2690,-1719.6041 2240,-1719.6041 2240,-178.3987 2690,-178.3987 2690,-1719.6041"/>
<text text-anchor="middle" x="2465" y="-1704.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 2000</text>
<text text-anchor="middle" x="2465" y="-1673.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2465" y="-1657.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2465" y="-1642.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2465" y="-1627.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2465" y="-1611.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;time DATETIME DEFAULT CURRENT_TIMESTAMP</text>
<text text-anchor="middle" x="2465" y="-1596.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">);</text>
<text text-anchor="middle" x="2465" y="-1580.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-1549.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2465" y="-1534.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2465" y="-1518.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2465" y="-1503.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;project INTEGER,</text>
<text text-anchor="middle" x="2465" y="-1487.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;line TEXT,</text>
<text text-anchor="middle" x="2465" y="-1472.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2465" y="-1457.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2465" y="-1441.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2465" y="-1426.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ON DELETE CASCADE</text>
<text text-anchor="middle" x="2465" y="-1410.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">);</text>
<text text-anchor="middle" x="2465" y="-1395.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-1364.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2465" y="-1348.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2465" y="-1333.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2465" y="-1317.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;line_id INTEGER,</text>
<text text-anchor="middle" x="2465" y="-1302.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;repr text NOT NULL,</text>
<text text-anchor="middle" x="2465" y="-1287.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;value blob,</text>
<text text-anchor="middle" x="2465" y="-1271.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2465" y="-1256.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2465" y="-1240.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ON DELETE CASCADE</text>
<text text-anchor="middle" x="2465" y="-1225.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">);</text>
<text text-anchor="middle" x="2465" y="-1210.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-1178.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2465" y="-1163.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2465" y="-1147.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2465" y="-1132.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2465" y="-1117.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2465" y="-1101.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2465" y="-1086.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2465" y="-1070.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2465" y="-1055.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2465" y="-1040.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2465" y="-1024.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2465" y="-1009.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2465" y="-993.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2465" y="-978.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-947.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2465" y="-931.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2465" y="-916.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-884.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2465" y="-869.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2465" y="-854.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-822.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2465" y="-807.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2465" y="-791.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-760.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2465" y="-745.001" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2465" y="-729.601" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-698.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2465" y="-682.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2465" y="-667.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2465" y="-652.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2465" y="-636.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2465" y="-621.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-589.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2465" y="-574.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2465" y="-559.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2465" y="-543.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-512.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_results = [[</text>
<text text-anchor="middle" x="2465" y="-496.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT result.repr</text>
<text text-anchor="middle" x="2465" y="-481.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM result</text>
<text text-anchor="middle" x="2465" y="-466.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE result.line_id = :line_id</text>
<text text-anchor="middle" x="2465" y="-450.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id;</text>
<text text-anchor="middle" x="2465" y="-435.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2465" y="-403.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = os.getenv &quot;HOME&quot;</text>
<text text-anchor="middle" x="2465" y="-372.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = os.getenv &quot;BRIDGE_HOME&quot;</text>
<text text-anchor="middle" x="2465" y="-357.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2465" y="-325.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2465" y="-294.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2465" y="-278.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2465" y="-263.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2465" y="-248.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2465" y="-232.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2465" y="-217.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2465" y="-201.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2465" y="-186.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2590.9376,-2072.5043C2585.6029,-2024.9128 2570.5028,-1890.203 2552.5258,-1729.829"/>
<polygon fill="#000000" stroke="#000000" points="2555.9852,-1729.2704 2551.393,-1719.7225 2549.0288,-1730.0502 2555.9852,-1729.2704"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="1954,-125.1 1900,-125.1 1900,-89.1 1954,-89.1 1954,-125.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2197.0227,-931.0427C2208.4186,-826.258 2260.563,-294.488 2159,-178.2001 2100.7388,-111.492 2041.6741,-182.8786 1963,-142.2001 1957.96,-139.5941 1953.1585,-136.0487 1948.7993,-132.2088"/>
<polygon fill="#000000" stroke="#000000" points="1951.0939,-129.5588 1941.4745,-125.1184 1946.2253,-134.5884 1951.0939,-129.5588"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2864,-967.0014 2708,-967.0014 2708,-931.0014 2864,-931.0014 2864,-967.0014"/>
<text text-anchor="middle" x="2786" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>header_40&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776.1611,-2072.5043C2777.3166,-1940.5653 2784.3356,-1139.0566 2785.7513,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="2789.2521,-977.3187 2785.8399,-967.2884 2782.2523,-977.2573 2789.2521,-977.3187"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="2909" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_41&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2072.5043C2909,-1940.5653 2909,-1139.0566 2909,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-977.2884 2909,-967.2884 2905.5001,-977.2884 2912.5001,-977.2884"/>
</g>
<!-- raw_49 -->
<g id="node50" class="node">
<title>raw_49</title>
<ellipse fill="none" stroke="#000000" cx="2981" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="2981" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_49 -->
<g id="edge49" class="edge">
<title>prose_42&#45;&gt;raw_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.8389,-2072.5043C2989.6834,-1940.5653 2982.6644,-1139.0566 2981.2487,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="2984.7477,-977.2573 2981.1601,-967.2884 2977.7479,-977.3187 2984.7477,-977.2573"/>
</g>
<!-- hashline_51 -->
<g id="node52" class="node">
<title>hashline_51</title>
<ellipse fill="none" stroke="#000000" cx="3069" cy="-949.0014" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="3069" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_43&#45;&gt;hashline_51 -->
<g id="edge51" class="edge">
<title>structure_43&#45;&gt;hashline_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3085.7261,-2072.5043C3083.7618,-1940.5653 3071.8294,-1139.0566 3069.4228,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="3072.9208,-977.2352 3069.2722,-967.2884 3065.9216,-977.3394 3072.9208,-977.2352"/>
</g>
<!-- raw_54 -->
<g id="node55" class="node">
<title>raw_54</title>
<ellipse fill="none" stroke="#000000" cx="3157" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="3157" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_44&#45;&gt;raw_54 -->
<g id="edge54" class="edge">
<title>prose_44&#45;&gt;raw_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3180.6133,-2072.5043C3177.8403,-1940.5653 3160.9945,-1139.0566 3157.5969,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="3161.0938,-977.2126 3157.3843,-967.2884 3154.0953,-977.3598 3161.0938,-977.2126"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3757.5,-1361.3031 3202.5,-1361.3031 3202.5,-536.6998 3757.5,-536.6998 3757.5,-1361.3031"/>
<text text-anchor="middle" x="3480" y="-1346.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3480" y="-1330.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3480" y="-1315.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3480" y="-1300.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3480" y="-1284.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3480" y="-1269.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3480" y="-1253.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3480" y="-1238.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3480" y="-1223.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3480" y="-1207.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3480" y="-1192.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3480" y="-1176.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3480" y="-1161.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-1146.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3480" y="-1130.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3480" y="-1115.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3480" y="-1099.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3480" y="-1084.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3480" y="-1069.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3480" y="-1053.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3480" y="-1038.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-1022.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3480" y="-1007.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3480" y="-992.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-976.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3480" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3480" y="-914.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3480" y="-899.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3480" y="-883.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3480" y="-868.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create result retrieval prepared statement</text>
<text text-anchor="middle" x="3480" y="-852.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.get_results = conn:prepare(get_results)</text>
<text text-anchor="middle" x="3480" y="-837.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3480" y="-822.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3480" y="-806.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3480" y="-791.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val &#160;= sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-775.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val then</text>
<text text-anchor="middle" x="3480" y="-760.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3480" y="-745.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3480" y="-729.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.line_ids = line_ids</text>
<text text-anchor="middle" x="3480" y="-714.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3480" y="-698.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3480" y="-683.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3480" y="-668.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3480" y="-652.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3480" y="-637.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-621.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3480" y="-606.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3480" y="-591.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3480" y="-575.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3480" y="-560.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-544.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_45&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>codeblock_45&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3400.3051,-2072.5043C3406.0768,-1991.1385 3429.9114,-1655.1288 3450.0247,-1371.5799"/>
<polygon fill="#000000" stroke="#000000" points="3453.5222,-1371.7385 3450.7386,-1361.5159 3446.5397,-1371.2431 3453.5222,-1371.7385"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="2492,-135.0015 1972,-135.0015 1972,-79.1986 2492,-79.1986 2492,-135.0015"/>
<text text-anchor="middle" x="2232" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2911.1673,-930.9109C2923.3865,-825.3755 2979.4218,-290.0585 2873,-178.2001 2844.3766,-148.1145 2542.2611,-146.8872 2501,-142.2001 2484.1789,-140.2893 2466.7782,-138.223 2449.2921,-136.0827"/>
<polygon fill="#000000" stroke="#000000" points="2449.3432,-132.5627 2438.9905,-134.8146 2448.4879,-139.5102 2449.3432,-132.5627"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="3009.5,-134.4005 2510.5,-134.4005 2510.5,-79.7996 3009.5,-79.7996 3009.5,-134.4005"/>
<text text-anchor="middle" x="2760" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2760" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_49&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>raw_49&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2982.7206,-930.97C2992.2823,-826.8927 3035.2725,-303.2485 2945,-178.2001 2934.6909,-163.9196 2903.0415,-149.6902 2868.7686,-137.7549"/>
<polygon fill="#000000" stroke="#000000" points="2869.6422,-134.3553 2859.0478,-134.4512 2867.3897,-140.983 2869.6422,-134.3553"/>
</g>
<!-- hashtag_52 -->
<g id="node53" class="node">
<title>hashtag_52</title>
<ellipse fill="none" stroke="#000000" cx="3069" cy="-107.1" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="3069" y="-102.9" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_51&#45;&gt;hashtag_52 -->
<g id="edge52" class="edge">
<title>hashline_51&#45;&gt;hashtag_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3069,-930.6341C3069,-822.3417 3069,-267.4291 3069,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="3072.5001,-135.2255 3069,-125.2255 3065.5001,-135.2256 3072.5001,-135.2255"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="3096,-36 3042,-36 3042,0 3096,0 3096,-36"/>
<text text-anchor="middle" x="3069" y="-14.5" font-family="Inconsolata" font-size="14.00" fill="#000000">todo</text>
</g>
<!-- hashtag_52&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>hashtag_52&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3069,-89.0693C3069,-76.7509 3069,-60.1792 3069,-46.1369"/>
<polygon fill="#000000" stroke="#000000" points="3072.5001,-46.0039 3069,-36.0039 3065.5001,-46.0039 3072.5001,-46.0039"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3333.5,-127.0021 3128.5,-127.0021 3128.5,-87.198 3333.5,-87.198 3333.5,-127.0021"/>
<text text-anchor="middle" x="3231" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">the results never get used.</text>
</g>
<!-- raw_54&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>raw_54&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3154.9653,-930.902C3145.8802,-844.8399 3112.8749,-469.1253 3193,-178.2001 3197.097,-163.3243 3204.7123,-148.0754 3212.056,-135.5334"/>
<polygon fill="#000000" stroke="#000000" points="3215.0876,-137.2843 3217.3011,-126.9232 3209.1095,-133.6425 3215.0876,-137.2843"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4106.5,-967.0014 3775.5,-967.0014 3775.5,-931.0014 4106.5,-931.0014 4106.5,-967.0014"/>
<text text-anchor="middle" x="3941" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_57&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>header_57&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3906.5639,-2072.5043C3910.608,-1940.5653 3935.1747,-1139.0566 3940.1295,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="3943.6314,-977.391 3940.4395,-967.2884 3936.6347,-977.1764 3943.6314,-977.391"/>
</g>
<!-- raw_62 -->
<g id="node63" class="node">
<title>raw_62</title>
<ellipse fill="none" stroke="#000000" cx="4152" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="4152" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_58&#45;&gt;raw_62 -->
<g id="edge62" class="edge">
<title>prose_58&#45;&gt;raw_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4147.0806,-2072.5043C4147.6583,-1940.5653 4151.1678,-1139.0566 4151.8756,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="4155.376,-977.3037 4151.9199,-967.2884 4148.3761,-977.2729 4155.376,-977.3037"/>
</g>
<!-- raw_64 -->
<g id="node65" class="node">
<title>raw_64</title>
<ellipse fill="none" stroke="#000000" cx="4227" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="4227" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_59&#45;&gt;raw_64 -->
<g id="edge64" class="edge">
<title>prose_59&#45;&gt;raw_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4228.9678,-2072.5043C4228.7367,-1940.5653 4227.3329,-1139.0566 4227.0497,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="4230.5496,-977.2822 4227.032,-967.2884 4223.5496,-977.2945 4230.5496,-977.2822"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4394,-967.0014 4340,-967.0014 4340,-931.0014 4394,-931.0014 4394,-967.0014"/>
</g>
<!-- codeblock_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>codeblock_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4367,-2072.5043C4367,-1940.5653 4367,-1139.0566 4367,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="4370.5001,-977.2884 4367,-967.2884 4363.5001,-977.2884 4370.5001,-977.2884"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="3718,-135.0015 3352,-135.0015 3352,-79.1986 3718,-79.1986 3718,-135.0015"/>
<text text-anchor="middle" x="3535" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_62&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>raw_62&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4154.1485,-930.9027C4166.257,-825.3212 4221.7216,-289.7856 4115,-178.2001 4085.0745,-146.9106 3769.8926,-148.0989 3727,-142.2001 3714.6828,-140.5062 3701.9522,-138.5768 3689.1797,-136.5142"/>
<polygon fill="#000000" stroke="#000000" points="3689.3693,-132.9986 3678.9346,-134.8335 3688.2361,-139.9063 3689.3693,-132.9986"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4081.5,-127.0021 3736.5,-127.0021 3736.5,-87.198 4081.5,-87.198 4081.5,-127.0021"/>
<text text-anchor="middle" x="3909" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_64&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>raw_64&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4232.8363,-931.2395C4261.7885,-839.4533 4381.0722,-414.0898 4188,-178.2001 4176.831,-164.5541 4093.2023,-144.3487 4020.3903,-128.9614"/>
<polygon fill="#000000" stroke="#000000" points="4020.7022,-125.4507 4010.1966,-126.8234 4019.2652,-132.3017 4020.7022,-125.4507"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="4783.5,-967.0014 4564.5,-967.0014 4564.5,-931.0014 4783.5,-931.0014 4783.5,-967.0014"/>
<text text-anchor="middle" x="4674" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_67&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>header_67&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4674,-2072.5043C4674,-1940.5653 4674,-1139.0566 4674,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="4677.5001,-977.2884 4674,-967.2884 4670.5001,-977.2884 4677.5001,-977.2884"/>
</g>
<!-- raw_75 -->
<g id="node76" class="node">
<title>raw_75</title>
<ellipse fill="none" stroke="#000000" cx="4834" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="4834" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_68&#45;&gt;raw_75 -->
<g id="edge75" class="edge">
<title>prose_68&#45;&gt;raw_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4837.9355,-2072.5043C4837.4734,-1940.5653 4834.6657,-1139.0566 4834.0995,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="4837.5992,-977.276 4834.0641,-967.2884 4830.5992,-977.3006 4837.5992,-977.276"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="4913" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="4913" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_69&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_69&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4919.8872,-2072.5043C4919.0784,-1940.5653 4914.1651,-1139.0566 4913.1741,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="4916.6734,-977.2667 4913.1121,-967.2884 4909.6736,-977.3097 4916.6734,-977.2667"/>
</g>
<!-- hashline_79 -->
<g id="node80" class="node">
<title>hashline_79</title>
<ellipse fill="none" stroke="#000000" cx="5015" cy="-949.0014" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="5015" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_70&#45;&gt;hashline_79 -->
<g id="edge79" class="edge">
<title>structure_70&#45;&gt;hashline_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5015,-2072.5043C5015,-1940.5653 5015,-1139.0566 5015,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="5018.5001,-977.2884 5015,-967.2884 5011.5001,-977.2884 5018.5001,-977.2884"/>
</g>
<!-- raw_82 -->
<g id="node83" class="node">
<title>raw_82</title>
<ellipse fill="none" stroke="#000000" cx="5300" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="5300" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_71&#45;&gt;raw_82 -->
<g id="edge82" class="edge">
<title>prose_71&#45;&gt;raw_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5578.4827,-2073.6781C5544.8094,-2022.385 5446.0746,-1865.1697 5401,-1719.8027 5314.13,-1439.644 5301.9642,-1079.6383 5300.271,-977.2723"/>
<polygon fill="#000000" stroke="#000000" points="5303.7686,-977.0734 5300.1245,-967.125 5296.7693,-977.1745 5303.7686,-977.0734"/>
</g>
<!-- prespace_83 -->
<g id="node84" class="node">
<title>prespace_83</title>
<ellipse fill="none" stroke="#000000" cx="5456" cy="-949.0014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5456" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_71&#45;&gt;prespace_83 -->
<g id="edge83" class="edge">
<title>prose_71&#45;&gt;prespace_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5585.3146,-2072.9069C5571.6041,-2019.4924 5531.3173,-1857.0324 5512,-1719.8027 5471.3987,-1431.3717 5459.3873,-1077.8281 5456.6739,-977.0192"/>
<polygon fill="#000000" stroke="#000000" points="5460.1728,-976.9271 5456.4135,-967.0217 5453.1752,-977.1095 5460.1728,-976.9271"/>
</g>
<!-- literal_84 -->
<g id="node85" class="node">
<title>literal_84</title>
<ellipse fill="none" stroke="#000000" cx="5552" cy="-949.0014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5552" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_71&#45;&gt;literal_84 -->
<g id="edge84" class="edge">
<title>prose_71&#45;&gt;literal_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5589.3877,-2072.5043C5584.9971,-1940.5653 5558.3246,-1139.0566 5552.9451,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="5556.4393,-977.1664 5552.6086,-967.2884 5549.4432,-977.3993 5556.4393,-977.1664"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5628" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="5628" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_71&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_71&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5590.6123,-2072.5043C5595.0029,-1940.5653 5621.6754,-1139.0566 5627.0549,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="5630.5568,-977.3993 5627.3914,-967.2884 5623.5607,-977.1664 5630.5568,-977.3993"/>
</g>
<!-- prespace_86 -->
<g id="node87" class="node">
<title>prespace_86</title>
<ellipse fill="none" stroke="#000000" cx="5719" cy="-949.0014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5719" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_71&#45;&gt;prespace_86 -->
<g id="edge86" class="edge">
<title>prose_71&#45;&gt;prespace_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5594.4307,-2072.8898C5607.3982,-2019.4282 5645.5206,-1856.8518 5664,-1719.8027 5702.8796,-1431.4594 5715.3569,-1078.4813 5718.2629,-977.3118"/>
<polygon fill="#000000" stroke="#000000" points="5721.7699,-977.1061 5718.5503,-967.0124 5714.7727,-976.9108 5721.7699,-977.1061"/>
</g>
<!-- literal_87 -->
<g id="node88" class="node">
<title>literal_87</title>
<ellipse fill="none" stroke="#000000" cx="5815" cy="-949.0014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5815" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_71&#45;&gt;literal_87 -->
<g id="edge87" class="edge">
<title>prose_71&#45;&gt;literal_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5601.7288,-2073.7772C5635.9312,-2022.757 5735.5645,-1866.2163 5774,-1719.8027 5847.9495,-1438.1045 5825.8895,-1079.1732 5817.538,-977.1669"/>
<polygon fill="#000000" stroke="#000000" points="5821.0133,-976.7263 5816.6849,-967.056 5814.0381,-977.3148 5821.0133,-976.7263"/>
</g>
<!-- raw_88 -->
<g id="node89" class="node">
<title>raw_88</title>
<ellipse fill="none" stroke="#000000" cx="5891" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="5891" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_71&#45;&gt;raw_88 -->
<g id="edge88" class="edge">
<title>prose_71&#45;&gt;raw_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5595.4903,-2073.1142C5613.137,-2018.6032 5673.3778,-1851.7777 5777,-1755.8027 5805.0118,-1729.8582 5833.6775,-1751.4749 5855,-1719.8027 5938.5161,-1595.749 5903.7419,-1101.8127 5893.4819,-977.5085"/>
<polygon fill="#000000" stroke="#000000" points="5896.9479,-976.9563 5892.6238,-967.284 5889.9724,-977.5417 5896.9479,-976.9563"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="5963" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="5963" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_72&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_72&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5824.89,-2073.1127C5844.9916,-2020.2643 5903.6189,-1859.2038 5927,-1719.8027 5975.1068,-1432.9835 5967.512,-1078.3181 5964.0919,-977.131"/>
<polygon fill="#000000" stroke="#000000" points="5967.5883,-976.9654 5963.7376,-967.0952 5960.5927,-977.2125 5967.5883,-976.9654"/>
</g>
<!-- leaf_98 -->
<g id="node99" class="node">
<title>leaf_98</title>
<polygon fill="none" stroke="#c0c0c0" points="6521.5,-1215.2025 6008.5,-1215.2025 6008.5,-682.8003 6521.5,-682.8003 6521.5,-1215.2025"/>
<text text-anchor="middle" x="6265" y="-1199.9019" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = table.concat</text>
<text text-anchor="middle" x="6265" y="-1184.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6265" y="-1169.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6265" y="-1153.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6265" y="-1138.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6265" y="-1122.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6265" y="-1107.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6265" y="-1092.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6265" y="-1076.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6265" y="-1061.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6265" y="-1045.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6265" y="-1030.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-1015.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6265" y="-999.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table.insert(historian.line_ids, line_id)</text>
<text text-anchor="middle" x="6265" y="-984.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6265" y="-968.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 1, results.n do</text>
<text text-anchor="middle" x="6265" y="-953.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6265" y="-938.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local res = results[i]</text>
<text text-anchor="middle" x="6265" y="-922.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6265" y="-907.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = repr.ts(res) }</text>
<text text-anchor="middle" x="6265" y="-891.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6265" y="-876.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6265" y="-861.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6265" y="-845.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-830.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-814.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-783.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6265" y="-768.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6265" y="-752.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6265" y="-737.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6265" y="-721.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-706.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6265" y="-691.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_73&#45;&gt;leaf_98 -->
<g id="edge98" class="edge">
<title>codeblock_73&#45;&gt;leaf_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6113.4813,-2072.5043C6126.43,-1976.4906 6187.1985,-1525.8956 6227.733,-1225.3345"/>
<polygon fill="#000000" stroke="#000000" points="6231.2382,-1225.5301 6229.1062,-1215.152 6224.301,-1224.5944 6231.2382,-1225.5301"/>
</g>
<!-- leaf_76 -->
<g id="node77" class="node">
<title>leaf_76</title>
<polygon fill="none" stroke="#c0c0c0" points="4374.5,-135.0015 4099.5,-135.0015 4099.5,-79.1986 4374.5,-79.1986 4374.5,-135.0015"/>
<text text-anchor="middle" x="4237" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_75&#45;&gt;leaf_76 -->
<g id="edge76" class="edge">
<title>raw_75&#45;&gt;leaf_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4836.0288,-930.8863C4847.4393,-825.2114 4899.3682,-289.2348 4792,-178.2001 4760.3646,-145.4844 4428.9195,-149.5044 4384,-142.2001 4374.6777,-140.6842 4365.0706,-138.9007 4355.4432,-136.9547"/>
<polygon fill="#000000" stroke="#000000" points="4355.9169,-133.4785 4345.4142,-134.8724 4354.4938,-140.3323 4355.9169,-133.4785"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="4955,-142.3004 4393,-142.3004 4393,-71.8997 4955,-71.8997 4955,-142.3004"/>
<text text-anchor="middle" x="4674" y="-111.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4674" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4674" y="-80.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_77&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_77&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4914.5765,-930.933C4923.3038,-826.6477 4962.0561,-302.0306 4870,-178.2001 4861.5001,-166.7663 4839.6951,-155.6415 4813.5712,-145.7166"/>
<polygon fill="#000000" stroke="#000000" points="4814.759,-142.4243 4804.1655,-142.2576 4812.3429,-148.9942 4814.759,-142.4243"/>
</g>
<!-- hashtag_80 -->
<g id="node81" class="node">
<title>hashtag_80</title>
<ellipse fill="none" stroke="#000000" cx="5015" cy="-107.1" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="5015" y="-102.9" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_79&#45;&gt;hashtag_80 -->
<g id="edge80" class="edge">
<title>hashline_79&#45;&gt;hashtag_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5015,-930.6341C5015,-822.3417 5015,-267.4291 5015,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="5018.5001,-135.2255 5015,-125.2255 5011.5001,-135.2256 5018.5001,-135.2255"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5042,-36 4988,-36 4988,0 5042,0 5042,-36"/>
<text text-anchor="middle" x="5015" y="-14.5" font-family="Inconsolata" font-size="14.00" fill="#000000">todo</text>
</g>
<!-- hashtag_80&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>hashtag_80&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5015,-89.0693C5015,-76.7509 5015,-60.1792 5015,-46.1369"/>
<polygon fill="#000000" stroke="#000000" points="5018.5001,-46.0039 5015,-36.0039 5011.5001,-46.0039 5018.5001,-46.0039"/>
</g>
<!-- leaf_89 -->
<g id="node90" class="node">
<title>leaf_89</title>
<polygon fill="none" stroke="#c0c0c0" points="5461.5,-127.0021 5074.5,-127.0021 5074.5,-87.198 5461.5,-87.198 5461.5,-127.0021"/>
<text text-anchor="middle" x="5268" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_82&#45;&gt;leaf_89 -->
<g id="edge89" class="edge">
<title>raw_82&#45;&gt;leaf_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5299.3019,-930.6341C5295.2039,-822.8183 5274.2793,-272.3048 5269.1407,-137.1119"/>
<polygon fill="#000000" stroke="#000000" points="5272.636,-136.919 5268.7586,-127.0591 5265.6411,-137.1849 5272.636,-136.919"/>
</g>
<!-- leaf_90 -->
<g id="node91" class="node">
<title>leaf_90</title>
<polygon fill="none" stroke="#c0c0c0" points="5534,-125.1 5480,-125.1 5480,-89.1 5534,-89.1 5534,-125.1"/>
<text text-anchor="middle" x="5507" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_83&#45;&gt;leaf_90 -->
<g id="edge90" class="edge">
<title>prespace_83&#45;&gt;leaf_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5457.1126,-930.6341C5463.6727,-822.3417 5497.2877,-267.4291 5505.2891,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="5508.7908,-135.4189 5505.902,-125.2255 5501.8037,-134.9956 5508.7908,-135.4189"/>
</g>
<!-- leaf_91 -->
<g id="node92" class="node">
<title>leaf_91</title>
<polygon fill="none" stroke="#c0c0c0" points="5617.5,-125.1 5552.5,-125.1 5552.5,-89.1 5617.5,-89.1 5617.5,-125.1"/>
<text text-anchor="middle" x="5585" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_84&#45;&gt;leaf_91 -->
<g id="edge91" class="edge">
<title>literal_84&#45;&gt;leaf_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5552.7199,-930.6341C5556.9647,-822.3417 5578.7156,-267.4291 5583.8929,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="5587.3951,-135.355 5584.2895,-125.2255 5580.4005,-135.0807 5587.3951,-135.355"/>
</g>
<!-- leaf_92 -->
<g id="node93" class="node">
<title>leaf_92</title>
<polygon fill="none" stroke="#c0c0c0" points="5904,-126.4006 5636,-126.4006 5636,-87.7995 5904,-87.7995 5904,-126.4006"/>
<text text-anchor="middle" x="5770" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5770" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_85&#45;&gt;leaf_92 -->
<g id="edge92" class="edge">
<title>raw_85&#45;&gt;leaf_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5626.6975,-930.917C5619.5738,-827.6435 5588.3453,-312.405 5664,-178.2001 5675.2767,-158.1963 5694.7932,-142.7369 5714.0309,-131.4206"/>
<polygon fill="#000000" stroke="#000000" points="5715.7961,-134.4437 5722.8195,-126.5114 5712.3824,-128.3325 5715.7961,-134.4437"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="5976,-125.1 5922,-125.1 5922,-89.1 5976,-89.1 5976,-125.1"/>
<text text-anchor="middle" x="5949" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_86&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>prespace_86&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5717.5867,-930.7782C5709.8218,-825.6216 5676.1927,-296.9303 5775,-178.2001 5815.5461,-129.4785 5857.8033,-173.3626 5913,-142.2001 5917.8458,-139.4643 5922.5107,-135.9144 5926.7841,-132.1255"/>
<polygon fill="#000000" stroke="#000000" points="5929.231,-134.6283 5934.0083,-125.1717 5924.3764,-129.5851 5929.231,-134.6283"/>
</g>
<!-- leaf_94 -->
<g id="node95" class="node">
<title>leaf_94</title>
<polygon fill="none" stroke="#c0c0c0" points="6052,-125.1 5994,-125.1 5994,-89.1 6052,-89.1 6052,-125.1"/>
<text text-anchor="middle" x="6023" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_87&#45;&gt;leaf_94 -->
<g id="edge94" class="edge">
<title>literal_87&#45;&gt;leaf_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5813.2021,-930.8264C5803.2188,-825.9409 5758.4489,-298.5174 5855,-178.2001 5892.5223,-131.4417 5932.6171,-171.3601 5985,-142.2001 5989.9044,-139.47 5994.679,-135.9808 5999.095,-132.2659"/>
<polygon fill="#000000" stroke="#000000" points="6001.5525,-134.7621 6006.6068,-125.4506 5996.8489,-129.5779 6001.5525,-134.7621"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6156,-125.1 6070,-125.1 6070,-89.1 6156,-89.1 6156,-125.1"/>
<text text-anchor="middle" x="6113" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_88&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_88&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5889.085,-930.8218C5878.4291,-825.9103 5830.3223,-298.3651 5927,-178.2001 5965.6562,-130.1526 6004.8979,-167.8011 6061,-142.2001 6067.8124,-139.0914 6074.7162,-135.1209 6081.1709,-130.9758"/>
<polygon fill="#000000" stroke="#000000" points="6083.2975,-133.7635 6089.6436,-125.2795 6079.3919,-127.9543 6083.2975,-133.7635"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="6708,-134.4005 6174,-134.4005 6174,-79.7996 6708,-79.7996 6708,-134.4005"/>
<text text-anchor="middle" x="6441" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6441" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5960.9391,-931.009C5949.326,-826.0324 5896.1551,-293.3558 5999,-178.2001 6007.2524,-168.9598 6116.9546,-151.2834 6224.9903,-135.8681"/>
<polygon fill="#000000" stroke="#000000" points="6225.6924,-139.3036 6235.1005,-134.4313 6224.7074,-132.3732 6225.6924,-139.3036"/>
</g>
<!-- leaf_104 -->
<g id="node105" class="node">
<title>leaf_104</title>
<polygon fill="none" stroke="#c0c0c0" points="7203.5,-2108.9034 7012.5,-2108.9034 7012.5,-2072.9034 7203.5,-2072.9034 7203.5,-2108.9034"/>
<text text-anchor="middle" x="7108" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_99&#45;&gt;leaf_104 -->
<g id="edge104" class="edge">
<title>header_99&#45;&gt;leaf_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7108,-2540.6525C7108,-2469.3184 7108,-2206.72 7108,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="7111.5001,-2119.1536 7108,-2109.1536 7104.5001,-2119.1537 7111.5001,-2119.1536"/>
</g>
<!-- raw_105 -->
<g id="node106" class="node">
<title>raw_105</title>
<ellipse fill="none" stroke="#000000" cx="7257" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="7257" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_105 -->
<g id="edge105" class="edge">
<title>prose_100&#45;&gt;raw_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7265.6527,-2540.6525C7264.2803,-2469.3184 7259.2282,-2206.72 7257.5477,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="7261.0429,-2119.0844 7257.3511,-2109.1536 7254.0442,-2119.2191 7261.0429,-2119.0844"/>
</g>
<!-- raw_107 -->
<g id="node108" class="node">
<title>raw_107</title>
<ellipse fill="none" stroke="#000000" cx="7348" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="7348" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_101&#45;&gt;raw_107 -->
<g id="edge107" class="edge">
<title>prose_101&#45;&gt;raw_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7348,-2540.6525C7348,-2469.3184 7348,-2206.72 7348,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="7351.5001,-2119.1536 7348,-2109.1536 7344.5001,-2119.1537 7351.5001,-2119.1536"/>
</g>
<!-- header_109 -->
<g id="node110" class="node">
<title>header_109</title>
<ellipse fill="none" stroke="#000000" cx="7786" cy="-2090.9034" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7786" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuzz_patt</text>
</g>
<!-- section_102&#45;&gt;header_109 -->
<g id="edge109" class="edge">
<title>section_102&#45;&gt;header_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7929.2503,-2540.6525C7906.4576,-2469.0924 7822.3584,-2205.0544 7794.8045,-2118.5462"/>
<polygon fill="#000000" stroke="#000000" points="7798.1024,-2117.3674 7791.7325,-2108.9013 7791.4326,-2119.4919 7798.1024,-2117.3674"/>
</g>
<!-- prose_110 -->
<g id="node111" class="node">
<title>prose_110</title>
<ellipse fill="none" stroke="#000000" cx="7935" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7935" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_102&#45;&gt;prose_110 -->
<g id="edge110" class="edge">
<title>section_102&#45;&gt;prose_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7935,-2540.6525C7935,-2469.3184 7935,-2206.72 7935,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="7938.5001,-2119.1536 7935,-2109.1536 7931.5001,-2119.1537 7938.5001,-2119.1536"/>
</g>
<!-- prose_111 -->
<g id="node112" class="node">
<title>prose_111</title>
<ellipse fill="none" stroke="#000000" cx="8322" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8322" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_102&#45;&gt;prose_111 -->
<g id="edge111" class="edge">
<title>section_102&#45;&gt;prose_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7949.6983,-2540.9371C8009.2315,-2468.9741 8232.546,-2199.0343 8301.5542,-2115.6181"/>
<polygon fill="#000000" stroke="#000000" points="8304.4277,-2117.6354 8308.1052,-2107.6992 8299.0341,-2113.1734 8304.4277,-2117.6354"/>
</g>
<!-- codeblock_112 -->
<g id="node113" class="node">
<title>codeblock_112</title>
<ellipse fill="none" stroke="#000000" cx="8656" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8656" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 303&#45;317</text>
</g>
<!-- section_102&#45;&gt;codeblock_112 -->
<g id="edge112" class="edge">
<title>section_102&#45;&gt;codeblock_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8000.6375,-2549.7915C8088.9589,-2535.3708 8248.2092,-2500.6364 8363,-2426.0041 8494.2249,-2340.6869 8601.2104,-2180.6149 8640.1715,-2117.4794"/>
<polygon fill="#000000" stroke="#000000" points="8643.1936,-2119.2462 8645.4211,-2108.8881 8637.2204,-2115.5963 8643.1936,-2119.2462"/>
</g>
<!-- header_135 -->
<g id="node136" class="node">
<title>header_135</title>
<ellipse fill="none" stroke="#000000" cx="9276" cy="-2090.9034" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9276" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_103&#45;&gt;header_135 -->
<g id="edge135" class="edge">
<title>section_103&#45;&gt;header_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9459.6296,-2540.6525C9430.3824,-2469.0197 9322.3879,-2204.5176 9287.1789,-2118.283"/>
<polygon fill="#000000" stroke="#000000" points="9290.3688,-2116.8363 9283.3484,-2108.9013 9283.8882,-2119.4824 9290.3688,-2116.8363"/>
</g>
<!-- prose_136 -->
<g id="node137" class="node">
<title>prose_136</title>
<ellipse fill="none" stroke="#000000" cx="9467" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9467" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_103&#45;&gt;prose_136 -->
<g id="edge136" class="edge">
<title>section_103&#45;&gt;prose_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9467,-2540.6525C9467,-2469.3184 9467,-2206.72 9467,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="9470.5001,-2119.1536 9467,-2109.1536 9463.5001,-2119.1537 9470.5001,-2119.1536"/>
</g>
<!-- prose_137 -->
<g id="node138" class="node">
<title>prose_137</title>
<ellipse fill="none" stroke="#000000" cx="9606" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9606" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_103&#45;&gt;prose_137 -->
<g id="edge137" class="edge">
<title>section_103&#45;&gt;prose_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9472.6572,-2540.701C9480.6468,-2515.2062 9495.6408,-2467.1069 9508,-2426.0041 9542.2593,-2312.0682 9581.5952,-2175.8508 9598.0826,-2118.5"/>
<polygon fill="#000000" stroke="#000000" points="9601.4915,-2119.31 9600.8889,-2108.7323 9594.7636,-2117.377 9601.4915,-2119.31"/>
</g>
<!-- codeblock_138 -->
<g id="node139" class="node">
<title>codeblock_138</title>
<ellipse fill="none" stroke="#000000" cx="9865" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9865" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 329&#45;393</text>
</g>
<!-- section_103&#45;&gt;codeblock_138 -->
<g id="edge138" class="edge">
<title>section_103&#45;&gt;codeblock_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9495.9808,-2541.9051C9533.769,-2519.0424 9600.5165,-2475.2902 9647,-2426.0041 9741.9538,-2325.3252 9821.2465,-2178.182 9851.6675,-2118.0379"/>
<polygon fill="#000000" stroke="#000000" points="9854.9334,-2119.3331 9856.288,-2108.8252 9848.6763,-2116.1949 9854.9334,-2119.3331"/>
</g>
<!-- leaf_106 -->
<g id="node107" class="node">
<title>leaf_106</title>
<polygon fill="none" stroke="#c0c0c0" points="7052.5,-984.3017 6539.5,-984.3017 6539.5,-913.7011 7052.5,-913.7011 7052.5,-984.3017"/>
<text text-anchor="middle" x="6796" y="-937.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6796" y="-921.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_105&#45;&gt;leaf_106 -->
<g id="edge106" class="edge">
<title>raw_105&#45;&gt;leaf_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7260.8655,-2072.789C7271.5503,-2017.3417 7295.461,-1848.108 7212,-1755.8027 7165.7286,-1704.6279 7112.0948,-1766.1625 7061,-1719.8027 6840.6031,-1519.8302 6803.4798,-1128.2255 6797.2491,-994.7961"/>
<polygon fill="#000000" stroke="#000000" points="6800.7343,-994.3732 6796.8079,-984.5328 6793.7407,-994.6739 6800.7343,-994.3732"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7625.5,-992.2017 7070.5,-992.2017 7070.5,-905.8011 7625.5,-905.8011 7625.5,-992.2017"/>
<text text-anchor="middle" x="7348" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7348" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7348" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_107&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>raw_107&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7348,-2072.5043C7348,-1946.396 7348,-1208.5903 7348,-1002.4697"/>
<polygon fill="#000000" stroke="#000000" points="7351.5001,-1002.2064 7348,-992.2065 7344.5001,-1002.2065 7351.5001,-1002.2064"/>
</g>
<!-- leaf_113 -->
<g id="node114" class="node">
<title>leaf_113</title>
<polygon fill="none" stroke="#c0c0c0" points="7750.5,-967.0014 7643.5,-967.0014 7643.5,-931.0014 7750.5,-931.0014 7750.5,-967.0014"/>
<text text-anchor="middle" x="7697" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuzz_patt</text>
</g>
<!-- header_109&#45;&gt;leaf_113 -->
<g id="edge113" class="edge">
<title>header_109&#45;&gt;leaf_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7784.566,-2072.5043C7774.2826,-1940.5653 7711.8129,-1139.0566 7699.2136,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="7702.6918,-976.9862 7698.4253,-967.2884 7695.713,-977.5302 7702.6918,-976.9862"/>
</g>
<!-- raw_114 -->
<g id="node115" class="node">
<title>raw_114</title>
<ellipse fill="none" stroke="#000000" cx="7796" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="7796" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_110&#45;&gt;raw_114 -->
<g id="edge114" class="edge">
<title>prose_110&#45;&gt;raw_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7932.4655,-2072.9014C7924.8754,-2021.7696 7899.8992,-1871.8628 7853,-1755.8027 7846.0601,-1738.6287 7837.2501,-1737.5664 7832,-1719.8027 7749.4787,-1440.5934 7781.1245,-1079.9251 7792.5675,-977.3373"/>
<polygon fill="#000000" stroke="#000000" points="7796.0716,-977.5008 7793.7314,-967.1676 7789.117,-976.7048 7796.0716,-977.5008"/>
</g>
<!-- prespace_115 -->
<g id="node116" class="node">
<title>prespace_115</title>
<ellipse fill="none" stroke="#000000" cx="7887" cy="-949.0014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7887" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_110&#45;&gt;prespace_115 -->
<g id="edge115" class="edge">
<title>prose_110&#45;&gt;prespace_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7934.2266,-2072.5043C7928.6805,-1940.5653 7894.989,-1139.0566 7888.1938,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="7891.6857,-977.1325 7887.7687,-967.2884 7884.6919,-977.4266 7891.6857,-977.1325"/>
</g>
<!-- literal_116 -->
<g id="node117" class="node">
<title>literal_116</title>
<ellipse fill="none" stroke="#000000" cx="7983" cy="-949.0014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7983" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_110&#45;&gt;literal_116 -->
<g id="edge116" class="edge">
<title>prose_110&#45;&gt;literal_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7935.7734,-2072.5043C7941.3195,-1940.5653 7975.011,-1139.0566 7981.8062,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="7985.3081,-977.4266 7982.2313,-967.2884 7978.3143,-977.1325 7985.3081,-977.4266"/>
</g>
<!-- raw_117 -->
<g id="node118" class="node">
<title>raw_117</title>
<ellipse fill="none" stroke="#000000" cx="8059" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="8059" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_110&#45;&gt;raw_117 -->
<g id="edge117" class="edge">
<title>prose_110&#45;&gt;raw_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7940.5115,-2072.9819C7956.5999,-2019.7738 8003.5848,-1857.824 8023,-1719.8027 8063.5111,-1431.8125 8061.203,-1077.9621 8059.5655,-977.0498"/>
<polygon fill="#000000" stroke="#000000" points="8063.0649,-976.9793 8059.3912,-967.0418 8056.0659,-977.1012 8063.0649,-976.9793"/>
</g>
<!-- prespace_122 -->
<g id="node123" class="node">
<title>prespace_122</title>
<ellipse fill="none" stroke="#000000" cx="8150" cy="-949.0014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8150" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_111&#45;&gt;prespace_122 -->
<g id="edge122" class="edge">
<title>prose_111&#45;&gt;prespace_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8314.8227,-2073.1309C8293.857,-2020.3328 8232.52,-1859.3964 8206,-1719.8027 8151.636,-1433.6464 8149.2036,-1078.5196 8149.7201,-977.1769"/>
<polygon fill="#000000" stroke="#000000" points="8153.2203,-977.1481 8149.786,-967.1254 8146.2204,-977.1022 8153.2203,-977.1481"/>
</g>
<!-- literal_123 -->
<g id="node124" class="node">
<title>literal_123</title>
<ellipse fill="none" stroke="#000000" cx="8246" cy="-949.0014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8246" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_111&#45;&gt;literal_123 -->
<g id="edge123" class="edge">
<title>prose_111&#45;&gt;literal_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8319.9508,-2072.779C8313.9346,-2019.0127 8296.1114,-1855.6829 8286,-1719.8027 8264.4367,-1430.0273 8250.7037,-1078.1045 8247.0075,-977.2394"/>
<polygon fill="#000000" stroke="#000000" points="8250.5047,-977.095 8246.6435,-967.2288 8243.5093,-977.3494 8250.5047,-977.095"/>
</g>
<!-- raw_124 -->
<g id="node125" class="node">
<title>raw_124</title>
<ellipse fill="none" stroke="#000000" cx="8322" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="8322" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_111&#45;&gt;raw_124 -->
<g id="edge124" class="edge">
<title>prose_111&#45;&gt;raw_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8322,-2072.5043C8322,-1940.5653 8322,-1139.0566 8322,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="8325.5001,-977.2884 8322,-967.2884 8318.5001,-977.2884 8325.5001,-977.2884"/>
</g>
<!-- prespace_125 -->
<g id="node126" class="node">
<title>prespace_125</title>
<ellipse fill="none" stroke="#000000" cx="8413" cy="-949.0014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8413" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_111&#45;&gt;prespace_125 -->
<g id="edge125" class="edge">
<title>prose_111&#45;&gt;prespace_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8323.9244,-2072.7691C8329.5974,-2018.9756 8346.5721,-1855.5785 8358,-1719.8027 8382.4001,-1429.9038 8404.9268,-1078.0667 8411.2464,-977.2307"/>
<polygon fill="#000000" stroke="#000000" points="8414.7411,-977.422 8411.8719,-967.2231 8407.7548,-976.9852 8414.7411,-977.422"/>
</g>
<!-- literal_126 -->
<g id="node127" class="node">
<title>literal_126</title>
<ellipse fill="none" stroke="#000000" cx="8509" cy="-949.0014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8509" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_111&#45;&gt;literal_126 -->
<g id="edge126" class="edge">
<title>prose_111&#45;&gt;literal_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8331.2639,-2073.3982C8358.2854,-2021.3352 8437.0521,-1862.2164 8468,-1719.8027 8529.7779,-1435.5182 8516.2634,-1079.0886 8510.7279,-977.3066"/>
<polygon fill="#000000" stroke="#000000" points="8514.2162,-976.9978 8510.1587,-967.2107 8507.2273,-977.3919 8514.2162,-976.9978"/>
</g>
<!-- raw_127 -->
<g id="node128" class="node">
<title>raw_127</title>
<ellipse fill="none" stroke="#000000" cx="8585" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="8585" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_111&#45;&gt;raw_127 -->
<g id="edge127" class="edge">
<title>prose_111&#45;&gt;raw_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8336.2417,-2074.6563C8378.351,-2025.4627 8502.2384,-1872.1447 8549,-1719.8027 8634.4344,-1441.471 8600.7556,-1080.1902 8588.6319,-977.3974"/>
<polygon fill="#000000" stroke="#000000" points="8592.0748,-976.7143 8587.3993,-967.207 8585.1255,-977.5549 8592.0748,-976.7143"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9073.5,-1045.9022 8630.5,-1045.9022 8630.5,-852.1006 9073.5,-852.1006 9073.5,-1045.9022"/>
<text text-anchor="middle" x="8852" y="-1030.5016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8852" y="-999.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8852" y="-983.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8852" y="-968.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8852" y="-952.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8852" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8852" y="-922.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8852" y="-906.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8852" y="-891.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8852" y="-875.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8852" y="-860.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_112&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>codeblock_112&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8659.1581,-2072.5043C8679.2134,-1955.6612 8789.4015,-1313.7022 8833.6245,-1056.0575"/>
<polygon fill="#000000" stroke="#000000" points="8837.119,-1056.3873 8835.3612,-1045.9393 8830.2199,-1055.2031 8837.119,-1056.3873"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="7532.5,-135.0015 7243.5,-135.0015 7243.5,-79.1986 7532.5,-79.1986 7532.5,-135.0015"/>
<text text-anchor="middle" x="7388" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_114&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>raw_114&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7798.0271,-931.0147C7809.4444,-826.0708 7861.643,-293.5485 7759,-178.2001 7726.5054,-141.6832 7589.962,-151.6356 7542,-142.2001 7533.594,-140.5464 7524.946,-138.7735 7516.2405,-136.9353"/>
<polygon fill="#000000" stroke="#000000" points="7516.9071,-133.4988 7506.3969,-134.8349 7515.4463,-140.3447 7516.9071,-133.4988"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="7605,-125.1 7551,-125.1 7551,-89.1 7605,-89.1 7605,-125.1"/>
<text text-anchor="middle" x="7578" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_115&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>prespace_115&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7888.5722,-930.9825C7897.3403,-825.8553 7936.1648,-292.4665 7832,-178.2001 7765.8433,-105.6277 7701.6329,-186.5164 7614,-142.2001 7608.9367,-139.6396 7604.1238,-136.1165 7599.7605,-132.2847"/>
<polygon fill="#000000" stroke="#000000" points="7602.0551,-129.6347 7592.4352,-125.1953 7597.187,-134.6648 7602.0551,-129.6347"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="7677,-125.1 7623,-125.1 7623,-89.1 7677,-89.1 7677,-125.1"/>
<text text-anchor="middle" x="7650" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_116&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>literal_116&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7984.9677,-930.9696C7996.0336,-825.7688 8046.3814,-292.0326 7942,-178.2001 7864.3469,-93.5161 7789.1458,-192.8195 7686,-142.2001 7680.9064,-139.7004 7676.0786,-136.2072 7671.7099,-132.3862"/>
<polygon fill="#000000" stroke="#000000" points="7674.0044,-129.7362 7664.3839,-125.2982 7669.137,-134.767 7674.0044,-129.7362"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="7914.5,-126.4006 7695.5,-126.4006 7695.5,-87.7995 7914.5,-87.7995 7914.5,-126.4006"/>
<text text-anchor="middle" x="7805" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7805" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_117&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>raw_117&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8060.8177,-930.898C8070.9259,-826.4154 8116.4715,-300.8757 8023,-178.2001 8018.3839,-172.1417 7941.357,-147.911 7880.1578,-129.4041"/>
<polygon fill="#000000" stroke="#000000" points="7881.0698,-126.0235 7870.4851,-126.4867 7879.0484,-132.7253 7881.0698,-126.0235"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="7987,-125.1 7933,-125.1 7933,-89.1 7987,-89.1 7987,-125.1"/>
</g>
<!-- prespace_122&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>prespace_122&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8155.1064,-930.9255C8179.8161,-839.3268 8278.4871,-421.2617 8095,-178.2001 8066.7917,-140.8331 8035.6487,-167.0996 7996,-142.2001 7991.4954,-139.3712 7987.0954,-135.9002 7983.0056,-132.2531"/>
<polygon fill="#000000" stroke="#000000" points="7985.222,-129.5297 7975.577,-125.1452 7980.3826,-134.5875 7985.222,-129.5297"/>
</g>
<!-- leaf_129 -->
<g id="node130" class="node">
<title>leaf_129</title>
<polygon fill="none" stroke="#c0c0c0" points="8168.5,-125.1 8005.5,-125.1 8005.5,-89.1 8168.5,-89.1 8168.5,-125.1"/>
<text text-anchor="middle" x="8087" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_123&#45;&gt;leaf_129 -->
<g id="edge129" class="edge">
<title>literal_123&#45;&gt;leaf_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8247.2724,-930.8524C8254.2113,-827.2193 8284.3426,-310.3163 8205,-178.2001 8192.0705,-156.6708 8169.8963,-140.8412 8148.2361,-129.6576"/>
<polygon fill="#000000" stroke="#000000" points="8149.5339,-126.3962 8139.013,-125.146 8146.458,-132.6842 8149.5339,-126.3962"/>
</g>
<!-- leaf_130 -->
<g id="node131" class="node">
<title>leaf_130</title>
<polygon fill="none" stroke="#c0c0c0" points="8531.5,-126.4006 8186.5,-126.4006 8186.5,-87.7995 8531.5,-87.7995 8531.5,-126.4006"/>
<text text-anchor="middle" x="8359" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8359" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_124&#45;&gt;leaf_130 -->
<g id="edge130" class="edge">
<title>raw_124&#45;&gt;leaf_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8322.8072,-930.6341C8327.5459,-822.8095 8351.7435,-272.2148 8357.6825,-137.0788"/>
<polygon fill="#000000" stroke="#000000" points="8361.1967,-136.8299 8358.1392,-126.6858 8354.2035,-136.5225 8361.1967,-136.8299"/>
</g>
<!-- leaf_131 -->
<g id="node132" class="node">
<title>leaf_131</title>
<polygon fill="none" stroke="#c0c0c0" points="8604,-125.1 8550,-125.1 8550,-89.1 8604,-89.1 8604,-125.1"/>
<text text-anchor="middle" x="8577" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_125&#45;&gt;leaf_131 -->
<g id="edge131" class="edge">
<title>prespace_125&#45;&gt;leaf_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8408.4264,-931.0333C8386.558,-840.8079 8300.4872,-431.5041 8469,-178.2001 8488.5966,-148.7429 8511.0853,-162.5886 8540,-142.2001 8544.2332,-139.2152 8548.4637,-135.7616 8552.4719,-132.2093"/>
<polygon fill="#000000" stroke="#000000" points="8554.9057,-134.7256 8559.8477,-125.354 8550.1401,-129.5982 8554.9057,-134.7256"/>
</g>
<!-- leaf_132 -->
<g id="node133" class="node">
<title>leaf_132</title>
<polygon fill="none" stroke="#c0c0c0" points="8676,-125.1 8622,-125.1 8622,-89.1 8676,-89.1 8676,-125.1"/>
<text text-anchor="middle" x="8649" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_126&#45;&gt;leaf_132 -->
<g id="edge132" class="edge">
<title>literal_126&#45;&gt;leaf_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8507.6407,-930.8166C8500.2149,-826.9842 8467.7815,-309.1592 8549,-178.2001 8566.2007,-150.4652 8586.8732,-161.7571 8613,-142.2001 8616.9832,-139.2185 8620.9774,-135.8245 8624.7802,-132.3496"/>
<polygon fill="#000000" stroke="#000000" points="8627.4405,-134.6486 8632.2523,-125.2095 8622.6044,-129.5877 8627.4405,-134.6486"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9130,-126.4006 8694,-126.4006 8694,-87.7995 9130,-87.7995 9130,-126.4006"/>
<text text-anchor="middle" x="8912" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8912" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_127&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_127&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8583.0436,-930.788C8572.1545,-825.6868 8522.9573,-297.254 8621,-178.2001 8639.2829,-155.999 8696.085,-139.7101 8754.7102,-128.3687"/>
<polygon fill="#000000" stroke="#000000" points="8755.7168,-131.7407 8764.896,-126.4498 8754.4209,-124.8617 8755.7168,-131.7407"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="9282.5,-967.0014 9091.5,-967.0014 9091.5,-931.0014 9282.5,-931.0014 9282.5,-967.0014"/>
<text text-anchor="middle" x="9187" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_135&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>header_135&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9274.566,-2072.5043C9264.2826,-1940.5653 9201.8129,-1139.0566 9189.2136,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="9192.6918,-976.9862 9188.4253,-967.2884 9185.713,-977.5302 9192.6918,-976.9862"/>
</g>
<!-- raw_140 -->
<g id="node141" class="node">
<title>raw_140</title>
<ellipse fill="none" stroke="#000000" cx="9328" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="9328" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_136&#45;&gt;raw_140 -->
<g id="edge140" class="edge">
<title>prose_136&#45;&gt;raw_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9464.4655,-2072.9014C9456.8754,-2021.7696 9431.8992,-1871.8628 9385,-1755.8027 9378.0601,-1738.6287 9369.2501,-1737.5664 9364,-1719.8027 9281.4787,-1440.5934 9313.1245,-1079.9251 9324.5675,-977.3373"/>
<polygon fill="#000000" stroke="#000000" points="9328.0716,-977.5008 9325.7314,-967.1676 9321.117,-976.7048 9328.0716,-977.5008"/>
</g>
<!-- prespace_141 -->
<g id="node142" class="node">
<title>prespace_141</title>
<ellipse fill="none" stroke="#000000" cx="9419" cy="-949.0014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9419" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_136&#45;&gt;prespace_141 -->
<g id="edge141" class="edge">
<title>prose_136&#45;&gt;prespace_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9466.2266,-2072.5043C9460.6805,-1940.5653 9426.989,-1139.0566 9420.1938,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="9423.6857,-977.1325 9419.7687,-967.2884 9416.6919,-977.4266 9423.6857,-977.1325"/>
</g>
<!-- literal_142 -->
<g id="node143" class="node">
<title>literal_142</title>
<ellipse fill="none" stroke="#000000" cx="9515" cy="-949.0014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9515" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_136&#45;&gt;literal_142 -->
<g id="edge142" class="edge">
<title>prose_136&#45;&gt;literal_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9467.7734,-2072.5043C9473.3195,-1940.5653 9507.011,-1139.0566 9513.8062,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="9517.3081,-977.4266 9514.2313,-967.2884 9510.3143,-977.1325 9517.3081,-977.4266"/>
</g>
<!-- raw_143 -->
<g id="node144" class="node">
<title>raw_143</title>
<ellipse fill="none" stroke="#000000" cx="9591" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="9591" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_136&#45;&gt;raw_143 -->
<g id="edge143" class="edge">
<title>prose_136&#45;&gt;raw_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9472.5115,-2072.9819C9488.5999,-2019.7738 9535.5848,-1857.824 9555,-1719.8027 9595.5111,-1431.8125 9593.203,-1077.9621 9591.5655,-977.0498"/>
<polygon fill="#000000" stroke="#000000" points="9595.0649,-976.9793 9591.3912,-967.0418 9588.0659,-977.1012 9595.0649,-976.9793"/>
</g>
<!-- raw_148 -->
<g id="node149" class="node">
<title>raw_148</title>
<ellipse fill="none" stroke="#000000" cx="9663" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="9663" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_137&#45;&gt;raw_148 -->
<g id="edge148" class="edge">
<title>prose_137&#45;&gt;raw_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9607.0904,-2072.7577C9610.3111,-2018.9328 9619.994,-1855.4581 9627,-1719.8027 9641.9831,-1429.6869 9657.4136,-1078.0003 9661.7828,-977.2155"/>
<polygon fill="#000000" stroke="#000000" points="9665.28,-977.355 9662.2158,-967.213 9658.2865,-977.0522 9665.28,-977.355"/>
</g>
<!-- leaf_150 -->
<g id="node151" class="node">
<title>leaf_150</title>
<polygon fill="none" stroke="#c0c0c0" points="10263.5,-1438.9034 9708.5,-1438.9034 9708.5,-459.0994 10263.5,-459.0994 10263.5,-1438.9034"/>
<text text-anchor="middle" x="9986" y="-1423.5024" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9986" y="-1408.1023" font-family="Inconsolata" font-size="14.00" fill="#000000">local gsub = assert(string.gsub)</text>
<text text-anchor="middle" x="9986" y="-1392.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, best, c)</text>
<text text-anchor="middle" x="9986" y="-1377.3023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9986" y="-1361.9022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9986" y="-1346.5022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9986" y="-1331.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9986" y="-1315.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9986" y="-1300.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9986" y="-1284.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="9986" y="-1269.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-1254.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local Color</text>
<text text-anchor="middle" x="9986" y="-1238.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9986" y="-1223.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9986" y="-1207.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9986" y="-1192.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Color = c.alert</text>
<text text-anchor="middle" x="9986" y="-1177.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9986" y="-1161.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Color = c.search_hl</text>
<text text-anchor="middle" x="9986" y="-1146.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-1130.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9986" y="-1115.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = Color(char)</text>
<text text-anchor="middle" x="9986" y="-1100.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9986" y="-1084.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-1069.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9986" y="-1053.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9986" y="-1038.5016" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9986" y="-1007.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, phrase, c)</text>
<text text-anchor="middle" x="9986" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(c, &quot;must provide a color table&quot;)</text>
<text text-anchor="middle" x="9986" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local i = 1</text>
<text text-anchor="middle" x="9986" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local first = true</text>
<text text-anchor="middle" x="9986" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return function()</text>
<text text-anchor="middle" x="9986" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9986" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if first then</text>
<text text-anchor="middle" x="9986" y="-899.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;first = false</text>
<text text-anchor="middle" x="9986" y="-883.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return c.alert &quot;No results found&quot;</text>
<text text-anchor="middle" x="9986" y="-868.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9986" y="-853.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return nil</text>
<text text-anchor="middle" x="9986" y="-837.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-822.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-806.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line = collection[i]</text>
<text text-anchor="middle" x="9986" y="-791.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if line == nil then return nil end</text>
<text text-anchor="middle" x="9986" y="-776.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local len = #line</text>
<text text-anchor="middle" x="9986" y="-760.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local alt_seq = &quot; &#160;&#160;&#160;&quot;</text>
<text text-anchor="middle" x="9986" y="-745.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i &lt; 10 then</text>
<text text-anchor="middle" x="9986" y="-729.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alt_seq = c.bold(&quot;M&#45;&quot; .. tostring(i) .. &quot; &quot;)</text>
<text text-anchor="middle" x="9986" y="-714.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-699.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;len = len + 4</text>
<text text-anchor="middle" x="9986" y="-683.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if len &gt; phrase:remains() then</text>
<text text-anchor="middle" x="9986" y="-668.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line = line:sub(1, phrase:remains() &#45; 5) .. c.alert &quot;…&quot;</text>
<text text-anchor="middle" x="9986" y="-652.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;len = phrase.width &#45; (phrase.width &#45; phrase:remains() &#45; 4)</text>
<text text-anchor="middle" x="9986" y="-637.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-622.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local next_line = alt_seq</text>
<text text-anchor="middle" x="9986" y="-606.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(line, collection.frag, collection.best, c)</text>
<text text-anchor="middle" x="9986" y="-591.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i == collection.hl then</text>
<text text-anchor="middle" x="9986" y="-575.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next_line = c.highlight(next_line)</text>
<text text-anchor="middle" x="9986" y="-560.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-545.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;i = i + 1</text>
<text text-anchor="middle" x="9986" y="-529.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return next_line, len</text>
<text text-anchor="middle" x="9986" y="-514.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-498.9005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9986" y="-467.5005" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_138&#45;&gt;leaf_150 -->
<g id="edge150" class="edge">
<title>codeblock_138&#45;&gt;leaf_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9866.9496,-2072.5043C9874.7976,-1998.4411 9905.0025,-1713.3917 9933.0214,-1448.9716"/>
<polygon fill="#000000" stroke="#000000" points="9936.5278,-1449.0953 9934.1011,-1438.7822 9929.5667,-1448.3577 9936.5278,-1449.0953"/>
</g>
<!-- leaf_144 -->
<g id="node145" class="node">
<title>leaf_144</title>
<polygon fill="none" stroke="#c0c0c0" points="9395.5,-135.0015 9148.5,-135.0015 9148.5,-79.1986 9395.5,-79.1986 9395.5,-135.0015"/>
<text text-anchor="middle" x="9272" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_140&#45;&gt;leaf_144 -->
<g id="edge144" class="edge">
<title>raw_140&#45;&gt;leaf_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9328.545,-930.9331C9330.8194,-845.7609 9337.4014,-476.0483 9291,-178.2001 9289.286,-167.1979 9286.5371,-155.4469 9283.6565,-144.7319"/>
<polygon fill="#000000" stroke="#000000" points="9286.9517,-143.5196 9280.8839,-134.8344 9280.2112,-145.4079 9286.9517,-143.5196"/>
</g>
<!-- leaf_145 -->
<g id="node146" class="node">
<title>leaf_145</title>
<polygon fill="none" stroke="#c0c0c0" points="9468,-125.1 9414,-125.1 9414,-89.1 9468,-89.1 9468,-125.1"/>
<text text-anchor="middle" x="9441" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_141&#45;&gt;leaf_145 -->
<g id="edge145" class="edge">
<title>prespace_141&#45;&gt;leaf_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9419.48,-930.6341C9422.3098,-822.3417 9436.8104,-267.4291 9440.262,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="9443.7638,-135.3136 9440.5264,-125.2255 9436.7662,-135.1307 9443.7638,-135.3136"/>
</g>
<!-- leaf_146 -->
<g id="node147" class="node">
<title>leaf_146</title>
<polygon fill="none" stroke="#c0c0c0" points="9544,-125.1 9486,-125.1 9486,-89.1 9544,-89.1 9544,-125.1"/>
<text text-anchor="middle" x="9515" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_142&#45;&gt;leaf_146 -->
<g id="edge146" class="edge">
<title>literal_142&#45;&gt;leaf_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9515,-930.6341C9515,-822.3417 9515,-267.4291 9515,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="9518.5001,-135.2255 9515,-125.2255 9511.5001,-135.2256 9518.5001,-135.2255"/>
</g>
<!-- leaf_147 -->
<g id="node148" class="node">
<title>leaf_147</title>
<polygon fill="none" stroke="#c0c0c0" points="10089.5,-134.3005 9562.5,-134.3005 9562.5,-79.8996 10089.5,-79.8996 10089.5,-134.3005"/>
<text text-anchor="middle" x="9826" y="-119.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9826" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9826" y="-88.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_143&#45;&gt;leaf_147 -->
<g id="edge147" class="edge">
<title>raw_143&#45;&gt;leaf_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9589.2345,-930.9372C9579.42,-826.6751 9535.2478,-302.1669 9627,-178.2001 9638.0195,-163.3116 9671.3069,-149.1064 9707.5811,-137.3618"/>
<polygon fill="#000000" stroke="#000000" points="9708.8811,-140.6217 9717.3634,-134.2735 9706.7737,-133.9465 9708.8811,-140.6217"/>
</g>
<!-- leaf_149 -->
<g id="node150" class="node">
<title>leaf_149</title>
<polygon fill="none" stroke="#c0c0c0" points="10620.5,-134.4005 10107.5,-134.4005 10107.5,-79.7996 10620.5,-79.7996 10620.5,-134.4005"/>
<text text-anchor="middle" x="10364" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10364" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_148&#45;&gt;leaf_149 -->
<g id="edge149" class="edge">
<title>raw_148&#45;&gt;leaf_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9660.8219,-930.9006C9648.5412,-825.3066 9592.2157,-289.7125 9699,-178.2001 9729.7868,-146.0502 10053.7585,-147.1128 10098,-142.2001 10116.0519,-140.1956 10134.7758,-137.9874 10153.5481,-135.684"/>
<polygon fill="#000000" stroke="#000000" points="10154.1752,-139.1333 10163.6707,-134.4336 10153.317,-132.1861 10154.1752,-139.1333"/>
</g>
<!-- leaf_161 -->
<g id="node162" class="node">
<title>leaf_161</title>
<polygon fill="none" stroke="#c0c0c0" points="10557.5,-2108.9034 10366.5,-2108.9034 10366.5,-2072.9034 10557.5,-2072.9034 10557.5,-2108.9034"/>
<text text-anchor="middle" x="10462" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_151&#45;&gt;leaf_161 -->
<g id="edge161" class="edge">
<title>header_151&#45;&gt;leaf_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10543.72,-2540.6525C10530.7453,-2469.2458 10482.9468,-2206.1849 10467.1242,-2119.1046"/>
<polygon fill="#000000" stroke="#000000" points="10470.5475,-2118.3668 10465.3161,-2109.1536 10463.6603,-2119.6183 10470.5475,-2118.3668"/>
</g>
<!-- raw_162 -->
<g id="node163" class="node">
<title>raw_162</title>
<ellipse fill="none" stroke="#000000" cx="10603" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="10603" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_152&#45;&gt;raw_162 -->
<g id="edge162" class="edge">
<title>prose_152&#45;&gt;raw_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10766.773,-2545.9848C10732.2257,-2525.6733 10668.2419,-2482.3904 10639,-2426.0041 10585.7461,-2323.3161 10593.2734,-2179.3865 10599.4645,-2119.1524"/>
<polygon fill="#000000" stroke="#000000" points="10602.9768,-2119.2306 10600.59,-2108.9082 10596.0187,-2118.4661 10602.9768,-2119.2306"/>
</g>
<!-- prespace_163 -->
<g id="node164" class="node">
<title>prespace_163</title>
<ellipse fill="none" stroke="#000000" cx="10694" cy="-2090.9034" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10694" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_152&#45;&gt;prespace_163 -->
<g id="edge163" class="edge">
<title>prose_152&#45;&gt;prespace_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10783.8326,-2540.8703C10775.2676,-2515.5767 10759.7301,-2467.7148 10750,-2426.0041 10723.8161,-2313.7593 10704.9772,-2177.6271 10697.5261,-2119.4721"/>
<polygon fill="#000000" stroke="#000000" points="10700.9573,-2118.7078 10696.2284,-2109.2269 10694.0128,-2119.5875 10700.9573,-2118.7078"/>
</g>
<!-- literal_164 -->
<g id="node165" class="node">
<title>literal_164</title>
<ellipse fill="none" stroke="#000000" cx="10790" cy="-2090.9034" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10790" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_152&#45;&gt;literal_164 -->
<g id="edge164" class="edge">
<title>prose_152&#45;&gt;literal_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10790,-2540.6525C10790,-2469.3184 10790,-2206.72 10790,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="10793.5001,-2119.1536 10790,-2109.1536 10786.5001,-2119.1537 10793.5001,-2119.1536"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="10868" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="10868" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_152&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_152&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10796.4743,-2540.9377C10805.4037,-2515.724 10821.3716,-2467.9565 10830,-2426.0041 10853.0485,-2313.9392 10863.0511,-2177.7123 10866.4949,-2119.5023"/>
<polygon fill="#000000" stroke="#000000" points="10870.0046,-2119.4305 10867.0807,-2109.2471 10863.016,-2119.0312 10870.0046,-2119.4305"/>
</g>
<!-- raw_170 -->
<g id="node171" class="node">
<title>raw_170</title>
<ellipse fill="none" stroke="#000000" cx="11448" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="11448" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_153&#45;&gt;raw_170 -->
<g id="edge170" class="edge">
<title>prose_153&#45;&gt;raw_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11514.3374,-2540.6525C11503.7931,-2469.1652 11464.9163,-2205.5909 11452.1163,-2118.8104"/>
<polygon fill="#000000" stroke="#000000" points="11455.5765,-2118.2835 11450.6547,-2108.9013 11448.6514,-2119.305 11455.5765,-2118.2835"/>
</g>
<!-- raw_172 -->
<g id="node173" class="node">
<title>raw_172</title>
<ellipse fill="none" stroke="#000000" cx="11598" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="11598" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_154&#45;&gt;raw_172 -->
<g id="edge172" class="edge">
<title>prose_154&#45;&gt;raw_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11666.2602,-2540.6525C11655.4103,-2469.1652 11615.4066,-2205.5909 11602.2356,-2118.8104"/>
<polygon fill="#000000" stroke="#000000" points="11605.6926,-2118.2629 11600.7316,-2108.9013 11598.7719,-2119.3133 11605.6926,-2118.2629"/>
</g>
<!-- raw_174 -->
<g id="node175" class="node">
<title>raw_174</title>
<ellipse fill="none" stroke="#000000" cx="11890" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="11890" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_155&#45;&gt;raw_174 -->
<g id="edge174" class="edge">
<title>prose_155&#45;&gt;raw_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11890,-2540.6525C11890,-2469.3184 11890,-2206.72 11890,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="11893.5001,-2119.1536 11890,-2109.1536 11886.5001,-2119.1537 11893.5001,-2119.1536"/>
</g>
<!-- raw_176 -->
<g id="node177" class="node">
<title>raw_176</title>
<ellipse fill="none" stroke="#000000" cx="12325" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="12325" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_156&#45;&gt;raw_176 -->
<g id="edge176" class="edge">
<title>prose_156&#45;&gt;raw_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12098.7834,-2541.2197C12134.4867,-2470.1471 12268.8684,-2202.6413 12311.7572,-2117.2651"/>
<polygon fill="#000000" stroke="#000000" points="12314.9359,-2118.7342 12316.2974,-2108.2272 12308.6808,-2115.5919 12314.9359,-2118.7342"/>
</g>
<!-- raw_178 -->
<g id="node179" class="node">
<title>raw_178</title>
<ellipse fill="none" stroke="#000000" cx="12946" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="12946" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_157&#45;&gt;raw_178 -->
<g id="edge178" class="edge">
<title>prose_157&#45;&gt;raw_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13058.3726,-2541.0874C13046.4211,-2516.0516 13024.8506,-2468.4941 13012,-2426.0041 12978.3776,-2314.8328 12957.5679,-2177.6035 12949.6477,-2119.2763"/>
<polygon fill="#000000" stroke="#000000" points="12953.0698,-2118.4591 12948.277,-2109.0103 12946.1313,-2119.3855 12953.0698,-2118.4591"/>
</g>
<!-- prespace_179 -->
<g id="node180" class="node">
<title>prespace_179</title>
<ellipse fill="none" stroke="#000000" cx="13067" cy="-2090.9034" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13067" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_157&#45;&gt;prespace_179 -->
<g id="edge179" class="edge">
<title>prose_157&#45;&gt;prespace_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13067,-2540.6525C13067,-2469.3184 13067,-2206.72 13067,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="13070.5001,-2119.1536 13067,-2109.1536 13063.5001,-2119.1537 13070.5001,-2119.1536"/>
</g>
<!-- literal_180 -->
<g id="node181" class="node">
<title>literal_180</title>
<ellipse fill="none" stroke="#000000" cx="13163" cy="-2090.9034" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13163" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_157&#45;&gt;literal_180 -->
<g id="edge180" class="edge">
<title>prose_157&#45;&gt;literal_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13076.0599,-2541.2097C13088.5253,-2516.3191 13110.7025,-2468.9332 13122,-2426.0041 13151.2179,-2314.9793 13159.7273,-2177.6723 13162.1126,-2119.3006"/>
<polygon fill="#000000" stroke="#000000" points="13165.6207,-2119.1516 13162.5014,-2109.0264 13158.6257,-2118.8868 13165.6207,-2119.1516"/>
</g>
<!-- raw_181 -->
<g id="node182" class="node">
<title>raw_181</title>
<ellipse fill="none" stroke="#000000" cx="13239" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="13239" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_157&#45;&gt;raw_181 -->
<g id="edge181" class="edge">
<title>prose_157&#45;&gt;raw_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13088.4593,-2545.037C13119.7229,-2523.8071 13176.9023,-2479.7079 13203,-2426.0041 13253.439,-2322.2107 13247.5278,-2179.4518 13242.1547,-2119.3706"/>
<polygon fill="#000000" stroke="#000000" points="13245.6124,-2118.7614 13241.1714,-2109.1423 13238.6445,-2119.4313 13245.6124,-2118.7614"/>
</g>
<!-- raw_186 -->
<g id="node187" class="node">
<title>raw_186</title>
<ellipse fill="none" stroke="#000000" cx="13311" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="13311" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_158&#45;&gt;raw_186 -->
<g id="edge186" class="edge">
<title>prose_158&#45;&gt;raw_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13237.3907,-2541.0307C13247.5637,-2515.9275 13265.6779,-2468.2905 13275,-2426.0041 13299.6736,-2314.0806 13307.6655,-2177.2501 13310.0585,-2119.1519"/>
<polygon fill="#000000" stroke="#000000" points="13313.5647,-2119.0555 13310.4544,-2108.9276 13306.57,-2118.7846 13313.5647,-2119.0555"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13911.5,-2426.1048 13356.5,-2426.1048 13356.5,-1755.702 13911.5,-1755.702 13911.5,-2426.1048"/>
<text text-anchor="middle" x="13634" y="-2410.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="13634" y="-2395.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.last_collection</text>
<text text-anchor="middle" x="13634" y="-2380.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;and historian.last_collection[1].lit_frag == frag then</text>
<text text-anchor="middle" x="13634" y="-2364.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t repeat a search</text>
<text text-anchor="middle" x="13634" y="-2349.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return historian.last_collection</text>
<text text-anchor="middle" x="13634" y="-2333.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13634" y="-2318.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="13634" y="-2303.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="13634" y="-2287.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.lit_frag = frag</text>
<text text-anchor="middle" x="13634" y="-2272.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if frag == &quot;&quot; then</text>
<text text-anchor="middle" x="13634" y="-2256.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Rainbuf {[1] = collection, n = 1}, false</text>
<text text-anchor="middle" x="13634" y="-2241.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13634" y="-2226.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="13634" y="-2210.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="13634" y="-2195.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="13634" y="-2179.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="13634" y="-2164.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="13634" y="-2149.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="13634" y="-2133.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="13634" y="-2118.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="13634" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="13634" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13634" y="-2072.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="13634" y="-2056.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="13634" y="-2041.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="13634" y="-2025.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="13634" y="-2010.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="13634" y="-1995.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="13634" y="-1979.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="13634" y="-1964.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="13634" y="-1948.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="13634" y="-1933.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="13634" y="-1918.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="13634" y="-1902.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="13634" y="-1887.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="13634" y="-1871.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13634" y="-1856.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="13634" y="-1841.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="13634" y="-1825.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.hl = 1</text>
<text text-anchor="middle" x="13634" y="-1810.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.last_collection = Rainbuf {[1] = collection, n = 1, live = true}</text>
<text text-anchor="middle" x="13634" y="-1794.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.last_collection.made_in = &quot;historian.search&quot;</text>
<text text-anchor="middle" x="13634" y="-1779.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian.last_collection, best</text>
<text text-anchor="middle" x="13634" y="-1764.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_159&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>codeblock_159&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13506.1323,-2540.6525C13512.1602,-2519.4505 13522.9919,-2481.3521 13535.8914,-2435.9807"/>
<polygon fill="#000000" stroke="#000000" points="13539.3062,-2436.768 13538.6744,-2426.192 13532.573,-2434.8537 13539.3062,-2436.768"/>
</g>
<!-- header_189 -->
<g id="node190" class="node">
<title>header_189</title>
<ellipse fill="none" stroke="#000000" cx="14259" cy="-2090.9034" rx="143.582" ry="18"/>
<text text-anchor="middle" x="14259" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : _resultsFrom(historian, line_id)</text>
</g>
<!-- section_160&#45;&gt;header_189 -->
<g id="edge189" class="edge">
<title>section_160&#45;&gt;header_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14352.2569,-2540.6525C14337.4338,-2469.1652 14282.7808,-2205.5909 14264.7866,-2118.8104"/>
<polygon fill="#000000" stroke="#000000" points="14268.1894,-2117.9824 14262.7319,-2108.9013 14261.3352,-2119.4037 14268.1894,-2117.9824"/>
</g>
<!-- prose_190 -->
<g id="node191" class="node">
<title>prose_190</title>
<ellipse fill="none" stroke="#000000" cx="14453" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14453" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_160&#45;&gt;prose_190 -->
<g id="edge190" class="edge">
<title>section_160&#45;&gt;prose_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14365.45,-2540.8104C14378.1928,-2515.8352 14400.5986,-2468.7703 14412,-2426.0041 14441.5738,-2315.0736 14449.8944,-2177.7166 14452.1715,-2119.3162"/>
<polygon fill="#000000" stroke="#000000" points="14455.6794,-2119.1559 14452.5405,-2109.0367 14448.6839,-2118.9047 14455.6794,-2119.1559"/>
</g>
<!-- codeblock_191 -->
<g id="node192" class="node">
<title>codeblock_191</title>
<ellipse fill="none" stroke="#000000" cx="14591" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14591" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 468&#45;481</text>
</g>
<!-- section_160&#45;&gt;codeblock_191 -->
<g id="edge191" class="edge">
<title>section_160&#45;&gt;codeblock_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14380.4691,-2541.6216C14411.3962,-2518.7718 14464.1844,-2475.3661 14494,-2426.0041 14555.9058,-2323.5141 14580.0459,-2179.4767 14587.8307,-2119.1832"/>
<polygon fill="#000000" stroke="#000000" points="14591.345,-2119.2826 14589.0994,-2108.9285 14584.398,-2118.4231 14591.345,-2119.2826"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="10648,-976.9029 10282,-976.9029 10282,-921.0999 10648,-921.0999 10648,-976.9029"/>
<text text-anchor="middle" x="10465" y="-929.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_162&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_162&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10601.0876,-2072.7306C10595.7666,-2022.362 10580.2422,-1876.7108 10566,-1755.8027 10531.0894,-1459.4327 10484.9623,-1102.3655 10469.9496,-986.9463"/>
<polygon fill="#000000" stroke="#000000" points="10473.3973,-986.317 10468.6359,-976.8524 10466.4559,-987.2205 10473.3973,-986.317"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="10720,-967.0014 10666,-967.0014 10666,-931.0014 10720,-931.0014 10720,-967.0014"/>
<text text-anchor="middle" x="10693" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_163&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>prespace_163&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10693.9839,-2072.5043C10693.8683,-1940.5653 10693.1664,-1139.0566 10693.0249,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="10696.5249,-977.2853 10693.016,-967.2884 10689.5249,-977.2915 10696.5249,-977.2853"/>
</g>
<!-- leaf_168 -->
<g id="node169" class="node">
<title>leaf_168</title>
<polygon fill="none" stroke="#c0c0c0" points="10824,-967.0014 10738,-967.0014 10738,-931.0014 10824,-931.0014 10824,-967.0014"/>
<text text-anchor="middle" x="10781" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_164&#45;&gt;leaf_168 -->
<g id="edge168" class="edge">
<title>literal_164&#45;&gt;leaf_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10789.855,-2072.5043C10788.8151,-1940.5653 10782.4979,-1139.0566 10781.2238,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="10784.7229,-977.2605 10781.1441,-967.2884 10777.7232,-977.3157 10784.7229,-977.2605"/>
</g>
<!-- leaf_169 -->
<g id="node170" class="node">
<title>leaf_169</title>
<polygon fill="none" stroke="#c0c0c0" points="10896,-967.0014 10842,-967.0014 10842,-931.0014 10896,-931.0014 10896,-967.0014"/>
<text text-anchor="middle" x="10869" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_165&#45;&gt;leaf_169 -->
<g id="edge169" class="edge">
<title>raw_165&#45;&gt;leaf_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10868.0161,-2072.5043C10868.1317,-1940.5653 10868.8336,-1139.0566 10868.9751,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="10872.4751,-977.2915 10868.984,-967.2884 10865.4751,-977.2853 10872.4751,-977.2915"/>
</g>
<!-- leaf_171 -->
<g id="node172" class="node">
<title>leaf_171</title>
<polygon fill="none" stroke="#c0c0c0" points="11427.5,-968.9035 10914.5,-968.9035 10914.5,-929.0993 11427.5,-929.0993 11427.5,-968.9035"/>
<text text-anchor="middle" x="11171" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_170&#45;&gt;leaf_171 -->
<g id="edge171" class="edge">
<title>raw_170&#45;&gt;leaf_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11443.649,-2072.9668C11412.0955,-1942.891 11218.4626,-1144.6606 11178.2922,-979.0627"/>
<polygon fill="#000000" stroke="#000000" points="11181.6304,-977.9768 11175.8715,-969.0837 11174.8276,-979.627 11181.6304,-977.9768"/>
</g>
<!-- leaf_173 -->
<g id="node174" class="node">
<title>leaf_173</title>
<polygon fill="none" stroke="#c0c0c0" points="11608.5,-968.9035 11445.5,-968.9035 11445.5,-929.0993 11608.5,-929.0993 11608.5,-968.9035"/>
<text text-anchor="middle" x="11527" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_172&#45;&gt;leaf_173 -->
<g id="edge173" class="edge">
<title>raw_172&#45;&gt;leaf_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11596.856,-2072.5043C11588.6873,-1941.1261 11539.24,-1145.8586 11528.8962,-979.4982"/>
<polygon fill="#000000" stroke="#000000" points="11532.36,-978.806 11528.2461,-969.0425 11525.3735,-979.2405 11532.36,-978.806"/>
</g>
<!-- leaf_175 -->
<g id="node176" class="node">
<title>leaf_175</title>
<polygon fill="none" stroke="#c0c0c0" points="12153.5,-984.2018 11626.5,-984.2018 11626.5,-913.801 12153.5,-913.801 12153.5,-984.2018"/>
<text text-anchor="middle" x="11890" y="-952.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11890" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11890" y="-922.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_174&#45;&gt;leaf_175 -->
<g id="edge175" class="edge">
<title>raw_174&#45;&gt;leaf_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11890,-2072.5043C11890,-1944.6903 11890,-1188.5203 11890,-994.4008"/>
<polygon fill="#000000" stroke="#000000" points="11893.5001,-994.2643 11890,-984.2643 11886.5001,-994.2644 11893.5001,-994.2643"/>
</g>
<!-- leaf_177 -->
<g id="node178" class="node">
<title>leaf_177</title>
<polygon fill="none" stroke="#c0c0c0" points="12712.5,-976.3018 12171.5,-976.3018 12171.5,-921.701 12712.5,-921.701 12712.5,-976.3018"/>
<text text-anchor="middle" x="12442" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection. &#160;Is transposed</text>
<text text-anchor="middle" x="12442" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in a next&#45;best search.</text>
</g>
<!-- raw_176&#45;&gt;leaf_177 -->
<g id="edge177" class="edge">
<title>raw_176&#45;&gt;leaf_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12326.8852,-2072.5043C12340.1633,-1942.9121 12419.627,-1167.3588 12438.1447,-986.6285"/>
<polygon fill="#000000" stroke="#000000" points="12441.6402,-986.8505 12439.1778,-976.5458 12434.6767,-986.1369 12441.6402,-986.8505"/>
</g>
<!-- leaf_182 -->
<g id="node183" class="node">
<title>leaf_182</title>
<polygon fill="none" stroke="#c0c0c0" points="13103.5,-968.9035 12730.5,-968.9035 12730.5,-929.0993 13103.5,-929.0993 13103.5,-968.9035"/>
<text text-anchor="middle" x="12917" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;lit_frag : &#160;The literal fragment passed as the</text>
</g>
<!-- raw_178&#45;&gt;leaf_182 -->
<g id="edge182" class="edge">
<title>raw_178&#45;&gt;leaf_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12945.5327,-2072.5043C12942.1962,-1941.1261 12921.9994,-1145.8586 12917.7745,-979.4982"/>
<polygon fill="#000000" stroke="#000000" points="12921.2618,-978.9504 12917.509,-969.0425 12914.2641,-979.1282 12921.2618,-978.9504"/>
</g>
<!-- leaf_183 -->
<g id="node184" class="node">
<title>leaf_183</title>
<polygon fill="none" stroke="#c0c0c0" points="13176,-967.0014 13122,-967.0014 13122,-931.0014 13176,-931.0014 13176,-967.0014"/>
<text text-anchor="middle" x="13149" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_179&#45;&gt;leaf_183 -->
<g id="edge183" class="edge">
<title>prespace_179&#45;&gt;leaf_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13069.6689,-2072.8024C13077.4848,-2019.1006 13100.4947,-1855.9301 13112,-1719.8027 13136.4672,-1430.3146 13146.032,-1078.1923 13148.3853,-977.2595"/>
<polygon fill="#000000" stroke="#000000" points="13151.8848,-977.3195 13148.6142,-967.2421 13144.8866,-977.1595 13151.8848,-977.3195"/>
</g>
<!-- leaf_184 -->
<g id="node185" class="node">
<title>leaf_184</title>
<polygon fill="none" stroke="#c0c0c0" points="13248,-967.0014 13194,-967.0014 13194,-931.0014 13248,-931.0014 13248,-967.0014"/>
<text text-anchor="middle" x="13221" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">frag</text>
</g>
<!-- literal_180&#45;&gt;leaf_184 -->
<g id="edge184" class="edge">
<title>literal_180&#45;&gt;leaf_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13164.1566,-2072.7588C13167.5698,-2018.937 13177.8108,-1855.4697 13185,-1719.8027 13200.3727,-1429.7073 13215.5327,-1078.0066 13219.8102,-977.2169"/>
<polygon fill="#000000" stroke="#000000" points="13223.3075,-977.3531 13220.2339,-967.2139 13216.3137,-977.0568 13223.3075,-977.3531"/>
</g>
<!-- leaf_185 -->
<g id="node186" class="node">
<title>leaf_185</title>
<polygon fill="none" stroke="#c0c0c0" points="13590,-968.302 13266,-968.302 13266,-929.7008 13590,-929.7008 13590,-968.302"/>
<text text-anchor="middle" x="13428" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> parameter. &#160;Used to</text>
<text text-anchor="middle" x="13428" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;compare to the last search.</text>
</g>
<!-- raw_181&#45;&gt;leaf_185 -->
<g id="edge185" class="edge">
<title>raw_181&#45;&gt;leaf_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13240.4394,-2072.6758C13244.5398,-2022.1672 13257.1477,-1876.1911 13275,-1755.8027 13320.3387,-1450.0569 13398.6189,-1083.52 13421.5268,-978.4474"/>
<polygon fill="#000000" stroke="#000000" points="13424.9718,-979.0767 13423.6875,-968.56 13418.1332,-977.5822 13424.9718,-979.0767"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="14114,-976.3018 13608,-976.3018 13608,-921.701 14114,-921.701 14114,-976.3018"/>
<text text-anchor="middle" x="13861" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="13861" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_186&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>raw_186&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13306.2834,-2072.9123C13292.8414,-2017.0926 13260.6263,-1845.2426 13347,-1755.8027 13425.5928,-1674.4199 13511.9252,-1792.0383 13599,-1719.8027 13833.1241,-1525.5779 13858.7665,-1113.1106 13860.9957,-986.6507"/>
<polygon fill="#000000" stroke="#000000" points="13864.4996,-986.3813 13861.1355,-976.3347 13857.5002,-986.2863 13864.4996,-986.3813"/>
</g>
<!-- leaf_192 -->
<g id="node193" class="node">
<title>leaf_192</title>
<polygon fill="none" stroke="#c0c0c0" points="14407.5,-967.0014 14132.5,-967.0014 14132.5,-931.0014 14407.5,-931.0014 14407.5,-967.0014"/>
<text text-anchor="middle" x="14270" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">**** _resultsFrom(historian, line_id)</text>
</g>
<!-- header_189&#45;&gt;leaf_192 -->
<g id="edge192" class="edge">
<title>header_189&#45;&gt;leaf_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14259.1772,-2072.5043C14260.4482,-1940.5653 14268.1692,-1139.0566 14269.7264,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="14273.2273,-977.3217 14269.8238,-967.2884 14266.2276,-977.2542 14273.2273,-977.3217"/>
</g>
<!-- raw_193 -->
<g id="node194" class="node">
<title>raw_193</title>
<ellipse fill="none" stroke="#000000" cx="14453" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="14453" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_190&#45;&gt;raw_193 -->
<g id="edge193" class="edge">
<title>prose_190&#45;&gt;raw_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14453,-2072.5043C14453,-1940.5653 14453,-1139.0566 14453,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="14456.5001,-977.2884 14453,-967.2884 14449.5001,-977.2884 14456.5001,-977.2884"/>
</g>
<!-- leaf_195 -->
<g id="node196" class="node">
<title>leaf_195</title>
<polygon fill="none" stroke="#c0c0c0" points="14843.5,-1045.3019 14498.5,-1045.3019 14498.5,-852.7009 14843.5,-852.7009 14843.5,-1045.3019"/>
<text text-anchor="middle" x="14671" y="-1030.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _resultsFrom(historian, line_id)</text>
<text text-anchor="middle" x="14671" y="-1014.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local stmt = historian.get_results</text>
<text text-anchor="middle" x="14671" y="-999.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;stmt:bindkv {line_id = line_id}</text>
<text text-anchor="middle" x="14671" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local results = stmt:resultset()</text>
<text text-anchor="middle" x="14671" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if results then</text>
<text text-anchor="middle" x="14671" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;results = results[1]</text>
<text text-anchor="middle" x="14671" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;results.n = #results</text>
<text text-anchor="middle" x="14671" y="-922.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;results.frozen = true</text>
<text text-anchor="middle" x="14671" y="-907.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14671" y="-891.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.get_results:clearbind():reset()</text>
<text text-anchor="middle" x="14671" y="-876.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return results</text>
<text text-anchor="middle" x="14671" y="-860.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_191&#45;&gt;leaf_195 -->
<g id="edge195" class="edge">
<title>codeblock_191&#45;&gt;leaf_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14592.289,-2072.5043C14600.4798,-1955.5904 14645.5041,-1312.9244 14663.5326,-1055.5898"/>
<polygon fill="#000000" stroke="#000000" points="14667.033,-1055.7047 14664.2405,-1045.4845 14660.0501,-1055.2155 14667.033,-1055.7047"/>
</g>
<!-- leaf_194 -->
<g id="node195" class="node">
<title>leaf_194</title>
<polygon fill="none" stroke="#c0c0c0" points="14695.5,-135.0015 14210.5,-135.0015 14210.5,-79.1986 14695.5,-79.1986 14695.5,-135.0015"/>
<text text-anchor="middle" x="14453" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Retrieve a set of results reprs from the database, given a line_id.</text>
</g>
<!-- raw_193&#45;&gt;leaf_194 -->
<g id="edge194" class="edge">
<title>raw_193&#45;&gt;leaf_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14453,-930.6341C14453,-824.948 14453,-293.8807 14453,-145.6029"/>
<polygon fill="#000000" stroke="#000000" points="14456.5001,-145.2027 14453,-135.2027 14449.5001,-145.2028 14456.5001,-145.2027"/>
</g>
<!-- leaf_202 -->
<g id="node203" class="node">
<title>leaf_202</title>
<polygon fill="none" stroke="#c0c0c0" points="14845.5,-2108.9034 14696.5,-2108.9034 14696.5,-2072.9034 14845.5,-2072.9034 14845.5,-2108.9034"/>
<text text-anchor="middle" x="14771" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_196&#45;&gt;leaf_202 -->
<g id="edge202" class="edge">
<title>header_196&#45;&gt;leaf_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14813.3021,-2540.6525C14806.5926,-2469.3184 14781.8934,-2206.72 14773.6776,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="14777.1377,-2118.7819 14772.7166,-2109.1536 14770.1685,-2119.4375 14777.1377,-2118.7819"/>
</g>
<!-- raw_203 -->
<g id="node204" class="node">
<title>raw_203</title>
<ellipse fill="none" stroke="#000000" cx="14891" cy="-2090.9034" rx="27" ry="18"/>
<text text-anchor="middle" x="14891" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_197&#45;&gt;raw_203 -->
<g id="edge203" class="edge">
<title>prose_197&#45;&gt;raw_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14981.1042,-2541.4715C14966.1481,-2516.892 14939.6741,-2469.8733 14927,-2426.0041 14895.1892,-2315.8963 14890.982,-2178.103 14890.7605,-2119.4523"/>
<polygon fill="#000000" stroke="#000000" points="14894.2604,-2119.1274 14890.761,-2109.1272 14887.2604,-2119.127 14894.2604,-2119.1274"/>
</g>
<!-- leaf_205 -->
<g id="node206" class="node">
<title>leaf_205</title>
<polygon fill="none" stroke="#c0c0c0" points="15499.9015,-2201.544 14936.0985,-2201.544 14936.0985,-1980.2628 15499.9015,-1980.2628 15499.9015,-2201.544"/>
<text text-anchor="middle" x="15218" y="-2186.5235" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="15218" y="-2171.1235" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="15218" y="-2155.7235" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="15218" y="-2140.3234" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15218" y="-2124.9234" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and historian.cursor &#45; 1 or historian.cursor</text>
<text text-anchor="middle" x="15218" y="-2106.1634" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[Δ]</text>
<text text-anchor="middle" x="15218" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="15218" y="-2072.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = _resultsFrom(historian, historian.line_ids[Δ])</text>
<text text-anchor="middle" x="15218" y="-2053.2434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="15218" y="-2037.8433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = Δ</text>
<text text-anchor="middle" x="15218" y="-2019.0833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="15218" y="-2003.6833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="15218" y="-1988.2833" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_198&#45;&gt;leaf_205 -->
<g id="edge205" class="edge">
<title>codeblock_198&#45;&gt;leaf_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15218,-2540.6525C15218,-2487.1094 15218,-2325.8089 15218,-2211.7431"/>
<polygon fill="#000000" stroke="#000000" points="15221.5001,-2211.5486 15218,-2201.5486 15214.5001,-2211.5486 15221.5001,-2211.5486"/>
</g>
<!-- header_206 -->
<g id="node207" class="node">
<title>header_206</title>
<ellipse fill="none" stroke="#000000" cx="15600" cy="-2090.9034" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="15600" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_199&#45;&gt;header_206 -->
<g id="edge206" class="edge">
<title>section_199&#45;&gt;header_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15663.4532,-2540.6525C15653.3673,-2469.1652 15616.1808,-2205.5909 15603.9373,-2118.8104"/>
<polygon fill="#000000" stroke="#000000" points="15607.402,-2118.3142 15602.5392,-2108.9013 15600.4707,-2119.2922 15607.402,-2118.3142"/>
</g>
<!-- prose_207 -->
<g id="node208" class="node">
<title>prose_207</title>
<ellipse fill="none" stroke="#000000" cx="15733" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15733" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_199&#45;&gt;prose_207 -->
<g id="edge207" class="edge">
<title>section_199&#45;&gt;prose_207</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15669.8375,-2540.3043C15675.0839,-2514.7418 15684.5756,-2466.9987 15691,-2426.0041 15708.7383,-2312.8142 15723.8678,-2177.1797 15730.0362,-2119.3132"/>
<polygon fill="#000000" stroke="#000000" points="15733.5429,-2119.4338 15731.1154,-2109.1208 15726.5818,-2118.6966 15733.5429,-2119.4338"/>
</g>
<!-- codeblock_208 -->
<g id="node209" class="node">
<title>codeblock_208</title>
<ellipse fill="none" stroke="#000000" cx="15960" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15960" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 509&#45;533</text>
</g>
<!-- section_199&#45;&gt;codeblock_208 -->
<g id="edge208" class="edge">
<title>section_199&#45;&gt;codeblock_208</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15682.0887,-2541.0323C15704.1853,-2516.3145 15744.5339,-2469.5469 15774,-2426.0041 15847.6765,-2317.1305 15918.4158,-2176.7153 15946.869,-2118.2899"/>
<polygon fill="#000000" stroke="#000000" points="15950.162,-2119.5203 15951.3749,-2108.9951 15943.8632,-2116.4667 15950.162,-2119.5203"/>
</g>
<!-- header_219 -->
<g id="node220" class="node">
<title>header_219</title>
<ellipse fill="none" stroke="#000000" cx="16395" cy="-2090.9034" rx="111.1981" ry="18"/>
<text text-anchor="middle" x="16395" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:index(cursor)</text>
</g>
<!-- section_200&#45;&gt;header_219 -->
<g id="edge219" class="edge">
<title>section_200&#45;&gt;header_219</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16472.8743,-2540.6525C16460.4963,-2469.1652 16414.8582,-2205.5909 16399.8321,-2118.8104"/>
<polygon fill="#000000" stroke="#000000" points="16403.2712,-2118.1575 16398.1163,-2108.9013 16396.3739,-2119.3519 16403.2712,-2118.1575"/>
</g>
<!-- prose_220 -->
<g id="node221" class="node">
<title>prose_220</title>
<ellipse fill="none" stroke="#000000" cx="16557" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="16557" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_200&#45;&gt;prose_220 -->
<g id="edge220" class="edge">
<title>section_200&#45;&gt;prose_220</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16482.3747,-2540.4801C16491.0096,-2515.1216 16506.3369,-2467.6141 16515,-2426.0041 16538.3528,-2313.838 16550.5257,-2177.6643 16554.9798,-2119.4853"/>
<polygon fill="#000000" stroke="#000000" points="16558.4907,-2119.4688 16555.7458,-2109.2358 16551.5102,-2118.9471 16558.4907,-2119.4688"/>
</g>
<!-- codeblock_221 -->
<g id="node222" class="node">
<title>codeblock_221</title>
<ellipse fill="none" stroke="#000000" cx="16770" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="16770" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 540&#45;553</text>
</g>
<!-- section_200&#45;&gt;codeblock_221 -->
<g id="edge221" class="edge">
<title>section_200&#45;&gt;codeblock_221</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16495.0675,-2541.1638C16520.6488,-2516.965 16566.5006,-2471.187 16598,-2426.0041 16672.0641,-2319.7662 16734.4715,-2177.3546 16758.9327,-2118.3173"/>
<polygon fill="#000000" stroke="#000000" points="16762.2261,-2119.5111 16762.792,-2108.9314 16755.752,-2116.8491 16762.2261,-2119.5111"/>
</g>
<!-- header_226 -->
<g id="node227" class="node">
<title>header_226</title>
<ellipse fill="none" stroke="#000000" cx="17282" cy="-2090.9034" rx="184.6938" ry="18"/>
<text text-anchor="middle" x="17282" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append(txtbuf, results, success)</text>
</g>
<!-- section_201&#45;&gt;header_226 -->
<g id="edge226" class="edge">
<title>section_201&#45;&gt;header_226</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17580.0947,-2540.9556C17554.6649,-2516.5209 17508.845,-2470.4764 17476,-2426.0041 17396.9342,-2318.9484 17324.1333,-2177.0609 17295.1947,-2118.2436"/>
<polygon fill="#000000" stroke="#000000" points="17298.3151,-2116.6572 17290.776,-2109.2132 17292.0274,-2119.7339 17298.3151,-2116.6572"/>
</g>
<!-- prose_227 -->
<g id="node228" class="node">
<title>prose_227</title>
<ellipse fill="none" stroke="#000000" cx="17517" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="17517" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_201&#45;&gt;prose_227 -->
<g id="edge227" class="edge">
<title>section_201&#45;&gt;prose_227</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17592.2467,-2540.516C17583.109,-2515.1992 17566.9264,-2467.7398 17558,-2426.0041 17534.0462,-2314.0074 17522.7725,-2177.7445 17518.7776,-2119.5138"/>
<polygon fill="#000000" stroke="#000000" points="17522.2513,-2119.0001 17518.0945,-2109.2548 17515.2667,-2119.4653 17522.2513,-2119.0001"/>
</g>
<!-- prose_228 -->
<g id="node229" class="node">
<title>prose_228</title>
<ellipse fill="none" stroke="#000000" cx="17599" cy="-2090.9034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="17599" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_201&#45;&gt;prose_228 -->
<g id="edge228" class="edge">
<title>section_201&#45;&gt;prose_228</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17599,-2540.6525C17599,-2469.3184 17599,-2206.72 17599,-2119.3709"/>
<polygon fill="#000000" stroke="#000000" points="17602.5001,-2119.1536 17599,-2109.1536 17595.5001,-2119.1537 17602.5001,-2119.1536"/>
</g>
<!-- codeblock_229 -->
<g id="node230" class="node">
<title>codeblock_229</title>
<ellipse fill="none" stroke="#000000" cx="17788" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="17788" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 561&#45;576</text>
</g>
<!-- section_201&#45;&gt;codeblock_229 -->
<g id="edge229" class="edge">
<title>section_201&#45;&gt;codeblock_229</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17606.2932,-2540.6525C17635.2342,-2469.0197 17742.0978,-2204.5176 17776.9382,-2118.283"/>
<polygon fill="#000000" stroke="#000000" points="17780.2276,-2119.4843 17780.7285,-2108.9013 17773.7373,-2116.862 17780.2276,-2119.4843"/>
</g>
<!-- codeblock_230 -->
<g id="node231" class="node">
<title>codeblock_230</title>
<ellipse fill="none" stroke="#000000" cx="18073" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="18073" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 578&#45;585</text>
</g>
<!-- section_201&#45;&gt;codeblock_230 -->
<g id="edge230" class="edge">
<title>section_201&#45;&gt;codeblock_230</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17650.0061,-2545.4126C17711.6469,-2527.1897 17815.5892,-2489.2911 17884,-2426.0041 17982.2298,-2335.1315 18042.4662,-2181.2545 18064.014,-2118.6449"/>
<polygon fill="#000000" stroke="#000000" points="18067.3661,-2119.6578 18067.2529,-2109.0636 18060.7348,-2117.4161 18067.3661,-2119.6578"/>
</g>
<!-- codeblock_231 -->
<g id="node232" class="node">
<title>codeblock_231</title>
<ellipse fill="none" stroke="#000000" cx="18363" cy="-2090.9034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="18363" y="-2086.7034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 587&#45;589</text>
</g>
<!-- section_201&#45;&gt;codeblock_231 -->
<g id="edge231" class="edge">
<title>section_201&#45;&gt;codeblock_231</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17665.322,-2549.9823C17797.7377,-2531.5068 18089.0284,-2485.2206 18169,-2426.0041 18278.0045,-2345.2897 18335.6946,-2183.6457 18355.2454,-2118.781"/>
<polygon fill="#000000" stroke="#000000" points="18358.694,-2119.4597 18358.1583,-2108.8784 18351.9785,-2117.4842 18358.694,-2119.4597"/>
</g>
<!-- leaf_204 -->
<g id="node205" class="node">
<title>leaf_204</title>
<polygon fill="none" stroke="#c0c0c0" points="14918,-967.0014 14864,-967.0014 14864,-931.0014 14918,-931.0014 14918,-967.0014"/>
</g>
<!-- raw_203&#45;&gt;leaf_204 -->
<g id="edge204" class="edge">
<title>raw_203&#45;&gt;leaf_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14891,-2072.5043C14891,-1940.5653 14891,-1139.0566 14891,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="14894.5001,-977.2884 14891,-967.2884 14887.5001,-977.2884 14894.5001,-977.2884"/>
</g>
<!-- leaf_209 -->
<g id="node210" class="node">
<title>leaf_209</title>
<polygon fill="none" stroke="#c0c0c0" points="15463,-967.0014 15307,-967.0014 15307,-931.0014 15463,-931.0014 15463,-967.0014"/>
<text text-anchor="middle" x="15385" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_206&#45;&gt;leaf_209 -->
<g id="edge209" class="edge">
<title>header_206&#45;&gt;leaf_209</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15598.463,-2072.8998C15593.3182,-2020.5011 15573.2315,-1864.8947 15509,-1755.8027 15497.359,-1736.0314 15482.0983,-1740.4048 15472,-1719.8027 15342.6234,-1455.8551 15370.6214,-1081.6448 15381.6825,-977.088"/>
<polygon fill="#000000" stroke="#000000" points="15385.1759,-977.339 15382.7855,-967.0174 15378.2175,-976.5768 15385.1759,-977.339"/>
</g>
<!-- raw_210 -->
<g id="node211" class="node">
<title>raw_210</title>
<ellipse fill="none" stroke="#000000" cx="15508" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="15508" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_207&#45;&gt;raw_210 -->
<g id="edge210" class="edge">
<title>prose_207&#45;&gt;raw_210</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15737.0312,-2072.8346C15748.2227,-2017.5185 15773.6749,-1848.6225 15691,-1755.8027 15646.2613,-1705.5743 15586.7459,-1771.7376 15544,-1719.8027 15448.8606,-1604.2112 15492.4061,-1102.921 15504.994,-977.5201"/>
<polygon fill="#000000" stroke="#000000" points="15508.5124,-977.5174 15506.0445,-967.214 15501.5485,-976.8075 15508.5124,-977.5174"/>
</g>
<!-- prespace_211 -->
<g id="node212" class="node">
<title>prespace_211</title>
<ellipse fill="none" stroke="#000000" cx="15599" cy="-949.0014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="15599" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_207&#45;&gt;prespace_211 -->
<g id="edge211" class="edge">
<title>prose_207&#45;&gt;prespace_211</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15734.6898,-2072.6726C15738.74,-2020.3065 15744.9859,-1866.1382 15691,-1755.8027 15681.0553,-1735.4778 15664.4113,-1740.38 15655,-1719.8027 15533.3244,-1453.7661 15578.2883,-1081.7663 15594.3012,-977.2788"/>
<polygon fill="#000000" stroke="#000000" points="15597.789,-977.6294 15595.8838,-967.2073 15590.8738,-976.5427 15597.789,-977.6294"/>
</g>
<!-- literal_212 -->
<g id="node213" class="node">
<title>literal_212</title>
<ellipse fill="none" stroke="#000000" cx="15695" cy="-949.0014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="15695" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_207&#45;&gt;literal_212 -->
<g id="edge212" class="edge">
<title>prose_207&#45;&gt;literal_212</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15732.3877,-2072.5043C15727.9971,-1940.5653 15701.3246,-1139.0566 15695.9451,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="15699.4393,-977.1664 15695.6086,-967.2884 15692.4432,-977.3993 15699.4393,-977.1664"/>
</g>
<!-- raw_213 -->
<g id="node214" class="node">
<title>raw_213</title>
<ellipse fill="none" stroke="#000000" cx="15771" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="15771" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_207&#45;&gt;raw_213 -->
<g id="edge213" class="edge">
<title>prose_207&#45;&gt;raw_213</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15733.6123,-2072.5043C15738.0029,-1940.5653 15764.6754,-1139.0566 15770.0549,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="15773.5568,-977.3993 15770.3914,-967.2884 15766.5607,-977.1664 15773.5568,-977.3993"/>
</g>
<!-- leaf_218 -->
<g id="node219" class="node">
<title>leaf_218</title>
<polygon fill="none" stroke="#c0c0c0" points="16281.9015,-1136.6422 15816.0985,-1136.6422 15816.0985,-761.3606 16281.9015,-761.3606 16281.9015,-1136.6422"/>
<text text-anchor="middle" x="16049" y="-1121.6217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="16049" y="-1106.2217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian</text>
<text text-anchor="middle" x="16049" y="-1087.4617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and historian.cursor + 1</text>
<text text-anchor="middle" x="16049" y="-1072.0616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or &#160;historian.cursor</text>
<text text-anchor="middle" x="16049" y="-1056.6616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local fwd = historian.cursor &gt;= #historian</text>
<text text-anchor="middle" x="16049" y="-1041.2616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="16049" y="-1025.8615" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="16049" y="-1010.4615" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16049" y="-995.0615" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[Δ]</text>
<text text-anchor="middle" x="16049" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="16049" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf(), nil, true</text>
<text text-anchor="middle" x="16049" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16049" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="16049" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = _resultsFrom(historian, historian.line_ids[Δ])</text>
<text text-anchor="middle" x="16049" y="-895.9414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = Δ</text>
<text text-anchor="middle" x="16049" y="-877.1814" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="16049" y="-861.7813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if fwd and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="16049" y="-846.3813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="16049" y="-830.9813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="16049" y="-815.5812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="16049" y="-800.1812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="16049" y="-784.7812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16049" y="-769.3811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_208&#45;&gt;leaf_218 -->
<g id="edge218" class="edge">
<title>codeblock_208&#45;&gt;leaf_218</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15961.434,-2072.5043C15969.6014,-1967.7139 16010.6883,-1440.5545 16033.5635,-1147.0576"/>
<polygon fill="#000000" stroke="#000000" points="16037.0817,-1146.9584 16034.3694,-1136.7166 16030.1029,-1146.4144 16037.0817,-1146.9584"/>
</g>
<!-- leaf_214 -->
<g id="node215" class="node">
<title>leaf_214</title>
<polygon fill="none" stroke="#c0c0c0" points="15553.5,-135.0015 15082.5,-135.0015 15082.5,-79.1986 15553.5,-79.1986 15553.5,-135.0015"/>
<text text-anchor="middle" x="15318" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_210&#45;&gt;leaf_214 -->
<g id="edge214" class="edge">
<title>raw_210&#45;&gt;leaf_214</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15509.6236,-930.7189C15518.5334,-826.3432 15558.0288,-306.0032 15472,-178.2001 15461.1475,-162.0779 15445.6558,-149.5429 15428.638,-139.8171"/>
<polygon fill="#000000" stroke="#000000" points="15430.0837,-136.621 15419.6162,-134.9831 15426.7776,-142.7911 15430.0837,-136.621"/>
</g>
<!-- leaf_215 -->
<g id="node216" class="node">
<title>leaf_215</title>
<polygon fill="none" stroke="#c0c0c0" points="15626,-125.1 15572,-125.1 15572,-89.1 15626,-89.1 15626,-125.1"/>
</g>
<!-- prespace_211&#45;&gt;leaf_215 -->
<g id="edge215" class="edge">
<title>prespace_211&#45;&gt;leaf_215</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15599,-930.6341C15599,-822.3417 15599,-267.4291 15599,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="15602.5001,-135.2255 15599,-125.2255 15595.5001,-135.2256 15602.5001,-135.2255"/>
</g>
<!-- leaf_216 -->
<g id="node217" class="node">
<title>leaf_216</title>
<polygon fill="none" stroke="#c0c0c0" points="15744,-125.1 15644,-125.1 15644,-89.1 15744,-89.1 15744,-125.1"/>
<text text-anchor="middle" x="15694" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_212&#45;&gt;leaf_216 -->
<g id="edge216" class="edge">
<title>literal_212&#45;&gt;leaf_216</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15694.9782,-930.6341C15694.8496,-822.3417 15694.1904,-267.4291 15694.0335,-135.3435"/>
<polygon fill="#000000" stroke="#000000" points="15697.5335,-135.2213 15694.0215,-125.2255 15690.5335,-135.2297 15697.5335,-135.2213"/>
</g>
<!-- leaf_217 -->
<g id="node218" class="node">
<title>leaf_217</title>
<polygon fill="none" stroke="#c0c0c0" points="16002,-127.0021 15762,-127.0021 15762,-87.198 16002,-87.198 16002,-127.0021"/>
<text text-anchor="middle" x="15882" y="-111.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_213&#45;&gt;leaf_217 -->
<g id="edge217" class="edge">
<title>raw_213&#45;&gt;leaf_217</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15770.0371,-930.7638C15764.8657,-827.7265 15742.9335,-318.1234 15807,-178.2001 15815.0668,-160.5819 15829.6757,-145.1747 15843.871,-133.2487"/>
<polygon fill="#000000" stroke="#000000" points="15846.0621,-135.9781 15851.6705,-126.9894 15841.6808,-130.5187 15846.0621,-135.9781"/>
</g>
<!-- leaf_222 -->
<g id="node223" class="node">
<title>leaf_222</title>
<polygon fill="none" stroke="#c0c0c0" points="16504.5,-967.0014 16299.5,-967.0014 16299.5,-931.0014 16504.5,-931.0014 16504.5,-967.0014"/>
<text text-anchor="middle" x="16402" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:index(cursor)</text>
</g>
<!-- header_219&#45;&gt;leaf_222 -->
<g id="edge222" class="edge">
<title>header_219&#45;&gt;leaf_222</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16395.1128,-2072.5043C16395.9216,-1940.5653 16400.8349,-1139.0566 16401.8259,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="16405.3264,-977.3097 16401.8879,-967.2884 16398.3266,-977.2667 16405.3264,-977.3097"/>
</g>
<!-- raw_223 -->
<g id="node224" class="node">
<title>raw_223</title>
<ellipse fill="none" stroke="#000000" cx="16550" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="16550" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_220&#45;&gt;raw_223 -->
<g id="edge223" class="edge">
<title>prose_220&#45;&gt;raw_223</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16556.8872,-2072.5043C16556.0784,-1940.5653 16551.1651,-1139.0566 16550.1741,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="16553.6734,-977.2667 16550.1121,-967.2884 16546.6736,-977.3097 16553.6734,-977.2667"/>
</g>
<!-- leaf_225 -->
<g id="node226" class="node">
<title>leaf_225</title>
<polygon fill="none" stroke="#c0c0c0" points="17094.5,-1045.3019 16595.5,-1045.3019 16595.5,-852.7009 17094.5,-852.7009 17094.5,-1045.3019"/>
<text text-anchor="middle" x="16845" y="-1030.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.index(historian, cursor)</text>
<text text-anchor="middle" x="16845" y="-1014.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (not cursor) or cursor &lt; 0 or cursor &gt; #historian + 1 then</text>
<text text-anchor="middle" x="16845" y="-999.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="16845" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16845" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[cursor]</text>
<text text-anchor="middle" x="16845" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = _resultsFrom(historian, historian.line_ids[cursor])</text>
<text text-anchor="middle" x="16845" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf = txtbuf:clone()</text>
<text text-anchor="middle" x="16845" y="-922.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = cursor</text>
<text text-anchor="middle" x="16845" y="-907.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="16845" y="-891.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="16845" y="-876.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf, result</text>
<text text-anchor="middle" x="16845" y="-860.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_221&#45;&gt;leaf_225 -->
<g id="edge225" class="edge">
<title>codeblock_221&#45;&gt;leaf_225</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16771.2084,-2072.5043C16778.8873,-1955.5904 16821.0976,-1312.9244 16837.9993,-1055.5898"/>
<polygon fill="#000000" stroke="#000000" points="16841.5,-1055.6925 16838.663,-1045.4845 16834.515,-1055.2336 16841.5,-1055.6925"/>
</g>
<!-- leaf_224 -->
<g id="node225" class="node">
<title>leaf_224</title>
<polygon fill="none" stroke="#c0c0c0" points="16684,-135.0015 16416,-135.0015 16416,-79.1986 16684,-79.1986 16684,-135.0015"/>
<text text-anchor="middle" x="16550" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Loads the history to an exact index.</text>
</g>
<!-- raw_223&#45;&gt;leaf_224 -->
<g id="edge224" class="edge">
<title>raw_223&#45;&gt;leaf_224</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16550,-930.6341C16550,-824.948 16550,-293.8807 16550,-145.6029"/>
<polygon fill="#000000" stroke="#000000" points="16553.5001,-145.2027 16550,-135.2027 16546.5001,-145.2028 16553.5001,-145.2027"/>
</g>
<!-- leaf_232 -->
<g id="node233" class="node">
<title>leaf_232</title>
<polygon fill="none" stroke="#c0c0c0" points="17451,-967.0014 17113,-967.0014 17113,-931.0014 17451,-931.0014 17451,-967.0014"/>
<text text-anchor="middle" x="17282" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append(txtbuf, results, success)</text>
</g>
<!-- header_226&#45;&gt;leaf_232 -->
<g id="edge232" class="edge">
<title>header_226&#45;&gt;leaf_232</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17282,-2072.5043C17282,-1940.5653 17282,-1139.0566 17282,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="17285.5001,-977.2884 17282,-967.2884 17278.5001,-977.2884 17285.5001,-977.2884"/>
</g>
<!-- raw_233 -->
<g id="node234" class="node">
<title>raw_233</title>
<ellipse fill="none" stroke="#000000" cx="17496" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="17496" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_227&#45;&gt;raw_233 -->
<g id="edge233" class="edge">
<title>prose_227&#45;&gt;raw_233</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17516.6616,-2072.5043C17514.2352,-1940.5653 17499.4952,-1139.0566 17496.5223,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="17500.0197,-977.2223 17496.3363,-967.2884 17493.0209,-977.3511 17500.0197,-977.2223"/>
</g>
<!-- raw_235 -->
<g id="node236" class="node">
<title>raw_235</title>
<ellipse fill="none" stroke="#000000" cx="17568" cy="-949.0014" rx="27" ry="18"/>
<text text-anchor="middle" x="17568" y="-944.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_228&#45;&gt;raw_235 -->
<g id="edge235" class="edge">
<title>prose_228&#45;&gt;raw_235</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17598.5005,-2072.5043C17594.9187,-1940.5653 17573.1596,-1139.0566 17568.771,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="17572.2666,-977.1897 17568.4964,-967.2884 17565.2692,-977.3797 17572.2666,-977.1897"/>
</g>
<!-- leaf_237 -->
<g id="node238" class="node">
<title>leaf_237</title>
<polygon fill="none" stroke="#c0c0c0" points="18063,-1060.6022 17613,-1060.6022 17613,-837.4006 18063,-837.4006 18063,-1060.6022"/>
<text text-anchor="middle" x="17838" y="-1045.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="17838" y="-1030.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf)</text>
<text text-anchor="middle" x="17838" y="-1014.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or tostring(txtbuf) == &quot;&quot; then</text>
<text text-anchor="middle" x="17838" y="-999.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="17838" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="17838" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="17838" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="17838" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="17838" y="-922.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="17838" y="-907.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="17838" y="-891.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="17838" y="-876.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="17838" y="-860.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="17838" y="-845.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_229&#45;&gt;leaf_237 -->
<g id="edge237" class="edge">
<title>codeblock_229&#45;&gt;leaf_237</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17788.8056,-2072.5043C17793.8251,-1957.8692 17820.9768,-1337.7769 17832.6551,-1071.0692"/>
<polygon fill="#000000" stroke="#000000" points="17836.1569,-1071.1015 17833.0978,-1060.9579 17829.1636,-1070.7952 17836.1569,-1071.1015"/>
</g>
<!-- leaf_238 -->
<g id="node239" class="node">
<title>leaf_238</title>
<polygon fill="none" stroke="#c0c0c0" points="18349,-999.4024 18081,-999.4024 18081,-898.6004 18349,-898.6004 18349,-999.4024"/>
<text text-anchor="middle" x="18215" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="18215" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="18215" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="18215" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="18215" y="-922.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="18215" y="-907.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_230&#45;&gt;leaf_238 -->
<g id="edge238" class="edge">
<title>codeblock_230&#45;&gt;leaf_238</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M18075.288,-2072.5043C18090.7926,-1947.823 18180.6524,-1225.21 18207.4557,-1009.6697"/>
<polygon fill="#000000" stroke="#000000" points="18210.9603,-1009.8483 18208.7212,-999.4928 18204.0138,-1008.9844 18210.9603,-1009.8483"/>
</g>
<!-- leaf_239 -->
<g id="node240" class="node">
<title>leaf_239</title>
<polygon fill="none" stroke="#c0c0c0" points="18453,-967.0014 18367,-967.0014 18367,-931.0014 18453,-931.0014 18453,-967.0014"/>
<text text-anchor="middle" x="18410" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_231&#45;&gt;leaf_239 -->
<g id="edge239" class="edge">
<title>codeblock_231&#45;&gt;leaf_239</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M18363.7573,-2072.5043C18369.1878,-1940.5653 18402.1774,-1139.0566 18408.831,-977.4021"/>
<polygon fill="#000000" stroke="#000000" points="18412.333,-977.4239 18409.2473,-967.2884 18405.3389,-977.136 18412.333,-977.4239"/>
</g>
<!-- leaf_234 -->
<g id="node235" class="node">
<title>leaf_234</title>
<polygon fill="none" stroke="#c0c0c0" points="17554,-135.0015 17230,-135.0015 17230,-79.1986 17554,-79.1986 17554,-135.0015"/>
<text text-anchor="middle" x="17392" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_233&#45;&gt;leaf_234 -->
<g id="edge234" class="edge">
<title>raw_233&#45;&gt;leaf_234</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17499.6011,-930.9012C17516.1492,-843.295 17579.1323,-456.1744 17460,-178.2001 17454.3151,-164.9354 17444.9754,-152.6816 17435.0128,-142.2164"/>
<polygon fill="#000000" stroke="#000000" points="17437.2464,-139.5012 17427.6916,-134.9233 17432.3062,-144.4605 17437.2464,-139.5012"/>
</g>
<!-- leaf_236 -->
<g id="node237" class="node">
<title>leaf_236</title>
<polygon fill="none" stroke="#c0c0c0" points="17770,-127.0021 17572,-127.0021 17572,-87.198 17770,-87.198 17770,-127.0021"/>
<text text-anchor="middle" x="17671" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_235&#45;&gt;leaf_236 -->
<g id="edge236" class="edge">
<title>raw_235&#45;&gt;leaf_236</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17564.442,-930.9196C17548.094,-843.3987 17485.8967,-456.6132 17604,-178.2001 17611.1979,-161.232 17624.3582,-145.8576 17637.1217,-133.7814"/>
<polygon fill="#000000" stroke="#000000" points="17639.4769,-136.3705 17644.5428,-127.0652 17634.7798,-131.1804 17639.4769,-136.3705"/>
</g>
</g>
</svg>
