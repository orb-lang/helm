<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="16381pt" height="2833pt"
 viewBox="0.00 0.00 16381.30 2833.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2829.2043)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2829.2043 16377.2972,-2829.2043 16377.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2807.2043" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1787" y="-2803.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 557</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2735.2043" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1787" y="-2731.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;455</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2789.0357C1787,-2781.3353 1787,-2772.1787 1787,-2763.6209"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2763.6175 1787,-2753.6176 1783.5001,-2763.6176 1790.5001,-2763.6175"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1168" cy="-2663.2043" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1168" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1725.4565,-2728.6516C1633.9363,-2718.8264 1456.5725,-2699.4749 1306,-2681.2043 1281.4502,-2678.2254 1254.4713,-2674.7512 1230.9302,-2671.6539"/>
<polygon fill="#000000" stroke="#000000" points="1231.0962,-2668.1455 1220.7241,-2670.3064 1230.1799,-2675.0853 1231.0962,-2668.1455"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1347" cy="-2663.2043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1347" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1726.8328,-2727.8767C1654.436,-2718.6917 1529.3399,-2701.6464 1423,-2681.2043 1411.0534,-2678.9078 1398.1458,-2676.0101 1386.4181,-2673.2147"/>
<polygon fill="#000000" stroke="#000000" points="1387.0127,-2669.7575 1376.4695,-2670.8021 1385.363,-2676.5603 1387.0127,-2669.7575"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1464" cy="-2663.2043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1464" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.5408,-2725.4356C1677.8804,-2715.6137 1594.4109,-2699.3578 1523,-2681.2043 1516.1661,-2679.467 1508.9445,-2677.4327 1501.9868,-2675.369"/>
<polygon fill="#000000" stroke="#000000" points="1502.6431,-2671.9106 1492.0577,-2672.3556 1500.6102,-2678.6089 1502.6431,-2671.9106"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1564" cy="-2663.2043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1564" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1742.3852,-2721.8546C1707.3486,-2711.2321 1657.3972,-2695.7813 1614,-2681.2043 1609.6517,-2679.7437 1605.1065,-2678.1716 1600.6048,-2676.5862"/>
<polygon fill="#000000" stroke="#000000" points="1601.5075,-2673.1923 1590.9128,-2673.1328 1599.1579,-2679.7863 1601.5075,-2673.1923"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1655" cy="-2663.2043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1655" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1757.3766,-2719.0461C1736.5856,-2707.7056 1708.7908,-2692.5448 1687.4091,-2680.882"/>
<polygon fill="#000000" stroke="#000000" points="1688.8366,-2677.6738 1678.3816,-2675.9579 1685.4846,-2683.8191 1688.8366,-2677.6738"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2663.2043" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1787" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;27</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2717.0357C1787,-2709.3353 1787,-2700.1787 1787,-2691.6209"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2691.6175 1787,-2681.6176 1783.5001,-2691.6176 1790.5001,-2691.6175"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2066" cy="-2663.2043" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2066" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 29&#45;31</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1834.9618,-2722.8271C1881.7022,-2710.765 1952.9893,-2692.3683 2004.0105,-2679.2016"/>
<polygon fill="#000000" stroke="#000000" points="2005.1231,-2682.5292 2013.9312,-2676.6414 2003.3739,-2675.7513 2005.1231,-2682.5292"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2663.2043" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 34&#45;240</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1849.5748,-2729.6145C1995.3393,-2716.5933 2357.1653,-2684.2714 2516.0774,-2670.0758"/>
<polygon fill="#000000" stroke="#000000" points="2516.5979,-2673.5433 2526.2468,-2669.1674 2515.975,-2666.5711 2516.5979,-2673.5433"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7315" cy="-2663.2043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7315" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 292&#45;327</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.9331,-2734.3456C2427.3895,-2726.8635 6577.3064,-2672.8125 7228.9843,-2664.3246"/>
<polygon fill="#000000" stroke="#000000" points="7229.281,-2667.8212 7239.2345,-2664.1911 7229.1898,-2660.8218 7229.281,-2667.8212"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11496" cy="-2663.2043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11496" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 394&#45;455</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.8688,-2734.7158C2653.6512,-2728.7774 10502.3706,-2670.5729 11410.464,-2663.8386"/>
<polygon fill="#000000" stroke="#000000" points="11410.5374,-2667.3383 11420.5111,-2663.7641 11410.4854,-2660.3385 11410.5374,-2667.3383"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="13300" cy="-2663.2043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13300" y="-2659.0043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 456&#45;522</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.0563,-2734.9657C2483.8102,-2732.6613 7508.1523,-2713.7367 11580,-2681.2043 12207.3601,-2676.192 12963.4055,-2667.2839 13214.4115,-2664.2499"/>
<polygon fill="#000000" stroke="#000000" points="13214.5997,-2667.7479 13224.5566,-2664.1271 13214.5149,-2660.7484 13214.5997,-2667.7479"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1209.5,-2546.2042 1116.5,-2546.2042 1116.5,-2510.2042 1209.5,-2510.2042 1209.5,-2546.2042"/>
<text text-anchor="middle" x="1163" y="-2524.7042" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.3257,-2644.9976C1166.487,-2622.352 1165.0454,-2583.4307 1164.0588,-2556.7907"/>
<polygon fill="#000000" stroke="#000000" points="1167.5474,-2556.4171 1163.6796,-2546.5536 1160.5522,-2556.6763 1167.5474,-2556.4171"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1255" cy="-2528.2042" rx="27" ry="18"/>
<text text-anchor="middle" x="1255" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1328.3041,-2648.4268C1316.4598,-2638.3398 1301.4586,-2624.1396 1291,-2609.2043 1279.4502,-2592.7108 1270.3025,-2571.9174 1264.1185,-2555.5282"/>
<polygon fill="#000000" stroke="#000000" points="1267.353,-2554.1805 1260.6562,-2545.9705 1260.7715,-2556.5647 1267.353,-2554.1805"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1327" cy="-2528.2042" rx="27" ry="18"/>
<text text-anchor="middle" x="1327" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1435.9386,-2653.9881C1413.6641,-2645.4368 1383.0379,-2630.7559 1363,-2609.2043 1349.1159,-2594.2713 1339.9601,-2573.0974 1334.3574,-2556.1433"/>
<polygon fill="#000000" stroke="#000000" points="1337.5945,-2554.761 1331.3176,-2546.2257 1330.9018,-2556.8124 1337.5945,-2554.761"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1399" cy="-2528.2042" rx="27" ry="18"/>
<text text-anchor="middle" x="1399" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1535.9779,-2654.1972C1502.7183,-2643.0512 1449.8808,-2623.7645 1435,-2609.2043 1420.3347,-2594.855 1411.1803,-2573.4813 1405.7744,-2556.2922"/>
<polygon fill="#000000" stroke="#000000" points="1409.0076,-2554.8716 1402.8771,-2546.2306 1402.2809,-2556.8086 1409.0076,-2554.8716"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1471" cy="-2528.2042" rx="27" ry="18"/>
<text text-anchor="middle" x="1471" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1627.641,-2653.297C1585.0278,-2637.8555 1507.5794,-2609.7454 1507,-2609.2043 1491.7689,-2594.9805 1482.5781,-2573.1388 1477.2992,-2555.7191"/>
<polygon fill="#000000" stroke="#000000" points="1480.6678,-2554.7686 1474.627,-2546.0646 1473.9215,-2556.6359 1480.6678,-2554.7686"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057.5,-2609.2045 1516.5,-2609.2045 1516.5,-2447.2038 2057.5,-2447.2038 2057.5,-2609.2045"/>
<text text-anchor="middle" x="1787" y="-2594.0043" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf &#160;= require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2578.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">local Rainbuf = require &quot;rainbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2563.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1787" y="-2547.8042" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1787" y="-2532.4042" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1787" y="-2517.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1787" y="-2501.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1787" y="-2486.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints, &quot;must have string.codepoints&quot;)</text>
<text text-anchor="middle" x="1787" y="-2470.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1787" y="-2455.404" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2644.9976C1787,-2637.8398 1787,-2629.0561 1787,-2619.548"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2619.4152 1787,-2609.4153 1783.5001,-2619.4153 1790.5001,-2619.4152"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2546.2042 2075.5,-2546.2042 2075.5,-2510.2042 2266.5,-2510.2042 2266.5,-2546.2042"/>
<text text-anchor="middle" x="2171" y="-2524.7042" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2079.9432,-2645.2773C2098.0647,-2621.9782 2129.8454,-2581.1172 2150.6583,-2554.3578"/>
<polygon fill="#000000" stroke="#000000" points="2153.6224,-2556.2476 2156.9991,-2546.2053 2148.097,-2551.95 2153.6224,-2556.2476"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2528.2042" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2537.9614,-2651.8831C2505.1755,-2643.4828 2463.7171,-2629.8536 2431,-2609.2043 2408.0159,-2594.6979 2386.9624,-2572.0141 2372.537,-2554.3371"/>
<polygon fill="#000000" stroke="#000000" points="2374.9694,-2551.7721 2366.0085,-2546.1193 2369.4884,-2556.1264 2374.9694,-2551.7721"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2561.3051,-2646.9091C2545.326,-2637.5185 2526.5232,-2624.5358 2513,-2609.2043 2499.2718,-2593.6404 2488.8191,-2572.6583 2481.9042,-2555.9491"/>
<polygon fill="#000000" stroke="#000000" points="2484.9794,-2554.2059 2478.0583,-2546.1841 2478.4663,-2556.7711 2484.9794,-2554.2059"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2528.2042" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 38&#45;143</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2644.9976C2593,-2622.352 2593,-2583.4307 2593,-2556.7907"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2556.5535 2593,-2546.5536 2589.5001,-2556.5536 2596.5001,-2556.5535"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2991" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 144&#45;229</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2635.593,-2648.7569C2708.6702,-2623.9694 2857.7656,-2573.3968 2937.6482,-2546.3009"/>
<polygon fill="#000000" stroke="#000000" points="2939.161,-2549.4837 2947.5067,-2542.9569 2936.9124,-2542.8547 2939.161,-2549.4837"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="4150" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4150" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 230&#45;240</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2659.9023,-2657.4035C2910.7501,-2635.6537 3795.0254,-2558.9823 4068.6743,-2535.2555"/>
<polygon fill="#000000" stroke="#000000" points="4069.2647,-2538.7176 4078.9249,-2534.3667 4068.66,-2531.7437 4069.2647,-2538.7176"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="5051" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5051" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 241&#45;291</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.8562,-2662.5407C2891.8667,-2660.0484 3627.093,-2649.2317 4234,-2609.2043 4506.4044,-2591.2384 4828.5133,-2554.8162 4973.4776,-2537.6103"/>
<polygon fill="#000000" stroke="#000000" points="4974.0894,-2541.0623 4983.6058,-2536.4052 4973.2622,-2534.1113 4974.0894,-2541.0623"/>
</g>
<!-- header_95 -->
<g id="node96" class="node">
<title>header_95</title>
<ellipse fill="none" stroke="#000000" cx="7116" cy="-2528.2042" rx="107.339" ry="18"/>
<text text-anchor="middle" x="7116" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_95 -->
<g id="edge95" class="edge">
<title>section_10&#45;&gt;header_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7288.6774,-2646.0917C7272.5441,-2635.5483 7251.5056,-2621.701 7233,-2609.2043 7204.6784,-2590.079 7172.8029,-2567.9724 7149.4833,-2551.6905"/>
<polygon fill="#000000" stroke="#000000" points="7151.1914,-2548.6142 7140.99,-2545.7538 7147.1811,-2554.3515 7151.1914,-2548.6142"/>
</g>
<!-- prose_96 -->
<g id="node97" class="node">
<title>prose_96</title>
<ellipse fill="none" stroke="#000000" cx="7274" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7274" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_96 -->
<g id="edge96" class="edge">
<title>section_10&#45;&gt;prose_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7309.4706,-2644.9976C7302.5238,-2622.1242 7290.5343,-2582.6463 7282.4389,-2555.9908"/>
<polygon fill="#000000" stroke="#000000" points="7285.6968,-2554.6738 7279.4418,-2546.1224 7278.9989,-2556.708 7285.6968,-2554.6738"/>
</g>
<!-- prose_97 -->
<g id="node98" class="node">
<title>prose_97</title>
<ellipse fill="none" stroke="#000000" cx="7356" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7356" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_97 -->
<g id="edge97" class="edge">
<title>section_10&#45;&gt;prose_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7320.5294,-2644.9976C7327.4762,-2622.1242 7339.4657,-2582.6463 7347.5611,-2555.9908"/>
<polygon fill="#000000" stroke="#000000" points="7351.0011,-2556.708 7350.5582,-2546.1224 7344.3032,-2554.6738 7351.0011,-2556.708"/>
</g>
<!-- section_98 -->
<g id="node99" class="node">
<title>section_98</title>
<ellipse fill="none" stroke="#000000" cx="7947" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7947" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 302&#45;327</text>
</g>
<!-- section_10&#45;&gt;section_98 -->
<g id="edge98" class="edge">
<title>section_10&#45;&gt;section_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7371.3636,-2651.1646C7488.1574,-2626.2165 7756.0815,-2568.9858 7880.8346,-2542.3376"/>
<polygon fill="#000000" stroke="#000000" points="7881.6009,-2545.7529 7890.6492,-2540.2411 7880.1386,-2538.9074 7881.6009,-2545.7529"/>
</g>
<!-- section_99 -->
<g id="node100" class="node">
<title>section_99</title>
<ellipse fill="none" stroke="#000000" cx="9479" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9479" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 328&#45;393</text>
</g>
<!-- section_10&#45;&gt;section_99 -->
<g id="edge99" class="edge">
<title>section_10&#45;&gt;section_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7388.2401,-2658.6353C7716.1338,-2638.1798 9048.3149,-2555.0722 9395.7871,-2533.3954"/>
<polygon fill="#000000" stroke="#000000" points="9396.0155,-2536.888 9405.7781,-2532.7721 9395.5795,-2529.9016 9396.0155,-2536.888"/>
</g>
<!-- header_147 -->
<g id="node148" class="node">
<title>header_147</title>
<ellipse fill="none" stroke="#000000" cx="10555" cy="-2528.2042" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10555" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_147 -->
<g id="edge147" class="edge">
<title>section_11&#45;&gt;header_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11421.2576,-2660.6636C11259.5595,-2654.6917 10881.7878,-2638.0478 10757,-2609.2043 10699.9143,-2596.0095 10637.8693,-2569.0796 10597.8187,-2549.8956"/>
<polygon fill="#000000" stroke="#000000" points="10599.1498,-2546.6515 10588.6242,-2545.4422 10596.0984,-2552.9514 10599.1498,-2546.6515"/>
</g>
<!-- prose_148 -->
<g id="node149" class="node">
<title>prose_148</title>
<ellipse fill="none" stroke="#000000" cx="10798" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10798" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_148 -->
<g id="edge148" class="edge">
<title>section_11&#45;&gt;prose_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11437.0905,-2651.8106C11298.9462,-2625.0921 10956.9183,-2558.9405 10838.8521,-2536.1054"/>
<polygon fill="#000000" stroke="#000000" points="10839.2685,-2532.6211 10828.7858,-2534.1584 10837.9392,-2539.4937 10839.2685,-2532.6211"/>
</g>
<!-- prose_149 -->
<g id="node150" class="node">
<title>prose_149</title>
<ellipse fill="none" stroke="#000000" cx="11384" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11384" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_149 -->
<g id="edge149" class="edge">
<title>section_11&#45;&gt;prose_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11481.1273,-2645.2773C11461.3904,-2621.4874 11426.4633,-2579.3877 11404.3105,-2552.6855"/>
<polygon fill="#000000" stroke="#000000" points="11406.9552,-2550.3918 11397.8765,-2544.9303 11401.5679,-2554.8613 11406.9552,-2550.3918"/>
</g>
<!-- prose_150 -->
<g id="node151" class="node">
<title>prose_150</title>
<ellipse fill="none" stroke="#000000" cx="11496" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11496" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_150 -->
<g id="edge150" class="edge">
<title>section_11&#45;&gt;prose_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11496,-2644.9976C11496,-2622.352 11496,-2583.4307 11496,-2556.7907"/>
<polygon fill="#000000" stroke="#000000" points="11499.5001,-2556.5535 11496,-2546.5536 11492.5001,-2556.5536 11499.5001,-2556.5535"/>
</g>
<!-- prose_151 -->
<g id="node152" class="node">
<title>prose_151</title>
<ellipse fill="none" stroke="#000000" cx="11578" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11578" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_151 -->
<g id="edge151" class="edge">
<title>section_11&#45;&gt;prose_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11510.8955,-2645.2991C11519.0794,-2635.0562 11529.1344,-2621.7784 11537,-2609.2043 11547.8676,-2591.8311 11558.2718,-2571.2119 11565.8802,-2555.1249"/>
<polygon fill="#000000" stroke="#000000" points="11569.1905,-2556.3069 11570.2354,-2545.7637 11562.8437,-2553.3542 11569.1905,-2556.3069"/>
</g>
<!-- prose_152 -->
<g id="node153" class="node">
<title>prose_152</title>
<ellipse fill="none" stroke="#000000" cx="11660" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11660" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_152 -->
<g id="edge152" class="edge">
<title>section_11&#45;&gt;prose_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11546.6589,-2649.7529C11570.85,-2641.2922 11598.8449,-2628.2825 11619,-2609.2043 11634.4055,-2594.6219 11644.9448,-2572.9848 11651.4765,-2555.741"/>
<polygon fill="#000000" stroke="#000000" points="11654.8226,-2556.777 11654.8657,-2546.1823 11648.225,-2554.4377 11654.8226,-2556.777"/>
</g>
<!-- prose_153 -->
<g id="node154" class="node">
<title>prose_153</title>
<ellipse fill="none" stroke="#000000" cx="11742" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11742" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_153 -->
<g id="edge153" class="edge">
<title>section_11&#45;&gt;prose_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11557.7109,-2652.7071C11609.7059,-2642.8404 11679.0338,-2626.9637 11701,-2609.2043 11717.7007,-2595.702 11728.2385,-2573.626 11734.4426,-2555.9282"/>
<polygon fill="#000000" stroke="#000000" points="11737.87,-2556.7035 11737.6085,-2546.1119 11731.2079,-2554.5548 11737.87,-2556.7035"/>
</g>
<!-- codeblock_154 -->
<g id="node155" class="node">
<title>codeblock_154</title>
<ellipse fill="none" stroke="#000000" cx="11972" cy="-2528.2042" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="11972" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 411&#45;453</text>
</g>
<!-- section_11&#45;&gt;codeblock_154 -->
<g id="edge154" class="edge">
<title>section_11&#45;&gt;codeblock_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11563.1105,-2654.8185C11621.9187,-2646.4723 11709.2738,-2631.6423 11783,-2609.2043 11835.1063,-2593.3462 11892.235,-2567.6198 11929.892,-2549.4204"/>
<polygon fill="#000000" stroke="#000000" points="11931.5756,-2552.4935 11939.0314,-2544.9662 11928.5088,-2546.201 11931.5756,-2552.4935"/>
</g>
<!-- header_175 -->
<g id="node176" class="node">
<title>header_175</title>
<ellipse fill="none" stroke="#000000" cx="12966" cy="-2528.2042" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="12966" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_175 -->
<g id="edge175" class="edge">
<title>section_12&#45;&gt;header_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13241.2277,-2651.886C13200.5898,-2642.9727 13145.8079,-2628.7722 13100,-2609.2043 13063.3908,-2593.5659 13024.8157,-2569.3126 12998.504,-2551.4184"/>
<polygon fill="#000000" stroke="#000000" points="13000.2936,-2548.4013 12990.0716,-2545.6154 12996.3252,-2554.1678 13000.2936,-2548.4013"/>
</g>
<!-- prose_176 -->
<g id="node177" class="node">
<title>prose_176</title>
<ellipse fill="none" stroke="#000000" cx="13141" cy="-2528.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13141" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_176 -->
<g id="edge176" class="edge">
<title>section_12&#45;&gt;prose_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13264.0802,-2647.2824C13245.0504,-2637.8328 13221.9656,-2624.6798 13204,-2609.2043 13185.3791,-2593.1644 13168.5324,-2570.8899 13156.9551,-2553.7581"/>
<polygon fill="#000000" stroke="#000000" points="13159.8249,-2551.7522 13151.3998,-2545.3283 13153.98,-2555.6041 13159.8249,-2551.7522"/>
</g>
<!-- codeblock_177 -->
<g id="node178" class="node">
<title>codeblock_177</title>
<ellipse fill="none" stroke="#000000" cx="13300" cy="-2528.2042" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13300" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 458&#45;471</text>
</g>
<!-- section_12&#45;&gt;codeblock_177 -->
<g id="edge177" class="edge">
<title>section_12&#45;&gt;codeblock_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13300,-2644.9976C13300,-2622.352 13300,-2583.4307 13300,-2556.7907"/>
<polygon fill="#000000" stroke="#000000" points="13303.5001,-2556.5535 13300,-2546.5536 13296.5001,-2556.5536 13303.5001,-2556.5535"/>
</g>
<!-- section_178 -->
<g id="node179" class="node">
<title>section_178</title>
<ellipse fill="none" stroke="#000000" cx="13657" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13657" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 474&#45;503</text>
</g>
<!-- section_12&#45;&gt;section_178 -->
<g id="edge178" class="edge">
<title>section_12&#45;&gt;section_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13340.6049,-2647.8495C13406.3204,-2622.9991 13535.7916,-2574.0393 13607.0508,-2547.0925"/>
<polygon fill="#000000" stroke="#000000" points="13608.5912,-2550.252 13616.7067,-2543.4411 13606.1152,-2543.7045 13608.5912,-2550.252"/>
</g>
<!-- section_179 -->
<g id="node180" class="node">
<title>section_179</title>
<ellipse fill="none" stroke="#000000" cx="14389" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14389" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 504&#45;522</text>
</g>
<!-- section_12&#45;&gt;section_179 -->
<g id="edge179" class="edge">
<title>section_12&#45;&gt;section_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13367.2482,-2655.0231C13453.7297,-2644.4898 13608.5674,-2625.5895 13741,-2609.2043 13947.2961,-2583.6804 14190.4774,-2553.1689 14311.8936,-2537.9061"/>
<polygon fill="#000000" stroke="#000000" points="14312.356,-2541.3756 14321.8413,-2536.6554 14311.4828,-2534.4302 14312.356,-2541.3756"/>
</g>
<!-- section_180 -->
<g id="node181" class="node">
<title>section_180</title>
<ellipse fill="none" stroke="#000000" cx="15476" cy="-2528.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15476" y="-2524.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 523&#45;557</text>
</g>
<!-- section_12&#45;&gt;section_180 -->
<g id="edge180" class="edge">
<title>section_12&#45;&gt;section_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13374.8405,-2660.6574C13560.7431,-2654.1353 14058.4639,-2635.4767 14473,-2609.2043 14816.4259,-2587.4387 15225.1727,-2551.2128 15395.3997,-2535.6651"/>
<polygon fill="#000000" stroke="#000000" points="15395.8913,-2539.1349 15405.5309,-2534.7385 15395.2536,-2532.164 15395.8913,-2539.1349"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2127.1045 0,-2127.1045 0,-2055.3022 324,-2055.3022 324,-2127.1045"/>
<text text-anchor="middle" x="162" y="-2063.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1252.3252,-2510.1674C1248.4251,-2490.9654 1239.1757,-2461.4278 1218,-2447.204 1136.3046,-2392.3287 416.3644,-2463.509 333,-2411.204 234.1366,-2349.1745 188.8048,-2209.305 171.3043,-2136.7658"/>
<polygon fill="#000000" stroke="#000000" points="174.7037,-2135.9315 169.017,-2126.9922 167.8879,-2137.5267 174.7037,-2135.9315"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2118.5038 342.5,-2118.5038 342.5,-2063.9029 897.5,-2063.9029 897.5,-2118.5038"/>
<text text-anchor="middle" x="620" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-2072.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1324.3347,-2510.0452C1320.5059,-2491.0309 1311.496,-2461.9301 1291,-2447.204 1221.3955,-2397.1942 983.5459,-2449.7593 907,-2411.204 778.1534,-2346.3055 680.2403,-2196.9397 640.0178,-2127.688"/>
<polygon fill="#000000" stroke="#000000" points="642.9645,-2125.7908 634.9514,-2118.8597 636.8932,-2129.275 642.9645,-2125.7908"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2118.5038 916,-2118.5038 916,-2063.9029 1464,-2063.9029 1464,-2118.5038"/>
<text text-anchor="middle" x="1190" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-2072.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1391.4459,-2510.7458C1384.2767,-2494.2887 1373.1229,-2468.972 1363,-2447.204 1308.4292,-2329.856 1240.5209,-2192.495 1208.4336,-2128.0773"/>
<polygon fill="#000000" stroke="#000000" points="1211.3757,-2126.1341 1203.7819,-2118.746 1205.111,-2129.2571 1211.3757,-2126.1341"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2126.5037 1482,-2126.5037 1482,-2055.903 2030,-2055.903 2030,-2126.5037"/>
<text text-anchor="middle" x="1756" y="-2095.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-2080.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1477.6553,-2510.6698C1484.2677,-2493.9387 1495.1151,-2468.2392 1507,-2447.204 1574.0684,-2328.4987 1670.5744,-2199.928 1721.5033,-2134.6127"/>
<polygon fill="#000000" stroke="#000000" points="1724.3782,-2136.6181 1727.782,-2126.585 1718.8643,-2132.3056 1724.3782,-2136.6181"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-2109.2034 2048,-2109.2034 2048,-2073.2034 2162,-2073.2034 2162,-2109.2034"/>
<text text-anchor="middle" x="2105" y="-2087.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2339.9521,-2510.351C2325.8046,-2492.1497 2301.6477,-2464.2375 2275,-2447.204 2233.7872,-2420.8602 2203.27,-2447.9618 2171,-2411.204 2096.6848,-2326.5537 2097.9489,-2180.6848 2102.2552,-2119.5047"/>
<polygon fill="#000000" stroke="#000000" points="2105.7524,-2119.676 2103.048,-2109.4322 2098.774,-2119.1267 2105.7524,-2119.676"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2467.8224,-2510.0224C2462.53,-2491.275 2451.5187,-2462.664 2431,-2447.204 2363.054,-2396.0095 2300.7908,-2473.636 2243,-2411.204 2167.2277,-2329.3465 2187.6983,-2180.7072 2200.4191,-2119.1051"/>
<polygon fill="#000000" stroke="#000000" points="2203.9151,-2119.497 2202.6041,-2108.9836 2197.0727,-2118.0199 2203.9151,-2119.497"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-2091.2034" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2579.1321,-2510.2093C2564.4142,-2492.1584 2539.6407,-2464.6079 2513,-2447.204 2475.547,-2422.7366 2449.0566,-2444.3399 2419,-2411.204 2342.1291,-2326.4576 2331.565,-2180.6416 2330.6935,-2119.4902"/>
<polygon fill="#000000" stroke="#000000" points="2334.1931,-2119.3999 2330.6291,-2109.4225 2327.1933,-2119.4448 2334.1931,-2119.3999"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2574.4228,-2510.7536C2553.054,-2489.4674 2518.766,-2451.3313 2502,-2411.204 2459.7891,-2310.1774 2457.5472,-2176.9354 2458.8507,-2119.5201"/>
<polygon fill="#000000" stroke="#000000" points="2462.3529,-2119.4878 2459.1371,-2109.3928 2455.3557,-2119.2898 2462.3529,-2119.4878"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2091.2034" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 40&#45;141</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2509.9831C2593,-2441.9619 2593,-2202.5568 2593,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2119.5021 2593,-2109.5022 2589.5001,-2119.5022 2596.5001,-2119.5021"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-2091.2034" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2966.2423,-2511.0571C2938.3563,-2490.4762 2893.5992,-2453.4135 2868,-2411.204 2809.1618,-2314.1882 2786.4651,-2177.8215 2779.0779,-2119.4804"/>
<polygon fill="#000000" stroke="#000000" points="2782.5488,-2119.0284 2777.8714,-2109.5219 2775.5996,-2119.8703 2782.5488,-2119.0284"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2983.2432,-2509.9197C2973.9188,-2487.1923 2958.4711,-2447.0212 2950,-2411.204 2924.9829,-2305.4281 2914.3339,-2176.1321 2910.6454,-2119.7593"/>
<polygon fill="#000000" stroke="#000000" points="2914.1201,-2119.2458 2909.9983,-2109.4856 2907.134,-2119.6859 2914.1201,-2119.2458"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2991,-2509.9831C2991,-2441.9619 2991,-2202.5568 2991,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="2994.5001,-2119.5021 2991,-2109.5022 2987.5001,-2119.5022 2994.5001,-2119.5021"/>
</g>
<!-- structure_43 -->
<g id="node44" class="node">
<title>structure_43</title>
<ellipse fill="none" stroke="#000000" cx="3086" cy="-2091.2034" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="3086" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_27&#45;&gt;structure_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;structure_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2998.3632,-2510.2596C3007.4316,-2487.5465 3022.7651,-2447.0543 3032,-2411.204 3059.2744,-2305.3235 3076.2288,-2176.0815 3082.8363,-2119.7409"/>
<polygon fill="#000000" stroke="#000000" points="3086.3516,-2119.8084 3084.0198,-2109.4733 3079.3976,-2119.0067 3086.3516,-2119.8084"/>
</g>
<!-- prose_44 -->
<g id="node45" class="node">
<title>prose_44</title>
<ellipse fill="none" stroke="#000000" cx="3181" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3181" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_44 -->
<g id="edge44" class="edge">
<title>section_27&#45;&gt;prose_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3024.5823,-2511.9081C3059.7121,-2492.937 3113.3729,-2458.1133 3140,-2411.204 3194.4005,-2315.3658 3189.3985,-2177.82 3184.1696,-2119.2887"/>
<polygon fill="#000000" stroke="#000000" points="3187.6507,-2118.9238 3183.2049,-2109.307 3180.6832,-2119.5973 3187.6507,-2118.9238"/>
</g>
<!-- codeblock_45 -->
<g id="node46" class="node">
<title>codeblock_45</title>
<ellipse fill="none" stroke="#000000" cx="3400" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3400" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 158&#45;227</text>
</g>
<!-- section_27&#45;&gt;codeblock_45 -->
<g id="edge45" class="edge">
<title>section_27&#45;&gt;codeblock_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3037.5504,-2513.8559C3088.0328,-2496.3666 3168.5424,-2462.6267 3222,-2411.204 3312.9515,-2323.7145 3369.8819,-2179.4883 3390.8632,-2119.1282"/>
<polygon fill="#000000" stroke="#000000" points="3394.2242,-2120.1162 3394.1433,-2109.5217 3387.5997,-2117.8543 3394.2242,-2120.1162"/>
</g>
<!-- header_57 -->
<g id="node58" class="node">
<title>header_57</title>
<ellipse fill="none" stroke="#000000" cx="3909" cy="-2091.2034" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3909" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_57 -->
<g id="edge57" class="edge">
<title>section_28&#45;&gt;header_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4140.1032,-2510.2585C4102.653,-2442.3507 3969.454,-2200.8235 3924.1853,-2118.7387"/>
<polygon fill="#000000" stroke="#000000" points="3927.0071,-2116.6076 3919.113,-2109.5411 3920.8774,-2119.988 3927.0071,-2116.6076"/>
</g>
<!-- prose_58 -->
<g id="node59" class="node">
<title>prose_58</title>
<ellipse fill="none" stroke="#000000" cx="4150" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4150" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_58 -->
<g id="edge58" class="edge">
<title>section_28&#45;&gt;prose_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4150,-2509.9831C4150,-2441.9619 4150,-2202.5568 4150,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="4153.5001,-2119.5021 4150,-2109.5022 4146.5001,-2119.5022 4153.5001,-2119.5021"/>
</g>
<!-- prose_59 -->
<g id="node60" class="node">
<title>prose_59</title>
<ellipse fill="none" stroke="#000000" cx="4232" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4232" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_59 -->
<g id="edge59" class="edge">
<title>section_28&#45;&gt;prose_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4157.7568,-2509.9197C4167.0812,-2487.1923 4182.5289,-2447.0212 4191,-2411.204 4216.0171,-2305.4281 4226.6661,-2176.1321 4230.3546,-2119.7593"/>
<polygon fill="#000000" stroke="#000000" points="4233.866,-2119.6859 4231.0017,-2109.4856 4226.8799,-2119.2458 4233.866,-2119.6859"/>
</g>
<!-- codeblock_60 -->
<g id="node61" class="node">
<title>codeblock_60</title>
<ellipse fill="none" stroke="#000000" cx="4370" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4370" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 236&#45;238</text>
</g>
<!-- section_28&#45;&gt;codeblock_60 -->
<g id="edge60" class="edge">
<title>section_28&#45;&gt;codeblock_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4174.6492,-2510.9907C4202.4344,-2490.3483 4247.0981,-2453.2285 4273,-2411.204 4332.787,-2314.2027 4357.9169,-2177.8283 4366.3877,-2119.4828"/>
<polygon fill="#000000" stroke="#000000" points="4369.8617,-2119.9119 4367.7801,-2109.5235 4362.9291,-2118.9426 4369.8617,-2119.9119"/>
</g>
<!-- header_67 -->
<g id="node68" class="node">
<title>header_67</title>
<ellipse fill="none" stroke="#000000" cx="4805" cy="-2091.2034" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4805" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_67 -->
<g id="edge67" class="edge">
<title>section_29&#45;&gt;header_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5027.1356,-2510.8309C4999.8729,-2489.9021 4955.4927,-2452.3827 4928,-2411.204 4863.1318,-2314.0439 4825.4277,-2177.7542 4811.3671,-2119.4569"/>
<polygon fill="#000000" stroke="#000000" points="4814.7216,-2118.4331 4809.0156,-2109.5061 4807.9093,-2120.043 4814.7216,-2118.4331"/>
</g>
<!-- prose_68 -->
<g id="node69" class="node">
<title>prose_68</title>
<ellipse fill="none" stroke="#000000" cx="4969" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4969" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_68 -->
<g id="edge68" class="edge">
<title>section_29&#45;&gt;prose_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5043.2432,-2509.9197C5033.9188,-2487.1923 5018.4711,-2447.0212 5010,-2411.204 4984.9829,-2305.4281 4974.3339,-2176.1321 4970.6454,-2119.7593"/>
<polygon fill="#000000" stroke="#000000" points="4974.1201,-2119.2458 4969.9983,-2109.4856 4967.134,-2119.6859 4974.1201,-2119.2458"/>
</g>
<!-- prose_69 -->
<g id="node70" class="node">
<title>prose_69</title>
<ellipse fill="none" stroke="#000000" cx="5051" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5051" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_69 -->
<g id="edge69" class="edge">
<title>section_29&#45;&gt;prose_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5051,-2509.9831C5051,-2441.9619 5051,-2202.5568 5051,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="5054.5001,-2119.5021 5051,-2109.5022 5047.5001,-2119.5022 5054.5001,-2119.5021"/>
</g>
<!-- prose_70 -->
<g id="node71" class="node">
<title>prose_70</title>
<ellipse fill="none" stroke="#000000" cx="5605" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5605" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_70 -->
<g id="edge70" class="edge">
<title>section_29&#45;&gt;prose_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5073.0593,-2510.8035C5160.5757,-2441.7698 5483.1787,-2187.2973 5578.3833,-2112.1989"/>
<polygon fill="#000000" stroke="#000000" points="5580.6856,-2114.8407 5586.3693,-2105.8994 5576.3503,-2109.3447 5580.6856,-2114.8407"/>
</g>
<!-- prose_71 -->
<g id="node72" class="node">
<title>prose_71</title>
<ellipse fill="none" stroke="#000000" cx="5833" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5833" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_71 -->
<g id="edge71" class="edge">
<title>section_29&#45;&gt;prose_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5115.0802,-2518.6502C5259.8224,-2496.6387 5602.8312,-2441.8959 5646,-2411.204 5751.3154,-2336.3274 5806.4745,-2182.007 5825.3601,-2118.9596"/>
<polygon fill="#000000" stroke="#000000" points="5828.7351,-2119.8883 5828.1794,-2109.3081 5822.0158,-2117.9256 5828.7351,-2119.8883"/>
</g>
<!-- codeblock_72 -->
<g id="node73" class="node">
<title>codeblock_72</title>
<ellipse fill="none" stroke="#000000" cx="6124" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6124" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 256&#45;289</text>
</g>
<!-- section_29&#45;&gt;codeblock_72 -->
<g id="edge72" class="edge">
<title>section_29&#45;&gt;codeblock_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5125.2586,-2524.7021C5302.9032,-2515.2179 5747.0447,-2484.6383 5874,-2411.204 5997.0954,-2340.0024 6081.4175,-2182.3389 6111.6463,-2118.6685"/>
<polygon fill="#000000" stroke="#000000" points="6114.9687,-2119.8259 6116.031,-2109.2845 6108.6268,-2116.8626 6114.9687,-2119.8259"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1892,-984.6029 1554,-984.6029 1554,-928.7999 1892,-928.7999 1892,-984.6029"/>
<text text-anchor="middle" x="1723" y="-937.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.6157,-2073.2138C2224.3397,-2018.9864 2253.747,-1855.6656 2171,-1771.2027 2086.2792,-1684.7251 1990.4589,-1816.7693 1901,-1735.2027 1680.5243,-1534.1781 1704.9397,-1120.9972 1718.3222,-994.4025"/>
<polygon fill="#000000" stroke="#000000" points="1721.8062,-994.7387 1719.419,-984.4163 1714.8481,-993.9744 1721.8062,-994.7387"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2052,-974.7014 1910,-974.7014 1910,-938.7014 2052,-938.7014 2052,-974.7014"/>
<text text-anchor="middle" x="1981" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2332.0387,-2073.0779C2334.0971,-2018.4653 2332.2602,-1854.1667 2243,-1771.2027 2182.6035,-1715.0665 2116.5357,-1796.1519 2061,-1735.2027 1859.3211,-1513.8649 1945.6013,-1096.6404 1973.5064,-984.8519"/>
<polygon fill="#000000" stroke="#000000" points="1976.9382,-985.5583 1976.0131,-975.004 1970.1545,-983.8316 1976.9382,-985.5583"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2097" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2097" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.3156,-2073.142C2476.1384,-2018.7113 2502.8571,-1854.8743 2419,-1771.2027 2328.3093,-1680.7127 2219.9421,-1829.3001 2133,-1735.2027 2030.1753,-1623.9156 2079.7158,-1111.4648 2093.7211,-984.9825"/>
<polygon fill="#000000" stroke="#000000" points="2097.2125,-985.2546 2094.8505,-974.9264 2090.2562,-984.4733 2097.2125,-985.2546"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2690,-1735.2041 2142,-1735.2041 2142,-178.1988 2690,-178.1988 2690,-1735.2041"/>
<text text-anchor="middle" x="2416" y="-1720.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 2000</text>
<text text-anchor="middle" x="2416" y="-1688.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2416" y="-1673.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2416" y="-1657.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1642.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2416" y="-1627.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2416" y="-1611.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-1580.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2416" y="-1564.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2416" y="-1549.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1534.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1518.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2416" y="-1503.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2416" y="-1487.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2416" y="-1472.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2416" y="-1457.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2416" y="-1441.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-1410.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2416" y="-1394.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2416" y="-1379.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1364.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1348.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2416" y="-1333.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2416" y="-1317.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2416" y="-1302.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2416" y="-1287.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2416" y="-1271.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-1240.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2416" y="-1224.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2416" y="-1209.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1194.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2416" y="-1178.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1163.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2416" y="-1147.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2416" y="-1132.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1117.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2416" y="-1101.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2416" y="-1086.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2416" y="-1070.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2416" y="-1055.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2416" y="-1040.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-1008.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2416" y="-993.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2416" y="-977.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-946.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2416" y="-931.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2416" y="-915.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-884.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2416" y="-868.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2416" y="-853.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-822.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2416" y="-806.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2416" y="-791.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-759.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2416" y="-744.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2416" y="-729.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2416" y="-713.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2416" y="-698.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2416" y="-682.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-651.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2416" y="-636.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2416" y="-620.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2416" y="-605.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-573.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2416" y="-558.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2416" y="-543.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2416" y="-527.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2416" y="-512.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2416" y="-496.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2416" y="-481.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2416" y="-466.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2416" y="-450.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-419.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2416" y="-387.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2416" y="-372.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2416" y="-357.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2416" y="-325.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2416" y="-294.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2416" y="-278.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2416" y="-263.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2416" y="-248.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2416" y="-232.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2416" y="-217.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2416" y="-201.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2416" y="-186.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2590.1481,-2072.9235C2582.9743,-2026.9425 2563.0303,-1899.1094 2539.0763,-1745.5733"/>
<polygon fill="#000000" stroke="#000000" points="2542.4926,-1744.7645 2537.4928,-1735.4236 2535.5762,-1745.8436 2542.4926,-1744.7645"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="1954,-125.1 1900,-125.1 1900,-89.1 1954,-89.1 1954,-125.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2098.7755,-938.4698C2108.646,-833.2395 2153.0802,-303.8346 2061,-178.2001 2033.5699,-140.7745 2002.2547,-166.9419 1963,-142.2001 1958.5,-139.3638 1954.1025,-135.889 1950.0137,-132.2403"/>
<polygon fill="#000000" stroke="#000000" points="1952.2302,-129.517 1942.5855,-125.1317 1947.3904,-134.5743 1952.2302,-129.517"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2864,-974.7014 2708,-974.7014 2708,-938.7014 2864,-938.7014 2864,-974.7014"/>
<text text-anchor="middle" x="2786" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>header_40&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776.1611,-2072.9235C2777.3166,-1941.8395 2784.3356,-1145.5249 2785.7513,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="2789.2515,-984.9004 2785.8399,-974.8699 2782.2518,-984.8386 2789.2515,-984.9004"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2909" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_41&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2072.9235C2909,-1941.8395 2909,-1145.5249 2909,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-984.8699 2909,-974.8699 2905.5001,-984.8699 2912.5001,-984.8699"/>
</g>
<!-- raw_49 -->
<g id="node50" class="node">
<title>raw_49</title>
<ellipse fill="none" stroke="#000000" cx="2981" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2981" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_49 -->
<g id="edge49" class="edge">
<title>prose_42&#45;&gt;raw_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.8389,-2072.9235C2989.6834,-1941.8395 2982.6644,-1145.5249 2981.2487,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="2984.7482,-984.8386 2981.1601,-974.8699 2977.7485,-984.9004 2984.7482,-984.8386"/>
</g>
<!-- hashline_51 -->
<g id="node52" class="node">
<title>hashline_51</title>
<ellipse fill="none" stroke="#000000" cx="3069" cy="-956.7014" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="3069" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_43&#45;&gt;hashline_51 -->
<g id="edge51" class="edge">
<title>structure_43&#45;&gt;hashline_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3085.7261,-2072.9235C3083.7618,-1941.8395 3071.8294,-1145.5249 3069.4228,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="3072.9218,-984.8163 3069.2722,-974.8699 3065.9226,-984.9213 3072.9218,-984.8163"/>
</g>
<!-- raw_54 -->
<g id="node55" class="node">
<title>raw_54</title>
<ellipse fill="none" stroke="#000000" cx="3157" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3157" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_44&#45;&gt;raw_54 -->
<g id="edge54" class="edge">
<title>prose_44&#45;&gt;raw_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3180.6133,-2072.9235C3177.8403,-1941.8395 3160.9945,-1145.5249 3157.5969,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="3161.0952,-984.7936 3157.3843,-974.8699 3154.0967,-984.9417 3161.0952,-984.7936"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3757.5,-1484.5035 3202.5,-1484.5035 3202.5,-428.8993 3757.5,-428.8993 3757.5,-1484.5035"/>
<text text-anchor="middle" x="3480" y="-1469.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3480" y="-1454.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3480" y="-1438.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3480" y="-1423.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3480" y="-1407.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3480" y="-1392.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3480" y="-1377.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3480" y="-1361.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3480" y="-1346.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3480" y="-1330.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3480" y="-1315.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3480" y="-1300.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3480" y="-1284.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-1269.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3480" y="-1253.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3480" y="-1238.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3480" y="-1223.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3480" y="-1207.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3480" y="-1192.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3480" y="-1176.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3480" y="-1161.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-1146.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3480" y="-1130.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3480" y="-1115.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-1099.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-1068.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3480" y="-1053.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3480" y="-1037.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3480" y="-1022.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3480" y="-1006.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3480" y="-991.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3480" y="-976.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3480" y="-960.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3480" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3480" y="-914.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3480" y="-899.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-883.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3480" y="-868.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3480" y="-852.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3480" y="-837.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3480" y="-822.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3480" y="-806.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3480" y="-791.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3480" y="-775.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3480" y="-760.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-745.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3480" y="-729.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3480" y="-714.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3480" y="-698.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3480" y="-683.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3480" y="-668.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3480" y="-652.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3480" y="-637.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3480" y="-621.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3480" y="-606.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3480" y="-591.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3480" y="-575.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3480" y="-560.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3480" y="-544.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-529.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-514.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3480" y="-498.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3480" y="-483.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3480" y="-467.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3480" y="-452.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-437.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_45&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>codeblock_45&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3401.289,-2072.9235C3406.2075,-2003.1736 3424.4074,-1745.0757 3442.0682,-1494.6225"/>
<polygon fill="#000000" stroke="#000000" points="3445.5636,-1494.8105 3442.7757,-1484.5891 3438.5809,-1494.3181 3445.5636,-1494.8105"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="2492,-135.0015 1972,-135.0015 1972,-79.1986 2492,-79.1986 2492,-135.0015"/>
<text text-anchor="middle" x="2232" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2911.1981,-938.4308C2923.5927,-831.845 2980.4566,-291.1983 2873,-178.2001 2844.3835,-148.1079 2542.2611,-146.8872 2501,-142.2001 2484.1789,-140.2893 2466.7782,-138.223 2449.2921,-136.0827"/>
<polygon fill="#000000" stroke="#000000" points="2449.3432,-132.5627 2438.9905,-134.8146 2448.4879,-139.5102 2449.3432,-132.5627"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="3009.5,-134.4005 2510.5,-134.4005 2510.5,-79.7996 3009.5,-79.7996 3009.5,-134.4005"/>
<text text-anchor="middle" x="2760" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2760" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_49&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>raw_49&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2982.747,-938.4904C2992.4575,-833.3766 3036.1432,-304.516 2945,-178.2001 2934.6942,-163.9172 2903.0455,-149.6874 2868.7721,-137.7523"/>
<polygon fill="#000000" stroke="#000000" points="2869.6456,-134.3527 2859.0512,-134.4488 2867.3932,-140.9804 2869.6456,-134.3527"/>
</g>
<!-- hashtag_52 -->
<g id="node53" class="node">
<title>hashtag_52</title>
<ellipse fill="none" stroke="#000000" cx="3069" cy="-107.1" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="3069" y="-102.9" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_51&#45;&gt;hashtag_52 -->
<g id="edge52" class="edge">
<title>hashline_51&#45;&gt;hashtag_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3069,-938.5632C3069,-830.2631 3069,-269.2221 3069,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="3072.5001,-135.4293 3069,-125.4293 3065.5001,-135.4293 3072.5001,-135.4293"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="3096,-36 3042,-36 3042,0 3096,0 3096,-36"/>
<text text-anchor="middle" x="3069" y="-14.5" font-family="Inconsolata" font-size="14.00" fill="#000000">todo</text>
</g>
<!-- hashtag_52&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>hashtag_52&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3069,-89.0693C3069,-76.7509 3069,-60.1792 3069,-46.1369"/>
<polygon fill="#000000" stroke="#000000" points="3072.5001,-46.0039 3069,-36.0039 3065.5001,-46.0039 3072.5001,-46.0039"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3333.5,-127.0021 3128.5,-127.0021 3128.5,-87.198 3333.5,-87.198 3333.5,-127.0021"/>
<text text-anchor="middle" x="3231" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">the results never get used.</text>
</g>
<!-- raw_54&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>raw_54&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3154.9643,-938.71C3145.7793,-852.3448 3112.0542,-472.37 3193,-178.2001 3197.0936,-163.3234 3204.7084,-148.0743 3212.0526,-135.5324"/>
<polygon fill="#000000" stroke="#000000" points="3215.0842,-137.2834 3217.2983,-126.9225 3209.1063,-133.6413 3215.0842,-137.2834"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4106.5,-974.7014 3775.5,-974.7014 3775.5,-938.7014 4106.5,-938.7014 4106.5,-974.7014"/>
<text text-anchor="middle" x="3941" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_57&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>header_57&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3909.5156,-2072.9235C3913.213,-1941.8395 3935.674,-1145.5249 3940.2041,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="3943.7041,-984.9646 3940.4875,-974.8699 3936.7069,-984.7672 3943.7041,-984.9646"/>
</g>
<!-- raw_62 -->
<g id="node63" class="node">
<title>raw_62</title>
<ellipse fill="none" stroke="#000000" cx="4152" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4152" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_58&#45;&gt;raw_62 -->
<g id="edge62" class="edge">
<title>prose_58&#45;&gt;raw_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4150.0322,-2072.9235C4150.2633,-1941.8395 4151.6671,-1145.5249 4151.9503,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="4155.4502,-984.8761 4151.968,-974.8699 4148.4502,-984.8637 4155.4502,-984.8761"/>
</g>
<!-- raw_64 -->
<g id="node65" class="node">
<title>raw_64</title>
<ellipse fill="none" stroke="#000000" cx="4229" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4229" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_59&#45;&gt;raw_64 -->
<g id="edge64" class="edge">
<title>prose_59&#45;&gt;raw_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4231.9517,-2072.9235C4231.605,-1941.8395 4229.4993,-1145.5249 4229.0746,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="4232.5746,-984.8606 4229.048,-974.8699 4225.5746,-984.8792 4232.5746,-984.8606"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4397,-974.7014 4343,-974.7014 4343,-938.7014 4397,-938.7014 4397,-974.7014"/>
</g>
<!-- codeblock_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>codeblock_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4370,-2072.9235C4370,-1941.8395 4370,-1145.5249 4370,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="4373.5001,-984.8699 4370,-974.8699 4366.5001,-984.8699 4373.5001,-984.8699"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="3718,-135.0015 3352,-135.0015 3352,-79.1986 3718,-79.1986 3718,-135.0015"/>
<text text-anchor="middle" x="3535" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_62&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>raw_62&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4154.1793,-938.4226C4166.4635,-831.7902 4222.7585,-290.9233 4115,-178.2001 4085.0819,-146.9036 3769.8926,-148.0989 3727,-142.2001 3714.6828,-140.5062 3701.9522,-138.5768 3689.1797,-136.5142"/>
<polygon fill="#000000" stroke="#000000" points="3689.3693,-132.9986 3678.9346,-134.8335 3688.2361,-139.9063 3689.3693,-132.9986"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4081.5,-127.0021 3736.5,-127.0021 3736.5,-87.198 4081.5,-87.198 4081.5,-127.0021"/>
<text text-anchor="middle" x="3909" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_64&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>raw_64&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4234.7538,-939.06C4263.5939,-846.9645 4383.482,-416.532 4188,-178.2001 4176.8169,-164.5657 4093.1897,-144.359 4020.3818,-128.9684"/>
<polygon fill="#000000" stroke="#000000" points="4020.6944,-125.4578 4010.1887,-126.8298 4019.257,-132.3087 4020.6944,-125.4578"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="4914.5,-974.7014 4695.5,-974.7014 4695.5,-938.7014 4914.5,-938.7014 4914.5,-974.7014"/>
<text text-anchor="middle" x="4805" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_67&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>header_67&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4805,-2072.9235C4805,-1941.8395 4805,-1145.5249 4805,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="4808.5001,-984.8699 4805,-974.8699 4801.5001,-984.8699 4808.5001,-984.8699"/>
</g>
<!-- raw_74 -->
<g id="node75" class="node">
<title>raw_74</title>
<ellipse fill="none" stroke="#000000" cx="4964" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4964" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_68&#45;&gt;raw_74 -->
<g id="edge74" class="edge">
<title>prose_68&#45;&gt;raw_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4968.9194,-2072.9235C4968.3417,-1941.8395 4964.8322,-1145.5249 4964.1244,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="4967.6242,-984.8543 4964.0801,-974.8699 4960.6243,-984.8853 4967.6242,-984.8543"/>
</g>
<!-- raw_76 -->
<g id="node77" class="node">
<title>raw_76</title>
<ellipse fill="none" stroke="#000000" cx="5045" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5045" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_69&#45;&gt;raw_76 -->
<g id="edge76" class="edge">
<title>prose_69&#45;&gt;raw_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5050.9033,-2072.9235C5050.2101,-1941.8395 5045.9986,-1145.5249 5045.1492,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="5048.649,-984.8512 5045.0961,-974.8699 5041.6491,-984.8883 5048.649,-984.8512"/>
</g>
<!-- raw_78 -->
<g id="node79" class="node">
<title>raw_78</title>
<ellipse fill="none" stroke="#000000" cx="5282" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5282" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_70&#45;&gt;raw_78 -->
<g id="edge78" class="edge">
<title>prose_70&#45;&gt;raw_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5593.4884,-2074.3202C5560.256,-2024.733 5463.5145,-1874.258 5416,-1735.2027 5319.5193,-1452.8439 5290.2446,-1088.1101 5283.6298,-984.9732"/>
<polygon fill="#000000" stroke="#000000" points="5287.1085,-984.5212 5282.9948,-974.7577 5280.122,-984.9556 5287.1085,-984.5212"/>
</g>
<!-- prespace_79 -->
<g id="node80" class="node">
<title>prespace_79</title>
<ellipse fill="none" stroke="#000000" cx="5471" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5471" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_70&#45;&gt;prespace_79 -->
<g id="edge79" class="edge">
<title>prose_70&#45;&gt;prespace_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5600.094,-2073.2183C5586.136,-2021.2785 5545.9892,-1866.3899 5527,-1735.2027 5484.8584,-1444.0678 5473.9191,-1086.869 5471.5672,-985.0114"/>
<polygon fill="#000000" stroke="#000000" points="5475.0641,-984.8297 5471.3432,-974.9098 5468.0658,-984.985 5475.0641,-984.8297"/>
</g>
<!-- literal_80 -->
<g id="node81" class="node">
<title>literal_80</title>
<ellipse fill="none" stroke="#000000" cx="5567" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5567" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_70&#45;&gt;literal_80 -->
<g id="edge80" class="edge">
<title>prose_70&#45;&gt;literal_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5604.3877,-2072.9235C5599.9971,-1941.8395 5573.3246,-1145.5249 5567.9451,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="5571.4414,-984.7471 5567.6086,-974.8699 5564.4454,-984.9815 5571.4414,-984.7471"/>
</g>
<!-- raw_81 -->
<g id="node82" class="node">
<title>raw_81</title>
<ellipse fill="none" stroke="#000000" cx="5643" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5643" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_70&#45;&gt;raw_81 -->
<g id="edge81" class="edge">
<title>prose_70&#45;&gt;raw_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5605.6123,-2072.9235C5610.0029,-1941.8395 5636.6754,-1145.5249 5642.0549,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="5645.5546,-984.9815 5642.3914,-974.8699 5638.5586,-984.7471 5645.5546,-984.9815"/>
</g>
<!-- prespace_82 -->
<g id="node83" class="node">
<title>prespace_82</title>
<ellipse fill="none" stroke="#000000" cx="5734" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5734" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_70&#45;&gt;prespace_82 -->
<g id="edge82" class="edge">
<title>prose_70&#45;&gt;prespace_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5609.6402,-2073.1996C5622.8447,-2021.2098 5660.8415,-1866.2008 5679,-1735.2027 5719.3868,-1443.8463 5730.8284,-1086.8016 5733.3735,-984.9961"/>
<polygon fill="#000000" stroke="#000000" points="5736.8748,-984.9813 5733.6172,-974.8997 5729.8768,-984.8123 5736.8748,-984.9813"/>
</g>
<!-- literal_83 -->
<g id="node84" class="node">
<title>literal_83</title>
<ellipse fill="none" stroke="#000000" cx="5830" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5830" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_70&#45;&gt;literal_83 -->
<g id="edge83" class="edge">
<title>prose_70&#45;&gt;literal_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5617.2308,-2074.1573C5651.9136,-2024.7248 5750.8496,-1875.8766 5789,-1735.2027 5866.0756,-1450.9982 5841.7543,-1087.556 5832.716,-984.8484"/>
<polygon fill="#000000" stroke="#000000" points="5836.1825,-984.3196 5831.7945,-974.6762 5829.211,-984.9512 5836.1825,-984.3196"/>
</g>
<!-- raw_84 -->
<g id="node85" class="node">
<title>raw_84</title>
<ellipse fill="none" stroke="#000000" cx="5906" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5906" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_70&#45;&gt;raw_84 -->
<g id="edge84" class="edge">
<title>prose_70&#45;&gt;raw_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5610.9851,-2073.4764C5629.6249,-2020.6762 5691.4798,-1862.4676 5792,-1771.2027 5820.2679,-1745.5376 5848.6848,-1766.8798 5870,-1735.2027 5954.4114,-1609.7568 5918.8704,-1109.9501 5908.4874,-985.0844"/>
<polygon fill="#000000" stroke="#000000" points="5911.95,-984.4935 5907.62,-974.8239 5904.9749,-985.0832 5911.95,-984.4935"/>
</g>
<!-- raw_92 -->
<g id="node93" class="node">
<title>raw_92</title>
<ellipse fill="none" stroke="#000000" cx="5978" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5978" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_71&#45;&gt;raw_92 -->
<g id="edge92" class="edge">
<title>prose_71&#45;&gt;raw_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5840.1928,-2073.4399C5860.598,-2022.0918 5918.8681,-1868.6286 5942,-1735.2027 5992.2301,-1445.4738 5983.1203,-1086.5976 5979.2222,-984.7912"/>
<polygon fill="#000000" stroke="#000000" points="5982.7156,-984.5549 5978.8199,-974.7023 5975.7212,-984.8338 5982.7156,-984.5549"/>
</g>
<!-- leaf_94 -->
<g id="node95" class="node">
<title>leaf_94</title>
<polygon fill="none" stroke="#c0c0c0" points="6529,-1207.6025 6023,-1207.6025 6023,-705.8003 6529,-705.8003 6529,-1207.6025"/>
<text text-anchor="middle" x="6276" y="-1192.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = table.concat</text>
<text text-anchor="middle" x="6276" y="-1176.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6276" y="-1161.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6276" y="-1146.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6276" y="-1130.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6276" y="-1115.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6276" y="-1099.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6276" y="-1084.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6276" y="-1069.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6276" y="-1053.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6276" y="-1038.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6276" y="-1022.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6276" y="-1007.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6276" y="-992.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6276" y="-976.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6276" y="-961.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6276" y="-945.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6276" y="-930.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6276" y="-915.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6276" y="-899.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6276" y="-884.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6276" y="-868.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6276" y="-853.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6276" y="-838.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6276" y="-806.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6276" y="-791.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6276" y="-775.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6276" y="-760.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6276" y="-745.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6276" y="-729.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6276" y="-714.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_72&#45;&gt;leaf_94 -->
<g id="edge94" class="edge">
<title>codeblock_72&#45;&gt;leaf_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6126.4491,-2072.9235C6139.4231,-1976.0877 6201.0359,-1516.2204 6241.0202,-1217.7847"/>
<polygon fill="#000000" stroke="#000000" points="6244.5151,-1218.0553 6242.3741,-1207.679 6237.5771,-1217.1257 6244.5151,-1218.0553"/>
</g>
<!-- leaf_75 -->
<g id="node76" class="node">
<title>leaf_75</title>
<polygon fill="none" stroke="#c0c0c0" points="4374.5,-135.0015 4099.5,-135.0015 4099.5,-79.1986 4374.5,-79.1986 4374.5,-135.0015"/>
<text text-anchor="middle" x="4237" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_74&#45;&gt;leaf_75 -->
<g id="edge75" class="edge">
<title>raw_74&#45;&gt;leaf_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4966.0819,-938.7198C4977.9386,-832.6376 5032.637,-289.3912 4923,-178.2001 4880.8575,-135.4603 4443.3435,-151.2017 4384,-142.2001 4374.2719,-140.7245 4364.2396,-138.928 4354.2009,-136.9363"/>
<polygon fill="#000000" stroke="#000000" points="4354.6697,-133.4598 4344.1711,-134.8843 4353.2666,-140.3178 4354.6697,-133.4598"/>
</g>
<!-- leaf_77 -->
<g id="node78" class="node">
<title>leaf_77</title>
<polygon fill="none" stroke="#c0c0c0" points="4955,-142.3004 4393,-142.3004 4393,-71.8997 4955,-71.8997 4955,-142.3004"/>
<text text-anchor="middle" x="4674" y="-111.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4674" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4674" y="-80.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_76&#45;&gt;leaf_77 -->
<g id="edge77" class="edge">
<title>raw_76&#45;&gt;leaf_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5050.7928,-938.9182C5079.8134,-846.1077 5200.2558,-412.6498 5000,-178.2001 4988.712,-164.9847 4964.8046,-154.0582 4934.8139,-145.0737"/>
<polygon fill="#000000" stroke="#000000" points="4935.4484,-141.6148 4924.8712,-142.2245 4933.52,-148.3439 4935.4484,-141.6148"/>
</g>
<!-- leaf_85 -->
<g id="node86" class="node">
<title>leaf_85</title>
<polygon fill="none" stroke="#c0c0c0" points="5493,-134.4005 4973,-134.4005 4973,-79.7996 5493,-79.7996 5493,-134.4005"/>
<text text-anchor="middle" x="5233" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5233" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_78&#45;&gt;leaf_85 -->
<g id="edge85" class="edge">
<title>raw_78&#45;&gt;leaf_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5280.9539,-938.5632C5274.8446,-832.635 5243.755,-293.5794 5235.1882,-145.0416"/>
<polygon fill="#000000" stroke="#000000" points="5238.6582,-144.4186 5234.5882,-134.6367 5231.6698,-144.8217 5238.6582,-144.4186"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="5565,-125.1 5511,-125.1 5511,-89.1 5565,-89.1 5565,-125.1"/>
<text text-anchor="middle" x="5538" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_79&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>prespace_79&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5471.7569,-938.5464C5475.4407,-852.9458 5492.7264,-481.1554 5527,-178.2001 5528.6016,-164.0433 5530.9597,-148.387 5533.0822,-135.3778"/>
<polygon fill="#000000" stroke="#000000" points="5536.5929,-135.6037 5534.788,-125.1637 5529.6885,-134.4506 5536.5929,-135.6037"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="5648.5,-125.1 5583.5,-125.1 5583.5,-89.1 5648.5,-89.1 5648.5,-125.1"/>
<text text-anchor="middle" x="5616" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_80&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>literal_80&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5567.432,-938.5619C5569.5738,-853.0313 5580.049,-481.5083 5607,-178.2001 5608.2561,-164.0638 5610.1796,-148.4098 5611.9263,-135.3967"/>
<polygon fill="#000000" stroke="#000000" points="5615.4365,-135.5623 5613.3335,-125.1783 5608.5019,-134.6073 5615.4365,-135.5623"/>
</g>
<!-- leaf_88 -->
<g id="node89" class="node">
<title>leaf_88</title>
<polygon fill="none" stroke="#c0c0c0" points="5935,-126.4006 5667,-126.4006 5667,-87.7995 5935,-87.7995 5935,-126.4006"/>
<text text-anchor="middle" x="5801" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5801" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_81&#45;&gt;leaf_88 -->
<g id="edge88" class="edge">
<title>raw_81&#45;&gt;leaf_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5641.5697,-938.7002C5633.6419,-834.7666 5598.2925,-311.4258 5679,-178.2001 5691.6148,-157.3766 5712.8026,-142.0093 5734.0134,-130.9987"/>
<polygon fill="#000000" stroke="#000000" points="5735.6488,-134.0949 5743.0802,-126.5434 5732.5617,-127.8124 5735.6488,-134.0949"/>
</g>
<!-- leaf_89 -->
<g id="node90" class="node">
<title>leaf_89</title>
<polygon fill="none" stroke="#c0c0c0" points="6007,-125.1 5953,-125.1 5953,-89.1 6007,-89.1 6007,-125.1"/>
<text text-anchor="middle" x="5980" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_82&#45;&gt;leaf_89 -->
<g id="edge89" class="edge">
<title>prespace_82&#45;&gt;leaf_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5732.5385,-938.6033C5724.4039,-832.9991 5688.6202,-296.9911 5790,-178.2001 5835.6294,-124.7342 5882.3552,-175.9723 5944,-142.2001 5948.8804,-139.5264 5953.5625,-136.0077 5957.8426,-132.2306"/>
<polygon fill="#000000" stroke="#000000" points="5960.288,-134.7347 5965.0683,-125.2795 5955.4351,-129.69 5960.288,-134.7347"/>
</g>
<!-- leaf_90 -->
<g id="node91" class="node">
<title>leaf_90</title>
<polygon fill="none" stroke="#c0c0c0" points="6083,-125.1 6025,-125.1 6025,-89.1 6083,-89.1 6083,-125.1"/>
<text text-anchor="middle" x="6054" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_83&#45;&gt;leaf_90 -->
<g id="edge90" class="edge">
<title>literal_83&#45;&gt;leaf_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5828.1556,-938.6474C5817.7883,-833.2947 5770.6944,-298.4751 5870,-178.2001 5912.5511,-126.6639 5957.15,-173.8741 6016,-142.2001 6021.0415,-139.4867 6025.9286,-135.948 6030.4255,-132.1634"/>
<polygon fill="#000000" stroke="#000000" points="6033.0184,-134.5356 6038.0477,-125.2106 6028.301,-129.364 6033.0184,-134.5356"/>
</g>
<!-- leaf_91 -->
<g id="node92" class="node">
<title>leaf_91</title>
<polygon fill="none" stroke="#c0c0c0" points="6187,-125.1 6101,-125.1 6101,-89.1 6187,-89.1 6187,-125.1"/>
<text text-anchor="middle" x="6144" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_84&#45;&gt;leaf_91 -->
<g id="edge91" class="edge">
<title>raw_84&#45;&gt;leaf_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5904.0433,-938.6449C5893.0231,-833.278 5842.6542,-298.3913 5942,-178.2001 5985.6795,-125.3555 6029.2501,-169.8206 6092,-142.2001 6098.9222,-139.1532 6105.9149,-135.1768 6112.4307,-130.9993"/>
<polygon fill="#000000" stroke="#000000" points="6114.6313,-133.737 6120.9687,-125.2466 6110.7198,-127.9318 6114.6313,-133.737"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="6739,-134.4005 6205,-134.4005 6205,-79.7996 6739,-79.7996 6739,-134.4005"/>
<text text-anchor="middle" x="6472" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6472" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_92&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>raw_92&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5975.8999,-938.5214C5964.0637,-832.4515 5909.8382,-294.2425 6014,-178.2001 6022.5356,-168.6909 6135.3899,-151.1101 6246.9239,-135.8105"/>
<polygon fill="#000000" stroke="#000000" points="6247.5818,-139.2532 6257.016,-134.4318 6246.6343,-132.3177 6247.5818,-139.2532"/>
</g>
<!-- leaf_100 -->
<g id="node101" class="node">
<title>leaf_100</title>
<polygon fill="none" stroke="#c0c0c0" points="7211.5,-2109.2034 7020.5,-2109.2034 7020.5,-2073.2034 7211.5,-2073.2034 7211.5,-2109.2034"/>
<text text-anchor="middle" x="7116" y="-2087.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_95&#45;&gt;leaf_100 -->
<g id="edge100" class="edge">
<title>header_95&#45;&gt;leaf_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7116,-2509.9831C7116,-2441.9619 7116,-2202.5568 7116,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="7119.5001,-2119.5021 7116,-2109.5022 7112.5001,-2119.5022 7119.5001,-2119.5021"/>
</g>
<!-- raw_101 -->
<g id="node102" class="node">
<title>raw_101</title>
<ellipse fill="none" stroke="#000000" cx="7266" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="7266" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_96&#45;&gt;raw_101 -->
<g id="edge101" class="edge">
<title>prose_96&#45;&gt;raw_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7273.6664,-2509.9831C7272.4212,-2441.9619 7268.0385,-2202.5568 7266.5215,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="7270.0175,-2119.4364 7266.335,-2109.5022 7263.0187,-2119.5646 7270.0175,-2119.4364"/>
</g>
<!-- raw_103 -->
<g id="node104" class="node">
<title>raw_103</title>
<ellipse fill="none" stroke="#000000" cx="7356" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="7356" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_97&#45;&gt;raw_103 -->
<g id="edge103" class="edge">
<title>prose_97&#45;&gt;raw_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7356,-2509.9831C7356,-2441.9619 7356,-2202.5568 7356,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="7359.5001,-2119.5021 7356,-2109.5022 7352.5001,-2119.5022 7359.5001,-2119.5021"/>
</g>
<!-- header_105 -->
<g id="node106" class="node">
<title>header_105</title>
<ellipse fill="none" stroke="#000000" cx="7750" cy="-2091.2034" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7750" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuzz_patt</text>
</g>
<!-- section_98&#45;&gt;header_105 -->
<g id="edge105" class="edge">
<title>section_98&#45;&gt;header_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7938.9101,-2510.2585C7908.2277,-2442.1964 7798.9214,-2199.7247 7762.1617,-2118.1815"/>
<polygon fill="#000000" stroke="#000000" points="7765.3492,-2116.7356 7758.0486,-2109.0575 7758.9676,-2119.6124 7765.3492,-2116.7356"/>
</g>
<!-- prose_106 -->
<g id="node107" class="node">
<title>prose_106</title>
<ellipse fill="none" stroke="#000000" cx="7947" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7947" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_98&#45;&gt;prose_106 -->
<g id="edge106" class="edge">
<title>section_98&#45;&gt;prose_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7947,-2509.9831C7947,-2441.9619 7947,-2202.5568 7947,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="7950.5001,-2119.5021 7947,-2109.5022 7943.5001,-2119.5022 7950.5001,-2119.5021"/>
</g>
<!-- prose_107 -->
<g id="node108" class="node">
<title>prose_107</title>
<ellipse fill="none" stroke="#000000" cx="8330" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8330" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_98&#45;&gt;prose_107 -->
<g id="edge107" class="edge">
<title>section_98&#45;&gt;prose_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7962.4884,-2510.532C8022.4407,-2442.1268 8239.3517,-2194.6325 8308.596,-2115.6253"/>
<polygon fill="#000000" stroke="#000000" points="8311.6033,-2117.5041 8315.5623,-2107.6767 8306.3389,-2112.8903 8311.6033,-2117.5041"/>
</g>
<!-- codeblock_108 -->
<g id="node109" class="node">
<title>codeblock_108</title>
<ellipse fill="none" stroke="#000000" cx="8664" cy="-2091.2034" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="8664" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 311&#45;325</text>
</g>
<!-- section_98&#45;&gt;codeblock_108 -->
<g id="edge108" class="edge">
<title>section_98&#45;&gt;codeblock_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8016.278,-2521.0343C8104.3078,-2509.3616 8258.3295,-2480.179 8371,-2411.204 8500.2406,-2332.085 8607.2951,-2179.7041 8647.2225,-2118.0627"/>
<polygon fill="#000000" stroke="#000000" points="8650.3838,-2119.6167 8652.8348,-2109.3092 8644.4909,-2115.8385 8650.3838,-2119.6167"/>
</g>
<!-- header_131 -->
<g id="node132" class="node">
<title>header_131</title>
<ellipse fill="none" stroke="#000000" cx="9240" cy="-2091.2034" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9240" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_99&#45;&gt;header_131 -->
<g id="edge131" class="edge">
<title>section_99&#45;&gt;header_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9469.1853,-2510.2585C9432.0459,-2442.3507 9299.9523,-2200.8235 9255.0593,-2118.7387"/>
<polygon fill="#000000" stroke="#000000" points="9257.8983,-2116.6353 9250.0291,-2109.5411 9251.7567,-2119.9942 9257.8983,-2116.6353"/>
</g>
<!-- prose_132 -->
<g id="node133" class="node">
<title>prose_132</title>
<ellipse fill="none" stroke="#000000" cx="9479" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9479" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_99&#45;&gt;prose_132 -->
<g id="edge132" class="edge">
<title>section_99&#45;&gt;prose_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9479,-2509.9831C9479,-2441.9619 9479,-2202.5568 9479,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="9482.5001,-2119.5021 9479,-2109.5022 9475.5001,-2119.5022 9482.5001,-2119.5021"/>
</g>
<!-- prose_133 -->
<g id="node134" class="node">
<title>prose_133</title>
<ellipse fill="none" stroke="#000000" cx="9594" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9594" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_99&#45;&gt;prose_133 -->
<g id="edge133" class="edge">
<title>section_99&#45;&gt;prose_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9486.0167,-2510.1648C9494.7276,-2487.3538 9509.6925,-2446.7607 9520,-2411.204 9550.8742,-2304.7004 9577.5436,-2175.3494 9588.5805,-2119.32"/>
<polygon fill="#000000" stroke="#000000" points="9592.0309,-2119.9123 9590.5166,-2109.4262 9585.1612,-2118.5679 9592.0309,-2119.9123"/>
</g>
<!-- codeblock_134 -->
<g id="node135" class="node">
<title>codeblock_134</title>
<ellipse fill="none" stroke="#000000" cx="9863" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9863" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 337&#45;391</text>
</g>
<!-- section_99&#45;&gt;codeblock_134 -->
<g id="edge134" class="edge">
<title>section_99&#45;&gt;codeblock_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9506.3786,-2511.409C9539.2011,-2490.4729 9594.8048,-2452.3937 9635,-2411.204 9729.3215,-2314.549 9814.1165,-2176.0064 9847.7083,-2118.171"/>
<polygon fill="#000000" stroke="#000000" points="9850.8701,-2119.6944 9852.8353,-2109.2834 9844.8067,-2116.1966 9850.8701,-2119.6944"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7060.5,-992.0018 6547.5,-992.0018 6547.5,-921.4011 7060.5,-921.4011 7060.5,-992.0018"/>
<text text-anchor="middle" x="6804" y="-944.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6804" y="-929.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_101&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>raw_101&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7269.636,-2073.1249C7279.3159,-2019.3434 7299.8335,-1858.6766 7220,-1771.2027 7173.4916,-1720.2433 7120.0241,-1781.6402 7069,-1735.2027 6846.6834,-1532.8707 6810.8031,-1136.7546 6805.0702,-1002.4746"/>
<polygon fill="#000000" stroke="#000000" points="6808.5547,-1002.0063 6804.6677,-992.1503 6801.56,-1002.2791 6808.5547,-1002.0063"/>
</g>
<!-- leaf_104 -->
<g id="node105" class="node">
<title>leaf_104</title>
<polygon fill="none" stroke="#c0c0c0" points="7633.5,-999.9017 7078.5,-999.9017 7078.5,-913.5011 7633.5,-913.5011 7633.5,-999.9017"/>
<text text-anchor="middle" x="7356" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7356" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7356" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_103&#45;&gt;leaf_104 -->
<g id="edge104" class="edge">
<title>raw_103&#45;&gt;leaf_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7356,-2072.9235C7356,-1947.7025 7356,-1215.4273 7356,-1010.1671"/>
<polygon fill="#000000" stroke="#000000" points="7359.5001,-1009.9445 7356,-999.9445 7352.5001,-1009.9445 7359.5001,-1009.9445"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="7758.5,-974.7014 7651.5,-974.7014 7651.5,-938.7014 7758.5,-938.7014 7758.5,-974.7014"/>
<text text-anchor="middle" x="7705" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuzz_patt</text>
</g>
<!-- header_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>header_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7749.2749,-2072.9235C7744.0755,-1941.8395 7712.4897,-1145.5249 7706.1192,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="7709.6143,-984.7233 7705.7207,-974.8699 7702.6198,-985.0008 7709.6143,-984.7233"/>
</g>
<!-- raw_110 -->
<g id="node111" class="node">
<title>raw_110</title>
<ellipse fill="none" stroke="#000000" cx="7804" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7804" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_106&#45;&gt;raw_110 -->
<g id="edge110" class="edge">
<title>prose_106&#45;&gt;raw_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7939.9437,-2073.4251C7919.925,-2022.0376 7862.7531,-1868.4795 7840,-1735.2027 7790.5153,-1445.3455 7799.1049,-1086.5589 7802.8288,-984.7825"/>
<polygon fill="#000000" stroke="#000000" points="7806.3298,-984.8227 7803.2135,-974.6966 7799.3348,-984.5559 7806.3298,-984.8227"/>
</g>
<!-- prespace_111 -->
<g id="node112" class="node">
<title>prespace_111</title>
<ellipse fill="none" stroke="#000000" cx="7895" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7895" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_106&#45;&gt;prespace_111 -->
<g id="edge111" class="edge">
<title>prose_106&#45;&gt;prespace_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7946.1621,-2072.9235C7940.1539,-1941.8395 7903.6547,-1145.5249 7896.2933,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="7899.787,-984.6991 7895.8328,-974.8699 7892.7944,-985.0197 7899.787,-984.6991"/>
</g>
<!-- literal_112 -->
<g id="node113" class="node">
<title>literal_112</title>
<ellipse fill="none" stroke="#000000" cx="7991" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7991" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_106&#45;&gt;literal_112 -->
<g id="edge112" class="edge">
<title>prose_106&#45;&gt;literal_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7947.709,-2072.9235C7952.7929,-1941.8395 7983.6768,-1145.5249 7989.9057,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="7993.4051,-984.9981 7990.2954,-974.8699 7986.4104,-984.7267 7993.4051,-984.9981"/>
</g>
<!-- raw_113 -->
<g id="node114" class="node">
<title>raw_113</title>
<ellipse fill="none" stroke="#000000" cx="8067" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8067" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_106&#45;&gt;raw_113 -->
<g id="edge113" class="edge">
<title>prose_106&#45;&gt;raw_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7952.4835,-2073.2746C7968.0496,-2021.4852 8012.572,-1866.9588 8031,-1735.2027 8071.6856,-1444.3097 8069.256,-1086.9425 8067.5776,-985.0282"/>
<polygon fill="#000000" stroke="#000000" points="8071.0752,-984.8575 8067.3992,-974.9208 8064.0763,-984.9811 8071.0752,-984.8575"/>
</g>
<!-- prespace_118 -->
<g id="node119" class="node">
<title>prespace_118</title>
<ellipse fill="none" stroke="#000000" cx="8158" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8158" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_107&#45;&gt;prespace_118 -->
<g id="edge118" class="edge">
<title>prose_107&#45;&gt;prespace_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8322.4994,-2073.4615C8301.1952,-2022.1711 8240.1742,-1868.8471 8214,-1735.2027 8157.3985,-1446.1973 8156.5406,-1086.8162 8157.5728,-984.8408"/>
<polygon fill="#000000" stroke="#000000" points="8161.0737,-984.7749 8157.6906,-974.7348 8154.0742,-984.6933 8161.0737,-984.7749"/>
</g>
<!-- literal_119 -->
<g id="node120" class="node">
<title>literal_119</title>
<ellipse fill="none" stroke="#000000" cx="8254" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8254" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_107&#45;&gt;literal_119 -->
<g id="edge119" class="edge">
<title>prose_107&#45;&gt;literal_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8327.847,-2073.0777C8321.7021,-2020.7626 8303.8889,-1864.9697 8294,-1735.2027 8271.6758,-1442.2541 8258.4491,-1086.3176 8254.9441,-984.8857"/>
<polygon fill="#000000" stroke="#000000" points="8258.44,-984.7014 8254.5997,-974.8271 8251.4441,-984.941 8258.44,-984.7014"/>
</g>
<!-- raw_120 -->
<g id="node121" class="node">
<title>raw_120</title>
<ellipse fill="none" stroke="#000000" cx="8330" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8330" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_107&#45;&gt;raw_120 -->
<g id="edge120" class="edge">
<title>prose_107&#45;&gt;raw_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8330,-2072.9235C8330,-1941.8395 8330,-1145.5249 8330,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="8333.5001,-984.8699 8330,-974.8699 8326.5001,-984.8699 8333.5001,-984.8699"/>
</g>
<!-- prespace_121 -->
<g id="node122" class="node">
<title>prespace_121</title>
<ellipse fill="none" stroke="#000000" cx="8421" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8421" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_107&#45;&gt;prespace_121 -->
<g id="edge121" class="edge">
<title>prose_107&#45;&gt;prespace_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8332.0298,-2073.0678C8337.8456,-2020.7259 8354.8661,-1864.8688 8366,-1735.2027 8391.1643,-1442.1388 8413.201,-1086.2826 8419.3185,-984.8778"/>
<polygon fill="#000000" stroke="#000000" points="8422.8165,-985.0139 8419.9232,-974.8218 8415.8291,-984.5937 8422.8165,-985.0139"/>
</g>
<!-- literal_122 -->
<g id="node123" class="node">
<title>literal_122</title>
<ellipse fill="none" stroke="#000000" cx="8517" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8517" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_107&#45;&gt;literal_122 -->
<g id="edge122" class="edge">
<title>prose_107&#45;&gt;literal_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8339.666,-2073.7489C8367.0822,-2023.226 8445.3355,-1871.7508 8476,-1735.2027 8540.4506,-1448.2065 8525.0199,-1087.4232 8518.8878,-984.9783"/>
<polygon fill="#000000" stroke="#000000" points="8522.3705,-984.5893 8518.2588,-974.8249 8515.3839,-985.0222 8522.3705,-984.5893"/>
</g>
<!-- raw_123 -->
<g id="node124" class="node">
<title>raw_123</title>
<ellipse fill="none" stroke="#000000" cx="8593" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8593" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_107&#45;&gt;raw_123 -->
<g id="edge123" class="edge">
<title>prose_107&#45;&gt;raw_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8344.8491,-2075.0645C8387.5353,-2027.4943 8510.4928,-1881.9416 8557,-1735.2027 8646.0294,-1454.2984 8609.631,-1087.8911 8596.7831,-984.7771"/>
<polygon fill="#000000" stroke="#000000" points="8600.252,-984.3108 8595.5141,-974.8344 8593.3083,-985.1971 8600.252,-984.3108"/>
</g>
<!-- leaf_130 -->
<g id="node131" class="node">
<title>leaf_130</title>
<polygon fill="none" stroke="#c0c0c0" points="9081.5,-1053.6022 8638.5,-1053.6022 8638.5,-859.8007 9081.5,-859.8007 9081.5,-1053.6022"/>
<text text-anchor="middle" x="8860" y="-1038.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8860" y="-1006.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8860" y="-991.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8860" y="-976.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8860" y="-960.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8860" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8860" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8860" y="-914.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8860" y="-899.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8860" y="-883.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8860" y="-868.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_108&#45;&gt;leaf_130 -->
<g id="edge130" class="edge">
<title>codeblock_108&#45;&gt;leaf_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8667.1581,-2072.9235C8687.2013,-1956.9079 8797.268,-1319.8113 8841.5441,-1063.5293"/>
<polygon fill="#000000" stroke="#000000" points="8845.0294,-1063.9137 8843.283,-1053.4638 8838.1316,-1062.722 8845.0294,-1063.9137"/>
</g>
<!-- leaf_114 -->
<g id="node115" class="node">
<title>leaf_114</title>
<polygon fill="none" stroke="#c0c0c0" points="7540.5,-135.0015 7251.5,-135.0015 7251.5,-79.1986 7540.5,-79.1986 7540.5,-135.0015"/>
<text text-anchor="middle" x="7396" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_110&#45;&gt;leaf_114 -->
<g id="edge114" class="edge">
<title>raw_110&#45;&gt;leaf_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7806.0567,-938.5357C7817.6427,-832.5472 7870.6384,-294.7227 7767,-178.2001 7734.514,-141.6755 7597.962,-151.6356 7550,-142.2001 7541.594,-140.5464 7532.946,-138.7735 7524.2405,-136.9353"/>
<polygon fill="#000000" stroke="#000000" points="7524.9071,-133.4988 7514.3969,-134.8349 7523.4463,-140.3447 7524.9071,-133.4988"/>
</g>
<!-- leaf_115 -->
<g id="node116" class="node">
<title>leaf_115</title>
<polygon fill="none" stroke="#c0c0c0" points="7613,-125.1 7559,-125.1 7559,-89.1 7613,-89.1 7613,-125.1"/>
<text text-anchor="middle" x="7586" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_111&#45;&gt;leaf_115 -->
<g id="edge115" class="edge">
<title>prespace_111&#45;&gt;leaf_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7896.6018,-938.5035C7905.5384,-832.3313 7945.1596,-293.6392 7840,-178.2001 7773.8688,-105.6045 7709.6329,-186.5164 7622,-142.2001 7616.9367,-139.6396 7612.1238,-136.1165 7607.7605,-132.2847"/>
<polygon fill="#000000" stroke="#000000" points="7610.0551,-129.6347 7600.4352,-125.1953 7605.187,-134.6648 7610.0551,-129.6347"/>
</g>
<!-- leaf_116 -->
<g id="node117" class="node">
<title>leaf_116</title>
<polygon fill="none" stroke="#c0c0c0" points="7685,-125.1 7631,-125.1 7631,-89.1 7685,-89.1 7685,-125.1"/>
<text text-anchor="middle" x="7658" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_112&#45;&gt;leaf_116 -->
<g id="edge116" class="edge">
<title>literal_112&#45;&gt;leaf_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7992.9977,-938.4902C8004.2347,-832.2426 8055.3911,-293.1942 7950,-178.2001 7872.3691,-93.4957 7797.1458,-192.8195 7694,-142.2001 7688.9064,-139.7004 7684.0786,-136.2072 7679.7099,-132.3862"/>
<polygon fill="#000000" stroke="#000000" points="7682.0044,-129.7362 7672.3839,-125.2982 7677.137,-134.767 7682.0044,-129.7362"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="7922.5,-126.4006 7703.5,-126.4006 7703.5,-87.7995 7922.5,-87.7995 7922.5,-126.4006"/>
<text text-anchor="middle" x="7813" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7813" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_113&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>raw_113&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8068.8451,-938.4177C8079.1076,-832.8946 8125.3746,-302.1203 8031,-178.2001 8026.3853,-172.1407 7949.3581,-147.9102 7888.1585,-129.4036"/>
<polygon fill="#000000" stroke="#000000" points="7889.0704,-126.023 7878.4857,-126.4862 7887.049,-132.7248 7889.0704,-126.023"/>
</g>
<!-- leaf_124 -->
<g id="node125" class="node">
<title>leaf_124</title>
<polygon fill="none" stroke="#c0c0c0" points="7995,-125.1 7941,-125.1 7941,-89.1 7995,-89.1 7995,-125.1"/>
</g>
<!-- prespace_118&#45;&gt;leaf_124 -->
<g id="edge124" class="edge">
<title>prespace_118&#45;&gt;leaf_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8163.0908,-938.7515C8187.9892,-846.8733 8288.4286,-424.013 8103,-178.2001 8074.8048,-140.8232 8043.6487,-167.0996 8004,-142.2001 7999.4954,-139.3712 7995.0954,-135.9002 7991.0056,-132.2531"/>
<polygon fill="#000000" stroke="#000000" points="7993.222,-129.5297 7983.577,-125.1452 7988.3826,-134.5875 7993.222,-129.5297"/>
</g>
<!-- leaf_125 -->
<g id="node126" class="node">
<title>leaf_125</title>
<polygon fill="none" stroke="#c0c0c0" points="8176.5,-125.1 8013.5,-125.1 8013.5,-89.1 8176.5,-89.1 8176.5,-125.1"/>
<text text-anchor="middle" x="8095" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_119&#45;&gt;leaf_125 -->
<g id="edge125" class="edge">
<title>literal_119&#45;&gt;leaf_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8255.2728,-938.7115C8262.2978,-834.8416 8293.1851,-311.7985 8213,-178.2001 8200.0762,-156.6674 8177.903,-140.8372 8156.242,-129.6541"/>
<polygon fill="#000000" stroke="#000000" points="8157.5394,-126.3925 8147.0185,-125.1427 8154.4637,-132.6806 8157.5394,-126.3925"/>
</g>
<!-- leaf_126 -->
<g id="node127" class="node">
<title>leaf_126</title>
<polygon fill="none" stroke="#c0c0c0" points="8539.5,-126.4006 8194.5,-126.4006 8194.5,-87.7995 8539.5,-87.7995 8539.5,-126.4006"/>
<text text-anchor="middle" x="8367" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8367" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_120&#45;&gt;leaf_126 -->
<g id="edge126" class="edge">
<title>raw_120&#45;&gt;leaf_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8330.7899,-938.5632C8335.4958,-830.5056 8359.8303,-271.7321 8365.7169,-136.564"/>
<polygon fill="#000000" stroke="#000000" points="8369.2153,-136.6746 8366.1538,-126.5318 8362.2219,-136.37 8369.2153,-136.6746"/>
</g>
<!-- leaf_127 -->
<g id="node128" class="node">
<title>leaf_127</title>
<polygon fill="none" stroke="#c0c0c0" points="8612,-125.1 8558,-125.1 8558,-89.1 8612,-89.1 8612,-125.1"/>
<text text-anchor="middle" x="8585" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_121&#45;&gt;leaf_127 -->
<g id="edge127" class="edge">
<title>prespace_121&#45;&gt;leaf_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8416.3644,-938.5557C8394.1962,-847.4379 8306.9041,-434.0821 8477,-178.2001 8496.5861,-148.7359 8519.0853,-162.5886 8548,-142.2001 8552.2332,-139.2152 8556.4637,-135.7616 8560.4719,-132.2093"/>
<polygon fill="#000000" stroke="#000000" points="8562.9057,-134.7256 8567.8477,-125.354 8558.1401,-129.5982 8562.9057,-134.7256"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="8684,-125.1 8630,-125.1 8630,-89.1 8684,-89.1 8684,-125.1"/>
<text text-anchor="middle" x="8657" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_122&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>literal_122&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8515.6413,-938.676C8508.1294,-834.6063 8474.9171,-310.6287 8557,-178.2001 8574.1936,-150.4608 8594.8732,-161.7571 8621,-142.2001 8624.9832,-139.2185 8628.9774,-135.8245 8632.7802,-132.3496"/>
<polygon fill="#000000" stroke="#000000" points="8635.4405,-134.6486 8640.2523,-125.2095 8630.6044,-129.5877 8635.4405,-134.6486"/>
</g>
<!-- leaf_129 -->
<g id="node130" class="node">
<title>leaf_129</title>
<polygon fill="none" stroke="#c0c0c0" points="9138,-126.4006 8702,-126.4006 8702,-87.7995 9138,-87.7995 9138,-126.4006"/>
<text text-anchor="middle" x="8920" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8920" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_123&#45;&gt;leaf_129 -->
<g id="edge129" class="edge">
<title>raw_123&#45;&gt;leaf_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8591.0506,-938.651C8580.0721,-833.3184 8529.9002,-298.5942 8629,-178.2001 8647.2778,-155.9948 8704.0792,-139.7053 8762.7052,-128.3646"/>
<polygon fill="#000000" stroke="#000000" points="8763.712,-131.7366 8772.8912,-126.4459 8762.4161,-124.8576 8763.712,-131.7366"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9290.5,-974.7014 9099.5,-974.7014 9099.5,-938.7014 9290.5,-938.7014 9290.5,-974.7014"/>
<text text-anchor="middle" x="9195" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>header_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9239.2749,-2072.9235C9234.0755,-1941.8395 9202.4897,-1145.5249 9196.1192,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="9199.6143,-984.7233 9195.7207,-974.8699 9192.6198,-985.0008 9199.6143,-984.7233"/>
</g>
<!-- raw_136 -->
<g id="node137" class="node">
<title>raw_136</title>
<ellipse fill="none" stroke="#000000" cx="9336" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9336" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_132&#45;&gt;raw_136 -->
<g id="edge136" class="edge">
<title>prose_132&#45;&gt;raw_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9471.9437,-2073.4251C9451.925,-2022.0376 9394.7531,-1868.4795 9372,-1735.2027 9322.5153,-1445.3455 9331.1049,-1086.5589 9334.8288,-984.7825"/>
<polygon fill="#000000" stroke="#000000" points="9338.3298,-984.8227 9335.2135,-974.6966 9331.3348,-984.5559 9338.3298,-984.8227"/>
</g>
<!-- prespace_137 -->
<g id="node138" class="node">
<title>prespace_137</title>
<ellipse fill="none" stroke="#000000" cx="9427" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9427" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_132&#45;&gt;prespace_137 -->
<g id="edge137" class="edge">
<title>prose_132&#45;&gt;prespace_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9478.1621,-2072.9235C9472.1539,-1941.8395 9435.6547,-1145.5249 9428.2933,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="9431.787,-984.6991 9427.8328,-974.8699 9424.7944,-985.0197 9431.787,-984.6991"/>
</g>
<!-- literal_138 -->
<g id="node139" class="node">
<title>literal_138</title>
<ellipse fill="none" stroke="#000000" cx="9523" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9523" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_132&#45;&gt;literal_138 -->
<g id="edge138" class="edge">
<title>prose_132&#45;&gt;literal_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9479.709,-2072.9235C9484.7929,-1941.8395 9515.6768,-1145.5249 9521.9057,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="9525.4051,-984.9981 9522.2954,-974.8699 9518.4104,-984.7267 9525.4051,-984.9981"/>
</g>
<!-- raw_139 -->
<g id="node140" class="node">
<title>raw_139</title>
<ellipse fill="none" stroke="#000000" cx="9599" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9599" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_132&#45;&gt;raw_139 -->
<g id="edge139" class="edge">
<title>prose_132&#45;&gt;raw_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9482.8971,-2073.0931C9493.4774,-2024.2174 9523.9005,-1885.5946 9553,-1771.2027 9557.0939,-1755.1095 9560.3777,-1751.6002 9563,-1735.2027 9609.3834,-1445.1636 9602.9881,-1087.2021 9599.9724,-985.0874"/>
<polygon fill="#000000" stroke="#000000" points="9603.4668,-984.8467 9599.659,-974.9598 9596.4701,-985.0633 9603.4668,-984.8467"/>
</g>
<!-- raw_144 -->
<g id="node145" class="node">
<title>raw_144</title>
<ellipse fill="none" stroke="#000000" cx="9671" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9671" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_133&#45;&gt;raw_144 -->
<g id="edge144" class="edge">
<title>prose_133&#45;&gt;raw_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9596.5302,-2073.0926C9603.7373,-2020.8172 9624.5273,-1865.1201 9635,-1735.2027 9658.6007,-1442.4279 9668.0625,-1086.3705 9670.3935,-984.8978"/>
<polygon fill="#000000" stroke="#000000" points="9673.894,-984.9114 9670.6202,-974.835 9666.8957,-984.7536 9673.894,-984.9114"/>
</g>
<!-- leaf_146 -->
<g id="node147" class="node">
<title>leaf_146</title>
<polygon fill="none" stroke="#c0c0c0" points="10271.5,-1370.4029 9716.5,-1370.4029 9716.5,-542.9999 10271.5,-542.9999 10271.5,-1370.4029"/>
<text text-anchor="middle" x="9994" y="-1355.1022" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9994" y="-1339.7021" font-family="Inconsolata" font-size="14.00" fill="#000000">local gsub = assert(string.gsub)</text>
<text text-anchor="middle" x="9994" y="-1308.3021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="9994" y="-1292.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9994" y="-1277.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="9994" y="-1262.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9994" y="-1246.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9994" y="-1231.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9994" y="-1215.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9994" y="-1200.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9994" y="-1185.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="9994" y="-1169.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9994" y="-1154.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="9994" y="-1138.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9994" y="-1123.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9994" y="-1108.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9994" y="-1092.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="9994" y="-1077.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9994" y="-1061.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="9994" y="-1046.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9994" y="-1031.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9994" y="-1015.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="9994" y="-1000.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9994" y="-984.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9994" y="-969.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9994" y="-954.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9994" y="-938.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9994" y="-891.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="9994" y="-875.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9994" y="-860.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return c.alert &quot;No results found&quot;</text>
<text text-anchor="middle" x="9994" y="-845.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9994" y="-829.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="9994" y="-814.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="9994" y="-798.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local alt_seq = &quot; &#160;&#160;&#160;&quot;</text>
<text text-anchor="middle" x="9994" y="-783.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i &lt; 10 then</text>
<text text-anchor="middle" x="9994" y="-768.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alt_seq = a.bold(&quot;M&#45;&quot; .. tostring(i) .. &quot; &quot;)</text>
<text text-anchor="middle" x="9994" y="-752.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9994" y="-737.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local next_line = alt_seq</text>
<text text-anchor="middle" x="9994" y="-721.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="9994" y="-706.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="9994" y="-691.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i == collection.hl then</text>
<text text-anchor="middle" x="9994" y="-675.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next_line = c.highlight(next_line)</text>
<text text-anchor="middle" x="9994" y="-660.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9994" y="-644.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase .. next_line</text>
<text text-anchor="middle" x="9994" y="-629.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9994" y="-598.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="9994" y="-582.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9994" y="-551.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_134&#45;&gt;leaf_146 -->
<g id="edge146" class="edge">
<title>codeblock_134&#45;&gt;leaf_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9865.1108,-2072.9235C9874.4004,-1992.4723 9912.6238,-1661.4457 9945.0535,-1380.594"/>
<polygon fill="#000000" stroke="#000000" points="9948.5343,-1380.9604 9946.2046,-1370.6249 9941.5805,-1380.1574 9948.5343,-1380.9604"/>
</g>
<!-- leaf_140 -->
<g id="node141" class="node">
<title>leaf_140</title>
<polygon fill="none" stroke="#c0c0c0" points="9403.5,-135.0015 9156.5,-135.0015 9156.5,-79.1986 9403.5,-79.1986 9403.5,-135.0015"/>
<text text-anchor="middle" x="9280" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_136&#45;&gt;leaf_140 -->
<g id="edge140" class="edge">
<title>raw_136&#45;&gt;leaf_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9336.5622,-938.4528C9338.9142,-852.4306 9345.7926,-479.028 9299,-178.2001 9297.2886,-167.1975 9294.5405,-155.4464 9291.6599,-144.7314"/>
<polygon fill="#000000" stroke="#000000" points="9294.9551,-143.5189 9288.887,-134.834 9288.2146,-145.4074 9294.9551,-143.5189"/>
</g>
<!-- leaf_141 -->
<g id="node142" class="node">
<title>leaf_141</title>
<polygon fill="none" stroke="#c0c0c0" points="9476,-125.1 9422,-125.1 9422,-89.1 9476,-89.1 9476,-125.1"/>
<text text-anchor="middle" x="9449" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_137&#45;&gt;leaf_141 -->
<g id="edge141" class="edge">
<title>prespace_137&#45;&gt;leaf_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9427.4697,-938.5632C9430.2741,-830.2631 9444.8019,-269.2221 9448.2604,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="9451.7652,-135.5166 9448.5254,-125.4293 9444.7676,-135.3353 9451.7652,-135.5166"/>
</g>
<!-- leaf_142 -->
<g id="node143" class="node">
<title>leaf_142</title>
<polygon fill="none" stroke="#c0c0c0" points="9552,-125.1 9494,-125.1 9494,-89.1 9552,-89.1 9552,-125.1"/>
<text text-anchor="middle" x="9523" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_138&#45;&gt;leaf_142 -->
<g id="edge142" class="edge">
<title>literal_138&#45;&gt;leaf_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9523,-938.5632C9523,-830.2631 9523,-269.2221 9523,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="9526.5001,-135.4293 9523,-125.4293 9519.5001,-135.4293 9526.5001,-135.4293"/>
</g>
<!-- leaf_143 -->
<g id="node144" class="node">
<title>leaf_143</title>
<polygon fill="none" stroke="#c0c0c0" points="10097.5,-134.3005 9570.5,-134.3005 9570.5,-79.8996 10097.5,-79.8996 10097.5,-134.3005"/>
<text text-anchor="middle" x="9834" y="-119.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9834" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9834" y="-88.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_139&#45;&gt;leaf_143 -->
<g id="edge143" class="edge">
<title>raw_139&#45;&gt;leaf_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9597.2076,-938.4573C9587.2418,-833.1569 9542.3621,-303.4239 9635,-178.2001 9646.0161,-163.309 9679.3028,-149.1033 9715.5773,-137.359"/>
<polygon fill="#000000" stroke="#000000" points="9716.8774,-140.6189 9725.3598,-134.2708 9714.77,-133.9437 9716.8774,-140.6189"/>
</g>
<!-- leaf_145 -->
<g id="node146" class="node">
<title>leaf_145</title>
<polygon fill="none" stroke="#c0c0c0" points="10628.5,-134.4005 10115.5,-134.4005 10115.5,-79.7996 10628.5,-79.7996 10628.5,-134.4005"/>
<text text-anchor="middle" x="10372" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10372" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_144&#45;&gt;leaf_145 -->
<g id="edge145" class="edge">
<title>raw_144&#45;&gt;leaf_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9668.791,-938.4204C9656.3344,-831.7754 9599.1772,-290.8489 9707,-178.2001 9737.7794,-146.0431 10061.7585,-147.1128 10106,-142.2001 10124.0519,-140.1956 10142.7758,-137.9874 10161.5481,-135.684"/>
<polygon fill="#000000" stroke="#000000" points="10162.1752,-139.1333 10171.6707,-134.4336 10161.317,-132.1861 10162.1752,-139.1333"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="10565.5,-2109.2034 10374.5,-2109.2034 10374.5,-2073.2034 10565.5,-2073.2034 10565.5,-2109.2034"/>
<text text-anchor="middle" x="10470" y="-2087.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_147&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>header_147&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10551.4559,-2509.9831C10538.2117,-2441.8925 10491.564,-2202.0681 10475.4912,-2119.4346"/>
<polygon fill="#000000" stroke="#000000" points="10478.9042,-2118.6499 10473.5593,-2109.5022 10472.033,-2119.9865 10478.9042,-2118.6499"/>
</g>
<!-- raw_156 -->
<g id="node157" class="node">
<title>raw_156</title>
<ellipse fill="none" stroke="#000000" cx="10611" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="10611" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_148&#45;&gt;raw_156 -->
<g id="edge156" class="edge">
<title>prose_148&#45;&gt;raw_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10772.8337,-2516.7184C10737.967,-2499.3364 10675.9922,-2462.8159 10647,-2411.204 10593.1282,-2315.3016 10600.7997,-2177.7903 10607.2359,-2119.2783"/>
<polygon fill="#000000" stroke="#000000" points="10610.7174,-2119.6402 10608.4082,-2109.3001 10603.7652,-2118.8233 10610.7174,-2119.6402"/>
</g>
<!-- prespace_157 -->
<g id="node158" class="node">
<title>prespace_157</title>
<ellipse fill="none" stroke="#000000" cx="10702" cy="-2091.2034" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10702" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_148&#45;&gt;prespace_157 -->
<g id="edge157" class="edge">
<title>prose_148&#45;&gt;prespace_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10791.025,-2510.6263C10782.2562,-2487.9605 10767.236,-2447.1748 10758,-2411.204 10730.7799,-2305.1916 10712.6482,-2176.0177 10705.4678,-2119.7178"/>
<polygon fill="#000000" stroke="#000000" points="10708.8981,-2118.9433 10704.1783,-2109.4579 10701.9528,-2119.8163 10708.8981,-2118.9433"/>
</g>
<!-- literal_158 -->
<g id="node159" class="node">
<title>literal_158</title>
<ellipse fill="none" stroke="#000000" cx="10798" cy="-2091.2034" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10798" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_148&#45;&gt;literal_158 -->
<g id="edge158" class="edge">
<title>prose_148&#45;&gt;literal_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10798,-2509.9831C10798,-2441.9619 10798,-2202.5568 10798,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="10801.5001,-2119.5021 10798,-2109.5022 10794.5001,-2119.5022 10801.5001,-2119.5021"/>
</g>
<!-- raw_159 -->
<g id="node160" class="node">
<title>raw_159</title>
<ellipse fill="none" stroke="#000000" cx="10876" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="10876" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_148&#45;&gt;raw_159 -->
<g id="edge159" class="edge">
<title>prose_148&#45;&gt;raw_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10805.4468,-2510.3087C10814.5655,-2487.6461 10829.8051,-2447.206 10838,-2411.204 10862.0967,-2305.3416 10871.4968,-2176.0903 10874.6348,-2119.7441"/>
<polygon fill="#000000" stroke="#000000" points="10878.1448,-2119.6474 10875.1814,-2109.4755 10871.1547,-2119.2752 10878.1448,-2119.6474"/>
</g>
<!-- raw_164 -->
<g id="node165" class="node">
<title>raw_164</title>
<ellipse fill="none" stroke="#000000" cx="11316" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="11316" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_149&#45;&gt;raw_164 -->
<g id="edge164" class="edge">
<title>prose_149&#45;&gt;raw_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11381.2075,-2510.2585C11370.6729,-2442.5577 11333.2865,-2202.2946 11320.4022,-2119.4939"/>
<polygon fill="#000000" stroke="#000000" points="11323.8495,-2118.884 11318.8535,-2109.5411 11316.9327,-2119.9604 11323.8495,-2118.884"/>
</g>
<!-- raw_166 -->
<g id="node167" class="node">
<title>raw_166</title>
<ellipse fill="none" stroke="#000000" cx="11501" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="11501" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_150&#45;&gt;raw_166 -->
<g id="edge166" class="edge">
<title>prose_150&#45;&gt;raw_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11496.2085,-2509.9831C11496.9868,-2441.9619 11499.7259,-2202.5568 11500.6741,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="11504.1759,-2119.5416 11500.7906,-2109.5022 11497.1764,-2119.4614 11504.1759,-2119.5416"/>
</g>
<!-- raw_168 -->
<g id="node169" class="node">
<title>raw_168</title>
<ellipse fill="none" stroke="#000000" cx="11585" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="11585" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_151&#45;&gt;raw_168 -->
<g id="edge168" class="edge">
<title>prose_151&#45;&gt;raw_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11578.2919,-2509.9831C11579.3815,-2441.9619 11583.2163,-2202.5568 11584.5437,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="11588.0462,-2119.557 11584.7069,-2109.5022 11581.0471,-2119.4448 11588.0462,-2119.557"/>
</g>
<!-- raw_170 -->
<g id="node171" class="node">
<title>raw_170</title>
<ellipse fill="none" stroke="#000000" cx="11665" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="11665" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_152&#45;&gt;raw_170 -->
<g id="edge170" class="edge">
<title>prose_152&#45;&gt;raw_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11660.2085,-2509.9831C11660.9868,-2441.9619 11663.7259,-2202.5568 11664.6741,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="11668.1759,-2119.5416 11664.7906,-2109.5022 11661.1764,-2119.4614 11668.1759,-2119.5416"/>
</g>
<!-- raw_172 -->
<g id="node173" class="node">
<title>raw_172</title>
<ellipse fill="none" stroke="#000000" cx="11742" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="11742" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_153&#45;&gt;raw_172 -->
<g id="edge172" class="edge">
<title>prose_153&#45;&gt;raw_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11742,-2509.9831C11742,-2441.9619 11742,-2202.5568 11742,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="11745.5001,-2119.5021 11742,-2109.5022 11738.5001,-2119.5022 11745.5001,-2119.5021"/>
</g>
<!-- leaf_174 -->
<g id="node175" class="node">
<title>leaf_174</title>
<polygon fill="none" stroke="#c0c0c0" points="12342.5,-2411.2046 11787.5,-2411.2046 11787.5,-1771.2021 12342.5,-1771.2021 12342.5,-2411.2046"/>
<text text-anchor="middle" x="12065" y="-2396.004" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="12065" y="-2380.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.last_collection</text>
<text text-anchor="middle" x="12065" y="-2365.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;and historian.last_collection.frag == frag then</text>
<text text-anchor="middle" x="12065" y="-2349.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return historian.last_collection</text>
<text text-anchor="middle" x="12065" y="-2334.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="12065" y="-2319.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="12065" y="-2303.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="12065" y="-2288.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if frag == &quot;&quot; then</text>
<text text-anchor="middle" x="12065" y="-2272.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return collection, false</text>
<text text-anchor="middle" x="12065" y="-2257.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="12065" y="-2242.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="12065" y="-2226.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="12065" y="-2211.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="12065" y="-2195.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="12065" y="-2180.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="12065" y="-2165.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="12065" y="-2149.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="12065" y="-2118.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="12065" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12065" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="12065" y="-2072.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="12065" y="-2056.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="12065" y="-2041.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="12065" y="-2025.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="12065" y="-2010.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="12065" y="-1995.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="12065" y="-1979.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="12065" y="-1964.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="12065" y="-1948.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="12065" y="-1933.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="12065" y="-1918.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="12065" y="-1902.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12065" y="-1887.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12065" y="-1871.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="12065" y="-1856.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="12065" y="-1841.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="12065" y="-1825.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.hl = 1</text>
<text text-anchor="middle" x="12065" y="-1810.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.last_collection = collection</text>
<text text-anchor="middle" x="12065" y="-1794.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="12065" y="-1779.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_154&#45;&gt;leaf_174 -->
<g id="edge174" class="edge">
<title>codeblock_154&#45;&gt;leaf_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11975.8777,-2509.9831C11979.8787,-2491.1827 11986.666,-2459.2898 11994.766,-2421.2282"/>
<polygon fill="#000000" stroke="#000000" points="11998.1944,-2421.9324 11996.8527,-2411.4229 11991.3478,-2420.4753 11998.1944,-2421.9324"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="10656,-984.6029 10290,-984.6029 10290,-928.7999 10656,-928.7999 10656,-984.6029"/>
<text text-anchor="middle" x="10473" y="-937.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_156&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_156&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10608.9659,-2073.1538C10603.4634,-2024.4289 10587.7716,-1886.1471 10574,-1771.2027 10538.1252,-1471.7754 10492.5362,-1110.742 10477.8149,-994.6189"/>
<polygon fill="#000000" stroke="#000000" points="10481.258,-993.9488 10476.5276,-984.4687 10474.3136,-994.8296 10481.258,-993.9488"/>
</g>
<!-- leaf_161 -->
<g id="node162" class="node">
<title>leaf_161</title>
<polygon fill="none" stroke="#c0c0c0" points="10728,-974.7014 10674,-974.7014 10674,-938.7014 10728,-938.7014 10728,-974.7014"/>
<text text-anchor="middle" x="10701" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_157&#45;&gt;leaf_161 -->
<g id="edge161" class="edge">
<title>prespace_157&#45;&gt;leaf_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10701.9839,-2072.9235C10701.8683,-1941.8395 10701.1664,-1145.5249 10701.0249,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="10704.5249,-984.8668 10701.016,-974.8699 10697.5249,-984.873 10704.5249,-984.8668"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="10832,-974.7014 10746,-974.7014 10746,-938.7014 10832,-938.7014 10832,-974.7014"/>
<text text-anchor="middle" x="10789" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_158&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>literal_158&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10797.855,-2072.9235C10796.8151,-1941.8395 10790.4979,-1145.5249 10789.2238,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="10792.7234,-984.8418 10789.1441,-974.8699 10785.7237,-984.8974 10792.7234,-984.8418"/>
</g>
<!-- leaf_163 -->
<g id="node164" class="node">
<title>leaf_163</title>
<polygon fill="none" stroke="#c0c0c0" points="10904,-974.7014 10850,-974.7014 10850,-938.7014 10904,-938.7014 10904,-974.7014"/>
<text text-anchor="middle" x="10877" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_159&#45;&gt;leaf_163 -->
<g id="edge163" class="edge">
<title>raw_159&#45;&gt;leaf_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10876.0161,-2072.9235C10876.1317,-1941.8395 10876.8336,-1145.5249 10876.9751,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="10880.4751,-984.873 10876.984,-974.8699 10873.4751,-984.8668 10880.4751,-984.873"/>
</g>
<!-- leaf_165 -->
<g id="node166" class="node">
<title>leaf_165</title>
<polygon fill="none" stroke="#c0c0c0" points="11435.5,-976.6035 10922.5,-976.6035 10922.5,-936.7993 11435.5,-936.7993 11435.5,-976.6035"/>
<text text-anchor="middle" x="11179" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_164&#45;&gt;leaf_165 -->
<g id="edge165" class="edge">
<title>raw_164&#45;&gt;leaf_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11313.7926,-2072.9235C11298.0304,-1942.3967 11202.618,-1152.2829 11182.6589,-987.0006"/>
<polygon fill="#000000" stroke="#000000" points="11186.0781,-986.1209 11181.4044,-976.6127 11179.1286,-986.9602 11186.0781,-986.1209"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="11616.5,-976.6035 11453.5,-976.6035 11453.5,-936.7993 11616.5,-936.7993 11616.5,-976.6035"/>
<text text-anchor="middle" x="11535" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_166&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>raw_166&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11501.5478,-2072.9235C11505.4596,-1942.3967 11529.1386,-1152.2829 11534.092,-987.0006"/>
<polygon fill="#000000" stroke="#000000" points="11537.6021,-986.7131 11534.4033,-976.6127 11530.6052,-986.5033 11537.6021,-986.7131"/>
</g>
<!-- leaf_169 -->
<g id="node170" class="node">
<title>leaf_169</title>
<polygon fill="none" stroke="#c0c0c0" points="12161.5,-991.9018 11634.5,-991.9018 11634.5,-921.501 12161.5,-921.501 12161.5,-991.9018"/>
<text text-anchor="middle" x="11898" y="-960.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11898" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11898" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_168&#45;&gt;leaf_169 -->
<g id="edge169" class="edge">
<title>raw_168&#45;&gt;leaf_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11586.3374,-2072.9492C11590.1956,-2023.7164 11602.783,-1884.2857 11629,-1771.2027 11698.6677,-1470.7019 11831.7105,-1123.2339 11879.9573,-1001.5461"/>
<polygon fill="#000000" stroke="#000000" points="11883.246,-1002.7476 11883.6875,-992.1619 11876.7411,-1000.1618 11883.246,-1002.7476"/>
</g>
<!-- leaf_171 -->
<g id="node172" class="node">
<title>leaf_171</title>
<polygon fill="none" stroke="#c0c0c0" points="12608.5,-976.6035 12179.5,-976.6035 12179.5,-936.7993 12608.5,-936.7993 12608.5,-976.6035"/>
<text text-anchor="middle" x="12394" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection</text>
</g>
<!-- raw_170&#45;&gt;leaf_171 -->
<g id="edge171" class="edge">
<title>raw_170&#45;&gt;leaf_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11660.5925,-2073.3461C11648.308,-2018.7879 11619.965,-1853.0401 11706,-1771.2027 11780.9349,-1699.9239 12089.8455,-1800.5568 12170,-1735.2027 12409.9404,-1539.5671 12402.8656,-1104.7639 12396.1716,-986.7514"/>
<polygon fill="#000000" stroke="#000000" points="12399.6573,-986.4097 12395.5533,-976.642 12392.6704,-986.837 12399.6573,-986.4097"/>
</g>
<!-- leaf_173 -->
<g id="node174" class="node">
<title>leaf_173</title>
<polygon fill="none" stroke="#c0c0c0" points="13133,-984.0018 12627,-984.0018 12627,-929.401 13133,-929.401 13133,-984.0018"/>
<text text-anchor="middle" x="12880" y="-952.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="12880" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_172&#45;&gt;leaf_173 -->
<g id="edge173" class="edge">
<title>raw_172&#45;&gt;leaf_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11737.1453,-2073.2595C11723.5243,-2018.4519 11691.3462,-1852.0627 11778,-1771.2027 11846.2199,-1707.5441 12542.3784,-1791.2206 12617,-1735.2027 12863.3557,-1550.2656 12881.233,-1123.443 12880.7938,-994.3575"/>
<polygon fill="#000000" stroke="#000000" points="12884.2925,-994.1622 12880.718,-984.1886 12877.2927,-994.2145 12884.2925,-994.1622"/>
</g>
<!-- leaf_181 -->
<g id="node182" class="node">
<title>leaf_181</title>
<polygon fill="none" stroke="#c0c0c0" points="13019.5,-2109.2034 12870.5,-2109.2034 12870.5,-2073.2034 13019.5,-2073.2034 13019.5,-2109.2034"/>
<text text-anchor="middle" x="12945" y="-2087.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_175&#45;&gt;leaf_181 -->
<g id="edge181" class="edge">
<title>header_175&#45;&gt;leaf_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12965.1244,-2509.9831C12961.8556,-2441.9619 12950.3511,-2202.5568 12946.3688,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="12949.8554,-2119.3226 12945.8793,-2109.5022 12942.8635,-2119.6587 12949.8554,-2119.3226"/>
</g>
<!-- raw_182 -->
<g id="node183" class="node">
<title>raw_182</title>
<ellipse fill="none" stroke="#000000" cx="13065" cy="-2091.2034" rx="27" ry="18"/>
<text text-anchor="middle" x="13065" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_176&#45;&gt;raw_182 -->
<g id="edge182" class="edge">
<title>prose_176&#45;&gt;raw_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13133.5174,-2510.3168C13124.3616,-2487.6625 13109.0838,-2447.2311 13101,-2411.204 13077.2468,-2305.3433 13068.8188,-2176.0911 13066.131,-2119.7444"/>
<polygon fill="#000000" stroke="#000000" points="13069.6149,-2119.3075 13065.6671,-2109.4757 13062.622,-2119.6234 13069.6149,-2119.3075"/>
</g>
<!-- leaf_184 -->
<g id="node185" class="node">
<title>leaf_184</title>
<polygon fill="none" stroke="#c0c0c0" points="13490,-2192.5837 13110,-2192.5837 13110,-1989.823 13490,-1989.823 13490,-2192.5837"/>
<text text-anchor="middle" x="13300" y="-2177.4435" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="13300" y="-2162.0435" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13300" y="-2146.6435" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13300" y="-2131.2434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13300" y="-2115.8434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="13300" y="-2097.0834" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; ]</text>
<text text-anchor="middle" x="13300" y="-2078.3234" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="13300" y="-2062.9234" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13300" y="-2047.5233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; </text>
<text text-anchor="middle" x="13300" y="-2028.7633" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13300" y="-2013.3633" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="13300" y="-1997.9633" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_177&#45;&gt;leaf_184 -->
<g id="edge184" class="edge">
<title>codeblock_177&#45;&gt;leaf_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13300,-2509.9831C13300,-2458.4208 13300,-2308.3787 13300,-2202.6914"/>
<polygon fill="#000000" stroke="#000000" points="13303.5001,-2202.6069 13300,-2192.6069 13296.5001,-2202.6069 13303.5001,-2202.6069"/>
</g>
<!-- header_185 -->
<g id="node186" class="node">
<title>header_185</title>
<ellipse fill="none" stroke="#000000" cx="13590" cy="-2091.2034" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="13590" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_178&#45;&gt;header_185 -->
<g id="edge185" class="edge">
<title>section_178&#45;&gt;header_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13654.2064,-2509.9831C13643.7669,-2441.8925 13606.9975,-2202.0681 13594.3284,-2119.4346"/>
<polygon fill="#000000" stroke="#000000" points="13597.7807,-2118.8562 13592.8055,-2109.5022 13590.8615,-2119.9171 13597.7807,-2118.8562"/>
</g>
<!-- prose_186 -->
<g id="node187" class="node">
<title>prose_186</title>
<ellipse fill="none" stroke="#000000" cx="13723" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13723" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_178&#45;&gt;prose_186 -->
<g id="edge186" class="edge">
<title>section_178&#45;&gt;prose_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13661.148,-2510.0407C13666.2891,-2487.1016 13675.0922,-2446.3763 13681,-2411.204 13699.0119,-2303.9688 13713.851,-2175.426 13719.9771,-2119.503"/>
<polygon fill="#000000" stroke="#000000" points="13723.4834,-2119.6342 13721.0845,-2109.3145 13716.5244,-2118.8777 13723.4834,-2119.6342"/>
</g>
<!-- codeblock_187 -->
<g id="node188" class="node">
<title>codeblock_187</title>
<ellipse fill="none" stroke="#000000" cx="13931" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13931" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 480&#45;501</text>
</g>
<!-- section_178&#45;&gt;codeblock_187 -->
<g id="edge187" class="edge">
<title>section_178&#45;&gt;codeblock_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13676.0257,-2510.4411C13698.7815,-2488.5522 13737.159,-2449.5349 13764,-2411.204 13834.5307,-2310.4807 13895.0517,-2176.1647 13919.4713,-2118.9262"/>
<polygon fill="#000000" stroke="#000000" points="13922.7976,-2120.0469 13923.4738,-2109.4737 13916.3516,-2117.3175 13922.7976,-2120.0469"/>
</g>
<!-- header_198 -->
<g id="node199" class="node">
<title>header_198</title>
<ellipse fill="none" stroke="#000000" cx="14308" cy="-2091.2034" rx="111.1981" ry="18"/>
<text text-anchor="middle" x="14308" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:index(cursor)</text>
</g>
<!-- section_179&#45;&gt;header_198 -->
<g id="edge198" class="edge">
<title>section_179&#45;&gt;header_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14385.6227,-2509.9831C14373.0018,-2441.8925 14328.5493,-2202.0681 14313.2328,-2119.4346"/>
<polygon fill="#000000" stroke="#000000" points="14316.6557,-2118.6968 14311.3918,-2109.5022 14309.773,-2119.9726 14316.6557,-2118.6968"/>
</g>
<!-- prose_199 -->
<g id="node200" class="node">
<title>prose_199</title>
<ellipse fill="none" stroke="#000000" cx="14470" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14470" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_179&#45;&gt;prose_199 -->
<g id="edge199" class="edge">
<title>section_179&#45;&gt;prose_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14396.1744,-2510.2724C14404.9762,-2487.5725 14419.7431,-2447.0938 14428,-2411.204 14452.3794,-2305.2349 14463.9322,-2176.0386 14468.0953,-2119.7253"/>
<polygon fill="#000000" stroke="#000000" points="14471.6069,-2119.6876 14468.831,-2109.4629 14464.6248,-2119.187 14471.6069,-2119.6876"/>
</g>
<!-- codeblock_200 -->
<g id="node201" class="node">
<title>codeblock_200</title>
<ellipse fill="none" stroke="#000000" cx="14670" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14670" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 508&#45;521</text>
</g>
<!-- section_179&#45;&gt;codeblock_200 -->
<g id="edge200" class="edge">
<title>section_179&#45;&gt;codeblock_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14411.5182,-2510.6975C14437.8704,-2489.3573 14481.6318,-2451.1693 14511,-2411.204 14583.2536,-2312.8787 14638.3398,-2176.742 14659.9861,-2118.9399"/>
<polygon fill="#000000" stroke="#000000" points="14663.3281,-2119.9937 14663.52,-2109.4006 14656.7641,-2117.562 14663.3281,-2119.9937"/>
</g>
<!-- header_205 -->
<g id="node206" class="node">
<title>header_205</title>
<ellipse fill="none" stroke="#000000" cx="15159" cy="-2091.2034" rx="184.6938" ry="18"/>
<text text-anchor="middle" x="15159" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append(txtbuf, results, success)</text>
</g>
<!-- section_180&#45;&gt;header_205 -->
<g id="edge205" class="edge">
<title>section_180&#45;&gt;header_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15454.3189,-2510.6781C15428.3469,-2489.0224 15384.4142,-2450.2347 15353,-2411.204 15272.7126,-2311.4507 15201.0573,-2175.6147 15172.3337,-2118.3874"/>
<polygon fill="#000000" stroke="#000000" points="15175.3807,-2116.6544 15167.7863,-2109.2668 15169.1161,-2119.7779 15175.3807,-2116.6544"/>
</g>
<!-- prose_206 -->
<g id="node207" class="node">
<title>prose_206</title>
<ellipse fill="none" stroke="#000000" cx="15394" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15394" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_180&#45;&gt;prose_206 -->
<g id="edge206" class="edge">
<title>section_180&#45;&gt;prose_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15468.2432,-2509.9197C15458.9188,-2487.1923 15443.4711,-2447.0212 15435,-2411.204 15409.9829,-2305.4281 15399.3339,-2176.1321 15395.6454,-2119.7593"/>
<polygon fill="#000000" stroke="#000000" points="15399.1201,-2119.2458 15394.9983,-2109.4856 15392.134,-2119.6859 15399.1201,-2119.2458"/>
</g>
<!-- prose_207 -->
<g id="node208" class="node">
<title>prose_207</title>
<ellipse fill="none" stroke="#000000" cx="15476" cy="-2091.2034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15476" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_180&#45;&gt;prose_207 -->
<g id="edge207" class="edge">
<title>section_180&#45;&gt;prose_207</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15476,-2509.9831C15476,-2441.9619 15476,-2202.5568 15476,-2119.6878"/>
<polygon fill="#000000" stroke="#000000" points="15479.5001,-2119.5021 15476,-2109.5022 15472.5001,-2119.5022 15479.5001,-2119.5021"/>
</g>
<!-- codeblock_208 -->
<g id="node209" class="node">
<title>codeblock_208</title>
<ellipse fill="none" stroke="#000000" cx="15665" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15665" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 529&#45;544</text>
</g>
<!-- section_180&#45;&gt;codeblock_208 -->
<g id="edge208" class="edge">
<title>section_180&#45;&gt;codeblock_208</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15483.7614,-2510.2585C15513.1311,-2442.3507 15617.59,-2200.8235 15653.0912,-2118.7387"/>
<polygon fill="#000000" stroke="#000000" points="15656.3118,-2120.1089 15657.069,-2109.5411 15649.887,-2117.3301 15656.3118,-2120.1089"/>
</g>
<!-- codeblock_209 -->
<g id="node210" class="node">
<title>codeblock_209</title>
<ellipse fill="none" stroke="#000000" cx="15975" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15975" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 546&#45;553</text>
</g>
<!-- section_180&#45;&gt;codeblock_209 -->
<g id="edge209" class="edge">
<title>section_180&#45;&gt;codeblock_209</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15531.1445,-2515.9013C15592.5381,-2500.0157 15692.1633,-2467.493 15761,-2411.204 15864.1659,-2326.8435 15936.4511,-2179.7588 15963.3719,-2118.843"/>
<polygon fill="#000000" stroke="#000000" points="15966.6586,-2120.062 15967.4437,-2109.4963 15960.2411,-2117.2662 15966.6586,-2120.062"/>
</g>
<!-- codeblock_210 -->
<g id="node211" class="node">
<title>codeblock_210</title>
<ellipse fill="none" stroke="#000000" cx="16286" cy="-2091.2034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="16286" y="-2087.0034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 555&#45;557</text>
</g>
<!-- section_180&#45;&gt;codeblock_210 -->
<g id="edge210" class="edge">
<title>section_180&#45;&gt;codeblock_210</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15545.6277,-2521.2345C15683.4924,-2506.365 15985.2999,-2468.1738 16071,-2411.204 16182.9344,-2336.7948 16251.5582,-2182.2085 16275.9409,-2119.0247"/>
<polygon fill="#000000" stroke="#000000" points="16279.3354,-2119.9433 16279.6015,-2109.3518 16272.7886,-2117.4656 16279.3354,-2119.9433"/>
</g>
<!-- leaf_183 -->
<g id="node184" class="node">
<title>leaf_183</title>
<polygon fill="none" stroke="#c0c0c0" points="13205,-974.7014 13151,-974.7014 13151,-938.7014 13205,-938.7014 13205,-974.7014"/>
</g>
<!-- raw_182&#45;&gt;leaf_183 -->
<g id="edge183" class="edge">
<title>raw_182&#45;&gt;leaf_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13062.6867,-2072.9134C13057.1016,-2021.8154 13047.0557,-1874.5335 13101,-1771.2027 13112.2224,-1749.7061 13131.491,-1757.057 13142,-1735.2027 13270.1152,-1468.7784 13205.7623,-1090.0313 13184.1574,-984.7767"/>
<polygon fill="#000000" stroke="#000000" points="13187.5677,-983.9859 13182.0922,-974.9157 13180.7164,-985.4208 13187.5677,-983.9859"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13453,-974.7014 13297,-974.7014 13297,-938.7014 13453,-938.7014 13453,-974.7014"/>
<text text-anchor="middle" x="13375" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_185&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>header_185&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13588.1382,-2072.9215C13582.2661,-2021.8446 13560.7168,-1874.6121 13499,-1771.2027 13487.2416,-1751.501 13472.0869,-1755.8103 13462,-1735.2027 13331.4941,-1468.5794 13360.2885,-1090.6584 13371.6089,-985.066"/>
<polygon fill="#000000" stroke="#000000" points="13375.1132,-985.2207 13372.7373,-974.8957 13368.1559,-984.4487 13375.1132,-985.2207"/>
</g>
<!-- raw_189 -->
<g id="node190" class="node">
<title>raw_189</title>
<ellipse fill="none" stroke="#000000" cx="13498" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13498" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_186&#45;&gt;raw_189 -->
<g id="edge189" class="edge">
<title>prose_186&#45;&gt;raw_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13726.8761,-2073.1789C13737.2677,-2019.548 13759.8923,-1859.2586 13681,-1771.2027 13636.1154,-1721.1047 13576.7339,-1787.1475 13534,-1735.2027 13437.7381,-1618.1925 13482.3579,-1110.0328 13495.0293,-984.7138"/>
<polygon fill="#000000" stroke="#000000" points="13498.5125,-985.0561 13496.0516,-974.7511 13491.549,-984.3416 13498.5125,-985.0561"/>
</g>
<!-- prespace_190 -->
<g id="node191" class="node">
<title>prespace_190</title>
<ellipse fill="none" stroke="#000000" cx="13589" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13589" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_186&#45;&gt;prespace_190 -->
<g id="edge190" class="edge">
<title>prose_186&#45;&gt;prespace_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13724.5333,-2073.064C13728.0272,-2022.3566 13732.6505,-1875.9919 13681,-1771.2027 13670.9962,-1750.9069 13654.404,-1755.7834 13645,-1735.2027 13522.0753,-1466.181 13568.0596,-1089.9515 13584.2817,-984.9098"/>
<polygon fill="#000000" stroke="#000000" points="13587.7765,-985.2177 13585.8833,-974.7934 13580.8626,-984.123 13587.7765,-985.2177"/>
</g>
<!-- literal_191 -->
<g id="node192" class="node">
<title>literal_191</title>
<ellipse fill="none" stroke="#000000" cx="13685" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13685" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_186&#45;&gt;literal_191 -->
<g id="edge191" class="edge">
<title>prose_186&#45;&gt;literal_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13722.3877,-2072.9235C13717.9971,-1941.8395 13691.3246,-1145.5249 13685.9451,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="13689.4414,-984.7471 13685.6086,-974.8699 13682.4454,-984.9815 13689.4414,-984.7471"/>
</g>
<!-- raw_192 -->
<g id="node193" class="node">
<title>raw_192</title>
<ellipse fill="none" stroke="#000000" cx="13761" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13761" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_186&#45;&gt;raw_192 -->
<g id="edge192" class="edge">
<title>prose_186&#45;&gt;raw_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13723.6123,-2072.9235C13728.0029,-1941.8395 13754.6754,-1145.5249 13760.0549,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="13763.5546,-984.9815 13760.3914,-974.8699 13756.5586,-984.7471 13763.5546,-984.9815"/>
</g>
<!-- leaf_197 -->
<g id="node198" class="node">
<title>leaf_197</title>
<polygon fill="none" stroke="#c0c0c0" points="14194.4016,-1121.6422 13805.5984,-1121.6422 13805.5984,-791.7606 14194.4016,-791.7606 14194.4016,-1121.6422"/>
<text text-anchor="middle" x="14000" y="-1106.2217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="14000" y="-1090.8216" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="14000" y="-1072.0616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="14000" y="-1056.6616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="14000" y="-1041.2616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14000" y="-1025.8615" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + ]</text>
<text text-anchor="middle" x="14000" y="-1007.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="14000" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf(), nil, true</text>
<text text-anchor="middle" x="14000" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14000" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="14000" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="14000" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + </text>
<text text-anchor="middle" x="14000" y="-911.3414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="14000" y="-895.9414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not ( &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="14000" y="-877.1814" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="14000" y="-861.7813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="14000" y="-846.3813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="14000" y="-830.9813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="14000" y="-815.5812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14000" y="-800.1812" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_187&#45;&gt;leaf_197 -->
<g id="edge197" class="edge">
<title>codeblock_187&#45;&gt;leaf_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13932.1118,-2072.9235C13938.6044,-1966.1716 13971.9299,-1418.2311 13989.3539,-1131.7451"/>
<polygon fill="#000000" stroke="#000000" points="13992.8533,-1131.8594 13989.967,-1121.6654 13985.8662,-1131.4344 13992.8533,-1131.8594"/>
</g>
<!-- leaf_193 -->
<g id="node194" class="node">
<title>leaf_193</title>
<polygon fill="none" stroke="#c0c0c0" points="13543.5,-135.0015 13072.5,-135.0015 13072.5,-79.1986 13543.5,-79.1986 13543.5,-135.0015"/>
<text text-anchor="middle" x="13308" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_189&#45;&gt;leaf_193 -->
<g id="edge193" class="edge">
<title>raw_189&#45;&gt;leaf_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13499.6198,-938.5791C13508.6141,-833.9643 13548.951,-307.4375 13462,-178.2001 13451.1513,-162.0754 13435.6613,-149.5392 13418.6442,-139.8129"/>
<polygon fill="#000000" stroke="#000000" points="13420.09,-136.6169 13409.6226,-134.9788 13416.7838,-142.7869 13420.09,-136.6169"/>
</g>
<!-- leaf_194 -->
<g id="node195" class="node">
<title>leaf_194</title>
<polygon fill="none" stroke="#c0c0c0" points="13616,-125.1 13562,-125.1 13562,-89.1 13616,-89.1 13616,-125.1"/>
</g>
<!-- prespace_190&#45;&gt;leaf_194 -->
<g id="edge194" class="edge">
<title>prespace_190&#45;&gt;leaf_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13589,-938.5632C13589,-830.2631 13589,-269.2221 13589,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="13592.5001,-135.4293 13589,-125.4293 13585.5001,-135.4293 13592.5001,-135.4293"/>
</g>
<!-- leaf_195 -->
<g id="node196" class="node">
<title>leaf_195</title>
<polygon fill="none" stroke="#c0c0c0" points="13734,-125.1 13634,-125.1 13634,-89.1 13734,-89.1 13734,-125.1"/>
<text text-anchor="middle" x="13684" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_191&#45;&gt;leaf_195 -->
<g id="edge195" class="edge">
<title>literal_191&#45;&gt;leaf_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13684.9787,-938.5632C13684.8512,-830.2631 13684.1908,-269.2221 13684.0336,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="13687.5334,-135.4251 13684.0216,-125.4293 13680.5334,-135.4334 13687.5334,-135.4251"/>
</g>
<!-- leaf_196 -->
<g id="node197" class="node">
<title>leaf_196</title>
<polygon fill="none" stroke="#c0c0c0" points="13992,-127.0021 13752,-127.0021 13752,-87.198 13992,-87.198 13992,-127.0021"/>
<text text-anchor="middle" x="13872" y="-111.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_192&#45;&gt;leaf_196 -->
<g id="edge196" class="edge">
<title>raw_192&#45;&gt;leaf_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13760.0351,-938.6202C13754.7903,-835.338 13732.2571,-319.6868 13797,-178.2001 13805.0628,-160.58 13819.671,-145.1726 13833.8669,-133.2469"/>
<polygon fill="#000000" stroke="#000000" points="13836.0581,-135.9762 13841.6669,-126.9878 13831.677,-130.5166 13836.0581,-135.9762"/>
</g>
<!-- leaf_201 -->
<g id="node202" class="node">
<title>leaf_201</title>
<polygon fill="none" stroke="#c0c0c0" points="14417.5,-974.7014 14212.5,-974.7014 14212.5,-938.7014 14417.5,-938.7014 14417.5,-974.7014"/>
<text text-anchor="middle" x="14315" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:index(cursor)</text>
</g>
<!-- header_198&#45;&gt;leaf_201 -->
<g id="edge201" class="edge">
<title>header_198&#45;&gt;leaf_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14308.1128,-2072.9235C14308.9216,-1941.8395 14313.8349,-1145.5249 14314.8259,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="14318.326,-984.8913 14314.8879,-974.8699 14311.3262,-984.8481 14318.326,-984.8913"/>
</g>
<!-- raw_202 -->
<g id="node203" class="node">
<title>raw_202</title>
<ellipse fill="none" stroke="#000000" cx="14463" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14463" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_199&#45;&gt;raw_202 -->
<g id="edge202" class="edge">
<title>prose_199&#45;&gt;raw_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14469.8872,-2072.9235C14469.0784,-1941.8395 14464.1651,-1145.5249 14463.1741,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="14466.6738,-984.8481 14463.1121,-974.8699 14459.674,-984.8913 14466.6738,-984.8481"/>
</g>
<!-- leaf_204 -->
<g id="node205" class="node">
<title>leaf_204</title>
<polygon fill="none" stroke="#c0c0c0" points="14972,-1053.0019 14508,-1053.0019 14508,-860.4009 14972,-860.4009 14972,-1053.0019"/>
<text text-anchor="middle" x="14740" y="-1037.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.index(historian, cursor)</text>
<text text-anchor="middle" x="14740" y="-1022.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (not cursor) or cursor &lt; 0 or cursor &gt; #historian + 1 then</text>
<text text-anchor="middle" x="14740" y="-1007.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="14740" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14740" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[cursor]</text>
<text text-anchor="middle" x="14740" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="14740" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf = txtbuf:clone()</text>
<text text-anchor="middle" x="14740" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = cursor</text>
<text text-anchor="middle" x="14740" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="14740" y="-899.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="14740" y="-883.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf, result</text>
<text text-anchor="middle" x="14740" y="-868.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_200&#45;&gt;leaf_204 -->
<g id="edge204" class="edge">
<title>codeblock_200&#45;&gt;leaf_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14671.1279,-2072.9235C14678.2905,-1956.8376 14717.6434,-1319.0388 14733.4373,-1063.0638"/>
<polygon fill="#000000" stroke="#000000" points="14736.935,-1063.2077 14734.0576,-1053.0111 14729.9483,-1062.7766 14736.935,-1063.2077"/>
</g>
<!-- leaf_203 -->
<g id="node204" class="node">
<title>leaf_203</title>
<polygon fill="none" stroke="#c0c0c0" points="14597,-135.0015 14329,-135.0015 14329,-79.1986 14597,-79.1986 14597,-135.0015"/>
<text text-anchor="middle" x="14463" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Loads the history to an exact index.</text>
</g>
<!-- raw_202&#45;&gt;leaf_203 -->
<g id="edge203" class="edge">
<title>raw_202&#45;&gt;leaf_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14463,-938.5632C14463,-832.6464 14463,-293.6953 14463,-145.0895"/>
<polygon fill="#000000" stroke="#000000" points="14466.5001,-145.0758 14463,-135.0758 14459.5001,-145.0759 14466.5001,-145.0758"/>
</g>
<!-- leaf_211 -->
<g id="node212" class="node">
<title>leaf_211</title>
<polygon fill="none" stroke="#c0c0c0" points="15328,-974.7014 14990,-974.7014 14990,-938.7014 15328,-938.7014 15328,-974.7014"/>
<text text-anchor="middle" x="15159" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append(txtbuf, results, success)</text>
</g>
<!-- header_205&#45;&gt;leaf_211 -->
<g id="edge211" class="edge">
<title>header_205&#45;&gt;leaf_211</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15159,-2072.9235C15159,-1941.8395 15159,-1145.5249 15159,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="15162.5001,-984.8699 15159,-974.8699 15155.5001,-984.8699 15162.5001,-984.8699"/>
</g>
<!-- raw_212 -->
<g id="node213" class="node">
<title>raw_212</title>
<ellipse fill="none" stroke="#000000" cx="15373" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15373" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_206&#45;&gt;raw_212 -->
<g id="edge212" class="edge">
<title>prose_206&#45;&gt;raw_212</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15393.6616,-2072.9235C15391.2352,-1941.8395 15376.4952,-1145.5249 15373.5223,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="15377.0209,-984.8034 15373.3363,-974.8699 15370.0221,-984.933 15377.0209,-984.8034"/>
</g>
<!-- raw_214 -->
<g id="node215" class="node">
<title>raw_214</title>
<ellipse fill="none" stroke="#000000" cx="15445" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15445" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_207&#45;&gt;raw_214 -->
<g id="edge214" class="edge">
<title>prose_207&#45;&gt;raw_214</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15475.5005,-2072.9235C15471.9187,-1941.8395 15450.1596,-1145.5249 15445.771,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="15449.2684,-984.7705 15445.4964,-974.8699 15442.271,-984.9618 15449.2684,-984.7705"/>
</g>
<!-- leaf_216 -->
<g id="node217" class="node">
<title>leaf_216</title>
<polygon fill="none" stroke="#c0c0c0" points="15940,-1068.3022 15490,-1068.3022 15490,-845.1006 15940,-845.1006 15940,-1068.3022"/>
<text text-anchor="middle" x="15715" y="-1053.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="15715" y="-1037.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf)</text>
<text text-anchor="middle" x="15715" y="-1022.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or tostring(txtbuf) == &quot;&quot; then</text>
<text text-anchor="middle" x="15715" y="-1007.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="15715" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="15715" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15715" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="15715" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="15715" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="15715" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="15715" y="-899.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="15715" y="-883.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15715" y="-868.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="15715" y="-853.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_208&#45;&gt;leaf_216 -->
<g id="edge216" class="edge">
<title>codeblock_208&#45;&gt;leaf_216</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15665.8056,-2072.9235C15670.822,-1959.1016 15697.9433,-1343.7183 15709.6334,-1078.4696"/>
<polygon fill="#000000" stroke="#000000" points="15713.1328,-1078.5574 15710.0766,-1068.4129 15706.1396,-1078.2491 15713.1328,-1078.5574"/>
</g>
<!-- leaf_217 -->
<g id="node218" class="node">
<title>leaf_217</title>
<polygon fill="none" stroke="#c0c0c0" points="16226,-1007.1024 15958,-1007.1024 15958,-906.3004 16226,-906.3004 16226,-1007.1024"/>
<text text-anchor="middle" x="16092" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="16092" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="16092" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="16092" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="16092" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="16092" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_209&#45;&gt;leaf_217 -->
<g id="edge217" class="edge">
<title>codeblock_209&#45;&gt;leaf_217</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15976.8852,-2072.9235C15989.6529,-1949.1203 16063.6157,-1231.9325 16085.7463,-1017.3406"/>
<polygon fill="#000000" stroke="#000000" points="16089.247,-1017.513 16086.7915,-1007.2066 16082.284,-1016.7948 16089.247,-1017.513"/>
</g>
<!-- leaf_218 -->
<g id="node219" class="node">
<title>leaf_218</title>
<polygon fill="none" stroke="#c0c0c0" points="16330,-974.7014 16244,-974.7014 16244,-938.7014 16330,-938.7014 16330,-974.7014"/>
<text text-anchor="middle" x="16287" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_210&#45;&gt;leaf_218 -->
<g id="edge218" class="edge">
<title>codeblock_210&#45;&gt;leaf_218</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16286.0161,-2072.9235C16286.1317,-1941.8395 16286.8336,-1145.5249 16286.9751,-984.9181"/>
<polygon fill="#000000" stroke="#000000" points="16290.4751,-984.873 16286.984,-974.8699 16283.4751,-984.8668 16290.4751,-984.873"/>
</g>
<!-- leaf_213 -->
<g id="node214" class="node">
<title>leaf_213</title>
<polygon fill="none" stroke="#c0c0c0" points="15431,-135.0015 15107,-135.0015 15107,-79.1986 15431,-79.1986 15431,-135.0015"/>
<text text-anchor="middle" x="15269" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_212&#45;&gt;leaf_213 -->
<g id="edge213" class="edge">
<title>raw_212&#45;&gt;leaf_213</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15376.5926,-938.7142C15393.2729,-850.8103 15457.3882,-459.2839 15337,-178.2001 15331.3182,-164.9341 15321.9795,-152.6799 15312.0169,-142.2146"/>
<polygon fill="#000000" stroke="#000000" points="15314.2505,-139.4994 15304.6956,-134.9216 15309.3103,-144.4587 15314.2505,-139.4994"/>
</g>
<!-- leaf_215 -->
<g id="node216" class="node">
<title>leaf_215</title>
<polygon fill="none" stroke="#c0c0c0" points="15647,-127.0021 15449,-127.0021 15449,-87.198 15647,-87.198 15647,-127.0021"/>
<text text-anchor="middle" x="15548" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_214&#45;&gt;leaf_215 -->
<g id="edge215" class="edge">
<title>raw_214&#45;&gt;leaf_215</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15441.4503,-938.7324C15424.971,-850.9142 15361.6522,-459.7273 15481,-178.2001 15488.194,-161.2303 15501.3537,-145.8557 15514.1178,-133.7798"/>
<polygon fill="#000000" stroke="#000000" points="15516.4731,-136.3688 15521.5394,-127.0638 15511.7762,-131.1785 15516.4731,-136.3688"/>
</g>
</g>
</svg>
