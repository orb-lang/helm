<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="18504pt" height="2895pt"
 viewBox="0.00 0.00 18504.30 2894.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2890.8044)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2890.8044 18500.2972,-2890.8044 18500.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2868.8044" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1787" y="-2864.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 590</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2796.8044" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1787" y="-2792.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;484</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2850.6358C1787,-2842.9354 1787,-2833.7788 1787,-2825.2211"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2825.2177 1787,-2815.2177 1783.5001,-2825.2177 1790.5001,-2825.2177"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1168" cy="-2724.8044" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1168" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1725.4565,-2790.2517C1633.9363,-2780.4265 1456.5725,-2761.075 1306,-2742.8044 1281.4502,-2739.8255 1254.4713,-2736.3513 1230.9302,-2733.254"/>
<polygon fill="#000000" stroke="#000000" points="1231.0962,-2729.7456 1220.7241,-2731.9065 1230.1799,-2736.6854 1231.0962,-2729.7456"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1347" cy="-2724.8044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1347" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1726.8328,-2789.4768C1654.436,-2780.2918 1529.3399,-2763.2466 1423,-2742.8044 1411.0534,-2740.5079 1398.1458,-2737.6102 1386.4181,-2734.8148"/>
<polygon fill="#000000" stroke="#000000" points="1387.0127,-2731.3576 1376.4695,-2732.4023 1385.363,-2738.1605 1387.0127,-2731.3576"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1464" cy="-2724.8044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1464" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.5408,-2787.0357C1677.8804,-2777.2138 1594.4109,-2760.9579 1523,-2742.8044 1516.1661,-2741.0672 1508.9445,-2739.0328 1501.9868,-2736.9691"/>
<polygon fill="#000000" stroke="#000000" points="1502.6431,-2733.5107 1492.0577,-2733.9557 1500.6102,-2740.209 1502.6431,-2733.5107"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1564" cy="-2724.8044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1564" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1742.3852,-2783.4547C1707.3486,-2772.8322 1657.3972,-2757.3814 1614,-2742.8044 1609.6517,-2741.3439 1605.1065,-2739.7717 1600.6048,-2738.1863"/>
<polygon fill="#000000" stroke="#000000" points="1601.5075,-2734.7925 1590.9128,-2734.7329 1599.1579,-2741.3864 1601.5075,-2734.7925"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1655" cy="-2724.8044" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1655" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1757.3766,-2780.6462C1736.5856,-2769.3057 1708.7908,-2754.1449 1687.4091,-2742.4821"/>
<polygon fill="#000000" stroke="#000000" points="1688.8366,-2739.274 1678.3816,-2737.558 1685.4846,-2745.4192 1688.8366,-2739.274"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2724.8044" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1787" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2778.6358C1787,-2770.9354 1787,-2761.7788 1787,-2753.2211"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2753.2177 1787,-2743.2177 1783.5001,-2753.2177 1790.5001,-2753.2177"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2066" cy="-2724.8044" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2066" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 31&#45;33</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1834.9618,-2784.4272C1881.7022,-2772.3652 1952.9893,-2753.9685 2004.0105,-2740.8017"/>
<polygon fill="#000000" stroke="#000000" points="2005.1231,-2744.1294 2013.9312,-2738.2415 2003.3739,-2737.3514 2005.1231,-2744.1294"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2724.8044" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;227</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1849.5748,-2791.2146C1995.3393,-2778.1935 2357.1653,-2745.8716 2516.0774,-2731.6759"/>
<polygon fill="#000000" stroke="#000000" points="2516.5979,-2735.1435 2526.2468,-2730.7675 2515.975,-2728.1712 2516.5979,-2735.1435"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7307" cy="-2724.8044" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7307" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 285&#45;320</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.8377,-2795.9457C2426.4627,-2788.4636 6570.374,-2734.4126 7221.1088,-2725.9248"/>
<polygon fill="#000000" stroke="#000000" points="7221.3907,-2729.4215 7231.3442,-2725.7912 7221.2993,-2722.4221 7221.3907,-2729.4215"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11890" cy="-2724.8044" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11890" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 397&#45;464</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.8447,-2796.3352C2671.9167,-2790.498 10873.0109,-2732.0521 11804.0846,-2725.4167"/>
<polygon fill="#000000" stroke="#000000" points="11804.4045,-2728.9146 11814.3793,-2725.3434 11804.3545,-2721.9148 11804.4045,-2728.9146"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="15218" cy="-2724.8044" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15218" y="-2720.6044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 485&#45;555</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.6648,-2796.4626C2495.4669,-2793.1152 7731.6302,-2765.8184 11974,-2742.8044 13229.0835,-2735.9959 14757.3061,-2727.401 15132.0392,-2725.2892"/>
<polygon fill="#000000" stroke="#000000" points="15132.2817,-2728.788 15142.2618,-2725.2316 15132.2422,-2721.7881 15132.2817,-2728.788"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1209.5,-2592.1043 1116.5,-2592.1043 1116.5,-2556.1043 1209.5,-2556.1043 1209.5,-2592.1043"/>
<text text-anchor="middle" x="1163" y="-2570.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.3969,-2706.6265C1166.5372,-2680.7161 1164.9516,-2632.9259 1163.9379,-2602.3713"/>
<polygon fill="#000000" stroke="#000000" points="1167.435,-2602.2251 1163.6053,-2592.3467 1160.4389,-2602.4573 1167.435,-2602.2251"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1255" cy="-2574.1043" rx="27" ry="18"/>
<text text-anchor="middle" x="1255" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1327.9913,-2710.2388C1316.0186,-2700.2388 1300.9919,-2686.0559 1291,-2670.8044 1277.0392,-2649.4949 1267.4798,-2622.0197 1261.74,-2601.8051"/>
<polygon fill="#000000" stroke="#000000" points="1265.0694,-2600.7089 1259.0835,-2591.9671 1258.3114,-2602.5337 1265.0694,-2600.7089"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1327" cy="-2574.1043" rx="27" ry="18"/>
<text text-anchor="middle" x="1327" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1435.5777,-2715.9135C1413.0939,-2707.5509 1382.3621,-2692.9652 1363,-2670.8044 1345.9597,-2651.3011 1336.6846,-2622.9855 1331.8386,-2602.0312"/>
<polygon fill="#000000" stroke="#000000" points="1335.2362,-2601.1801 1329.7457,-2592.1189 1328.3872,-2602.6263 1335.2362,-2601.1801"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1399" cy="-2574.1043" rx="27" ry="18"/>
<text text-anchor="middle" x="1399" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1535.8285,-2715.9454C1502.4164,-2704.9504 1449.4236,-2685.8176 1435,-2670.8044 1416.951,-2652.0176 1407.7908,-2623.3687 1403.245,-2602.1256"/>
<polygon fill="#000000" stroke="#000000" points="1406.6383,-2601.2366 1401.3155,-2592.076 1399.7639,-2602.5566 1406.6383,-2601.2366"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1471" cy="-2574.1043" rx="27" ry="18"/>
<text text-anchor="middle" x="1471" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1627.6371,-2714.9011C1585.0185,-2699.4653 1507.5624,-2671.3632 1507,-2670.8044 1488.5183,-2652.4431 1479.417,-2623.7362 1475.0028,-2602.3637"/>
<polygon fill="#000000" stroke="#000000" points="1478.3932,-2601.4476 1473.1442,-2592.2444 1471.5084,-2602.7121 1478.3932,-2601.4476"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057.5,-2671.005 1516.5,-2671.005 1516.5,-2477.2035 2057.5,-2477.2035 2057.5,-2671.005"/>
<text text-anchor="middle" x="1787" y="-2655.6044" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf &#160;= require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2640.2044" font-family="Inconsolata" font-size="14.00" fill="#000000">local Rainbuf = require &quot;rainbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2624.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= assert(sql, &quot;sql must be in bridge _G&quot;)</text>
<text text-anchor="middle" x="1787" y="-2609.4043" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= (require &quot;color&quot;).color</text>
<text text-anchor="middle" x="1787" y="-2578.0043" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1787" y="-2562.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">local repr &#160;&#160;&#160;= require &quot;repr&quot;</text>
<text text-anchor="middle" x="1787" y="-2547.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1787" y="-2531.8042" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1787" y="-2516.4042" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints, &quot;must have string.codepoints&quot;)</text>
<text text-anchor="middle" x="1787" y="-2501.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1787" y="-2485.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2706.6265C1787,-2699.5381 1787,-2690.8121 1787,-2681.2494"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2681.0148 1787,-2671.0149 1783.5001,-2681.0149 1790.5001,-2681.0148"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2592.1043 2075.5,-2592.1043 2075.5,-2556.1043 2266.5,-2556.1043 2266.5,-2592.1043"/>
<text text-anchor="middle" x="2171" y="-2570.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2078.4572,-2706.9254C2096.7509,-2680.6695 2131.0148,-2631.4926 2152.3267,-2600.9049"/>
<polygon fill="#000000" stroke="#000000" points="2155.3865,-2602.6358 2158.2315,-2592.43 2149.6431,-2598.634 2155.3865,-2602.6358"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2574.1043" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2535.7611,-2714.1305C2502.9874,-2706.0518 2462.2926,-2692.531 2431,-2670.8044 2404.4905,-2652.3988 2382.3237,-2622.4748 2368.4791,-2600.7842"/>
<polygon fill="#000000" stroke="#000000" points="2371.3093,-2598.7067 2363.0668,-2592.05 2365.3591,-2602.3939 2371.3093,-2598.7067"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2560.4768,-2708.6483C2544.4684,-2699.3742 2525.8911,-2686.4545 2513,-2670.8044 2496.3379,-2650.5763 2485.462,-2622.5832 2479.127,-2601.919"/>
<polygon fill="#000000" stroke="#000000" points="2482.4407,-2600.7788 2476.2989,-2592.1458 2475.7166,-2602.7246 2482.4407,-2600.7788"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2574.1043" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 40&#45;145</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2706.6265C2593,-2680.7161 2593,-2632.9259 2593,-2602.3713"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2602.3467 2593,-2592.3467 2589.5001,-2602.3467 2596.5001,-2602.3467"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2991" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 146&#45;216</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2632.6168,-2709.8038C2705.6419,-2682.1533 2861.3035,-2623.213 2941.2877,-2592.9275"/>
<polygon fill="#000000" stroke="#000000" points="2942.5434,-2596.1946 2950.656,-2589.3802 2940.0646,-2589.6482 2942.5434,-2596.1946"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="4150" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4150" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 217&#45;227</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2659.4043,-2718.3772C2909.8376,-2694.1381 3796.6869,-2608.301 4069.5271,-2581.8931"/>
<polygon fill="#000000" stroke="#000000" points="4070.1286,-2585.3514 4079.7448,-2580.9042 4069.4541,-2578.3839 4070.1286,-2585.3514"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4967" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4967" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 228&#45;284</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.6162,-2723.4065C2936.432,-2717.8621 3921.8544,-2696.4675 4234,-2670.8044 4477.4372,-2650.7902 4763.9775,-2607.0997 4895.0326,-2585.9901"/>
<polygon fill="#000000" stroke="#000000" points="4895.6415,-2589.4372 4904.9553,-2584.387 4894.525,-2582.5268 4895.6415,-2589.4372"/>
</g>
<!-- header_99 -->
<g id="node100" class="node">
<title>header_99</title>
<ellipse fill="none" stroke="#000000" cx="7108" cy="-2574.1043" rx="107.339" ry="18"/>
<text text-anchor="middle" x="7108" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_99 -->
<g id="edge99" class="edge">
<title>section_10&#45;&gt;header_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7279.5362,-2707.771C7263.3663,-2697.4844 7242.6829,-2683.8747 7225,-2670.8044 7193.532,-2647.5449 7159.2047,-2618.7333 7135.9226,-2598.6364"/>
<polygon fill="#000000" stroke="#000000" points="7138.0191,-2595.8217 7128.1709,-2591.9148 7133.4331,-2601.1104 7138.0191,-2595.8217"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="7266" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7266" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_10&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7302.0544,-2706.6265C7295.0052,-2680.7161 7282.0032,-2632.9259 7273.6904,-2602.3713"/>
<polygon fill="#000000" stroke="#000000" points="7276.9656,-2601.0771 7270.9631,-2592.3467 7270.2111,-2602.9148 7276.9656,-2601.0771"/>
</g>
<!-- prose_101 -->
<g id="node102" class="node">
<title>prose_101</title>
<ellipse fill="none" stroke="#000000" cx="7348" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7348" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_101 -->
<g id="edge101" class="edge">
<title>section_10&#45;&gt;prose_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7311.9456,-2706.6265C7318.9948,-2680.7161 7331.9968,-2632.9259 7340.3096,-2602.3713"/>
<polygon fill="#000000" stroke="#000000" points="7343.7889,-2602.9148 7343.0369,-2592.3467 7337.0344,-2601.0771 7343.7889,-2602.9148"/>
</g>
<!-- section_102 -->
<g id="node103" class="node">
<title>section_102</title>
<ellipse fill="none" stroke="#000000" cx="7939" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7939" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 295&#45;320</text>
</g>
<!-- section_10&#45;&gt;section_102 -->
<g id="edge102" class="edge">
<title>section_10&#45;&gt;section_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7360.6113,-2712.0208C7476.6877,-2684.3425 7750.8265,-2618.9742 7875.4066,-2589.2681"/>
<polygon fill="#000000" stroke="#000000" points="7876.2773,-2592.6587 7885.1928,-2586.9346 7874.6536,-2585.8496 7876.2773,-2592.6587"/>
</g>
<!-- section_103 -->
<g id="node104" class="node">
<title>section_103</title>
<ellipse fill="none" stroke="#000000" cx="9471" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9471" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 321&#45;396</text>
</g>
<!-- section_10&#45;&gt;section_103 -->
<g id="edge103" class="edge">
<title>section_10&#45;&gt;section_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7379.6189,-2719.7473C7706.6128,-2696.9755 9041.4436,-2604.0184 9388.3136,-2579.8625"/>
<polygon fill="#000000" stroke="#000000" points="9388.7974,-2583.3374 9398.5301,-2579.151 9388.3111,-2576.3543 9388.7974,-2583.3374"/>
</g>
<!-- header_151 -->
<g id="node152" class="node">
<title>header_151</title>
<ellipse fill="none" stroke="#000000" cx="10547" cy="-2574.1043" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10547" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_151 -->
<g id="edge151" class="edge">
<title>section_11&#45;&gt;header_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11814.5862,-2722.9725C11576.6792,-2716.9519 10851.6396,-2696.6721 10749,-2670.8044 10687.5696,-2655.3225 10622.5068,-2620.375 10583.3209,-2597.0124"/>
<polygon fill="#000000" stroke="#000000" points="10584.7804,-2593.8052 10574.4106,-2591.6329 10581.1624,-2599.7977 10584.7804,-2593.8052"/>
</g>
<!-- prose_152 -->
<g id="node153" class="node">
<title>prose_152</title>
<ellipse fill="none" stroke="#000000" cx="10790" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10790" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_152 -->
<g id="edge152" class="edge">
<title>section_11&#45;&gt;prose_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11823.2876,-2716.3184C11741.442,-2705.8576 11598.4626,-2687.422 11476,-2670.8044 11231.4759,-2637.6238 10938.2742,-2595.5168 10831.4773,-2580.1033"/>
<polygon fill="#000000" stroke="#000000" points="10831.8347,-2576.6187 10821.4372,-2578.6537 10830.8343,-2583.5469 10831.8347,-2576.6187"/>
</g>
<!-- prose_153 -->
<g id="node154" class="node">
<title>prose_153</title>
<ellipse fill="none" stroke="#000000" cx="11517" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11517" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_153 -->
<g id="edge153" class="edge">
<title>section_11&#45;&gt;prose_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11817.2768,-2719.8246C11762.8105,-2713.7737 11687.7182,-2700.3887 11628,-2670.8044 11591.9441,-2652.9424 11558.2546,-2620.4771 11537.6577,-2598.1258"/>
<polygon fill="#000000" stroke="#000000" points="11540.2356,-2595.7583 11530.9359,-2590.6823 11535.0404,-2600.4498 11540.2356,-2595.7583"/>
</g>
<!-- prose_154 -->
<g id="node155" class="node">
<title>prose_154</title>
<ellipse fill="none" stroke="#000000" cx="11669" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11669" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_154 -->
<g id="edge154" class="edge">
<title>section_11&#45;&gt;prose_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11865.0781,-2707.8101C11823.8905,-2679.7243 11741.8306,-2623.7675 11698.0679,-2593.9257"/>
<polygon fill="#000000" stroke="#000000" points="11699.8281,-2590.8897 11689.5942,-2588.1475 11695.8843,-2596.6731 11699.8281,-2590.8897"/>
</g>
<!-- prose_155 -->
<g id="node156" class="node">
<title>prose_155</title>
<ellipse fill="none" stroke="#000000" cx="11890" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11890" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_155 -->
<g id="edge155" class="edge">
<title>section_11&#45;&gt;prose_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11890,-2706.6265C11890,-2680.7161 11890,-2632.9259 11890,-2602.3713"/>
<polygon fill="#000000" stroke="#000000" points="11893.5001,-2602.3467 11890,-2592.3467 11886.5001,-2602.3467 11893.5001,-2602.3467"/>
</g>
<!-- prose_156 -->
<g id="node157" class="node">
<title>prose_156</title>
<ellipse fill="none" stroke="#000000" cx="12090" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12090" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_156 -->
<g id="edge156" class="edge">
<title>section_11&#45;&gt;prose_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11912.9425,-2707.5172C11949.9361,-2679.6425 12022.6284,-2624.8688 12062.3977,-2594.9026"/>
<polygon fill="#000000" stroke="#000000" points="12064.7127,-2597.5406 12070.593,-2588.7274 12060.5002,-2591.95 12064.7127,-2597.5406"/>
</g>
<!-- prose_157 -->
<g id="node158" class="node">
<title>prose_157</title>
<ellipse fill="none" stroke="#000000" cx="13095" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13095" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_157 -->
<g id="edge157" class="edge">
<title>section_11&#45;&gt;prose_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11956.9346,-2716.4334C12177.1805,-2688.889 12875.4136,-2601.5663 13053.3944,-2579.3076"/>
<polygon fill="#000000" stroke="#000000" points="13053.9151,-2582.7698 13063.4035,-2578.0558 13053.0464,-2575.8239 13053.9151,-2582.7698"/>
</g>
<!-- prose_158 -->
<g id="node159" class="node">
<title>prose_158</title>
<ellipse fill="none" stroke="#000000" cx="13258" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13258" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_158 -->
<g id="edge158" class="edge">
<title>section_11&#45;&gt;prose_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11965.4811,-2724.2365C12218.4719,-2721.9605 13026.6941,-2711.5448 13136,-2670.8044 13176.728,-2655.6243 13214.4311,-2621.3548 13236.837,-2597.9707"/>
<polygon fill="#000000" stroke="#000000" points="13239.5511,-2600.1928 13243.8313,-2590.501 13234.4414,-2595.4083 13239.5511,-2600.1928"/>
</g>
<!-- codeblock_159 -->
<g id="node160" class="node">
<title>codeblock_159</title>
<ellipse fill="none" stroke="#000000" cx="13529" cy="-2574.1043" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13529" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 418&#45;462</text>
</g>
<!-- section_11&#45;&gt;codeblock_159 -->
<g id="edge159" class="edge">
<title>section_11&#45;&gt;codeblock_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11965.3099,-2723.4968C12238.5826,-2718.5351 13168.7473,-2699.6788 13299,-2670.8044 13369.0793,-2655.2693 13444.8058,-2619.3273 13489.504,-2595.9074"/>
<polygon fill="#000000" stroke="#000000" points="13491.3593,-2598.8854 13498.558,-2591.1117 13488.0828,-2592.6995 13491.3593,-2598.8854"/>
</g>
<!-- section_160 -->
<g id="node161" class="node">
<title>section_160</title>
<ellipse fill="none" stroke="#000000" cx="14356" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14356" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 465&#45;484</text>
</g>
<!-- section_11&#45;&gt;section_160 -->
<g id="edge160" class="edge">
<title>section_11&#45;&gt;section_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11965.6486,-2723.4627C12255.4741,-2718.1646 13295.3491,-2697.6701 13625,-2670.8044 13867.7986,-2651.017 14153.5446,-2607.2161 14284.234,-2586.0349"/>
<polygon fill="#000000" stroke="#000000" points="14284.8202,-2589.4857 14294.129,-2584.4264 14283.6969,-2582.5764 14284.8202,-2589.4857"/>
</g>
<!-- header_196 -->
<g id="node197" class="node">
<title>header_196</title>
<ellipse fill="none" stroke="#000000" cx="14815" cy="-2574.1043" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="14815" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_196 -->
<g id="edge196" class="edge">
<title>section_12&#45;&gt;header_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15146.9989,-2718.5965C15091.7573,-2711.8627 15014.1401,-2698.1588 14951,-2670.8044 14909.3218,-2652.7481 14867.6843,-2620.5391 14841.6697,-2598.2848"/>
<polygon fill="#000000" stroke="#000000" points="14843.9604,-2595.6385 14834.115,-2591.7245 14839.3707,-2600.9239 14843.9604,-2595.6385"/>
</g>
<!-- prose_197 -->
<g id="node198" class="node">
<title>prose_197</title>
<ellipse fill="none" stroke="#000000" cx="14992" cy="-2574.1043" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14992" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_197 -->
<g id="edge197" class="edge">
<title>section_12&#45;&gt;prose_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15186.2765,-2708.277C15167.2786,-2698.0576 15142.8485,-2684.344 15122,-2670.8044 15084.9094,-2646.7169 15044.3424,-2615.7415 15018.5597,-2595.4247"/>
<polygon fill="#000000" stroke="#000000" points="15020.4212,-2592.4342 15010.4092,-2588.9686 15016.0748,-2597.9214 15020.4212,-2592.4342"/>
</g>
<!-- codeblock_198 -->
<g id="node199" class="node">
<title>codeblock_198</title>
<ellipse fill="none" stroke="#000000" cx="15218" cy="-2574.1043" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15218" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 487&#45;501</text>
</g>
<!-- section_12&#45;&gt;codeblock_198 -->
<g id="edge198" class="edge">
<title>section_12&#45;&gt;codeblock_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15218,-2706.6265C15218,-2680.7161 15218,-2632.9259 15218,-2602.3713"/>
<polygon fill="#000000" stroke="#000000" points="15221.5001,-2602.3467 15218,-2592.3467 15214.5001,-2602.3467 15221.5001,-2602.3467"/>
</g>
<!-- section_199 -->
<g id="node200" class="node">
<title>section_199</title>
<ellipse fill="none" stroke="#000000" cx="15667" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15667" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 504&#45;536</text>
</g>
<!-- section_12&#45;&gt;section_199 -->
<g id="edge199" class="edge">
<title>section_12&#45;&gt;section_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15261.8695,-2710.0803C15344.6063,-2682.3109 15523.429,-2622.2917 15613.2374,-2592.1489"/>
<polygon fill="#000000" stroke="#000000" points="15614.5858,-2595.3883 15622.9524,-2588.8882 15612.3584,-2588.7521 15614.5858,-2595.3883"/>
</g>
<!-- section_200 -->
<g id="node201" class="node">
<title>section_200</title>
<ellipse fill="none" stroke="#000000" cx="16476" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="16476" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 537&#45;555</text>
</g>
<!-- section_12&#45;&gt;section_200 -->
<g id="edge200" class="edge">
<title>section_12&#45;&gt;section_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15288.7754,-2718.3521C15390.9436,-2708.8748 15585.6489,-2690.2029 15751,-2670.8044 15988.8417,-2642.9016 16269.7052,-2603.6318 16401.1333,-2584.8847"/>
<polygon fill="#000000" stroke="#000000" points="16401.6928,-2588.3404 16411.0976,-2583.4619 16400.7032,-2581.4107 16401.6928,-2588.3404"/>
</g>
<!-- section_201 -->
<g id="node202" class="node">
<title>section_201</title>
<ellipse fill="none" stroke="#000000" cx="17599" cy="-2574.1043" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="17599" y="-2569.9043" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 556&#45;590</text>
</g>
<!-- section_12&#45;&gt;section_201 -->
<g id="edge201" class="edge">
<title>section_12&#45;&gt;section_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15293.3739,-2723.161C15497.5035,-2718.4098 16078.1048,-2702.9026 16560,-2670.8044 16919.3348,-2646.8698 17347.1111,-2601.7977 17520.3612,-2582.8479"/>
<polygon fill="#000000" stroke="#000000" points="17520.85,-2586.3153 17530.4092,-2581.7469 17520.0875,-2579.357 17520.85,-2586.3153"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2142.2046 0,-2142.2046 0,-2070.4023 324,-2070.4023 324,-2142.2046"/>
<text text-anchor="middle" x="162" y="-2078.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1253.8181,-2555.9228C1251.2733,-2533.3307 1243.2548,-2495.5486 1218,-2477.4041 1138.0747,-2419.9812 415.8659,-2494.4953 333,-2441.4041 230.3145,-2375.6147 186.4519,-2227.5292 170.2315,-2152.1939"/>
<polygon fill="#000000" stroke="#000000" points="173.5872,-2151.1398 168.1229,-2142.0627 166.734,-2152.5661 173.5872,-2151.1398"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2133.6038 342.5,-2133.6038 342.5,-2079.003 897.5,-2079.003 897.5,-2133.6038"/>
<text text-anchor="middle" x="620" y="-2102.5034" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-2087.1034" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1325.8146,-2555.7568C1323.2997,-2533.3565 1315.4551,-2496.1476 1291,-2477.4041 1222.9747,-2425.2665 983.1003,-2480.8315 907,-2441.4041 774.5428,-2372.7783 677.5181,-2214.6247 638.6757,-2142.8806"/>
<polygon fill="#000000" stroke="#000000" points="641.5988,-2140.9246 633.7977,-2133.7556 635.4255,-2144.2247 641.5988,-2140.9246"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2133.6038 916,-2133.6038 916,-2079.003 1464,-2079.003 1464,-2133.6038"/>
<text text-anchor="middle" x="1190" y="-2102.5034" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-2087.1034" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1392.9125,-2556.4708C1386.0668,-2536.9604 1374.4098,-2504.671 1363,-2477.4041 1310.9549,-2353.0276 1241.064,-2209.2411 1208.3411,-2143.082"/>
<polygon fill="#000000" stroke="#000000" points="1211.3653,-2141.3021 1203.7894,-2133.8956 1205.093,-2144.41 1211.3653,-2141.3021"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2141.6038 1482,-2141.6038 1482,-2071.0031 2030,-2071.0031 2030,-2141.6038"/>
<text text-anchor="middle" x="1756" y="-2110.5034" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-2095.1034" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1476.3015,-2556.1055C1482.459,-2536.2754 1493.5166,-2503.7075 1507,-2477.4041 1571.4025,-2351.7675 1670.0565,-2217.2395 1721.73,-2149.9383"/>
<polygon fill="#000000" stroke="#000000" points="1724.7641,-2151.7351 1728.0961,-2141.6778 1719.2196,-2147.4621 1724.7641,-2151.7351"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-2124.3034 2048,-2124.3034 2048,-2088.3034 2162,-2088.3034 2162,-2124.3034"/>
<text text-anchor="middle" x="2105" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2342.893,-2556.216C2329.8404,-2534.6339 2305.1752,-2498.6128 2275,-2477.4041 2234.9825,-2449.2776 2203.1056,-2478.3057 2171,-2441.4041 2093.186,-2351.966 2096.6596,-2197.8351 2101.9134,-2134.6128"/>
<polygon fill="#000000" stroke="#000000" points="2105.4053,-2134.8597 2102.8277,-2124.5832 2098.4342,-2134.2241 2105.4053,-2134.8597"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2469.5344,-2556.0687C2465.5191,-2533.9901 2455.3979,-2497.1131 2431,-2477.4041 2364.8217,-2423.9441 2300.6343,-2503.9806 2243,-2441.4041 2163.3722,-2354.9481 2186.5434,-2197.8425 2200.2133,-2134.1957"/>
<polygon fill="#000000" stroke="#000000" points="2203.6998,-2134.6428 2202.4687,-2124.1197 2196.8688,-2133.1137 2203.6998,-2134.6428"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-2106.3034" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2582.1678,-2556.0114C2568.4941,-2534.5613 2543.0887,-2499.007 2513,-2477.4041 2476.6597,-2451.3126 2448.8646,-2474.7131 2419,-2441.4041 2338.7193,-2351.8642 2330.1603,-2197.7905 2330.2619,-2134.5981"/>
<polygon fill="#000000" stroke="#000000" points="2333.7619,-2134.6053 2330.3543,-2124.5734 2326.7622,-2134.5407 2333.7619,-2134.6053"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2576.6462,-2556.3823C2555.5059,-2532.3359 2519.3536,-2487.1063 2502,-2441.4041 2461.0489,-2333.5557 2458.236,-2193.5415 2459.1273,-2134.5108"/>
<polygon fill="#000000" stroke="#000000" points="2462.6276,-2134.525 2459.3285,-2124.457 2455.629,-2134.3849 2462.6276,-2134.525"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2106.3034" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 42&#45;143</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2556.0526C2593,-2484.7184 2593,-2222.12 2593,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2134.5536 2593,-2124.5537 2589.5001,-2134.5537 2596.5001,-2134.5536"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-2106.3034" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2969.4045,-2556.6829C2941.8467,-2533.3068 2894.5736,-2489.1676 2868,-2441.4041 2810.1518,-2337.4275 2786.8324,-2194.7677 2779.1738,-2134.7416"/>
<polygon fill="#000000" stroke="#000000" points="2782.612,-2134.0229 2777.9213,-2124.523 2775.664,-2134.8746 2782.612,-2134.0229"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2984.2467,-2555.916C2975.109,-2530.5992 2958.9264,-2483.1398 2950,-2441.4041 2926.0462,-2329.4074 2914.7725,-2193.1446 2910.7776,-2134.9138"/>
<polygon fill="#000000" stroke="#000000" points="2914.2513,-2134.4001 2910.0945,-2124.6548 2907.2667,-2134.8653 2914.2513,-2134.4001"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2991,-2556.0526C2991,-2484.7184 2991,-2222.12 2991,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="2994.5001,-2134.5536 2991,-2124.5537 2987.5001,-2134.5537 2994.5001,-2134.5536"/>
</g>
<!-- structure_43 -->
<g id="node44" class="node">
<title>structure_43</title>
<ellipse fill="none" stroke="#000000" cx="3086" cy="-2106.3034" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="3086" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_27&#45;&gt;structure_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;structure_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2997.5271,-2555.8654C3006.4023,-2530.4898 3022.2817,-2482.9626 3032,-2441.4041 3058.2196,-2329.2805 3075.8744,-2193.0845 3082.763,-2134.8925"/>
<polygon fill="#000000" stroke="#000000" points="3086.2766,-2134.979 3083.9602,-2124.6406 3079.3239,-2134.1671 3086.2766,-2134.979"/>
</g>
<!-- prose_44 -->
<g id="node45" class="node">
<title>prose_44</title>
<ellipse fill="none" stroke="#000000" cx="3181" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3181" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_44 -->
<g id="edge44" class="edge">
<title>section_27&#45;&gt;prose_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3019.9754,-2557.4761C3054.9335,-2535.7007 3112.4368,-2494.0301 3140,-2441.4041 3193.7607,-2338.7594 3188.9393,-2194.8063 3183.9545,-2134.5591"/>
<polygon fill="#000000" stroke="#000000" points="3187.4149,-2133.9601 3183.0359,-2124.3126 3180.4429,-2134.5852 3187.4149,-2133.9601"/>
</g>
<!-- codeblock_45 -->
<g id="node46" class="node">
<title>codeblock_45</title>
<ellipse fill="none" stroke="#000000" cx="3400" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3400" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 160&#45;214</text>
</g>
<!-- section_27&#45;&gt;codeblock_45 -->
<g id="edge45" class="edge">
<title>section_27&#45;&gt;codeblock_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3031.8627,-2558.9088C3081.9205,-2538.5943 3166.8498,-2498.4132 3222,-2441.4041 3313.3583,-2346.9663 3370.4117,-2196.2617 3391.1567,-2134.3001"/>
<polygon fill="#000000" stroke="#000000" points="3394.5916,-2135.0585 3394.3921,-2124.4656 3387.9422,-2132.8709 3394.5916,-2135.0585"/>
</g>
<!-- header_57 -->
<g id="node58" class="node">
<title>header_57</title>
<ellipse fill="none" stroke="#000000" cx="3909" cy="-2106.3034" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3909" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_57 -->
<g id="edge57" class="edge">
<title>section_28&#45;&gt;header_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4140.7002,-2556.0526C4103.7592,-2484.347 3967.2546,-2219.3803 3922.9703,-2133.4209"/>
<polygon fill="#000000" stroke="#000000" points="3925.9633,-2131.5881 3918.2721,-2124.3013 3919.7405,-2134.7939 3925.9633,-2131.5881"/>
</g>
<!-- prose_58 -->
<g id="node59" class="node">
<title>prose_58</title>
<ellipse fill="none" stroke="#000000" cx="4150" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4150" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_58 -->
<g id="edge58" class="edge">
<title>section_28&#45;&gt;prose_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4150,-2556.0526C4150,-2484.7184 4150,-2222.12 4150,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="4153.5001,-2134.5536 4150,-2124.5537 4146.5001,-2134.5537 4153.5001,-2134.5536"/>
</g>
<!-- prose_59 -->
<g id="node60" class="node">
<title>prose_59</title>
<ellipse fill="none" stroke="#000000" cx="4232" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4232" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_59 -->
<g id="edge59" class="edge">
<title>section_28&#45;&gt;prose_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4156.7533,-2555.916C4165.891,-2530.5992 4182.0736,-2483.1398 4191,-2441.4041 4214.9538,-2329.4074 4226.2275,-2193.1446 4230.2224,-2134.9138"/>
<polygon fill="#000000" stroke="#000000" points="4233.7333,-2134.8653 4230.9055,-2124.6548 4226.7487,-2134.4001 4233.7333,-2134.8653"/>
</g>
<!-- codeblock_60 -->
<g id="node61" class="node">
<title>codeblock_60</title>
<ellipse fill="none" stroke="#000000" cx="4370" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4370" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 223&#45;225</text>
</g>
<!-- section_28&#45;&gt;codeblock_60 -->
<g id="edge60" class="edge">
<title>section_28&#45;&gt;codeblock_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4171.4941,-2556.626C4198.9423,-2533.1884 4246.0969,-2488.9829 4273,-2441.4041 4331.7941,-2337.4253 4357.5696,-2194.7667 4366.3061,-2134.7413"/>
<polygon fill="#000000" stroke="#000000" points="4369.8163,-2134.9128 4367.7432,-2124.5228 4362.8845,-2133.9379 4369.8163,-2134.9128"/>
</g>
<!-- header_67 -->
<g id="node68" class="node">
<title>header_67</title>
<ellipse fill="none" stroke="#000000" cx="4674" cy="-2106.3034" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4674" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_67 -->
<g id="edge67" class="edge">
<title>section_29&#45;&gt;header_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4936.6829,-2557.6182C4899.0059,-2535.7024 4835.0449,-2493.5951 4797,-2441.4041 4724.5084,-2341.958 4690.4703,-2195.1616 4678.8475,-2134.3099"/>
<polygon fill="#000000" stroke="#000000" points="4682.2574,-2133.5017 4676.993,-2124.3073 4675.3747,-2134.7779 4682.2574,-2133.5017"/>
</g>
<!-- prose_68 -->
<g id="node69" class="node">
<title>prose_68</title>
<ellipse fill="none" stroke="#000000" cx="4838" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4838" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_68 -->
<g id="edge68" class="edge">
<title>section_29&#45;&gt;prose_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4951.1771,-2556.2863C4930.7247,-2532.1335 4895.7541,-2486.7866 4879,-2441.4041 4839.0615,-2333.2213 4836.2954,-2193.3867 4837.1541,-2134.4571"/>
<polygon fill="#000000" stroke="#000000" points="4840.6541,-2134.487 4837.3485,-2124.421 4833.6554,-2134.3514 4840.6541,-2134.487"/>
</g>
<!-- prose_69 -->
<g id="node70" class="node">
<title>prose_69</title>
<ellipse fill="none" stroke="#000000" cx="4920" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4920" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_69 -->
<g id="edge69" class="edge">
<title>section_29&#45;&gt;prose_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4965.1863,-2556.0526C4958.0113,-2484.6379 4931.5765,-2221.527 4922.8305,-2134.4759"/>
<polygon fill="#000000" stroke="#000000" points="4926.2905,-2133.9013 4921.8083,-2124.3013 4919.3255,-2134.6012 4926.2905,-2133.9013"/>
</g>
<!-- structure_70 -->
<g id="node71" class="node">
<title>structure_70</title>
<ellipse fill="none" stroke="#000000" cx="5015" cy="-2106.3034" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="5015" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_29&#45;&gt;structure_70 -->
<g id="edge70" class="edge">
<title>section_29&#45;&gt;structure_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4968.8522,-2556.0526C4976.1799,-2484.6379 5003.1772,-2221.527 5012.1093,-2134.4759"/>
<polygon fill="#000000" stroke="#000000" points="5015.6142,-2134.6064 5013.1533,-2124.3013 5008.6507,-2133.8918 5015.6142,-2134.6064"/>
</g>
<!-- prose_71 -->
<g id="node72" class="node">
<title>prose_71</title>
<ellipse fill="none" stroke="#000000" cx="5590" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5590" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_71 -->
<g id="edge71" class="edge">
<title>section_29&#45;&gt;prose_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4989.9118,-2556.9002C5086.2109,-2484.5907 5457.9981,-2205.4215 5562.5223,-2126.936"/>
<polygon fill="#000000" stroke="#000000" points="5564.7968,-2129.605 5570.6919,-2120.8016 5560.5936,-2124.0073 5564.7968,-2129.605"/>
</g>
<!-- prose_72 -->
<g id="node73" class="node">
<title>prose_72</title>
<ellipse fill="none" stroke="#000000" cx="5818" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5818" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_72 -->
<g id="edge72" class="edge">
<title>section_29&#45;&gt;prose_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5037.3184,-2567.5113C5188.1042,-2552.2046 5536.5121,-2510.228 5631,-2441.4041 5739.655,-2362.261 5793.1982,-2199.7115 5811.0077,-2134.3926"/>
<polygon fill="#000000" stroke="#000000" points="5814.4724,-2134.9819 5813.6532,-2124.4188 5807.7063,-2133.1872 5814.4724,-2134.9819"/>
</g>
<!-- codeblock_73 -->
<g id="node74" class="node">
<title>codeblock_73</title>
<ellipse fill="none" stroke="#000000" cx="6111" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6111" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;282</text>
</g>
<!-- section_29&#45;&gt;codeblock_73 -->
<g id="edge73" class="edge">
<title>section_29&#45;&gt;codeblock_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5040.9568,-2570.2746C5229.073,-2559.4168 5720.6753,-2523.7281 5859,-2441.4041 5986.0274,-2365.8037 6070.0975,-2199.278 6099.4292,-2133.6549"/>
<polygon fill="#000000" stroke="#000000" points="6102.6896,-2134.9352 6103.5121,-2124.3724 6096.2821,-2132.1169 6102.6896,-2134.9352"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1892,-984.6029 1554,-984.6029 1554,-928.7999 1892,-928.7999 1892,-984.6029"/>
<text text-anchor="middle" x="1723" y="-937.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.7528,-2088.2773C2225.3003,-2032.3552 2257.7907,-1860.2381 2171,-1771.2027 2086.496,-1684.5132 1990.4589,-1816.7693 1901,-1735.2027 1680.5243,-1534.1781 1704.9397,-1120.9972 1718.3222,-994.4025"/>
<polygon fill="#000000" stroke="#000000" points="1721.8062,-994.7387 1719.419,-984.4163 1714.8481,-993.9744 1721.8062,-994.7387"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2052,-974.7014 1910,-974.7014 1910,-938.7014 2052,-938.7014 2052,-974.7014"/>
<text text-anchor="middle" x="1981" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2332.3069,-2088.1494C2335.2803,-2031.8532 2336.1185,-1858.7611 2243,-1771.2027 2182.9289,-1714.7185 2116.5357,-1796.1519 2061,-1735.2027 1859.3211,-1513.8649 1945.6013,-1096.6404 1973.5064,-984.8519"/>
<polygon fill="#000000" stroke="#000000" points="1976.9382,-985.5583 1976.0131,-975.004 1970.1545,-983.8316 1976.9382,-985.5583"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2097" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2097" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.4662,-2088.2068C2477.128,-2032.0786 2506.9161,-1859.4244 2419,-1771.2027 2328.5669,-1680.4554 2219.9421,-1829.3001 2133,-1735.2027 2030.1753,-1623.9156 2079.7158,-1111.4648 2093.7211,-984.9825"/>
<polygon fill="#000000" stroke="#000000" points="2097.2125,-985.2546 2094.8505,-974.9264 2090.2562,-984.4733 2097.2125,-985.2546"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2690,-1735.2041 2142,-1735.2041 2142,-178.1988 2690,-178.1988 2690,-1735.2041"/>
<text text-anchor="middle" x="2416" y="-1720.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 2000</text>
<text text-anchor="middle" x="2416" y="-1688.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2416" y="-1673.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2416" y="-1657.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1642.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2416" y="-1627.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;time DATETIME DEFAULT CURRENT_TIMESTAMP</text>
<text text-anchor="middle" x="2416" y="-1611.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">);</text>
<text text-anchor="middle" x="2416" y="-1596.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-1564.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2416" y="-1549.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2416" y="-1534.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1518.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;project INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1503.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;line TEXT,</text>
<text text-anchor="middle" x="2416" y="-1487.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2416" y="-1472.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2416" y="-1457.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2416" y="-1441.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ON DELETE CASCADE</text>
<text text-anchor="middle" x="2416" y="-1426.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">);</text>
<text text-anchor="middle" x="2416" y="-1410.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-1379.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2416" y="-1364.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2416" y="-1348.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1333.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;line_id INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1317.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;repr text NOT NULL,</text>
<text text-anchor="middle" x="2416" y="-1302.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;value blob,</text>
<text text-anchor="middle" x="2416" y="-1287.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2416" y="-1271.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2416" y="-1256.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ON DELETE CASCADE</text>
<text text-anchor="middle" x="2416" y="-1240.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">);</text>
<text text-anchor="middle" x="2416" y="-1225.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-1194.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2416" y="-1178.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2416" y="-1163.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2416" y="-1147.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2416" y="-1132.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1117.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2416" y="-1101.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2416" y="-1086.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2416" y="-1070.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2416" y="-1055.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2416" y="-1040.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2416" y="-1024.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2416" y="-1009.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2416" y="-993.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-962.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2416" y="-947.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2416" y="-931.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-900.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2416" y="-884.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2416" y="-869.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-838.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2416" y="-822.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2416" y="-807.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-775.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2416" y="-760.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2416" y="-745.001" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-713.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2416" y="-698.201" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2416" y="-682.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2416" y="-667.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2416" y="-652.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2416" y="-636.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-605.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2416" y="-589.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2416" y="-574.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2416" y="-559.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-527.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_results = [[</text>
<text text-anchor="middle" x="2416" y="-512.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT result.repr</text>
<text text-anchor="middle" x="2416" y="-496.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM result</text>
<text text-anchor="middle" x="2416" y="-481.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE result.line_id = :line_id</text>
<text text-anchor="middle" x="2416" y="-466.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id;</text>
<text text-anchor="middle" x="2416" y="-450.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2416" y="-419.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2416" y="-387.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2416" y="-372.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2416" y="-357.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2416" y="-325.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2416" y="-294.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2416" y="-278.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2416" y="-263.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2416" y="-248.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2416" y="-232.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2416" y="-217.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2416" y="-201.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2416" y="-186.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2590.2198,-2088.2459C2582.9502,-2041.0306 2562.2172,-1906.3713 2537.4712,-1745.6478"/>
<polygon fill="#000000" stroke="#000000" points="2540.8927,-1744.8697 2535.9117,-1735.5188 2533.9742,-1745.935 2540.8927,-1744.8697"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="1954,-125.1 1900,-125.1 1900,-89.1 1954,-89.1 1954,-125.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2098.7755,-938.4698C2108.646,-833.2395 2153.0802,-303.8346 2061,-178.2001 2033.5699,-140.7745 2002.2547,-166.9419 1963,-142.2001 1958.5,-139.3638 1954.1025,-135.889 1950.0137,-132.2403"/>
<polygon fill="#000000" stroke="#000000" points="1952.2302,-129.517 1942.5855,-125.1317 1947.3904,-134.5743 1952.2302,-129.517"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2864,-974.7014 2708,-974.7014 2708,-938.7014 2864,-938.7014 2864,-974.7014"/>
<text text-anchor="middle" x="2786" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>header_40&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776.1571,-2088.2459C2777.3011,-1956.7256 2784.3472,-1146.7035 2785.7553,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="2789.2561,-984.7493 2785.8433,-974.7192 2782.2563,-984.6883 2789.2561,-984.7493"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2909" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_41&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2088.2459C2909,-1956.7256 2909,-1146.7035 2909,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-984.7191 2909,-974.7192 2905.5001,-984.7192 2912.5001,-984.7191"/>
</g>
<!-- raw_49 -->
<g id="node50" class="node">
<title>raw_49</title>
<ellipse fill="none" stroke="#000000" cx="2981" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2981" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_49 -->
<g id="edge49" class="edge">
<title>prose_42&#45;&gt;raw_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.8429,-2088.2459C2989.6989,-1956.7256 2982.6528,-1146.7035 2981.2447,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="2984.7437,-984.6883 2981.1567,-974.7192 2977.7439,-984.7493 2984.7437,-984.6883"/>
</g>
<!-- hashline_51 -->
<g id="node52" class="node">
<title>hashline_51</title>
<ellipse fill="none" stroke="#000000" cx="3069" cy="-956.7014" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="3069" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_43&#45;&gt;hashline_51 -->
<g id="edge51" class="edge">
<title>structure_43&#45;&gt;hashline_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3085.733,-2088.2459C3083.7881,-1956.7256 3071.8097,-1146.7035 3069.416,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="3072.914,-984.6663 3069.2664,-974.7192 3065.9148,-984.7699 3072.914,-984.6663"/>
</g>
<!-- raw_54 -->
<g id="node55" class="node">
<title>raw_54</title>
<ellipse fill="none" stroke="#000000" cx="3157" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3157" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_44&#45;&gt;raw_54 -->
<g id="edge54" class="edge">
<title>prose_44&#45;&gt;raw_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3180.623,-2088.2459C3177.8773,-1956.7256 3160.9666,-1146.7035 3157.5873,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="3161.0842,-984.6439 3157.3762,-974.7192 3154.0857,-984.7901 3161.0842,-984.6439"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3757.5,-1369.0031 3202.5,-1369.0031 3202.5,-544.3998 3757.5,-544.3998 3757.5,-1369.0031"/>
<text text-anchor="middle" x="3480" y="-1353.9022" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3480" y="-1338.5022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3480" y="-1323.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3480" y="-1307.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3480" y="-1292.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3480" y="-1276.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3480" y="-1261.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3480" y="-1246.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3480" y="-1230.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3480" y="-1215.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3480" y="-1199.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3480" y="-1184.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3480" y="-1169.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-1153.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3480" y="-1138.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3480" y="-1122.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3480" y="-1107.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3480" y="-1092.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3480" y="-1076.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3480" y="-1061.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3480" y="-1045.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-1030.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3480" y="-1015.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3480" y="-999.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-984.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-952.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3480" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3480" y="-922.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3480" y="-906.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3480" y="-891.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3480" y="-875.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create result retrieval prepared statement</text>
<text text-anchor="middle" x="3480" y="-860.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.get_results = conn:prepare(get_results)</text>
<text text-anchor="middle" x="3480" y="-845.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3480" y="-829.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3480" y="-814.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3480" y="-798.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val &#160;= sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3480" y="-783.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val then</text>
<text text-anchor="middle" x="3480" y="-768.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3480" y="-752.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3480" y="-737.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.line_ids = line_ids</text>
<text text-anchor="middle" x="3480" y="-721.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3480" y="-706.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3480" y="-691.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3480" y="-675.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3480" y="-660.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3480" y="-644.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-629.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3480" y="-614.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3480" y="-598.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3480" y="-583.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3480" y="-567.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3480" y="-552.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_45&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>codeblock_45&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3401.2566,-2088.2459C3406.9169,-2006.9068 3430.6368,-1666.0518 3450.5778,-1379.4986"/>
<polygon fill="#000000" stroke="#000000" points="3454.0828,-1379.5473 3451.2856,-1369.3285 3447.0997,-1379.0613 3454.0828,-1379.5473"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="2492,-135.0015 1972,-135.0015 1972,-79.1986 2492,-79.1986 2492,-135.0015"/>
<text text-anchor="middle" x="2232" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2911.1981,-938.4308C2923.5927,-831.845 2980.4566,-291.1983 2873,-178.2001 2844.3835,-148.1079 2542.2611,-146.8872 2501,-142.2001 2484.1789,-140.2893 2466.7782,-138.223 2449.2921,-136.0827"/>
<polygon fill="#000000" stroke="#000000" points="2449.3432,-132.5627 2438.9905,-134.8146 2448.4879,-139.5102 2449.3432,-132.5627"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="3009.5,-134.4005 2510.5,-134.4005 2510.5,-79.7996 3009.5,-79.7996 3009.5,-134.4005"/>
<text text-anchor="middle" x="2760" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2760" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_49&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>raw_49&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2982.747,-938.4904C2992.4575,-833.3766 3036.1432,-304.516 2945,-178.2001 2934.6942,-163.9172 2903.0455,-149.6874 2868.7721,-137.7523"/>
<polygon fill="#000000" stroke="#000000" points="2869.6456,-134.3527 2859.0512,-134.4488 2867.3932,-140.9804 2869.6456,-134.3527"/>
</g>
<!-- hashtag_52 -->
<g id="node53" class="node">
<title>hashtag_52</title>
<ellipse fill="none" stroke="#000000" cx="3069" cy="-107.1" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="3069" y="-102.9" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_51&#45;&gt;hashtag_52 -->
<g id="edge52" class="edge">
<title>hashline_51&#45;&gt;hashtag_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3069,-938.5632C3069,-830.2631 3069,-269.2221 3069,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="3072.5001,-135.4293 3069,-125.4293 3065.5001,-135.4293 3072.5001,-135.4293"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="3096,-36 3042,-36 3042,0 3096,0 3096,-36"/>
<text text-anchor="middle" x="3069" y="-14.5" font-family="Inconsolata" font-size="14.00" fill="#000000">todo</text>
</g>
<!-- hashtag_52&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>hashtag_52&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3069,-89.0693C3069,-76.7509 3069,-60.1792 3069,-46.1369"/>
<polygon fill="#000000" stroke="#000000" points="3072.5001,-46.0039 3069,-36.0039 3065.5001,-46.0039 3072.5001,-46.0039"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3333.5,-127.0021 3128.5,-127.0021 3128.5,-87.198 3333.5,-87.198 3333.5,-127.0021"/>
<text text-anchor="middle" x="3231" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">the results never get used.</text>
</g>
<!-- raw_54&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>raw_54&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3154.9643,-938.71C3145.7793,-852.3448 3112.0542,-472.37 3193,-178.2001 3197.0936,-163.3234 3204.7084,-148.0743 3212.0526,-135.5324"/>
<polygon fill="#000000" stroke="#000000" points="3215.0842,-137.2834 3217.2983,-126.9225 3209.1063,-133.6413 3215.0842,-137.2834"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4106.5,-974.7014 3775.5,-974.7014 3775.5,-938.7014 4106.5,-938.7014 4106.5,-974.7014"/>
<text text-anchor="middle" x="3941" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_57&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>header_57&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3909.5026,-2088.2459C3913.1636,-1956.7256 3935.7112,-1146.7035 3940.2169,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="3943.7188,-984.8127 3940.4985,-974.7192 3936.7215,-984.6179 3943.7188,-984.8127"/>
</g>
<!-- raw_62 -->
<g id="node63" class="node">
<title>raw_62</title>
<ellipse fill="none" stroke="#000000" cx="4152" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4152" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_58&#45;&gt;raw_62 -->
<g id="edge62" class="edge">
<title>prose_58&#45;&gt;raw_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4150.0314,-2088.2459C4150.2602,-1956.7256 4151.6694,-1146.7035 4151.9511,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="4155.4512,-984.7253 4151.9687,-974.7192 4148.4512,-984.713 4155.4512,-984.7253"/>
</g>
<!-- raw_64 -->
<g id="node65" class="node">
<title>raw_64</title>
<ellipse fill="none" stroke="#000000" cx="4229" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4229" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_59&#45;&gt;raw_64 -->
<g id="edge64" class="edge">
<title>prose_59&#45;&gt;raw_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4231.9529,-2088.2459C4231.6097,-1956.7256 4229.4958,-1146.7035 4229.0734,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="4232.5732,-984.71 4229.047,-974.7192 4225.5732,-984.7283 4232.5732,-984.71"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4397,-974.7014 4343,-974.7014 4343,-938.7014 4397,-938.7014 4397,-974.7014"/>
</g>
<!-- codeblock_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>codeblock_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4370,-2088.2459C4370,-1956.7256 4370,-1146.7035 4370,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="4373.5001,-984.7191 4370,-974.7192 4366.5001,-984.7192 4373.5001,-984.7191"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="3718,-135.0015 3352,-135.0015 3352,-79.1986 3718,-79.1986 3718,-135.0015"/>
<text text-anchor="middle" x="3535" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_62&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>raw_62&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4154.1793,-938.4226C4166.4635,-831.7902 4222.7585,-290.9233 4115,-178.2001 4085.0819,-146.9036 3769.8926,-148.0989 3727,-142.2001 3714.6828,-140.5062 3701.9522,-138.5768 3689.1797,-136.5142"/>
<polygon fill="#000000" stroke="#000000" points="3689.3693,-132.9986 3678.9346,-134.8335 3688.2361,-139.9063 3689.3693,-132.9986"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4081.5,-127.0021 3736.5,-127.0021 3736.5,-87.198 4081.5,-87.198 4081.5,-127.0021"/>
<text text-anchor="middle" x="3909" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_64&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>raw_64&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4234.7538,-939.06C4263.5939,-846.9645 4383.482,-416.532 4188,-178.2001 4176.8169,-164.5657 4093.1897,-144.359 4020.3818,-128.9684"/>
<polygon fill="#000000" stroke="#000000" points="4020.6944,-125.4578 4010.1887,-126.8298 4019.257,-132.3087 4020.6944,-125.4578"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="4783.5,-974.7014 4564.5,-974.7014 4564.5,-938.7014 4783.5,-938.7014 4783.5,-974.7014"/>
<text text-anchor="middle" x="4674" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_67&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>header_67&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4674,-2088.2459C4674,-1956.7256 4674,-1146.7035 4674,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="4677.5001,-984.7191 4674,-974.7192 4670.5001,-984.7192 4677.5001,-984.7191"/>
</g>
<!-- raw_75 -->
<g id="node76" class="node">
<title>raw_75</title>
<ellipse fill="none" stroke="#000000" cx="4834" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4834" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_68&#45;&gt;raw_75 -->
<g id="edge75" class="edge">
<title>prose_68&#45;&gt;raw_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4837.9372,-2088.2459C4837.4795,-1956.7256 4834.6611,-1146.7035 4834.0979,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="4837.5976,-984.7069 4834.0627,-974.7192 4830.5976,-984.7313 4837.5976,-984.7069"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="4913" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4913" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_69&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_69&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4919.89,-2088.2459C4919.0892,-1956.7256 4914.1569,-1146.7035 4913.1713,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="4916.6706,-984.6976 4913.1097,-974.7192 4909.6708,-984.7403 4916.6706,-984.6976"/>
</g>
<!-- hashline_79 -->
<g id="node80" class="node">
<title>hashline_79</title>
<ellipse fill="none" stroke="#000000" cx="5015" cy="-956.7014" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="5015" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_70&#45;&gt;hashline_79 -->
<g id="edge79" class="edge">
<title>structure_70&#45;&gt;hashline_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5015,-2088.2459C5015,-1956.7256 5015,-1146.7035 5015,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="5018.5001,-984.7191 5015,-974.7192 5011.5001,-984.7192 5018.5001,-984.7191"/>
</g>
<!-- raw_82 -->
<g id="node83" class="node">
<title>raw_82</title>
<ellipse fill="none" stroke="#000000" cx="5300" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5300" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_71&#45;&gt;raw_82 -->
<g id="edge82" class="edge">
<title>prose_71&#45;&gt;raw_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5578.4739,-2089.0808C5544.7765,-2037.7952 5445.9819,-1880.5985 5401,-1735.2027 5313.3599,-1451.9224 5301.7351,-1087.8334 5300.2199,-984.9109"/>
<polygon fill="#000000" stroke="#000000" points="5303.7172,-984.672 5300.0913,-974.717 5296.7178,-984.7604 5303.7172,-984.672"/>
</g>
<!-- prespace_83 -->
<g id="node84" class="node">
<title>prespace_83</title>
<ellipse fill="none" stroke="#000000" cx="5456" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5456" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_71&#45;&gt;prespace_83 -->
<g id="edge83" class="edge">
<title>prose_71&#45;&gt;prespace_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5585.3099,-2088.3076C5571.5867,-2034.8949 5531.2682,-1872.4393 5512,-1735.2027 5471.0994,-1443.8909 5459.2963,-1086.8152 5456.6532,-984.9992"/>
<polygon fill="#000000" stroke="#000000" points="5460.1497,-984.8107 5456.3998,-974.9017 5453.1519,-984.9864 5460.1497,-984.8107"/>
</g>
<!-- literal_84 -->
<g id="node85" class="node">
<title>literal_84</title>
<ellipse fill="none" stroke="#000000" cx="5552" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5552" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_71&#45;&gt;literal_84 -->
<g id="edge84" class="edge">
<title>prose_71&#45;&gt;literal_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5589.4031,-2088.2459C5585.0557,-1956.7256 5558.2805,-1146.7035 5552.9299,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="5556.4241,-984.598 5552.5956,-974.7192 5549.428,-984.8294 5556.4241,-984.598"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5628" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5628" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_71&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_71&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5590.5969,-2088.2459C5594.9443,-1956.7256 5621.7195,-1146.7035 5627.0701,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="5630.572,-984.8294 5627.4044,-974.7192 5623.5759,-984.598 5630.572,-984.8294"/>
</g>
<!-- prespace_86 -->
<g id="node87" class="node">
<title>prespace_86</title>
<ellipse fill="none" stroke="#000000" cx="5719" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5719" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_71&#45;&gt;prespace_86 -->
<g id="edge86" class="edge">
<title>prose_71&#45;&gt;prespace_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5594.4352,-2088.2904C5607.4153,-2034.8306 5645.5687,-1872.2583 5664,-1735.2027 5703.2034,-1443.6847 5715.4687,-1086.7525 5718.2915,-984.9849"/>
<polygon fill="#000000" stroke="#000000" points="5721.7927,-984.983 5718.5633,-974.8923 5714.7952,-984.7944 5721.7927,-984.983"/>
</g>
<!-- literal_87 -->
<g id="node88" class="node">
<title>literal_87</title>
<ellipse fill="none" stroke="#000000" cx="5815" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5815" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_71&#45;&gt;literal_87 -->
<g id="edge87" class="edge">
<title>prose_71&#45;&gt;literal_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5601.7324,-2089.1782C5635.9448,-2038.1606 5735.6029,-1881.6264 5774,-1735.2027 5848.6115,-1450.6788 5826.0895,-1088.1701 5817.5833,-985.1475"/>
<polygon fill="#000000" stroke="#000000" points="5821.0497,-984.6032 5816.7146,-974.9358 5814.0749,-985.1965 5821.0497,-984.6032"/>
</g>
<!-- raw_88 -->
<g id="node89" class="node">
<title>raw_88</title>
<ellipse fill="none" stroke="#000000" cx="5891" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5891" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_71&#45;&gt;raw_88 -->
<g id="edge88" class="edge">
<title>prose_71&#45;&gt;raw_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5595.4903,-2088.5142C5613.137,-2034.0032 5673.3778,-1867.1778 5777,-1771.2027 5805.0118,-1745.2582 5833.6848,-1766.8798 5855,-1735.2027 5939.4114,-1609.7568 5903.8704,-1109.9501 5893.4874,-985.0844"/>
<polygon fill="#000000" stroke="#000000" points="5896.95,-984.4935 5892.62,-974.8239 5889.9749,-985.0832 5896.95,-984.4935"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="5963" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5963" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_72&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_72&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5824.8931,-2088.5132C5845.003,-2035.6663 5903.651,-1874.6092 5927,-1735.2027 5975.5196,-1445.5133 5967.6374,-1087.3084 5964.1205,-985.1116"/>
<polygon fill="#000000" stroke="#000000" points="5967.6132,-984.8436 5963.7564,-974.9757 5960.6177,-985.0949 5967.6132,-984.8436"/>
</g>
<!-- leaf_98 -->
<g id="node99" class="node">
<title>leaf_98</title>
<polygon fill="none" stroke="#c0c0c0" points="6521.5,-1222.9025 6008.5,-1222.9025 6008.5,-690.5004 6521.5,-690.5004 6521.5,-1222.9025"/>
<text text-anchor="middle" x="6265" y="-1207.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = table.concat</text>
<text text-anchor="middle" x="6265" y="-1192.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6265" y="-1176.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6265" y="-1161.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6265" y="-1146.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6265" y="-1130.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6265" y="-1115.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6265" y="-1099.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6265" y="-1084.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6265" y="-1069.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6265" y="-1053.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6265" y="-1038.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-1022.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6265" y="-1007.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table.insert(historian.line_ids, line_id)</text>
<text text-anchor="middle" x="6265" y="-992.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6265" y="-976.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 1, results.n do</text>
<text text-anchor="middle" x="6265" y="-961.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6265" y="-945.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local res = results[i]</text>
<text text-anchor="middle" x="6265" y="-930.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6265" y="-915.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = repr.ts(res) }</text>
<text text-anchor="middle" x="6265" y="-899.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6265" y="-884.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6265" y="-868.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6265" y="-853.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-838.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-822.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-791.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6265" y="-775.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6265" y="-760.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6265" y="-745.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6265" y="-729.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6265" y="-714.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6265" y="-698.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_73&#45;&gt;leaf_98 -->
<g id="edge98" class="edge">
<title>codeblock_73&#45;&gt;leaf_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6113.419,-2088.2459C6126.2549,-1992.4266 6187.3348,-1536.4679 6227.9345,-1233.3935"/>
<polygon fill="#000000" stroke="#000000" points="6231.4511,-1233.5026 6229.3099,-1223.1264 6224.513,-1232.5732 6231.4511,-1233.5026"/>
</g>
<!-- leaf_76 -->
<g id="node77" class="node">
<title>leaf_76</title>
<polygon fill="none" stroke="#c0c0c0" points="4374.5,-135.0015 4099.5,-135.0015 4099.5,-79.1986 4374.5,-79.1986 4374.5,-135.0015"/>
<text text-anchor="middle" x="4237" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_75&#45;&gt;leaf_76 -->
<g id="edge76" class="edge">
<title>raw_75&#45;&gt;leaf_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4836.0222,-938.7519C4847.5317,-832.8547 4900.5251,-290.4915 4792,-178.2001 4760.3734,-145.4759 4428.9195,-149.5044 4384,-142.2001 4374.6777,-140.6842 4365.0706,-138.9007 4355.4432,-136.9547"/>
<polygon fill="#000000" stroke="#000000" points="4355.9169,-133.4785 4345.4142,-134.8724 4354.4938,-140.3323 4355.9169,-133.4785"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="4955,-142.3004 4393,-142.3004 4393,-71.8997 4955,-71.8997 4955,-142.3004"/>
<text text-anchor="middle" x="4674" y="-111.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4674" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4674" y="-80.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_77&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_77&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4914.6033,-938.4532C4923.4813,-833.1298 4962.9384,-303.2894 4870,-178.2001 4861.5032,-166.764 4839.6995,-155.6382 4813.5757,-145.7133"/>
<polygon fill="#000000" stroke="#000000" points="4814.7636,-142.421 4804.1701,-142.2542 4812.3474,-148.9908 4814.7636,-142.421"/>
</g>
<!-- hashtag_80 -->
<g id="node81" class="node">
<title>hashtag_80</title>
<ellipse fill="none" stroke="#000000" cx="5015" cy="-107.1" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="5015" y="-102.9" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_79&#45;&gt;hashtag_80 -->
<g id="edge80" class="edge">
<title>hashline_79&#45;&gt;hashtag_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5015,-938.5632C5015,-830.2631 5015,-269.2221 5015,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="5018.5001,-135.4293 5015,-125.4293 5011.5001,-135.4293 5018.5001,-135.4293"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5042,-36 4988,-36 4988,0 5042,0 5042,-36"/>
<text text-anchor="middle" x="5015" y="-14.5" font-family="Inconsolata" font-size="14.00" fill="#000000">todo</text>
</g>
<!-- hashtag_80&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>hashtag_80&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5015,-89.0693C5015,-76.7509 5015,-60.1792 5015,-46.1369"/>
<polygon fill="#000000" stroke="#000000" points="5018.5001,-46.0039 5015,-36.0039 5011.5001,-46.0039 5018.5001,-46.0039"/>
</g>
<!-- leaf_89 -->
<g id="node90" class="node">
<title>leaf_89</title>
<polygon fill="none" stroke="#c0c0c0" points="5461.5,-127.0021 5074.5,-127.0021 5074.5,-87.198 5461.5,-87.198 5461.5,-127.0021"/>
<text text-anchor="middle" x="5268" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_82&#45;&gt;leaf_89 -->
<g id="edge89" class="edge">
<title>raw_82&#45;&gt;leaf_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5299.3168,-938.5632C5295.2513,-830.6227 5274.2464,-272.9424 5269.1264,-137.0048"/>
<polygon fill="#000000" stroke="#000000" points="5272.62,-136.7671 5268.746,-126.906 5265.6249,-137.0306 5272.62,-136.7671"/>
</g>
<!-- leaf_90 -->
<g id="node91" class="node">
<title>leaf_90</title>
<polygon fill="none" stroke="#c0c0c0" points="5534,-125.1 5480,-125.1 5480,-89.1 5534,-89.1 5534,-125.1"/>
<text text-anchor="middle" x="5507" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_83&#45;&gt;leaf_90 -->
<g id="edge90" class="edge">
<title>prespace_83&#45;&gt;leaf_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5457.0888,-938.5632C5463.5899,-830.2631 5497.2681,-269.2221 5505.2856,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="5508.7941,-135.6211 5505.8997,-125.4293 5501.8067,-135.2016 5508.7941,-135.6211"/>
</g>
<!-- leaf_91 -->
<g id="node92" class="node">
<title>leaf_91</title>
<polygon fill="none" stroke="#c0c0c0" points="5617.5,-125.1 5552.5,-125.1 5552.5,-89.1 5617.5,-89.1 5617.5,-125.1"/>
<text text-anchor="middle" x="5585" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_84&#45;&gt;leaf_91 -->
<g id="edge91" class="edge">
<title>literal_84&#45;&gt;leaf_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5552.7045,-938.5632C5556.9111,-830.2631 5578.7029,-269.2221 5583.8907,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="5587.3972,-135.5576 5584.2881,-125.4293 5580.4025,-135.2859 5587.3972,-135.5576"/>
</g>
<!-- leaf_92 -->
<g id="node93" class="node">
<title>leaf_92</title>
<polygon fill="none" stroke="#c0c0c0" points="5904,-126.4006 5636,-126.4006 5636,-87.7995 5904,-87.7995 5904,-126.4006"/>
<text text-anchor="middle" x="5770" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5770" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_85&#45;&gt;leaf_92 -->
<g id="edge92" class="edge">
<title>raw_85&#45;&gt;leaf_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5626.6751,-938.4369C5619.427,-834.1342 5587.6224,-313.7604 5664,-178.2001 5675.272,-158.1937 5694.7877,-142.7338 5714.026,-131.4179"/>
<polygon fill="#000000" stroke="#000000" points="5715.7913,-134.4409 5722.815,-126.5088 5712.3778,-128.3295 5715.7913,-134.4409"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="5976,-125.1 5922,-125.1 5922,-89.1 5976,-89.1 5976,-125.1"/>
<text text-anchor="middle" x="5949" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_86&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>prespace_86&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5717.5839,-938.6415C5709.7077,-833.255 5675.1454,-298.276 5775,-178.2001 5815.5287,-129.464 5857.8033,-173.3626 5913,-142.2001 5917.8458,-139.4643 5922.5107,-135.9144 5926.7841,-132.1255"/>
<polygon fill="#000000" stroke="#000000" points="5929.231,-134.6283 5934.0083,-125.1717 5924.3764,-129.5851 5929.231,-134.6283"/>
</g>
<!-- leaf_94 -->
<g id="node95" class="node">
<title>leaf_94</title>
<polygon fill="none" stroke="#c0c0c0" points="6052,-125.1 5994,-125.1 5994,-89.1 6052,-89.1 6052,-125.1"/>
<text text-anchor="middle" x="6023" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_87&#45;&gt;leaf_94 -->
<g id="edge94" class="edge">
<title>literal_87&#45;&gt;leaf_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5813.2068,-938.689C5803.1306,-833.5732 5757.4123,-299.8731 5855,-178.2001 5892.5103,-131.432 5932.6171,-171.3601 5985,-142.2001 5989.9044,-139.47 5994.679,-135.9808 5999.095,-132.2659"/>
<polygon fill="#000000" stroke="#000000" points="6001.5525,-134.7621 6006.6068,-125.4506 5996.8489,-129.5779 6001.5525,-134.7621"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6156,-125.1 6070,-125.1 6070,-89.1 6156,-89.1 6156,-125.1"/>
<text text-anchor="middle" x="6113" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_88&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_88&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5889.0917,-938.6844C5878.3471,-833.5422 5829.2806,-299.7172 5927,-178.2001 5965.6451,-130.1437 6004.8979,-167.8011 6061,-142.2001 6067.8124,-139.0914 6074.7162,-135.1209 6081.1709,-130.9758"/>
<polygon fill="#000000" stroke="#000000" points="6083.2975,-133.7635 6089.6436,-125.2795 6079.3919,-127.9543 6083.2975,-133.7635"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="6708,-134.4005 6174,-134.4005 6174,-79.7996 6708,-79.7996 6708,-134.4005"/>
<text text-anchor="middle" x="6441" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6441" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5960.9094,-938.5299C5949.1272,-832.5083 5895.1567,-294.5276 5999,-178.2001 6007.2503,-168.9579 6116.9524,-151.2815 6224.9887,-135.8666"/>
<polygon fill="#000000" stroke="#000000" points="6225.6908,-139.3021 6235.0989,-134.4299 6224.7059,-132.3717 6225.6908,-139.3021"/>
</g>
<!-- leaf_104 -->
<g id="node105" class="node">
<title>leaf_104</title>
<polygon fill="none" stroke="#c0c0c0" points="7203.5,-2124.3034 7012.5,-2124.3034 7012.5,-2088.3034 7203.5,-2088.3034 7203.5,-2124.3034"/>
<text text-anchor="middle" x="7108" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_99&#45;&gt;leaf_104 -->
<g id="edge104" class="edge">
<title>header_99&#45;&gt;leaf_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7108,-2556.0526C7108,-2484.7184 7108,-2222.12 7108,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="7111.5001,-2134.5536 7108,-2124.5537 7104.5001,-2134.5537 7111.5001,-2134.5536"/>
</g>
<!-- raw_105 -->
<g id="node106" class="node">
<title>raw_105</title>
<ellipse fill="none" stroke="#000000" cx="7257" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="7257" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_105 -->
<g id="edge105" class="edge">
<title>prose_100&#45;&gt;raw_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7265.6527,-2556.0526C7264.2803,-2484.7184 7259.2282,-2222.12 7257.5477,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="7261.0429,-2134.4844 7257.3511,-2124.5537 7254.0442,-2134.6192 7261.0429,-2134.4844"/>
</g>
<!-- raw_107 -->
<g id="node108" class="node">
<title>raw_107</title>
<ellipse fill="none" stroke="#000000" cx="7348" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="7348" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_101&#45;&gt;raw_107 -->
<g id="edge107" class="edge">
<title>prose_101&#45;&gt;raw_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7348,-2556.0526C7348,-2484.7184 7348,-2222.12 7348,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="7351.5001,-2134.5536 7348,-2124.5537 7344.5001,-2134.5537 7351.5001,-2134.5536"/>
</g>
<!-- header_109 -->
<g id="node110" class="node">
<title>header_109</title>
<ellipse fill="none" stroke="#000000" cx="7742" cy="-2106.3034" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7742" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuzz_patt</text>
</g>
<!-- section_102&#45;&gt;header_109 -->
<g id="edge109" class="edge">
<title>section_102&#45;&gt;header_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7931.3981,-2556.0526C7901.2321,-2484.4198 7789.8451,-2219.9176 7753.5301,-2133.683"/>
<polygon fill="#000000" stroke="#000000" points="7756.6861,-2132.1591 7749.5793,-2124.3013 7750.2348,-2134.8759 7756.6861,-2132.1591"/>
</g>
<!-- prose_110 -->
<g id="node111" class="node">
<title>prose_110</title>
<ellipse fill="none" stroke="#000000" cx="7939" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7939" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_102&#45;&gt;prose_110 -->
<g id="edge110" class="edge">
<title>section_102&#45;&gt;prose_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7939,-2556.0526C7939,-2484.7184 7939,-2222.12 7939,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="7942.5001,-2134.5536 7939,-2124.5537 7935.5001,-2134.5537 7942.5001,-2134.5536"/>
</g>
<!-- prose_111 -->
<g id="node112" class="node">
<title>prose_111</title>
<ellipse fill="none" stroke="#000000" cx="8322" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8322" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_102&#45;&gt;prose_111 -->
<g id="edge111" class="edge">
<title>section_102&#45;&gt;prose_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7953.5464,-2556.3371C8012.4643,-2484.3741 8233.4706,-2214.4343 8301.7655,-2131.0181"/>
<polygon fill="#000000" stroke="#000000" points="8304.622,-2133.054 8308.2488,-2123.0993 8299.2058,-2128.6196 8304.622,-2133.054"/>
</g>
<!-- codeblock_112 -->
<g id="node113" class="node">
<title>codeblock_112</title>
<ellipse fill="none" stroke="#000000" cx="8656" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8656" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 304&#45;318</text>
</g>
<!-- section_102&#45;&gt;codeblock_112 -->
<g id="edge112" class="edge">
<title>section_102&#45;&gt;codeblock_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8004.3986,-2564.9874C8091.9708,-2550.3688 8249.4478,-2515.4467 8363,-2441.4041 8494.111,-2355.9121 8601.1628,-2195.9419 8640.1566,-2132.8565"/>
<polygon fill="#000000" stroke="#000000" points="8643.1755,-2134.6286 8645.4107,-2124.2722 8637.205,-2130.9743 8643.1755,-2134.6286"/>
</g>
<!-- header_135 -->
<g id="node136" class="node">
<title>header_135</title>
<ellipse fill="none" stroke="#000000" cx="9232" cy="-2106.3034" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9232" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_103&#45;&gt;header_135 -->
<g id="edge135" class="edge">
<title>section_103&#45;&gt;header_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9461.7774,-2556.0526C9425.1429,-2484.347 9289.7711,-2219.3803 9245.8544,-2133.4209"/>
<polygon fill="#000000" stroke="#000000" points="9248.8616,-2131.6141 9241.1952,-2124.3013 9242.628,-2134.7988 9248.8616,-2131.6141"/>
</g>
<!-- prose_136 -->
<g id="node137" class="node">
<title>prose_136</title>
<ellipse fill="none" stroke="#000000" cx="9471" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9471" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_103&#45;&gt;prose_136 -->
<g id="edge136" class="edge">
<title>section_103&#45;&gt;prose_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9471,-2556.0526C9471,-2484.7184 9471,-2222.12 9471,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="9474.5001,-2134.5536 9471,-2124.5537 9467.5001,-2134.5537 9474.5001,-2134.5536"/>
</g>
<!-- prose_137 -->
<g id="node138" class="node">
<title>prose_137</title>
<ellipse fill="none" stroke="#000000" cx="9586" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9586" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_103&#45;&gt;prose_137 -->
<g id="edge137" class="edge">
<title>section_103&#45;&gt;prose_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9477.1866,-2555.7806C9485.6665,-2530.3065 9501.0897,-2482.6656 9512,-2441.4041 9541.8325,-2328.581 9569.3355,-2192.2276 9580.6086,-2134.403"/>
<polygon fill="#000000" stroke="#000000" points="9584.1138,-2134.7122 9582.5822,-2124.2287 9577.2419,-2133.3791 9584.1138,-2134.7122"/>
</g>
<!-- codeblock_138 -->
<g id="node139" class="node">
<title>codeblock_138</title>
<ellipse fill="none" stroke="#000000" cx="9855" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9855" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 330&#45;394</text>
</g>
<!-- section_103&#45;&gt;codeblock_138 -->
<g id="edge138" class="edge">
<title>section_103&#45;&gt;codeblock_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9494.9323,-2556.9679C9527.1338,-2533.227 9585.189,-2487.9662 9627,-2441.4041 9720.715,-2337.0398 9806.7241,-2192.03 9840.2079,-2132.949"/>
<polygon fill="#000000" stroke="#000000" points="9843.2643,-2134.6544 9845.124,-2124.2241 9837.1657,-2131.2182 9843.2643,-2134.6544"/>
</g>
<!-- leaf_106 -->
<g id="node107" class="node">
<title>leaf_106</title>
<polygon fill="none" stroke="#c0c0c0" points="7052.5,-992.0018 6539.5,-992.0018 6539.5,-921.4011 7052.5,-921.4011 7052.5,-992.0018"/>
<text text-anchor="middle" x="6796" y="-944.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6796" y="-929.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_105&#45;&gt;leaf_106 -->
<g id="edge106" class="edge">
<title>raw_105&#45;&gt;leaf_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7260.8655,-2088.189C7271.5503,-2032.7417 7295.461,-1863.508 7212,-1771.2027 7165.7286,-1720.028 7112.0241,-1781.6402 7061,-1735.2027 6838.6834,-1532.8707 6802.8031,-1136.7546 6797.0702,-1002.4746"/>
<polygon fill="#000000" stroke="#000000" points="6800.5547,-1002.0063 6796.6677,-992.1503 6793.56,-1002.2791 6800.5547,-1002.0063"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7625.5,-999.9017 7070.5,-999.9017 7070.5,-913.5011 7625.5,-913.5011 7625.5,-999.9017"/>
<text text-anchor="middle" x="7348" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7348" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7348" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_107&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>raw_107&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7348,-2088.2459C7348,-1962.5386 7348,-1216.9822 7348,-1009.9817"/>
<polygon fill="#000000" stroke="#000000" points="7351.5001,-1009.964 7348,-999.9641 7344.5001,-1009.9641 7351.5001,-1009.964"/>
</g>
<!-- leaf_113 -->
<g id="node114" class="node">
<title>leaf_113</title>
<polygon fill="none" stroke="#c0c0c0" points="7750.5,-974.7014 7643.5,-974.7014 7643.5,-938.7014 7750.5,-938.7014 7750.5,-974.7014"/>
<text text-anchor="middle" x="7697" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuzz_patt</text>
</g>
<!-- header_109&#45;&gt;leaf_113 -->
<g id="edge113" class="edge">
<title>header_109&#45;&gt;leaf_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7741.2932,-2088.2459C7736.1449,-1956.7256 7704.4374,-1146.7035 7698.1012,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="7701.5938,-984.5746 7697.7053,-974.7192 7694.5992,-984.8484 7701.5938,-984.5746"/>
</g>
<!-- raw_114 -->
<g id="node115" class="node">
<title>raw_114</title>
<ellipse fill="none" stroke="#000000" cx="7796" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7796" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_110&#45;&gt;raw_114 -->
<g id="edge114" class="edge">
<title>prose_110&#45;&gt;raw_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7932.238,-2088.4996C7912.5098,-2035.6151 7854.9693,-1874.4653 7832,-1735.2027 7784.2002,-1445.3937 7791.5814,-1087.272 7794.9294,-985.1033"/>
<polygon fill="#000000" stroke="#000000" points="7798.432,-985.0842 7795.2764,-974.9702 7791.4361,-984.8445 7798.432,-985.0842"/>
</g>
<!-- prespace_115 -->
<g id="node116" class="node">
<title>prespace_115</title>
<ellipse fill="none" stroke="#000000" cx="7887" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7887" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_110&#45;&gt;prespace_115 -->
<g id="edge115" class="edge">
<title>prose_110&#45;&gt;prespace_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7938.1832,-2088.2459C7932.2341,-1956.7256 7895.5944,-1146.7035 7888.2725,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="7891.7634,-984.5508 7887.815,-974.7192 7884.7705,-984.8671 7891.7634,-984.5508"/>
</g>
<!-- literal_116 -->
<g id="node117" class="node">
<title>literal_116</title>
<ellipse fill="none" stroke="#000000" cx="7983" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7983" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_110&#45;&gt;literal_116 -->
<g id="edge116" class="edge">
<title>prose_110&#45;&gt;literal_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7939.6911,-2088.2459C7944.725,-1956.7256 7975.7278,-1146.7035 7981.9232,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="7985.4253,-984.8457 7982.3104,-974.7192 7978.4304,-984.578 7985.4253,-984.8457"/>
</g>
<!-- raw_117 -->
<g id="node118" class="node">
<title>raw_117</title>
<ellipse fill="none" stroke="#000000" cx="8059" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8059" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_110&#45;&gt;raw_117 -->
<g id="edge117" class="edge">
<title>prose_110&#45;&gt;raw_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7944.2515,-2088.3606C7959.5824,-2035.0938 8004.367,-1872.9988 8023,-1735.2027 8062.3596,-1444.1273 8060.8529,-1086.8871 8059.4857,-985.0156"/>
<polygon fill="#000000" stroke="#000000" points="8062.9839,-984.8605 8059.3387,-974.9125 8055.9846,-984.9624 8062.9839,-984.8605"/>
</g>
<!-- prespace_122 -->
<g id="node123" class="node">
<title>prespace_122</title>
<ellipse fill="none" stroke="#000000" cx="8150" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8150" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_111&#45;&gt;prespace_122 -->
<g id="edge122" class="edge">
<title>prose_111&#45;&gt;prespace_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8314.818,-2088.5319C8293.8393,-2035.7362 8232.4701,-1874.8059 8206,-1735.2027 8151.1382,-1445.862 8149.0661,-1086.7149 8149.6919,-984.8178"/>
<polygon fill="#000000" stroke="#000000" points="8153.1925,-984.7461 8149.7686,-974.7197 8146.1927,-984.6928 8153.1925,-984.7461"/>
</g>
<!-- literal_123 -->
<g id="node124" class="node">
<title>literal_123</title>
<ellipse fill="none" stroke="#000000" cx="8246" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8246" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_111&#45;&gt;literal_123 -->
<g id="edge123" class="edge">
<title>prose_111&#45;&gt;literal_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8319.9475,-2088.1793C8313.9223,-2034.4137 8296.0766,-1871.0855 8286,-1735.2027 8264.2727,-1442.2092 8250.6306,-1086.304 8246.9855,-984.8826"/>
<polygon fill="#000000" stroke="#000000" points="8250.4811,-984.694 8246.627,-974.8251 8243.4855,-984.9434 8250.4811,-984.694"/>
</g>
<!-- raw_124 -->
<g id="node125" class="node">
<title>raw_124</title>
<ellipse fill="none" stroke="#000000" cx="8322" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8322" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_111&#45;&gt;raw_124 -->
<g id="edge124" class="edge">
<title>prose_111&#45;&gt;raw_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8322,-2088.2459C8322,-1956.7256 8322,-1146.7035 8322,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="8325.5001,-984.7191 8322,-974.7192 8318.5001,-984.7192 8325.5001,-984.7191"/>
</g>
<!-- prespace_125 -->
<g id="node126" class="node">
<title>prespace_125</title>
<ellipse fill="none" stroke="#000000" cx="8413" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8413" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_111&#45;&gt;prespace_125 -->
<g id="edge125" class="edge">
<title>prose_111&#45;&gt;prespace_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8323.9289,-2088.1695C8329.6143,-2034.3771 8346.6197,-1870.9826 8358,-1735.2027 8382.5672,-1442.0882 8405.0195,-1086.2672 8411.2771,-984.8742"/>
<polygon fill="#000000" stroke="#000000" points="8414.7749,-985.0157 8411.8959,-974.8195 8407.7881,-984.5856 8414.7749,-985.0157"/>
</g>
<!-- literal_126 -->
<g id="node127" class="node">
<title>literal_126</title>
<ellipse fill="none" stroke="#000000" cx="8509" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8509" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_111&#45;&gt;literal_126 -->
<g id="edge126" class="edge">
<title>prose_111&#45;&gt;literal_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8331.2674,-2088.799C8358.2986,-2036.7381 8437.0894,-1877.6246 8468,-1735.2027 8530.3872,-1447.7509 8516.3966,-1087.2855 8510.7465,-984.9471"/>
<polygon fill="#000000" stroke="#000000" points="8514.2318,-984.5882 8510.1662,-974.8045 8507.2432,-984.9881 8514.2318,-984.5882"/>
</g>
<!-- raw_127 -->
<g id="node128" class="node">
<title>raw_127</title>
<ellipse fill="none" stroke="#000000" cx="8585" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8585" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_111&#45;&gt;raw_127 -->
<g id="edge127" class="edge">
<title>prose_111&#45;&gt;raw_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8336.2449,-2090.0574C8378.3633,-2040.8665 8502.2735,-1887.5555 8549,-1735.2027 8635.3169,-1453.7647 8600.9171,-1088.3865 8588.6448,-985.0354"/>
<polygon fill="#000000" stroke="#000000" points="8592.0815,-984.3019 8587.3984,-974.7983 8585.1328,-985.1481 8592.0815,-984.3019"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9073.5,-1053.6022 8630.5,-1053.6022 8630.5,-859.8007 9073.5,-859.8007 9073.5,-1053.6022"/>
<text text-anchor="middle" x="8852" y="-1038.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8852" y="-1006.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8852" y="-991.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8852" y="-976.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8852" y="-960.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8852" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8852" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8852" y="-914.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8852" y="-899.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8852" y="-883.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8852" y="-868.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_112&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>codeblock_112&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8659.0787,-2088.2459C8678.9394,-1971.7563 8789.5505,-1322.9877 8833.7492,-1063.7481"/>
<polygon fill="#000000" stroke="#000000" points="8837.2542,-1064.0147 8835.4847,-1053.5687 8830.3537,-1062.8382 8837.2542,-1064.0147"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="7532.5,-135.0015 7243.5,-135.0015 7243.5,-79.1986 7532.5,-79.1986 7532.5,-135.0015"/>
<text text-anchor="middle" x="7388" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_114&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>raw_114&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7798.0567,-938.5357C7809.6427,-832.5472 7862.6384,-294.7227 7759,-178.2001 7726.514,-141.6755 7589.962,-151.6356 7542,-142.2001 7533.594,-140.5464 7524.946,-138.7735 7516.2405,-136.9353"/>
<polygon fill="#000000" stroke="#000000" points="7516.9071,-133.4988 7506.3969,-134.8349 7515.4463,-140.3447 7516.9071,-133.4988"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="7605,-125.1 7551,-125.1 7551,-89.1 7605,-89.1 7605,-125.1"/>
<text text-anchor="middle" x="7578" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_115&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>prespace_115&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7888.6018,-938.5035C7897.5384,-832.3313 7937.1596,-293.6392 7832,-178.2001 7765.8688,-105.6045 7701.6329,-186.5164 7614,-142.2001 7608.9367,-139.6396 7604.1238,-136.1165 7599.7605,-132.2847"/>
<polygon fill="#000000" stroke="#000000" points="7602.0551,-129.6347 7592.4352,-125.1953 7597.187,-134.6648 7602.0551,-129.6347"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="7677,-125.1 7623,-125.1 7623,-89.1 7677,-89.1 7677,-125.1"/>
<text text-anchor="middle" x="7650" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_116&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>literal_116&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7984.9977,-938.4902C7996.2347,-832.2426 8047.3911,-293.1942 7942,-178.2001 7864.3691,-93.4957 7789.1458,-192.8195 7686,-142.2001 7680.9064,-139.7004 7676.0786,-136.2072 7671.7099,-132.3862"/>
<polygon fill="#000000" stroke="#000000" points="7674.0044,-129.7362 7664.3839,-125.2982 7669.137,-134.767 7674.0044,-129.7362"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="7914.5,-126.4006 7695.5,-126.4006 7695.5,-87.7995 7914.5,-87.7995 7914.5,-126.4006"/>
<text text-anchor="middle" x="7805" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7805" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_117&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>raw_117&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8060.8451,-938.4177C8071.1076,-832.8946 8117.3746,-302.1203 8023,-178.2001 8018.3853,-172.1407 7941.3581,-147.9102 7880.1585,-129.4036"/>
<polygon fill="#000000" stroke="#000000" points="7881.0704,-126.023 7870.4857,-126.4862 7879.049,-132.7248 7881.0704,-126.023"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="7987,-125.1 7933,-125.1 7933,-89.1 7987,-89.1 7987,-125.1"/>
</g>
<!-- prespace_122&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>prespace_122&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8155.0908,-938.7515C8179.9892,-846.8733 8280.4286,-424.013 8095,-178.2001 8066.8048,-140.8232 8035.6487,-167.0996 7996,-142.2001 7991.4954,-139.3712 7987.0954,-135.9002 7983.0056,-132.2531"/>
<polygon fill="#000000" stroke="#000000" points="7985.222,-129.5297 7975.577,-125.1452 7980.3826,-134.5875 7985.222,-129.5297"/>
</g>
<!-- leaf_129 -->
<g id="node130" class="node">
<title>leaf_129</title>
<polygon fill="none" stroke="#c0c0c0" points="8168.5,-125.1 8005.5,-125.1 8005.5,-89.1 8168.5,-89.1 8168.5,-125.1"/>
<text text-anchor="middle" x="8087" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_123&#45;&gt;leaf_129 -->
<g id="edge129" class="edge">
<title>literal_123&#45;&gt;leaf_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8247.2728,-938.7115C8254.2978,-834.8416 8285.1851,-311.7985 8205,-178.2001 8192.0762,-156.6674 8169.903,-140.8372 8148.242,-129.6541"/>
<polygon fill="#000000" stroke="#000000" points="8149.5394,-126.3925 8139.0185,-125.1427 8146.4637,-132.6806 8149.5394,-126.3925"/>
</g>
<!-- leaf_130 -->
<g id="node131" class="node">
<title>leaf_130</title>
<polygon fill="none" stroke="#c0c0c0" points="8531.5,-126.4006 8186.5,-126.4006 8186.5,-87.7995 8531.5,-87.7995 8531.5,-126.4006"/>
<text text-anchor="middle" x="8359" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8359" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_124&#45;&gt;leaf_130 -->
<g id="edge130" class="edge">
<title>raw_124&#45;&gt;leaf_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8322.7899,-938.5632C8327.4958,-830.5056 8351.8303,-271.7321 8357.7169,-136.564"/>
<polygon fill="#000000" stroke="#000000" points="8361.2153,-136.6746 8358.1538,-126.5318 8354.2219,-136.37 8361.2153,-136.6746"/>
</g>
<!-- leaf_131 -->
<g id="node132" class="node">
<title>leaf_131</title>
<polygon fill="none" stroke="#c0c0c0" points="8604,-125.1 8550,-125.1 8550,-89.1 8604,-89.1 8604,-125.1"/>
<text text-anchor="middle" x="8577" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_125&#45;&gt;leaf_131 -->
<g id="edge131" class="edge">
<title>prespace_125&#45;&gt;leaf_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8408.3644,-938.5557C8386.1962,-847.4379 8298.9041,-434.0821 8469,-178.2001 8488.5861,-148.7359 8511.0853,-162.5886 8540,-142.2001 8544.2332,-139.2152 8548.4637,-135.7616 8552.4719,-132.2093"/>
<polygon fill="#000000" stroke="#000000" points="8554.9057,-134.7256 8559.8477,-125.354 8550.1401,-129.5982 8554.9057,-134.7256"/>
</g>
<!-- leaf_132 -->
<g id="node133" class="node">
<title>leaf_132</title>
<polygon fill="none" stroke="#c0c0c0" points="8676,-125.1 8622,-125.1 8622,-89.1 8676,-89.1 8676,-125.1"/>
<text text-anchor="middle" x="8649" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_126&#45;&gt;leaf_132 -->
<g id="edge132" class="edge">
<title>literal_126&#45;&gt;leaf_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8507.6413,-938.676C8500.1294,-834.6063 8466.9171,-310.6287 8549,-178.2001 8566.1936,-150.4608 8586.8732,-161.7571 8613,-142.2001 8616.9832,-139.2185 8620.9774,-135.8245 8624.7802,-132.3496"/>
<polygon fill="#000000" stroke="#000000" points="8627.4405,-134.6486 8632.2523,-125.2095 8622.6044,-129.5877 8627.4405,-134.6486"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9130,-126.4006 8694,-126.4006 8694,-87.7995 9130,-87.7995 9130,-126.4006"/>
<text text-anchor="middle" x="8912" y="-111.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8912" y="-95.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_127&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_127&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8583.0506,-938.651C8572.0721,-833.3184 8521.9002,-298.5942 8621,-178.2001 8639.2778,-155.9948 8696.0792,-139.7053 8754.7052,-128.3646"/>
<polygon fill="#000000" stroke="#000000" points="8755.712,-131.7366 8764.8912,-126.4459 8754.4161,-124.8576 8755.712,-131.7366"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="9282.5,-974.7014 9091.5,-974.7014 9091.5,-938.7014 9282.5,-938.7014 9282.5,-974.7014"/>
<text text-anchor="middle" x="9187" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_135&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>header_135&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9231.2932,-2088.2459C9226.1449,-1956.7256 9194.4374,-1146.7035 9188.1012,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="9191.5938,-984.5746 9187.7053,-974.7192 9184.5992,-984.8484 9191.5938,-984.5746"/>
</g>
<!-- raw_140 -->
<g id="node141" class="node">
<title>raw_140</title>
<ellipse fill="none" stroke="#000000" cx="9328" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9328" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_136&#45;&gt;raw_140 -->
<g id="edge140" class="edge">
<title>prose_136&#45;&gt;raw_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9464.238,-2088.4996C9444.5098,-2035.6151 9386.9693,-1874.4653 9364,-1735.2027 9316.2002,-1445.3937 9323.5814,-1087.272 9326.9294,-985.1033"/>
<polygon fill="#000000" stroke="#000000" points="9330.432,-985.0842 9327.2764,-974.9702 9323.4361,-984.8445 9330.432,-985.0842"/>
</g>
<!-- prespace_141 -->
<g id="node142" class="node">
<title>prespace_141</title>
<ellipse fill="none" stroke="#000000" cx="9419" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9419" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_136&#45;&gt;prespace_141 -->
<g id="edge141" class="edge">
<title>prose_136&#45;&gt;prespace_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9470.1832,-2088.2459C9464.2341,-1956.7256 9427.5944,-1146.7035 9420.2725,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="9423.7634,-984.5508 9419.815,-974.7192 9416.7705,-984.8671 9423.7634,-984.5508"/>
</g>
<!-- literal_142 -->
<g id="node143" class="node">
<title>literal_142</title>
<ellipse fill="none" stroke="#000000" cx="9515" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9515" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_136&#45;&gt;literal_142 -->
<g id="edge142" class="edge">
<title>prose_136&#45;&gt;literal_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9471.6911,-2088.2459C9476.725,-1956.7256 9507.7278,-1146.7035 9513.9232,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="9517.4253,-984.8457 9514.3104,-974.7192 9510.4304,-984.578 9517.4253,-984.8457"/>
</g>
<!-- raw_143 -->
<g id="node144" class="node">
<title>raw_143</title>
<ellipse fill="none" stroke="#000000" cx="9591" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9591" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_136&#45;&gt;raw_143 -->
<g id="edge143" class="edge">
<title>prose_136&#45;&gt;raw_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9474.6697,-2088.0611C9484.9151,-2037.5149 9515.0444,-1891.4517 9545,-1771.2027 9549.0141,-1755.0894 9552.3777,-1751.6002 9555,-1735.2027 9601.3834,-1445.1636 9594.9881,-1087.2021 9591.9724,-985.0874"/>
<polygon fill="#000000" stroke="#000000" points="9595.4668,-984.8467 9591.659,-974.9598 9588.4701,-985.0633 9595.4668,-984.8467"/>
</g>
<!-- raw_148 -->
<g id="node149" class="node">
<title>raw_148</title>
<ellipse fill="none" stroke="#000000" cx="9663" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9663" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_137&#45;&gt;raw_148 -->
<g id="edge148" class="edge">
<title>prose_137&#45;&gt;raw_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9588.416,-2088.1931C9595.4938,-2034.4654 9616.3514,-1871.231 9627,-1735.2027 9649.9233,-1442.3741 9659.8565,-1086.3541 9662.3465,-984.8941"/>
<polygon fill="#000000" stroke="#000000" points="9665.847,-984.9141 9662.5893,-974.8326 9658.849,-984.7452 9665.847,-984.9141"/>
</g>
<!-- leaf_150 -->
<g id="node151" class="node">
<title>leaf_150</title>
<polygon fill="none" stroke="#c0c0c0" points="10263.5,-1446.6034 9708.5,-1446.6034 9708.5,-466.7994 10263.5,-466.7994 10263.5,-1446.6034"/>
<text text-anchor="middle" x="9986" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9986" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local gsub = assert(string.gsub)</text>
<text text-anchor="middle" x="9986" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, best, c)</text>
<text text-anchor="middle" x="9986" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9986" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9986" y="-1354.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9986" y="-1338.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9986" y="-1323.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9986" y="-1308.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9986" y="-1292.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="9986" y="-1277.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-1261.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local Color</text>
<text text-anchor="middle" x="9986" y="-1246.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9986" y="-1231.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9986" y="-1215.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9986" y="-1200.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Color = c.alert</text>
<text text-anchor="middle" x="9986" y="-1184.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9986" y="-1169.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Color = c.search_hl</text>
<text text-anchor="middle" x="9986" y="-1154.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-1138.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9986" y="-1123.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = Color(char)</text>
<text text-anchor="middle" x="9986" y="-1107.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9986" y="-1092.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-1077.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9986" y="-1061.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9986" y="-1046.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9986" y="-1014.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, phrase, c)</text>
<text text-anchor="middle" x="9986" y="-999.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(c, &quot;must provide a color table&quot;)</text>
<text text-anchor="middle" x="9986" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local i = 1</text>
<text text-anchor="middle" x="9986" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local first = true</text>
<text text-anchor="middle" x="9986" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return function()</text>
<text text-anchor="middle" x="9986" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9986" y="-922.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if first then</text>
<text text-anchor="middle" x="9986" y="-907.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;first = false</text>
<text text-anchor="middle" x="9986" y="-891.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return c.alert &quot;No results found&quot;</text>
<text text-anchor="middle" x="9986" y="-876.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9986" y="-860.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return nil</text>
<text text-anchor="middle" x="9986" y="-845.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-830.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-814.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line = collection[i]</text>
<text text-anchor="middle" x="9986" y="-799.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if line == nil then return nil end</text>
<text text-anchor="middle" x="9986" y="-783.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local len = #line</text>
<text text-anchor="middle" x="9986" y="-768.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local alt_seq = &quot; &#160;&#160;&#160;&quot;</text>
<text text-anchor="middle" x="9986" y="-753.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i &lt; 10 then</text>
<text text-anchor="middle" x="9986" y="-737.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alt_seq = c.bold(&quot;M&#45;&quot; .. tostring(i) .. &quot; &quot;)</text>
<text text-anchor="middle" x="9986" y="-722.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-706.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;len = len + 4</text>
<text text-anchor="middle" x="9986" y="-691.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if len &gt; phrase:remains() then</text>
<text text-anchor="middle" x="9986" y="-676.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line = line:sub(1, phrase:remains() &#45; 5) .. c.alert &quot;…&quot;</text>
<text text-anchor="middle" x="9986" y="-660.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;len = phrase.width &#45; (phrase.width &#45; phrase:remains() &#45; 4)</text>
<text text-anchor="middle" x="9986" y="-645.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-629.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local next_line = alt_seq</text>
<text text-anchor="middle" x="9986" y="-614.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(line, collection.frag, collection.best, c)</text>
<text text-anchor="middle" x="9986" y="-599.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i == collection.hl then</text>
<text text-anchor="middle" x="9986" y="-583.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next_line = c.highlight(next_line)</text>
<text text-anchor="middle" x="9986" y="-568.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-552.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;i = i + 1</text>
<text text-anchor="middle" x="9986" y="-537.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return next_line, len</text>
<text text-anchor="middle" x="9986" y="-522.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9986" y="-506.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9986" y="-475.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_138&#45;&gt;leaf_150 -->
<g id="edge150" class="edge">
<title>codeblock_138&#45;&gt;leaf_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9857.0577,-2088.2459C9865.5018,-2014.1436 9898.4904,-1724.6497 9928.9839,-1457.0515"/>
<polygon fill="#000000" stroke="#000000" points="9932.5041,-1457.0721 9930.1589,-1446.7401 9925.5491,-1456.2795 9932.5041,-1457.0721"/>
</g>
<!-- leaf_144 -->
<g id="node145" class="node">
<title>leaf_144</title>
<polygon fill="none" stroke="#c0c0c0" points="9395.5,-135.0015 9148.5,-135.0015 9148.5,-79.1986 9395.5,-79.1986 9395.5,-135.0015"/>
<text text-anchor="middle" x="9272" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_140&#45;&gt;leaf_144 -->
<g id="edge144" class="edge">
<title>raw_140&#45;&gt;leaf_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9328.5622,-938.4528C9330.9142,-852.4306 9337.7926,-479.028 9291,-178.2001 9289.2886,-167.1975 9286.5405,-155.4464 9283.6599,-144.7314"/>
<polygon fill="#000000" stroke="#000000" points="9286.9551,-143.5189 9280.887,-134.834 9280.2146,-145.4074 9286.9551,-143.5189"/>
</g>
<!-- leaf_145 -->
<g id="node146" class="node">
<title>leaf_145</title>
<polygon fill="none" stroke="#c0c0c0" points="9468,-125.1 9414,-125.1 9414,-89.1 9468,-89.1 9468,-125.1"/>
<text text-anchor="middle" x="9441" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_141&#45;&gt;leaf_145 -->
<g id="edge145" class="edge">
<title>prespace_141&#45;&gt;leaf_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9419.4697,-938.5632C9422.2741,-830.2631 9436.8019,-269.2221 9440.2604,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="9443.7652,-135.5166 9440.5254,-125.4293 9436.7676,-135.3353 9443.7652,-135.5166"/>
</g>
<!-- leaf_146 -->
<g id="node147" class="node">
<title>leaf_146</title>
<polygon fill="none" stroke="#c0c0c0" points="9544,-125.1 9486,-125.1 9486,-89.1 9544,-89.1 9544,-125.1"/>
<text text-anchor="middle" x="9515" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_142&#45;&gt;leaf_146 -->
<g id="edge146" class="edge">
<title>literal_142&#45;&gt;leaf_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9515,-938.5632C9515,-830.2631 9515,-269.2221 9515,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="9518.5001,-135.4293 9515,-125.4293 9511.5001,-135.4293 9518.5001,-135.4293"/>
</g>
<!-- leaf_147 -->
<g id="node148" class="node">
<title>leaf_147</title>
<polygon fill="none" stroke="#c0c0c0" points="10089.5,-134.3005 9562.5,-134.3005 9562.5,-79.8996 10089.5,-79.8996 10089.5,-134.3005"/>
<text text-anchor="middle" x="9826" y="-119.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9826" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9826" y="-88.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_143&#45;&gt;leaf_147 -->
<g id="edge147" class="edge">
<title>raw_143&#45;&gt;leaf_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9589.2076,-938.4573C9579.2418,-833.1569 9534.3621,-303.4239 9627,-178.2001 9638.0161,-163.309 9671.3028,-149.1033 9707.5773,-137.359"/>
<polygon fill="#000000" stroke="#000000" points="9708.8774,-140.6189 9717.3598,-134.2708 9706.77,-133.9437 9708.8774,-140.6189"/>
</g>
<!-- leaf_149 -->
<g id="node150" class="node">
<title>leaf_149</title>
<polygon fill="none" stroke="#c0c0c0" points="10620.5,-134.4005 10107.5,-134.4005 10107.5,-79.7996 10620.5,-79.7996 10620.5,-134.4005"/>
<text text-anchor="middle" x="10364" y="-103.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10364" y="-87.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_148&#45;&gt;leaf_149 -->
<g id="edge149" class="edge">
<title>raw_148&#45;&gt;leaf_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9660.791,-938.4204C9648.3344,-831.7754 9591.1772,-290.8489 9699,-178.2001 9729.7794,-146.0431 10053.7585,-147.1128 10098,-142.2001 10116.0519,-140.1956 10134.7758,-137.9874 10153.5481,-135.684"/>
<polygon fill="#000000" stroke="#000000" points="10154.1752,-139.1333 10163.6707,-134.4336 10153.317,-132.1861 10154.1752,-139.1333"/>
</g>
<!-- leaf_161 -->
<g id="node162" class="node">
<title>leaf_161</title>
<polygon fill="none" stroke="#c0c0c0" points="10557.5,-2124.3034 10366.5,-2124.3034 10366.5,-2088.3034 10557.5,-2088.3034 10557.5,-2124.3034"/>
<text text-anchor="middle" x="10462" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_151&#45;&gt;leaf_161 -->
<g id="edge161" class="edge">
<title>header_151&#45;&gt;leaf_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10543.72,-2556.0526C10530.7453,-2484.6458 10482.9468,-2221.585 10467.1242,-2134.5047"/>
<polygon fill="#000000" stroke="#000000" points="10470.5475,-2133.7668 10465.3161,-2124.5537 10463.6603,-2135.0183 10470.5475,-2133.7668"/>
</g>
<!-- raw_162 -->
<g id="node163" class="node">
<title>raw_162</title>
<ellipse fill="none" stroke="#000000" cx="10603" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="10603" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_152&#45;&gt;raw_162 -->
<g id="edge162" class="edge">
<title>prose_152&#45;&gt;raw_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10766.773,-2561.3848C10732.2257,-2541.0733 10668.2419,-2497.7904 10639,-2441.4041 10585.7461,-2338.7161 10593.2734,-2194.7866 10599.4645,-2134.5524"/>
<polygon fill="#000000" stroke="#000000" points="10602.9768,-2134.6306 10600.59,-2124.3082 10596.0187,-2133.8661 10602.9768,-2134.6306"/>
</g>
<!-- prespace_163 -->
<g id="node164" class="node">
<title>prespace_163</title>
<ellipse fill="none" stroke="#000000" cx="10694" cy="-2106.3034" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10694" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_152&#45;&gt;prespace_163 -->
<g id="edge163" class="edge">
<title>prose_152&#45;&gt;prespace_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10783.8326,-2556.2704C10775.2676,-2530.9767 10759.7301,-2483.1148 10750,-2441.4041 10723.8161,-2329.1593 10704.9772,-2193.0271 10697.5261,-2134.8721"/>
<polygon fill="#000000" stroke="#000000" points="10700.9573,-2134.1079 10696.2284,-2124.6269 10694.0128,-2134.9875 10700.9573,-2134.1079"/>
</g>
<!-- literal_164 -->
<g id="node165" class="node">
<title>literal_164</title>
<ellipse fill="none" stroke="#000000" cx="10790" cy="-2106.3034" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10790" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_152&#45;&gt;literal_164 -->
<g id="edge164" class="edge">
<title>prose_152&#45;&gt;literal_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10790,-2556.0526C10790,-2484.7184 10790,-2222.12 10790,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="10793.5001,-2134.5536 10790,-2124.5537 10786.5001,-2134.5537 10793.5001,-2134.5536"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="10868" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="10868" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_152&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_152&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10796.4743,-2556.3377C10805.4037,-2531.124 10821.3716,-2483.3565 10830,-2441.4041 10853.0485,-2329.3393 10863.0511,-2193.1123 10866.4949,-2134.9024"/>
<polygon fill="#000000" stroke="#000000" points="10870.0046,-2134.8305 10867.0807,-2124.6472 10863.016,-2134.4312 10870.0046,-2134.8305"/>
</g>
<!-- raw_170 -->
<g id="node171" class="node">
<title>raw_170</title>
<ellipse fill="none" stroke="#000000" cx="11448" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="11448" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_153&#45;&gt;raw_170 -->
<g id="edge170" class="edge">
<title>prose_153&#45;&gt;raw_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11514.3374,-2556.0526C11503.7931,-2484.5652 11464.9163,-2220.9909 11452.1163,-2134.2105"/>
<polygon fill="#000000" stroke="#000000" points="11455.5765,-2133.6835 11450.6547,-2124.3013 11448.6514,-2134.705 11455.5765,-2133.6835"/>
</g>
<!-- raw_172 -->
<g id="node173" class="node">
<title>raw_172</title>
<ellipse fill="none" stroke="#000000" cx="11598" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="11598" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_154&#45;&gt;raw_172 -->
<g id="edge172" class="edge">
<title>prose_154&#45;&gt;raw_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11666.2602,-2556.0526C11655.4103,-2484.5652 11615.4066,-2220.9909 11602.2356,-2134.2105"/>
<polygon fill="#000000" stroke="#000000" points="11605.6926,-2133.6629 11600.7316,-2124.3013 11598.7719,-2134.7133 11605.6926,-2133.6629"/>
</g>
<!-- raw_174 -->
<g id="node175" class="node">
<title>raw_174</title>
<ellipse fill="none" stroke="#000000" cx="11890" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="11890" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_155&#45;&gt;raw_174 -->
<g id="edge174" class="edge">
<title>prose_155&#45;&gt;raw_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11890,-2556.0526C11890,-2484.7184 11890,-2222.12 11890,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="11893.5001,-2134.5536 11890,-2124.5537 11886.5001,-2134.5537 11893.5001,-2134.5536"/>
</g>
<!-- raw_176 -->
<g id="node177" class="node">
<title>raw_176</title>
<ellipse fill="none" stroke="#000000" cx="12325" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="12325" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_156&#45;&gt;raw_176 -->
<g id="edge176" class="edge">
<title>prose_156&#45;&gt;raw_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12098.7834,-2556.6197C12134.4867,-2485.5471 12268.8684,-2218.0413 12311.7572,-2132.6651"/>
<polygon fill="#000000" stroke="#000000" points="12314.9359,-2134.1342 12316.2974,-2123.6272 12308.6808,-2130.9919 12314.9359,-2134.1342"/>
</g>
<!-- raw_178 -->
<g id="node179" class="node">
<title>raw_178</title>
<ellipse fill="none" stroke="#000000" cx="12946" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="12946" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_157&#45;&gt;raw_178 -->
<g id="edge178" class="edge">
<title>prose_157&#45;&gt;raw_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13086.8373,-2556.3368C13075.4377,-2531.1221 13054.5188,-2483.3534 13040,-2441.4041 13001.2097,-2329.3273 12966.6425,-2192.1181 12952.6263,-2134.2035"/>
<polygon fill="#000000" stroke="#000000" points="12955.9944,-2133.2399 12950.2519,-2124.3363 12949.1887,-2134.8776 12955.9944,-2133.2399"/>
</g>
<!-- prespace_179 -->
<g id="node180" class="node">
<title>prespace_179</title>
<ellipse fill="none" stroke="#000000" cx="13095" cy="-2106.3034" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13095" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_157&#45;&gt;prespace_179 -->
<g id="edge179" class="edge">
<title>prose_157&#45;&gt;prespace_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13095,-2556.0526C13095,-2484.7184 13095,-2222.12 13095,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="13098.5001,-2134.5536 13095,-2124.5537 13091.5001,-2134.5537 13098.5001,-2134.5536"/>
</g>
<!-- literal_180 -->
<g id="node181" class="node">
<title>literal_180</title>
<ellipse fill="none" stroke="#000000" cx="13191" cy="-2106.3034" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13191" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_157&#45;&gt;literal_180 -->
<g id="edge180" class="edge">
<title>prose_157&#45;&gt;literal_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13104.0599,-2556.6097C13116.5253,-2531.7192 13138.7025,-2484.3332 13150,-2441.4041 13179.2179,-2330.3794 13187.7273,-2193.0723 13190.1126,-2134.7006"/>
<polygon fill="#000000" stroke="#000000" points="13193.6207,-2134.5516 13190.5014,-2124.4264 13186.6257,-2134.2869 13193.6207,-2134.5516"/>
</g>
<!-- raw_181 -->
<g id="node182" class="node">
<title>raw_181</title>
<ellipse fill="none" stroke="#000000" cx="13267" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="13267" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_157&#45;&gt;raw_181 -->
<g id="edge181" class="edge">
<title>prose_157&#45;&gt;raw_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13116.4593,-2560.437C13147.7229,-2539.2071 13204.9023,-2495.108 13231,-2441.4041 13281.439,-2337.6107 13275.5278,-2194.8518 13270.1547,-2134.7706"/>
<polygon fill="#000000" stroke="#000000" points="13273.6124,-2134.1615 13269.1714,-2124.5423 13266.6445,-2134.8314 13273.6124,-2134.1615"/>
</g>
<!-- raw_186 -->
<g id="node187" class="node">
<title>raw_186</title>
<ellipse fill="none" stroke="#000000" cx="13339" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="13339" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_158&#45;&gt;raw_186 -->
<g id="edge186" class="edge">
<title>prose_158&#45;&gt;raw_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13265.3907,-2556.4307C13275.5637,-2531.3275 13293.6779,-2483.6905 13303,-2441.4041 13327.6736,-2329.4806 13335.6655,-2192.6502 13338.0585,-2134.5519"/>
<polygon fill="#000000" stroke="#000000" points="13341.5647,-2134.4555 13338.4544,-2124.3276 13334.57,-2134.1847 13341.5647,-2134.4555"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13939.5,-2441.5048 13384.5,-2441.5048 13384.5,-1771.102 13939.5,-1771.102 13939.5,-2441.5048"/>
<text text-anchor="middle" x="13662" y="-2426.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="13662" y="-2410.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.last_collection</text>
<text text-anchor="middle" x="13662" y="-2395.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;and historian.last_collection[1].lit_frag == frag then</text>
<text text-anchor="middle" x="13662" y="-2380.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t repeat a search</text>
<text text-anchor="middle" x="13662" y="-2364.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return historian.last_collection</text>
<text text-anchor="middle" x="13662" y="-2349.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13662" y="-2333.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="13662" y="-2318.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="13662" y="-2303.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.lit_frag = frag</text>
<text text-anchor="middle" x="13662" y="-2287.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if frag == &quot;&quot; then</text>
<text text-anchor="middle" x="13662" y="-2272.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Rainbuf {[1] = collection, n = 1}, false</text>
<text text-anchor="middle" x="13662" y="-2256.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13662" y="-2241.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="13662" y="-2226.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="13662" y="-2210.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="13662" y="-2195.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="13662" y="-2179.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="13662" y="-2164.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="13662" y="-2149.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="13662" y="-2133.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="13662" y="-2118.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="13662" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13662" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="13662" y="-2072.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="13662" y="-2056.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="13662" y="-2041.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="13662" y="-2025.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="13662" y="-2010.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="13662" y="-1995.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="13662" y="-1979.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="13662" y="-1964.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="13662" y="-1948.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="13662" y="-1933.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="13662" y="-1918.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="13662" y="-1902.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="13662" y="-1887.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13662" y="-1871.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="13662" y="-1856.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="13662" y="-1841.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.hl = 1</text>
<text text-anchor="middle" x="13662" y="-1825.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.last_collection = Rainbuf {[1] = collection, n = 1, live = true}</text>
<text text-anchor="middle" x="13662" y="-1810.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.last_collection.made_in = &quot;historian.search&quot;</text>
<text text-anchor="middle" x="13662" y="-1794.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian.last_collection, best</text>
<text text-anchor="middle" x="13662" y="-1779.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_159&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>codeblock_159&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13534.1323,-2556.0526C13540.1602,-2534.8505 13550.9919,-2496.7521 13563.8914,-2451.3808"/>
<polygon fill="#000000" stroke="#000000" points="13567.3062,-2452.1681 13566.6744,-2441.5921 13560.573,-2450.2537 13567.3062,-2452.1681"/>
</g>
<!-- header_189 -->
<g id="node190" class="node">
<title>header_189</title>
<ellipse fill="none" stroke="#000000" cx="14259" cy="-2106.3034" rx="143.582" ry="18"/>
<text text-anchor="middle" x="14259" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : _resultsFrom(historian, line_id)</text>
</g>
<!-- section_160&#45;&gt;header_189 -->
<g id="edge189" class="edge">
<title>section_160&#45;&gt;header_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14352.2569,-2556.0526C14337.4338,-2484.5652 14282.7808,-2220.9909 14264.7866,-2134.2105"/>
<polygon fill="#000000" stroke="#000000" points="14268.1894,-2133.3824 14262.7319,-2124.3013 14261.3352,-2134.8037 14268.1894,-2133.3824"/>
</g>
<!-- prose_190 -->
<g id="node191" class="node">
<title>prose_190</title>
<ellipse fill="none" stroke="#000000" cx="14453" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14453" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_160&#45;&gt;prose_190 -->
<g id="edge190" class="edge">
<title>section_160&#45;&gt;prose_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14365.45,-2556.2104C14378.1928,-2531.2352 14400.5986,-2484.1703 14412,-2441.4041 14441.5738,-2330.4737 14449.8944,-2193.1166 14452.1715,-2134.7162"/>
<polygon fill="#000000" stroke="#000000" points="14455.6794,-2134.5559 14452.5405,-2124.4368 14448.6839,-2134.3047 14455.6794,-2134.5559"/>
</g>
<!-- codeblock_191 -->
<g id="node192" class="node">
<title>codeblock_191</title>
<ellipse fill="none" stroke="#000000" cx="14591" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14591" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 469&#45;482</text>
</g>
<!-- section_160&#45;&gt;codeblock_191 -->
<g id="edge191" class="edge">
<title>section_160&#45;&gt;codeblock_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14380.4691,-2557.0217C14411.3962,-2534.1718 14464.1844,-2490.7661 14494,-2441.4041 14555.9058,-2338.9142 14580.0459,-2194.8768 14587.8307,-2134.5832"/>
<polygon fill="#000000" stroke="#000000" points="14591.345,-2134.6827 14589.0994,-2124.3286 14584.398,-2133.8231 14591.345,-2134.6827"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="10648,-984.6029 10282,-984.6029 10282,-928.7999 10648,-928.7999 10648,-984.6029"/>
<text text-anchor="middle" x="10465" y="-937.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_162&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_162&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10601.0801,-2088.1315C10595.7402,-2037.7652 10580.1718,-1892.1191 10566,-1771.2027 10530.8955,-1471.6841 10484.8032,-1110.7103 10469.8842,-994.6106"/>
<polygon fill="#000000" stroke="#000000" points="10473.3262,-993.9345 10468.5794,-984.4625 10466.3834,-994.8273 10473.3262,-993.9345"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="10720,-974.7014 10666,-974.7014 10666,-938.7014 10720,-938.7014 10720,-974.7014"/>
<text text-anchor="middle" x="10693" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_163&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>prespace_163&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10693.9843,-2088.2459C10693.8699,-1956.7256 10693.1653,-1146.7035 10693.0245,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="10696.5245,-984.7161 10693.0157,-974.7192 10689.5245,-984.7222 10696.5245,-984.7161"/>
</g>
<!-- leaf_168 -->
<g id="node169" class="node">
<title>leaf_168</title>
<polygon fill="none" stroke="#c0c0c0" points="10824,-974.7014 10738,-974.7014 10738,-938.7014 10824,-938.7014 10824,-974.7014"/>
<text text-anchor="middle" x="10781" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_164&#45;&gt;leaf_168 -->
<g id="edge168" class="edge">
<title>literal_164&#45;&gt;leaf_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10789.8586,-2088.2459C10788.829,-1956.7256 10782.4875,-1146.7035 10781.2202,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="10784.7193,-984.6914 10781.1411,-974.7192 10777.7195,-984.7463 10784.7193,-984.6914"/>
</g>
<!-- leaf_169 -->
<g id="node170" class="node">
<title>leaf_169</title>
<polygon fill="none" stroke="#c0c0c0" points="10896,-974.7014 10842,-974.7014 10842,-938.7014 10896,-938.7014 10896,-974.7014"/>
<text text-anchor="middle" x="10869" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_165&#45;&gt;leaf_169 -->
<g id="edge169" class="edge">
<title>raw_165&#45;&gt;leaf_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10868.0157,-2088.2459C10868.1301,-1956.7256 10868.8347,-1146.7035 10868.9755,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="10872.4755,-984.7222 10868.9843,-974.7192 10865.4755,-984.7161 10872.4755,-984.7222"/>
</g>
<!-- leaf_171 -->
<g id="node172" class="node">
<title>leaf_171</title>
<polygon fill="none" stroke="#c0c0c0" points="11427.5,-976.6035 10914.5,-976.6035 10914.5,-936.7993 11427.5,-936.7993 11427.5,-976.6035"/>
<text text-anchor="middle" x="11171" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_170&#45;&gt;leaf_171 -->
<g id="edge171" class="edge">
<title>raw_170&#45;&gt;leaf_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11443.649,-2088.2459C11412.0618,-1957.1532 11218.0491,-1151.964 11178.1641,-986.4338"/>
<polygon fill="#000000" stroke="#000000" points="11181.5084,-985.3715 11175.7632,-976.4696 11174.7031,-987.0113 11181.5084,-985.3715"/>
</g>
<!-- leaf_173 -->
<g id="node174" class="node">
<title>leaf_173</title>
<polygon fill="none" stroke="#c0c0c0" points="11608.5,-976.6035 11445.5,-976.6035 11445.5,-936.7993 11608.5,-936.7993 11608.5,-976.6035"/>
<text text-anchor="middle" x="11527" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_172&#45;&gt;leaf_173 -->
<g id="edge173" class="edge">
<title>raw_172&#45;&gt;leaf_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11596.8848,-2088.2459C11588.7965,-1957.284 11539.1587,-1153.5705 11528.867,-986.9313"/>
<polygon fill="#000000" stroke="#000000" points="11532.3308,-986.2348 11528.2209,-976.4696 11525.3441,-986.6664 11532.3308,-986.2348"/>
</g>
<!-- leaf_175 -->
<g id="node176" class="node">
<title>leaf_175</title>
<polygon fill="none" stroke="#c0c0c0" points="12153.5,-991.9018 11626.5,-991.9018 11626.5,-921.501 12153.5,-921.501 12153.5,-991.9018"/>
<text text-anchor="middle" x="11890" y="-960.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11890" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11890" y="-929.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_174&#45;&gt;leaf_175 -->
<g id="edge175" class="edge">
<title>raw_174&#45;&gt;leaf_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11890,-2088.2459C11890,-1960.9027 11890,-1197.472 11890,-1002.1762"/>
<polygon fill="#000000" stroke="#000000" points="11893.5001,-1001.981 11890,-991.981 11886.5001,-1001.9811 11893.5001,-1001.981"/>
</g>
<!-- leaf_177 -->
<g id="node178" class="node">
<title>leaf_177</title>
<polygon fill="none" stroke="#c0c0c0" points="12712.5,-984.0018 12171.5,-984.0018 12171.5,-929.401 12712.5,-929.401 12712.5,-984.0018"/>
<text text-anchor="middle" x="12442" y="-952.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection. &#160;Is transposed</text>
<text text-anchor="middle" x="12442" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in a next&#45;best search.</text>
</g>
<!-- raw_176&#45;&gt;leaf_177 -->
<g id="edge177" class="edge">
<title>raw_176&#45;&gt;leaf_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12326.8378,-2088.2459C12339.9783,-1959.1321 12419.6688,-1176.12 12438.167,-994.3629"/>
<polygon fill="#000000" stroke="#000000" points="12441.6681,-994.5296 12439.1986,-984.2266 12434.704,-993.8208 12441.6681,-994.5296"/>
</g>
<!-- leaf_182 -->
<g id="node183" class="node">
<title>leaf_182</title>
<polygon fill="none" stroke="#c0c0c0" points="13103.5,-976.6035 12730.5,-976.6035 12730.5,-936.7993 13103.5,-936.7993 13103.5,-976.6035"/>
<text text-anchor="middle" x="12917" y="-945.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;lit_frag : &#160;The literal fragment passed as the</text>
</g>
<!-- raw_178&#45;&gt;leaf_182 -->
<g id="edge182" class="edge">
<title>raw_178&#45;&gt;leaf_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12945.5445,-2088.2459C12942.2408,-1957.284 12921.9662,-1153.5705 12917.7626,-986.9313"/>
<polygon fill="#000000" stroke="#000000" points="12921.2498,-986.3781 12917.4987,-976.4696 12914.2521,-986.5547 12921.2498,-986.3781"/>
</g>
<!-- leaf_183 -->
<g id="node184" class="node">
<title>leaf_183</title>
<polygon fill="none" stroke="#c0c0c0" points="13176,-974.7014 13122,-974.7014 13122,-938.7014 13176,-938.7014 13176,-974.7014"/>
<text text-anchor="middle" x="13149" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_179&#45;&gt;leaf_183 -->
<g id="edge183" class="edge">
<title>prespace_179&#45;&gt;leaf_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13095.8482,-2088.2459C13102.0261,-1956.7256 13140.0751,-1146.7035 13147.6785,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="13151.1805,-984.8724 13148.1537,-974.7192 13144.1882,-984.5439 13151.1805,-984.8724"/>
</g>
<!-- leaf_184 -->
<g id="node185" class="node">
<title>leaf_184</title>
<polygon fill="none" stroke="#c0c0c0" points="13248,-974.7014 13194,-974.7014 13194,-938.7014 13248,-938.7014 13248,-974.7014"/>
<text text-anchor="middle" x="13221" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">frag</text>
</g>
<!-- literal_180&#45;&gt;leaf_184 -->
<g id="edge184" class="edge">
<title>literal_180&#45;&gt;leaf_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13191.4712,-2088.2459C13194.9034,-1956.7256 13216.0417,-1146.7035 13220.2658,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="13223.7677,-984.8071 13220.5298,-974.7192 13216.77,-984.6244 13223.7677,-984.8071"/>
</g>
<!-- leaf_185 -->
<g id="node186" class="node">
<title>leaf_185</title>
<polygon fill="none" stroke="#c0c0c0" points="13590,-976.002 13266,-976.002 13266,-937.4008 13590,-937.4008 13590,-976.002"/>
<text text-anchor="middle" x="13428" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> parameter. &#160;Used to</text>
<text text-anchor="middle" x="13428" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;compare to the last search.</text>
</g>
<!-- raw_181&#45;&gt;leaf_185 -->
<g id="edge185" class="edge">
<title>raw_181&#45;&gt;leaf_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13268.6627,-2088.1069C13273.3338,-2037.6778 13287.2651,-1891.8862 13303,-1771.2027 13343.145,-1463.2985 13405.0704,-1092.0146 13422.9866,-986.1514"/>
<polygon fill="#000000" stroke="#000000" points="13426.4534,-986.6411 13424.6741,-976.1967 13419.5519,-985.4711 13426.4534,-986.6411"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="14114,-984.0018 13608,-984.0018 13608,-929.401 14114,-929.401 14114,-984.0018"/>
<text text-anchor="middle" x="13861" y="-952.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="13861" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_186&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>raw_186&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13334.3513,-2088.3774C13321.1078,-2032.7477 13289.4102,-1861.3931 13375,-1771.2027 13444.4099,-1698.062 13522.0579,-1800.3734 13599,-1735.2027 13833.2036,-1536.8301 13858.7918,-1121.7468 13861.0017,-994.5588"/>
<polygon fill="#000000" stroke="#000000" points="13864.5063,-994.2298 13861.14,-984.184 13857.5069,-994.1365 13864.5063,-994.2298"/>
</g>
<!-- leaf_192 -->
<g id="node193" class="node">
<title>leaf_192</title>
<polygon fill="none" stroke="#c0c0c0" points="14407.5,-974.7014 14132.5,-974.7014 14132.5,-938.7014 14407.5,-938.7014 14407.5,-974.7014"/>
<text text-anchor="middle" x="14270" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">**** _resultsFrom(historian, line_id)</text>
</g>
<!-- header_189&#45;&gt;leaf_192 -->
<g id="edge192" class="edge">
<title>header_189&#45;&gt;leaf_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14259.1728,-2088.2459C14260.4312,-1956.7256 14268.182,-1146.7035 14269.7308,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="14273.2317,-984.7522 14269.8276,-974.7192 14266.232,-984.6852 14273.2317,-984.7522"/>
</g>
<!-- raw_193 -->
<g id="node194" class="node">
<title>raw_193</title>
<ellipse fill="none" stroke="#000000" cx="14453" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14453" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_190&#45;&gt;raw_193 -->
<g id="edge193" class="edge">
<title>prose_190&#45;&gt;raw_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14453,-2088.2459C14453,-1956.7256 14453,-1146.7035 14453,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="14456.5001,-984.7191 14453,-974.7192 14449.5001,-984.7192 14456.5001,-984.7191"/>
</g>
<!-- leaf_195 -->
<g id="node196" class="node">
<title>leaf_195</title>
<polygon fill="none" stroke="#c0c0c0" points="14843.5,-1053.0019 14498.5,-1053.0019 14498.5,-860.4009 14843.5,-860.4009 14843.5,-1053.0019"/>
<text text-anchor="middle" x="14671" y="-1037.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _resultsFrom(historian, line_id)</text>
<text text-anchor="middle" x="14671" y="-1022.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local stmt = historian.get_results</text>
<text text-anchor="middle" x="14671" y="-1007.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;stmt:bindkv {line_id = line_id}</text>
<text text-anchor="middle" x="14671" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local results = stmt:resultset()</text>
<text text-anchor="middle" x="14671" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if results then</text>
<text text-anchor="middle" x="14671" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;results = results[1]</text>
<text text-anchor="middle" x="14671" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;results.n = #results</text>
<text text-anchor="middle" x="14671" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;results.frozen = true</text>
<text text-anchor="middle" x="14671" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14671" y="-899.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.get_results:clearbind():reset()</text>
<text text-anchor="middle" x="14671" y="-883.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return results</text>
<text text-anchor="middle" x="14671" y="-868.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_191&#45;&gt;leaf_195 -->
<g id="edge195" class="edge">
<title>codeblock_191&#45;&gt;leaf_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14592.2566,-2088.2459C14600.3679,-1971.6858 14645.565,-1322.2026 14663.5834,-1063.278"/>
<polygon fill="#000000" stroke="#000000" points="14667.0881,-1063.3307 14664.2909,-1053.1118 14660.105,-1062.8447 14667.0881,-1063.3307"/>
</g>
<!-- leaf_194 -->
<g id="node195" class="node">
<title>leaf_194</title>
<polygon fill="none" stroke="#c0c0c0" points="14695.5,-135.0015 14210.5,-135.0015 14210.5,-79.1986 14695.5,-79.1986 14695.5,-135.0015"/>
<text text-anchor="middle" x="14453" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Retrieve a set of results reprs from the database, given a line_id.</text>
</g>
<!-- raw_193&#45;&gt;leaf_194 -->
<g id="edge194" class="edge">
<title>raw_193&#45;&gt;leaf_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14453,-938.5632C14453,-832.6464 14453,-293.6953 14453,-145.0895"/>
<polygon fill="#000000" stroke="#000000" points="14456.5001,-145.0758 14453,-135.0758 14449.5001,-145.0759 14456.5001,-145.0758"/>
</g>
<!-- leaf_202 -->
<g id="node203" class="node">
<title>leaf_202</title>
<polygon fill="none" stroke="#c0c0c0" points="14845.5,-2124.3034 14696.5,-2124.3034 14696.5,-2088.3034 14845.5,-2088.3034 14845.5,-2124.3034"/>
<text text-anchor="middle" x="14771" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_196&#45;&gt;leaf_202 -->
<g id="edge202" class="edge">
<title>header_196&#45;&gt;leaf_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14813.3021,-2556.0526C14806.5926,-2484.7184 14781.8934,-2222.12 14773.6776,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="14777.1377,-2134.1819 14772.7166,-2124.5537 14770.1685,-2134.8375 14777.1377,-2134.1819"/>
</g>
<!-- raw_203 -->
<g id="node204" class="node">
<title>raw_203</title>
<ellipse fill="none" stroke="#000000" cx="14891" cy="-2106.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="14891" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_197&#45;&gt;raw_203 -->
<g id="edge203" class="edge">
<title>prose_197&#45;&gt;raw_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14981.1042,-2556.8715C14966.1481,-2532.292 14939.6741,-2485.2733 14927,-2441.4041 14895.1892,-2331.2963 14890.982,-2193.503 14890.7605,-2134.8523"/>
<polygon fill="#000000" stroke="#000000" points="14894.2604,-2134.5274 14890.761,-2124.5272 14887.2604,-2134.527 14894.2604,-2134.5274"/>
</g>
<!-- leaf_205 -->
<g id="node206" class="node">
<title>leaf_205</title>
<polygon fill="none" stroke="#c0c0c0" points="15499.9015,-2216.944 14936.0985,-2216.944 14936.0985,-1995.6628 15499.9015,-1995.6628 15499.9015,-2216.944"/>
<text text-anchor="middle" x="15218" y="-2201.9236" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="15218" y="-2186.5235" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="15218" y="-2171.1235" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="15218" y="-2155.7235" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15218" y="-2140.3234" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and historian.cursor &#45; 1 or historian.cursor</text>
<text text-anchor="middle" x="15218" y="-2121.5634" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[Δ]</text>
<text text-anchor="middle" x="15218" y="-2102.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="15218" y="-2087.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = _resultsFrom(historian, historian.line_ids[Δ])</text>
<text text-anchor="middle" x="15218" y="-2068.6434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="15218" y="-2053.2434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = Δ</text>
<text text-anchor="middle" x="15218" y="-2034.4834" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="15218" y="-2019.0833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="15218" y="-2003.6833" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_198&#45;&gt;leaf_205 -->
<g id="edge205" class="edge">
<title>codeblock_198&#45;&gt;leaf_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15218,-2556.0526C15218,-2502.5094 15218,-2341.2089 15218,-2227.1432"/>
<polygon fill="#000000" stroke="#000000" points="15221.5001,-2226.9486 15218,-2216.9486 15214.5001,-2226.9487 15221.5001,-2226.9486"/>
</g>
<!-- header_206 -->
<g id="node207" class="node">
<title>header_206</title>
<ellipse fill="none" stroke="#000000" cx="15600" cy="-2106.3034" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="15600" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_199&#45;&gt;header_206 -->
<g id="edge206" class="edge">
<title>section_199&#45;&gt;header_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15664.4146,-2556.0526C15654.1759,-2484.5652 15616.4259,-2220.9909 15603.9969,-2134.2105"/>
<polygon fill="#000000" stroke="#000000" points="15607.4602,-2133.7041 15602.5777,-2124.3013 15600.5309,-2134.6966 15607.4602,-2133.7041"/>
</g>
<!-- prose_207 -->
<g id="node208" class="node">
<title>prose_207</title>
<ellipse fill="none" stroke="#000000" cx="15733" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15733" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_199&#45;&gt;prose_207 -->
<g id="edge207" class="edge">
<title>section_199&#45;&gt;prose_207</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15670.6557,-2555.6952C15675.6593,-2530.1221 15684.7335,-2482.3667 15691,-2441.4041 15708.3258,-2328.1504 15723.6725,-2192.5495 15729.9668,-2134.7025"/>
<polygon fill="#000000" stroke="#000000" points="15733.4731,-2134.8322 15731.0691,-2124.5137 15726.5138,-2134.0792 15733.4731,-2134.8322"/>
</g>
<!-- codeblock_208 -->
<g id="node209" class="node">
<title>codeblock_208</title>
<ellipse fill="none" stroke="#000000" cx="15960" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15960" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 510&#45;534</text>
</g>
<!-- section_199&#45;&gt;codeblock_208 -->
<g id="edge208" class="edge">
<title>section_199&#45;&gt;codeblock_208</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15682.921,-2556.4056C15704.7912,-2531.6568 15744.7411,-2484.8534 15774,-2441.4041 15847.4286,-2332.3632 15918.3027,-2192.0389 15946.8302,-2133.6638"/>
<polygon fill="#000000" stroke="#000000" points="15950.1206,-2134.9007 15951.3484,-2124.3773 15943.8261,-2131.8382 15950.1206,-2134.9007"/>
</g>
<!-- header_219 -->
<g id="node220" class="node">
<title>header_219</title>
<ellipse fill="none" stroke="#000000" cx="16395" cy="-2106.3034" rx="111.1981" ry="18"/>
<text text-anchor="middle" x="16395" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:index(cursor)</text>
</g>
<!-- section_200&#45;&gt;header_219 -->
<g id="edge219" class="edge">
<title>section_200&#45;&gt;header_219</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16472.8743,-2556.0526C16460.4963,-2484.5652 16414.8582,-2220.9909 16399.8321,-2134.2105"/>
<polygon fill="#000000" stroke="#000000" points="16403.2712,-2133.5575 16398.1163,-2124.3013 16396.3739,-2134.7519 16403.2712,-2133.5575"/>
</g>
<!-- prose_220 -->
<g id="node221" class="node">
<title>prose_220</title>
<ellipse fill="none" stroke="#000000" cx="16557" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="16557" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_200&#45;&gt;prose_220 -->
<g id="edge220" class="edge">
<title>section_200&#45;&gt;prose_220</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16482.3747,-2555.8801C16491.0096,-2530.5216 16506.3369,-2483.0141 16515,-2441.4041 16538.3528,-2329.238 16550.5257,-2193.0644 16554.9798,-2134.8853"/>
<polygon fill="#000000" stroke="#000000" points="16558.4907,-2134.8688 16555.7458,-2124.6358 16551.5102,-2134.3471 16558.4907,-2134.8688"/>
</g>
<!-- codeblock_221 -->
<g id="node222" class="node">
<title>codeblock_221</title>
<ellipse fill="none" stroke="#000000" cx="16770" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="16770" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 541&#45;554</text>
</g>
<!-- section_200&#45;&gt;codeblock_221 -->
<g id="edge221" class="edge">
<title>section_200&#45;&gt;codeblock_221</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16495.0675,-2556.5638C16520.6488,-2532.365 16566.5006,-2486.587 16598,-2441.4041 16672.0641,-2335.1662 16734.4715,-2192.7546 16758.9327,-2133.7173"/>
<polygon fill="#000000" stroke="#000000" points="16762.2261,-2134.9112 16762.792,-2124.3314 16755.752,-2132.2491 16762.2261,-2134.9112"/>
</g>
<!-- header_226 -->
<g id="node227" class="node">
<title>header_226</title>
<ellipse fill="none" stroke="#000000" cx="17282" cy="-2106.3034" rx="184.6938" ry="18"/>
<text text-anchor="middle" x="17282" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append(txtbuf, results, success)</text>
</g>
<!-- section_201&#45;&gt;header_226 -->
<g id="edge226" class="edge">
<title>section_201&#45;&gt;header_226</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17580.0947,-2556.3557C17554.6649,-2531.9209 17508.845,-2485.8765 17476,-2441.4041 17396.9342,-2334.3484 17324.1333,-2192.4609 17295.1947,-2133.6437"/>
<polygon fill="#000000" stroke="#000000" points="17298.3151,-2132.0572 17290.776,-2124.6132 17292.0274,-2135.1339 17298.3151,-2132.0572"/>
</g>
<!-- prose_227 -->
<g id="node228" class="node">
<title>prose_227</title>
<ellipse fill="none" stroke="#000000" cx="17517" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="17517" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_201&#45;&gt;prose_227 -->
<g id="edge227" class="edge">
<title>section_201&#45;&gt;prose_227</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17592.2467,-2555.916C17583.109,-2530.5992 17566.9264,-2483.1398 17558,-2441.4041 17534.0462,-2329.4074 17522.7725,-2193.1446 17518.7776,-2134.9138"/>
<polygon fill="#000000" stroke="#000000" points="17522.2513,-2134.4001 17518.0945,-2124.6548 17515.2667,-2134.8653 17522.2513,-2134.4001"/>
</g>
<!-- prose_228 -->
<g id="node229" class="node">
<title>prose_228</title>
<ellipse fill="none" stroke="#000000" cx="17599" cy="-2106.3034" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="17599" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_201&#45;&gt;prose_228 -->
<g id="edge228" class="edge">
<title>section_201&#45;&gt;prose_228</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17599,-2556.0526C17599,-2484.7184 17599,-2222.12 17599,-2134.771"/>
<polygon fill="#000000" stroke="#000000" points="17602.5001,-2134.5536 17599,-2124.5537 17595.5001,-2134.5537 17602.5001,-2134.5536"/>
</g>
<!-- codeblock_229 -->
<g id="node230" class="node">
<title>codeblock_229</title>
<ellipse fill="none" stroke="#000000" cx="17788" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="17788" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 562&#45;577</text>
</g>
<!-- section_201&#45;&gt;codeblock_229 -->
<g id="edge229" class="edge">
<title>section_201&#45;&gt;codeblock_229</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17606.2932,-2556.0526C17635.2342,-2484.4198 17742.0978,-2219.9176 17776.9382,-2133.683"/>
<polygon fill="#000000" stroke="#000000" points="17780.2276,-2134.8843 17780.7285,-2124.3013 17773.7373,-2132.2621 17780.2276,-2134.8843"/>
</g>
<!-- codeblock_230 -->
<g id="node231" class="node">
<title>codeblock_230</title>
<ellipse fill="none" stroke="#000000" cx="18098" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="18098" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 579&#45;586</text>
</g>
<!-- section_201&#45;&gt;codeblock_230 -->
<g id="edge230" class="edge">
<title>section_201&#45;&gt;codeblock_230</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17648.6356,-2560.4286C17709.6006,-2541.6638 17813.5732,-2503.063 17884,-2441.4041 17988.0524,-2350.3059 18060.3096,-2196.5565 18086.8087,-2134.0129"/>
<polygon fill="#000000" stroke="#000000" points="18090.1818,-2135.0184 18090.8065,-2124.442 18083.7226,-2132.3204 18090.1818,-2135.0184"/>
</g>
<!-- codeblock_231 -->
<g id="node232" class="node">
<title>codeblock_231</title>
<ellipse fill="none" stroke="#000000" cx="18409" cy="-2106.3034" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="18409" y="-2102.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 588&#45;590</text>
</g>
<!-- section_201&#45;&gt;codeblock_231 -->
<g id="edge231" class="edge">
<title>section_201&#45;&gt;codeblock_231</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17665.8878,-2565.6879C17802.6536,-2547.4507 18108.6003,-2501.0778 18194,-2441.4041 18308.5571,-2361.3563 18376.2711,-2198.7291 18399.6783,-2133.8915"/>
<polygon fill="#000000" stroke="#000000" points="18403.0172,-2134.9475 18403.055,-2124.3527 18396.4185,-2132.6115 18403.0172,-2134.9475"/>
</g>
<!-- leaf_204 -->
<g id="node205" class="node">
<title>leaf_204</title>
<polygon fill="none" stroke="#c0c0c0" points="14918,-974.7014 14864,-974.7014 14864,-938.7014 14918,-938.7014 14918,-974.7014"/>
</g>
<!-- raw_203&#45;&gt;leaf_204 -->
<g id="edge204" class="edge">
<title>raw_203&#45;&gt;leaf_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14891,-2088.2459C14891,-1956.7256 14891,-1146.7035 14891,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="14894.5001,-984.7191 14891,-974.7192 14887.5001,-984.7192 14894.5001,-984.7191"/>
</g>
<!-- leaf_209 -->
<g id="node210" class="node">
<title>leaf_209</title>
<polygon fill="none" stroke="#c0c0c0" points="15463,-974.7014 15307,-974.7014 15307,-938.7014 15463,-938.7014 15463,-974.7014"/>
<text text-anchor="middle" x="15385" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_206&#45;&gt;leaf_209 -->
<g id="edge209" class="edge">
<title>header_206&#45;&gt;leaf_209</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15598.463,-2088.2999C15593.3182,-2035.9011 15573.2315,-1880.2947 15509,-1771.2027 15497.359,-1751.4314 15482.0869,-1755.8103 15472,-1735.2027 15341.4941,-1468.5794 15370.2885,-1090.6584 15381.6089,-985.066"/>
<polygon fill="#000000" stroke="#000000" points="15385.1132,-985.2207 15382.7373,-974.8957 15378.1559,-984.4487 15385.1132,-985.2207"/>
</g>
<!-- raw_210 -->
<g id="node211" class="node">
<title>raw_210</title>
<ellipse fill="none" stroke="#000000" cx="15508" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15508" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_207&#45;&gt;raw_210 -->
<g id="edge210" class="edge">
<title>prose_207&#45;&gt;raw_210</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15737.0312,-2088.2346C15748.2227,-2032.9186 15773.6749,-1864.0225 15691,-1771.2027 15646.2613,-1720.9743 15586.7339,-1787.1475 15544,-1735.2027 15447.7381,-1618.1925 15492.3579,-1110.0328 15505.0293,-984.7138"/>
<polygon fill="#000000" stroke="#000000" points="15508.5125,-985.0561 15506.0516,-974.7511 15501.549,-984.3416 15508.5125,-985.0561"/>
</g>
<!-- prespace_211 -->
<g id="node212" class="node">
<title>prespace_211</title>
<ellipse fill="none" stroke="#000000" cx="15599" cy="-956.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="15599" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_207&#45;&gt;prespace_211 -->
<g id="edge211" class="edge">
<title>prose_207&#45;&gt;prespace_211</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15734.6898,-2088.0726C15738.74,-2035.7065 15744.9859,-1881.5382 15691,-1771.2027 15681.0553,-1750.8778 15664.404,-1755.7834 15655,-1735.2027 15532.0753,-1466.181 15578.0596,-1089.9515 15594.2817,-984.9098"/>
<polygon fill="#000000" stroke="#000000" points="15597.7765,-985.2177 15595.8833,-974.7934 15590.8626,-984.123 15597.7765,-985.2177"/>
</g>
<!-- literal_212 -->
<g id="node213" class="node">
<title>literal_212</title>
<ellipse fill="none" stroke="#000000" cx="15695" cy="-956.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="15695" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_207&#45;&gt;literal_212 -->
<g id="edge212" class="edge">
<title>prose_207&#45;&gt;literal_212</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15732.4031,-2088.2459C15728.0557,-1956.7256 15701.2805,-1146.7035 15695.9299,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="15699.4241,-984.598 15695.5956,-974.7192 15692.428,-984.8294 15699.4241,-984.598"/>
</g>
<!-- raw_213 -->
<g id="node214" class="node">
<title>raw_213</title>
<ellipse fill="none" stroke="#000000" cx="15771" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15771" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_207&#45;&gt;raw_213 -->
<g id="edge213" class="edge">
<title>prose_207&#45;&gt;raw_213</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15733.5969,-2088.2459C15737.9443,-1956.7256 15764.7195,-1146.7035 15770.0701,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="15773.572,-984.8294 15770.4044,-974.7192 15766.5759,-984.598 15773.572,-984.8294"/>
</g>
<!-- leaf_218 -->
<g id="node219" class="node">
<title>leaf_218</title>
<polygon fill="none" stroke="#c0c0c0" points="16281.9015,-1144.3422 15816.0985,-1144.3422 15816.0985,-769.0606 16281.9015,-769.0606 16281.9015,-1144.3422"/>
<text text-anchor="middle" x="16049" y="-1129.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="16049" y="-1113.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian</text>
<text text-anchor="middle" x="16049" y="-1095.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and historian.cursor + 1</text>
<text text-anchor="middle" x="16049" y="-1079.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or &#160;historian.cursor</text>
<text text-anchor="middle" x="16049" y="-1064.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local fwd = historian.cursor &gt;= #historian</text>
<text text-anchor="middle" x="16049" y="-1048.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="16049" y="-1033.5616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="16049" y="-1018.1615" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16049" y="-1002.7615" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[Δ]</text>
<text text-anchor="middle" x="16049" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="16049" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf(), nil, true</text>
<text text-anchor="middle" x="16049" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16049" y="-937.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="16049" y="-922.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = _resultsFrom(historian, historian.line_ids[Δ])</text>
<text text-anchor="middle" x="16049" y="-903.6414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = Δ</text>
<text text-anchor="middle" x="16049" y="-884.8814" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="16049" y="-869.4813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if fwd and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="16049" y="-854.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="16049" y="-838.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="16049" y="-823.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="16049" y="-807.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="16049" y="-792.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16049" y="-777.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_208&#45;&gt;leaf_218 -->
<g id="edge218" class="edge">
<title>codeblock_208&#45;&gt;leaf_218</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15961.398,-2088.2459C15969.494,-1983.6709 16010.7996,-1450.1315 16033.6844,-1154.5316"/>
<polygon fill="#000000" stroke="#000000" points="16037.1745,-1154.7928 16034.4569,-1144.5524 16030.1954,-1154.2524 16037.1745,-1154.7928"/>
</g>
<!-- leaf_214 -->
<g id="node215" class="node">
<title>leaf_214</title>
<polygon fill="none" stroke="#c0c0c0" points="15554.5,-135.0015 15083.5,-135.0015 15083.5,-79.1986 15554.5,-79.1986 15554.5,-135.0015"/>
<text text-anchor="middle" x="15319" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_210&#45;&gt;leaf_214 -->
<g id="edge214" class="edge">
<title>raw_210&#45;&gt;leaf_214</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15509.6149,-938.5824C15518.5818,-833.986 15558.7904,-307.5454 15472,-178.2001 15461.1597,-162.0447 15445.6448,-149.4862 15428.6107,-139.7457"/>
<polygon fill="#000000" stroke="#000000" points="15430.0483,-136.5452 15419.5812,-134.9048 15426.7408,-142.7145 15430.0483,-136.5452"/>
</g>
<!-- leaf_215 -->
<g id="node216" class="node">
<title>leaf_215</title>
<polygon fill="none" stroke="#c0c0c0" points="15627,-125.1 15573,-125.1 15573,-89.1 15627,-89.1 15627,-125.1"/>
</g>
<!-- prespace_211&#45;&gt;leaf_215 -->
<g id="edge215" class="edge">
<title>prespace_211&#45;&gt;leaf_215</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15599.0213,-938.5632C15599.1488,-830.2631 15599.8092,-269.2221 15599.9664,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="15603.4666,-135.4334 15599.9784,-125.4293 15596.4666,-135.4251 15603.4666,-135.4334"/>
</g>
<!-- leaf_216 -->
<g id="node217" class="node">
<title>leaf_216</title>
<polygon fill="none" stroke="#c0c0c0" points="15745,-125.1 15645,-125.1 15645,-89.1 15745,-89.1 15745,-125.1"/>
<text text-anchor="middle" x="15695" y="-103.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_212&#45;&gt;leaf_216 -->
<g id="edge216" class="edge">
<title>literal_212&#45;&gt;leaf_216</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15695,-938.5632C15695,-830.2631 15695,-269.2221 15695,-135.6604"/>
<polygon fill="#000000" stroke="#000000" points="15698.5001,-135.4293 15695,-125.4293 15691.5001,-135.4293 15698.5001,-135.4293"/>
</g>
<!-- leaf_217 -->
<g id="node218" class="node">
<title>leaf_217</title>
<polygon fill="none" stroke="#c0c0c0" points="16003,-127.0021 15763,-127.0021 15763,-87.198 16003,-87.198 16003,-127.0021"/>
<text text-anchor="middle" x="15883" y="-111.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_213&#45;&gt;leaf_217 -->
<g id="edge217" class="edge">
<title>raw_213&#45;&gt;leaf_217</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15770.0207,-938.6136C15764.6953,-835.2944 15741.7898,-319.472 15807,-178.2001 15815.1782,-160.4828 15829.9824,-145.0602 15844.3664,-133.1494"/>
<polygon fill="#000000" stroke="#000000" points="15846.5955,-135.8488 15852.2695,-126.9014 15842.2542,-130.3576 15846.5955,-135.8488"/>
</g>
<!-- leaf_222 -->
<g id="node223" class="node">
<title>leaf_222</title>
<polygon fill="none" stroke="#c0c0c0" points="16504.5,-974.7014 16299.5,-974.7014 16299.5,-938.7014 16504.5,-938.7014 16504.5,-974.7014"/>
<text text-anchor="middle" x="16402" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:index(cursor)</text>
</g>
<!-- header_219&#45;&gt;leaf_222 -->
<g id="edge222" class="edge">
<title>header_219&#45;&gt;leaf_222</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16395.11,-2088.2459C16395.9108,-1956.7256 16400.8431,-1146.7035 16401.8287,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="16405.3292,-984.7403 16401.8903,-974.7192 16398.3294,-984.6976 16405.3292,-984.7403"/>
</g>
<!-- raw_223 -->
<g id="node224" class="node">
<title>raw_223</title>
<ellipse fill="none" stroke="#000000" cx="16550" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="16550" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_220&#45;&gt;raw_223 -->
<g id="edge223" class="edge">
<title>prose_220&#45;&gt;raw_223</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16556.89,-2088.2459C16556.0892,-1956.7256 16551.1569,-1146.7035 16550.1713,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="16553.6706,-984.6976 16550.1097,-974.7192 16546.6708,-984.7403 16553.6706,-984.6976"/>
</g>
<!-- leaf_225 -->
<g id="node226" class="node">
<title>leaf_225</title>
<polygon fill="none" stroke="#c0c0c0" points="17094.5,-1053.0019 16595.5,-1053.0019 16595.5,-860.4009 17094.5,-860.4009 17094.5,-1053.0019"/>
<text text-anchor="middle" x="16845" y="-1037.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.index(historian, cursor)</text>
<text text-anchor="middle" x="16845" y="-1022.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (not cursor) or cursor &lt; 0 or cursor &gt; #historian + 1 then</text>
<text text-anchor="middle" x="16845" y="-1007.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="16845" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="16845" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[cursor]</text>
<text text-anchor="middle" x="16845" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = _resultsFrom(historian, historian.line_ids[cursor])</text>
<text text-anchor="middle" x="16845" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf = txtbuf:clone()</text>
<text text-anchor="middle" x="16845" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = cursor</text>
<text text-anchor="middle" x="16845" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="16845" y="-899.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="16845" y="-883.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf, result</text>
<text text-anchor="middle" x="16845" y="-868.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_221&#45;&gt;leaf_225 -->
<g id="edge225" class="edge">
<title>codeblock_221&#45;&gt;leaf_225</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16771.1781,-2088.2459C16778.7824,-1971.6858 16821.1547,-1322.2026 16838.0469,-1063.278"/>
<polygon fill="#000000" stroke="#000000" points="16841.5517,-1063.3185 16838.7102,-1053.1118 16834.5665,-1062.8627 16841.5517,-1063.3185"/>
</g>
<!-- leaf_224 -->
<g id="node225" class="node">
<title>leaf_224</title>
<polygon fill="none" stroke="#c0c0c0" points="16684,-135.0015 16416,-135.0015 16416,-79.1986 16684,-79.1986 16684,-135.0015"/>
<text text-anchor="middle" x="16550" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Loads the history to an exact index.</text>
</g>
<!-- raw_223&#45;&gt;leaf_224 -->
<g id="edge224" class="edge">
<title>raw_223&#45;&gt;leaf_224</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16550,-938.5632C16550,-832.6464 16550,-293.6953 16550,-145.0895"/>
<polygon fill="#000000" stroke="#000000" points="16553.5001,-145.0758 16550,-135.0758 16546.5001,-145.0759 16553.5001,-145.0758"/>
</g>
<!-- leaf_232 -->
<g id="node233" class="node">
<title>leaf_232</title>
<polygon fill="none" stroke="#c0c0c0" points="17451,-974.7014 17113,-974.7014 17113,-938.7014 17451,-938.7014 17451,-974.7014"/>
<text text-anchor="middle" x="17282" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append(txtbuf, results, success)</text>
</g>
<!-- header_226&#45;&gt;leaf_232 -->
<g id="edge232" class="edge">
<title>header_226&#45;&gt;leaf_232</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17282,-2088.2459C17282,-1956.7256 17282,-1146.7035 17282,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="17285.5001,-984.7191 17282,-974.7192 17278.5001,-984.7192 17285.5001,-984.7191"/>
</g>
<!-- raw_233 -->
<g id="node234" class="node">
<title>raw_233</title>
<ellipse fill="none" stroke="#000000" cx="17496" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="17496" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_227&#45;&gt;raw_233 -->
<g id="edge233" class="edge">
<title>prose_227&#45;&gt;raw_233</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17516.6701,-2088.2459C17514.2676,-1956.7256 17499.4708,-1146.7035 17496.5139,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="17500.0113,-984.6535 17496.3291,-974.7192 17493.0125,-984.7815 17500.0113,-984.6535"/>
</g>
<!-- raw_235 -->
<g id="node236" class="node">
<title>raw_235</title>
<ellipse fill="none" stroke="#000000" cx="17568" cy="-956.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="17568" y="-952.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_228&#45;&gt;raw_235 -->
<g id="edge235" class="edge">
<title>prose_228&#45;&gt;raw_235</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17598.5131,-2088.2459C17594.9665,-1956.7256 17573.1236,-1146.7035 17568.7586,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="17572.2542,-984.6212 17568.4859,-974.7192 17565.2568,-984.8099 17572.2542,-984.6212"/>
</g>
<!-- leaf_237 -->
<g id="node238" class="node">
<title>leaf_237</title>
<polygon fill="none" stroke="#c0c0c0" points="18063,-1068.3022 17613,-1068.3022 17613,-845.1006 18063,-845.1006 18063,-1068.3022"/>
<text text-anchor="middle" x="17838" y="-1053.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="17838" y="-1037.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf)</text>
<text text-anchor="middle" x="17838" y="-1022.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or tostring(txtbuf) == &quot;&quot; then</text>
<text text-anchor="middle" x="17838" y="-1007.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="17838" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="17838" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="17838" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="17838" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="17838" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="17838" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="17838" y="-899.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="17838" y="-883.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="17838" y="-868.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="17838" y="-853.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_229&#45;&gt;leaf_237 -->
<g id="edge237" class="edge">
<title>codeblock_229&#45;&gt;leaf_237</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17788.7854,-2088.2459C17793.7563,-1973.9549 17821.0121,-1347.2872 17832.6879,-1078.8364"/>
<polygon fill="#000000" stroke="#000000" points="17836.1926,-1078.803 17833.1305,-1068.6603 17829.1992,-1078.4987 17836.1926,-1078.803"/>
</g>
<!-- leaf_238 -->
<g id="node239" class="node">
<title>leaf_238</title>
<polygon fill="none" stroke="#c0c0c0" points="18349,-1007.1024 18081,-1007.1024 18081,-906.3004 18349,-906.3004 18349,-1007.1024"/>
<text text-anchor="middle" x="18215" y="-991.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="18215" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="18215" y="-960.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="18215" y="-945.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="18215" y="-930.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="18215" y="-914.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_230&#45;&gt;leaf_238 -->
<g id="edge238" class="edge">
<title>codeblock_230&#45;&gt;leaf_238</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M18099.8378,-2088.2459C18112.4878,-1963.9517 18186.8121,-1233.6657 18208.8464,-1017.165"/>
<polygon fill="#000000" stroke="#000000" points="18212.3558,-1017.2493 18209.8864,-1006.9463 18205.3917,-1016.5405 18212.3558,-1017.2493"/>
</g>
<!-- leaf_239 -->
<g id="node240" class="node">
<title>leaf_239</title>
<polygon fill="none" stroke="#c0c0c0" points="18453,-974.7014 18367,-974.7014 18367,-938.7014 18453,-938.7014 18453,-974.7014"/>
<text text-anchor="middle" x="18410" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_231&#45;&gt;leaf_239 -->
<g id="edge239" class="edge">
<title>codeblock_231&#45;&gt;leaf_239</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M18409.0157,-2088.2459C18409.1301,-1956.7256 18409.8347,-1146.7035 18409.9755,-984.8343"/>
<polygon fill="#000000" stroke="#000000" points="18413.4755,-984.7222 18409.9843,-974.7192 18406.4755,-984.7161 18413.4755,-984.7222"/>
</g>
<!-- leaf_234 -->
<g id="node235" class="node">
<title>leaf_234</title>
<polygon fill="none" stroke="#c0c0c0" points="17554,-135.0015 17230,-135.0015 17230,-79.1986 17554,-79.1986 17554,-135.0015"/>
<text text-anchor="middle" x="17392" y="-87.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_233&#45;&gt;leaf_234 -->
<g id="edge234" class="edge">
<title>raw_233&#45;&gt;leaf_234</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17499.5926,-938.7142C17516.2729,-850.8103 17580.3882,-459.2839 17460,-178.2001 17454.3182,-164.9341 17444.9795,-152.6799 17435.0169,-142.2146"/>
<polygon fill="#000000" stroke="#000000" points="17437.2505,-139.4994 17427.6956,-134.9216 17432.3103,-144.4587 17437.2505,-139.4994"/>
</g>
<!-- leaf_236 -->
<g id="node237" class="node">
<title>leaf_236</title>
<polygon fill="none" stroke="#c0c0c0" points="17770,-127.0021 17572,-127.0021 17572,-87.198 17770,-87.198 17770,-127.0021"/>
<text text-anchor="middle" x="17671" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_235&#45;&gt;leaf_236 -->
<g id="edge236" class="edge">
<title>raw_235&#45;&gt;leaf_236</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M17564.4503,-938.7324C17547.971,-850.9142 17484.6522,-459.7273 17604,-178.2001 17611.194,-161.2303 17624.3537,-145.8557 17637.1178,-133.7798"/>
<polygon fill="#000000" stroke="#000000" points="17639.4731,-136.3688 17644.5394,-127.0638 17634.7762,-131.1785 17639.4731,-136.3688"/>
</g>
</g>
</svg>
