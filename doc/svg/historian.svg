<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="7931pt" height="2036pt"
 viewBox="0.00 0.00 7931.00 2035.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2031.6029)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2031.6029 7927,-2031.6029 7927,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1726" cy="-2009.6029" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1726" y="-2005.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 290</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1726" cy="-1937.6029" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1726" y="-1933.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;220</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1726,-1991.4343C1726,-1983.7339 1726,-1974.5773 1726,-1966.0196"/>
<polygon fill="#000000" stroke="#000000" points="1729.5001,-1966.0162 1726,-1956.0162 1722.5001,-1966.0162 1729.5001,-1966.0162"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1300" cy="-1865.6029" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1300" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1665.834,-1930.3643C1594.7845,-1921.3813 1473.2106,-1904.6445 1370,-1883.6029 1364.6208,-1882.5063 1359.0358,-1881.2588 1353.4724,-1879.9439"/>
<polygon fill="#000000" stroke="#000000" points="1354.075,-1876.4885 1343.5307,-1877.5227 1352.4185,-1883.2897 1354.075,-1876.4885"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1411" cy="-1865.6029" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1411" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1667.0711,-1929.6009C1611.1757,-1921.1583 1525.2326,-1905.954 1453,-1883.6029 1450.5464,-1882.8437 1448.0417,-1881.9887 1445.5381,-1881.0741"/>
<polygon fill="#000000" stroke="#000000" points="1446.5845,-1877.725 1435.9971,-1877.3291 1444.0268,-1884.241 1446.5845,-1877.725"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1494" cy="-1865.6029" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1494" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1677.0429,-1925.5324C1638.3491,-1915.552 1583.1859,-1900.3421 1536,-1883.6029 1533.5795,-1882.7442 1531.0994,-1881.8149 1528.6137,-1880.8464"/>
<polygon fill="#000000" stroke="#000000" points="1529.6934,-1877.5073 1519.1115,-1876.9843 1527.0577,-1883.9921 1529.6934,-1877.5073"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1577" cy="-1865.6029" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1577" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1693.3013,-1921.8022C1668.8419,-1909.9829 1635.4944,-1893.8687 1610.7785,-1881.9254"/>
<polygon fill="#000000" stroke="#000000" points="1612.2918,-1878.7695 1601.765,-1877.5699 1609.2461,-1885.0722 1612.2918,-1878.7695"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1659" cy="-1865.6029" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1659" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1709.4382,-1919.8052C1700.8766,-1910.6047 1690.312,-1899.2516 1681.0672,-1889.317"/>
<polygon fill="#000000" stroke="#000000" points="1683.3742,-1886.6583 1673.9996,-1881.7219 1678.2497,-1891.4269 1683.3742,-1886.6583"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1788" cy="-1865.6029" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1788" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1741.3258,-1919.8052C1748.7779,-1911.1512 1757.8698,-1900.5929 1766.0427,-1891.1018"/>
<polygon fill="#000000" stroke="#000000" points="1768.7625,-1893.307 1772.6356,-1883.4455 1763.4581,-1888.7393 1768.7625,-1893.307"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2002" cy="-1865.6029" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2002" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1773.7604,-1925.1437C1819.9018,-1913.1068 1890.0111,-1894.8174 1940.3461,-1881.6866"/>
<polygon fill="#000000" stroke="#000000" points="1941.3438,-1885.0435 1950.1365,-1879.1325 1939.5768,-1878.2702 1941.3438,-1885.0435"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2402" cy="-1865.6029" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2402" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;130</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787.4824,-1931.0545C1911.5898,-1917.836 2191.6881,-1888.003 2326.5886,-1873.6349"/>
<polygon fill="#000000" stroke="#000000" points="2327.2579,-1877.0835 2336.8309,-1872.544 2326.5164,-1870.1229 2327.2579,-1877.0835"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="4629" cy="-1865.6029" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4629" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 175&#45;220</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1791.3938,-1935.981C2173.1432,-1926.5129 4111.5951,-1878.4356 4543.5812,-1867.7215"/>
<polygon fill="#000000" stroke="#000000" points="4543.8972,-1871.2148 4553.8073,-1867.4679 4543.7236,-1864.217 4543.8972,-1871.2148"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="5657" cy="-1865.6029" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5657" y="-1861.4029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;265</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1791.6934,-1936.4394C2111.9595,-1930.7618 3541.6762,-1905.358 4713,-1883.6029 5029.6442,-1877.7219 5406.0268,-1870.4653 5571.6231,-1867.2592"/>
<polygon fill="#000000" stroke="#000000" points="5571.8144,-1870.7562 5581.7447,-1867.0632 5571.6788,-1863.7575 5571.8144,-1870.7562"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1340.5,-1764.0028 1247.5,-1764.0028 1247.5,-1728.0028 1340.5,-1728.0028 1340.5,-1764.0028"/>
<text text-anchor="middle" x="1294" y="-1742.5028" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1299.0887,-1847.4382C1298.1152,-1828.0322 1296.559,-1797.0129 1295.4236,-1774.3808"/>
<polygon fill="#000000" stroke="#000000" points="1298.9166,-1774.1505 1294.9198,-1764.3384 1291.9254,-1774.5013 1298.9166,-1774.1505"/>
</g>
<!-- raw_13 -->
<g id="node14" class="node">
<title>raw_13</title>
<ellipse fill="none" stroke="#000000" cx="1386" cy="-1746.0028" rx="27" ry="18"/>
<text text-anchor="middle" x="1386" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;raw_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1407.2572,-1847.6976C1403.1886,-1828.2331 1396.6324,-1796.8683 1391.8758,-1774.1127"/>
<polygon fill="#000000" stroke="#000000" points="1395.2404,-1773.1028 1389.7683,-1764.0306 1388.3885,-1774.5352 1395.2404,-1773.1028"/>
</g>
<!-- raw_15 -->
<g id="node16" class="node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="1458" cy="-1746.0028" rx="27" ry="18"/>
<text text-anchor="middle" x="1458" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_4&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1488.6104,-1847.6976C1482.7251,-1828.1451 1473.2251,-1796.5842 1466.3684,-1773.8044"/>
<polygon fill="#000000" stroke="#000000" points="1469.6602,-1772.5974 1463.4264,-1764.0306 1462.9573,-1774.615 1469.6602,-1772.5974"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="1530" cy="-1746.0028" rx="27" ry="18"/>
<text text-anchor="middle" x="1530" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_5&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1570.065,-1847.9555C1562.3243,-1828.258 1549.705,-1796.1458 1540.6975,-1773.2246"/>
<polygon fill="#000000" stroke="#000000" points="1543.8785,-1771.7496 1536.9635,-1763.7226 1537.3635,-1774.3099 1543.8785,-1771.7496"/>
</g>
<!-- raw_19 -->
<g id="node20" class="node">
<title>raw_19</title>
<ellipse fill="none" stroke="#000000" cx="1602" cy="-1746.0028" rx="27" ry="18"/>
<text text-anchor="middle" x="1602" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;raw_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1650.5895,-1847.9555C1641.1056,-1828.056 1625.583,-1795.4857 1614.6388,-1772.5222"/>
<polygon fill="#000000" stroke="#000000" points="1617.7216,-1770.8552 1610.2597,-1763.3338 1611.4025,-1773.8668 1617.7216,-1770.8552"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1929,-1811.7032 1647,-1811.7032 1647,-1680.3024 1929,-1680.3024 1929,-1811.7032"/>
<text text-anchor="middle" x="1788" y="-1796.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">local Linebuf = require &quot;linebuf&quot;</text>
<text text-anchor="middle" x="1788" y="-1781.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1788" y="-1765.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1788" y="-1750.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1788" y="-1734.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1788" y="-1719.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1788" y="-1704.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1788" y="-1688.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1788,-1847.4382C1788,-1840.1633 1788,-1831.2562 1788,-1821.7708"/>
<polygon fill="#000000" stroke="#000000" points="1791.5001,-1821.7207 1788,-1811.7208 1784.5001,-1821.7208 1791.5001,-1821.7207"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2138.5,-1764.0028 1947.5,-1764.0028 1947.5,-1728.0028 2138.5,-1728.0028 2138.5,-1764.0028"/>
<text text-anchor="middle" x="2043" y="-1742.5028" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_8&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2008.227,-1847.4382C2014.9097,-1827.9444 2025.6096,-1796.732 2033.3769,-1774.074"/>
<polygon fill="#000000" stroke="#000000" points="2036.7823,-1774.9331 2036.7144,-1764.3384 2030.1606,-1772.663 2036.7823,-1774.9331"/>
</g>
<!-- header_23 -->
<g id="node24" class="node">
<title>header_23</title>
<ellipse fill="none" stroke="#000000" cx="2225" cy="-1746.0028" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2225" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;header_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2368.9334,-1849.6691C2349.2171,-1839.6602 2324.016,-1825.9593 2303,-1811.6029 2284.8783,-1799.2237 2266.0069,-1783.4411 2251.3661,-1770.4588"/>
<polygon fill="#000000" stroke="#000000" points="2253.4781,-1767.6512 2243.6992,-1763.5739 2248.8011,-1772.8595 2253.4781,-1767.6512"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="2344" cy="-1746.0028" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2344" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2393.3168,-1847.6976C2383.6941,-1827.8549 2368.0738,-1795.6447 2356.9933,-1772.796"/>
<polygon fill="#000000" stroke="#000000" points="2360.066,-1771.1107 2352.5532,-1763.6402 2353.7675,-1774.1652 2360.066,-1771.1107"/>
</g>
<!-- section_25 -->
<g id="node26" class="node">
<title>section_25</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1746.0028" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2460" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 35&#45;96</text>
</g>
<!-- section_9&#45;&gt;section_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;section_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2410.6832,-1847.6976C2420.2506,-1827.9689 2435.7468,-1796.0146 2446.8152,-1773.1909"/>
<polygon fill="#000000" stroke="#000000" points="2450.0432,-1774.5556 2451.2575,-1764.0306 2443.7447,-1771.5011 2450.0432,-1774.5556"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2929" cy="-1746.0028" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2929" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 97&#45;130</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2454.9437,-1853.5876C2552.8001,-1831.3796 2761.5245,-1784.0106 2866.2851,-1760.2356"/>
<polygon fill="#000000" stroke="#000000" points="2867.1141,-1763.6366 2876.0915,-1758.0101 2865.5649,-1756.8102 2867.1141,-1763.6366"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="3894" cy="-1746.0028" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3894" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 131&#45;174</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2469.4951,-1860.1925C2712.9941,-1840.6733 3545.8555,-1773.9104 3811.7218,-1752.5983"/>
<polygon fill="#000000" stroke="#000000" points="3812.3828,-1756.0566 3822.0712,-1751.7687 3811.8234,-1749.079 3812.3828,-1756.0566"/>
</g>
<!-- header_73 -->
<g id="node74" class="node">
<title>header_73</title>
<ellipse fill="none" stroke="#000000" cx="4550" cy="-1746.0028" rx="107.339" ry="18"/>
<text text-anchor="middle" x="4550" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_73 -->
<g id="edge73" class="edge">
<title>section_10&#45;&gt;header_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4617.1729,-1847.6976C4604.0251,-1827.7928 4582.6569,-1795.443 4567.5563,-1772.5817"/>
<polygon fill="#000000" stroke="#000000" points="4570.3399,-1770.4456 4561.908,-1764.0306 4564.4991,-1774.3037 4570.3399,-1770.4456"/>
</g>
<!-- prose_74 -->
<g id="node75" class="node">
<title>prose_74</title>
<ellipse fill="none" stroke="#000000" cx="4708" cy="-1746.0028" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4708" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_74 -->
<g id="edge74" class="edge">
<title>section_10&#45;&gt;prose_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4641.4746,-1847.6981C4648.7161,-1837.2298 4657.9661,-1823.7298 4666,-1811.6029 4674.6297,-1798.5766 4684.0256,-1783.9451 4691.738,-1771.8112"/>
<polygon fill="#000000" stroke="#000000" points="4694.8701,-1773.4073 4697.2669,-1763.0871 4688.9575,-1769.6601 4694.8701,-1773.4073"/>
</g>
<!-- codeblock_75 -->
<g id="node76" class="node">
<title>codeblock_75</title>
<ellipse fill="none" stroke="#000000" cx="4938" cy="-1746.0028" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4938" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 177&#45;218</text>
</g>
<!-- section_10&#45;&gt;codeblock_75 -->
<g id="edge75" class="edge">
<title>section_10&#45;&gt;codeblock_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4668.7638,-1850.2122C4724.6186,-1828.5932 4826.3073,-1789.2341 4887.4602,-1765.5645"/>
<polygon fill="#000000" stroke="#000000" points="4888.8511,-1768.7792 4896.9136,-1761.9055 4886.3244,-1762.2512 4888.8511,-1768.7792"/>
</g>
<!-- header_80 -->
<g id="node81" class="node">
<title>header_80</title>
<ellipse fill="none" stroke="#000000" cx="5406" cy="-1746.0028" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="5406" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_11&#45;&gt;header_80 -->
<g id="edge80" class="edge">
<title>section_11&#45;&gt;header_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5620.587,-1849.6863C5596.7045,-1839.1318 5564.857,-1824.8387 5537,-1811.6029 5506.8198,-1797.2633 5473.118,-1780.3663 5447.4561,-1767.3126"/>
<polygon fill="#000000" stroke="#000000" points="5448.8856,-1764.1128 5438.3869,-1762.6891 5445.7063,-1770.3492 5448.8856,-1764.1128"/>
</g>
<!-- prose_81 -->
<g id="node82" class="node">
<title>prose_81</title>
<ellipse fill="none" stroke="#000000" cx="5578" cy="-1746.0028" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5578" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_81 -->
<g id="edge81" class="edge">
<title>section_11&#45;&gt;prose_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5645.1729,-1847.6976C5631.8731,-1827.5627 5610.1618,-1794.6933 5595.0351,-1771.7927"/>
<polygon fill="#000000" stroke="#000000" points="5597.8263,-1769.668 5589.3944,-1763.253 5591.9855,-1773.5261 5597.8263,-1769.668"/>
</g>
<!-- codeblock_82 -->
<g id="node83" class="node">
<title>codeblock_82</title>
<ellipse fill="none" stroke="#000000" cx="5726" cy="-1746.0028" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5726" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 223&#45;235</text>
</g>
<!-- section_11&#45;&gt;codeblock_82 -->
<g id="edge82" class="edge">
<title>section_11&#45;&gt;codeblock_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5667.33,-1847.6976C5678.7627,-1827.8808 5697.3118,-1795.729 5710.4906,-1772.8857"/>
<polygon fill="#000000" stroke="#000000" points="5713.6338,-1774.4415 5715.5994,-1764.0306 5707.5705,-1770.9434 5713.6338,-1774.4415"/>
</g>
<!-- section_83 -->
<g id="node84" class="node">
<title>section_83</title>
<ellipse fill="none" stroke="#000000" cx="6095" cy="-1746.0028" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="6095" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 238&#45;265</text>
</g>
<!-- section_11&#45;&gt;section_83 -->
<g id="edge83" class="edge">
<title>section_11&#45;&gt;section_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5706.8177,-1851.9997C5787.995,-1829.8335 5948.4676,-1786.0149 6035.502,-1762.2493"/>
<polygon fill="#000000" stroke="#000000" points="6036.504,-1765.6039 6045.2288,-1759.5933 6034.66,-1758.8512 6036.504,-1765.6039"/>
</g>
<!-- section_84 -->
<g id="node85" class="node">
<title>section_84</title>
<ellipse fill="none" stroke="#000000" cx="7065" cy="-1746.0028" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7065" y="-1741.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 266&#45;290</text>
</g>
<!-- section_11&#45;&gt;section_84 -->
<g id="edge84" class="edge">
<title>section_11&#45;&gt;section_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5728.2725,-1859.5488C5966.0569,-1839.3506 6731.3332,-1774.3456 6983.5394,-1752.9223"/>
<polygon fill="#000000" stroke="#000000" points="6984.0608,-1756.3907 6993.7287,-1752.0568 6983.4683,-1749.4159 6984.0608,-1756.3907"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-1367.4033 0,-1367.4033 0,-1295.6009 324,-1295.6009 324,-1367.4033"/>
<text text-anchor="middle" x="162" y="-1304.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>raw_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1381.2533,-1728.0417C1376.0999,-1712.4788 1366.2052,-1690.8647 1349,-1680.4027 1252.4833,-1621.7135 429.1215,-1703.737 333,-1644.4027 235.9717,-1584.5087 190.0439,-1448.8205 171.9126,-1377.4113"/>
<polygon fill="#000000" stroke="#000000" points="175.2266,-1376.2312 169.4364,-1367.3586 168.4298,-1377.9055 175.2266,-1376.2312"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-1358.8025 342.5,-1358.8025 342.5,-1304.2017 897.5,-1304.2017 897.5,-1358.8025"/>
<text text-anchor="middle" x="620" y="-1327.7021" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1312.3021" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1453.4341,-1728.1955C1448.4553,-1712.7361 1438.8505,-1691.1876 1422,-1680.4027 1325.3732,-1618.5578 1010.3441,-1694.2176 907,-1644.4027 778.9499,-1582.6788 680.9609,-1436.3934 640.4048,-1367.9696"/>
<polygon fill="#000000" stroke="#000000" points="643.3656,-1366.0994 635.2919,-1359.2389 637.3252,-1369.6369 643.3656,-1366.0994"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-1358.8025 916,-1358.8025 916,-1304.2017 1464,-1304.2017 1464,-1358.8025"/>
<text text-anchor="middle" x="1190" y="-1327.7021" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1312.3021" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1521.7844,-1728.691C1515.0378,-1715.106 1504.855,-1695.9564 1494,-1680.4027 1407.7967,-1556.8859 1284.8092,-1427.1562 1225.1492,-1366.5601"/>
<polygon fill="#000000" stroke="#000000" points="1227.3672,-1363.825 1217.8496,-1359.1703 1222.3872,-1368.7443 1227.3672,-1363.825"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-1366.8025 1482,-1366.8025 1482,-1296.2018 2030,-1296.2018 2030,-1366.8025"/>
<text text-anchor="middle" x="1756" y="-1335.7021" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new linebuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1320.3021" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>raw_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1608.5188,-1728.457C1631.0001,-1667.9472 1705.7522,-1466.7472 1739.3696,-1376.2639"/>
<polygon fill="#000000" stroke="#000000" points="1742.6741,-1377.419 1742.876,-1366.8261 1736.1124,-1374.9811 1742.6741,-1377.419"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-1349.5021 2048,-1349.5021 2048,-1313.5021 2162,-1313.5021 2162,-1349.5021"/>
<text text-anchor="middle" x="2105" y="-1328.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_23&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>header_23&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2213.4212,-1728.0001C2201.1958,-1708.2325 2182.178,-1675.1965 2171,-1644.4027 2134.238,-1543.1283 2115.2844,-1415.5891 2108.265,-1359.8028"/>
<polygon fill="#000000" stroke="#000000" points="2111.709,-1359.1313 2107.0185,-1349.6313 2104.761,-1359.9828 2111.709,-1359.1313"/>
</g>
<!-- raw_29 -->
<g id="node30" class="node">
<title>raw_29</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1331.5021" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_29 -->
<g id="edge29" class="edge">
<title>prose_24&#45;&gt;raw_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2335.9827,-1728.5505C2328.8248,-1714.346 2317.2781,-1694.4235 2303,-1680.4027 2280.8111,-1658.6136 2259.8461,-1670.5431 2243,-1644.4027 2184.7193,-1553.9677 2194.759,-1417.7137 2202.5275,-1359.4908"/>
<polygon fill="#000000" stroke="#000000" points="2205.9976,-1359.948 2203.9346,-1349.556 2199.0667,-1358.9663 2205.9976,-1359.948"/>
</g>
<!-- header_31 -->
<g id="node32" class="node">
<title>header_31</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-1331.5021" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_25&#45;&gt;header_31 -->
<g id="edge31" class="edge">
<title>section_25&#45;&gt;header_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2451.9834,-1727.8754C2443.2383,-1707.7263 2429.136,-1674.1055 2419,-1644.4027 2383.6442,-1540.7956 2351.3387,-1414.5286 2337.7639,-1359.4427"/>
<polygon fill="#000000" stroke="#000000" points="2341.1569,-1358.5834 2335.3768,-1349.7042 2334.3582,-1360.2499 2341.1569,-1358.5834"/>
</g>
<!-- prose_32 -->
<g id="node33" class="node">
<title>prose_32</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_25&#45;&gt;prose_32 -->
<g id="edge32" class="edge">
<title>section_25&#45;&gt;prose_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2460,-1727.9257C2460,-1662.7427 2460,-1439.4399 2460,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="2463.5001,-1359.6743 2460,-1349.6744 2456.5001,-1359.6744 2463.5001,-1359.6743"/>
</g>
<!-- codeblock_33 -->
<g id="node34" class="node">
<title>codeblock_33</title>
<ellipse fill="none" stroke="#000000" cx="2588" cy="-1331.5021" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2588" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 37&#45;94</text>
</g>
<!-- section_25&#45;&gt;codeblock_33 -->
<g id="edge33" class="edge">
<title>section_25&#45;&gt;codeblock_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2468.0333,-1727.8811C2476.793,-1707.7369 2490.908,-1674.1205 2501,-1644.4027 2536.173,-1540.8292 2567.9986,-1414.5449 2581.3515,-1359.4487"/>
<polygon fill="#000000" stroke="#000000" points="2584.7586,-1360.2499 2583.6991,-1349.7082 2577.9534,-1358.6097 2584.7586,-1360.2499"/>
</g>
<!-- header_38 -->
<g id="node39" class="node">
<title>header_38</title>
<ellipse fill="none" stroke="#000000" cx="2862" cy="-1331.5021" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2862" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_26&#45;&gt;header_38 -->
<g id="edge38" class="edge">
<title>section_26&#45;&gt;header_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2926.078,-1727.9257C2915.5418,-1662.7427 2879.4471,-1439.4399 2866.592,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="2869.9883,-1358.9877 2864.9374,-1349.6744 2863.078,-1360.1048 2869.9883,-1358.9877"/>
</g>
<!-- prose_39 -->
<g id="node40" class="node">
<title>prose_39</title>
<ellipse fill="none" stroke="#000000" cx="2995" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2995" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_39 -->
<g id="edge39" class="edge">
<title>section_26&#45;&gt;prose_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2933.8822,-1727.7635C2939.1672,-1707.5163 2947.5667,-1673.8102 2953,-1644.4027 2972.2784,-1540.0595 2986.418,-1414.5896 2992.1661,-1359.6176"/>
<polygon fill="#000000" stroke="#000000" points="2995.6558,-1359.8973 2993.2029,-1349.5903 2988.6929,-1359.1773 2995.6558,-1359.8973"/>
</g>
<!-- codeblock_40 -->
<g id="node41" class="node">
<title>codeblock_40</title>
<ellipse fill="none" stroke="#000000" cx="3204" cy="-1331.5021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3204" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 101&#45;128</text>
</g>
<!-- section_26&#45;&gt;codeblock_40 -->
<g id="edge40" class="edge">
<title>section_26&#45;&gt;codeblock_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2951.0724,-1728.6599C2974.2126,-1709.7069 3010.6636,-1677.5925 3036,-1644.4027 3109.4113,-1548.2364 3168.9845,-1415.6629 3192.8044,-1358.9897"/>
<polygon fill="#000000" stroke="#000000" points="3196.0902,-1360.2038 3196.7036,-1349.6267 3189.6281,-1357.5127 3196.0902,-1360.2038"/>
</g>
<!-- header_45 -->
<g id="node46" class="node">
<title>header_45</title>
<ellipse fill="none" stroke="#000000" cx="3644" cy="-1331.5021" rx="117.9886" ry="18"/>
<text text-anchor="middle" x="3644" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(linebuf)</text>
</g>
<!-- section_27&#45;&gt;header_45 -->
<g id="edge45" class="edge">
<title>section_27&#45;&gt;header_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3866.3981,-1729.0983C3838.9674,-1711.08 3797.2966,-1680.2445 3771,-1644.4027 3702.9275,-1551.6212 3664.5813,-1417.1696 3650.3954,-1359.4916"/>
<polygon fill="#000000" stroke="#000000" points="3653.768,-1358.5466 3648.0261,-1349.6426 3646.9622,-1360.1839 3653.768,-1358.5466"/>
</g>
<!-- prose_46 -->
<g id="node47" class="node">
<title>prose_46</title>
<ellipse fill="none" stroke="#000000" cx="3812" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3812" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_46 -->
<g id="edge46" class="edge">
<title>section_27&#45;&gt;prose_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3885.1642,-1728.1224C3875.702,-1708.1896 3860.975,-1674.7572 3853,-1644.4027 3826.0483,-1541.8192 3816.4127,-1415.4475 3813.3166,-1359.9313"/>
<polygon fill="#000000" stroke="#000000" points="3816.8042,-1359.6022 3812.7814,-1349.8008 3809.8139,-1359.9716 3816.8042,-1359.6022"/>
</g>
<!-- prose_47 -->
<g id="node48" class="node">
<title>prose_47</title>
<ellipse fill="none" stroke="#000000" cx="3894" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3894" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_47 -->
<g id="edge47" class="edge">
<title>section_27&#45;&gt;prose_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3894,-1727.9257C3894,-1662.7427 3894,-1439.4399 3894,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="3897.5001,-1359.6743 3894,-1349.6744 3890.5001,-1359.6744 3897.5001,-1359.6743"/>
</g>
<!-- prose_48 -->
<g id="node49" class="node">
<title>prose_48</title>
<ellipse fill="none" stroke="#000000" cx="4133" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4133" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_48 -->
<g id="edge48" class="edge">
<title>section_27&#45;&gt;prose_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3904.4232,-1727.9257C3942.3336,-1662.1773 4073.0041,-1435.5538 4117.7943,-1357.8736"/>
<polygon fill="#000000" stroke="#000000" points="4121.0929,-1359.1595 4123.056,-1348.7481 4115.0288,-1355.6629 4121.0929,-1359.1595"/>
</g>
<!-- prose_49 -->
<g id="node50" class="node">
<title>prose_49</title>
<ellipse fill="none" stroke="#000000" cx="4215" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4215" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_49 -->
<g id="edge49" class="edge">
<title>section_27&#45;&gt;prose_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3948.1162,-1733.4494C4021.0727,-1715.3915 4145.1858,-1680.2907 4174,-1644.4027 4241.8108,-1559.9444 4229.3392,-1419.3283 4220.1409,-1359.6578"/>
<polygon fill="#000000" stroke="#000000" points="4223.5465,-1358.7955 4218.4815,-1349.4898 4216.6379,-1359.923 4223.5465,-1358.7955"/>
</g>
<!-- codeblock_50 -->
<g id="node51" class="node">
<title>codeblock_50</title>
<ellipse fill="none" stroke="#000000" cx="4353" cy="-1331.5021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4353" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 146&#45;172</text>
</g>
<!-- section_27&#45;&gt;codeblock_50 -->
<g id="edge50" class="edge">
<title>section_27&#45;&gt;codeblock_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3956.5861,-1735.8284C4048.4253,-1719.7076 4213.4344,-1685.8349 4256,-1644.4027 4336.9291,-1565.6284 4350.6708,-1420.7916 4352.7637,-1359.779"/>
<polygon fill="#000000" stroke="#000000" points="4356.2638,-1359.8163 4353.0267,-1349.7281 4349.2662,-1359.6331 4356.2638,-1359.8163"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="1973,-564.4008 1919,-564.4008 1919,-524.4008 1973,-524.4008 1973,-564.4008"/>
</g>
<!-- raw_29&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>raw_29&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.333,-1313.7322C2223.0624,-1260.8852 2249.5244,-1103.1351 2171,-1018.6015 2112.803,-955.9509 2039.1688,-1046.1918 1982,-982.6015 1876.7491,-865.5284 1917.7187,-652.6828 1937.6221,-574.3626"/>
<polygon fill="#000000" stroke="#000000" points="1941.0187,-575.2078 1940.1604,-564.6478 1934.2461,-573.4381 1941.0187,-575.2078"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2133,-562.4008 1991,-562.4008 1991,-526.4008 2133,-526.4008 2133,-562.4008"/>
<text text-anchor="middle" x="2062" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_31&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>header_31&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.3322,-1313.2132C2331.2853,-1260.2798 2323.8878,-1105.2063 2243,-1018.6015 2210.4718,-983.7744 2172.8636,-1018.912 2142,-982.6015 2038.1718,-860.4492 2050.0404,-648.7807 2058.3123,-572.675"/>
<polygon fill="#000000" stroke="#000000" points="2061.822,-572.7922 2059.4925,-562.4567 2054.8682,-571.9891 2061.822,-572.7922"/>
</g>
<!-- raw_35 -->
<g id="node36" class="node">
<title>raw_35</title>
<ellipse fill="none" stroke="#000000" cx="2178" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="2178" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_32&#45;&gt;raw_35 -->
<g id="edge35" class="edge">
<title>prose_32&#45;&gt;raw_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.0553,-1313.6366C2474.9579,-1260.5228 2498.9434,-1102.1044 2419,-1018.6015 2355.0285,-951.7818 2276.3386,-1050.9472 2214,-982.6015 2106.8981,-865.1791 2150.1971,-648.901 2170.097,-572.2391"/>
<polygon fill="#000000" stroke="#000000" points="2173.5331,-572.9376 2172.7316,-562.3732 2166.77,-571.1316 2173.5331,-572.9376"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="2771,-982.8023 2223,-982.8023 2223,-105.9993 2771,-105.9993 2771,-982.8023"/>
<text text-anchor="middle" x="2497" y="-967.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2497" y="-936.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2497" y="-920.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2497" y="-905.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2497" y="-889.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">project TEXT,</text>
<text text-anchor="middle" x="2497" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2497" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP);</text>
<text text-anchor="middle" x="2497" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2497" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2497" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS results (</text>
<text text-anchor="middle" x="2497" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2497" y="-766.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2497" y="-750.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2497" y="-735.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2497" y="-719.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2497" y="-704.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2497" y="-689.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE);</text>
<text text-anchor="middle" x="2497" y="-673.601" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2497" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line_stmt = [[</text>
<text text-anchor="middle" x="2497" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2497" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2497" y="-580.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result_stmt = [[</text>
<text text-anchor="middle" x="2497" y="-564.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO results (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2497" y="-549.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2497" y="-517.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2497" y="-502.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2497" y="-487.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2497" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2497" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT line FROM repl</text>
<text text-anchor="middle" x="2497" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %s</text>
<text text-anchor="middle" x="2497" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2497" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2497" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2497" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2497" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2497" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2497" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2497" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2497" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2497" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2497" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2497" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2497" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2497" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2497" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2497" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_33&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_33&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2585.8845,-1313.2046C2580.4379,-1266.0939 2565.209,-1134.3722 2548.8625,-992.9838"/>
<polygon fill="#000000" stroke="#000000" points="2552.3092,-992.32 2547.6838,-982.7882 2545.3555,-993.124 2552.3092,-992.32"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2058,-53.1 2004,-53.1 2004,-17.1 2058,-17.1 2058,-53.1"/>
</g>
<!-- raw_35&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>raw_35&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2182.285,-526.4909C2196.4729,-462.6356 2235.8869,-242.6647 2142,-106.2001 2121.0427,-75.7386 2097.3033,-91.3855 2067,-70.2001 2062.7277,-67.2132 2058.4896,-63.7098 2054.5022,-60.0934"/>
<polygon fill="#000000" stroke="#000000" points="2056.845,-57.491 2047.2003,-53.1058 2052.0053,-62.5484 2056.845,-57.491"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="2945,-562.4008 2789,-562.4008 2789,-526.4008 2945,-526.4008 2945,-562.4008"/>
<text text-anchor="middle" x="2867" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_38&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>header_38&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2862.1162,-1313.2046C2862.773,-1209.8101 2866.0188,-698.8644 2866.8206,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="2870.3207,-572.6201 2866.8844,-562.5981 2863.3209,-572.5756 2870.3207,-572.6201"/>
</g>
<!-- raw_42 -->
<g id="node43" class="node">
<title>raw_42</title>
<ellipse fill="none" stroke="#000000" cx="2990" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="2990" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_39&#45;&gt;raw_42 -->
<g id="edge42" class="edge">
<title>prose_39&#45;&gt;raw_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2994.8838,-1313.2046C2994.227,-1209.8101 2990.9812,-698.8644 2990.1794,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="2993.6791,-572.5756 2990.1156,-562.5981 2986.6793,-572.6201 2993.6791,-572.5756"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3513,-748.8018 3035,-748.8018 3035,-339.9998 3513,-339.9998 3513,-748.8018"/>
<text text-anchor="middle" x="3274" y="-733.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3274" y="-718.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3274" y="-702.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3274" y="-687.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec &quot;PRAGMA foreign_keys = ON;&quot;</text>
<text text-anchor="middle" x="3274" y="-671.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_names = conn:exec(get_tables)</text>
<text text-anchor="middle" x="3274" y="-656.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3274" y="-641.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not table_names or not has(table_names.name, &quot;repl&quot;) then</text>
<text text-anchor="middle" x="3274" y="-625.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, err = sql.pexec(conn, create_repl_table)</text>
<text text-anchor="middle" x="3274" y="-610.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; success is nil for creation, false for error</text>
<text text-anchor="middle" x="3274" y="-594.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success == false then</text>
<text text-anchor="middle" x="3274" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="3274" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3274" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3274" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line_stmt = conn:prepare(insert_line_stmt)</text>
<text text-anchor="middle" x="3274" y="-517.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result_stmt = conn:prepare(insert_result_stmt)</text>
<text text-anchor="middle" x="3274" y="-502.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_stmt = sql.format(get_recent, historian.project,</text>
<text text-anchor="middle" x="3274" y="-487.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3274" y="-471.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local values, err = sql.pexec(conn, pop_stmt)</text>
<text text-anchor="middle" x="3274" y="-456.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if values then</text>
<text text-anchor="middle" x="3274" y="-440.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(reverse(values[1])) do</text>
<text text-anchor="middle" x="3274" y="-425.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = Linebuf(v)</text>
<text text-anchor="middle" x="3274" y="-410.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3274" y="-394.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3274" y="-379.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="3274" y="-363.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3274" y="-348.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3205.6273,-1313.2046C3212.1678,-1239.6605 3237.0463,-959.919 3254.9062,-759.0973"/>
<polygon fill="#000000" stroke="#000000" points="3258.4049,-759.2662 3255.8046,-748.9954 3251.4324,-758.646 3258.4049,-759.2662"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="2589.5,-63.0015 2076.5,-63.0015 2076.5,-7.1986 2589.5,-7.1986 2589.5,-63.0015"/>
<text text-anchor="middle" x="2333" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and (eventually) results and user config.</text>
</g>
<!-- raw_42&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>raw_42&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2995.4291,-526.6102C3014.4508,-460.2996 3070.8219,-225.2405 2954,-106.2001 2898.306,-49.4485 2676.978,-79.4216 2598,-70.2001 2581.5271,-68.2767 2564.4893,-66.2063 2547.3653,-64.0675"/>
<polygon fill="#000000" stroke="#000000" points="2547.6347,-60.5739 2537.2766,-62.8008 2546.7627,-67.5194 2547.6347,-60.5739"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="3757,-562.4008 3531,-562.4008 3531,-526.4008 3757,-526.4008 3757,-562.4008"/>
<text text-anchor="middle" x="3644" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(linebuf)</text>
</g>
<!-- header_45&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>header_45&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3644,-1313.2046C3644,-1209.8101 3644,-698.8644 3644,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="3647.5001,-572.598 3644,-562.5981 3640.5001,-572.5981 3647.5001,-572.598"/>
</g>
<!-- raw_52 -->
<g id="node53" class="node">
<title>raw_52</title>
<ellipse fill="none" stroke="#000000" cx="3802" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="3802" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_46&#45;&gt;raw_52 -->
<g id="edge52" class="edge">
<title>prose_46&#45;&gt;raw_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3811.7675,-1313.2046C3810.4539,-1209.8101 3803.9624,-698.8644 3802.3587,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="3805.858,-572.5528 3802.2312,-562.5981 3798.8586,-572.6418 3805.858,-572.5528"/>
</g>
<!-- raw_54 -->
<g id="node55" class="node">
<title>raw_54</title>
<ellipse fill="none" stroke="#000000" cx="3874" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="3874" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_47&#45;&gt;raw_54 -->
<g id="edge54" class="edge">
<title>prose_47&#45;&gt;raw_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3893.5351,-1313.2046C3890.9078,-1209.8101 3877.9249,-698.8644 3874.7174,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="3878.2154,-572.5059 3874.4624,-562.5981 3871.2176,-572.6838 3878.2154,-572.5059"/>
</g>
<!-- raw_56 -->
<g id="node57" class="node">
<title>raw_56</title>
<ellipse fill="none" stroke="#000000" cx="3946" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="3946" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_48&#45;&gt;raw_56 -->
<g id="edge56" class="edge">
<title>prose_48&#45;&gt;raw_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4122.986,-1314.0713C4094.9406,-1264.287 4015.4875,-1116.4204 3982,-982.6015 3944.2705,-831.8314 3943.7842,-643.697 3945.1655,-573.0054"/>
<polygon fill="#000000" stroke="#000000" points="3948.6716,-572.7682 3945.3978,-562.6919 3941.6734,-572.6105 3948.6716,-572.7682"/>
</g>
<!-- prespace_57 -->
<g id="node58" class="node">
<title>prespace_57</title>
<ellipse fill="none" stroke="#000000" cx="4037" cy="-544.4008" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="4037" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_48&#45;&gt;prespace_57 -->
<g id="edge57" class="edge">
<title>prose_48&#45;&gt;prespace_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4130.7683,-1313.2046C4118.1577,-1209.8101 4055.8394,-698.8644 4040.4436,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="4043.9045,-572.1007 4039.2195,-562.5981 4036.956,-572.9483 4043.9045,-572.1007"/>
</g>
<!-- literal_58 -->
<g id="node59" class="node">
<title>literal_58</title>
<ellipse fill="none" stroke="#000000" cx="4133" cy="-544.4008" rx="31.481" ry="18"/>
<text text-anchor="middle" x="4133" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_48&#45;&gt;literal_58 -->
<g id="edge58" class="edge">
<title>prose_48&#45;&gt;literal_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4133,-1313.2046C4133,-1209.8101 4133,-698.8644 4133,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="4136.5001,-572.598 4133,-562.5981 4129.5001,-572.5981 4136.5001,-572.598"/>
</g>
<!-- raw_59 -->
<g id="node60" class="node">
<title>raw_59</title>
<ellipse fill="none" stroke="#000000" cx="4209" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="4209" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_48&#45;&gt;raw_59 -->
<g id="edge59" class="edge">
<title>prose_48&#45;&gt;raw_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4135.2882,-1313.363C4141.7585,-1261.7152 4160.5247,-1109.4162 4173,-982.6015 4188.1803,-828.2894 4201.9363,-642.9658 4206.9704,-573.0035"/>
<polygon fill="#000000" stroke="#000000" points="4210.4786,-573.0125 4207.7024,-562.7879 4203.4965,-572.5121 4210.4786,-573.0125"/>
</g>
<!-- prespace_60 -->
<g id="node61" class="node">
<title>prespace_60</title>
<ellipse fill="none" stroke="#000000" cx="4300" cy="-544.4008" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="4300" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_48&#45;&gt;prespace_60 -->
<g id="edge60" class="edge">
<title>prose_48&#45;&gt;prespace_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4130.0036,-1313.5549C4122.4532,-1262.1901 4107.6916,-1112.2901 4174,-1018.6015 4194.4392,-989.7226 4224.6393,-1011.5359 4245,-982.6015 4336.0512,-853.2098 4316.0522,-647.6993 4304.8703,-572.853"/>
<polygon fill="#000000" stroke="#000000" points="4308.2989,-572.1236 4303.2988,-562.7828 4301.3826,-573.203 4308.2989,-572.1236"/>
</g>
<!-- literal_61 -->
<g id="node62" class="node">
<title>literal_61</title>
<ellipse fill="none" stroke="#000000" cx="4396" cy="-544.4008" rx="31.481" ry="18"/>
<text text-anchor="middle" x="4396" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_48&#45;&gt;literal_61 -->
<g id="edge61" class="edge">
<title>prose_48&#45;&gt;literal_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4128.9562,-1313.3418C4118.2639,-1260.0894 4095.188,-1102.7983 4174,-1018.6015 4230.0506,-958.7213 4300.0666,-1043.5083 4355,-982.6015 4461.5502,-864.4652 4421.9043,-648.6344 4403.3876,-572.1644"/>
<polygon fill="#000000" stroke="#000000" points="4406.7491,-571.1791 4400.9324,-562.3237 4399.9573,-572.8736 4406.7491,-571.1791"/>
</g>
<!-- raw_62 -->
<g id="node63" class="node">
<title>raw_62</title>
<ellipse fill="none" stroke="#000000" cx="4472" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="4472" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_48&#45;&gt;raw_62 -->
<g id="edge62" class="edge">
<title>prose_48&#45;&gt;raw_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4128.8017,-1313.4971C4117.4997,-1259.9937 4092.5137,-1100.5995 4174,-1018.6015 4256.8518,-935.2295 4355.1865,-1067.9507 4436,-982.6015 4545.523,-866.9315 4500.4077,-648.6557 4479.9894,-571.921"/>
<polygon fill="#000000" stroke="#000000" points="4483.3059,-570.7799 4477.2908,-562.0581 4476.5541,-572.6273 4483.3059,-570.7799"/>
</g>
<!-- raw_70 -->
<g id="node71" class="node">
<title>raw_70</title>
<ellipse fill="none" stroke="#000000" cx="4544" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="4544" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_49&#45;&gt;raw_70 -->
<g id="edge70" class="edge">
<title>prose_49&#45;&gt;raw_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4210.8909,-1313.5107C4199.8483,-1260.0453 4175.5933,-1100.7463 4257,-1018.6015 4336.3285,-938.5539 4430.7572,-1064.6636 4508,-982.6015 4616.9312,-866.8741 4572.486,-649.5338 4552.0942,-572.4163"/>
<polygon fill="#000000" stroke="#000000" points="4555.3965,-571.2215 4549.395,-562.4905 4548.6418,-573.0585 4555.3965,-571.2215"/>
</g>
<!-- leaf_72 -->
<g id="node73" class="node">
<title>leaf_72</title>
<polygon fill="none" stroke="#c0c0c0" points="5074.5,-741.0018 4589.5,-741.0018 4589.5,-347.7999 5074.5,-347.7999 5074.5,-741.0018"/>
<text text-anchor="middle" x="4832" y="-726.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, linebuf, results)</text>
<text text-anchor="middle" x="4832" y="-710.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="4832" y="-695.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line_stmt:bindkv { project = historian.project,</text>
<text text-anchor="middle" x="4832" y="-679.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="4832" y="-664.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local err = historian.insert_line_stmt:step()</text>
<text text-anchor="middle" x="4832" y="-649.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not err then</text>
<text text-anchor="middle" x="4832" y="-633.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="4832" y="-618.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4832" y="-602.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="4832" y="-587.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4832" y="-572.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="4832" y="-556.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="4832" y="-541.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _,v in ipairs(results) do</text>
<text text-anchor="middle" x="4832" y="-525.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="4832" y="-510.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result_stmt:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="4832" y="-495.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="4832" y="-479.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result_stmt:step()</text>
<text text-anchor="middle" x="4832" y="-464.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="4832" y="-448.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="4832" y="-433.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4832" y="-418.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4832" y="-402.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4832" y="-371.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="4832" y="-355.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_50&#45;&gt;leaf_72 -->
<g id="edge72" class="edge">
<title>codeblock_50&#45;&gt;leaf_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4352.8871,-1313.2588C4353.5875,-1259.7781 4363.1841,-1101.9224 4449,-1018.6015 4492.3207,-976.5403 4532.2459,-1019.5525 4580,-982.6015 4656.8449,-923.1407 4714.3561,-833.1495 4754.8834,-750.1575"/>
<polygon fill="#000000" stroke="#000000" points="4758.0529,-751.6426 4759.246,-741.1152 4751.7483,-748.6008 4758.0529,-751.6426"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="2882.5,-63.0015 2607.5,-63.0015 2607.5,-7.1986 2882.5,-7.1986 2882.5,-63.0015"/>
<text text-anchor="middle" x="2745" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_52&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>raw_52&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3803.4981,-526.3706C3809.3082,-451.3196 3827.1225,-164.8781 3766,-106.2001 3730.9431,-72.5452 2940.1362,-76.8744 2892,-70.2001 2881.7585,-68.78 2871.1868,-66.9655 2860.6293,-64.9115"/>
<polygon fill="#000000" stroke="#000000" points="2861.0172,-61.4194 2850.5227,-62.874 2859.6337,-68.2813 2861.0172,-61.4194"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3463,-70.3004 2901,-70.3004 2901,.1003 3463,.1003 3463,-70.3004"/>
<text text-anchor="middle" x="3182" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="3182" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="3182" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_54&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>raw_54&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3879.4395,-526.5999C3898.4984,-460.2527 3954.9846,-225.0806 3838,-106.2001 3810.9061,-78.6672 3544.2713,-74.9998 3473.4912,-70.1033"/>
<polygon fill="#000000" stroke="#000000" points="3473.5176,-66.5931 3463.2578,-69.2363 3472.9266,-73.5681 3473.5176,-66.5931"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="4001,-62.4005 3481,-62.4005 3481,-7.7996 4001,-7.7996 4001,-62.4005"/>
<text text-anchor="middle" x="3741" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="3741" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_56&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>raw_56&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3950.5171,-526.3269C3965.4888,-461.9181 4007.2211,-240.3097 3910,-106.2001 3897.9584,-89.5895 3881.2676,-76.8361 3863.032,-67.0506"/>
<polygon fill="#000000" stroke="#000000" points="3864.4744,-63.8582 3853.9694,-62.4813 3861.3229,-70.1087 3864.4744,-63.8582"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="4073,-53.1 4019,-53.1 4019,-17.1 4073,-17.1 4073,-53.1"/>
<text text-anchor="middle" x="4046" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_57&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>prespace_57&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4037.3203,-526.2745C4038.6652,-450.168 4043.8615,-156.1165 4045.5012,-63.3239"/>
<polygon fill="#000000" stroke="#000000" points="4049.0015,-63.3347 4045.6788,-53.2744 4042.0026,-63.2109 4049.0015,-63.3347"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4156.5,-53.1 4091.5,-53.1 4091.5,-17.1 4156.5,-17.1 4156.5,-53.1"/>
<text text-anchor="middle" x="4124" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_58&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>literal_58&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4132.6797,-526.2745C4131.3348,-450.168 4126.1385,-156.1165 4124.4988,-63.3239"/>
<polygon fill="#000000" stroke="#000000" points="4127.9974,-63.2109 4124.3212,-53.2744 4120.9985,-63.3347 4127.9974,-63.2109"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4443,-54.4006 4175,-54.4006 4175,-15.7995 4443,-15.7995 4443,-54.4006"/>
<text text-anchor="middle" x="4309" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="4309" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_59&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>raw_59&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4206.5238,-526.309C4198.8655,-464.5061 4179.8176,-257.2318 4245,-106.2001 4252.2483,-89.4053 4265.1063,-73.9011 4277.4052,-61.6858"/>
<polygon fill="#000000" stroke="#000000" points="4280.1022,-63.9509 4284.9357,-54.5229 4275.2778,-58.8789 4280.1022,-63.9509"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="4515,-53.1 4461,-53.1 4461,-17.1 4515,-17.1 4515,-53.1"/>
<text text-anchor="middle" x="4488" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_60&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>prespace_60&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4296.3112,-526.0752C4284.2907,-460.8168 4252.7068,-236.6953 4356,-106.2001 4384.2816,-70.4706 4413.5322,-94.627 4452,-70.2001 4456.4904,-67.3487 4460.8829,-63.8659 4464.9696,-60.214"/>
<polygon fill="#000000" stroke="#000000" points="4467.5935,-62.5474 4472.397,-53.1041 4462.753,-57.4907 4467.5935,-62.5474"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="4591,-53.1 4533,-53.1 4533,-17.1 4591,-17.1 4591,-53.1"/>
<text text-anchor="middle" x="4562" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_61&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>literal_61&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4391.6394,-526.2695C4377.2272,-461.6671 4337.4336,-239.4861 4436,-106.2001 4461.1257,-72.224 4488.356,-92.8978 4524,-70.2001 4528.5239,-67.3193 4533.0051,-63.8725 4537.2173,-60.2805"/>
<polygon fill="#000000" stroke="#000000" points="4539.8598,-62.6095 4544.9264,-53.3047 4535.163,-57.4191 4539.8598,-62.6095"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="4695,-53.1 4609,-53.1 4609,-17.1 4695,-17.1 4695,-53.1"/>
<text text-anchor="middle" x="4652" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_62&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>raw_62&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4467.3655,-526.2407C4451.9978,-461.541 4409.0939,-239.072 4508,-106.2001 4534.2177,-70.9789 4561.1225,-90.6069 4600,-70.2001 4606.2852,-66.901 4612.7404,-63.0068 4618.8717,-59.0343"/>
<polygon fill="#000000" stroke="#000000" points="4621.1999,-61.6878 4627.5654,-53.2184 4617.3076,-55.8697 4621.1999,-61.6878"/>
</g>
<!-- leaf_71 -->
<g id="node72" class="node">
<title>leaf_71</title>
<polygon fill="none" stroke="#c0c0c0" points="5247,-62.4005 4713,-62.4005 4713,-7.7996 5247,-7.7996 5247,-62.4005"/>
<text text-anchor="middle" x="4980" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="4980" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_70&#45;&gt;leaf_71 -->
<g id="edge71" class="edge">
<title>raw_70&#45;&gt;leaf_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4538.7401,-526.4362C4520.6408,-460.4991 4467.9882,-229.2617 4580,-106.2001 4593.1023,-91.8052 4669.2792,-76.6046 4751.6987,-63.9695"/>
<polygon fill="#000000" stroke="#000000" points="4752.4146,-67.4011 4761.777,-62.4416 4751.3653,-60.4801 4752.4146,-67.4011"/>
</g>
<!-- leaf_76 -->
<g id="node77" class="node">
<title>leaf_76</title>
<polygon fill="none" stroke="#c0c0c0" points="4649.5,-1349.5021 4458.5,-1349.5021 4458.5,-1313.5021 4649.5,-1313.5021 4649.5,-1349.5021"/>
<text text-anchor="middle" x="4554" y="-1328.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_73&#45;&gt;leaf_76 -->
<g id="edge76" class="edge">
<title>header_73&#45;&gt;leaf_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4550.1744,-1727.9257C4550.8035,-1662.7427 4552.9584,-1439.4399 4553.7259,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="4557.2279,-1359.7077 4553.8246,-1349.6744 4550.2282,-1359.6401 4557.2279,-1359.7077"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="4703" cy="-1331.5021" rx="27" ry="18"/>
<text text-anchor="middle" x="4703" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_74&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_74&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4707.7819,-1727.9257C4706.9957,-1662.7427 4704.302,-1439.4399 4703.3427,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="4706.8397,-1359.6314 4703.2192,-1349.6744 4699.8402,-1359.7159 4706.8397,-1359.6314"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5303.5,-1644.3033 4748.5,-1644.3033 4748.5,-1018.7009 5303.5,-1018.7009 5303.5,-1644.3033"/>
<text text-anchor="middle" x="5026" y="-1629.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="5026" y="-1597.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; second_best is broke and I don&#39;t know why</text>
<text text-anchor="middle" x="5026" y="-1582.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; also this fails on a single key search &gt;.&lt;</text>
<text text-anchor="middle" x="5026" y="-1567.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="5026" y="-1551.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="5026" y="-1536.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;&#160;&#160;&#160;&#160;&#160;&#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="5026" y="-1520.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="5026" y="-1505.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="5026" y="-1490.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="5026" y="-1474.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5026" y="-1459.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="5026" y="-1443.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="5026" y="-1428.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5026" y="-1397.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="5026" y="-1381.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = {}</text>
<text text-anchor="middle" x="5026" y="-1366.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="5026" y="-1350.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="5026" y="-1335.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="5026" y="-1320.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="5026" y="-1304.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="5026" y="-1289.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="5026" y="-1273.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5026" y="-1258.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5026" y="-1243.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="5026" y="-1227.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="5026" y="-1212.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="5026" y="-1196.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="5026" y="-1181.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local second = fuzz_patt(slip)</text>
<text text-anchor="middle" x="5026" y="-1166.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="5026" y="-1150.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(second, tostring(historian[i]))</text>
<text text-anchor="middle" x="5026" y="-1135.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="5026" y="-1119.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="5026" y="-1104.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5026" y="-1089.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5026" y="-1073.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5026" y="-1042.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="5026" y="-1026.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_75&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>codeblock_75&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4941.8378,-1727.9257C4945.2855,-1711.6864 4950.8167,-1685.633 4957.4405,-1654.4337"/>
<polygon fill="#000000" stroke="#000000" points="4960.8769,-1655.0999 4959.5301,-1644.5911 4954.0296,-1653.6462 4960.8769,-1655.0999"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5147,-562.4008 5093,-562.4008 5093,-526.4008 5147,-526.4008 5147,-562.4008"/>
</g>
<!-- raw_77&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_77&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4698.3446,-1313.4198C4685.7149,-1259.7006 4656.9975,-1099.7656 4739,-1018.6015 4793.6281,-964.532 5029.1976,-1037.4928 5083,-982.6015 5194.2703,-869.0793 5149.0208,-650.3572 5128.2473,-572.6469"/>
<polygon fill="#000000" stroke="#000000" points="5131.5228,-571.3577 5125.4973,-562.6431 5124.7732,-573.2131 5131.5228,-571.3577"/>
</g>
<!-- leaf_85 -->
<g id="node86" class="node">
<title>leaf_85</title>
<polygon fill="none" stroke="#c0c0c0" points="5470.5,-1349.5021 5321.5,-1349.5021 5321.5,-1313.5021 5470.5,-1313.5021 5470.5,-1349.5021"/>
<text text-anchor="middle" x="5396" y="-1328.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_80&#45;&gt;leaf_85 -->
<g id="edge85" class="edge">
<title>header_80&#45;&gt;leaf_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5405.5639,-1727.9257C5403.9913,-1662.7427 5398.604,-1439.4399 5396.6854,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="5400.1787,-1359.587 5396.4384,-1349.6744 5393.1807,-1359.7559 5400.1787,-1359.587"/>
</g>
<!-- raw_86 -->
<g id="node87" class="node">
<title>raw_86</title>
<ellipse fill="none" stroke="#000000" cx="5516" cy="-1331.5021" rx="27" ry="18"/>
<text text-anchor="middle" x="5516" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_81&#45;&gt;raw_86 -->
<g id="edge86" class="edge">
<title>prose_81&#45;&gt;raw_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5572.6533,-1728.1806C5566.7899,-1708.0209 5557.4865,-1674.1247 5552,-1644.4027 5532.7836,-1540.3017 5522.0435,-1414.7077 5517.9491,-1359.6608"/>
<polygon fill="#000000" stroke="#000000" points="5521.435,-1359.3388 5517.2183,-1349.6193 5514.4535,-1359.847 5521.435,-1359.3388"/>
</g>
<!-- leaf_88 -->
<g id="node89" class="node">
<title>leaf_88</title>
<polygon fill="none" stroke="#c0c0c0" points="5928.9016,-1425.483 5561.0984,-1425.483 5561.0984,-1237.5212 5928.9016,-1237.5212 5928.9016,-1425.483"/>
<text text-anchor="middle" x="5745" y="-1410.0422" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="5745" y="-1394.6422" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="5745" y="-1379.2422" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="5745" y="-1363.8421" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5745" y="-1348.4421" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="5745" y="-1329.6821" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="5745" y="-1310.9221" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[linebuf]</text>
<text text-anchor="middle" x="5745" y="-1295.5221" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="5745" y="-1276.7621" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="5745" y="-1261.362" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return linebuf:clone(), result</text>
<text text-anchor="middle" x="5745" y="-1245.962" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_82&#45;&gt;leaf_88 -->
<g id="edge88" class="edge">
<title>codeblock_82&#45;&gt;leaf_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5726.8286,-1727.9257C5729.1177,-1677.9867 5735.6611,-1535.237 5740.2358,-1435.4364"/>
<polygon fill="#000000" stroke="#000000" points="5743.7383,-1435.4612 5740.6999,-1425.3114 5736.7456,-1435.1406 5743.7383,-1435.4612"/>
</g>
<!-- header_89 -->
<g id="node90" class="node">
<title>header_89</title>
<ellipse fill="none" stroke="#000000" cx="6029" cy="-1331.5021" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="6029" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_83&#45;&gt;header_89 -->
<g id="edge89" class="edge">
<title>section_83&#45;&gt;header_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6092.1216,-1727.9257C6081.7427,-1662.7427 6046.1867,-1439.4399 6033.5234,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="6036.9225,-1358.9996 6031.8935,-1349.6744 6030.0096,-1360.1004 6036.9225,-1358.9996"/>
</g>
<!-- prose_90 -->
<g id="node91" class="node">
<title>prose_90</title>
<ellipse fill="none" stroke="#000000" cx="6162" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6162" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_83&#45;&gt;prose_90 -->
<g id="edge90" class="edge">
<title>section_83&#45;&gt;prose_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6100.1148,-1727.7788C6105.6457,-1707.5451 6114.4175,-1673.8505 6120,-1644.4027 6139.7635,-1540.1503 6153.6545,-1414.6339 6159.2526,-1359.6338"/>
<polygon fill="#000000" stroke="#000000" points="6162.7433,-1359.9011 6160.2609,-1349.6012 6155.7784,-1359.201 6162.7433,-1359.9011"/>
</g>
<!-- codeblock_91 -->
<g id="node92" class="node">
<title>codeblock_91</title>
<ellipse fill="none" stroke="#000000" cx="6389" cy="-1331.5021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6389" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 243&#45;263</text>
</g>
<!-- section_83&#45;&gt;codeblock_91 -->
<g id="edge91" class="edge">
<title>section_83&#45;&gt;codeblock_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6117.0075,-1728.4778C6140.1376,-1709.3726 6176.7421,-1677.1324 6203,-1644.4027 6280.5973,-1547.68 6348.5144,-1415.403 6376.003,-1358.8987"/>
<polygon fill="#000000" stroke="#000000" points="6379.3136,-1360.0915 6380.5104,-1349.5645 6373.0101,-1357.0475 6379.3136,-1360.0915"/>
</g>
<!-- header_102 -->
<g id="node103" class="node">
<title>header_102</title>
<ellipse fill="none" stroke="#000000" cx="6796" cy="-1331.5021" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="6796" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_84&#45;&gt;header_102 -->
<g id="edge102" class="edge">
<title>section_84&#45;&gt;header_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7038.5222,-1728.859C7011.8785,-1710.5403 6970.9746,-1679.3702 6944,-1644.4027 6871.9544,-1551.0093 6823.3823,-1416.8842 6804.6418,-1359.3917"/>
<polygon fill="#000000" stroke="#000000" points="6807.8798,-1358.0272 6801.4908,-1349.5755 6801.2148,-1360.1667 6807.8798,-1358.0272"/>
</g>
<!-- prose_103 -->
<g id="node104" class="node">
<title>prose_103</title>
<ellipse fill="none" stroke="#000000" cx="6985" cy="-1331.5021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6985" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_84&#45;&gt;prose_103 -->
<g id="edge103" class="edge">
<title>section_84&#45;&gt;prose_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7059.8616,-1727.7521C7054.2681,-1707.4951 7045.2835,-1673.7803 7039,-1644.4027 7016.6787,-1540.0425 6997.2359,-1414.5813 6989.0831,-1359.6146"/>
<polygon fill="#000000" stroke="#000000" points="6992.5261,-1358.9711 6987.6055,-1349.5883 6985.6009,-1359.9917 6992.5261,-1358.9711"/>
</g>
<!-- codeblock_104 -->
<g id="node105" class="node">
<title>codeblock_104</title>
<ellipse fill="none" stroke="#000000" cx="7135" cy="-1331.5021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7135" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 268&#45;275</text>
</g>
<!-- section_84&#45;&gt;codeblock_104 -->
<g id="edge104" class="edge">
<title>section_84&#45;&gt;codeblock_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7068.0528,-1727.9257C7079.0608,-1662.7427 7116.7717,-1439.4399 7130.2024,-1359.9107"/>
<polygon fill="#000000" stroke="#000000" points="7133.717,-1360.1176 7131.9311,-1349.6744 7126.8147,-1358.9519 7133.717,-1360.1176"/>
</g>
<!-- codeblock_105 -->
<g id="node106" class="node">
<title>codeblock_105</title>
<ellipse fill="none" stroke="#000000" cx="7459" cy="-1331.5021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7459" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 277&#45;286</text>
</g>
<!-- section_84&#45;&gt;codeblock_105 -->
<g id="edge105" class="edge">
<title>section_84&#45;&gt;codeblock_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7099.4347,-1729.9806C7134.9801,-1712.3467 7190.7687,-1681.52 7231,-1644.4027 7328.8043,-1554.1687 7411.6953,-1416.362 7444.2451,-1358.5304"/>
<polygon fill="#000000" stroke="#000000" points="7447.3909,-1360.0755 7449.2071,-1349.6375 7441.2781,-1356.6647 7447.3909,-1360.0755"/>
</g>
<!-- codeblock_106 -->
<g id="node107" class="node">
<title>codeblock_106</title>
<ellipse fill="none" stroke="#000000" cx="7832" cy="-1331.5021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7832" y="-1327.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 288&#45;290</text>
</g>
<!-- section_84&#45;&gt;codeblock_106 -->
<g id="edge106" class="edge">
<title>section_84&#45;&gt;codeblock_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7131.675,-1737.4789C7248.2684,-1721.7101 7483.5936,-1685.7928 7555,-1644.4027 7681.2736,-1571.2092 7780.1438,-1419.8254 7816.7016,-1358.3393"/>
<polygon fill="#000000" stroke="#000000" points="7819.7861,-1359.9986 7821.8343,-1349.6037 7813.7507,-1356.4525 7819.7861,-1359.9986"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="5543,-562.4008 5489,-562.4008 5489,-526.4008 5543,-526.4008 5543,-562.4008"/>
</g>
<!-- raw_86&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>raw_86&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5516,-1313.2046C5516,-1209.8101 5516,-698.8644 5516,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="5519.5001,-572.598 5516,-562.5981 5512.5001,-572.5981 5519.5001,-572.598"/>
</g>
<!-- leaf_92 -->
<g id="node93" class="node">
<title>leaf_92</title>
<polygon fill="none" stroke="#c0c0c0" points="5930,-562.4008 5774,-562.4008 5774,-526.4008 5930,-526.4008 5930,-562.4008"/>
<text text-anchor="middle" x="5852" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_89&#45;&gt;leaf_92 -->
<g id="edge92" class="edge">
<title>header_89&#45;&gt;leaf_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6023.9526,-1313.4292C6009.6608,-1261.9554 5968.0699,-1110.0704 5939,-982.6015 5903.8869,-828.6339 5869.5942,-642.3881 5857.0283,-572.6036"/>
<polygon fill="#000000" stroke="#000000" points="5860.4133,-571.6505 5855.2013,-562.4263 5853.5234,-572.8874 5860.4133,-571.6505"/>
</g>
<!-- raw_93 -->
<g id="node94" class="node">
<title>raw_93</title>
<ellipse fill="none" stroke="#000000" cx="5975" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="5975" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_93 -->
<g id="edge93" class="edge">
<title>prose_90&#45;&gt;raw_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6165.5384,-1313.4044C6174.6758,-1260.9896 6193.4983,-1107.1811 6120,-1018.6015 6087.4222,-979.339 6042.5569,-1022.6892 6011,-982.6015 5913.121,-858.2629 5950.1567,-647.949 5967.7877,-572.4377"/>
<polygon fill="#000000" stroke="#000000" points="5971.2902,-572.8427 5970.2299,-562.3011 5964.4849,-571.2031 5971.2902,-572.8427"/>
</g>
<!-- prespace_94 -->
<g id="node95" class="node">
<title>prespace_94</title>
<ellipse fill="none" stroke="#000000" cx="6066" cy="-544.4008" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="6066" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_90&#45;&gt;prespace_94 -->
<g id="edge94" class="edge">
<title>prose_90&#45;&gt;prespace_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6159.7683,-1313.2046C6147.1577,-1209.8101 6084.8394,-698.8644 6069.4436,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="6072.9045,-572.1007 6068.2195,-562.5981 6065.956,-572.9483 6072.9045,-572.1007"/>
</g>
<!-- literal_95 -->
<g id="node96" class="node">
<title>literal_95</title>
<ellipse fill="none" stroke="#000000" cx="6162" cy="-544.4008" rx="31.481" ry="18"/>
<text text-anchor="middle" x="6162" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_90&#45;&gt;literal_95 -->
<g id="edge95" class="edge">
<title>prose_90&#45;&gt;literal_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6162,-1313.2046C6162,-1209.8101 6162,-698.8644 6162,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="6165.5001,-572.598 6162,-562.5981 6158.5001,-572.5981 6165.5001,-572.598"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="6238" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="6238" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_90&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6164.2882,-1313.363C6170.7585,-1261.7152 6189.5247,-1109.4162 6202,-982.6015 6217.1803,-828.2894 6230.9363,-642.9658 6235.9704,-573.0035"/>
<polygon fill="#000000" stroke="#000000" points="6239.4786,-573.0125 6236.7024,-562.7879 6232.4965,-572.5121 6239.4786,-573.0125"/>
</g>
<!-- leaf_101 -->
<g id="node102" class="node">
<title>leaf_101</title>
<polygon fill="none" stroke="#c0c0c0" points="6671.4016,-701.4413 6282.5984,-701.4413 6282.5984,-387.3603 6671.4016,-387.3603 6671.4016,-701.4413"/>
<text text-anchor="middle" x="6477" y="-686.2211" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="6477" y="-670.821" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="6477" y="-652.061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="6477" y="-636.661" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="6477" y="-621.261" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6477" y="-605.8609" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf= historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="6477" y="-587.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[linebuf]</text>
<text text-anchor="middle" x="6477" y="-571.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not linebuf then</text>
<text text-anchor="middle" x="6477" y="-556.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="6477" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6477" y="-525.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="6477" y="-506.7408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="6477" y="-491.3408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #linebuf.line &gt; 0 then</text>
<text text-anchor="middle" x="6477" y="-472.5808" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="6477" y="-457.1807" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf:clone(), nil, true</text>
<text text-anchor="middle" x="6477" y="-441.7807" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6477" y="-426.3807" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf:clone(), result, false</text>
<text text-anchor="middle" x="6477" y="-410.9806" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6477" y="-395.5806" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_91&#45;&gt;leaf_101 -->
<g id="edge101" class="edge">
<title>codeblock_91&#45;&gt;leaf_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6391.0457,-1313.2046C6399.9406,-1233.6453 6435.8143,-912.7794 6458.311,-711.5614"/>
<polygon fill="#000000" stroke="#000000" points="6461.8059,-711.8017 6459.4387,-701.4747 6454.8492,-711.0238 6461.8059,-711.8017"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="6021,-63.0015 5543,-63.0015 5543,-7.1986 6021,-7.1986 6021,-63.0015"/>
<text text-anchor="middle" x="5782" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next linebuf in history, and a second flag to tell the</text>
</g>
<!-- raw_93&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_93&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5979.3905,-526.4174C5993.9344,-462.3143 6034.4016,-241.6101 5939,-106.2001 5927.6266,-90.0571 5911.6832,-77.512 5894.2818,-67.7828"/>
<polygon fill="#000000" stroke="#000000" points="5895.547,-64.4941 5885.0656,-62.9475 5892.2948,-70.6928 5895.547,-64.4941"/>
</g>
<!-- leaf_98 -->
<g id="node99" class="node">
<title>leaf_98</title>
<polygon fill="none" stroke="#c0c0c0" points="6093,-53.1 6039,-53.1 6039,-17.1 6093,-17.1 6093,-53.1"/>
</g>
<!-- prespace_94&#45;&gt;leaf_98 -->
<g id="edge98" class="edge">
<title>prespace_94&#45;&gt;leaf_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6066,-526.2745C6066,-450.168 6066,-156.1165 6066,-63.3239"/>
<polygon fill="#000000" stroke="#000000" points="6069.5001,-63.2743 6066,-53.2744 6062.5001,-63.2744 6069.5001,-63.2743"/>
</g>
<!-- leaf_99 -->
<g id="node100" class="node">
<title>leaf_99</title>
<polygon fill="none" stroke="#c0c0c0" points="6211,-53.1 6111,-53.1 6111,-17.1 6211,-17.1 6211,-53.1"/>
<text text-anchor="middle" x="6161" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_95&#45;&gt;leaf_99 -->
<g id="edge99" class="edge">
<title>literal_95&#45;&gt;leaf_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6161.9644,-526.2745C6161.815,-450.168 6161.2376,-156.1165 6161.0554,-63.3239"/>
<polygon fill="#000000" stroke="#000000" points="6164.5554,-63.2674 6161.0357,-53.2744 6157.5554,-63.2813 6164.5554,-63.2674"/>
</g>
<!-- leaf_100 -->
<g id="node101" class="node">
<title>leaf_100</title>
<polygon fill="none" stroke="#c0c0c0" points="6469,-53.1 6229,-53.1 6229,-17.1 6469,-17.1 6469,-53.1"/>
<text text-anchor="middle" x="6349" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_96&#45;&gt;leaf_100 -->
<g id="edge100" class="edge">
<title>raw_96&#45;&gt;leaf_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6235.0787,-526.1063C6225.9899,-463.6523 6202.8899,-254.5331 6274,-106.2001 6282.7692,-87.9079 6298.4217,-71.9048 6313.1669,-59.7368"/>
<polygon fill="#000000" stroke="#000000" points="6315.5367,-62.3253 6321.216,-53.3812 6311.1987,-56.8314 6315.5367,-62.3253"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="6859,-562.4008 6689,-562.4008 6689,-526.4008 6859,-526.4008 6859,-562.4008"/>
<text text-anchor="middle" x="6774" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_102&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>header_102&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6795.4886,-1313.2046C6792.5986,-1209.8101 6778.3174,-698.8644 6774.7892,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="6778.2868,-572.4964 6774.5086,-562.5981 6771.2895,-572.692 6778.2868,-572.4964"/>
</g>
<!-- raw_108 -->
<g id="node109" class="node">
<title>raw_108</title>
<ellipse fill="none" stroke="#000000" cx="6904" cy="-544.4008" rx="27" ry="18"/>
<text text-anchor="middle" x="6904" y="-540.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_103&#45;&gt;raw_108 -->
<g id="edge108" class="edge">
<title>prose_103&#45;&gt;raw_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6982.3609,-1313.3758C6974.9112,-1261.7618 6953.3934,-1109.5432 6940,-982.6015 6923.7305,-828.4004 6910.6139,-643.0116 6905.8902,-573.0177"/>
<polygon fill="#000000" stroke="#000000" points="6909.3662,-572.5408 6905.205,-562.7973 6902.3819,-573.0091 6909.3662,-572.5408"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="7343,-594.8018 6949,-594.8018 6949,-493.9998 7343,-493.9998 7343,-594.8018"/>
<text text-anchor="middle" x="7146" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, linebuf, results)</text>
<text text-anchor="middle" x="7146" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = linebuf</text>
<text text-anchor="middle" x="7146" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="7146" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:persist(linebuf, results)</text>
<text text-anchor="middle" x="7146" y="-517.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="7146" y="-502.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_104&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>codeblock_104&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7135.2557,-1313.2046C7136.598,-1217.1572 7142.8553,-769.4213 7145.1519,-605.0879"/>
<polygon fill="#000000" stroke="#000000" points="7148.6572,-604.7281 7145.2973,-594.6801 7141.6578,-604.6302 7148.6572,-604.7281"/>
</g>
<!-- leaf_111 -->
<g id="node112" class="node">
<title>leaf_111</title>
<polygon fill="none" stroke="#c0c0c0" points="7818.5,-610.1012 7361.5,-610.1012 7361.5,-478.7004 7818.5,-478.7004 7818.5,-610.1012"/>
<text text-anchor="middle" x="7590" y="-594.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="7590" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="7590" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="7590" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This will also be load()ed once we have the tables for it</text>
<text text-anchor="middle" x="7590" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.results = {} &#45;&#45; keyed by linebuf</text>
<text text-anchor="middle" x="7590" y="-517.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="7590" y="-502.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7590" y="-487.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_105&#45;&gt;leaf_111 -->
<g id="edge111" class="edge">
<title>codeblock_105&#45;&gt;leaf_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7462.0453,-1313.2046C7477.5714,-1219.9177 7548.314,-794.8674 7577.427,-619.9444"/>
<polygon fill="#000000" stroke="#000000" points="7580.8854,-620.4832 7579.0747,-610.0443 7573.9804,-619.3339 7580.8854,-620.4832"/>
</g>
<!-- leaf_112 -->
<g id="node113" class="node">
<title>leaf_112</title>
<polygon fill="none" stroke="#c0c0c0" points="7923,-562.4008 7837,-562.4008 7837,-526.4008 7923,-526.4008 7923,-562.4008"/>
<text text-anchor="middle" x="7880" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_106&#45;&gt;leaf_112 -->
<g id="edge112" class="edge">
<title>codeblock_106&#45;&gt;leaf_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7833.1158,-1313.2046C7839.4212,-1209.8101 7870.5803,-698.8644 7878.2782,-572.6352"/>
<polygon fill="#000000" stroke="#000000" points="7881.775,-572.7926 7878.8903,-562.5981 7874.788,-572.3665 7881.775,-572.7926"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="6931,-53.1 6877,-53.1 6877,-17.1 6931,-17.1 6931,-53.1"/>
</g>
<!-- raw_108&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>raw_108&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6904,-526.2745C6904,-450.168 6904,-156.1165 6904,-63.3239"/>
<polygon fill="#000000" stroke="#000000" points="6907.5001,-63.2743 6904,-53.2744 6900.5001,-63.2744 6907.5001,-63.2743"/>
</g>
</g>
</svg>
