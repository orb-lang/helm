<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="16149pt" height="2701pt"
 viewBox="0.00 0.00 16149.00 2700.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2696.8041)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2696.8041 16145,-2696.8041 16145,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2674.8041" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1916" y="-2670.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 537</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2602.8041" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1916" y="-2598.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;432</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2656.6355C1916,-2648.9351 1916,-2639.7785 1916,-2631.2208"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2631.2174 1916,-2621.2174 1912.5001,-2631.2174 1919.5001,-2631.2174"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-2530.8041" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1423" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.2598,-2597.2625C1770.327,-2589.3752 1619.8799,-2573.1177 1493,-2548.8041 1487.5313,-2547.7562 1481.8552,-2546.5307 1476.2079,-2545.2207"/>
<polygon fill="#000000" stroke="#000000" points="1476.6666,-2541.7311 1466.125,-2542.7915 1475.0271,-2548.5364 1476.6666,-2541.7311"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1534" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1534" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.9444,-2597.4966C1783.9096,-2590.6049 1670.4561,-2576.0881 1576,-2548.8041 1573.3753,-2548.046 1570.6968,-2547.1661 1568.0264,-2546.2109"/>
<polygon fill="#000000" stroke="#000000" points="1569.0905,-2542.8694 1558.5019,-2542.5053 1566.5523,-2549.3931 1569.0905,-2542.8694"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1617" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1617" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1858.5115,-2594.0763C1805.8695,-2585.2992 1726.168,-2570.0239 1659,-2548.8041 1656.551,-2548.0304 1654.0496,-2547.1645 1651.5484,-2546.2421"/>
<polygon fill="#000000" stroke="#000000" points="1652.5995,-2542.8943 1642.0128,-2542.48 1650.0305,-2549.4059 1652.5995,-2542.8943"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1700" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1700" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1869.4587,-2590.0156C1833.9145,-2579.8715 1783.9068,-2564.7829 1741,-2548.8041 1738.7872,-2547.98 1736.5222,-2547.0981 1734.2487,-2546.1837"/>
<polygon fill="#000000" stroke="#000000" points="1735.5421,-2542.9309 1724.9657,-2542.3062 1732.8441,-2549.3901 1735.5421,-2542.9309"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1782" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1782" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1885.9278,-2586.6459C1864.5921,-2575.182 1835.9909,-2559.8142 1814.1939,-2548.1023"/>
<polygon fill="#000000" stroke="#000000" points="1815.7755,-2544.9789 1805.3099,-2543.3289 1812.4622,-2551.1452 1815.7755,-2544.9789"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2530.8041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1916" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2584.6355C1916,-2576.9351 1916,-2567.7785 1916,-2559.2208"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2559.2174 1916,-2549.2174 1912.5001,-2559.2174 1919.5001,-2559.2174"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2130" cy="-2530.8041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2130" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1957.5151,-2588.8364C1991.3229,-2577.4618 2039.3025,-2561.3192 2076.0788,-2548.9458"/>
<polygon fill="#000000" stroke="#000000" points="2077.2896,-2552.2313 2085.6515,-2545.7251 2075.0574,-2545.5968 2077.2896,-2552.2313"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2530.8041" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;231</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1977.2733,-2596.2876C2101.3869,-2583.0879 2382.1528,-2553.228 2517.3937,-2538.845"/>
<polygon fill="#000000" stroke="#000000" points="2518.0882,-2542.2909 2527.6619,-2537.7529 2517.3478,-2535.3302 2518.0882,-2542.2909"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7176" cy="-2530.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7176" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 282&#45;317</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.029,-2601.9003C2539.7647,-2594.2659 6458.0244,-2540.6319 7090.0265,-2531.9809"/>
<polygon fill="#000000" stroke="#000000" points="7090.4664,-2535.4753 7100.4176,-2531.8387 7090.3706,-2528.476 7090.4664,-2535.4753"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11302" cy="-2530.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11302" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 373&#45;432</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1981.9098,-2602.2985C2767.3119,-2596.2737 10323.6571,-2538.309 11216.0456,-2531.4635"/>
<polygon fill="#000000" stroke="#000000" points="11216.2632,-2534.962 11226.236,-2531.3853 11216.2095,-2527.9622 11216.2632,-2534.962"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="13144" cy="-2530.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13144" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 433&#45;503</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1981.8015,-2602.5435C2599.9691,-2600.0715 7452.5584,-2580.1557 11386,-2548.8041 12028.3479,-2543.6843 12802.6899,-2534.8172 13057.8707,-2531.8243"/>
<polygon fill="#000000" stroke="#000000" points="13058.223,-2535.3205 13068.1812,-2531.7033 13058.1407,-2528.321 13058.223,-2535.3205"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1468.5,-2429.204 1375.5,-2429.204 1375.5,-2393.204 1468.5,-2393.204 1468.5,-2429.204"/>
<text text-anchor="middle" x="1422" y="-2407.704" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1422.8481,-2512.6394C1422.6859,-2493.2334 1422.4265,-2462.2141 1422.2373,-2439.5819"/>
<polygon fill="#000000" stroke="#000000" points="1425.7369,-2439.51 1422.1533,-2429.5396 1418.7371,-2439.5686 1425.7369,-2439.51"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1514" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1514" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1530.9624,-2512.6394C1527.6984,-2493.1205 1522.4697,-2461.853 1518.6796,-2439.188"/>
<polygon fill="#000000" stroke="#000000" points="1522.1021,-2438.4335 1517.0006,-2429.1477 1515.198,-2439.5881 1522.1021,-2438.4335"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1586" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1586" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1612.359,-2512.8988C1607.291,-2493.3462 1599.1105,-2461.7854 1593.2061,-2439.0056"/>
<polygon fill="#000000" stroke="#000000" points="1596.5699,-2438.0337 1590.6727,-2429.2317 1589.7938,-2439.7901 1596.5699,-2438.0337"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1658" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1658" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1693.7122,-2512.8988C1686.7751,-2493.1446 1675.5337,-2461.1333 1667.5166,-2438.3037"/>
<polygon fill="#000000" stroke="#000000" points="1670.8094,-2437.1168 1664.1937,-2428.8414 1664.2048,-2439.4362 1670.8094,-2437.1168"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1730" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1730" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1774.3272,-2513.1567C1765.6753,-2493.2572 1751.5143,-2460.6869 1741.5301,-2437.7234"/>
<polygon fill="#000000" stroke="#000000" points="1744.7323,-2436.3101 1737.5352,-2428.535 1738.3128,-2439.1012 1744.7323,-2436.3101"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057,-2476.9044 1775,-2476.9044 1775,-2345.5036 2057,-2345.5036 2057,-2476.9044"/>
<text text-anchor="middle" x="1916" y="-2461.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1916" y="-2446.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1916" y="-2430.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1916" y="-2415.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1916" y="-2400.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1916" y="-2384.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1916" y="-2369.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1916" y="-2353.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2512.6394C1916,-2505.3645 1916,-2496.4574 1916,-2486.972"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2486.9219 1916,-2476.922 1912.5001,-2486.922 1919.5001,-2486.9219"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2429.204 2075.5,-2429.204 2075.5,-2393.204 2266.5,-2393.204 2266.5,-2429.204"/>
<text text-anchor="middle" x="2171" y="-2407.704" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2136.227,-2512.6394C2142.9097,-2493.1456 2153.6096,-2461.9331 2161.3769,-2439.2752"/>
<polygon fill="#000000" stroke="#000000" points="2164.7823,-2440.1342 2164.7144,-2429.5396 2158.1606,-2437.8642 2164.7823,-2440.1342"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2411.204" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2540.569,-2518.7281C2507.7843,-2509.8929 2465.4023,-2496.0702 2431,-2476.8041 2411.3309,-2465.7889 2391.9201,-2449.4896 2377.3823,-2435.8941"/>
<polygon fill="#000000" stroke="#000000" points="2379.4802,-2433.0571 2369.8364,-2428.6699 2374.6394,-2438.1135 2379.4802,-2433.0571"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2562.6368,-2514.462C2546.6527,-2504.8893 2527.4321,-2491.7527 2513,-2476.8041 2501.8906,-2465.2971 2492.2443,-2450.2993 2485.1042,-2437.5489"/>
<polygon fill="#000000" stroke="#000000" points="2488.1857,-2435.8891 2480.3629,-2428.7439 2482.0224,-2439.2079 2488.1857,-2435.8891"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2411.204" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;141</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2512.6394C2593,-2493.2334 2593,-2462.2141 2593,-2439.5819"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2439.5396 2593,-2429.5396 2589.5001,-2439.5397 2596.5001,-2439.5396"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 142&#45;220</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2632.7017,-2515.7778C2690.133,-2494.0411 2796.3573,-2453.8372 2859.0409,-2430.1126"/>
<polygon fill="#000000" stroke="#000000" points="2860.5997,-2433.265 2868.7133,-2426.4518 2858.1218,-2426.7182 2860.5997,-2433.265"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="3961" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3961" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;231</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2659.9075,-2524.9546C2887.5516,-2505.0524 3631.6589,-2439.9973 3879.7083,-2418.3111"/>
<polygon fill="#000000" stroke="#000000" points="3880.0775,-2421.7922 3889.7346,-2417.4345 3879.4678,-2414.8188 3880.0775,-2421.7922"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4834" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4834" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 232&#45;281</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.6926,-2529.322C2874.0981,-2524.6639 3514.6405,-2508.6973 4045,-2476.8041 4304.7697,-2461.1828 4611.8609,-2432.7864 4754.1918,-2419.0556"/>
<polygon fill="#000000" stroke="#000000" points="4754.5352,-2422.5388 4764.152,-2418.0927 4753.8616,-2415.5713 4754.5352,-2422.5388"/>
</g>
<!-- header_88 -->
<g id="node89" class="node">
<title>header_88</title>
<ellipse fill="none" stroke="#000000" cx="6977" cy="-2411.204" rx="107.339" ry="18"/>
<text text-anchor="middle" x="6977" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;header_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7147.9102,-2513.922C7113.0959,-2492.9984 7053.6297,-2457.2589 7014.8262,-2433.9378"/>
<polygon fill="#000000" stroke="#000000" points="7016.2896,-2430.7338 7005.9155,-2428.5824 7012.6837,-2436.7336 7016.2896,-2430.7338"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7135" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7135" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7169.773,-2512.6394C7163.0515,-2493.0322 7152.2659,-2461.5698 7144.4879,-2438.8809"/>
<polygon fill="#000000" stroke="#000000" points="7147.705,-2437.4723 7141.1513,-2429.1477 7141.0833,-2439.7424 7147.705,-2437.4723"/>
</g>
<!-- prose_90 -->
<g id="node91" class="node">
<title>prose_90</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7217" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;prose_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7182.227,-2512.6394C7188.9485,-2493.0322 7199.7341,-2461.5698 7207.5121,-2438.8809"/>
<polygon fill="#000000" stroke="#000000" points="7210.9167,-2439.7424 7210.8487,-2429.1477 7204.295,-2437.4723 7210.9167,-2439.7424"/>
</g>
<!-- section_91 -->
<g id="node92" class="node">
<title>section_91</title>
<ellipse fill="none" stroke="#000000" cx="7808" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7808" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 292&#45;317</text>
</g>
<!-- section_10&#45;&gt;section_91 -->
<g id="edge91" class="edge">
<title>section_10&#45;&gt;section_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7235.173,-2519.6062C7352.439,-2497.4147 7613.7725,-2447.9597 7738.7845,-2424.3024"/>
<polygon fill="#000000" stroke="#000000" points="7739.4606,-2427.7366 7748.6354,-2422.4382 7738.159,-2420.8587 7739.4606,-2427.7366"/>
</g>
<!-- section_92 -->
<g id="node93" class="node">
<title>section_92</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9340" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 318&#45;372</text>
</g>
<!-- section_10&#45;&gt;section_92 -->
<g id="edge92" class="edge">
<title>section_10&#45;&gt;section_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7249.5516,-2526.7391C7577.8074,-2508.597 8908.0524,-2435.0769 9256.2491,-2415.8327"/>
<polygon fill="#000000" stroke="#000000" points="9256.4708,-2419.3259 9266.2623,-2415.2793 9256.0844,-2412.3366 9256.4708,-2419.3259"/>
</g>
<!-- header_140 -->
<g id="node141" class="node">
<title>header_140</title>
<ellipse fill="none" stroke="#000000" cx="10366" cy="-2411.204" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10366" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_140 -->
<g id="edge140" class="edge">
<title>section_11&#45;&gt;header_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11227.5933,-2527.6051C11067.0855,-2520.3335 10692.7579,-2501.2795 10568,-2476.8041 10515.3532,-2466.4757 10457.297,-2446.6962 10416.9878,-2431.5456"/>
<polygon fill="#000000" stroke="#000000" points="10417.9832,-2428.1797 10407.392,-2427.9003 10415.4973,-2434.7235 10417.9832,-2428.1797"/>
</g>
<!-- prose_141 -->
<g id="node142" class="node">
<title>prose_141</title>
<ellipse fill="none" stroke="#000000" cx="10609" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10609" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_141 -->
<g id="edge141" class="edge">
<title>section_11&#45;&gt;prose_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11240.8049,-2520.2429C11102.0984,-2496.3045 10766.7798,-2438.4341 10649.9577,-2418.2726"/>
<polygon fill="#000000" stroke="#000000" points="10650.4383,-2414.8039 10639.9887,-2416.5521 10649.2478,-2421.7019 10650.4383,-2414.8039"/>
</g>
<!-- prose_142 -->
<g id="node143" class="node">
<title>prose_142</title>
<ellipse fill="none" stroke="#000000" cx="11083" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11083" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_142 -->
<g id="edge142" class="edge">
<title>section_11&#45;&gt;prose_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11271.549,-2514.1742C11230.3557,-2491.6778 11157.2036,-2451.728 11115.1516,-2428.7626"/>
<polygon fill="#000000" stroke="#000000" points="11116.6254,-2425.5796 11106.1713,-2423.8583 11113.2703,-2431.7231 11116.6254,-2425.5796"/>
</g>
<!-- prose_143 -->
<g id="node144" class="node">
<title>prose_143</title>
<ellipse fill="none" stroke="#000000" cx="11302" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11302" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_143 -->
<g id="edge143" class="edge">
<title>section_11&#45;&gt;prose_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11302,-2512.6394C11302,-2493.2334 11302,-2462.2141 11302,-2439.5819"/>
<polygon fill="#000000" stroke="#000000" points="11305.5001,-2439.5396 11302,-2429.5396 11298.5001,-2439.5397 11305.5001,-2439.5396"/>
</g>
<!-- prose_144 -->
<g id="node145" class="node">
<title>prose_144</title>
<ellipse fill="none" stroke="#000000" cx="11384" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11384" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_144 -->
<g id="edge144" class="edge">
<title>section_11&#45;&gt;prose_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11316.0822,-2513.105C11324.1929,-2502.7053 11334.4429,-2489.2053 11343,-2476.8041 11351.8135,-2464.0314 11361.0235,-2449.4246 11368.4766,-2437.2415"/>
<polygon fill="#000000" stroke="#000000" points="11371.6046,-2438.8332 11373.798,-2428.4679 11365.6195,-2435.2031 11371.6046,-2438.8332"/>
</g>
<!-- prose_145 -->
<g id="node146" class="node">
<title>prose_145</title>
<ellipse fill="none" stroke="#000000" cx="11466" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11466" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_145 -->
<g id="edge145" class="edge">
<title>section_11&#45;&gt;prose_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11350.7315,-2516.9897C11375.008,-2508.3343 11403.654,-2495.2611 11425,-2476.8041 11437.2625,-2466.2012 11447.0762,-2451.0133 11454.0243,-2437.9211"/>
<polygon fill="#000000" stroke="#000000" points="11457.2172,-2439.3618 11458.5711,-2428.8538 11450.9598,-2436.224 11457.2172,-2439.3618"/>
</g>
<!-- prose_146 -->
<g id="node147" class="node">
<title>prose_146</title>
<ellipse fill="none" stroke="#000000" cx="11548" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11548" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_146 -->
<g id="edge146" class="edge">
<title>section_11&#45;&gt;prose_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11362.5801,-2519.9718C11414.4067,-2509.7914 11484.1458,-2493.6389 11507,-2476.8041 11520.2261,-2467.0616 11530.1731,-2451.6537 11536.9552,-2438.2181"/>
<polygon fill="#000000" stroke="#000000" points="11540.2519,-2439.4319 11541.3359,-2428.8926 11533.9162,-2436.4556 11540.2519,-2439.4319"/>
</g>
<!-- codeblock_147 -->
<g id="node148" class="node">
<title>codeblock_147</title>
<ellipse fill="none" stroke="#000000" cx="11779" cy="-2411.204" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11779" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 390&#45;430</text>
</g>
<!-- section_11&#45;&gt;codeblock_147 -->
<g id="edge147" class="edge">
<title>section_11&#45;&gt;codeblock_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11366.7207,-2521.4044C11425.288,-2512.2433 11513.6519,-2496.7849 11589,-2476.8041 11637.149,-2464.0359 11690.676,-2445.1109 11728.6134,-2430.8648"/>
<polygon fill="#000000" stroke="#000000" points="11730.28,-2433.9765 11738.3954,-2427.1654 11727.8038,-2427.429 11730.28,-2433.9765"/>
</g>
<!-- header_168 -->
<g id="node169" class="node">
<title>header_168</title>
<ellipse fill="none" stroke="#000000" cx="12810" cy="-2411.204" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="12810" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_168 -->
<g id="edge168" class="edge">
<title>section_12&#45;&gt;header_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13087.9199,-2518.7034C13047.3208,-2509.2135 12991.4699,-2494.644 12944,-2476.8041 12911.0325,-2464.4145 12875.284,-2446.6802 12849.0086,-2432.7738"/>
<polygon fill="#000000" stroke="#000000" points="12850.5992,-2429.6554 12840.1298,-2428.0296 12847.3002,-2435.8293 12850.5992,-2429.6554"/>
</g>
<!-- prose_169 -->
<g id="node170" class="node">
<title>prose_169</title>
<ellipse fill="none" stroke="#000000" cx="12985" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12985" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_169 -->
<g id="edge169" class="edge">
<title>section_12&#45;&gt;prose_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13109.6118,-2514.5851C13090.6025,-2504.8697 13067.049,-2491.5577 13048,-2476.8041 13032.2858,-2464.6334 13016.7936,-2448.5713 13005.1042,-2435.3871"/>
<polygon fill="#000000" stroke="#000000" points="13007.5494,-2432.865 12998.3493,-2427.6105 13002.2647,-2437.4554 13007.5494,-2432.865"/>
</g>
<!-- codeblock_170 -->
<g id="node171" class="node">
<title>codeblock_170</title>
<ellipse fill="none" stroke="#000000" cx="13144" cy="-2411.204" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13144" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 435&#45;448</text>
</g>
<!-- section_12&#45;&gt;codeblock_170 -->
<g id="edge170" class="edge">
<title>section_12&#45;&gt;codeblock_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13144,-2512.6394C13144,-2493.2334 13144,-2462.2141 13144,-2439.5819"/>
<polygon fill="#000000" stroke="#000000" points="13147.5001,-2439.5396 13144,-2429.5396 13140.5001,-2439.5397 13147.5001,-2439.5396"/>
</g>
<!-- section_171 -->
<g id="node172" class="node">
<title>section_171</title>
<ellipse fill="none" stroke="#000000" cx="13567" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13567" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 451&#45;484</text>
</g>
<!-- section_12&#45;&gt;section_171 -->
<g id="edge171" class="edge">
<title>section_12&#45;&gt;section_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13192.9367,-2516.9676C13271.2788,-2494.817 13424.5545,-2451.4794 13508.5369,-2427.734"/>
<polygon fill="#000000" stroke="#000000" points="13509.5072,-2431.097 13518.1776,-2425.0082 13507.6026,-2424.361 13509.5072,-2431.097"/>
</g>
<!-- section_172 -->
<g id="node173" class="node">
<title>section_172</title>
<ellipse fill="none" stroke="#000000" cx="14281" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14281" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 485&#45;503</text>
</g>
<!-- section_12&#45;&gt;section_172 -->
<g id="edge172" class="edge">
<title>section_12&#45;&gt;section_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13213.4129,-2523.5026C13413.3634,-2502.47 13989.8075,-2441.8343 14201.6627,-2419.5494"/>
<polygon fill="#000000" stroke="#000000" points="14202.1959,-2423.0127 14211.7749,-2418.4857 14201.4636,-2416.0511 14202.1959,-2423.0127"/>
</g>
<!-- section_173 -->
<g id="node174" class="node">
<title>section_173</title>
<ellipse fill="none" stroke="#000000" cx="15287" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15287" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 504&#45;537</text>
</g>
<!-- section_12&#45;&gt;section_173 -->
<g id="edge173" class="edge">
<title>section_12&#45;&gt;section_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13218.7138,-2528.1983C13409.6436,-2521.3875 13931.0045,-2501.8359 14365,-2476.8041 14675.3964,-2458.9012 15044.0649,-2430.5226 15205.0143,-2417.7791"/>
<polygon fill="#000000" stroke="#000000" points="15205.6205,-2421.2422 15215.3125,-2416.9626 15205.0672,-2414.2641 15205.6205,-2421.2422"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2040.3045 0,-2040.3045 0,-1968.5022 324,-1968.5022 324,-2040.3045"/>
<text text-anchor="middle" x="162" y="-1976.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1509.2631,-2393.2266C1504.1163,-2377.6528 1494.2259,-2356.0318 1477,-2345.6039 1368.2075,-2279.7448 441.6989,-2375.6173 333,-2309.6039 237.7522,-2251.7594 191.1966,-2120.0585 172.4629,-2050.0805"/>
<polygon fill="#000000" stroke="#000000" points="175.8028,-2049.0169 169.8983,-2040.2199 169.0282,-2050.7789 175.8028,-2049.0169"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2031.7037 342.5,-2031.7037 342.5,-1977.1029 897.5,-1977.1029 897.5,-2031.7037"/>
<text text-anchor="middle" x="620" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1581.4695,-2393.3409C1576.5146,-2377.8441 1566.9248,-2356.2718 1550,-2345.6039 1428.9306,-2269.2924 1036.7227,-2370.0461 907,-2309.6039 780.1775,-2250.5129 681.8997,-2107.9005 640.8764,-2040.6504"/>
<polygon fill="#000000" stroke="#000000" points="643.8597,-2038.8199 635.6997,-2032.0624 637.8647,-2042.4337 643.8597,-2038.8199"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2031.7037 916,-2031.7037 916,-1977.1029 1464,-1977.1029 1464,-2031.7037"/>
<text text-anchor="middle" x="1190" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1652.7687,-2393.4608C1647.4348,-2378.4781 1637.6842,-2357.601 1622,-2345.6039 1567.8877,-2304.2125 1531.7778,-2344.0503 1473,-2309.6039 1354.2132,-2239.9894 1255.4773,-2104.9306 1212.7489,-2040.4106"/>
<polygon fill="#000000" stroke="#000000" points="1215.5058,-2038.232 1207.0952,-2031.7889 1209.6521,-2042.0706 1215.5058,-2038.232"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2039.7037 1482,-2039.7037 1482,-1969.103 2030,-1969.103 2030,-2039.7037"/>
<text text-anchor="middle" x="1756" y="-2008.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1993.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.1507,-2393.1994C1734.9841,-2333.222 1747.3988,-2138.9791 1753.095,-2049.8551"/>
<polygon fill="#000000" stroke="#000000" points="1756.594,-2049.9809 1753.7391,-2039.778 1749.6083,-2049.5344 1756.594,-2049.9809"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-2022.4033 2048,-2022.4033 2048,-1986.4033 2162,-1986.4033 2162,-2022.4033"/>
<text text-anchor="middle" x="2105" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2335.8279,-2393.5156C2320.8942,-2378.9755 2298.0823,-2358.7053 2275,-2345.6039 2232.4615,-2321.4591 2203.4456,-2346.2068 2171,-2309.6039 2100.0783,-2229.5948 2099.261,-2091.7196 2102.6242,-2032.6271"/>
<polygon fill="#000000" stroke="#000000" points="2106.1236,-2032.7492 2103.2849,-2022.5418 2099.1386,-2032.2916 2106.1236,-2032.7492"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2465.6617,-2393.5315C2459.2854,-2378.3817 2447.9512,-2357.2182 2431,-2345.6039 2360.8192,-2297.5186 2300.9587,-2371.88 2243,-2309.6039 2170.9916,-2232.2314 2188.8722,-2091.841 2200.6424,-2032.2994"/>
<polygon fill="#000000" stroke="#000000" points="2204.0752,-2032.982 2202.6756,-2022.48 2197.2206,-2031.5626 2204.0752,-2032.982"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-2004.4033" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2575.1932,-2393.7378C2559.758,-2379.3334 2536.2962,-2359.1374 2513,-2345.6039 2474.317,-2323.1315 2449.2607,-2342.5534 2419,-2309.6039 2345.4336,-2229.5006 2332.989,-2091.6763 2331.1525,-2032.6122"/>
<polygon fill="#000000" stroke="#000000" points="2334.6498,-2032.4487 2330.9207,-2022.5319 2327.6516,-2032.6097 2334.6498,-2032.4487"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2571.323,-2393.9069C2549.8803,-2375.4661 2518.0171,-2344.2003 2502,-2309.6039 2458.3927,-2215.4131 2456.7637,-2088.6428 2458.5281,-2032.8139"/>
<polygon fill="#000000" stroke="#000000" points="2462.0329,-2032.7502 2458.9148,-2022.6246 2455.038,-2032.4847 2462.0329,-2032.7502"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2004.4033" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;139</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2393.1994C2593,-2329.0222 2593,-2111.1178 2593,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2032.6615 2593,-2022.6616 2589.5001,-2032.6616 2596.5001,-2032.6615"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-2004.4033" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.0881,-2393.0403C2892.4346,-2372.8595 2878.4121,-2339.211 2868,-2309.6039 2832.5424,-2208.7793 2798.2246,-2086.3847 2783.5062,-2032.3451"/>
<polygon fill="#000000" stroke="#000000" points="2786.825,-2031.2103 2780.8293,-2022.4752 2780.069,-2033.0427 2786.825,-2031.2103"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2393.1994C2909,-2329.0222 2909,-2111.1178 2909,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-2032.6615 2909,-2022.6616 2905.5001,-2032.6616 2912.5001,-2032.6615"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2917.8171,-2393.3187C2927.263,-2373.3815 2941.9757,-2339.9453 2950,-2309.6039 2976.3433,-2209.9947 2986.2594,-2087.3916 2989.5519,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="2993.0625,-2032.7823 2990.1413,-2022.5982 2986.074,-2032.3812 2993.0625,-2032.7823"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3212" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3212" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;218</text>
</g>
<!-- section_27&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2934.7889,-2393.9717C2961.3503,-2375.3508 3002.8675,-2343.7295 3032,-2309.6039 3110.1816,-2218.0225 3174.0427,-2088.0526 3199.7728,-2031.9456"/>
<polygon fill="#000000" stroke="#000000" points="3203.0405,-2033.2147 3203.9899,-2022.6625 3196.6672,-2030.3195 3203.0405,-2033.2147"/>
</g>
<!-- header_50 -->
<g id="node51" class="node">
<title>header_50</title>
<ellipse fill="none" stroke="#000000" cx="3720" cy="-2004.4033" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3720" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_50 -->
<g id="edge50" class="edge">
<title>section_28&#45;&gt;header_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3950.3336,-2393.1994C3912.08,-2328.6285 3781.6332,-2108.4383 3735.9551,-2031.335"/>
<polygon fill="#000000" stroke="#000000" points="3738.925,-2029.4811 3730.8167,-2022.6616 3732.9025,-2033.0491 3738.925,-2029.4811"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="3961" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3961" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_28&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3961,-2393.1994C3961,-2329.0222 3961,-2111.1178 3961,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="3964.5001,-2032.6615 3961,-2022.6616 3957.5001,-2032.6616 3964.5001,-2032.6615"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4043" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4043" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_28&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3969.8171,-2393.3187C3979.263,-2373.3815 3993.9757,-2339.9453 4002,-2309.6039 4028.3433,-2209.9947 4038.2594,-2087.3916 4041.5519,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="4045.0625,-2032.7823 4042.1413,-2022.5982 4038.074,-2032.3812 4045.0625,-2032.7823"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="4181" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4181" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;229</text>
</g>
<!-- section_28&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_28&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3989.7154,-2394.3832C4017.611,-2376.643 4059.2729,-2346.2122 4084,-2309.6039 4144.8101,-2219.575 4169.3025,-2089.1645 4177.49,-2032.4735"/>
<polygon fill="#000000" stroke="#000000" points="4180.9716,-2032.847 4178.8753,-2022.4616 4174.0377,-2031.8875 4180.9716,-2032.847"/>
</g>
<!-- header_60 -->
<g id="node61" class="node">
<title>header_60</title>
<ellipse fill="none" stroke="#000000" cx="4588" cy="-2004.4033" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4588" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_60 -->
<g id="edge60" class="edge">
<title>section_29&#45;&gt;header_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4806.3797,-2394.313C4778.9344,-2376.3054 4737.2525,-2345.4781 4711,-2309.6039 4645.076,-2219.5184 4608.1282,-2089.1377 4594.3308,-2032.464"/>
<polygon fill="#000000" stroke="#000000" points="4597.6692,-2031.3738 4591.95,-2022.4552 4590.8592,-2032.9938 4597.6692,-2031.3738"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4752" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4752" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_29&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4825.1829,-2393.3187C4815.737,-2373.3815 4801.0243,-2339.9453 4793,-2309.6039 4766.6567,-2209.9947 4756.7406,-2087.3916 4753.4481,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="4756.926,-2032.3812 4752.8587,-2022.5982 4749.9375,-2032.7823 4756.926,-2032.3812"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="4834" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4834" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_29&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4834,-2393.1994C4834,-2329.0222 4834,-2111.1178 4834,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="4837.5001,-2032.6615 4834,-2022.6616 4830.5001,-2032.6616 4837.5001,-2032.6615"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5466" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5466" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_29&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4860.3516,-2394.2422C4962.0357,-2328.791 5328.5406,-2092.8821 5436.1168,-2023.6383"/>
<polygon fill="#000000" stroke="#000000" points="5438.0496,-2026.5566 5444.5639,-2018.2011 5434.2609,-2020.6705 5438.0496,-2026.5566"/>
</g>
<!-- prose_64 -->
<g id="node65" class="node">
<title>prose_64</title>
<ellipse fill="none" stroke="#000000" cx="5674" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5674" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_64 -->
<g id="edge64" class="edge">
<title>section_29&#45;&gt;prose_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4908.6791,-2408.1696C5063.1673,-2400.5943 5411.4166,-2376.4057 5507,-2309.6039 5605.7479,-2240.5905 5651.998,-2093.843 5667.6106,-2032.3893"/>
<polygon fill="#000000" stroke="#000000" points="5671.0257,-2033.1584 5670.0169,-2022.6117 5664.2285,-2031.4856 5671.0257,-2033.1584"/>
</g>
<!-- codeblock_65 -->
<g id="node66" class="node">
<title>codeblock_65</title>
<ellipse fill="none" stroke="#000000" cx="5975" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5975" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;279</text>
</g>
<!-- section_29&#45;&gt;codeblock_65 -->
<g id="edge65" class="edge">
<title>section_29&#45;&gt;codeblock_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4909.41,-2409.5282C5096.3374,-2404.273 5576.0107,-2383.7407 5715,-2309.6039 5838.2982,-2243.8367 5928.1105,-2093.5235 5961.1293,-2031.7159"/>
<polygon fill="#000000" stroke="#000000" points="5964.3761,-2033.0618 5965.9374,-2022.5826 5958.1819,-2029.8009 5964.3761,-2033.0618"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1882,-912.6029 1544,-912.6029 1544,-856.7999 1882,-856.7999 1882,-912.6029"/>
<text text-anchor="middle" x="1713" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.4791,-1986.4723C2223.4218,-1933.9318 2249.9983,-1779.0315 2171,-1699.2027 2082.7453,-1610.0202 1983.913,-1747.5212 1891,-1663.2027 1670.0544,-1462.6948 1694.7899,-1049.1619 1708.2864,-922.4418"/>
<polygon fill="#000000" stroke="#000000" points="1711.7714,-922.77 1709.3923,-912.4457 1704.8138,-922.0002 1711.7714,-922.77"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2042,-902.7014 1900,-902.7014 1900,-866.7014 2042,-866.7014 2042,-902.7014"/>
<text text-anchor="middle" x="1971" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.7892,-1986.3061C2333.0335,-1933.3083 2328.9002,-1777.2776 2243,-1699.2027 2178.7521,-1640.8077 2109.7931,-1727.0866 2051,-1663.2027 1848.0014,-1442.6272 1935.4878,-1024.0011 1963.5354,-912.542"/>
<polygon fill="#000000" stroke="#000000" points="1966.9573,-913.2877 1966.0523,-902.7315 1960.1769,-911.548 1966.9573,-913.2877"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2087" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2087" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.1632,-1986.401C2475.1842,-1933.6646 2499.0725,-1778.2797 2419,-1699.2027 2324.7063,-1606.0815 2213.139,-1760.3512 2123,-1663.2027 2019.9424,-1552.1311 2069.6575,-1039.5187 2083.7102,-912.9927"/>
<polygon fill="#000000" stroke="#000000" points="2087.2019,-913.262 2084.8434,-902.933 2080.2459,-912.4783 2087.2019,-913.262"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2680,-1663.2041 2132,-1663.2041 2132,-106.1988 2680,-106.1988 2680,-1663.2041"/>
<text text-anchor="middle" x="2406" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2406" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2406" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2406" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2406" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2406" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2406" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2406" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2406" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2406" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2406" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2406" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2406" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2406" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2406" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2406" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2406" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2406" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2406" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2406" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2406" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2406" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2406" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2406" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2406" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2406" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2406" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2406" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2406" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2406" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2406" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2406" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2406" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2406" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2406" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2406" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2406" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2406" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2406" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2406" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2406" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2406" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2406" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2406" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2406" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2406" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2406" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2406" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2406" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2406" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.9869,-1986.3619C2582.5819,-1942.0228 2562.2977,-1820.5668 2537.7663,-1673.68"/>
<polygon fill="#000000" stroke="#000000" points="2541.1683,-1672.8022 2536.0687,-1663.5153 2534.2639,-1673.9553 2541.1683,-1672.8022"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2114,-53.1 2060,-53.1 2060,-17.1 2114,-17.1 2114,-53.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2087,-866.5632C2087,-758.2631 2087,-197.2221 2087,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2090.5001,-63.4293 2087,-53.4293 2083.5001,-63.4293 2090.5001,-63.4293"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="2854,-902.7014 2698,-902.7014 2698,-866.7014 2854,-866.7014 2854,-902.7014"/>
<text text-anchor="middle" x="2776" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>header_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776,-1986.3619C2776,-1857.1254 2776,-1072.7313 2776,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="2779.5001,-913.0559 2776,-903.0559 2772.5001,-913.056 2779.5001,-913.0559"/>
</g>
<!-- raw_45 -->
<g id="node46" class="node">
<title>raw_45</title>
<ellipse fill="none" stroke="#000000" cx="2899" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2899" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;raw_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.8389,-1986.3619C2907.6847,-1857.1254 2900.6793,-1072.7313 2899.2532,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="2902.7532,-913.0242 2899.1639,-903.0559 2895.7535,-913.0868 2902.7532,-913.0242"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_42&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.6777,-1986.3619C2988.3693,-1857.1254 2974.3586,-1072.7313 2971.5065,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="2975.006,-912.9918 2971.3278,-903.0559 2968.0071,-913.1169 2975.006,-912.9918"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="3571.5,-1412.5035 3016.5,-1412.5035 3016.5,-356.8993 3571.5,-356.8993 3571.5,-1412.5035"/>
<text text-anchor="middle" x="3294" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3294" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3294" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3294" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3294" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3294" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3294" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3294" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3294" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3294" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3294" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3294" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3294" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3294" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3294" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3294" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3294" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3294" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3294" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3294" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3294" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3294" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3294" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3294" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3294" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3294" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3294" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3294" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3294" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3294" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3294" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3294" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3294" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3294" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3294" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3294" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3294" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3294" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3294" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3294" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3294" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3294" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3294" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3294" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3294" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3294" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3294" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3294" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3294" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3294" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3294" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_43&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3213.3212,-1986.3619C3218.3144,-1918.1802 3236.662,-1667.6459 3254.6004,-1422.6984"/>
<polygon fill="#000000" stroke="#000000" points="3258.1063,-1422.7451 3255.3461,-1412.5162 3251.125,-1422.2338 3258.1063,-1422.7451"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2677,-63.0015 2157,-63.0015 2157,-7.1986 2677,-7.1986 2677,-63.0015"/>
<text text-anchor="middle" x="2417" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>raw_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.093,-866.5278C2912.8891,-760.4937 2966.925,-222.4545 2863,-106.2001 2854.7496,-96.9708 2746.0706,-79.5409 2638.0717,-64.2491"/>
<polygon fill="#000000" stroke="#000000" points="2638.3528,-60.7542 2627.9621,-62.8235 2637.3754,-67.6856 2638.3528,-60.7542"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3194.5,-62.4005 2695.5,-62.4005 2695.5,-7.7996 3194.5,-7.7996 3194.5,-62.4005"/>
<text text-anchor="middle" x="2945" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2945" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2970.4449,-866.5632C2967.2032,-760.635 2950.7067,-221.5794 2946.1611,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2949.647,-72.525 2945.8427,-62.6367 2942.6503,-72.7391 2949.647,-72.525"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="3920.5,-902.7014 3589.5,-902.7014 3589.5,-866.7014 3920.5,-866.7014 3920.5,-902.7014"/>
<text text-anchor="middle" x="3755" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_50&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_50&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3720.5639,-1986.3619C3724.6037,-1857.1254 3749.1225,-1072.7313 3754.1136,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="3757.612,-913.1604 3754.4263,-903.0559 3750.6154,-912.9417 3757.612,-913.1604"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="3966" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3966" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_51&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3961.0806,-1986.3619C3961.6577,-1857.1254 3965.1604,-1072.7313 3965.8734,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="3969.3732,-913.0715 3965.918,-903.0559 3962.3733,-913.0402 3969.3732,-913.0715"/>
</g>
<!-- raw_57 -->
<g id="node58" class="node">
<title>raw_57</title>
<ellipse fill="none" stroke="#000000" cx="4041" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4041" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;raw_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4042.9678,-1986.3619C4042.7369,-1857.1254 4041.3359,-1072.7313 4041.0506,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4044.5507,-913.0496 4041.0328,-903.0559 4037.5508,-913.0622 4044.5507,-913.0496"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4208,-902.7014 4154,-902.7014 4154,-866.7014 4208,-866.7014 4208,-902.7014"/>
</g>
<!-- codeblock_53&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>codeblock_53&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4181,-1986.3619C4181,-1857.1254 4181,-1072.7313 4181,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4184.5001,-913.0559 4181,-903.0559 4177.5001,-913.056 4184.5001,-913.0559"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3579,-63.0015 3213,-63.0015 3213,-7.1986 3579,-7.1986 3579,-63.0015"/>
<text text-anchor="middle" x="3396" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_55&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>raw_55&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.158,-866.4429C3980.3209,-759.9257 4036.0427,-219.6034 3929,-106.2001 3876.6957,-50.7878 3663.4211,-81.0594 3588,-70.2001 3575.9584,-68.4663 3563.518,-66.5285 3551.0275,-64.4779"/>
<polygon fill="#000000" stroke="#000000" points="3551.4451,-60.9994 3541.0063,-62.811 3550.2964,-67.9045 3551.4451,-60.9994"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="3942.5,-55.0021 3597.5,-55.0021 3597.5,-15.198 3942.5,-15.198 3942.5,-55.0021"/>
<text text-anchor="middle" x="3770" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_57&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>raw_57&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4046.6916,-866.9345C4074.9219,-775.0916 4191.1802,-349.0842 4002,-106.2001 3986.4966,-86.2956 3934.711,-69.452 3883.9895,-57.1625"/>
<polygon fill="#000000" stroke="#000000" points="3884.7435,-53.7443 3874.2059,-54.8435 3883.129,-60.5556 3884.7435,-53.7443"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4697.5,-902.7014 4478.5,-902.7014 4478.5,-866.7014 4697.5,-866.7014 4697.5,-902.7014"/>
<text text-anchor="middle" x="4588" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>header_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4588,-1986.3619C4588,-1857.1254 4588,-1072.7313 4588,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4591.5001,-913.0559 4588,-903.0559 4584.5001,-913.056 4591.5001,-913.0559"/>
</g>
<!-- raw_67 -->
<g id="node68" class="node">
<title>raw_67</title>
<ellipse fill="none" stroke="#000000" cx="4748" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4748" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_67 -->
<g id="edge67" class="edge">
<title>prose_61&#45;&gt;raw_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4751.9355,-1986.3619C4751.4739,-1857.1254 4748.6717,-1072.7313 4748.1013,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4751.6014,-913.0433 4748.0656,-903.0559 4744.6014,-913.0684 4751.6014,-913.0433"/>
</g>
<!-- raw_69 -->
<g id="node70" class="node">
<title>raw_69</title>
<ellipse fill="none" stroke="#000000" cx="4829" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4829" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_69 -->
<g id="edge69" class="edge">
<title>prose_62&#45;&gt;raw_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4833.9194,-1986.3619C4833.3423,-1857.1254 4829.8396,-1072.7313 4829.1266,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4832.6267,-913.0402 4829.082,-903.0559 4825.6268,-913.0715 4832.6267,-913.0402"/>
</g>
<!-- raw_71 -->
<g id="node72" class="node">
<title>raw_71</title>
<ellipse fill="none" stroke="#000000" cx="5143" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5143" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_71 -->
<g id="edge71" class="edge">
<title>prose_63&#45;&gt;raw_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5453.9752,-1987.6249C5420.2121,-1939.644 5323.9515,-1796.7163 5277,-1663.2027 5178.0111,-1381.7135 5150.4916,-1016.3711 5144.4602,-913.0319"/>
<polygon fill="#000000" stroke="#000000" points="5147.9406,-912.5835 5143.8841,-902.796 5140.9517,-912.977 5147.9406,-912.5835"/>
</g>
<!-- prespace_72 -->
<g id="node73" class="node">
<title>prespace_72</title>
<ellipse fill="none" stroke="#000000" cx="5332" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5332" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_72 -->
<g id="edge72" class="edge">
<title>prose_63&#45;&gt;prespace_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5460.8736,-1986.464C5446.6858,-1936.032 5406.7169,-1788.5062 5388,-1663.2027 5344.5414,-1372.2615 5334.5187,-1014.9279 5332.4759,-913.0249"/>
<polygon fill="#000000" stroke="#000000" points="5335.9733,-912.85 5332.2832,-902.9186 5328.9746,-912.9836 5335.9733,-912.85"/>
</g>
<!-- literal_73 -->
<g id="node74" class="node">
<title>literal_73</title>
<ellipse fill="none" stroke="#000000" cx="5428" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5428" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_73 -->
<g id="edge73" class="edge">
<title>prose_63&#45;&gt;literal_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5465.3877,-1986.3619C5461.0017,-1857.1254 5434.3813,-1072.7313 5428.9623,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="5432.4602,-912.9314 5428.6229,-903.0559 5425.4642,-913.1689 5432.4602,-912.9314"/>
</g>
<!-- raw_74 -->
<g id="node75" class="node">
<title>raw_74</title>
<ellipse fill="none" stroke="#000000" cx="5504" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5504" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_74 -->
<g id="edge74" class="edge">
<title>prose_63&#45;&gt;raw_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5466.6123,-1986.3619C5470.9983,-1857.1254 5497.6187,-1072.7313 5503.0377,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="5506.5358,-913.1689 5503.3771,-903.0559 5499.5398,-912.9314 5506.5358,-913.1689"/>
</g>
<!-- prespace_75 -->
<g id="node76" class="node">
<title>prespace_75</title>
<ellipse fill="none" stroke="#000000" cx="5595" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5595" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_75 -->
<g id="edge75" class="edge">
<title>prose_63&#45;&gt;prespace_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5470.8496,-1986.4436C5484.2736,-1935.9587 5522.1079,-1788.3087 5540,-1663.2027 5581.6433,-1372.0232 5592.2103,-1014.8554 5594.4605,-913.0083"/>
<polygon fill="#000000" stroke="#000000" points="5597.9618,-912.9797 5594.6745,-902.9078 5590.9634,-912.8314 5597.9618,-912.9797"/>
</g>
<!-- literal_76 -->
<g id="node77" class="node">
<title>literal_76</title>
<ellipse fill="none" stroke="#000000" cx="5691" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5691" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_76 -->
<g id="edge76" class="edge">
<title>prose_63&#45;&gt;literal_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5475.596,-1987.116C5512.7049,-1920.1997 5644.9994,-1681.0221 5650,-1663.2027 5729.5638,-1379.6847 5703.5013,-1015.7621 5693.8842,-912.8948"/>
<polygon fill="#000000" stroke="#000000" points="5697.3457,-912.3255 5692.9043,-902.7065 5690.3778,-912.9957 5697.3457,-912.3255"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="5767" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5767" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_63&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5470.9297,-1986.4006C5486.0874,-1934.326 5536.8992,-1781.9851 5633,-1699.2027 5668.1563,-1668.9187 5703.5699,-1700.6284 5731,-1663.2027 5820.3825,-1541.249 5781.1324,-1038.8366 5769.7277,-913.2532"/>
<polygon fill="#000000" stroke="#000000" points="5773.1795,-912.5692 5768.7755,-902.9331 5766.2091,-913.2124 5773.1795,-912.5692"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5839" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5839" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_64&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_64&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5682.9148,-1986.8774C5707.5111,-1937.5174 5776.2713,-1792.5091 5803,-1663.2027 5862.5244,-1375.2396 5846.9281,-1015.1311 5840.8584,-912.9121"/>
<polygon fill="#000000" stroke="#000000" points="5844.3427,-912.5484 5840.2369,-902.7815 5837.3559,-912.9771 5844.3427,-912.5484"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6390,-1127.7024 5884,-1127.7024 5884,-641.7005 6390,-641.7005 6390,-1127.7024"/>
<text text-anchor="middle" x="6137" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6137" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6137" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6137" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6137" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6137" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6137" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6137" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6137" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6137" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6137" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6137" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6137" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6137" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6137" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6137" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6137" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6137" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6137" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_65&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>codeblock_65&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5977.6102,-1986.3619C5991.5082,-1890.3027 6057.7743,-1432.2891 6100.3682,-1137.8911"/>
<polygon fill="#000000" stroke="#000000" points="6103.8422,-1138.322 6101.8102,-1127.9239 6096.9143,-1137.3196 6103.8422,-1138.322"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="4235.5,-63.0015 3960.5,-63.0015 3960.5,-7.1986 4235.5,-7.1986 4235.5,-63.0015"/>
<text text-anchor="middle" x="4098" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_67&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>raw_67&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4750.0386,-866.7359C4761.643,-760.7466 4815.0893,-217.9434 4706,-106.2001 4670.1094,-69.4363 4295.753,-78.1907 4245,-70.2001 4235.3776,-68.6851 4225.4545,-66.8714 4215.5204,-64.8774"/>
<polygon fill="#000000" stroke="#000000" points="4216.0945,-61.4221 4205.5933,-62.8277 4214.679,-68.2775 4216.0945,-61.4221"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="4816,-70.3004 4254,-70.3004 4254,.1003 4816,.1003 4816,-70.3004"/>
<text text-anchor="middle" x="4535" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4535" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4535" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_69&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>raw_69&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4834.609,-866.8427C4862.4022,-774.5419 4976.5122,-346.6154 4784,-106.2001 4774.016,-93.7317 4750.3895,-82.7071 4721.4635,-73.2853"/>
<polygon fill="#000000" stroke="#000000" points="4722.4855,-69.9378 4711.8962,-70.2828 4720.3894,-76.6166 4722.4855,-69.9378"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5354,-62.4005 4834,-62.4005 4834,-7.7996 5354,-7.7996 5354,-62.4005"/>
<text text-anchor="middle" x="5094" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5094" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5141.9539,-866.5632C5135.8446,-760.635 5104.755,-221.5794 5096.1882,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="5099.6582,-72.4186 5095.5882,-62.6367 5092.6698,-72.8217 5099.6582,-72.4186"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5426,-53.1 5372,-53.1 5372,-17.1 5426,-17.1 5426,-53.1"/>
<text text-anchor="middle" x="5399" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>prespace_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5332.7569,-866.5464C5336.4407,-780.9458 5353.7264,-409.1554 5388,-106.2001 5389.6016,-92.0433 5391.9597,-76.387 5394.0822,-63.3778"/>
<polygon fill="#000000" stroke="#000000" points="5397.5929,-63.6037 5395.788,-53.1637 5390.6885,-62.4506 5397.5929,-63.6037"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5509.5,-53.1 5444.5,-53.1 5444.5,-17.1 5509.5,-17.1 5509.5,-53.1"/>
<text text-anchor="middle" x="5477" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>literal_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5428.432,-866.5619C5430.5738,-781.0313 5441.049,-409.5083 5468,-106.2001 5469.2561,-92.0638 5471.1796,-76.4098 5472.9263,-63.3967"/>
<polygon fill="#000000" stroke="#000000" points="5476.4365,-63.5623 5474.3335,-53.1783 5469.5019,-62.6073 5476.4365,-63.5623"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5796,-54.4006 5528,-54.4006 5528,-15.7995 5796,-15.7995 5796,-54.4006"/>
<text text-anchor="middle" x="5662" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5662" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>raw_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5502.5697,-866.7002C5494.6419,-762.7666 5459.2925,-239.4258 5540,-106.2001 5552.6148,-85.3766 5573.8026,-70.0093 5595.0134,-58.9987"/>
<polygon fill="#000000" stroke="#000000" points="5596.6488,-62.0949 5604.0802,-54.5434 5593.5617,-55.8124 5596.6488,-62.0949"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5868,-53.1 5814,-53.1 5814,-17.1 5868,-17.1 5868,-53.1"/>
<text text-anchor="middle" x="5841" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>prespace_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5593.5385,-866.6033C5585.4039,-760.9991 5549.6202,-224.9911 5651,-106.2001 5696.6294,-52.7342 5743.3552,-103.9723 5805,-70.2001 5809.8804,-67.5264 5814.5625,-64.0077 5818.8426,-60.2306"/>
<polygon fill="#000000" stroke="#000000" points="5821.288,-62.7347 5826.0683,-53.2795 5816.4351,-57.69 5821.288,-62.7347"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="5944,-53.1 5886,-53.1 5886,-17.1 5944,-17.1 5944,-53.1"/>
<text text-anchor="middle" x="5915" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>literal_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5689.1556,-866.6474C5678.7883,-761.2947 5631.6944,-226.4751 5731,-106.2001 5773.5511,-54.6639 5818.15,-101.8741 5877,-70.2001 5882.0415,-67.4867 5886.9286,-63.948 5891.4255,-60.1634"/>
<polygon fill="#000000" stroke="#000000" points="5894.0184,-62.5356 5899.0477,-53.2106 5889.301,-57.364 5894.0184,-62.5356"/>
</g>
<!-- leaf_84 -->
<g id="node85" class="node">
<title>leaf_84</title>
<polygon fill="none" stroke="#c0c0c0" points="6048,-53.1 5962,-53.1 5962,-17.1 6048,-17.1 6048,-53.1"/>
<text text-anchor="middle" x="6005" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_77&#45;&gt;leaf_84 -->
<g id="edge84" class="edge">
<title>raw_77&#45;&gt;leaf_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5765.0433,-866.6449C5754.0231,-761.278 5703.6542,-226.3913 5803,-106.2001 5846.6795,-53.3555 5890.2501,-97.8206 5953,-70.2001 5959.9222,-67.1532 5966.9149,-63.1768 5973.4307,-58.9993"/>
<polygon fill="#000000" stroke="#000000" points="5975.6313,-61.737 5981.9687,-53.2466 5971.7198,-55.9318 5975.6313,-61.737"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6600,-62.4005 6066,-62.4005 6066,-7.7996 6600,-7.7996 6600,-62.4005"/>
<text text-anchor="middle" x="6333" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6333" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_85&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>raw_85&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5836.8999,-866.5214C5825.0637,-760.4515 5770.8382,-222.2425 5875,-106.2001 5883.5356,-96.6909 5996.3899,-79.1101 6107.9239,-63.8105"/>
<polygon fill="#000000" stroke="#000000" points="6108.5818,-67.2532 6118.016,-62.4318 6107.6343,-60.3177 6108.5818,-67.2532"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="7072.5,-2022.4033 6881.5,-2022.4033 6881.5,-1986.4033 7072.5,-1986.4033 7072.5,-2022.4033"/>
<text text-anchor="middle" x="6977" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_88&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>header_88&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6977,-2393.1994C6977,-2329.0222 6977,-2111.1178 6977,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="6980.5001,-2032.6615 6977,-2022.6616 6973.5001,-2032.6616 6980.5001,-2032.6615"/>
</g>
<!-- raw_94 -->
<g id="node95" class="node">
<title>raw_94</title>
<ellipse fill="none" stroke="#000000" cx="7126" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="7126" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_94 -->
<g id="edge94" class="edge">
<title>prose_89&#45;&gt;raw_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7134.6017,-2393.1994C7133.1818,-2329.0222 7128.3609,-2111.1178 7126.6274,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="7130.1244,-2032.5817 7126.4039,-2022.6616 7123.1261,-2032.7366 7130.1244,-2032.5817"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="7217" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_90&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-2393.1994C7217,-2329.0222 7217,-2111.1178 7217,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-2032.6615 7217,-2022.6616 7213.5001,-2032.6616 7220.5001,-2032.6615"/>
</g>
<!-- header_98 -->
<g id="node99" class="node">
<title>header_98</title>
<ellipse fill="none" stroke="#000000" cx="7611" cy="-2004.4033" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7611" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_91&#45;&gt;header_98 -->
<g id="edge98" class="edge">
<title>section_91&#45;&gt;header_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7799.281,-2393.1994C7768.075,-2328.7597 7661.8138,-2109.3327 7624.2706,-2031.8069"/>
<polygon fill="#000000" stroke="#000000" points="7627.3505,-2030.1363 7619.8419,-2022.6616 7621.0503,-2033.1873 7627.3505,-2030.1363"/>
</g>
<!-- prose_99 -->
<g id="node100" class="node">
<title>prose_99</title>
<ellipse fill="none" stroke="#000000" cx="7808" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7808" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_99 -->
<g id="edge99" class="edge">
<title>section_91&#45;&gt;prose_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7808,-2393.1994C7808,-2329.0222 7808,-2111.1178 7808,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="7811.5001,-2032.6615 7808,-2022.6616 7804.5001,-2032.6616 7811.5001,-2032.6615"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8191" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_91&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7824.7033,-2393.4627C7886.1041,-2328.2463 8099.347,-2101.7518 8168.8856,-2027.892"/>
<polygon fill="#000000" stroke="#000000" points="8171.5937,-2030.1215 8175.9003,-2020.4414 8166.4971,-2025.323 8171.5937,-2030.1215"/>
</g>
<!-- codeblock_101 -->
<g id="node102" class="node">
<title>codeblock_101</title>
<ellipse fill="none" stroke="#000000" cx="8525" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8525" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 301&#45;315</text>
</g>
<!-- section_91&#45;&gt;codeblock_101 -->
<g id="edge101" class="edge">
<title>section_91&#45;&gt;codeblock_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7880.8251,-2406.2527C7969.1315,-2397.543 8120.0307,-2373.786 8232,-2309.6039 8359.5905,-2236.4675 8466.8295,-2091.0405 8507.5037,-2031.1402"/>
<polygon fill="#000000" stroke="#000000" points="8510.5617,-2032.8647 8513.2352,-2022.6128 8504.752,-2028.9599 8510.5617,-2032.8647"/>
</g>
<!-- header_124 -->
<g id="node125" class="node">
<title>header_124</title>
<ellipse fill="none" stroke="#000000" cx="9145" cy="-2004.4033" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9145" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_92&#45;&gt;header_124 -->
<g id="edge124" class="edge">
<title>section_92&#45;&gt;header_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9331.3695,-2393.1994C9300.4803,-2328.7597 9195.2979,-2109.3327 9158.1359,-2031.8069"/>
<polygon fill="#000000" stroke="#000000" points="9161.2308,-2030.1662 9153.7521,-2022.6616 9154.9186,-2033.192 9161.2308,-2030.1662"/>
</g>
<!-- prose_125 -->
<g id="node126" class="node">
<title>prose_125</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9340" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_125 -->
<g id="edge125" class="edge">
<title>section_92&#45;&gt;prose_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340,-2393.1994C9340,-2329.0222 9340,-2111.1178 9340,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="9343.5001,-2032.6615 9340,-2022.6616 9336.5001,-2032.6616 9343.5001,-2032.6615"/>
</g>
<!-- prose_126 -->
<g id="node127" class="node">
<title>prose_126</title>
<ellipse fill="none" stroke="#000000" cx="9455" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9455" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_126 -->
<g id="edge126" class="edge">
<title>section_92&#45;&gt;prose_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9348.2215,-2393.1444C9357.1459,-2373.0547 9371.4045,-2339.4857 9381,-2309.6039 9413.1927,-2209.3513 9438.9276,-2086.6657 9449.627,-2032.4486"/>
<polygon fill="#000000" stroke="#000000" points="9453.0793,-2033.0309 9451.5638,-2022.545 9446.2095,-2031.6873 9453.0793,-2033.0309"/>
</g>
<!-- codeblock_127 -->
<g id="node128" class="node">
<title>codeblock_127</title>
<ellipse fill="none" stroke="#000000" cx="9712" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9712" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 327&#45;370</text>
</g>
<!-- section_92&#45;&gt;codeblock_127 -->
<g id="edge127" class="edge">
<title>section_92&#45;&gt;codeblock_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9372.391,-2394.8521C9405.8201,-2376.9492 9458.2681,-2345.9061 9496,-2309.6039 9588.1996,-2220.8979 9666.4653,-2087.8713 9697.6001,-2031.3519"/>
<polygon fill="#000000" stroke="#000000" points="9700.8034,-2032.7885 9702.524,-2022.3343 9694.6596,-2029.4337 9700.8034,-2032.7885"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6921.5,-920.0018 6408.5,-920.0018 6408.5,-849.4011 6921.5,-849.4011 6921.5,-920.0018"/>
<text text-anchor="middle" x="6665" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6665" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_94&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_94&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7129.522,-1986.4158C7138.5829,-1934.3823 7156.9704,-1782.142 7081,-1699.2027 7034.3995,-1648.3275 6981.0241,-1709.6402 6930,-1663.2027 6707.6834,-1460.8707 6671.8031,-1064.7546 6666.0702,-930.4746"/>
<polygon fill="#000000" stroke="#000000" points="6669.5547,-930.0063 6665.6677,-920.1503 6662.56,-930.2791 6669.5547,-930.0063"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="7494.5,-927.9017 6939.5,-927.9017 6939.5,-841.5011 7494.5,-841.5011 7494.5,-927.9017"/>
<text text-anchor="middle" x="7217" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7217" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7217" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-1986.3619C7217,-1862.9127 7217,-1141.6682 7217,-938.1514"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-938.0111 7217,-928.0112 7213.5001,-938.0112 7220.5001,-938.0111"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7619.5,-902.7014 7512.5,-902.7014 7512.5,-866.7014 7619.5,-866.7014 7619.5,-902.7014"/>
<text text-anchor="middle" x="7566" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_98&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>header_98&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7610.2749,-1986.3619C7605.081,-1857.1254 7573.5568,-1072.7313 7567.1396,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="7570.6365,-912.9073 7566.7377,-903.0559 7563.6421,-913.1885 7570.6365,-912.9073"/>
</g>
<!-- raw_103 -->
<g id="node104" class="node">
<title>raw_103</title>
<ellipse fill="none" stroke="#000000" cx="7665" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7665" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_103 -->
<g id="edge103" class="edge">
<title>prose_99&#45;&gt;raw_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7800.644,-1986.6867C7780.342,-1936.8323 7723.5423,-1790.6629 7701,-1663.2027 7649.7896,-1373.6455 7659.5835,-1014.6495 7663.7107,-912.803"/>
<polygon fill="#000000" stroke="#000000" points="7667.2118,-912.8485 7664.1361,-902.71 7660.218,-912.5537 7667.2118,-912.8485"/>
</g>
<!-- prespace_104 -->
<g id="node105" class="node">
<title>prespace_104</title>
<ellipse fill="none" stroke="#000000" cx="7756" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7756" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_104 -->
<g id="edge104" class="edge">
<title>prose_99&#45;&gt;prespace_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7807.1621,-1986.3619C7801.1603,-1857.1254 7764.7323,-1072.7313 7757.3169,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="7760.8126,-912.8828 7756.8524,-903.0559 7753.8202,-913.2076 7760.8126,-912.8828"/>
</g>
<!-- literal_105 -->
<g id="node106" class="node">
<title>literal_105</title>
<ellipse fill="none" stroke="#000000" cx="7852" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7852" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_105 -->
<g id="edge105" class="edge">
<title>prose_99&#45;&gt;literal_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7808.709,-1986.3619C7813.7875,-1857.1254 7844.6111,-1072.7313 7850.8857,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="7854.3833,-913.1857 7851.2787,-903.0559 7847.3887,-912.9108 7854.3833,-913.1857"/>
</g>
<!-- raw_106 -->
<g id="node107" class="node">
<title>raw_106</title>
<ellipse fill="none" stroke="#000000" cx="7928" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7928" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_106 -->
<g id="edge106" class="edge">
<title>prose_99&#45;&gt;raw_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7813.72,-1986.5238C7829.5158,-1936.2468 7873.7724,-1789.0852 7892,-1663.2027 7934.092,-1372.5098 7930.6835,-1015.0034 7928.675,-913.0421"/>
<polygon fill="#000000" stroke="#000000" points="7932.172,-912.8545 7928.4633,-902.9299 7925.1735,-913.0011 7932.172,-912.8545"/>
</g>
<!-- prespace_111 -->
<g id="node112" class="node">
<title>prespace_111</title>
<ellipse fill="none" stroke="#000000" cx="8019" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8019" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_111 -->
<g id="edge111" class="edge">
<title>prose_100&#45;&gt;prespace_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8183.1748,-1986.7276C8161.5529,-1936.9792 8100.8862,-1791.0587 8075,-1663.2027 8016.561,-1374.5632 8016.9855,-1014.9267 8018.4471,-912.8658"/>
<polygon fill="#000000" stroke="#000000" points="8021.9484,-912.8057 8018.6082,-902.7512 8014.9493,-912.6941 8021.9484,-912.8057"/>
</g>
<!-- literal_112 -->
<g id="node113" class="node">
<title>literal_112</title>
<ellipse fill="none" stroke="#000000" cx="8115" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8115" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_112 -->
<g id="edge112" class="edge">
<title>prose_100&#45;&gt;literal_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8188.7442,-1986.31C8182.4817,-1935.479 8164.7055,-1787.016 8155,-1663.2027 8132.0401,-1370.3032 8119.2559,-1014.3326 8115.9001,-912.8891"/>
<polygon fill="#000000" stroke="#000000" points="8119.3962,-912.7094 8115.5708,-902.8293 8112.3999,-912.9385 8119.3962,-912.7094"/>
</g>
<!-- raw_113 -->
<g id="node114" class="node">
<title>raw_113</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8191" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_113 -->
<g id="edge113" class="edge">
<title>prose_100&#45;&gt;raw_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191,-1986.3619C8191,-1857.1254 8191,-1072.7313 8191,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="8194.5001,-913.0559 8191,-903.0559 8187.5001,-913.056 8194.5001,-913.0559"/>
</g>
<!-- prespace_114 -->
<g id="node115" class="node">
<title>prespace_114</title>
<ellipse fill="none" stroke="#000000" cx="8282" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8282" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_114 -->
<g id="edge114" class="edge">
<title>prose_100&#45;&gt;prespace_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8193.1332,-1986.2998C8199.0775,-1935.4423 8216.1066,-1786.9171 8227,-1663.2027 8252.8002,-1370.1941 8274.3943,-1014.2994 8280.3625,-912.8816"/>
<polygon fill="#000000" stroke="#000000" points="8283.8608,-913.0121 8280.9521,-902.8244 8276.8728,-912.6024 8283.8608,-913.0121"/>
</g>
<!-- literal_115 -->
<g id="node116" class="node">
<title>literal_115</title>
<ellipse fill="none" stroke="#000000" cx="8378" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8378" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_115 -->
<g id="edge115" class="edge">
<title>prose_100&#45;&gt;literal_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8201.0715,-1987.0367C8228.8622,-1938.0897 8306.5736,-1794.0513 8337,-1663.2027 8403.6202,-1376.7023 8386.6754,-1015.573 8380.0363,-913.0122"/>
<polygon fill="#000000" stroke="#000000" points="8383.516,-912.5911 8379.3561,-902.8471 8376.5316,-913.0585 8383.516,-912.5911"/>
</g>
<!-- raw_116 -->
<g id="node117" class="node">
<title>raw_116</title>
<ellipse fill="none" stroke="#000000" cx="8454" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8454" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_116 -->
<g id="edge116" class="edge">
<title>prose_100&#45;&gt;raw_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8206.4629,-1988.4131C8249.6993,-1942.5059 8371.6997,-1804.5104 8418,-1663.2027 8509.7524,-1383.176 8471.4438,-1016.1531 8457.965,-912.8357"/>
<polygon fill="#000000" stroke="#000000" points="8461.4275,-912.3216 8456.6342,-902.8731 8454.4891,-913.2485 8461.4275,-912.3216"/>
</g>
<!-- leaf_123 -->
<g id="node124" class="node">
<title>leaf_123</title>
<polygon fill="none" stroke="#c0c0c0" points="8942.5,-981.6022 8499.5,-981.6022 8499.5,-787.8007 8942.5,-787.8007 8942.5,-981.6022"/>
<text text-anchor="middle" x="8721" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8721" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8721" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8721" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8721" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8721" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8721" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8721" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8721" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8721" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8721" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_101&#45;&gt;leaf_123 -->
<g id="edge123" class="edge">
<title>codeblock_101&#45;&gt;leaf_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8528.1581,-1986.3619C8548.1648,-1872.068 8657.8681,-1245.3591 8702.3019,-991.5191"/>
<polygon fill="#000000" stroke="#000000" points="8705.7707,-992.0009 8704.0475,-981.5472 8698.8756,-990.7939 8705.7707,-992.0009"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7401.5,-63.0015 7112.5,-63.0015 7112.5,-7.1986 7401.5,-7.1986 7401.5,-63.0015"/>
<text text-anchor="middle" x="7257" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>raw_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7667.0567,-866.5357C7678.6427,-760.5472 7731.6384,-222.7227 7628,-106.2001 7595.514,-69.6755 7458.962,-79.6356 7411,-70.2001 7402.594,-68.5464 7393.946,-66.7735 7385.2405,-64.9353"/>
<polygon fill="#000000" stroke="#000000" points="7385.9071,-61.4988 7375.3969,-62.8349 7384.4463,-68.3447 7385.9071,-61.4988"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7474,-53.1 7420,-53.1 7420,-17.1 7474,-17.1 7474,-53.1"/>
<text text-anchor="middle" x="7447" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>prespace_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7757.6018,-866.5035C7766.5384,-760.3313 7806.1596,-221.6392 7701,-106.2001 7634.8688,-33.6045 7570.6329,-114.5164 7483,-70.2001 7477.9367,-67.6396 7473.1238,-64.1165 7468.7605,-60.2847"/>
<polygon fill="#000000" stroke="#000000" points="7471.0551,-57.6347 7461.4352,-53.1953 7466.187,-62.6648 7471.0551,-57.6347"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="7546,-53.1 7492,-53.1 7492,-17.1 7546,-17.1 7546,-53.1"/>
<text text-anchor="middle" x="7519" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>literal_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7853.9977,-866.4902C7865.2347,-760.2426 7916.3911,-221.1942 7811,-106.2001 7733.3691,-21.4957 7658.1458,-120.8195 7555,-70.2001 7549.9064,-67.7004 7545.0786,-64.2072 7540.7099,-60.3862"/>
<polygon fill="#000000" stroke="#000000" points="7543.0044,-57.7362 7533.3839,-53.2982 7538.137,-62.767 7543.0044,-57.7362"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="7783.5,-54.4006 7564.5,-54.4006 7564.5,-15.7995 7783.5,-15.7995 7783.5,-54.4006"/>
<text text-anchor="middle" x="7674" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7674" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_106&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>raw_106&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7929.8451,-866.4177C7940.1076,-760.8946 7986.3746,-230.1203 7892,-106.2001 7887.3853,-100.1407 7810.3581,-75.9102 7749.1585,-57.4036"/>
<polygon fill="#000000" stroke="#000000" points="7750.0704,-54.023 7739.4857,-54.4862 7748.049,-60.7248 7750.0704,-54.023"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="7856,-53.1 7802,-53.1 7802,-17.1 7856,-17.1 7856,-53.1"/>
</g>
<!-- prespace_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>prespace_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8024.0908,-866.7515C8048.9892,-774.8733 8149.4286,-352.013 7964,-106.2001 7935.8048,-68.8232 7904.6487,-95.0996 7865,-70.2001 7860.4954,-67.3712 7856.0954,-63.9002 7852.0056,-60.2531"/>
<polygon fill="#000000" stroke="#000000" points="7854.222,-57.5297 7844.577,-53.1452 7849.3826,-62.5875 7854.222,-57.5297"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8037.5,-53.1 7874.5,-53.1 7874.5,-17.1 8037.5,-17.1 8037.5,-53.1"/>
<text text-anchor="middle" x="7956" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>literal_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116.2728,-866.7115C8123.2978,-762.8416 8154.1851,-239.7985 8074,-106.2001 8061.0762,-84.6674 8038.903,-68.8372 8017.242,-57.6541"/>
<polygon fill="#000000" stroke="#000000" points="8018.5394,-54.3925 8008.0185,-53.1427 8015.4637,-60.6806 8018.5394,-54.3925"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8400.5,-54.4006 8055.5,-54.4006 8055.5,-15.7995 8400.5,-15.7995 8400.5,-54.4006"/>
<text text-anchor="middle" x="8228" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8228" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>raw_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191.7899,-866.5632C8196.4958,-758.5056 8220.8303,-199.7321 8226.7169,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8230.2153,-64.6746 8227.1538,-54.5318 8223.2219,-64.37 8230.2153,-64.6746"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="8473,-53.1 8419,-53.1 8419,-17.1 8473,-17.1 8473,-53.1"/>
<text text-anchor="middle" x="8446" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>prespace_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8277.3644,-866.5557C8255.1962,-775.4379 8167.9041,-362.0821 8338,-106.2001 8357.5861,-76.7359 8380.0853,-90.5886 8409,-70.2001 8413.2332,-67.2152 8417.4637,-63.7616 8421.4719,-60.2093"/>
<polygon fill="#000000" stroke="#000000" points="8423.9057,-62.7256 8428.8477,-53.354 8419.1401,-57.5982 8423.9057,-62.7256"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="8545,-53.1 8491,-53.1 8491,-17.1 8545,-17.1 8545,-53.1"/>
<text text-anchor="middle" x="8518" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_115&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>literal_115&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8376.6413,-866.676C8369.1294,-762.6063 8335.9171,-238.6287 8418,-106.2001 8435.1936,-78.4608 8455.8732,-89.7571 8482,-70.2001 8485.9832,-67.2185 8489.9774,-63.8245 8493.7802,-60.3496"/>
<polygon fill="#000000" stroke="#000000" points="8496.4405,-62.6486 8501.2523,-53.2095 8491.6044,-57.5877 8496.4405,-62.6486"/>
</g>
<!-- leaf_122 -->
<g id="node123" class="node">
<title>leaf_122</title>
<polygon fill="none" stroke="#c0c0c0" points="8999,-54.4006 8563,-54.4006 8563,-15.7995 8999,-15.7995 8999,-54.4006"/>
<text text-anchor="middle" x="8781" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8781" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_116&#45;&gt;leaf_122 -->
<g id="edge122" class="edge">
<title>raw_116&#45;&gt;leaf_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8452.0506,-866.651C8441.0721,-761.3184 8390.9002,-226.5942 8490,-106.2001 8508.2778,-83.9948 8565.0792,-67.7053 8623.7052,-56.3646"/>
<polygon fill="#000000" stroke="#000000" points="8624.712,-59.7366 8633.8912,-54.4459 8623.4161,-52.8576 8624.712,-59.7366"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="9151.5,-902.7014 8960.5,-902.7014 8960.5,-866.7014 9151.5,-866.7014 9151.5,-902.7014"/>
<text text-anchor="middle" x="9056" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_124&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>header_124&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9143.566,-1986.3619C9133.2936,-1857.1254 9070.9456,-1072.7313 9058.2539,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="9061.7404,-912.7471 9057.4589,-903.0559 9054.7624,-913.3019 9061.7404,-912.7471"/>
</g>
<!-- raw_129 -->
<g id="node130" class="node">
<title>raw_129</title>
<ellipse fill="none" stroke="#000000" cx="9197" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9197" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_129 -->
<g id="edge129" class="edge">
<title>prose_125&#45;&gt;raw_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9336.5787,-1986.3209C9327.1322,-1938.2548 9298.4112,-1803.846 9254,-1699.2027 9246.7634,-1682.1516 9238.246,-1680.9676 9233,-1663.2027 9149.6287,-1380.8781 9181.9672,-1016.1203 9193.5543,-912.9755"/>
<polygon fill="#000000" stroke="#000000" points="9197.0637,-913.0942 9194.7316,-902.7592 9190.1097,-912.2927 9197.0637,-913.0942"/>
</g>
<!-- prespace_130 -->
<g id="node131" class="node">
<title>prespace_130</title>
<ellipse fill="none" stroke="#000000" cx="9288" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9288" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_125&#45;&gt;prespace_130 -->
<g id="edge130" class="edge">
<title>prose_125&#45;&gt;prespace_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9339.1621,-1986.3619C9333.1603,-1857.1254 9296.7323,-1072.7313 9289.3169,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="9292.8126,-912.8828 9288.8524,-903.0559 9285.8202,-913.2076 9292.8126,-912.8828"/>
</g>
<!-- literal_131 -->
<g id="node132" class="node">
<title>literal_131</title>
<ellipse fill="none" stroke="#000000" cx="9384" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9384" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_125&#45;&gt;literal_131 -->
<g id="edge131" class="edge">
<title>prose_125&#45;&gt;literal_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340.709,-1986.3619C9345.7875,-1857.1254 9376.6111,-1072.7313 9382.8857,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="9386.3833,-913.1857 9383.2787,-903.0559 9379.3887,-912.9108 9386.3833,-913.1857"/>
</g>
<!-- raw_132 -->
<g id="node133" class="node">
<title>raw_132</title>
<ellipse fill="none" stroke="#000000" cx="9460" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9460" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_132 -->
<g id="edge132" class="edge">
<title>prose_125&#45;&gt;raw_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9344.1311,-1986.4633C9355.0417,-1939.2874 9385.7334,-1807.9018 9414,-1699.2027 9418.1793,-1683.1314 9421.3777,-1679.6002 9424,-1663.2027 9470.3834,-1373.1636 9463.9881,-1015.2021 9460.9724,-913.0874"/>
<polygon fill="#000000" stroke="#000000" points="9464.4668,-912.8467 9460.659,-902.9598 9457.4701,-913.0633 9464.4668,-912.8467"/>
</g>
<!-- raw_137 -->
<g id="node138" class="node">
<title>raw_137</title>
<ellipse fill="none" stroke="#000000" cx="9532" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9532" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_126&#45;&gt;raw_137 -->
<g id="edge137" class="edge">
<title>prose_126&#45;&gt;raw_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9457.6469,-1986.3261C9464.9808,-1935.5367 9485.6994,-1787.1715 9496,-1663.2027 9520.3219,-1370.4869 9529.2817,-1014.3884 9531.4435,-912.9019"/>
<polygon fill="#000000" stroke="#000000" points="9534.944,-912.9085 9531.6531,-902.8377 9527.9455,-912.7626 9534.944,-912.9085"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="10083,-1212.8028 9577,-1212.8028 9577,-556.6001 10083,-556.6001 10083,-1212.8028"/>
<text text-anchor="middle" x="9830" y="-1197.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9830" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="9830" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9830" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="9830" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9830" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9830" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9830" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9830" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9830" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="9830" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="9830" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9830" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9830" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9830" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="9830" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9830" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="9830" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9830" y="-873.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="9830" y="-858.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9830" y="-843.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-827.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9830" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9830" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="9830" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9830" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return c.alert &quot;No results found&quot;</text>
<text text-anchor="middle" x="9830" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="9830" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="9830" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase</text>
<text text-anchor="middle" x="9830" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="9830" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="9830" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="9830" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-564.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_127&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>codeblock_127&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9713.9013,-1986.3619C9723.0894,-1899.1764 9763.7002,-1513.8206 9794.3217,-1223.2527"/>
<polygon fill="#000000" stroke="#000000" points="9797.8393,-1223.2687 9795.4067,-1212.957 9790.8779,-1222.535 9797.8393,-1223.2687"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9264.5,-63.0015 9017.5,-63.0015 9017.5,-7.1986 9264.5,-7.1986 9264.5,-63.0015"/>
<text text-anchor="middle" x="9141" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_129&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_129&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9197.5622,-866.4528C9199.9142,-780.4306 9206.7926,-407.028 9160,-106.2001 9158.2886,-95.1975 9155.5405,-83.4464 9152.6599,-72.7314"/>
<polygon fill="#000000" stroke="#000000" points="9155.9551,-71.5189 9149.887,-62.834 9149.2146,-73.4074 9155.9551,-71.5189"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9337,-53.1 9283,-53.1 9283,-17.1 9337,-17.1 9337,-53.1"/>
<text text-anchor="middle" x="9310" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_130&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>prespace_130&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9288.4697,-866.5632C9291.2741,-758.2631 9305.8019,-197.2221 9309.2604,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9312.7652,-63.5166 9309.5254,-53.4293 9305.7676,-63.3353 9312.7652,-63.5166"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9413,-53.1 9355,-53.1 9355,-17.1 9413,-17.1 9413,-53.1"/>
<text text-anchor="middle" x="9384" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>literal_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9384,-866.5632C9384,-758.2631 9384,-197.2221 9384,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9387.5001,-63.4293 9384,-53.4293 9380.5001,-63.4293 9387.5001,-63.4293"/>
</g>
<!-- leaf_136 -->
<g id="node137" class="node">
<title>leaf_136</title>
<polygon fill="none" stroke="#c0c0c0" points="9958.5,-62.3005 9431.5,-62.3005 9431.5,-7.8996 9958.5,-7.8996 9958.5,-62.3005"/>
<text text-anchor="middle" x="9695" y="-47.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9695" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9695" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_132&#45;&gt;leaf_136 -->
<g id="edge136" class="edge">
<title>raw_132&#45;&gt;leaf_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9458.2076,-866.4573C9448.2418,-761.1569 9403.3621,-231.4239 9496,-106.2001 9507.0161,-91.309 9540.3028,-77.1033 9576.5773,-65.359"/>
<polygon fill="#000000" stroke="#000000" points="9577.8774,-68.6189 9586.3598,-62.2708 9575.77,-61.9437 9577.8774,-68.6189"/>
</g>
<!-- leaf_138 -->
<g id="node139" class="node">
<title>leaf_138</title>
<polygon fill="none" stroke="#c0c0c0" points="10489.5,-62.4005 9976.5,-62.4005 9976.5,-7.7996 10489.5,-7.7996 10489.5,-62.4005"/>
<text text-anchor="middle" x="10233" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10233" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_137&#45;&gt;leaf_138 -->
<g id="edge138" class="edge">
<title>raw_137&#45;&gt;leaf_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9529.791,-866.4204C9517.3344,-759.7754 9460.1772,-218.8489 9568,-106.2001 9598.7794,-74.0431 9922.7585,-75.1128 9967,-70.2001 9985.0519,-68.1956 10003.7758,-65.9874 10022.5481,-63.684"/>
<polygon fill="#000000" stroke="#000000" points="10023.1752,-67.1333 10032.6707,-62.4336 10022.317,-60.1861 10023.1752,-67.1333"/>
</g>
<!-- leaf_148 -->
<g id="node149" class="node">
<title>leaf_148</title>
<polygon fill="none" stroke="#c0c0c0" points="10376.5,-2022.4033 10185.5,-2022.4033 10185.5,-1986.4033 10376.5,-1986.4033 10376.5,-2022.4033"/>
<text text-anchor="middle" x="10281" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_140&#45;&gt;leaf_148 -->
<g id="edge148" class="edge">
<title>header_140&#45;&gt;leaf_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10362.238,-2393.1994C10348.8283,-2329.0222 10303.2977,-2111.1178 10286.9253,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="10290.2864,-2031.7343 10284.815,-2022.6616 10283.4344,-2033.166 10290.2864,-2031.7343"/>
</g>
<!-- raw_149 -->
<g id="node150" class="node">
<title>raw_149</title>
<ellipse fill="none" stroke="#000000" cx="10422" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="10422" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_149 -->
<g id="edge149" class="edge">
<title>prose_141&#45;&gt;raw_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10581.8667,-2401.3018C10546.7912,-2386.9496 10486.8061,-2356.8026 10458,-2309.6039 10403.6872,-2220.6125 10411.3141,-2089.6557 10417.9674,-2032.6479"/>
<polygon fill="#000000" stroke="#000000" points="10421.4586,-2032.9347 10419.2248,-2022.5781 10414.5126,-2032.0673 10421.4586,-2032.9347"/>
</g>
<!-- prespace_150 -->
<g id="node151" class="node">
<title>prespace_150</title>
<ellipse fill="none" stroke="#000000" cx="10513" cy="-2004.4033" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10513" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_141&#45;&gt;prespace_150 -->
<g id="edge150" class="edge">
<title>prose_141&#45;&gt;prespace_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10600.8497,-2393.5804C10591.8966,-2373.5987 10577.6439,-2339.8615 10569,-2309.6039 10540.4815,-2209.7763 10523.1642,-2087.2836 10516.3457,-2032.828"/>
<polygon fill="#000000" stroke="#000000" points="10519.779,-2032.0701 10515.0857,-2022.5715 10512.8312,-2032.9237 10519.779,-2032.0701"/>
</g>
<!-- literal_151 -->
<g id="node152" class="node">
<title>literal_151</title>
<ellipse fill="none" stroke="#000000" cx="10609" cy="-2004.4033" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10609" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_141&#45;&gt;literal_151 -->
<g id="edge151" class="edge">
<title>prose_141&#45;&gt;literal_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10609,-2393.1994C10609,-2329.0222 10609,-2111.1178 10609,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="10612.5001,-2032.6615 10609,-2022.6616 10605.5001,-2032.6616 10612.5001,-2032.6615"/>
</g>
<!-- raw_152 -->
<g id="node153" class="node">
<title>raw_152</title>
<ellipse fill="none" stroke="#000000" cx="10687" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="10687" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_152 -->
<g id="edge152" class="edge">
<title>prose_141&#45;&gt;raw_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10617.4747,-2393.6681C10626.7185,-2373.7649 10641.2309,-2340.0979 10649,-2309.6039 10674.406,-2209.8845 10683.0958,-2087.3371 10685.8394,-2032.8478"/>
<polygon fill="#000000" stroke="#000000" points="10689.3483,-2032.7391 10686.3253,-2022.5847 10682.3562,-2032.408 10689.3483,-2032.7391"/>
</g>
<!-- raw_157 -->
<g id="node158" class="node">
<title>raw_157</title>
<ellipse fill="none" stroke="#000000" cx="11015" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11015" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_142&#45;&gt;raw_157 -->
<g id="edge157" class="edge">
<title>prose_142&#45;&gt;raw_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11079.9904,-2393.1994C11069.2627,-2329.0222 11032.8382,-2111.1178 11019.7403,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11023.1529,-2031.9476 11018.052,-2022.6616 11016.2487,-2033.1018 11023.1529,-2031.9476"/>
</g>
<!-- raw_159 -->
<g id="node160" class="node">
<title>raw_159</title>
<ellipse fill="none" stroke="#000000" cx="11312" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11312" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_143&#45;&gt;raw_159 -->
<g id="edge159" class="edge">
<title>prose_143&#45;&gt;raw_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11302.4426,-2393.1994C11304.0202,-2329.0222 11309.3767,-2111.1178 11311.3029,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11314.8043,-2032.7446 11311.5512,-2022.6616 11307.8064,-2032.5725 11314.8043,-2032.7446"/>
</g>
<!-- raw_161 -->
<g id="node162" class="node">
<title>raw_161</title>
<ellipse fill="none" stroke="#000000" cx="11394" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11394" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_144&#45;&gt;raw_161 -->
<g id="edge161" class="edge">
<title>prose_144&#45;&gt;raw_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11384.4426,-2393.1994C11386.0202,-2329.0222 11391.3767,-2111.1178 11393.3029,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11396.8043,-2032.7446 11393.5512,-2022.6616 11389.8064,-2032.5725 11396.8043,-2032.7446"/>
</g>
<!-- raw_163 -->
<g id="node164" class="node">
<title>raw_163</title>
<ellipse fill="none" stroke="#000000" cx="11471" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11471" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_145&#45;&gt;raw_163 -->
<g id="edge163" class="edge">
<title>prose_145&#45;&gt;raw_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11466.2213,-2393.1994C11467.0101,-2329.0222 11469.6884,-2111.1178 11470.6515,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11474.1523,-2032.7038 11470.7756,-2022.6616 11467.1529,-2032.6177 11474.1523,-2032.7038"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="11548" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11548" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_146&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_146&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11548,-2393.1994C11548,-2329.0222 11548,-2111.1178 11548,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11551.5001,-2032.6615 11548,-2022.6616 11544.5001,-2032.6616 11551.5001,-2032.6615"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="12148.5,-2309.8046 11593.5,-2309.8046 11593.5,-1699.0021 12148.5,-1699.0021 12148.5,-2309.8046"/>
<text text-anchor="middle" x="11871" y="-2278.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="11871" y="-2263.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="11871" y="-2247.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="11871" y="-2232.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if frag == &quot;&quot; then</text>
<text text-anchor="middle" x="11871" y="-2216.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return collection, false</text>
<text text-anchor="middle" x="11871" y="-2201.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11871" y="-2186.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="11871" y="-2170.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="11871" y="-2155.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="11871" y="-2139.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function addTo(index)</text>
<text text-anchor="middle" x="11871" y="-2124.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11871" y="-2093.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11871" y="-2077.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11871" y="-2062.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11871" y="-2046.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11871" y="-2015.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11871" y="-2000.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11871" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11871" y="-1969.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="11871" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="11871" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="11871" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="11871" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="11871" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="11871" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11871" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11871" y="-1846.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11871" y="-1830.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11871" y="-1815.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11871" y="-1799.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11871" y="-1784.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11871" y="-1769.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11871" y="-1753.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="11871" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="11871" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="11871" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_147&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>codeblock_147&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11783.0718,-2393.1994C11786.7433,-2376.9651 11792.6394,-2350.8938 11799.6866,-2319.7329"/>
<polygon fill="#000000" stroke="#000000" points="11803.1173,-2320.4299 11801.9095,-2309.9041 11796.2898,-2318.8857 11803.1173,-2320.4299"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="10467,-912.6029 10101,-912.6029 10101,-856.7999 10467,-856.7999 10467,-912.6029"/>
<text text-anchor="middle" x="10284" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_149&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>raw_149&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10419.807,-1986.1689C10414.1088,-1938.8207 10398.3491,-1808.0713 10385,-1699.2027 10348.2975,-1399.8757 10303.2494,-1038.7767 10288.7403,-922.6279"/>
<polygon fill="#000000" stroke="#000000" points="10292.1847,-921.9644 10287.4719,-912.4754 10285.2387,-922.8322 10292.1847,-921.9644"/>
</g>
<!-- leaf_154 -->
<g id="node155" class="node">
<title>leaf_154</title>
<polygon fill="none" stroke="#c0c0c0" points="10539,-902.7014 10485,-902.7014 10485,-866.7014 10539,-866.7014 10539,-902.7014"/>
<text text-anchor="middle" x="10512" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_150&#45;&gt;leaf_154 -->
<g id="edge154" class="edge">
<title>prespace_150&#45;&gt;leaf_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10512.9839,-1986.3619C10512.8685,-1857.1254 10512.1679,-1072.7313 10512.0253,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="10515.5254,-913.0528 10512.0164,-903.0559 10508.5254,-913.0591 10515.5254,-913.0528"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="10643,-902.7014 10557,-902.7014 10557,-866.7014 10643,-866.7014 10643,-902.7014"/>
<text text-anchor="middle" x="10600" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_151&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>literal_151&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10608.855,-1986.3619C10607.8162,-1857.1254 10601.5114,-1072.7313 10600.2279,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="10603.7279,-913.0274 10600.1475,-903.0559 10596.7281,-913.0838 10603.7279,-913.0274"/>
</g>
<!-- leaf_156 -->
<g id="node157" class="node">
<title>leaf_156</title>
<polygon fill="none" stroke="#c0c0c0" points="10715,-902.7014 10661,-902.7014 10661,-866.7014 10715,-866.7014 10715,-902.7014"/>
<text text-anchor="middle" x="10688" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_152&#45;&gt;leaf_156 -->
<g id="edge156" class="edge">
<title>raw_152&#45;&gt;leaf_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10687.0161,-1986.3619C10687.1315,-1857.1254 10687.8321,-1072.7313 10687.9747,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="10691.4746,-913.0591 10687.9836,-903.0559 10684.4746,-913.0528 10691.4746,-913.0591"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11246.5,-904.6035 10733.5,-904.6035 10733.5,-864.7993 11246.5,-864.7993 11246.5,-904.6035"/>
<text text-anchor="middle" x="10990" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_157&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>raw_157&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11014.5972,-1986.3619C11011.724,-1857.6754 10994.347,-1079.3951 10990.6794,-915.1297"/>
<polygon fill="#000000" stroke="#000000" points="10994.1711,-914.7139 10990.4486,-904.7945 10987.1728,-914.8702 10994.1711,-914.7139"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11427.5,-904.6035 11264.5,-904.6035 11264.5,-864.7993 11427.5,-864.7993 11427.5,-904.6035"/>
<text text-anchor="middle" x="11346" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_159&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_159&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11312.5478,-1986.3619C11316.4554,-1857.6754 11340.0881,-1079.3951 11345.076,-915.1297"/>
<polygon fill="#000000" stroke="#000000" points="11348.5847,-914.8962 11345.3899,-904.7945 11341.5879,-914.6836 11348.5847,-914.8962"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="11972.5,-919.9018 11445.5,-919.9018 11445.5,-849.501 11972.5,-849.501 11972.5,-919.9018"/>
<text text-anchor="middle" x="11709" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11709" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11709" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_161&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>raw_161&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11395.2198,-1986.2982C11398.6848,-1938.7238 11409.997,-1806.4591 11435,-1699.2027 11505.1604,-1398.2327 11641.1721,-1051.0548 11690.5342,-929.4949"/>
<polygon fill="#000000" stroke="#000000" points="11693.8216,-930.7023 11694.3509,-920.1207 11687.3383,-928.0626 11693.8216,-930.7023"/>
</g>
<!-- leaf_164 -->
<g id="node165" class="node">
<title>leaf_164</title>
<polygon fill="none" stroke="#c0c0c0" points="12419.5,-904.6035 11990.5,-904.6035 11990.5,-864.7993 12419.5,-864.7993 12419.5,-904.6035"/>
<text text-anchor="middle" x="12205" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection</text>
</g>
<!-- raw_163&#45;&gt;leaf_164 -->
<g id="edge164" class="edge">
<title>raw_163&#45;&gt;leaf_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11466.7537,-1986.608C11455.3179,-1933.7697 11429.9968,-1776.6656 11512,-1699.2027 11587.9867,-1627.4233 11899.9597,-1729.2236 11981,-1663.2027 12221.0208,-1467.6657 12213.8881,-1032.7915 12207.1763,-914.7572"/>
<polygon fill="#000000" stroke="#000000" points="12210.6619,-914.413 12206.5565,-904.6459 12203.675,-914.8414 12210.6619,-914.413"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="12944,-912.0018 12438,-912.0018 12438,-857.401 12944,-857.401 12944,-912.0018"/>
<text text-anchor="middle" x="12691" y="-880.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="12691" y="-865.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_165&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_165&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11543.2963,-1986.5254C11530.5317,-1933.4564 11501.4766,-1775.7745 11584,-1699.2027 11652.806,-1635.3591 12352.9273,-1719.5443 12428,-1663.2027 12674.3791,-1478.2968 12692.2403,-1051.4528 12691.7955,-922.3598"/>
<polygon fill="#000000" stroke="#000000" points="12695.2942,-922.1638 12691.7192,-912.1903 12688.2944,-922.2163 12695.2942,-922.1638"/>
</g>
<!-- leaf_174 -->
<g id="node175" class="node">
<title>leaf_174</title>
<polygon fill="none" stroke="#c0c0c0" points="12863.5,-2022.4033 12714.5,-2022.4033 12714.5,-1986.4033 12863.5,-1986.4033 12863.5,-2022.4033"/>
<text text-anchor="middle" x="12789" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_168&#45;&gt;leaf_174 -->
<g id="edge174" class="edge">
<title>header_168&#45;&gt;leaf_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12809.0706,-2393.1994C12805.7576,-2329.0222 12794.5088,-2111.1178 12790.4639,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="12793.9535,-2032.4678 12789.9425,-2022.6616 12786.9628,-2032.8287 12793.9535,-2032.4678"/>
</g>
<!-- raw_175 -->
<g id="node176" class="node">
<title>raw_175</title>
<ellipse fill="none" stroke="#000000" cx="12909" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="12909" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_169&#45;&gt;raw_175 -->
<g id="edge175" class="edge">
<title>prose_169&#45;&gt;raw_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12976.4888,-2393.6773C12967.2122,-2373.7824 12952.6706,-2340.1228 12945,-2309.6039 12919.9358,-2209.8811 12912.2067,-2087.3354 12909.9171,-2032.8472"/>
<polygon fill="#000000" stroke="#000000" points="12913.404,-2032.4405 12909.5174,-2022.5843 12906.4093,-2032.7129 12913.404,-2032.4405"/>
</g>
<!-- leaf_177 -->
<g id="node178" class="node">
<title>leaf_177</title>
<polygon fill="none" stroke="#c0c0c0" points="13334,-2105.7836 12954,-2105.7836 12954,-1903.023 13334,-1903.023 13334,-2105.7836"/>
<text text-anchor="middle" x="13144" y="-2090.6435" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="13144" y="-2075.2434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13144" y="-2059.8434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13144" y="-2044.4434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13144" y="-2029.0433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="13144" y="-2010.2833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; ]</text>
<text text-anchor="middle" x="13144" y="-1991.5233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="13144" y="-1976.1233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13144" y="-1960.7233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; </text>
<text text-anchor="middle" x="13144" y="-1941.9633" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13144" y="-1926.5632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="13144" y="-1911.1632" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_170&#45;&gt;leaf_177 -->
<g id="edge177" class="edge">
<title>codeblock_170&#45;&gt;leaf_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13144,-2393.1994C13144,-2345.6018 13144,-2213.4454 13144,-2116.3733"/>
<polygon fill="#000000" stroke="#000000" points="13147.5001,-2116.2044 13144,-2106.2045 13140.5001,-2116.2045 13147.5001,-2116.2044"/>
</g>
<!-- header_178 -->
<g id="node179" class="node">
<title>header_178</title>
<ellipse fill="none" stroke="#000000" cx="13434" cy="-2004.4033" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="13434" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_171&#45;&gt;header_178 -->
<g id="edge178" class="edge">
<title>section_171&#45;&gt;header_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13559.0881,-2393.0403C13550.4346,-2372.8595 13536.4121,-2339.211 13526,-2309.6039 13490.5424,-2208.7793 13456.2246,-2086.3847 13441.5062,-2032.3451"/>
<polygon fill="#000000" stroke="#000000" points="13444.825,-2031.2103 13438.8293,-2022.4752 13438.069,-2033.0427 13444.825,-2031.2103"/>
</g>
<!-- prose_179 -->
<g id="node180" class="node">
<title>prose_179</title>
<ellipse fill="none" stroke="#000000" cx="13567" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13567" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_179 -->
<g id="edge179" class="edge">
<title>section_171&#45;&gt;prose_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13567,-2393.1994C13567,-2329.0222 13567,-2111.1178 13567,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="13570.5001,-2032.6615 13567,-2022.6616 13563.5001,-2032.6616 13570.5001,-2032.6615"/>
</g>
<!-- prose_180 -->
<g id="node181" class="node">
<title>prose_180</title>
<ellipse fill="none" stroke="#000000" cx="13649" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13649" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_180 -->
<g id="edge180" class="edge">
<title>section_171&#45;&gt;prose_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13575.8171,-2393.3187C13585.263,-2373.3815 13599.9757,-2339.9453 13608,-2309.6039 13634.3433,-2209.9947 13644.2594,-2087.3916 13647.5519,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="13651.0625,-2032.7823 13648.1413,-2022.5982 13644.074,-2032.3812 13651.0625,-2032.7823"/>
</g>
<!-- codeblock_181 -->
<g id="node182" class="node">
<title>codeblock_181</title>
<ellipse fill="none" stroke="#000000" cx="13838" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13838" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 458&#45;482</text>
</g>
<!-- section_171&#45;&gt;codeblock_181 -->
<g id="edge181" class="edge">
<title>section_171&#45;&gt;codeblock_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13593.6106,-2394.2702C13620.6455,-2376.0067 13662.3648,-2344.777 13690,-2309.6039 13761.2391,-2218.9331 13810.0867,-2088.4083 13829.1177,-2032.0454"/>
<polygon fill="#000000" stroke="#000000" points="13832.4873,-2033.0042 13832.3229,-2022.4106 13825.8452,-2030.7945 13832.4873,-2033.0042"/>
</g>
<!-- header_194 -->
<g id="node195" class="node">
<title>header_194</title>
<ellipse fill="none" stroke="#000000" cx="14200" cy="-2004.4033" rx="111.1981" ry="18"/>
<text text-anchor="middle" x="14200" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:index(cursor)</text>
</g>
<!-- section_172&#45;&gt;header_194 -->
<g id="edge194" class="edge">
<title>section_172&#45;&gt;header_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14277.415,-2393.1994C14264.6364,-2329.0222 14221.2484,-2111.1178 14205.6465,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="14209.021,-2031.7855 14203.6355,-2022.6616 14202.1558,-2033.1525 14209.021,-2031.7855"/>
</g>
<!-- prose_195 -->
<g id="node196" class="node">
<title>prose_195</title>
<ellipse fill="none" stroke="#000000" cx="14362" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14362" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_195 -->
<g id="edge195" class="edge">
<title>section_172&#45;&gt;prose_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14289.338,-2393.2624C14298.2802,-2373.276 14312.2379,-2339.7968 14320,-2309.6039 14345.6653,-2209.7713 14356.4909,-2087.2812 14360.2746,-2032.8271"/>
<polygon fill="#000000" stroke="#000000" points="14363.7853,-2032.7817 14360.9588,-2022.5709 14356.8008,-2032.3157 14363.7853,-2032.7817"/>
</g>
<!-- codeblock_196 -->
<g id="node197" class="node">
<title>codeblock_196</title>
<ellipse fill="none" stroke="#000000" cx="14547" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14547" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 489&#45;502</text>
</g>
<!-- section_172&#45;&gt;codeblock_196 -->
<g id="edge196" class="edge">
<title>section_172&#45;&gt;codeblock_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14307.7122,-2394.113C14334.5885,-2375.8364 14375.8401,-2344.6992 14403,-2309.6039 14473.2127,-2218.8768 14520.2638,-2088.3818 14538.5069,-2032.0361"/>
<polygon fill="#000000" stroke="#000000" points="14541.8747,-2032.995 14541.5771,-2022.4043 14535.2053,-2030.869 14541.8747,-2032.995"/>
</g>
<!-- header_201 -->
<g id="node202" class="node">
<title>header_201</title>
<ellipse fill="none" stroke="#000000" cx="14970" cy="-2004.4033" rx="184.6938" ry="18"/>
<text text-anchor="middle" x="14970" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append(txtbuf, results, success)</text>
</g>
<!-- section_173&#45;&gt;header_201 -->
<g id="edge201" class="edge">
<title>section_173&#45;&gt;header_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15261.9264,-2394.1196C15235.5758,-2375.3825 15193.8808,-2343.4466 15164,-2309.6039 15082.6572,-2217.4759 15012.2839,-2087.7953 14983.6634,-2031.8548"/>
<polygon fill="#000000" stroke="#000000" points="14986.6132,-2029.9333 14978.9664,-2022.6001 14980.3712,-2033.1014 14986.6132,-2029.9333"/>
</g>
<!-- prose_202 -->
<g id="node203" class="node">
<title>prose_202</title>
<ellipse fill="none" stroke="#000000" cx="15205" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15205" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_173&#45;&gt;prose_202 -->
<g id="edge202" class="edge">
<title>section_173&#45;&gt;prose_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15278.1829,-2393.3187C15268.737,-2373.3815 15254.0243,-2339.9453 15246,-2309.6039 15219.6567,-2209.9947 15209.7406,-2087.3916 15206.4481,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="15209.926,-2032.3812 15205.8587,-2022.5982 15202.9375,-2032.7823 15209.926,-2032.3812"/>
</g>
<!-- prose_203 -->
<g id="node204" class="node">
<title>prose_203</title>
<ellipse fill="none" stroke="#000000" cx="15287" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15287" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_173&#45;&gt;prose_203 -->
<g id="edge203" class="edge">
<title>section_173&#45;&gt;prose_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15287,-2393.1994C15287,-2329.0222 15287,-2111.1178 15287,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="15290.5001,-2032.6615 15287,-2022.6616 15283.5001,-2032.6616 15290.5001,-2032.6615"/>
</g>
<!-- codeblock_204 -->
<g id="node205" class="node">
<title>codeblock_204</title>
<ellipse fill="none" stroke="#000000" cx="15476" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15476" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 510&#45;524</text>
</g>
<!-- section_173&#45;&gt;codeblock_204 -->
<g id="edge204" class="edge">
<title>section_173&#45;&gt;codeblock_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15295.365,-2393.1994C15325.3037,-2328.7597 15427.2497,-2109.3327 15463.2683,-2031.8069"/>
<polygon fill="#000000" stroke="#000000" points="15466.4778,-2033.2053 15467.5172,-2022.6616 15460.1295,-2030.2558 15466.4778,-2033.2053"/>
</g>
<!-- codeblock_205 -->
<g id="node206" class="node">
<title>codeblock_205</title>
<ellipse fill="none" stroke="#000000" cx="15761" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15761" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 526&#45;533</text>
</g>
<!-- section_173&#45;&gt;codeblock_205 -->
<g id="edge205" class="edge">
<title>section_173&#45;&gt;codeblock_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15350.1742,-2401.2185C15412.2267,-2388.7317 15506.8196,-2362.2469 15572,-2309.6039 15668.25,-2231.8674 15728.876,-2091.1679 15751.2499,-2031.8998"/>
<polygon fill="#000000" stroke="#000000" points="15754.5553,-2033.0522 15754.7484,-2022.4592 15747.9915,-2030.6198 15754.5553,-2033.0522"/>
</g>
<!-- codeblock_206 -->
<g id="node207" class="node">
<title>codeblock_206</title>
<ellipse fill="none" stroke="#000000" cx="16051" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="16051" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 535&#45;537</text>
</g>
<!-- section_173&#45;&gt;codeblock_206 -->
<g id="edge206" class="edge">
<title>section_173&#45;&gt;codeblock_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15358.9313,-2405.5853C15493.3684,-2393.9319 15776.425,-2363.61 15857,-2309.6039 15961.0257,-2239.8798 16020.7201,-2093.5291 16042.0137,-2032.2853"/>
<polygon fill="#000000" stroke="#000000" points="16045.421,-2033.1364 16045.3249,-2022.542 16038.7933,-2030.884 16045.421,-2033.1364"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="13016,-902.7014 12962,-902.7014 12962,-866.7014 13016,-866.7014 13016,-902.7014"/>
</g>
<!-- raw_175&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>raw_175&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12910.4797,-1986.4246C12914.5086,-1939.155 12926.6177,-1807.5629 12945,-1699.2027 12947.7413,-1683.0433 12950.8356,-1679.4495 12953,-1663.2027 12991.7871,-1372.0504 12990.6789,-1014.8637 12989.446,-913.0102"/>
<polygon fill="#000000" stroke="#000000" points="12992.9444,-912.8619 12989.3126,-902.909 12985.945,-912.9544 12992.9444,-912.8619"/>
</g>
<!-- leaf_182 -->
<g id="node183" class="node">
<title>leaf_182</title>
<polygon fill="none" stroke="#c0c0c0" points="13269,-902.7014 13113,-902.7014 13113,-866.7014 13269,-866.7014 13269,-902.7014"/>
<text text-anchor="middle" x="13191" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_178&#45;&gt;leaf_182 -->
<g id="edge182" class="edge">
<title>header_178&#45;&gt;leaf_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13433.2265,-1986.0584C13430.1766,-1934.9878 13415.2545,-1789.0323 13343,-1699.2027 13322.302,-1673.4702 13296.3223,-1690.6775 13278,-1663.2027 13112.5877,-1415.1626 13166.6738,-1021.0527 13185.6287,-912.931"/>
<polygon fill="#000000" stroke="#000000" points="13189.1216,-913.2823 13187.447,-902.8206 13182.2321,-912.0432 13189.1216,-913.2823"/>
</g>
<!-- raw_183 -->
<g id="node184" class="node">
<title>raw_183</title>
<ellipse fill="none" stroke="#000000" cx="13314" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13314" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_183 -->
<g id="edge183" class="edge">
<title>prose_179&#45;&gt;raw_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13570.8536,-1986.3252C13580.8455,-1934.0463 13601.7531,-1781.2069 13525,-1699.2027 13470.738,-1641.2284 13401.5826,-1723.5734 13350,-1663.2027 13251.5735,-1548.0074 13297.8163,-1038.4869 13310.9277,-912.799"/>
<polygon fill="#000000" stroke="#000000" points="13314.4132,-913.1195 13311.9853,-902.8067 13307.4521,-912.3827 13314.4132,-913.1195"/>
</g>
<!-- prespace_184 -->
<g id="node185" class="node">
<title>prespace_184</title>
<ellipse fill="none" stroke="#000000" cx="13405" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13405" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_179&#45;&gt;prespace_184 -->
<g id="edge184" class="edge">
<title>prose_179&#45;&gt;prespace_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13569.6792,-1986.3023C13576.1442,-1935.8643 13587.7447,-1791.3941 13525,-1699.2027 13506.6377,-1672.2229 13478.4766,-1690.7646 13461,-1663.2027 13301.9237,-1412.3288 13374.2268,-1020.2385 13398.2853,-912.7555"/>
<polygon fill="#000000" stroke="#000000" points="13401.7661,-913.2343 13400.582,-902.7058 13394.942,-911.6747 13401.7661,-913.2343"/>
</g>
<!-- literal_185 -->
<g id="node186" class="node">
<title>literal_185</title>
<ellipse fill="none" stroke="#000000" cx="13501" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13501" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_179&#45;&gt;literal_185 -->
<g id="edge185" class="edge">
<title>prose_179&#45;&gt;literal_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13565.4611,-1986.2895C13561.1725,-1935.4052 13548.8843,-1786.8171 13541,-1663.2027 13522.2992,-1370.0005 13506.5506,-1014.2406 13502.1952,-912.8682"/>
<polygon fill="#000000" stroke="#000000" points="13505.6895,-912.6567 13501.7649,-902.8155 13498.6959,-912.9561 13505.6895,-912.6567"/>
</g>
<!-- raw_186 -->
<g id="node187" class="node">
<title>raw_186</title>
<ellipse fill="none" stroke="#000000" cx="13577" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13577" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_186 -->
<g id="edge186" class="edge">
<title>prose_179&#45;&gt;raw_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13567.1611,-1986.3619C13568.3153,-1857.1254 13575.3207,-1072.7313 13576.7468,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="13580.2465,-913.0868 13576.8361,-903.0559 13573.2468,-913.0242 13580.2465,-913.0868"/>
</g>
<!-- raw_191 -->
<g id="node192" class="node">
<title>raw_191</title>
<ellipse fill="none" stroke="#000000" cx="13649" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13649" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_180&#45;&gt;raw_191 -->
<g id="edge191" class="edge">
<title>prose_180&#45;&gt;raw_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13649,-1986.3619C13649,-1857.1254 13649,-1072.7313 13649,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="13652.5001,-913.0559 13649,-903.0559 13645.5001,-913.056 13652.5001,-913.0559"/>
</g>
<!-- leaf_193 -->
<g id="node194" class="node">
<title>leaf_193</title>
<polygon fill="none" stroke="#c0c0c0" points="14082.4016,-1072.3422 13693.5984,-1072.3422 13693.5984,-697.0606 14082.4016,-697.0606 14082.4016,-1072.3422"/>
<text text-anchor="middle" x="13888" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="13888" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="13888" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13888" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13888" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + ]</text>
<text text-anchor="middle" x="13888" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13888" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13888" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="13888" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13888" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13888" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13888" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + </text>
<text text-anchor="middle" x="13888" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13888" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not ( &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="13888" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="13888" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="13888" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="13888" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="13888" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_181&#45;&gt;leaf_193 -->
<g id="edge193" class="edge">
<title>codeblock_181&#45;&gt;leaf_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13838.8056,-1986.3619C13843.3739,-1884.0605 13866.274,-1371.2351 13879.1577,-1082.716"/>
<polygon fill="#000000" stroke="#000000" points="13882.6621,-1082.6944 13879.6118,-1072.5482 13875.669,-1082.3821 13882.6621,-1082.6944"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="13355.5,-63.0015 12884.5,-63.0015 12884.5,-7.1986 13355.5,-7.1986 13355.5,-63.0015"/>
<text text-anchor="middle" x="13120" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_183&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>raw_183&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13315.6387,-866.5663C13324.7397,-761.8793 13365.5753,-235.0153 13278,-106.2001 13266.9829,-89.995 13251.3415,-77.4332 13234.1428,-67.7099"/>
<polygon fill="#000000" stroke="#000000" points="13235.4984,-64.4674 13225.0232,-62.8797 13232.222,-70.6533 13235.4984,-64.4674"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13428,-53.1 13374,-53.1 13374,-17.1 13428,-17.1 13428,-53.1"/>
</g>
<!-- prespace_184&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>prespace_184&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13404.9146,-866.5632C13404.4047,-758.2631 13401.7633,-197.2221 13401.1345,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13404.6334,-63.4127 13401.0863,-53.4293 13397.6335,-63.4457 13404.6334,-63.4127"/>
</g>
<!-- leaf_189 -->
<g id="node190" class="node">
<title>leaf_189</title>
<polygon fill="none" stroke="#c0c0c0" points="13546,-53.1 13446,-53.1 13446,-17.1 13546,-17.1 13546,-53.1"/>
<text text-anchor="middle" x="13496" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_185&#45;&gt;leaf_189 -->
<g id="edge189" class="edge">
<title>literal_185&#45;&gt;leaf_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13500.8933,-866.5632C13500.2559,-758.2631 13496.9541,-197.2221 13496.1681,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13499.6668,-63.4085 13496.1079,-53.4293 13492.6669,-63.4497 13499.6668,-63.4085"/>
</g>
<!-- leaf_190 -->
<g id="node191" class="node">
<title>leaf_190</title>
<polygon fill="none" stroke="#c0c0c0" points="13804,-53.1 13564,-53.1 13564,-17.1 13804,-17.1 13804,-53.1"/>
<text text-anchor="middle" x="13684" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_186&#45;&gt;leaf_190 -->
<g id="edge190" class="edge">
<title>raw_186&#45;&gt;leaf_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13576.0953,-866.6473C13571.1851,-763.5154 13550.2009,-248.5602 13613,-106.2001 13621.0197,-88.0201 13635.9591,-71.9421 13650.0727,-59.6949"/>
<polygon fill="#000000" stroke="#000000" points="13652.3216,-62.3768 13657.7795,-53.2959 13647.85,-56.9913 13652.3216,-62.3768"/>
</g>
<!-- leaf_192 -->
<g id="node193" class="node">
<title>leaf_192</title>
<polygon fill="none" stroke="#c0c0c0" points="14209.5,-55.0021 13822.5,-55.0021 13822.5,-15.198 14209.5,-15.198 14209.5,-55.0021"/>
<text text-anchor="middle" x="14016" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_191&#45;&gt;leaf_192 -->
<g id="edge192" class="edge">
<title>raw_191&#45;&gt;leaf_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13647.0006,-866.6093C13635.7377,-761.0392 13584.2217,-225.1927 13685,-106.2001 13692.1927,-97.7074 13806.7674,-74.3708 13899.1254,-56.7308"/>
<polygon fill="#000000" stroke="#000000" points="13899.9578,-60.1353 13909.1264,-54.8262 13898.6482,-53.2588 13899.9578,-60.1353"/>
</g>
<!-- leaf_197 -->
<g id="node198" class="node">
<title>leaf_197</title>
<polygon fill="none" stroke="#c0c0c0" points="14305.5,-902.7014 14100.5,-902.7014 14100.5,-866.7014 14305.5,-866.7014 14305.5,-902.7014"/>
<text text-anchor="middle" x="14203" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:index(cursor)</text>
</g>
<!-- header_194&#45;&gt;leaf_197 -->
<g id="edge197" class="edge">
<title>header_194&#45;&gt;leaf_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14200.0483,-1986.3619C14200.3946,-1857.1254 14202.4962,-1072.7313 14202.924,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="14206.4239,-913.0653 14202.9508,-903.0559 14199.4239,-913.0465 14206.4239,-913.0653"/>
</g>
<!-- raw_198 -->
<g id="node199" class="node">
<title>raw_198</title>
<ellipse fill="none" stroke="#000000" cx="14358" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14358" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_195&#45;&gt;raw_198 -->
<g id="edge198" class="edge">
<title>prose_195&#45;&gt;raw_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14361.9355,-1986.3619C14361.4739,-1857.1254 14358.6717,-1072.7313 14358.1013,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="14361.6014,-913.0433 14358.0656,-903.0559 14354.6014,-913.0684 14361.6014,-913.0433"/>
</g>
<!-- leaf_200 -->
<g id="node201" class="node">
<title>leaf_200</title>
<polygon fill="none" stroke="#c0c0c0" points="14783,-981.0019 14403,-981.0019 14403,-788.4009 14783,-788.4009 14783,-981.0019"/>
<text text-anchor="middle" x="14593" y="-965.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.index(historian, cursor)</text>
<text text-anchor="middle" x="14593" y="-950.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if cursor &lt; 0 or cursor &gt; #historian + 1 then</text>
<text text-anchor="middle" x="14593" y="-935.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="14593" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14593" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[cursor]</text>
<text text-anchor="middle" x="14593" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="14593" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf = txtbuf:clone()</text>
<text text-anchor="middle" x="14593" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = cursor</text>
<text text-anchor="middle" x="14593" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="14593" y="-827.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="14593" y="-811.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf, result</text>
<text text-anchor="middle" x="14593" y="-796.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_196&#45;&gt;leaf_200 -->
<g id="edge200" class="edge">
<title>codeblock_196&#45;&gt;leaf_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14547.7412,-1986.3619C14552.4372,-1872.0552 14578.1891,-1245.2187 14588.6152,-991.4338"/>
<polygon fill="#000000" stroke="#000000" points="14592.1263,-991.233 14589.0398,-981.0977 14585.1322,-990.9456 14592.1263,-991.233"/>
</g>
<!-- leaf_199 -->
<g id="node200" class="node">
<title>leaf_199</title>
<polygon fill="none" stroke="#c0c0c0" points="14496,-63.0015 14228,-63.0015 14228,-7.1986 14496,-7.1986 14496,-63.0015"/>
<text text-anchor="middle" x="14362" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Loads the history to an exact index.</text>
</g>
<!-- raw_198&#45;&gt;leaf_199 -->
<g id="edge199" class="edge">
<title>raw_198&#45;&gt;leaf_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14358.0854,-866.5632C14358.5841,-760.6464 14361.1215,-221.6953 14361.8211,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="14365.3211,-73.0922 14361.8683,-63.0758 14358.3211,-73.0592 14365.3211,-73.0922"/>
</g>
<!-- leaf_207 -->
<g id="node208" class="node">
<title>leaf_207</title>
<polygon fill="none" stroke="#c0c0c0" points="15139,-902.7014 14801,-902.7014 14801,-866.7014 15139,-866.7014 15139,-902.7014"/>
<text text-anchor="middle" x="14970" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append(txtbuf, results, success)</text>
</g>
<!-- header_201&#45;&gt;leaf_207 -->
<g id="edge207" class="edge">
<title>header_201&#45;&gt;leaf_207</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14970,-1986.3619C14970,-1857.1254 14970,-1072.7313 14970,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="14973.5001,-913.0559 14970,-903.0559 14966.5001,-913.056 14973.5001,-913.0559"/>
</g>
<!-- raw_208 -->
<g id="node209" class="node">
<title>raw_208</title>
<ellipse fill="none" stroke="#000000" cx="15184" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15184" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_202&#45;&gt;raw_208 -->
<g id="edge208" class="edge">
<title>prose_202&#45;&gt;raw_208</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15204.6616,-1986.3619C15202.2378,-1857.1254 15187.5265,-1072.7313 15184.5318,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="15188.0312,-912.9885 15184.3442,-903.0559 15181.0325,-913.1198 15188.0312,-912.9885"/>
</g>
<!-- raw_210 -->
<g id="node211" class="node">
<title>raw_210</title>
<ellipse fill="none" stroke="#000000" cx="15256" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15256" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_203&#45;&gt;raw_210 -->
<g id="edge210" class="edge">
<title>prose_203&#45;&gt;raw_210</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15286.5005,-1986.3619C15282.9225,-1857.1254 15261.2058,-1072.7313 15256.7851,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="15260.2837,-912.9552 15256.5082,-903.0559 15253.2864,-913.149 15260.2837,-912.9552"/>
</g>
<!-- leaf_212 -->
<g id="node213" class="node">
<title>leaf_212</title>
<polygon fill="none" stroke="#c0c0c0" points="15751,-988.9019 15301,-988.9019 15301,-780.5009 15751,-780.5009 15751,-988.9019"/>
<text text-anchor="middle" x="15526" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="15526" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="15526" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="15526" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="15526" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15526" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="15526" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="15526" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="15526" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="15526" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="15526" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15526" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="15526" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_204&#45;&gt;leaf_212 -->
<g id="edge212" class="edge">
<title>codeblock_204&#45;&gt;leaf_212</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15476.8056,-1986.3619C15481.8598,-1873.1783 15509.3533,-1257.4873 15520.8951,-999.0218"/>
<polygon fill="#000000" stroke="#000000" points="15524.3993,-999.0022 15521.349,-988.856 15517.4063,-998.6899 15524.3993,-999.0022"/>
</g>
<!-- leaf_213 -->
<g id="node214" class="node">
<title>leaf_213</title>
<polygon fill="none" stroke="#c0c0c0" points="16037,-935.1024 15769,-935.1024 15769,-834.3004 16037,-834.3004 16037,-935.1024"/>
<text text-anchor="middle" x="15903" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="15903" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="15903" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="15903" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="15903" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15903" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_205&#45;&gt;leaf_213 -->
<g id="edge213" class="edge">
<title>codeblock_205&#45;&gt;leaf_213</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15763.288,-1986.3619C15778.7663,-1864.3122 15868.3475,-1157.9445 15895.3186,-945.271"/>
<polygon fill="#000000" stroke="#000000" points="15898.8067,-945.585 15896.5927,-935.2241 15891.8624,-944.7042 15898.8067,-945.585"/>
</g>
<!-- leaf_214 -->
<g id="node215" class="node">
<title>leaf_214</title>
<polygon fill="none" stroke="#c0c0c0" points="16141,-902.7014 16055,-902.7014 16055,-866.7014 16141,-866.7014 16141,-902.7014"/>
<text text-anchor="middle" x="16098" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_206&#45;&gt;leaf_214 -->
<g id="edge214" class="edge">
<title>codeblock_206&#45;&gt;leaf_214</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16051.7573,-1986.3619C16057.1821,-1857.1254 16090.1074,-1072.7313 16096.8097,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="16100.307,-913.194 16097.2296,-903.0559 16093.3132,-912.9003 16100.307,-913.194"/>
</g>
<!-- leaf_209 -->
<g id="node210" class="node">
<title>leaf_209</title>
<polygon fill="none" stroke="#c0c0c0" points="15242,-63.0015 14918,-63.0015 14918,-7.1986 15242,-7.1986 15242,-63.0015"/>
<text text-anchor="middle" x="15080" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_208&#45;&gt;leaf_209 -->
<g id="edge209" class="edge">
<title>raw_208&#45;&gt;leaf_209</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15187.5926,-866.7142C15204.2729,-778.8103 15268.3882,-387.2839 15148,-106.2001 15142.3182,-92.9341 15132.9795,-80.6799 15123.0169,-70.2146"/>
<polygon fill="#000000" stroke="#000000" points="15125.2505,-67.4994 15115.6956,-62.9216 15120.3103,-72.4587 15125.2505,-67.4994"/>
</g>
<!-- leaf_211 -->
<g id="node212" class="node">
<title>leaf_211</title>
<polygon fill="none" stroke="#c0c0c0" points="15458,-55.0021 15260,-55.0021 15260,-15.198 15458,-15.198 15458,-55.0021"/>
<text text-anchor="middle" x="15359" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_210&#45;&gt;leaf_211 -->
<g id="edge211" class="edge">
<title>raw_210&#45;&gt;leaf_211</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15252.4503,-866.7324C15235.971,-778.9142 15172.6522,-387.7273 15292,-106.2001 15299.194,-89.2303 15312.3537,-73.8557 15325.1178,-61.7798"/>
<polygon fill="#000000" stroke="#000000" points="15327.4731,-64.3688 15332.5394,-55.0638 15322.7762,-59.1785 15327.4731,-64.3688"/>
</g>
</g>
</svg>
