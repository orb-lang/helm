<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="6399pt" height="1337pt"
 viewBox="0.00 0.00 6399.30 1336.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1332.6018)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1332.6018 6395.2972,-1332.6018 6395.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1310.6018" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1433" y="-1306.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 206</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1238.6018" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1433" y="-1234.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;131</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1433,-1292.4332C1433,-1284.7328 1433,-1275.5762 1433,-1267.0185"/>
<polygon fill="#000000" stroke="#000000" points="1436.5001,-1267.0151 1433,-1257.0151 1429.5001,-1267.0151 1436.5001,-1267.0151"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1079" cy="-1166.6018" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1079" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1376.6436,-1229.3101C1318.582,-1219.4305 1225.5848,-1202.7515 1146,-1184.6018 1141.3285,-1183.5365 1136.491,-1182.3676 1131.6518,-1181.153"/>
<polygon fill="#000000" stroke="#000000" points="1132.3256,-1177.7125 1121.7692,-1178.6144 1130.5839,-1184.4924 1132.3256,-1177.7125"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1187" cy="-1166.6018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1187" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1381.3638,-1227.3593C1339.5034,-1217.6844 1279.2574,-1202.4816 1228,-1184.6018 1225.7705,-1183.8241 1223.4928,-1182.9775 1221.2098,-1182.0894"/>
<polygon fill="#000000" stroke="#000000" points="1222.4846,-1178.8294 1211.9043,-1178.2742 1219.8291,-1185.3062 1222.4846,-1178.8294"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1269" cy="-1166.6018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1269" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1398.2198,-1223.3325C1370.38,-1211.1101 1331.5246,-1194.0517 1303.7047,-1181.8381"/>
<polygon fill="#000000" stroke="#000000" points="1304.9243,-1178.5511 1294.3609,-1177.7359 1302.1103,-1184.9606 1304.9243,-1178.5511"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1351" cy="-1166.6018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1351" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1413.1501,-1221.1726C1402.0588,-1211.434 1388.1239,-1199.1984 1376.2613,-1188.7825"/>
<polygon fill="#000000" stroke="#000000" points="1378.264,-1185.8832 1368.4403,-1181.9152 1373.6454,-1191.1433 1378.264,-1185.8832"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1166.6018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1433" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1433,-1220.4332C1433,-1212.7328 1433,-1203.5762 1433,-1195.0185"/>
<polygon fill="#000000" stroke="#000000" points="1436.5001,-1195.0151 1433,-1185.0151 1429.5001,-1195.0151 1436.5001,-1195.0151"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1603" cy="-1166.6018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1603" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;20</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1469.0526,-1223.3325C1494.4235,-1212.5872 1528.6201,-1198.1039 1556.11,-1186.4611"/>
<polygon fill="#000000" stroke="#000000" points="1557.6852,-1189.595 1565.5284,-1182.4722 1554.9552,-1183.1493 1557.6852,-1189.595"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="1820" cy="-1166.6018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1820" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 22&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1487.6268,-1228.4387C1556.2206,-1215.6771 1674.0237,-1193.7602 1749.3919,-1179.7382"/>
<polygon fill="#000000" stroke="#000000" points="1750.0875,-1183.169 1759.2786,-1177.8988 1748.8071,-1176.287 1750.0875,-1183.169"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2804" cy="-1166.6018" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2804" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 27&#45;131</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1497.7449,-1235.2017C1723.7746,-1223.3314 2477.452,-1183.751 2724.6907,-1170.7669"/>
<polygon fill="#000000" stroke="#000000" points="2724.8746,-1174.2621 2734.6772,-1170.2424 2724.5074,-1167.2718 2724.8746,-1174.2621"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="4281" cy="-1166.6018" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4281" y="-1162.4018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 132&#45;182</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1498.5195,-1236.9455C1875.8022,-1227.4074 3769.2499,-1179.5393 4195.6329,-1168.76"/>
<polygon fill="#000000" stroke="#000000" points="4195.822,-1172.2564 4205.7303,-1168.5047 4195.645,-1165.2587 4195.822,-1172.2564"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="1125.5,-1103.5018 1032.5,-1103.5018 1032.5,-1067.5018 1125.5,-1067.5018 1125.5,-1103.5018"/>
<text text-anchor="middle" x="1079" y="-1082.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>header_2&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1079,-1148.199C1079,-1138.0701 1079,-1125.2817 1079,-1113.9005"/>
<polygon fill="#000000" stroke="#000000" points="1082.5001,-1113.5524 1079,-1103.5525 1075.5001,-1113.5525 1082.5001,-1113.5524"/>
</g>
<!-- raw_12 -->
<g id="node13" class="node">
<title>raw_12</title>
<ellipse fill="none" stroke="#000000" cx="1179" cy="-1085.5018" rx="27" ry="18"/>
<text text-anchor="middle" x="1179" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_12 -->
<g id="edge12" class="edge">
<title>prose_3&#45;&gt;raw_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1185.2245,-1148.6031C1184.2166,-1138.3848 1182.9323,-1125.3652 1181.7924,-1113.8093"/>
<polygon fill="#000000" stroke="#000000" points="1185.263,-1113.3387 1180.7982,-1103.7307 1178.2968,-1114.026 1185.263,-1113.3387"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1260" cy="-1085.5018" rx="27" ry="18"/>
<text text-anchor="middle" x="1260" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_4&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1267.0026,-1148.6031C1265.8686,-1138.3848 1264.4238,-1125.3652 1263.1414,-1113.8093"/>
<polygon fill="#000000" stroke="#000000" points="1266.6046,-1113.2836 1262.0229,-1103.7307 1259.6473,-1114.0557 1266.6046,-1113.2836"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1341" cy="-1085.5018" rx="27" ry="18"/>
<text text-anchor="middle" x="1341" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_5&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1348.7807,-1148.6031C1347.5119,-1138.3134 1345.8929,-1125.183 1344.4606,-1113.5671"/>
<polygon fill="#000000" stroke="#000000" points="1347.9107,-1112.9467 1343.2131,-1103.4502 1340.9633,-1113.8034 1347.9107,-1112.9467"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-1085.5018" rx="27" ry="18"/>
<text text-anchor="middle" x="1423" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_6&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1430.7807,-1148.6031C1429.5119,-1138.3134 1427.8929,-1125.183 1426.4606,-1113.5671"/>
<polygon fill="#000000" stroke="#000000" points="1429.9107,-1112.9467 1425.2131,-1103.4502 1422.9633,-1113.8034 1429.9107,-1112.9467"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1750,-1112.7023 1468,-1112.7023 1468,-1058.3013 1750,-1058.3013 1750,-1112.7023"/>
<text text-anchor="middle" x="1609" y="-1097.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">local Linebuf = require &quot;linebuf&quot;</text>
<text text-anchor="middle" x="1609" y="-1082.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1609" y="-1066.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>codeblock_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1604.3316,-1148.6031C1604.8985,-1140.9405 1605.5819,-1131.7026 1606.2489,-1122.6879"/>
<polygon fill="#000000" stroke="#000000" points="1609.7403,-1122.9318 1606.9877,-1112.7008 1602.7594,-1122.4153 1609.7403,-1122.9318"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1959.5,-1103.5018 1768.5,-1103.5018 1768.5,-1067.5018 1959.5,-1067.5018 1959.5,-1103.5018"/>
<text text-anchor="middle" x="1864" y="-1082.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_8&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1829.765,-1148.6031C1835.4786,-1138.072 1842.8064,-1124.5655 1849.2155,-1112.7523"/>
<polygon fill="#000000" stroke="#000000" points="1852.4177,-1114.1895 1854.1101,-1103.7307 1846.2649,-1110.8513 1852.4177,-1114.1895"/>
</g>
<!-- header_22 -->
<g id="node23" class="node">
<title>header_22</title>
<ellipse fill="none" stroke="#000000" cx="2210" cy="-1085.5018" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2210" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:load()</text>
</g>
<!-- section_9&#45;&gt;header_22 -->
<g id="edge22" class="edge">
<title>section_9&#45;&gt;header_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2740.3137,-1158.7338C2658.8109,-1148.5685 2513.2883,-1130.0946 2389,-1112.6018 2355.5796,-1107.8982 2318.7027,-1102.3725 2287.1489,-1097.5419"/>
<polygon fill="#000000" stroke="#000000" points="2287.5176,-1094.0576 2277.1023,-1095.9999 2286.4556,-1100.9766 2287.5176,-1094.0576"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-1085.5018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2430" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2750.0166,-1154.8958C2674.2064,-1138.4567 2537.9235,-1108.9045 2470.3108,-1094.243"/>
<polygon fill="#000000" stroke="#000000" points="2470.9732,-1090.8054 2460.4586,-1092.1066 2469.4897,-1097.6464 2470.9732,-1090.8054"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="2804" cy="-1085.5018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2804" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 32&#45;70</text>
</g>
<!-- section_9&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2804,-1148.199C2804,-1138.0701 2804,-1125.2817 2804,-1113.9005"/>
<polygon fill="#000000" stroke="#000000" points="2807.5001,-1113.5524 2804,-1103.5525 2800.5001,-1113.5525 2807.5001,-1113.5524"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="3017" cy="-1085.5018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3017" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2843.5645,-1151.5376C2882.7705,-1136.6099 2942.3291,-1113.9329 2980.4494,-1099.4185"/>
<polygon fill="#000000" stroke="#000000" points="2982.0253,-1102.5636 2990.1254,-1095.7343 2979.5345,-1096.0218 2982.0253,-1102.5636"/>
</g>
<!-- codeblock_26 -->
<g id="node27" class="node">
<title>codeblock_26</title>
<ellipse fill="none" stroke="#000000" cx="3217" cy="-1085.5018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3217" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 72&#45;89</text>
</g>
<!-- section_9&#45;&gt;codeblock_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;codeblock_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2860.1288,-1155.5799C2934.7899,-1140.9189 3066.7299,-1115.0101 3147.5678,-1099.1361"/>
<polygon fill="#000000" stroke="#000000" points="3148.513,-1102.5174 3157.6512,-1097.156 3147.1642,-1095.6486 3148.513,-1102.5174"/>
</g>
<!-- codeblock_27 -->
<g id="node28" class="node">
<title>codeblock_27</title>
<ellipse fill="none" stroke="#000000" cx="3536" cy="-1085.5018" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="3536" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 91&#45;129</text>
</g>
<!-- section_9&#45;&gt;codeblock_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;codeblock_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2869.4076,-1159.6921C2964.7734,-1149.5792 3147.5641,-1130.0512 3303,-1112.6018 3352.8414,-1107.0066 3408.6525,-1100.5229 3453.1544,-1095.3005"/>
<polygon fill="#000000" stroke="#000000" points="3453.8163,-1098.7469 3463.3397,-1094.1041 3452.9996,-1091.7947 3453.8163,-1098.7469"/>
</g>
<!-- header_42 -->
<g id="node43" class="node">
<title>header_42</title>
<ellipse fill="none" stroke="#000000" cx="4011" cy="-1085.5018" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="4011" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_10&#45;&gt;header_42 -->
<g id="edge42" class="edge">
<title>section_10&#45;&gt;header_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4233.9696,-1152.4753C4188.3137,-1138.7616 4118.882,-1117.9064 4069.6428,-1103.1164"/>
<polygon fill="#000000" stroke="#000000" points="4070.3521,-1099.675 4059.7679,-1100.1502 4068.3383,-1106.3791 4070.3521,-1099.675"/>
</g>
<!-- prose_43 -->
<g id="node44" class="node">
<title>prose_43</title>
<ellipse fill="none" stroke="#000000" cx="4198" cy="-1085.5018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4198" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_43 -->
<g id="edge43" class="edge">
<title>section_10&#45;&gt;prose_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4262.9902,-1149.0043C4250.7944,-1137.0877 4234.563,-1121.2278 4221.3724,-1108.3392"/>
<polygon fill="#000000" stroke="#000000" points="4223.6095,-1105.6316 4214.0109,-1101.1462 4218.7173,-1110.6383 4223.6095,-1105.6316"/>
</g>
<!-- codeblock_44 -->
<g id="node45" class="node">
<title>codeblock_44</title>
<ellipse fill="none" stroke="#000000" cx="4350" cy="-1085.5018" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4350" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 134&#45;151</text>
</g>
<!-- section_10&#45;&gt;codeblock_44 -->
<g id="edge44" class="edge">
<title>section_10&#45;&gt;codeblock_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4296.3133,-1148.6031C4305.6932,-1137.5784 4317.8475,-1123.2927 4328.2187,-1111.1028"/>
<polygon fill="#000000" stroke="#000000" points="4330.9152,-1113.3346 4334.7295,-1103.4502 4325.5837,-1108.7986 4330.9152,-1113.3346"/>
</g>
<!-- section_45 -->
<g id="node46" class="node">
<title>section_45</title>
<ellipse fill="none" stroke="#000000" cx="4758" cy="-1085.5018" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4758" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 154&#45;182</text>
</g>
<!-- section_10&#45;&gt;section_45 -->
<g id="edge45" class="edge">
<title>section_10&#45;&gt;section_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4342.8704,-1156.0826C4431.1582,-1141.0718 4592.9123,-1113.5702 4686.309,-1097.6908"/>
<polygon fill="#000000" stroke="#000000" points="4686.9674,-1101.1292 4696.2392,-1096.0024 4685.794,-1094.2282 4686.9674,-1101.1292"/>
</g>
<!-- section_46 -->
<g id="node47" class="node">
<title>section_46</title>
<ellipse fill="none" stroke="#000000" cx="5736" cy="-1085.5018" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5736" y="-1081.3018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 183&#45;206</text>
</g>
<!-- section_10&#45;&gt;section_46 -->
<g id="edge46" class="edge">
<title>section_10&#45;&gt;section_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4354.6516,-1162.4966C4600.495,-1148.7936 5391.9783,-1104.6772 5652.2069,-1090.1723"/>
<polygon fill="#000000" stroke="#000000" points="5652.5599,-1093.6582 5662.3496,-1089.607 5652.1703,-1086.669 5652.5599,-1093.6582"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-768.8024 0,-768.8024 0,-697 324,-697 324,-768.8024"/>
<text text-anchor="middle" x="162" y="-705.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>raw_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1161.1554,-1071.9442C1153.2617,-1066.7154 1143.6029,-1061.3038 1134,-1058.4017 1048.7195,-1032.6291 409.3632,-1068.2892 333,-1022.4017 242.3379,-967.9219 194.349,-845.5278 174.0453,-778.6534"/>
<polygon fill="#000000" stroke="#000000" points="177.3268,-777.4076 171.1353,-768.8101 170.614,-779.3921 177.3268,-777.4076"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-760.2016 342.5,-760.2016 342.5,-705.6008 897.5,-705.6008 897.5,-760.2016"/>
<text text-anchor="middle" x="620" y="-729.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-713.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1241.615,-1071.9946C1233.7858,-1066.9067 1224.3205,-1061.586 1215,-1058.4017 1084.5802,-1013.8457 1030.9172,-1082.7267 907,-1022.4017 786.0586,-963.5254 686.5043,-832.5007 643.2426,-768.9092"/>
<polygon fill="#000000" stroke="#000000" points="646.0021,-766.7408 637.5154,-760.3983 640.1945,-770.6488 646.0021,-766.7408"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-760.2016 916,-760.2016 916,-705.6008 1464,-705.6008 1464,-760.2016"/>
<text text-anchor="middle" x="1190" y="-729.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-713.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1333.5119,-1068.0163C1310.1046,-1013.3578 1237.9621,-844.8977 1205.7802,-769.7496"/>
<polygon fill="#000000" stroke="#000000" points="1208.8493,-768.0253 1201.6952,-760.2106 1202.4145,-770.781 1208.8493,-768.0253"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-768.2015 1482,-768.2015 1482,-697.6009 2030,-697.6009 2030,-768.2015"/>
<text text-anchor="middle" x="1756" y="-737.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new linebuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-721.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1437.7383,-1069.896C1486.1471,-1018.6378 1641.4067,-854.2395 1715.6788,-775.5957"/>
<polygon fill="#000000" stroke="#000000" points="1718.2858,-777.9328 1722.6073,-768.2594 1713.1966,-773.1265 1718.2858,-777.9328"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2197.5,-750.9012 2048.5,-750.9012 2048.5,-714.9012 2197.5,-714.9012 2197.5,-750.9012"/>
<text text-anchor="middle" x="2123" y="-729.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:load()</text>
</g>
<!-- header_22&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>header_22&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2205.445,-1067.0409C2191.1451,-1009.0852 2147.0804,-830.4962 2129.9306,-760.9901"/>
<polygon fill="#000000" stroke="#000000" points="2133.3036,-760.0497 2127.5099,-751.1793 2126.5074,-761.7266 2133.3036,-760.0497"/>
</g>
<!-- raw_29 -->
<g id="node30" class="node">
<title>raw_29</title>
<ellipse fill="none" stroke="#000000" cx="2243" cy="-732.9012" rx="27" ry="18"/>
<text text-anchor="middle" x="2243" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_23&#45;&gt;raw_29 -->
<g id="edge29" class="edge">
<title>prose_23&#45;&gt;raw_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2398.341,-1081.628C2363.2071,-1075.5311 2307.6903,-1060.1934 2279,-1022.4017 2219.2817,-943.739 2229.6527,-816.9414 2237.9859,-760.9806"/>
<polygon fill="#000000" stroke="#000000" points="2241.4958,-761.1928 2239.604,-750.7682 2234.5821,-760.0973 2241.4958,-761.1928"/>
</g>
<!-- prespace_30 -->
<g id="node31" class="node">
<title>prespace_30</title>
<ellipse fill="none" stroke="#000000" cx="2334" cy="-732.9012" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2334" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_23&#45;&gt;prespace_30 -->
<g id="edge30" class="edge">
<title>prose_23&#45;&gt;prespace_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2416.9326,-1068.7709C2408.0368,-1056.5676 2396.7022,-1039.2784 2390,-1022.4017 2353.7627,-931.1539 2340.3909,-814.1429 2335.9627,-761.1838"/>
<polygon fill="#000000" stroke="#000000" points="2339.449,-760.872 2335.1702,-751.1796 2332.4709,-761.4248 2339.449,-760.872"/>
</g>
<!-- literal_31 -->
<g id="node32" class="node">
<title>literal_31</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-732.9012" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2430" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_23&#45;&gt;literal_31 -->
<g id="edge31" class="edge">
<title>prose_23&#45;&gt;literal_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2430,-1067.0409C2430,-1009.2042 2430,-831.2292 2430,-761.4197"/>
<polygon fill="#000000" stroke="#000000" points="2433.5001,-761.1793 2430,-751.1793 2426.5001,-761.1794 2433.5001,-761.1793"/>
</g>
<!-- raw_32 -->
<g id="node33" class="node">
<title>raw_32</title>
<ellipse fill="none" stroke="#000000" cx="2506" cy="-732.9012" rx="27" ry="18"/>
<text text-anchor="middle" x="2506" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_23&#45;&gt;raw_32 -->
<g id="edge32" class="edge">
<title>prose_23&#45;&gt;raw_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2443.4198,-1068.904C2452.4817,-1056.7635 2463.8699,-1039.4945 2470,-1022.4017 2502.7231,-931.1594 2506.6392,-814.538 2506.5314,-761.481"/>
<polygon fill="#000000" stroke="#000000" points="2510.029,-761.1302 2506.4562,-751.156 2503.0292,-761.1813 2510.029,-761.1302"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="3057,-1015.9021 2551,-1015.9021 2551,-449.9003 3057,-449.9003 3057,-1015.9021"/>
<text text-anchor="middle" x="2804" y="-1000.7017" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 50</text>
<text text-anchor="middle" x="2804" y="-969.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2804" y="-953.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE repl (</text>
<text text-anchor="middle" x="2804" y="-938.5016" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2804" y="-923.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">project TEXT,</text>
<text text-anchor="middle" x="2804" y="-907.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2804" y="-892.3015" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP);</text>
<text text-anchor="middle" x="2804" y="-876.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-845.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line_stmt = [[</text>
<text text-anchor="middle" x="2804" y="-830.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES(?, ?);</text>
<text text-anchor="middle" x="2804" y="-814.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-783.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2804" y="-767.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2804" y="-752.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-721.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2804" y="-705.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT line FROM repl</text>
<text text-anchor="middle" x="2804" y="-690.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %s</text>
<text text-anchor="middle" x="2804" y="-674.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2804" y="-659.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2804" y="-644.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-612.701" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-597.301" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-565.901" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2804" y="-550.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2804" y="-535.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2804" y="-519.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2804" y="-504.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-488.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-473.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2804" y="-458.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_24&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2804,-1067.0409C2804,-1056.7948 2804,-1042.7783 2804,-1026.2606"/>
<polygon fill="#000000" stroke="#000000" points="2807.5001,-1026.2558 2804,-1016.2559 2800.5001,-1026.2559 2807.5001,-1026.2558"/>
</g>
<!-- raw_38 -->
<g id="node39" class="node">
<title>raw_38</title>
<ellipse fill="none" stroke="#000000" cx="3102" cy="-732.9012" rx="27" ry="18"/>
<text text-anchor="middle" x="3102" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_38 -->
<g id="edge38" class="edge">
<title>prose_25&#45;&gt;raw_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3033.2573,-1069.6831C3044.4228,-1057.7815 3058.5287,-1040.4751 3066,-1022.4017 3103.1996,-932.4151 3104.8295,-814.3109 3103.3347,-761.0734"/>
<polygon fill="#000000" stroke="#000000" points="3106.8309,-760.8992 3102.9919,-751.0243 3099.835,-761.1379 3106.8309,-760.8992"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="3429,-860.4017 3147,-860.4017 3147,-605.4007 3429,-605.4007 3429,-860.4017"/>
<text text-anchor="middle" x="3288" y="-845.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local STATCOL = 81</text>
<text text-anchor="middle" x="3288" y="-829.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">local STAT_TOP = 1</text>
<text text-anchor="middle" x="3288" y="-814.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local STAT_RUN = 2</text>
<text text-anchor="middle" x="3288" y="-783.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function colwrite(str, col, row)</text>
<text text-anchor="middle" x="3288" y="-767.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;col = col or STATCOL</text>
<text text-anchor="middle" x="3288" y="-752.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;row = row or STAT_TOP</text>
<text text-anchor="middle" x="3288" y="-736.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local dash = a.stash()</text>
<text text-anchor="middle" x="3288" y="-721.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.cursor.hide()</text>
<text text-anchor="middle" x="3288" y="-706.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.jump(row, col)</text>
<text text-anchor="middle" x="3288" y="-690.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.erase.right()</text>
<text text-anchor="middle" x="3288" y="-675.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. str</text>
<text text-anchor="middle" x="3288" y="-659.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.pop()</text>
<text text-anchor="middle" x="3288" y="-644.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.cursor.show()</text>
<text text-anchor="middle" x="3288" y="-629.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(dash)</text>
<text text-anchor="middle" x="3288" y="-613.601" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_26&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>codeblock_26&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3220.7173,-1067.0409C3228.0901,-1030.4259 3245.1584,-945.6615 3260.2579,-870.6742"/>
<polygon fill="#000000" stroke="#000000" points="3263.7358,-871.1324 3262.2788,-860.6382 3256.8736,-869.7505 3263.7358,-871.1324"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="3904.5,-1022.4023 3447.5,-1022.4023 3447.5,-443.4001 3904.5,-443.4001 3904.5,-1022.4023"/>
<text text-anchor="middle" x="3676" y="-1007.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert(table.reverse)</text>
<text text-anchor="middle" x="3676" y="-975.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3676" y="-960.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.home_dir .. &quot;/.bridge&quot;)</text>
<text text-anchor="middle" x="3676" y="-945.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3676" y="-929.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_names = conn:exec(get_tables)</text>
<text text-anchor="middle" x="3676" y="-914.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not table_names or not has(table_names.name, &quot;repl&quot;) then</text>
<text text-anchor="middle" x="3676" y="-898.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, err = sql.pexec(conn, create_repl_table)</text>
<text text-anchor="middle" x="3676" y="-883.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; success is nil for creation, false for error</text>
<text text-anchor="middle" x="3676" y="-868.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success == false then</text>
<text text-anchor="middle" x="3676" y="-852.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="3676" y="-837.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-821.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-806.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt = conn:prepare(insert_line_stmt)</text>
<text text-anchor="middle" x="3676" y="-791.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_stmt = sql.format(get_recent, historian.project,</text>
<text text-anchor="middle" x="3676" y="-775.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3676" y="-760.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local values, err = sql.pexec(conn, pop_stmt)</text>
<text text-anchor="middle" x="3676" y="-744.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if values then</text>
<text text-anchor="middle" x="3676" y="-729.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(reverse(values[1])) do</text>
<text text-anchor="middle" x="3676" y="-714.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = Linebuf(v)</text>
<text text-anchor="middle" x="3676" y="-698.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-683.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3676" y="-667.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="3676" y="-652.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3676" y="-605.601" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, linebuf)</text>
<text text-anchor="middle" x="3676" y="-590.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="3676" y="-574.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt:bind(historian.project, lb)</text>
<text text-anchor="middle" x="3676" y="-559.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local err = historian.insert_stmt:step()</text>
<text text-anchor="middle" x="3676" y="-544.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not err then</text>
<text text-anchor="middle" x="3676" y="-528.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="3676" y="-513.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3676" y="-497.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;error(error)</text>
<text text-anchor="middle" x="3676" y="-482.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-467.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="3676" y="-451.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_27&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>codeblock_27&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3543.1351,-1067.5315C3546.7232,-1058.4945 3551.5105,-1046.4374 3557.1385,-1032.2629"/>
<polygon fill="#000000" stroke="#000000" points="3560.5168,-1033.2387 3560.9542,-1022.6529 3554.0109,-1030.6554 3560.5168,-1033.2387"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2292,-277.3018 1926,-277.3018 1926,-221.4989 2292,-221.4989 2292,-277.3018"/>
<text text-anchor="middle" x="2109" y="-229.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">This is where we either create query or create our</text>
</g>
<!-- raw_29&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>raw_29&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2242.7799,-714.8418C2241.7741,-668.6372 2236.2377,-542.7742 2206,-443.4007 2188.3927,-385.5359 2154.6939,-323.911 2132.0279,-286.0243"/>
<polygon fill="#000000" stroke="#000000" points="2134.9728,-284.1303 2126.8032,-277.3842 2128.9827,-287.7524 2134.9728,-284.1303"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2364,-267.4003 2310,-267.4003 2310,-231.4003 2364,-231.4003 2364,-267.4003"/>
<text text-anchor="middle" x="2337" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>prespace_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2334.1121,-714.8298C2334.566,-641.6777 2336.2692,-367.1867 2336.824,-277.7585"/>
<polygon fill="#000000" stroke="#000000" points="2340.3251,-277.584 2336.8873,-267.5625 2333.3252,-277.5405 2340.3251,-277.584"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2466.5,-267.4003 2387.5,-267.4003 2387.5,-231.4003 2466.5,-231.4003 2466.5,-267.4003"/>
<text text-anchor="middle" x="2427" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">~/.bridge</text>
</g>
<!-- literal_31&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>literal_31&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2429.8879,-714.8298C2429.434,-641.6777 2427.7308,-367.1867 2427.176,-277.7585"/>
<polygon fill="#000000" stroke="#000000" points="2430.6748,-277.5405 2427.1127,-267.5625 2423.6749,-277.584 2430.6748,-277.5405"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2571,-269.3024 2485,-269.3024 2485,-229.4983 2571,-229.4983 2571,-269.3024"/>
<text text-anchor="middle" x="2528" y="-253.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> database.</text>
</g>
<!-- raw_32&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>raw_32&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2506.8223,-714.8298C2510.1317,-642.0975 2522.4975,-370.3305 2526.6388,-279.3163"/>
<polygon fill="#000000" stroke="#000000" points="2530.1436,-279.2874 2527.1019,-269.1386 2523.1509,-278.9691 2530.1436,-279.2874"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3218.5,-269.3024 2985.5,-269.3024 2985.5,-229.4983 3218.5,-229.4983 3218.5,-269.3024"/>
<text text-anchor="middle" x="3102" y="-237.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">bring in colwrite for diagnosis</text>
</g>
<!-- raw_38&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>raw_38&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3102,-714.8298C3102,-642.0975 3102,-370.3305 3102,-279.3163"/>
<polygon fill="#000000" stroke="#000000" points="3105.5001,-279.1386 3102,-269.1386 3098.5001,-279.1386 3105.5001,-279.1386"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="4071.5,-750.9012 3922.5,-750.9012 3922.5,-714.9012 4071.5,-714.9012 4071.5,-750.9012"/>
<text text-anchor="middle" x="3997" y="-729.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_42&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>header_42&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4010.267,-1067.0409C4007.9706,-1009.2042 4000.9041,-831.2292 3998.1323,-761.4197"/>
<polygon fill="#000000" stroke="#000000" points="4001.6198,-761.0326 3997.7257,-751.1793 3994.6253,-761.3104 4001.6198,-761.0326"/>
</g>
<!-- raw_48 -->
<g id="node49" class="node">
<title>raw_48</title>
<ellipse fill="none" stroke="#000000" cx="4117" cy="-732.9012" rx="27" ry="18"/>
<text text-anchor="middle" x="4117" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_43&#45;&gt;raw_48 -->
<g id="edge48" class="edge">
<title>prose_43&#45;&gt;raw_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4183.0865,-1069.4432C4172.8405,-1057.4255 4159.889,-1040.0787 4153,-1022.4017 4117.6427,-931.6754 4115.0879,-813.9425 4116.0079,-760.9359"/>
<polygon fill="#000000" stroke="#000000" points="4119.5071,-761.0099 4116.238,-750.932 4112.5089,-760.8489 4119.5071,-761.0099"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="4591.5,-860.302 4162.5,-860.302 4162.5,-605.5004 4591.5,-605.5004 4591.5,-860.302"/>
<text text-anchor="middle" x="4377" y="-844.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="4377" y="-829.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="4377" y="-814.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="4377" y="-798.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4377" y="-783.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="4377" y="-767.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf = &quot;&quot;</text>
<text text-anchor="middle" x="4377" y="-752.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.up then</text>
<text text-anchor="middle" x="4377" y="-737.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor + delta]:clone()</text>
<text text-anchor="middle" x="4377" y="-721.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4377" y="-706.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor &#45; delta]:clone()</text>
<text text-anchor="middle" x="4377" y="-690.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4377" y="-675.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; delta</text>
<text text-anchor="middle" x="4377" y="-660.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="4377" y="-644.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.up = true</text>
<text text-anchor="middle" x="4377" y="-629.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return linebuf</text>
<text text-anchor="middle" x="4377" y="-613.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_44&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_44&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4351.4136,-1067.0409C4354.2226,-1030.3581 4360.7322,-945.3474 4366.4821,-870.2577"/>
<polygon fill="#000000" stroke="#000000" points="4369.9777,-870.4469 4367.2516,-860.2088 4362.9982,-869.9124 4369.9777,-870.4469"/>
</g>
<!-- header_51 -->
<g id="node52" class="node">
<title>header_51</title>
<ellipse fill="none" stroke="#000000" cx="4692" cy="-732.9012" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="4692" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_45&#45;&gt;header_51 -->
<g id="edge51" class="edge">
<title>section_45&#45;&gt;header_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4754.5445,-1067.0409C4743.7186,-1009.2042 4710.4051,-831.2292 4697.3381,-761.4197"/>
<polygon fill="#000000" stroke="#000000" points="4700.7015,-760.3647 4695.4213,-751.1793 4693.821,-761.6526 4700.7015,-760.3647"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4825" cy="-732.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4825" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_45&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_45&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4766.487,-1067.385C4771.9725,-1054.9743 4778.8398,-1037.9997 4783,-1022.4017 4807.9877,-928.7149 4819.0646,-813.7507 4823.0817,-761.3533"/>
<polygon fill="#000000" stroke="#000000" points="4826.589,-761.3825 4823.8342,-751.152 4819.6079,-760.8674 4826.589,-761.3825"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="5062" cy="-732.9012" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5062" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 159&#45;180</text>
</g>
<!-- section_45&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_45&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4793.9805,-1069.5907C4816.3711,-1058.5183 4844.8317,-1042.2096 4866,-1022.4017 4952.7533,-941.2238 5021.4323,-814.927 5048.9555,-759.9727"/>
<polygon fill="#000000" stroke="#000000" points="5052.1615,-761.3855 5053.463,-750.8709 5045.8886,-758.2789 5052.1615,-761.3855"/>
</g>
<!-- header_64 -->
<g id="node65" class="node">
<title>header_64</title>
<ellipse fill="none" stroke="#000000" cx="5486" cy="-732.9012" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="5486" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_46&#45;&gt;header_64 -->
<g id="edge64" class="edge">
<title>section_46&#45;&gt;header_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5693.5058,-1070.4737C5669.1464,-1060.0909 5639.4464,-1044.1994 5619,-1022.4017 5545.2355,-943.7624 5506.6916,-817.0229 5492.5008,-761.0349"/>
<polygon fill="#000000" stroke="#000000" points="5495.8493,-759.995 5490.0576,-751.1233 5489.0528,-761.6704 5495.8493,-759.995"/>
</g>
<!-- prose_65 -->
<g id="node66" class="node">
<title>prose_65</title>
<ellipse fill="none" stroke="#000000" cx="5660" cy="-732.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5660" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_46&#45;&gt;prose_65 -->
<g id="edge65" class="edge">
<title>section_46&#45;&gt;prose_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5729.6606,-1067.4381C5725.4148,-1054.9069 5719.9083,-1037.7715 5716,-1022.4017 5691.9136,-927.6801 5672.607,-813.2246 5664.3474,-761.1526"/>
<polygon fill="#000000" stroke="#000000" points="5667.7647,-760.3529 5662.7548,-751.0175 5660.8496,-761.4396 5667.7647,-760.3529"/>
</g>
<!-- codeblock_66 -->
<g id="node67" class="node">
<title>codeblock_66</title>
<ellipse fill="none" stroke="#000000" cx="5812" cy="-732.9012" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5812" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 185&#45;193</text>
</g>
<!-- section_46&#45;&gt;codeblock_66 -->
<g id="edge66" class="edge">
<title>section_46&#45;&gt;codeblock_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5739.9791,-1067.0409C5752.4709,-1009.0852 5790.9642,-830.4962 5805.9457,-760.9901"/>
<polygon fill="#000000" stroke="#000000" points="5809.3746,-761.6923 5808.0603,-751.1793 5802.5318,-760.2174 5809.3746,-761.6923"/>
</g>
<!-- codeblock_67 -->
<g id="node68" class="node">
<title>codeblock_67</title>
<ellipse fill="none" stroke="#000000" cx="6075" cy="-732.9012" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6075" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 195&#45;202</text>
</g>
<!-- section_46&#45;&gt;codeblock_67 -->
<g id="edge67" class="edge">
<title>section_46&#45;&gt;codeblock_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5795.767,-1074.3552C5831.4897,-1065.2471 5875.9984,-1049.334 5908,-1022.4017 5995.1379,-949.0672 6046.8285,-817.9978 6066.2026,-760.8394"/>
<polygon fill="#000000" stroke="#000000" points="6069.6209,-761.6508 6069.4453,-751.0574 6062.9764,-759.4481 6069.6209,-761.6508"/>
</g>
<!-- codeblock_68 -->
<g id="node69" class="node">
<title>codeblock_68</title>
<ellipse fill="none" stroke="#000000" cx="6304" cy="-732.9012" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6304" y="-728.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 204&#45;206</text>
</g>
<!-- section_46&#45;&gt;codeblock_68 -->
<g id="edge68" class="edge">
<title>section_46&#45;&gt;codeblock_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5810.9876,-1083.1175C5920.0638,-1078.2585 6115.5398,-1063.8754 6171,-1022.4017 6258.3609,-957.0724 6290.054,-820.5765 6300.002,-761.3436"/>
<polygon fill="#000000" stroke="#000000" points="6303.4983,-761.6434 6301.615,-751.2173 6296.5854,-760.5422 6303.4983,-761.6434"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4144,-267.4003 4090,-267.4003 4090,-231.4003 4144,-231.4003 4144,-267.4003"/>
</g>
<!-- raw_48&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>raw_48&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4117,-714.8298C4117,-641.6777 4117,-367.1867 4117,-277.7585"/>
<polygon fill="#000000" stroke="#000000" points="4120.5001,-277.5624 4117,-267.5625 4113.5001,-277.5625 4120.5001,-277.5624"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="4593,-267.4003 4437,-267.4003 4437,-231.4003 4593,-231.4003 4593,-267.4003"/>
<text text-anchor="middle" x="4515" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_51&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_51&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4686.9449,-714.7198C4674.0066,-668.744 4638.0247,-544.3229 4600,-443.4007 4577.209,-382.9105 4545.638,-314.0177 4528.0919,-276.7854"/>
<polygon fill="#000000" stroke="#000000" points="4531.1819,-275.1325 4523.7403,-267.591 4524.8547,-278.1271 4531.1819,-275.1325"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="4638" cy="-249.4003" rx="27" ry="18"/>
<text text-anchor="middle" x="4638" y="-245.2003" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_52&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4828.2839,-714.7207C4836.1838,-664.867 4850.8859,-524.336 4783,-443.4007 4750.2137,-404.312 4708.3223,-445.1478 4674,-407.4007 4641.551,-371.7137 4636.4184,-312.9619 4636.5678,-278.0445"/>
<polygon fill="#000000" stroke="#000000" points="4640.0758,-277.6719 4636.774,-267.6047 4633.0771,-277.5336 4640.0758,-277.6719"/>
</g>
<!-- prespace_56 -->
<g id="node57" class="node">
<title>prespace_56</title>
<ellipse fill="none" stroke="#000000" cx="4729" cy="-249.4003" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="4729" y="-245.2003" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_52&#45;&gt;prespace_56 -->
<g id="edge56" class="edge">
<title>prose_52&#45;&gt;prespace_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4823.1858,-714.8051C4818.4213,-669.0268 4804.4243,-545.0257 4783,-443.4007 4770.3431,-383.3637 4749.6614,-314.4678 4737.906,-277.0753"/>
<polygon fill="#000000" stroke="#000000" points="4741.1971,-275.8743 4734.8412,-267.3976 4734.5237,-277.9877 4741.1971,-275.8743"/>
</g>
<!-- literal_57 -->
<g id="node58" class="node">
<title>literal_57</title>
<ellipse fill="none" stroke="#000000" cx="4825" cy="-249.4003" rx="31.481" ry="18"/>
<text text-anchor="middle" x="4825" y="-245.2003" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_52&#45;&gt;literal_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;literal_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4825,-714.8298C4825,-641.6777 4825,-367.1867 4825,-277.7585"/>
<polygon fill="#000000" stroke="#000000" points="4828.5001,-277.5624 4825,-267.5625 4821.5001,-277.5625 4828.5001,-277.5624"/>
</g>
<!-- raw_58 -->
<g id="node59" class="node">
<title>raw_58</title>
<ellipse fill="none" stroke="#000000" cx="4901" cy="-249.4003" rx="27" ry="18"/>
<text text-anchor="middle" x="4901" y="-245.2003" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_58 -->
<g id="edge58" class="edge">
<title>prose_52&#45;&gt;raw_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4827.8406,-714.8298C4839.3638,-641.5209 4882.6706,-366.0091 4896.6325,-277.186"/>
<polygon fill="#000000" stroke="#000000" points="4900.0902,-277.7278 4898.1855,-267.3056 4893.1751,-276.6407 4900.0902,-277.7278"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="5375.5,-407.401 4946.5,-407.401 4946.5,-91.3997 5375.5,-91.3997 5375.5,-407.401"/>
<text text-anchor="middle" x="5161" y="-392.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="5161" y="-376.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="5161" y="-361.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="5161" y="-346.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="5161" y="-330.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5161" y="-315.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf</text>
<text text-anchor="middle" x="5161" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not historian.up then</text>
<text text-anchor="middle" x="5161" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor &#45; delta]:clone()</text>
<text text-anchor="middle" x="5161" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="5161" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = historian[historian.cursor + delta]:clone()</text>
<text text-anchor="middle" x="5161" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5161" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + delta</text>
<text text-anchor="middle" x="5161" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="5161" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="5161" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (delta &gt; 0) and #linebuf.line &gt; 0 then</text>
<text text-anchor="middle" x="5161" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, true</text>
<text text-anchor="middle" x="5161" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="5161" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, false</text>
<text text-anchor="middle" x="5161" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5161" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_53&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>codeblock_53&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5065.7002,-714.8298C5075.5903,-666.5284 5103.4538,-530.4471 5126.5148,-417.8206"/>
<polygon fill="#000000" stroke="#000000" points="5130.012,-418.189 5128.5891,-407.6901 5123.1542,-416.7848 5130.012,-418.189"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4685,-55.6015 4207,-55.6015 4207,.2015 4685,.2015 4685,-55.6015"/>
<text text-anchor="middle" x="4446" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next linebuf in history, and a second flag to tell the</text>
</g>
<!-- raw_55&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>raw_55&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4638.9566,-231.1842C4639.6452,-199.0964 4636.4909,-132.0532 4602,-91.4 4591.264,-78.7458 4577.6261,-68.5719 4562.8995,-60.4004"/>
<polygon fill="#000000" stroke="#000000" points="4564.0925,-57.0759 4553.6057,-55.567 4560.8627,-63.2863 4564.0925,-57.0759"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="4757,-45.7 4703,-45.7 4703,-9.7 4757,-9.7 4757,-45.7"/>
</g>
<!-- prespace_56&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>prespace_56&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4729.0818,-231.2577C4729.2559,-192.6746 4729.6638,-102.2346 4729.8723,-56.0003"/>
<polygon fill="#000000" stroke="#000000" points="4733.3732,-55.7982 4729.9184,-45.7824 4726.3733,-55.7665 4733.3732,-55.7982"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4875,-45.7 4775,-45.7 4775,-9.7 4875,-9.7 4875,-45.7"/>
<text text-anchor="middle" x="4825" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_57&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>literal_57&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4825,-231.2577C4825,-192.6746 4825,-102.2346 4825,-56.0003"/>
<polygon fill="#000000" stroke="#000000" points="4828.5001,-55.7824 4825,-45.7824 4821.5001,-55.7825 4828.5001,-55.7824"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="5133,-45.7 4893,-45.7 4893,-9.7 5133,-9.7 5133,-45.7"/>
<text text-anchor="middle" x="5013" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_58&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>raw_58&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4901.4442,-231.1845C4902.966,-200.2449 4909.49,-136.4092 4937,-91.4 4946.4428,-75.9507 4960.954,-62.4442 4974.7755,-51.8916"/>
<polygon fill="#000000" stroke="#000000" points="4977.2276,-54.435 4983.2408,-45.712 4973.1002,-48.7812 4977.2276,-54.435"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="5564,-267.4003 5394,-267.4003 5394,-231.4003 5564,-231.4003 5564,-267.4003"/>
<text text-anchor="middle" x="5479" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_64&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>header_64&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5485.7384,-714.8298C5484.6793,-641.6777 5480.7053,-367.1867 5479.4106,-277.7585"/>
<polygon fill="#000000" stroke="#000000" points="5482.9074,-277.5107 5479.2629,-267.5625 5475.9082,-277.6121 5482.9074,-277.5107"/>
</g>
<!-- raw_70 -->
<g id="node71" class="node">
<title>raw_70</title>
<ellipse fill="none" stroke="#000000" cx="5609" cy="-249.4003" rx="27" ry="18"/>
<text text-anchor="middle" x="5609" y="-245.2003" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_65&#45;&gt;raw_70 -->
<g id="edge70" class="edge">
<title>prose_65&#45;&gt;raw_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5658.0938,-714.8298C5650.3777,-641.6777 5621.4242,-367.1867 5611.9912,-277.7585"/>
<polygon fill="#000000" stroke="#000000" points="5615.4455,-277.1401 5610.9158,-267.5625 5608.4841,-277.8745 5615.4455,-277.1401"/>
</g>
<!-- leaf_72 -->
<g id="node73" class="node">
<title>leaf_72</title>
<polygon fill="none" stroke="#c0c0c0" points="5985.5,-307.2007 5654.5,-307.2007 5654.5,-191.6 5985.5,-191.6 5985.5,-307.2007"/>
<text text-anchor="middle" x="5820" y="-292.1005" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, linebuf)</text>
<text text-anchor="middle" x="5820" y="-276.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = linebuf</text>
<text text-anchor="middle" x="5820" y="-261.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="5820" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="5820" y="-230.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:persist(linebuf)</text>
<text text-anchor="middle" x="5820" y="-215.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="5820" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_66&#45;&gt;leaf_72 -->
<g id="edge72" class="edge">
<title>codeblock_66&#45;&gt;leaf_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5812.299,-714.8298C5813.3635,-650.4927 5817.0049,-430.4164 5818.8737,-317.4729"/>
<polygon fill="#000000" stroke="#000000" points="5822.3774,-317.2729 5819.0434,-307.2163 5815.3783,-317.157 5822.3774,-317.2729"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="6272,-299.8013 6004,-299.8013 6004,-198.9994 6272,-198.9994 6272,-299.8013"/>
<text text-anchor="middle" x="6138" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="6138" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="6138" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="6138" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="6138" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6138" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_67&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>codeblock_67&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6077.3547,-714.8298C6085.9328,-648.9965 6115.7584,-420.0961 6130.1338,-309.7702"/>
<polygon fill="#000000" stroke="#000000" points="6133.6124,-310.1613 6131.4339,-299.7928 6126.6711,-309.2568 6133.6124,-310.1613"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="6376,-267.4003 6290,-267.4003 6290,-231.4003 6376,-231.4003 6376,-267.4003"/>
<text text-anchor="middle" x="6333" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_68&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>codeblock_68&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6305.0839,-714.8298C6309.4715,-641.6777 6325.9353,-367.1867 6331.2991,-277.7585"/>
<polygon fill="#000000" stroke="#000000" points="6334.8056,-277.7541 6331.9107,-267.5625 6327.8181,-277.3349 6334.8056,-277.7541"/>
</g>
<!-- leaf_71 -->
<g id="node72" class="node">
<title>leaf_71</title>
<polygon fill="none" stroke="#c0c0c0" points="5636,-45.7 5582,-45.7 5582,-9.7 5636,-9.7 5636,-45.7"/>
</g>
<!-- raw_70&#45;&gt;leaf_71 -->
<g id="edge71" class="edge">
<title>raw_70&#45;&gt;leaf_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5609,-231.2577C5609,-192.6746 5609,-102.2346 5609,-56.0003"/>
<polygon fill="#000000" stroke="#000000" points="5612.5001,-55.7824 5609,-45.7824 5605.5001,-55.7825 5612.5001,-55.7824"/>
</g>
</g>
</svg>
