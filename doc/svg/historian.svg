<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="15402pt" height="2576pt"
 viewBox="0.00 0.00 15402.30 2576.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2572.4039)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2572.4039 15398.2972,-2572.4039 15398.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2550.4039" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1916" y="-2546.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 510</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2478.4039" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1916" y="-2474.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;424</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2532.2353C1916,-2524.5349 1916,-2515.3783 1916,-2506.8206"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2506.8172 1916,-2496.8172 1912.5001,-2506.8172 1919.5001,-2506.8172"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-2406.4039" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1423" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.742,-2472.6375C1771.438,-2464.5043 1622.1023,-2447.9781 1496,-2424.4039 1489.769,-2423.2391 1483.2751,-2421.8684 1476.8422,-2420.412"/>
<polygon fill="#000000" stroke="#000000" points="1477.3647,-2416.9398 1466.8303,-2418.0699 1475.7702,-2423.7558 1477.3647,-2416.9398"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1537" cy="-2406.4039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1537" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.6473,-2472.6586C1785.6726,-2465.4049 1674.1491,-2450.5922 1581,-2424.4039 1577.9982,-2423.56 1574.924,-2422.5731 1571.8643,-2421.5038"/>
<polygon fill="#000000" stroke="#000000" points="1572.8384,-2418.1308 1562.2464,-2417.8821 1570.3715,-2424.6817 1572.8384,-2418.1308"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1622" cy="-2406.4039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1622" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1858.8831,-2469.4222C1807.2649,-2460.5409 1729.5556,-2445.2582 1664,-2424.4039 1661.5525,-2423.6253 1659.0524,-2422.7558 1656.552,-2421.8308"/>
<polygon fill="#000000" stroke="#000000" points="1657.6046,-2418.4834 1647.0181,-2418.0629 1655.0318,-2424.9935 1657.6046,-2418.4834"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1705" cy="-2406.4039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1705" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1870.7661,-2465.2353C1836.4995,-2454.9504 1788.4123,-2439.8538 1747,-2424.4039 1744.7423,-2423.5616 1742.4291,-2422.6658 1740.1053,-2421.741"/>
<polygon fill="#000000" stroke="#000000" points="1741.188,-2418.402 1730.6082,-2417.8391 1738.5278,-2424.8769 1741.188,-2418.402"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1788" cy="-2406.4039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1788" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1886.9548,-2462.066C1866.998,-2450.8403 1840.5,-2435.9352 1819.947,-2424.3741"/>
<polygon fill="#000000" stroke="#000000" points="1821.3986,-2421.175 1810.9669,-2419.3228 1817.9668,-2427.276 1821.3986,-2421.175"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2406.4039" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1916" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2460.2353C1916,-2452.5349 1916,-2443.3783 1916,-2434.8206"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2434.8172 1916,-2424.8172 1912.5001,-2434.8172 1919.5001,-2434.8172"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2130" cy="-2406.4039" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2130" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1957.5151,-2464.4362C1991.3229,-2453.0616 2039.3025,-2436.919 2076.0788,-2424.5457"/>
<polygon fill="#000000" stroke="#000000" points="2077.2896,-2427.8311 2085.6515,-2421.3249 2075.0574,-2421.1966 2077.2896,-2427.8311"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2406.4039" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;231</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1977.2733,-2471.8874C2101.3869,-2458.6877 2382.1528,-2428.8279 2517.3937,-2414.4448"/>
<polygon fill="#000000" stroke="#000000" points="2518.0882,-2417.8907 2527.6619,-2413.3527 2517.3478,-2410.93 2518.0882,-2417.8907"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7176" cy="-2406.4039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7176" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 282&#45;317</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.029,-2477.5001C2539.7647,-2469.8657 6458.0244,-2416.2317 7090.0265,-2407.5808"/>
<polygon fill="#000000" stroke="#000000" points="7090.4664,-2411.0752 7100.4176,-2407.4385 7090.3706,-2404.0758 7090.4664,-2411.0752"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11204" cy="-2406.4039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11204" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 373&#45;424</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1981.8595,-2477.8934C2762.3154,-2471.8433 10232.4913,-2413.935 11118.3001,-2407.0683"/>
<polygon fill="#000000" stroke="#000000" points="11118.4443,-2410.5674 11128.4168,-2406.9898 11118.3899,-2403.5676 11118.4443,-2410.5674"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="13036" cy="-2406.4039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13036" y="-2402.2039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 425&#45;476</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.0829,-2478.1382C2597.909,-2475.6381 7397.2978,-2455.6448 11288,-2424.4039 11926.32,-2419.2785 12695.7294,-2410.4243 12949.9142,-2407.4286"/>
<polygon fill="#000000" stroke="#000000" points="12950.2275,-2410.9252 12960.1855,-2407.3074 12950.1449,-2403.9257 12950.2275,-2410.9252"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1468.5,-2304.8038 1375.5,-2304.8038 1375.5,-2268.8038 1468.5,-2268.8038 1468.5,-2304.8038"/>
<text text-anchor="middle" x="1422" y="-2283.3038" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1422.8481,-2388.2392C1422.6859,-2368.8332 1422.4265,-2337.8139 1422.2373,-2315.1818"/>
<polygon fill="#000000" stroke="#000000" points="1425.7369,-2315.1098 1422.1533,-2305.1394 1418.7371,-2315.1684 1425.7369,-2315.1098"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1514" cy="-2286.8038" rx="27" ry="18"/>
<text text-anchor="middle" x="1514" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1533.5567,-2388.4986C1529.8135,-2369.0341 1523.7818,-2337.6693 1519.4058,-2314.9137"/>
<polygon fill="#000000" stroke="#000000" points="1522.7924,-2313.9906 1517.4669,-2304.8316 1515.9184,-2315.3126 1522.7924,-2313.9906"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1586" cy="-2286.8038" rx="27" ry="18"/>
<text text-anchor="middle" x="1586" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1616.6104,-2388.4986C1610.7251,-2368.9461 1601.2251,-2337.3852 1594.3684,-2314.6054"/>
<polygon fill="#000000" stroke="#000000" points="1597.6602,-2313.3984 1591.4264,-2304.8316 1590.9573,-2315.416 1597.6602,-2313.3984"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1658" cy="-2286.8038" rx="27" ry="18"/>
<text text-anchor="middle" x="1658" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1698.065,-2388.7565C1690.3243,-2369.059 1677.705,-2336.9468 1668.6975,-2314.0256"/>
<polygon fill="#000000" stroke="#000000" points="1671.8785,-2312.5506 1664.9635,-2304.5236 1665.3635,-2315.1109 1671.8785,-2312.5506"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1730" cy="-2286.8038" rx="27" ry="18"/>
<text text-anchor="middle" x="1730" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1779.5663,-2389.013C1769.9445,-2369.1721 1754.0994,-2336.4986 1742.9184,-2313.4426"/>
<polygon fill="#000000" stroke="#000000" points="1745.9566,-2311.6862 1738.4439,-2304.2157 1739.6582,-2314.7407 1745.9566,-2311.6862"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057,-2352.5042 1775,-2352.5042 1775,-2221.1034 2057,-2221.1034 2057,-2352.5042"/>
<text text-anchor="middle" x="1916" y="-2337.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1916" y="-2321.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1916" y="-2306.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1916" y="-2291.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1916" y="-2275.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1916" y="-2260.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1916" y="-2244.8037" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1916" y="-2229.4037" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2388.2392C1916,-2380.9643 1916,-2372.0572 1916,-2362.5718"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2362.5217 1916,-2352.5218 1912.5001,-2362.5218 1919.5001,-2362.5217"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2304.8038 2075.5,-2304.8038 2075.5,-2268.8038 2266.5,-2268.8038 2266.5,-2304.8038"/>
<text text-anchor="middle" x="2171" y="-2283.3038" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2136.227,-2388.2392C2142.9097,-2368.7454 2153.6096,-2337.533 2161.3769,-2314.875"/>
<polygon fill="#000000" stroke="#000000" points="2164.7823,-2315.7341 2164.7144,-2305.1394 2158.1606,-2313.464 2164.7823,-2315.7341"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2286.8038" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2540.569,-2394.3279C2507.7843,-2385.4927 2465.4023,-2371.67 2431,-2352.4039 2411.3309,-2341.3888 2391.9201,-2325.0894 2377.3823,-2311.4939"/>
<polygon fill="#000000" stroke="#000000" points="2379.4802,-2308.6569 2369.8364,-2304.2697 2374.6394,-2313.7133 2379.4802,-2308.6569"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2562.6368,-2390.0618C2546.6527,-2380.4891 2527.4321,-2367.3525 2513,-2352.4039 2501.8906,-2340.897 2492.2443,-2325.8991 2485.1042,-2313.1487"/>
<polygon fill="#000000" stroke="#000000" points="2488.1857,-2311.489 2480.3629,-2304.3437 2482.0224,-2314.8077 2488.1857,-2311.489"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2286.8038" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;141</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2388.2392C2593,-2368.8332 2593,-2337.8139 2593,-2315.1818"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2315.1394 2593,-2305.1394 2589.5001,-2315.1395 2596.5001,-2315.1394"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2286.8038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 142&#45;220</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2632.7017,-2391.3776C2690.133,-2369.6409 2796.3573,-2329.437 2859.0409,-2305.7124"/>
<polygon fill="#000000" stroke="#000000" points="2860.5997,-2308.8648 2868.7133,-2302.0516 2858.1218,-2302.318 2860.5997,-2308.8648"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-2286.8038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3963" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;231</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2660.0054,-2400.5544C2888.1147,-2380.6406 3634.0436,-2315.5215 3882.022,-2293.8731"/>
<polygon fill="#000000" stroke="#000000" points="3882.3866,-2297.3547 3892.0443,-2292.9982 3881.7777,-2290.3812 3882.3866,-2297.3547"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4840" cy="-2286.8038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4840" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 232&#45;281</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.4147,-2404.9225C2873.7216,-2400.2543 3515.5884,-2384.2357 4047,-2352.4039 4308.2496,-2336.755 4617.13,-2308.3405 4760.0626,-2294.6253"/>
<polygon fill="#000000" stroke="#000000" points="4760.445,-2298.1048 4770.064,-2293.6636 4759.7749,-2291.1369 4760.445,-2298.1048"/>
</g>
<!-- header_88 -->
<g id="node89" class="node">
<title>header_88</title>
<ellipse fill="none" stroke="#000000" cx="6977" cy="-2286.8038" rx="107.339" ry="18"/>
<text text-anchor="middle" x="6977" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;header_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7147.9102,-2389.5218C7113.0959,-2368.5982 7053.6297,-2332.8587 7014.8262,-2309.5376"/>
<polygon fill="#000000" stroke="#000000" points="7016.2896,-2306.3336 7005.9155,-2304.1822 7012.6837,-2312.3334 7016.2896,-2306.3336"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7135" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7135" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7169.773,-2388.2392C7163.0515,-2368.632 7152.2659,-2337.1696 7144.4879,-2314.4807"/>
<polygon fill="#000000" stroke="#000000" points="7147.705,-2313.0722 7141.1513,-2304.7476 7141.0833,-2315.3422 7147.705,-2313.0722"/>
</g>
<!-- prose_90 -->
<g id="node91" class="node">
<title>prose_90</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7217" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;prose_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7182.227,-2388.2392C7188.9485,-2368.632 7199.7341,-2337.1696 7207.5121,-2314.4807"/>
<polygon fill="#000000" stroke="#000000" points="7210.9167,-2315.3422 7210.8487,-2304.7476 7204.295,-2313.0722 7210.9167,-2315.3422"/>
</g>
<!-- section_91 -->
<g id="node92" class="node">
<title>section_91</title>
<ellipse fill="none" stroke="#000000" cx="7804" cy="-2286.8038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7804" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 292&#45;317</text>
</g>
<!-- section_10&#45;&gt;section_91 -->
<g id="edge91" class="edge">
<title>section_10&#45;&gt;section_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7235.0807,-2395.1522C7351.4995,-2372.9807 7610.0282,-2323.745 7734.4495,-2300.0494"/>
<polygon fill="#000000" stroke="#000000" points="7735.4502,-2303.4218 7744.6188,-2298.1127 7734.1405,-2296.5454 7735.4502,-2303.4218"/>
</g>
<!-- section_92 -->
<g id="node93" class="node">
<title>section_92</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2286.8038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9340" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 318&#45;372</text>
</g>
<!-- section_10&#45;&gt;section_92 -->
<g id="edge92" class="edge">
<title>section_10&#45;&gt;section_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7249.5516,-2402.3389C7577.8074,-2384.1968 8908.0524,-2310.6767 9256.2491,-2291.4326"/>
<polygon fill="#000000" stroke="#000000" points="9256.4708,-2294.9257 9266.2623,-2290.8791 9256.0844,-2287.9364 9256.4708,-2294.9257"/>
</g>
<!-- header_140 -->
<g id="node141" class="node">
<title>header_140</title>
<ellipse fill="none" stroke="#000000" cx="10367" cy="-2286.8038" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10367" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_140 -->
<g id="edge140" class="edge">
<title>section_11&#45;&gt;header_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11130.479,-2402.2748C10987.0246,-2393.8682 10674.6014,-2373.7469 10569,-2352.4039 10516.5798,-2341.8094 10458.7172,-2322.1624 10418.4058,-2307.1214"/>
<polygon fill="#000000" stroke="#000000" points="10419.3972,-2303.7547 10408.8054,-2303.5025 10416.9281,-2310.3048 10419.3972,-2303.7547"/>
</g>
<!-- prose_141 -->
<g id="node142" class="node">
<title>prose_141</title>
<ellipse fill="none" stroke="#000000" cx="10610" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10610" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_141 -->
<g id="edge141" class="edge">
<title>section_11&#45;&gt;prose_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11146.2344,-2394.773C11026.4436,-2370.6535 10753.5682,-2315.7108 10650.4635,-2294.951"/>
<polygon fill="#000000" stroke="#000000" points="10650.9485,-2291.4785 10640.4543,-2292.9357 10649.5667,-2298.3408 10650.9485,-2291.4785"/>
</g>
<!-- prose_142 -->
<g id="node143" class="node">
<title>prose_142</title>
<ellipse fill="none" stroke="#000000" cx="11056" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11056" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_142 -->
<g id="edge142" class="edge">
<title>section_11&#45;&gt;prose_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11182.4795,-2389.013C11156.0651,-2367.6673 11111.2709,-2331.4687 11082.6903,-2308.3725"/>
<polygon fill="#000000" stroke="#000000" points="11084.7115,-2305.5058 11074.7338,-2301.9427 11080.3117,-2310.9503 11084.7115,-2305.5058"/>
</g>
<!-- prose_143 -->
<g id="node144" class="node">
<title>prose_143</title>
<ellipse fill="none" stroke="#000000" cx="11204" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11204" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_143 -->
<g id="edge143" class="edge">
<title>section_11&#45;&gt;prose_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11204,-2388.2392C11204,-2368.8332 11204,-2337.8139 11204,-2315.1818"/>
<polygon fill="#000000" stroke="#000000" points="11207.5001,-2315.1394 11204,-2305.1394 11200.5001,-2315.1395 11207.5001,-2315.1394"/>
</g>
<!-- prose_144 -->
<g id="node145" class="node">
<title>prose_144</title>
<ellipse fill="none" stroke="#000000" cx="11286" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11286" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_144 -->
<g id="edge144" class="edge">
<title>section_11&#45;&gt;prose_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11218.0822,-2388.7048C11226.1929,-2378.3051 11236.4429,-2364.8051 11245,-2352.4039 11253.8135,-2339.6312 11263.0235,-2325.0244 11270.4766,-2312.8413"/>
<polygon fill="#000000" stroke="#000000" points="11273.6046,-2314.433 11275.798,-2304.0677 11267.6195,-2310.8029 11273.6046,-2314.433"/>
</g>
<!-- prose_145 -->
<g id="node146" class="node">
<title>prose_145</title>
<ellipse fill="none" stroke="#000000" cx="11368" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11368" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_145 -->
<g id="edge145" class="edge">
<title>section_11&#45;&gt;prose_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11252.7315,-2392.5895C11277.008,-2383.9341 11305.654,-2370.8609 11327,-2352.4039 11339.2625,-2341.801 11349.0762,-2326.6131 11356.0243,-2313.5209"/>
<polygon fill="#000000" stroke="#000000" points="11359.2172,-2314.9616 11360.5711,-2304.4537 11352.9598,-2311.8238 11359.2172,-2314.9616"/>
</g>
<!-- prose_146 -->
<g id="node147" class="node">
<title>prose_146</title>
<ellipse fill="none" stroke="#000000" cx="11450" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11450" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_146 -->
<g id="edge146" class="edge">
<title>section_11&#45;&gt;prose_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11264.5801,-2395.5716C11316.4067,-2385.3912 11386.1458,-2369.2388 11409,-2352.4039 11422.2261,-2342.6614 11432.1731,-2327.2535 11438.9552,-2313.8179"/>
<polygon fill="#000000" stroke="#000000" points="11442.2519,-2315.0317 11443.3359,-2304.4925 11435.9162,-2312.0554 11442.2519,-2315.0317"/>
</g>
<!-- codeblock_147 -->
<g id="node148" class="node">
<title>codeblock_147</title>
<ellipse fill="none" stroke="#000000" cx="11681" cy="-2286.8038" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11681" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 390&#45;422</text>
</g>
<!-- section_11&#45;&gt;codeblock_147 -->
<g id="edge147" class="edge">
<title>section_11&#45;&gt;codeblock_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11268.7207,-2397.0042C11327.288,-2387.8432 11415.6519,-2372.3847 11491,-2352.4039 11539.149,-2339.6358 11592.676,-2320.7107 11630.6134,-2306.4646"/>
<polygon fill="#000000" stroke="#000000" points="11632.28,-2309.5763 11640.3954,-2302.7652 11629.8038,-2303.0289 11632.28,-2309.5763"/>
</g>
<!-- header_168 -->
<g id="node169" class="node">
<title>header_168</title>
<ellipse fill="none" stroke="#000000" cx="12782" cy="-2286.8038" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="12782" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_168 -->
<g id="edge168" class="edge">
<title>section_12&#45;&gt;header_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12999.8916,-2390.5207C12975.9965,-2379.9201 12944.0197,-2365.5627 12916,-2352.4039 12885.2005,-2337.9397 12850.725,-2321.046 12824.4566,-2308.025"/>
<polygon fill="#000000" stroke="#000000" points="12825.6853,-2304.7274 12815.172,-2303.4146 12822.572,-2310.997 12825.6853,-2304.7274"/>
</g>
<!-- prose_169 -->
<g id="node170" class="node">
<title>prose_169</title>
<ellipse fill="none" stroke="#000000" cx="12957" cy="-2286.8038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12957" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_169 -->
<g id="edge169" class="edge">
<title>section_12&#45;&gt;prose_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13024.1729,-2388.4986C13010.8731,-2368.3636 12989.1618,-2335.4943 12974.0351,-2312.5937"/>
<polygon fill="#000000" stroke="#000000" points="12976.8263,-2310.469 12968.3944,-2304.054 12970.9855,-2314.3271 12976.8263,-2310.469"/>
</g>
<!-- codeblock_170 -->
<g id="node171" class="node">
<title>codeblock_170</title>
<ellipse fill="none" stroke="#000000" cx="13106" cy="-2286.8038" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13106" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 427&#45;440</text>
</g>
<!-- section_12&#45;&gt;codeblock_170 -->
<g id="edge170" class="edge">
<title>section_12&#45;&gt;codeblock_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13046.4797,-2388.4986C13058.0781,-2368.6818 13076.8961,-2336.53 13090.2659,-2313.6867"/>
<polygon fill="#000000" stroke="#000000" points="13093.418,-2315.23 13095.4487,-2304.8316 13087.3767,-2311.6941 13093.418,-2315.23"/>
</g>
<!-- section_171 -->
<g id="node172" class="node">
<title>section_171</title>
<ellipse fill="none" stroke="#000000" cx="13550" cy="-2286.8038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13550" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 443&#45;476</text>
</g>
<!-- section_12&#45;&gt;section_171 -->
<g id="edge171" class="edge">
<title>section_12&#45;&gt;section_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13090.0355,-2393.8307C13185.5721,-2371.6007 13383.8455,-2325.4655 13486.0355,-2301.6874"/>
<polygon fill="#000000" stroke="#000000" points="13486.9706,-2305.0634 13495.9172,-2299.3881 13485.3842,-2298.2455 13486.9706,-2305.0634"/>
</g>
<!-- section_172 -->
<g id="node173" class="node">
<title>section_172</title>
<ellipse fill="none" stroke="#000000" cx="14484" cy="-2286.8038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14484" y="-2282.6038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 477&#45;510</text>
</g>
<!-- section_12&#45;&gt;section_172 -->
<g id="edge172" class="edge">
<title>section_12&#45;&gt;section_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13107.8065,-2400.4729C13351.3619,-2380.3561 14145.1454,-2314.7921 14402.5878,-2293.5282"/>
<polygon fill="#000000" stroke="#000000" points="14402.9381,-2297.0113 14412.6161,-2292.6999 14402.3619,-2290.035 14402.9381,-2297.0113"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-1978.1044 0,-1978.1044 0,-1906.3021 324,-1906.3021 324,-1978.1044"/>
<text text-anchor="middle" x="162" y="-1914.7032" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1509.2631,-2268.8264C1504.1163,-2253.2526 1494.2259,-2231.6316 1477,-2221.2037 1368.2075,-2155.3446 444.9379,-2245.5621 333,-2185.2037 253.8074,-2142.502 203.1504,-2045.1947 178.9047,-1987.5065"/>
<polygon fill="#000000" stroke="#000000" points="181.9997,-1985.8298 174.9615,-1977.9106 175.525,-1988.4904 181.9997,-1985.8298"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-1969.5036 342.5,-1969.5036 342.5,-1914.9028 897.5,-1914.9028 897.5,-1969.5036"/>
<text text-anchor="middle" x="620" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1581.4695,-2268.9407C1576.5146,-2253.4439 1566.9248,-2231.8716 1550,-2221.2037 1428.9306,-2144.8922 1039.9435,-2238.1874 907,-2185.2037 794.8574,-2140.51 694.985,-2033.6059 648.1627,-1977.6761"/>
<polygon fill="#000000" stroke="#000000" points="650.719,-1975.2755 641.6443,-1969.8075 645.3284,-1979.7412 650.719,-1975.2755"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-1969.5036 916,-1969.5036 916,-1914.9028 1464,-1914.9028 1464,-1969.5036"/>
<text text-anchor="middle" x="1190" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1652.7687,-2269.0606C1647.4348,-2254.0779 1637.6842,-2233.2008 1622,-2221.2037 1567.8877,-2179.8123 1533.6389,-2216.2571 1473,-2185.2037 1367.5178,-2131.1859 1268.2287,-2030.223 1220.1801,-1977.0351"/>
<polygon fill="#000000" stroke="#000000" points="1222.7486,-1974.6568 1213.4682,-1969.5456 1217.5357,-1979.3285 1222.7486,-1974.6568"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-1977.5036 1482,-1977.5036 1482,-1906.9029 2030,-1906.9029 2030,-1977.5036"/>
<text text-anchor="middle" x="1756" y="-1946.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1931.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.3613,-2268.7618C1735.2931,-2216.6499 1746.7545,-2064.7415 1752.5538,-1987.8792"/>
<polygon fill="#000000" stroke="#000000" points="1756.0707,-1987.7849 1753.3331,-1977.5499 1749.0906,-1987.2582 1756.0707,-1987.7849"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-1960.2032 2048,-1960.2032 2048,-1924.2032 2162,-1924.2032 2162,-1960.2032"/>
<text text-anchor="middle" x="2105" y="-1938.7032" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2335.8279,-2269.1154C2320.8942,-2254.5753 2298.0823,-2234.3051 2275,-2221.2037 2232.4615,-2197.0589 2204.3904,-2220.9468 2171,-2185.2037 2114.4218,-2124.6389 2105.4467,-2020.5041 2104.5977,-1970.5511"/>
<polygon fill="#000000" stroke="#000000" points="2108.0971,-1970.4439 2104.5265,-1960.4689 2101.0973,-1970.4934 2108.0971,-1970.4439"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2465.6617,-2269.1314C2459.2854,-2253.9815 2447.9512,-2232.818 2431,-2221.2037 2360.8192,-2173.1184 2301.876,-2246.6133 2243,-2185.2037 2186.768,-2126.5518 2194.2949,-2020.6105 2201.8242,-1970.2525"/>
<polygon fill="#000000" stroke="#000000" points="2205.3237,-1970.5348 2203.4565,-1960.1058 2198.4126,-1969.4229 2205.3237,-1970.5348"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-1942.2032" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2575.1932,-2269.3376C2559.758,-2254.9332 2536.2962,-2234.7372 2513,-2221.2037 2474.317,-2198.7314 2450.3429,-2217.1255 2419,-2185.2037 2359.402,-2124.505 2339.8138,-2020.4347 2333.6615,-1970.5241"/>
<polygon fill="#000000" stroke="#000000" points="2337.1234,-1969.9902 2332.5138,-1960.4508 2330.1684,-1970.7827 2337.1234,-1969.9902"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2571.5678,-2269.3908C2550.32,-2250.8577 2518.6096,-2219.5196 2502,-2185.2037 2467.2181,-2113.3432 2460.8228,-2017.2377 2459.9145,-1970.3366"/>
<polygon fill="#000000" stroke="#000000" points="2463.414,-1970.2631 2459.7913,-1960.3069 2456.4145,-1970.3492 2463.414,-1970.2631"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-1942.2032" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;139</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2268.7618C2593,-2212.3688 2593,-2039.1086 2593,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-1970.4824 2593,-1960.4824 2589.5001,-1970.4824 2596.5001,-1970.4824"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-1942.2032" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.6243,-2268.8647C2893.3242,-2248.6002 2879.4986,-2214.6104 2868,-2185.2037 2837.5313,-2107.2823 2802.9207,-2014.7175 2786.163,-1969.6289"/>
<polygon fill="#000000" stroke="#000000" points="2789.439,-1968.3964 2782.6767,-1960.2403 2782.8768,-1970.8332 2789.439,-1968.3964"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2268.7618C2909,-2212.3688 2909,-2039.1086 2909,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-1970.4824 2909,-1960.4824 2905.5001,-1970.4824 2912.5001,-1970.4824"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2917.6242,-2268.8658C2926.9013,-2248.8824 2941.4669,-2215.406 2950,-2185.2037 2971.5381,-2108.9709 2983.3683,-2015.8943 2988.2665,-1970.2175"/>
<polygon fill="#000000" stroke="#000000" points="2991.7572,-1970.4878 2989.3124,-1960.1789 2984.7949,-1969.7624 2991.7572,-1970.4878"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3212" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3212" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;218</text>
</g>
<!-- section_27&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2933.1274,-2269.639C2959.0532,-2250.588 3000.7408,-2218.1604 3032,-2185.2037 3100.2515,-2113.2458 3165.7887,-2015.1672 3195.4533,-1968.7001"/>
<polygon fill="#000000" stroke="#000000" points="3198.4963,-1970.4369 3200.8981,-1960.1179 3192.5855,-1966.6869 3198.4963,-1970.4369"/>
</g>
<!-- header_50 -->
<g id="node51" class="node">
<title>header_50</title>
<ellipse fill="none" stroke="#000000" cx="3722" cy="-1942.2032" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3722" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_50 -->
<g id="edge50" class="edge">
<title>section_28&#45;&gt;header_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3950.3821,-2268.7618C3910.6185,-2211.9046 3787.7717,-2036.2487 3740.6574,-1968.881"/>
<polygon fill="#000000" stroke="#000000" points="3743.3831,-1966.6713 3734.7837,-1960.4824 3737.6467,-1970.6831 3743.3831,-1966.6713"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3963" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_28&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963,-2268.7618C3963,-2212.3688 3963,-2039.1086 3963,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="3966.5001,-1970.4824 3963,-1960.4824 3959.5001,-1970.4824 3966.5001,-1970.4824"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4045" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4045" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_28&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3971.6242,-2268.8658C3980.9013,-2248.8824 3995.4669,-2215.406 4004,-2185.2037 4025.5381,-2108.9709 4037.3683,-2015.8943 4042.2665,-1970.2175"/>
<polygon fill="#000000" stroke="#000000" points="4045.7572,-1970.4878 4043.3124,-1960.1789 4038.7949,-1969.7624 4045.7572,-1970.4878"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="4183" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4183" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;229</text>
</g>
<!-- section_28&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_28&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3990.6451,-2269.9309C4018.1098,-2251.9375 4059.8068,-2221.1212 4086,-2185.2037 4136.1395,-2116.4495 4164.8399,-2018.1971 4176.6293,-1970.4346"/>
<polygon fill="#000000" stroke="#000000" points="4180.0834,-1971.0396 4179.016,-1960.4987 4173.2771,-1969.4046 4180.0834,-1971.0396"/>
</g>
<!-- header_60 -->
<g id="node61" class="node">
<title>header_60</title>
<ellipse fill="none" stroke="#000000" cx="4594" cy="-1942.2032" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4594" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_60 -->
<g id="edge60" class="edge">
<title>section_29&#45;&gt;header_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4813.5116,-2269.7731C4786.5752,-2251.4316 4744.9341,-2220.1399 4717,-2185.2037 4661.5672,-2115.8759 4621.2913,-2017.5552 4603.7511,-1970.0426"/>
<polygon fill="#000000" stroke="#000000" points="4606.9652,-1968.6394 4600.2603,-1960.4361 4600.3861,-1971.0302 4606.9652,-1968.6394"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4758" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4758" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_29&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4831.3758,-2268.8658C4822.0987,-2248.8824 4807.5331,-2215.406 4799,-2185.2037 4777.4619,-2108.9709 4765.6317,-2015.8943 4760.7335,-1970.2175"/>
<polygon fill="#000000" stroke="#000000" points="4764.2051,-1969.7624 4759.6876,-1960.1789 4757.2428,-1970.4878 4764.2051,-1969.7624"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="4840" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4840" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_29&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4840,-2268.7618C4840,-2212.3688 4840,-2039.1086 4840,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="4843.5001,-1970.4824 4840,-1960.4824 4836.5001,-1970.4824 4843.5001,-1970.4824"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5466" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5466" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_29&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4870.1933,-2270.183C4975.5605,-2212.1805 5326.3932,-2019.054 5434.2059,-1959.7053"/>
<polygon fill="#000000" stroke="#000000" points="5435.9287,-1962.7522 5443.0013,-1954.8636 5432.553,-1956.6199 5435.9287,-1962.7522"/>
</g>
<!-- prose_64 -->
<g id="node65" class="node">
<title>prose_64</title>
<ellipse fill="none" stroke="#000000" cx="5694" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5694" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_64 -->
<g id="edge64" class="edge">
<title>section_29&#45;&gt;prose_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4913.5419,-2282.4821C5065.3463,-2272.4657 5407.5029,-2243.9068 5507,-2185.2037 5595.7289,-2132.8538 5657.1734,-2020.7823 5681.8784,-1969.2014"/>
<polygon fill="#000000" stroke="#000000" points="5685.1102,-1970.5535 5686.1947,-1960.0143 5678.7746,-1967.5769 5685.1102,-1970.5535"/>
</g>
<!-- codeblock_65 -->
<g id="node66" class="node">
<title>codeblock_65</title>
<ellipse fill="none" stroke="#000000" cx="5985" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5985" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;279</text>
</g>
<!-- section_29&#45;&gt;codeblock_65 -->
<g id="edge65" class="edge">
<title>section_29&#45;&gt;codeblock_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4915.16,-2284.479C5103.3562,-2277.6799 5590.1228,-2253.7844 5735,-2185.2037 5841.5347,-2134.7732 5930.6505,-2020.457 5967.203,-1968.6293"/>
<polygon fill="#000000" stroke="#000000" points="5970.1703,-1970.4928 5973.0123,-1960.2862 5964.4257,-1966.4928 5970.1703,-1970.4928"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1882,-912.6029 1544,-912.6029 1544,-856.7999 1882,-856.7999 1882,-912.6029"/>
<text text-anchor="middle" x="1713" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2210.7744,-1924.0724C2219.0224,-1878.841 2233.2599,-1760.2781 2171,-1699.2027 2081.4322,-1611.3391 1983.913,-1747.5212 1891,-1663.2027 1670.0544,-1462.6948 1694.7899,-1049.1619 1708.2864,-922.4418"/>
<polygon fill="#000000" stroke="#000000" points="1711.7714,-922.77 1709.3923,-912.4457 1704.8138,-922.0002 1711.7714,-922.77"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2042,-902.7014 1900,-902.7014 1900,-866.7014 2042,-866.7014 2042,-902.7014"/>
<text text-anchor="middle" x="1971" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2330.238,-1923.8709C2327.2876,-1878.1733 2312.9216,-1758.6185 2243,-1699.2027 2176.8399,-1642.9833 2109.7931,-1727.0866 2051,-1663.2027 1848.0014,-1442.6272 1935.4878,-1024.0011 1963.5354,-912.542"/>
<polygon fill="#000000" stroke="#000000" points="1966.9573,-913.2877 1966.0523,-902.7315 1960.1769,-911.548 1966.9573,-913.2877"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2087" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2087" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2463.3723,-1923.9933C2470.6223,-1878.5789 2482.277,-1759.6266 2419,-1699.2027 2323.1548,-1607.6792 2213.139,-1760.3512 2123,-1663.2027 2019.9424,-1552.1311 2069.6575,-1039.5187 2083.7102,-912.9927"/>
<polygon fill="#000000" stroke="#000000" points="2087.2019,-913.262 2084.8434,-902.933 2080.2459,-912.4783 2087.2019,-913.262"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2680,-1663.2041 2132,-1663.2041 2132,-106.1988 2680,-106.1988 2680,-1663.2041"/>
<text text-anchor="middle" x="2406" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2406" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2406" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2406" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2406" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2406" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2406" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2406" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2406" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2406" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2406" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2406" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2406" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2406" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2406" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2406" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2406" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2406" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2406" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2406" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2406" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2406" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2406" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2406" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2406" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2406" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2406" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2406" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2406" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2406" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2406" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2406" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2406" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2406" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2406" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2406" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2406" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2406" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2406" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2406" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2406" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2406" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2406" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2406" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2406" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2406" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2406" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2406" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2406" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2406" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.7543,-1923.8483C2582.979,-1885.5337 2566.2213,-1790.7672 2545.4329,-1673.2067"/>
<polygon fill="#000000" stroke="#000000" points="2548.8581,-1672.4764 2543.6702,-1663.2387 2541.965,-1673.6954 2548.8581,-1672.4764"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2114,-53.1 2060,-53.1 2060,-17.1 2114,-17.1 2114,-53.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2087,-866.5632C2087,-758.2631 2087,-197.2221 2087,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2090.5001,-63.4293 2087,-53.4293 2083.5001,-63.4293 2090.5001,-63.4293"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="2854,-902.7014 2698,-902.7014 2698,-866.7014 2854,-866.7014 2854,-902.7014"/>
<text text-anchor="middle" x="2776" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>header_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776,-1923.8483C2776,-1798.2314 2776,-1065.8155 2776,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="2779.5001,-912.7369 2776,-902.7369 2772.5001,-912.7369 2779.5001,-912.7369"/>
</g>
<!-- raw_45 -->
<g id="node46" class="node">
<title>raw_45</title>
<ellipse fill="none" stroke="#000000" cx="2899" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2899" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;raw_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.8264,-1923.8483C2907.6386,-1798.2314 2900.7127,-1065.8155 2899.2651,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="2902.765,-912.7033 2899.1705,-902.7369 2895.7654,-912.7696 2902.765,-912.7033"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_42&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.6529,-1923.8483C2988.2771,-1798.2314 2974.4253,-1065.8155 2971.5303,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="2975.0297,-912.6689 2971.3411,-902.7369 2968.0309,-912.8013 2975.0297,-912.6689"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="3571.5,-1412.5035 3016.5,-1412.5035 3016.5,-356.8993 3571.5,-356.8993 3571.5,-1412.5035"/>
<text text-anchor="middle" x="3294" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3294" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3294" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3294" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3294" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3294" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3294" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3294" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3294" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3294" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3294" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3294" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3294" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3294" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3294" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3294" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3294" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3294" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3294" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3294" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3294" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3294" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3294" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3294" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3294" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3294" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3294" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3294" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3294" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3294" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3294" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3294" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3294" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3294" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3294" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3294" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3294" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3294" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3294" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3294" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3294" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3294" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3294" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3294" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3294" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3294" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3294" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3294" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3294" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3294" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3294" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_43&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3213.4233,-1923.8483C3218.3375,-1860.4722 3235.2284,-1642.642 3252.2844,-1422.6815"/>
<polygon fill="#000000" stroke="#000000" points="3255.7872,-1422.7793 3253.0709,-1412.5386 3248.8081,-1422.2381 3255.7872,-1422.7793"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2677,-63.0015 2157,-63.0015 2157,-7.1986 2677,-7.1986 2677,-63.0015"/>
<text text-anchor="middle" x="2417" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>raw_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.093,-866.5278C2912.8891,-760.4937 2966.925,-222.4545 2863,-106.2001 2854.7496,-96.9708 2746.0706,-79.5409 2638.0717,-64.2491"/>
<polygon fill="#000000" stroke="#000000" points="2638.3528,-60.7542 2627.9621,-62.8235 2637.3754,-67.6856 2638.3528,-60.7542"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3194.5,-62.4005 2695.5,-62.4005 2695.5,-7.7996 3194.5,-7.7996 3194.5,-62.4005"/>
<text text-anchor="middle" x="2945" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2945" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2970.4449,-866.5632C2967.2032,-760.635 2950.7067,-221.5794 2946.1611,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2949.647,-72.525 2945.8427,-62.6367 2942.6503,-72.7391 2949.647,-72.525"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="3920.5,-902.7014 3589.5,-902.7014 3589.5,-866.7014 3920.5,-866.7014 3920.5,-902.7014"/>
<text text-anchor="middle" x="3755" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_50&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_50&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3722.5728,-1923.8483C3726.4927,-1798.2314 3749.3482,-1065.8155 3754.125,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="3757.6235,-912.8412 3754.4372,-902.7369 3750.6269,-912.6228 3757.6235,-912.8412"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="3966" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3966" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_51&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963.0521,-1923.8483C3963.4084,-1798.2314 3965.4862,-1065.8155 3965.9205,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="3969.4204,-912.7468 3965.9488,-902.7369 3962.4204,-912.7269 3969.4204,-912.7468"/>
</g>
<!-- raw_57 -->
<g id="node58" class="node">
<title>raw_57</title>
<ellipse fill="none" stroke="#000000" cx="4040" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4040" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;raw_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4044.9132,-1923.8483C4044.3193,-1798.2314 4040.8563,-1065.8155 4040.1326,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="4043.6326,-912.7202 4040.0853,-902.7369 4036.6327,-912.7534 4043.6326,-912.7202"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4210,-902.7014 4156,-902.7014 4156,-866.7014 4210,-866.7014 4210,-902.7014"/>
</g>
<!-- codeblock_53&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>codeblock_53&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4183,-1923.8483C4183,-1798.2314 4183,-1065.8155 4183,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="4186.5001,-912.7369 4183,-902.7369 4179.5001,-912.7369 4186.5001,-912.7369"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3579,-63.0015 3213,-63.0015 3213,-7.1986 3579,-7.1986 3579,-63.0015"/>
<text text-anchor="middle" x="3396" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_55&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>raw_55&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.158,-866.4429C3980.3209,-759.9257 4036.0427,-219.6034 3929,-106.2001 3876.6957,-50.7878 3663.4211,-81.0594 3588,-70.2001 3575.9584,-68.4663 3563.518,-66.5285 3551.0275,-64.4779"/>
<polygon fill="#000000" stroke="#000000" points="3551.4451,-60.9994 3541.0063,-62.811 3550.2964,-67.9045 3551.4451,-60.9994"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="3942.5,-55.0021 3597.5,-55.0021 3597.5,-15.198 3942.5,-15.198 3942.5,-55.0021"/>
<text text-anchor="middle" x="3770" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_57&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>raw_57&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4045.7198,-866.9385C4074.0949,-775.1152 4191.0126,-349.1899 4002,-106.2001 3986.5094,-86.2857 3934.7245,-69.4415 3884.0003,-57.1541"/>
<polygon fill="#000000" stroke="#000000" points="3884.7537,-53.7358 3874.2161,-54.8355 3883.1396,-60.5471 3884.7537,-53.7358"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4703.5,-902.7014 4484.5,-902.7014 4484.5,-866.7014 4703.5,-866.7014 4703.5,-902.7014"/>
<text text-anchor="middle" x="4594" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>header_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4594,-1923.8483C4594,-1798.2314 4594,-1065.8155 4594,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="4597.5001,-912.7369 4594,-902.7369 4590.5001,-912.7369 4597.5001,-912.7369"/>
</g>
<!-- raw_67 -->
<g id="node68" class="node">
<title>raw_67</title>
<ellipse fill="none" stroke="#000000" cx="4753" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4753" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_67 -->
<g id="edge67" class="edge">
<title>prose_61&#45;&gt;raw_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4757.9132,-1923.8483C4757.3193,-1798.2314 4753.8563,-1065.8155 4753.1326,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="4756.6326,-912.7202 4753.0853,-902.7369 4749.6327,-912.7534 4756.6326,-912.7202"/>
</g>
<!-- raw_69 -->
<g id="node70" class="node">
<title>raw_69</title>
<ellipse fill="none" stroke="#000000" cx="4832" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4832" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_69 -->
<g id="edge69" class="edge">
<title>prose_62&#45;&gt;raw_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4839.8611,-1923.8483C4838.9109,-1798.2314 4833.3701,-1065.8155 4832.2121,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="4835.7121,-912.7101 4832.1364,-902.7369 4828.7123,-912.7631 4835.7121,-912.7101"/>
</g>
<!-- raw_71 -->
<g id="node72" class="node">
<title>raw_71</title>
<ellipse fill="none" stroke="#000000" cx="5143" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5143" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_71 -->
<g id="edge71" class="edge">
<title>prose_63&#45;&gt;raw_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5451.2936,-1926.0484C5415.1333,-1885.3453 5321.5944,-1773.9092 5277,-1663.2027 5165.3864,-1386.1198 5146.697,-1016.9686 5143.6048,-913.0042"/>
<polygon fill="#000000" stroke="#000000" points="5147.0956,-912.6144 5143.3252,-902.7132 5140.0982,-912.8046 5147.0956,-912.6144"/>
</g>
<!-- prespace_72 -->
<g id="node73" class="node">
<title>prespace_72</title>
<ellipse fill="none" stroke="#000000" cx="5332" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5332" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_72 -->
<g id="edge72" class="edge">
<title>prose_63&#45;&gt;prespace_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5459.717,-1924.5368C5444.4819,-1880.862 5405.5387,-1764.0389 5388,-1663.2027 5337.5913,-1373.3848 5332.406,-1015.2693 5331.9942,-913.1027"/>
<polygon fill="#000000" stroke="#000000" points="5335.494,-912.9601 5331.9663,-902.9698 5328.494,-912.9795 5335.494,-912.9601"/>
</g>
<!-- literal_73 -->
<g id="node74" class="node">
<title>literal_73</title>
<ellipse fill="none" stroke="#000000" cx="5428" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5428" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_73 -->
<g id="edge73" class="edge">
<title>prose_63&#45;&gt;literal_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5465.3404,-1923.8483C5460.8266,-1798.2314 5434.5081,-1065.8155 5429.0076,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="5432.505,-912.6047 5428.6481,-902.7369 5425.5095,-912.8562 5432.505,-912.6047"/>
</g>
<!-- raw_74 -->
<g id="node75" class="node">
<title>raw_74</title>
<ellipse fill="none" stroke="#000000" cx="5504" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5504" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_74 -->
<g id="edge74" class="edge">
<title>prose_63&#45;&gt;raw_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5466.6596,-1923.8483C5471.1734,-1798.2314 5497.4919,-1065.8155 5502.9924,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="5506.4905,-912.8562 5503.3519,-902.7369 5499.495,-912.6047 5506.4905,-912.8562"/>
</g>
<!-- prespace_75 -->
<g id="node76" class="node">
<title>prespace_75</title>
<ellipse fill="none" stroke="#000000" cx="5595" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5595" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_75 -->
<g id="edge75" class="edge">
<title>prose_63&#45;&gt;prespace_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5471.9481,-1924.5064C5486.3734,-1880.7632 5523.2601,-1763.7981 5540,-1663.2027 5588.2837,-1373.0504 5594.2289,-1015.1677 5594.9208,-913.0795"/>
<polygon fill="#000000" stroke="#000000" points="5598.4213,-912.974 5594.9773,-902.9546 5591.4214,-912.9349 5598.4213,-912.974"/>
</g>
<!-- literal_76 -->
<g id="node77" class="node">
<title>literal_76</title>
<ellipse fill="none" stroke="#000000" cx="5691" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5691" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_76 -->
<g id="edge76" class="edge">
<title>prose_63&#45;&gt;literal_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5481.1127,-1926.2629C5518.1314,-1886.049 5613.0109,-1775.6414 5650,-1663.2027 5742.1141,-1383.1965 5707.1706,-1016.1592 5694.6883,-912.8371"/>
<polygon fill="#000000" stroke="#000000" points="5698.157,-912.3678 5693.4541,-902.874 5691.2101,-913.2284 5698.157,-912.3678"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="5767" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5767" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_63&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5475.3291,-1924.9026C5499.4386,-1881.5922 5567.9192,-1767.1161 5653,-1699.2027 5682.8401,-1675.3837 5709.6848,-1694.8798 5731,-1663.2027 5815.4114,-1537.7568 5779.8704,-1037.9501 5769.4874,-913.0844"/>
<polygon fill="#000000" stroke="#000000" points="5772.95,-912.4935 5768.62,-902.8239 5765.9749,-913.0832 5772.95,-912.4935"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5839" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5839" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_64&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_64&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5703.0978,-1924.8749C5725.1031,-1881.961 5781.0091,-1766.7186 5803,-1663.2027 5864.1046,-1375.5708 5847.4055,-1015.2311 5840.9665,-912.9348"/>
<polygon fill="#000000" stroke="#000000" points="5844.4489,-912.5484 5840.3078,-902.7964 5837.4636,-913.0023 5844.4489,-912.5484"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6390,-1127.7024 5884,-1127.7024 5884,-641.7005 6390,-641.7005 6390,-1127.7024"/>
<text text-anchor="middle" x="6137" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6137" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6137" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6137" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6137" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6137" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6137" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6137" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6137" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6137" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6137" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6137" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6137" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6137" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6137" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6137" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6137" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6137" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6137" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_65&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>codeblock_65&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5987.6382,-1923.8483C6000.8489,-1831.9387 6060.7505,-1415.1882 6100.5645,-1138.192"/>
<polygon fill="#000000" stroke="#000000" points="6104.0728,-1138.384 6102.0313,-1127.9877 6097.144,-1137.388 6104.0728,-1138.384"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="4235.5,-63.0015 3960.5,-63.0015 3960.5,-7.1986 4235.5,-7.1986 4235.5,-63.0015"/>
<text text-anchor="middle" x="4098" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_67&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>raw_67&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4755.0652,-866.7361C4766.826,-760.7481 4821.066,-217.9513 4712,-106.2001 4675.6503,-68.9555 4296.4136,-78.2685 4245,-70.2001 4235.3768,-68.6899 4225.4532,-66.8796 4215.5187,-64.8879"/>
<polygon fill="#000000" stroke="#000000" points="4216.0923,-61.4326 4205.5913,-62.8401 4214.6781,-68.2882 4216.0923,-61.4326"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="4816,-70.3004 4254,-70.3004 4254,.1003 4816,.1003 4816,-70.3004"/>
<text text-anchor="middle" x="4535" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4535" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4535" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_69&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>raw_69&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4837.6886,-866.832C4865.8873,-774.4774 4981.802,-346.3259 4789,-106.2001 4778.9107,-93.6344 4755.1698,-82.6038 4726.0465,-73.214"/>
<polygon fill="#000000" stroke="#000000" points="4727.0003,-69.8454 4716.4122,-70.2232 4724.9249,-76.5307 4727.0003,-69.8454"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5354,-62.4005 4834,-62.4005 4834,-7.7996 5354,-7.7996 5354,-62.4005"/>
<text text-anchor="middle" x="5094" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5094" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5141.9539,-866.5632C5135.8446,-760.635 5104.755,-221.5794 5096.1882,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="5099.6582,-72.4186 5095.5882,-62.6367 5092.6698,-72.8217 5099.6582,-72.4186"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5426,-53.1 5372,-53.1 5372,-17.1 5426,-17.1 5426,-53.1"/>
<text text-anchor="middle" x="5399" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>prespace_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5332.7569,-866.5464C5336.4407,-780.9458 5353.7264,-409.1554 5388,-106.2001 5389.6016,-92.0433 5391.9597,-76.387 5394.0822,-63.3778"/>
<polygon fill="#000000" stroke="#000000" points="5397.5929,-63.6037 5395.788,-53.1637 5390.6885,-62.4506 5397.5929,-63.6037"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5509.5,-53.1 5444.5,-53.1 5444.5,-17.1 5509.5,-17.1 5509.5,-53.1"/>
<text text-anchor="middle" x="5477" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>literal_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5428.432,-866.5619C5430.5738,-781.0313 5441.049,-409.5083 5468,-106.2001 5469.2561,-92.0638 5471.1796,-76.4098 5472.9263,-63.3967"/>
<polygon fill="#000000" stroke="#000000" points="5476.4365,-63.5623 5474.3335,-53.1783 5469.5019,-62.6073 5476.4365,-63.5623"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5796,-54.4006 5528,-54.4006 5528,-15.7995 5796,-15.7995 5796,-54.4006"/>
<text text-anchor="middle" x="5662" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5662" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>raw_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5502.5697,-866.7002C5494.6419,-762.7666 5459.2925,-239.4258 5540,-106.2001 5552.6148,-85.3766 5573.8026,-70.0093 5595.0134,-58.9987"/>
<polygon fill="#000000" stroke="#000000" points="5596.6488,-62.0949 5604.0802,-54.5434 5593.5617,-55.8124 5596.6488,-62.0949"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5868,-53.1 5814,-53.1 5814,-17.1 5868,-17.1 5868,-53.1"/>
<text text-anchor="middle" x="5841" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>prespace_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5593.5385,-866.6033C5585.4039,-760.9991 5549.6202,-224.9911 5651,-106.2001 5696.6294,-52.7342 5743.3552,-103.9723 5805,-70.2001 5809.8804,-67.5264 5814.5625,-64.0077 5818.8426,-60.2306"/>
<polygon fill="#000000" stroke="#000000" points="5821.288,-62.7347 5826.0683,-53.2795 5816.4351,-57.69 5821.288,-62.7347"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="5944,-53.1 5886,-53.1 5886,-17.1 5944,-17.1 5944,-53.1"/>
<text text-anchor="middle" x="5915" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>literal_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5689.1556,-866.6474C5678.7883,-761.2947 5631.6944,-226.4751 5731,-106.2001 5773.5511,-54.6639 5818.15,-101.8741 5877,-70.2001 5882.0415,-67.4867 5886.9286,-63.948 5891.4255,-60.1634"/>
<polygon fill="#000000" stroke="#000000" points="5894.0184,-62.5356 5899.0477,-53.2106 5889.301,-57.364 5894.0184,-62.5356"/>
</g>
<!-- leaf_84 -->
<g id="node85" class="node">
<title>leaf_84</title>
<polygon fill="none" stroke="#c0c0c0" points="6048,-53.1 5962,-53.1 5962,-17.1 6048,-17.1 6048,-53.1"/>
<text text-anchor="middle" x="6005" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_77&#45;&gt;leaf_84 -->
<g id="edge84" class="edge">
<title>raw_77&#45;&gt;leaf_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5765.0433,-866.6449C5754.0231,-761.278 5703.6542,-226.3913 5803,-106.2001 5846.6795,-53.3555 5890.2501,-97.8206 5953,-70.2001 5959.9222,-67.1532 5966.9149,-63.1768 5973.4307,-58.9993"/>
<polygon fill="#000000" stroke="#000000" points="5975.6313,-61.737 5981.9687,-53.2466 5971.7198,-55.9318 5975.6313,-61.737"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6600,-62.4005 6066,-62.4005 6066,-7.7996 6600,-7.7996 6600,-62.4005"/>
<text text-anchor="middle" x="6333" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6333" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_85&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>raw_85&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5836.8999,-866.5214C5825.0637,-760.4515 5770.8382,-222.2425 5875,-106.2001 5883.5356,-96.6909 5996.3899,-79.1101 6107.9239,-63.8105"/>
<polygon fill="#000000" stroke="#000000" points="6108.5818,-67.2532 6118.016,-62.4318 6107.6343,-60.3177 6108.5818,-67.2532"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="7072.5,-1960.2032 6881.5,-1960.2032 6881.5,-1924.2032 7072.5,-1924.2032 7072.5,-1960.2032"/>
<text text-anchor="middle" x="6977" y="-1938.7032" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_88&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>header_88&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6977,-2268.7618C6977,-2212.3688 6977,-2039.1086 6977,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="6980.5001,-1970.4824 6977,-1960.4824 6973.5001,-1970.4824 6980.5001,-1970.4824"/>
</g>
<!-- raw_94 -->
<g id="node95" class="node">
<title>raw_94</title>
<ellipse fill="none" stroke="#000000" cx="7127" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="7127" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_94 -->
<g id="edge94" class="edge">
<title>prose_89&#45;&gt;raw_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7134.5811,-2268.7618C7133.272,-2212.3688 7129.2497,-2039.1086 7127.6581,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="7131.1556,-1970.3984 7127.4244,-1960.4824 7124.1575,-1970.561 7131.1556,-1970.3984"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="7217" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_90&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-2268.7618C7217,-2212.3688 7217,-2039.1086 7217,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-1970.4824 7217,-1960.4824 7213.5001,-1970.4824 7220.5001,-1970.4824"/>
</g>
<!-- header_98 -->
<g id="node99" class="node">
<title>header_98</title>
<ellipse fill="none" stroke="#000000" cx="7655" cy="-1942.2032" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7655" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_91&#45;&gt;header_98 -->
<g id="edge98" class="edge">
<title>section_91&#45;&gt;header_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7796.1989,-2268.7618C7771.7083,-2212.121 7696.2412,-2037.584 7666.8697,-1969.6548"/>
<polygon fill="#000000" stroke="#000000" points="7669.9052,-1967.8563 7662.7239,-1960.0667 7663.4801,-1970.6345 7669.9052,-1967.8563"/>
</g>
<!-- prose_99 -->
<g id="node100" class="node">
<title>prose_99</title>
<ellipse fill="none" stroke="#000000" cx="7804" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7804" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_99 -->
<g id="edge99" class="edge">
<title>section_91&#45;&gt;prose_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7804,-2268.7618C7804,-2212.3688 7804,-2039.1086 7804,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="7807.5001,-1970.4824 7804,-1960.4824 7800.5001,-1970.4824 7807.5001,-1970.4824"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8191" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_91&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7823.7234,-2269.2413C7888.3881,-2211.6612 8093.9413,-2028.6282 8165.8602,-1964.5887"/>
<polygon fill="#000000" stroke="#000000" points="8168.4234,-1966.9928 8173.5642,-1957.7288 8163.7683,-1961.765 8168.4234,-1966.9928"/>
</g>
<!-- codeblock_101 -->
<g id="node102" class="node">
<title>codeblock_101</title>
<ellipse fill="none" stroke="#000000" cx="8525" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8525" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 301&#45;315</text>
</g>
<!-- section_91&#45;&gt;codeblock_101 -->
<g id="edge101" class="edge">
<title>section_91&#45;&gt;codeblock_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7874.4186,-2280.0592C7962.1002,-2269.473 8114.6274,-2243.755 8232,-2185.2037 8347.0731,-2127.7995 8456.497,-2017.2629 8502.3732,-1967.5344"/>
<polygon fill="#000000" stroke="#000000" points="8505.0136,-1969.8334 8509.1815,-1960.0928 8499.849,-1965.1083 8505.0136,-1969.8334"/>
</g>
<!-- header_124 -->
<g id="node125" class="node">
<title>header_124</title>
<ellipse fill="none" stroke="#000000" cx="9145" cy="-1942.2032" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9145" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_92&#45;&gt;header_124 -->
<g id="edge124" class="edge">
<title>section_92&#45;&gt;header_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9329.7905,-2268.7618C9297.6823,-2212.0207 9198.6232,-2036.9652 9160.3304,-1969.2948"/>
<polygon fill="#000000" stroke="#000000" points="9163.3147,-1967.4619 9155.3437,-1960.4824 9157.2225,-1970.9093 9163.3147,-1967.4619"/>
</g>
<!-- prose_125 -->
<g id="node126" class="node">
<title>prose_125</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9340" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_125 -->
<g id="edge125" class="edge">
<title>section_92&#45;&gt;prose_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340,-2268.7618C9340,-2212.3688 9340,-2039.1086 9340,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="9343.5001,-1970.4824 9340,-1960.4824 9336.5001,-1970.4824 9343.5001,-1970.4824"/>
</g>
<!-- prose_126 -->
<g id="node127" class="node">
<title>prose_126</title>
<ellipse fill="none" stroke="#000000" cx="9455" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9455" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_126 -->
<g id="edge126" class="edge">
<title>section_92&#45;&gt;prose_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9347.8961,-2268.6346C9356.5357,-2248.4488 9370.546,-2214.7961 9381,-2185.2037 9408.2558,-2108.0496 9434.876,-2015.0829 9447.4638,-1969.7562"/>
<polygon fill="#000000" stroke="#000000" points="9450.8528,-1970.6323 9450.1436,-1960.0613 9444.1058,-1968.7673 9450.8528,-1970.6323"/>
</g>
<!-- codeblock_127 -->
<g id="node128" class="node">
<title>codeblock_127</title>
<ellipse fill="none" stroke="#000000" cx="9712" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9712" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 327&#45;370</text>
</g>
<!-- section_92&#45;&gt;codeblock_127 -->
<g id="edge127" class="edge">
<title>section_92&#45;&gt;codeblock_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9370.3963,-2270.268C9403.1031,-2251.7548 9455.8268,-2219.7837 9496,-2185.2037 9577.3511,-2115.1788 9657.0299,-2015.1007 9692.6318,-1968.2574"/>
<polygon fill="#000000" stroke="#000000" points="9695.5218,-1970.2383 9698.757,-1960.1495 9689.9364,-1966.0188 9695.5218,-1970.2383"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6921.5,-920.0018 6408.5,-920.0018 6408.5,-849.4011 6921.5,-849.4011 6921.5,-920.0018"/>
<text text-anchor="middle" x="6665" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6665" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_94&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_94&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7129.5615,-1924.0422C7134.7744,-1879.2558 7141.4652,-1762.5759 7081,-1699.2027 7033.374,-1649.2862 6981.0241,-1709.6402 6930,-1663.2027 6707.6834,-1460.8707 6671.8031,-1064.7546 6666.0702,-930.4746"/>
<polygon fill="#000000" stroke="#000000" points="6669.5547,-930.0063 6665.6677,-920.1503 6662.56,-930.2791 6669.5547,-930.0063"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="7494.5,-927.9017 6939.5,-927.9017 6939.5,-841.5011 7494.5,-841.5011 7494.5,-927.9017"/>
<text text-anchor="middle" x="7217" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7217" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7217" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-1923.8483C7217,-1804.1465 7217,-1133.4467 7217,-938.0949"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-938.0712 7217,-928.0712 7213.5001,-938.0712 7220.5001,-938.0712"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7619.5,-902.7014 7512.5,-902.7014 7512.5,-866.7014 7619.5,-866.7014 7619.5,-902.7014"/>
<text text-anchor="middle" x="7566" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_98&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>header_98&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7653.2195,-1923.9298C7648.8951,-1879.3745 7637.5646,-1761.585 7629,-1663.2027 7603.4704,-1369.9417 7575.9351,-1014.2227 7568.1545,-912.8641"/>
<polygon fill="#000000" stroke="#000000" points="7571.6382,-912.5159 7567.3837,-902.8129 7564.6586,-913.0512 7571.6382,-912.5159"/>
</g>
<!-- raw_103 -->
<g id="node104" class="node">
<title>raw_103</title>
<ellipse fill="none" stroke="#000000" cx="7665" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7665" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_103 -->
<g id="edge103" class="edge">
<title>prose_99&#45;&gt;raw_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7799.3192,-1924.3503C7788.3216,-1883.4972 7758.952,-1780.4682 7722,-1699.2027 7714.3328,-1682.3408 7706.246,-1680.9676 7701,-1663.2027 7617.6287,-1380.8781 7649.9672,-1016.1203 7661.5543,-912.9755"/>
<polygon fill="#000000" stroke="#000000" points="7665.0637,-913.0942 7662.7316,-902.7592 7658.1097,-912.2927 7665.0637,-913.0942"/>
</g>
<!-- prespace_104 -->
<g id="node105" class="node">
<title>prespace_104</title>
<ellipse fill="none" stroke="#000000" cx="7756" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7756" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_104 -->
<g id="edge104" class="edge">
<title>prose_99&#45;&gt;prespace_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7803.1669,-1923.8483C7797.4651,-1798.2314 7764.2208,-1065.8155 7757.2727,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="7760.7686,-912.5679 7756.8186,-902.7369 7753.7758,-912.8854 7760.7686,-912.5679"/>
</g>
<!-- literal_105 -->
<g id="node106" class="node">
<title>literal_105</title>
<ellipse fill="none" stroke="#000000" cx="7852" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7852" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_105 -->
<g id="edge105" class="edge">
<title>prose_99&#45;&gt;literal_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7804.8331,-1923.8483C7810.5349,-1798.2314 7843.7792,-1065.8155 7850.7273,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="7854.2242,-912.8854 7851.1814,-902.7369 7847.2314,-912.5679 7854.2242,-912.8854"/>
</g>
<!-- raw_106 -->
<g id="node107" class="node">
<title>raw_106</title>
<ellipse fill="none" stroke="#000000" cx="7928" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7928" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_106 -->
<g id="edge106" class="edge">
<title>prose_99&#45;&gt;raw_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7811.3034,-1924.6537C7828.9754,-1881.2421 7873.9158,-1764.9657 7892,-1663.2027 7943.4493,-1373.6878 7933.4886,-1014.6623 7929.3056,-912.8059"/>
<polygon fill="#000000" stroke="#000000" points="7932.7981,-912.5535 7928.8746,-902.7119 7925.8045,-912.8521 7932.7981,-912.5535"/>
</g>
<!-- prespace_111 -->
<g id="node112" class="node">
<title>prespace_111</title>
<ellipse fill="none" stroke="#000000" cx="8019" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8019" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_111 -->
<g id="edge111" class="edge">
<title>prose_100&#45;&gt;prespace_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8181.474,-1924.9193C8158.4067,-1882.1055 8099.64,-1767.0709 8075,-1663.2027 8007.0251,-1376.659 8014.1047,-1015.5599 8017.7943,-913.0093"/>
<polygon fill="#000000" stroke="#000000" points="8021.2982,-912.9709 8018.1804,-902.8452 8014.3033,-912.7051 8021.2982,-912.9709"/>
</g>
<!-- literal_112 -->
<g id="node113" class="node">
<title>literal_112</title>
<ellipse fill="none" stroke="#000000" cx="8115" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8115" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_112 -->
<g id="edge112" class="edge">
<title>prose_100&#45;&gt;literal_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8188.1535,-1923.9763C8181.3195,-1879.5242 8163.894,-1761.9465 8155,-1663.2027 8128.6438,-1370.5893 8118.2234,-1014.4195 8115.6647,-912.909"/>
<polygon fill="#000000" stroke="#000000" points="8119.162,-912.7528 8115.4159,-902.8424 8112.1641,-912.9258 8119.162,-912.7528"/>
</g>
<!-- raw_113 -->
<g id="node114" class="node">
<title>raw_113</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8191" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_113 -->
<g id="edge113" class="edge">
<title>prose_100&#45;&gt;raw_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191,-1923.8483C8191,-1798.2314 8191,-1065.8155 8191,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="8194.5001,-912.7369 8191,-902.7369 8187.5001,-912.7369 8194.5001,-912.7369"/>
</g>
<!-- prespace_114 -->
<g id="node115" class="node">
<title>prespace_114</title>
<ellipse fill="none" stroke="#000000" cx="8282" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8282" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_114 -->
<g id="edge114" class="edge">
<title>prose_100&#45;&gt;prespace_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8193.7247,-1923.9648C8200.2883,-1879.4869 8217.1587,-1761.8566 8227,-1663.2027 8256.1976,-1370.5131 8275.427,-1014.3964 8280.598,-912.9037"/>
<polygon fill="#000000" stroke="#000000" points="8284.0974,-913.003 8281.107,-902.8389 8277.1063,-912.6493 8284.0974,-913.003"/>
</g>
<!-- literal_115 -->
<g id="node116" class="node">
<title>literal_115</title>
<ellipse fill="none" stroke="#000000" cx="8378" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8378" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_115 -->
<g id="edge115" class="edge">
<title>prose_100&#45;&gt;literal_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8203.1941,-1925.3521C8232.6874,-1883.5125 8307.6086,-1770.5011 8337,-1663.2027 8414.7961,-1379.1945 8389.9706,-1015.6149 8380.7647,-912.8617"/>
<polygon fill="#000000" stroke="#000000" points="8384.2298,-912.3212 8379.8263,-902.6849 8377.2594,-912.964 8384.2298,-912.3212"/>
</g>
<!-- raw_116 -->
<g id="node117" class="node">
<title>raw_116</title>
<ellipse fill="none" stroke="#000000" cx="8454" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8454" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_116 -->
<g id="edge116" class="edge">
<title>prose_100&#45;&gt;raw_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8209.3356,-1927.3575C8254.8248,-1889.2419 8372.4656,-1782.5078 8418,-1663.2027 8523.1905,-1387.5924 8475.3144,-1016.7412 8458.8003,-912.805"/>
<polygon fill="#000000" stroke="#000000" points="8462.2314,-912.0984 8457.173,-902.7892 8455.322,-913.2211 8462.2314,-912.0984"/>
</g>
<!-- leaf_123 -->
<g id="node124" class="node">
<title>leaf_123</title>
<polygon fill="none" stroke="#c0c0c0" points="8942.5,-981.6022 8499.5,-981.6022 8499.5,-787.8007 8942.5,-787.8007 8942.5,-981.6022"/>
<text text-anchor="middle" x="8721" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8721" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8721" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8721" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8721" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8721" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8721" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8721" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8721" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8721" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8721" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_101&#45;&gt;leaf_123 -->
<g id="edge123" class="edge">
<title>codeblock_101&#45;&gt;leaf_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8528.4019,-1923.8483C8548.871,-1813.4092 8656.27,-1233.9469 8701.2042,-991.5082"/>
<polygon fill="#000000" stroke="#000000" points="8704.6552,-992.0934 8703.0363,-981.623 8697.7725,-990.8177 8704.6552,-992.0934"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7401.5,-63.0015 7112.5,-63.0015 7112.5,-7.1986 7401.5,-7.1986 7401.5,-63.0015"/>
<text text-anchor="middle" x="7257" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>raw_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7667.0567,-866.5357C7678.6427,-760.5472 7731.6384,-222.7227 7628,-106.2001 7595.514,-69.6755 7458.962,-79.6356 7411,-70.2001 7402.594,-68.5464 7393.946,-66.7735 7385.2405,-64.9353"/>
<polygon fill="#000000" stroke="#000000" points="7385.9071,-61.4988 7375.3969,-62.8349 7384.4463,-68.3447 7385.9071,-61.4988"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7474,-53.1 7420,-53.1 7420,-17.1 7474,-17.1 7474,-53.1"/>
<text text-anchor="middle" x="7447" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>prespace_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7757.6018,-866.5035C7766.5384,-760.3313 7806.1596,-221.6392 7701,-106.2001 7634.8688,-33.6045 7570.6329,-114.5164 7483,-70.2001 7477.9367,-67.6396 7473.1238,-64.1165 7468.7605,-60.2847"/>
<polygon fill="#000000" stroke="#000000" points="7471.0551,-57.6347 7461.4352,-53.1953 7466.187,-62.6648 7471.0551,-57.6347"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="7546,-53.1 7492,-53.1 7492,-17.1 7546,-17.1 7546,-53.1"/>
<text text-anchor="middle" x="7519" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>literal_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7853.9977,-866.4902C7865.2347,-760.2426 7916.3911,-221.1942 7811,-106.2001 7733.3691,-21.4957 7658.1458,-120.8195 7555,-70.2001 7549.9064,-67.7004 7545.0786,-64.2072 7540.7099,-60.3862"/>
<polygon fill="#000000" stroke="#000000" points="7543.0044,-57.7362 7533.3839,-53.2982 7538.137,-62.767 7543.0044,-57.7362"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="7783.5,-54.4006 7564.5,-54.4006 7564.5,-15.7995 7783.5,-15.7995 7783.5,-54.4006"/>
<text text-anchor="middle" x="7674" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7674" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_106&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>raw_106&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7929.8451,-866.4177C7940.1076,-760.8946 7986.3746,-230.1203 7892,-106.2001 7887.3853,-100.1407 7810.3581,-75.9102 7749.1585,-57.4036"/>
<polygon fill="#000000" stroke="#000000" points="7750.0704,-54.023 7739.4857,-54.4862 7748.049,-60.7248 7750.0704,-54.023"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="7856,-53.1 7802,-53.1 7802,-17.1 7856,-17.1 7856,-53.1"/>
</g>
<!-- prespace_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>prespace_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8024.0908,-866.7515C8048.9892,-774.8733 8149.4286,-352.013 7964,-106.2001 7935.8048,-68.8232 7904.6487,-95.0996 7865,-70.2001 7860.4954,-67.3712 7856.0954,-63.9002 7852.0056,-60.2531"/>
<polygon fill="#000000" stroke="#000000" points="7854.222,-57.5297 7844.577,-53.1452 7849.3826,-62.5875 7854.222,-57.5297"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8037.5,-53.1 7874.5,-53.1 7874.5,-17.1 8037.5,-17.1 8037.5,-53.1"/>
<text text-anchor="middle" x="7956" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>literal_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116.2728,-866.7115C8123.2978,-762.8416 8154.1851,-239.7985 8074,-106.2001 8061.0762,-84.6674 8038.903,-68.8372 8017.242,-57.6541"/>
<polygon fill="#000000" stroke="#000000" points="8018.5394,-54.3925 8008.0185,-53.1427 8015.4637,-60.6806 8018.5394,-54.3925"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8400.5,-54.4006 8055.5,-54.4006 8055.5,-15.7995 8400.5,-15.7995 8400.5,-54.4006"/>
<text text-anchor="middle" x="8228" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8228" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>raw_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191.7899,-866.5632C8196.4958,-758.5056 8220.8303,-199.7321 8226.7169,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8230.2153,-64.6746 8227.1538,-54.5318 8223.2219,-64.37 8230.2153,-64.6746"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="8473,-53.1 8419,-53.1 8419,-17.1 8473,-17.1 8473,-53.1"/>
<text text-anchor="middle" x="8446" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>prespace_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8277.3644,-866.5557C8255.1962,-775.4379 8167.9041,-362.0821 8338,-106.2001 8357.5861,-76.7359 8380.0853,-90.5886 8409,-70.2001 8413.2332,-67.2152 8417.4637,-63.7616 8421.4719,-60.2093"/>
<polygon fill="#000000" stroke="#000000" points="8423.9057,-62.7256 8428.8477,-53.354 8419.1401,-57.5982 8423.9057,-62.7256"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="8545,-53.1 8491,-53.1 8491,-17.1 8545,-17.1 8545,-53.1"/>
<text text-anchor="middle" x="8518" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_115&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>literal_115&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8376.6413,-866.676C8369.1294,-762.6063 8335.9171,-238.6287 8418,-106.2001 8435.1936,-78.4608 8455.8732,-89.7571 8482,-70.2001 8485.9832,-67.2185 8489.9774,-63.8245 8493.7802,-60.3496"/>
<polygon fill="#000000" stroke="#000000" points="8496.4405,-62.6486 8501.2523,-53.2095 8491.6044,-57.5877 8496.4405,-62.6486"/>
</g>
<!-- leaf_122 -->
<g id="node123" class="node">
<title>leaf_122</title>
<polygon fill="none" stroke="#c0c0c0" points="8999,-54.4006 8563,-54.4006 8563,-15.7995 8999,-15.7995 8999,-54.4006"/>
<text text-anchor="middle" x="8781" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8781" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_116&#45;&gt;leaf_122 -->
<g id="edge122" class="edge">
<title>raw_116&#45;&gt;leaf_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8452.0506,-866.651C8441.0721,-761.3184 8390.9002,-226.5942 8490,-106.2001 8508.2778,-83.9948 8565.0792,-67.7053 8623.7052,-56.3646"/>
<polygon fill="#000000" stroke="#000000" points="8624.712,-59.7366 8633.8912,-54.4459 8623.4161,-52.8576 8624.712,-59.7366"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="9151.5,-902.7014 8960.5,-902.7014 8960.5,-866.7014 9151.5,-866.7014 9151.5,-902.7014"/>
<text text-anchor="middle" x="9056" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_124&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>header_124&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9143.4552,-1923.8483C9132.8832,-1798.2314 9071.2427,-1065.8155 9058.3598,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="9061.8443,-912.4081 9057.5179,-902.7369 9054.8689,-912.9952 9061.8443,-912.4081"/>
</g>
<!-- raw_129 -->
<g id="node130" class="node">
<title>raw_129</title>
<ellipse fill="none" stroke="#000000" cx="9197" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9197" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_129 -->
<g id="edge129" class="edge">
<title>prose_125&#45;&gt;raw_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9334.9478,-1924.3699C9323.1168,-1883.5574 9291.7398,-1780.6071 9254,-1699.2027 9246.209,-1682.3976 9238.246,-1680.9676 9233,-1663.2027 9149.6287,-1380.8781 9181.9672,-1016.1203 9193.5543,-912.9755"/>
<polygon fill="#000000" stroke="#000000" points="9197.0637,-913.0942 9194.7316,-902.7592 9190.1097,-912.2927 9197.0637,-913.0942"/>
</g>
<!-- prespace_130 -->
<g id="node131" class="node">
<title>prespace_130</title>
<ellipse fill="none" stroke="#000000" cx="9288" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9288" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_125&#45;&gt;prespace_130 -->
<g id="edge130" class="edge">
<title>prose_125&#45;&gt;prespace_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9339.0974,-1923.8483C9332.9205,-1798.2314 9296.9058,-1065.8155 9289.3788,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="9292.8739,-912.5529 9288.8868,-902.7369 9285.8823,-912.8968 9292.8739,-912.5529"/>
</g>
<!-- literal_131 -->
<g id="node132" class="node">
<title>literal_131</title>
<ellipse fill="none" stroke="#000000" cx="9384" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9384" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_125&#45;&gt;literal_131 -->
<g id="edge131" class="edge">
<title>prose_125&#45;&gt;literal_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340.7637,-1923.8483C9345.9903,-1798.2314 9376.4643,-1065.8155 9382.8334,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="9386.3308,-912.8738 9383.2496,-902.7369 9379.3368,-912.5827 9386.3308,-912.8738"/>
</g>
<!-- raw_132 -->
<g id="node133" class="node">
<title>raw_132</title>
<ellipse fill="none" stroke="#000000" cx="9460" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9460" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_132 -->
<g id="edge132" class="edge">
<title>prose_125&#45;&gt;raw_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9345.5974,-1924.0575C9364.0178,-1864.2846 9421.709,-1676.6031 9424,-1663.2027 9473.5529,-1373.3572 9464.9157,-1014.5624 9461.1758,-912.7833"/>
<polygon fill="#000000" stroke="#000000" points="9464.6698,-912.5558 9460.7896,-902.6971 9457.6749,-912.8237 9464.6698,-912.5558"/>
</g>
<!-- raw_137 -->
<g id="node138" class="node">
<title>raw_137</title>
<ellipse fill="none" stroke="#000000" cx="9532" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9532" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_126&#45;&gt;raw_137 -->
<g id="edge137" class="edge">
<title>prose_126&#45;&gt;raw_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9458.3187,-1923.9998C9466.2723,-1879.5997 9486.4679,-1762.1289 9496,-1663.2027 9524.1716,-1370.8323 9530.4519,-1014.4934 9531.7103,-912.9258"/>
<polygon fill="#000000" stroke="#000000" points="9535.2108,-912.8939 9531.8286,-902.8535 9528.2113,-912.8116 9535.2108,-912.8939"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="10083,-1212.8028 9577,-1212.8028 9577,-556.6001 10083,-556.6001 10083,-1212.8028"/>
<text text-anchor="middle" x="9830" y="-1197.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = assert(table.concat)</text>
<text text-anchor="middle" x="9830" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="9830" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9830" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="9830" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9830" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9830" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9830" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(char)</text>
<text text-anchor="middle" x="9830" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9830" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="9830" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="9830" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9830" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9830" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9830" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="9830" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9830" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="9830" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9830" y="-873.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="9830" y="-858.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9830" y="-843.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-827.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9830" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9830" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="9830" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9830" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return &quot;{ &#160;}&quot;</text>
<text text-anchor="middle" x="9830" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="9830" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="9830" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase</text>
<text text-anchor="middle" x="9830" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="9830" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="9830" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="9830" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-564.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_127&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>codeblock_127&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9714.0481,-1923.8483C9723.3024,-1840.9129 9762.0707,-1493.4758 9792.263,-1222.896"/>
<polygon fill="#000000" stroke="#000000" points="9795.7477,-1223.227 9793.3783,-1212.9005 9788.7909,-1222.4507 9795.7477,-1223.227"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9264.5,-63.0015 9017.5,-63.0015 9017.5,-7.1986 9264.5,-7.1986 9264.5,-63.0015"/>
<text text-anchor="middle" x="9141" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_129&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_129&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9197.5622,-866.4528C9199.9142,-780.4306 9206.7926,-407.028 9160,-106.2001 9158.2886,-95.1975 9155.5405,-83.4464 9152.6599,-72.7314"/>
<polygon fill="#000000" stroke="#000000" points="9155.9551,-71.5189 9149.887,-62.834 9149.2146,-73.4074 9155.9551,-71.5189"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9337,-53.1 9283,-53.1 9283,-17.1 9337,-17.1 9337,-53.1"/>
<text text-anchor="middle" x="9310" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_130&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>prespace_130&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9288.4697,-866.5632C9291.2741,-758.2631 9305.8019,-197.2221 9309.2604,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9312.7652,-63.5166 9309.5254,-53.4293 9305.7676,-63.3353 9312.7652,-63.5166"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9413,-53.1 9355,-53.1 9355,-17.1 9413,-17.1 9413,-53.1"/>
<text text-anchor="middle" x="9384" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>literal_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9384,-866.5632C9384,-758.2631 9384,-197.2221 9384,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9387.5001,-63.4293 9384,-53.4293 9380.5001,-63.4293 9387.5001,-63.4293"/>
</g>
<!-- leaf_136 -->
<g id="node137" class="node">
<title>leaf_136</title>
<polygon fill="none" stroke="#c0c0c0" points="9958.5,-62.3005 9431.5,-62.3005 9431.5,-7.8996 9958.5,-7.8996 9958.5,-62.3005"/>
<text text-anchor="middle" x="9695" y="-47.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9695" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9695" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_132&#45;&gt;leaf_136 -->
<g id="edge136" class="edge">
<title>raw_132&#45;&gt;leaf_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9458.2076,-866.4573C9448.2418,-761.1569 9403.3621,-231.4239 9496,-106.2001 9507.0161,-91.309 9540.3028,-77.1033 9576.5773,-65.359"/>
<polygon fill="#000000" stroke="#000000" points="9577.8774,-68.6189 9586.3598,-62.2708 9575.77,-61.9437 9577.8774,-68.6189"/>
</g>
<!-- leaf_138 -->
<g id="node139" class="node">
<title>leaf_138</title>
<polygon fill="none" stroke="#c0c0c0" points="10489.5,-62.4005 9976.5,-62.4005 9976.5,-7.7996 10489.5,-7.7996 10489.5,-62.4005"/>
<text text-anchor="middle" x="10233" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10233" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_137&#45;&gt;leaf_138 -->
<g id="edge138" class="edge">
<title>raw_137&#45;&gt;leaf_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9529.791,-866.4204C9517.3344,-759.7754 9460.1772,-218.8489 9568,-106.2001 9598.7794,-74.0431 9922.7585,-75.1128 9967,-70.2001 9985.0519,-68.1956 10003.7758,-65.9874 10022.5481,-63.684"/>
<polygon fill="#000000" stroke="#000000" points="10023.1752,-67.1333 10032.6707,-62.4336 10022.317,-60.1861 10023.1752,-67.1333"/>
</g>
<!-- leaf_148 -->
<g id="node149" class="node">
<title>leaf_148</title>
<polygon fill="none" stroke="#c0c0c0" points="10377.5,-1960.2032 10186.5,-1960.2032 10186.5,-1924.2032 10377.5,-1924.2032 10377.5,-1960.2032"/>
<text text-anchor="middle" x="10282" y="-1938.7032" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_140&#45;&gt;leaf_148 -->
<g id="edge148" class="edge">
<title>header_140&#45;&gt;leaf_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10362.5497,-2268.7618C10348.6397,-2212.3688 10305.9029,-2039.1086 10288.9927,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="10292.3019,-1969.3532 10286.5088,-1960.4824 10285.5056,-1971.0296 10292.3019,-1969.3532"/>
</g>
<!-- raw_149 -->
<g id="node150" class="node">
<title>raw_149</title>
<ellipse fill="none" stroke="#000000" cx="10423" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="10423" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_149 -->
<g id="edge149" class="edge">
<title>prose_141&#45;&gt;raw_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10583.076,-2276.7717C10548.2322,-2262.2758 10488.503,-2231.97 10459,-2185.2037 10416.2664,-2117.4651 10416.8569,-2018.3413 10420.2047,-1970.3325"/>
<polygon fill="#000000" stroke="#000000" points="10423.6945,-1970.5975 10420.994,-1960.3526 10416.7163,-1970.0455 10423.6945,-1970.5975"/>
</g>
<!-- prespace_150 -->
<g id="node151" class="node">
<title>prespace_150</title>
<ellipse fill="none" stroke="#000000" cx="10514" cy="-1942.2032" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10514" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_141&#45;&gt;prespace_150 -->
<g id="edge150" class="edge">
<title>prose_141&#45;&gt;prespace_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10602.1014,-2269.1052C10593.374,-2249.0563 10579.3229,-2215.2591 10570,-2185.2037 10546.3106,-2108.8335 10527.6549,-2016.1769 10519.1001,-1970.4846"/>
<polygon fill="#000000" stroke="#000000" points="10522.5014,-1969.6295 10517.24,-1960.4334 10515.6182,-1970.9034 10522.5014,-1969.6295"/>
</g>
<!-- literal_151 -->
<g id="node152" class="node">
<title>literal_151</title>
<ellipse fill="none" stroke="#000000" cx="10610" cy="-1942.2032" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10610" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_141&#45;&gt;literal_151 -->
<g id="edge151" class="edge">
<title>prose_141&#45;&gt;literal_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10610,-2268.7618C10610,-2212.3688 10610,-2039.1086 10610,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="10613.5001,-1970.4824 10610,-1960.4824 10606.5001,-1970.4824 10613.5001,-1970.4824"/>
</g>
<!-- raw_152 -->
<g id="node153" class="node">
<title>raw_152</title>
<ellipse fill="none" stroke="#000000" cx="10687" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="10687" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_152 -->
<g id="edge152" class="edge">
<title>prose_141&#45;&gt;raw_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10618.321,-2269.2276C10627.4271,-2249.2883 10641.8164,-2215.5891 10650,-2185.2037 10670.4967,-2109.0998 10680.677,-2016.3252 10684.758,-1970.5466"/>
<polygon fill="#000000" stroke="#000000" points="10688.2543,-1970.7386 10685.624,-1960.4755 10681.28,-1970.1388 10688.2543,-1970.7386"/>
</g>
<!-- raw_157 -->
<g id="node158" class="node">
<title>raw_157</title>
<ellipse fill="none" stroke="#000000" cx="11023" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="11023" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_142&#45;&gt;raw_157 -->
<g id="edge157" class="edge">
<title>prose_142&#45;&gt;raw_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11054.2722,-2268.7618C11048.8719,-2212.3688 11032.28,-2039.1086 11025.7148,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="11029.1879,-1970.1032 11024.7505,-1960.4824 11022.2198,-1970.7705 11029.1879,-1970.1032"/>
</g>
<!-- raw_159 -->
<g id="node160" class="node">
<title>raw_159</title>
<ellipse fill="none" stroke="#000000" cx="11214" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="11214" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_143&#45;&gt;raw_159 -->
<g id="edge159" class="edge">
<title>prose_143&#45;&gt;raw_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11204.5236,-2268.7618C11206.16,-2212.3688 11211.1879,-2039.1086 11213.1773,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="11216.6779,-1970.5797 11213.4696,-1960.4824 11209.6809,-1970.3766 11216.6779,-1970.5797"/>
</g>
<!-- raw_161 -->
<g id="node162" class="node">
<title>raw_161</title>
<ellipse fill="none" stroke="#000000" cx="11296" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="11296" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_144&#45;&gt;raw_161 -->
<g id="edge161" class="edge">
<title>prose_144&#45;&gt;raw_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11286.5236,-2268.7618C11288.16,-2212.3688 11293.1879,-2039.1086 11295.1773,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="11298.6779,-1970.5797 11295.4696,-1960.4824 11291.6809,-1970.3766 11298.6779,-1970.5797"/>
</g>
<!-- raw_163 -->
<g id="node164" class="node">
<title>raw_163</title>
<ellipse fill="none" stroke="#000000" cx="11373" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="11373" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_145&#45;&gt;raw_163 -->
<g id="edge163" class="edge">
<title>prose_145&#45;&gt;raw_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11368.2618,-2268.7618C11369.08,-2212.3688 11371.5939,-2039.1086 11372.5887,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="11376.0892,-1970.5322 11372.7348,-1960.4824 11369.09,-1970.4305 11376.0892,-1970.5322"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="11450" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="11450" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_146&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_146&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11450,-2268.7618C11450,-2212.3688 11450,-2039.1086 11450,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="11453.5001,-1970.4824 11450,-1960.4824 11446.5001,-1970.4824 11453.5001,-1970.4824"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="12050.5,-2185.2042 11495.5,-2185.2042 11495.5,-1699.2023 12050.5,-1699.2023 12050.5,-2185.2042"/>
<text text-anchor="middle" x="11773" y="-2154.0037" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="11773" y="-2138.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="11773" y="-2123.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="11773" y="-2107.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="11773" y="-2092.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="11773" y="-2077.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="11773" y="-2061.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11773" y="-2046.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11773" y="-2030.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11773" y="-2015.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11773" y="-2000.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1969.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="11773" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="11773" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="11773" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="11773" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="11773" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local second = fuzz_patt(slip)</text>
<text text-anchor="middle" x="11773" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11773" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(second, tostring(historian[i]))</text>
<text text-anchor="middle" x="11773" y="-1846.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11773" y="-1830.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11773" y="-1815.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11773" y="-1799.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1784.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1769.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1753.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="11773" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursorsß</text>
<text text-anchor="middle" x="11773" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="11773" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_147&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>codeblock_147&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11685.8168,-2268.7618C11690.2061,-2252.321 11697.2472,-2225.9472 11705.4745,-2195.1307"/>
<polygon fill="#000000" stroke="#000000" points="11708.8663,-2195.9948 11708.0642,-2185.4304 11702.1032,-2194.1892 11708.8663,-2195.9948"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="10467,-912.6029 10101,-912.6029 10101,-856.7999 10467,-856.7999 10467,-912.6029"/>
<text text-anchor="middle" x="10284" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_149&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>raw_149&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10420.5874,-1923.8483C10404.415,-1800.8096 10311.7242,-1095.6248 10289.0193,-922.888"/>
<polygon fill="#000000" stroke="#000000" points="10292.46,-922.2072 10287.6866,-912.7486 10285.5197,-923.1195 10292.46,-922.2072"/>
</g>
<!-- leaf_154 -->
<g id="node155" class="node">
<title>leaf_154</title>
<polygon fill="none" stroke="#c0c0c0" points="10539,-902.7014 10485,-902.7014 10485,-866.7014 10539,-866.7014 10539,-902.7014"/>
<text text-anchor="middle" x="10512" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_150&#45;&gt;leaf_154 -->
<g id="edge154" class="edge">
<title>prespace_150&#45;&gt;leaf_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10513.9653,-1923.8483C10513.7277,-1798.2314 10512.3425,-1065.8155 10512.053,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="10515.5531,-912.7302 10512.0341,-902.7369 10508.5531,-912.7435 10515.5531,-912.7302"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="10643,-902.7014 10557,-902.7014 10557,-866.7014 10643,-866.7014 10643,-902.7014"/>
<text text-anchor="middle" x="10600" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_151&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>literal_151&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10609.8264,-1923.8483C10608.6386,-1798.2314 10601.7127,-1065.8155 10600.2651,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="10603.765,-912.7033 10600.1705,-902.7369 10596.7654,-912.7696 10603.765,-912.7033"/>
</g>
<!-- leaf_156 -->
<g id="node157" class="node">
<title>leaf_156</title>
<polygon fill="none" stroke="#c0c0c0" points="10715,-902.7014 10661,-902.7014 10661,-866.7014 10715,-866.7014 10715,-902.7014"/>
<text text-anchor="middle" x="10688" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_152&#45;&gt;leaf_156 -->
<g id="edge156" class="edge">
<title>raw_152&#45;&gt;leaf_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10687.0174,-1923.8483C10687.1361,-1798.2314 10687.8287,-1065.8155 10687.9735,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="10691.4734,-912.7402 10687.9829,-902.7369 10684.4734,-912.7336 10691.4734,-912.7402"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11246.5,-904.6035 10733.5,-904.6035 10733.5,-864.7993 11246.5,-864.7993 11246.5,-904.6035"/>
<text text-anchor="middle" x="10990" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_157&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>raw_157&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11022.4272,-1923.8483C11018.524,-1798.7671 10995.8464,-1072.0511 10990.9371,-914.7306"/>
<polygon fill="#000000" stroke="#000000" points="10994.4251,-914.2896 10990.6148,-904.4036 10987.4285,-914.508 10994.4251,-914.2896"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11427.5,-904.6035 11264.5,-904.6035 11264.5,-864.7993 11427.5,-864.7993 11427.5,-904.6035"/>
<text text-anchor="middle" x="11346" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_159&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_159&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11216.8221,-1924.2765C11223.7487,-1880.016 11241.9724,-1761.9764 11255,-1663.2027 11293.4091,-1371.9884 11331.7453,-1018.3695 11342.8228,-914.6385"/>
<polygon fill="#000000" stroke="#000000" points="11346.3154,-914.893 11343.8953,-904.5783 11339.3549,-914.1509 11346.3154,-914.893"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="11972.5,-919.9018 11445.5,-919.9018 11445.5,-849.501 11972.5,-849.501 11972.5,-919.9018"/>
<text text-anchor="middle" x="11709" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11709" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11709" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_161&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>raw_161&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11293.4345,-1924.1754C11288.235,-1880.1918 11281.2723,-1766.0965 11337,-1699.2027 11366.9672,-1663.231 11403.0849,-1696.4984 11436,-1663.2027 11647.5152,-1449.2419 11695.7244,-1062.2439 11706.2153,-930.2416"/>
<polygon fill="#000000" stroke="#000000" points="11709.7191,-930.3233 11706.9872,-920.0868 11702.7393,-929.7927 11709.7191,-930.3233"/>
</g>
<!-- leaf_164 -->
<g id="node165" class="node">
<title>leaf_164</title>
<polygon fill="none" stroke="#c0c0c0" points="12419.5,-904.6035 11990.5,-904.6035 11990.5,-864.7993 12419.5,-864.7993 12419.5,-904.6035"/>
<text text-anchor="middle" x="12205" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection</text>
</g>
<!-- raw_163&#45;&gt;leaf_164 -->
<g id="edge164" class="edge">
<title>raw_163&#45;&gt;leaf_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11369.4762,-1924.1045C11361.7504,-1878.4229 11348.8497,-1757.922 11414,-1699.2027 11507.7835,-1614.6767 11882.5924,-1742.2972 11981,-1663.2027 12222.3063,-1469.2543 12214.2484,-1033.2368 12207.252,-914.8508"/>
<polygon fill="#000000" stroke="#000000" points="12210.7348,-914.4668 12206.6075,-904.709 12203.7489,-914.9109 12210.7348,-914.4668"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="12944,-912.0018 12438,-912.0018 12438,-857.401 12944,-857.401 12944,-912.0018"/>
<text text-anchor="middle" x="12691" y="-880.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="12691" y="-865.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_165&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_165&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11446.0324,-1924.3961C11437.0581,-1878.8713 11420.7477,-1757.7109 11486,-1699.2027 11563.9849,-1629.278 12344.0863,-1725.8893 12428,-1663.2027 12674.7881,-1478.843 12692.3684,-1051.6238 12691.8256,-922.3999"/>
<polygon fill="#000000" stroke="#000000" points="12695.324,-922.1908 12691.7415,-912.22 12688.3243,-922.2486 12695.324,-922.1908"/>
</g>
<!-- leaf_173 -->
<g id="node174" class="node">
<title>leaf_173</title>
<polygon fill="none" stroke="#c0c0c0" points="12846.5,-1960.2032 12697.5,-1960.2032 12697.5,-1924.2032 12846.5,-1924.2032 12846.5,-1960.2032"/>
<text text-anchor="middle" x="12772" y="-1938.7032" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_168&#45;&gt;leaf_173 -->
<g id="edge173" class="edge">
<title>header_168&#45;&gt;leaf_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12781.4764,-2268.7618C12779.84,-2212.3688 12774.8121,-2039.1086 12772.8227,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="12776.3191,-1970.3766 12772.5304,-1960.4824 12769.3221,-1970.5797 12776.3191,-1970.3766"/>
</g>
<!-- raw_174 -->
<g id="node175" class="node">
<title>raw_174</title>
<ellipse fill="none" stroke="#000000" cx="12892" cy="-1942.2032" rx="27" ry="18"/>
<text text-anchor="middle" x="12892" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_169&#45;&gt;raw_174 -->
<g id="edge174" class="edge">
<title>prose_169&#45;&gt;raw_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12951.1492,-2268.9975C12944.7104,-2248.8519 12934.4238,-2214.9684 12928,-2185.2037 12911.383,-2108.2083 12900.0048,-2015.8286 12894.9555,-1970.3391"/>
<polygon fill="#000000" stroke="#000000" points="12898.428,-1969.896 12893.8637,-1960.3348 12891.4694,-1970.6555 12898.428,-1969.896"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="13317,-2043.5835 12937,-2043.5835 12937,-1840.8229 13317,-1840.8229 13317,-2043.5835"/>
<text text-anchor="middle" x="13127" y="-2028.4434" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="13127" y="-2013.0433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13127" y="-1997.6433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13127" y="-1982.2433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13127" y="-1966.8432" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="13127" y="-1948.0832" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="13127" y="-1929.3232" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="13127" y="-1913.9232" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13127" y="-1898.5232" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="13127" y="-1879.7632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13127" y="-1864.3631" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="13127" y="-1848.9631" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_170&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>codeblock_170&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13107.0995,-2268.7618C13109.5104,-2229.2003 13115.4263,-2132.1232 13120.1853,-2054.0291"/>
<polygon fill="#000000" stroke="#000000" points="13123.7041,-2053.8264 13120.8189,-2043.632 13116.717,-2053.4005 13123.7041,-2053.8264"/>
</g>
<!-- header_177 -->
<g id="node178" class="node">
<title>header_177</title>
<ellipse fill="none" stroke="#000000" cx="13417" cy="-1942.2032" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="13417" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_171&#45;&gt;header_177 -->
<g id="edge177" class="edge">
<title>section_171&#45;&gt;header_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13542.6243,-2268.8647C13534.3242,-2248.6002 13520.4986,-2214.6104 13509,-2185.2037 13478.5313,-2107.2823 13443.9207,-2014.7175 13427.163,-1969.6289"/>
<polygon fill="#000000" stroke="#000000" points="13430.439,-1968.3964 13423.6767,-1960.2403 13423.8768,-1970.8332 13430.439,-1968.3964"/>
</g>
<!-- prose_178 -->
<g id="node179" class="node">
<title>prose_178</title>
<ellipse fill="none" stroke="#000000" cx="13550" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13550" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_178 -->
<g id="edge178" class="edge">
<title>section_171&#45;&gt;prose_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13550,-2268.7618C13550,-2212.3688 13550,-2039.1086 13550,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="13553.5001,-1970.4824 13550,-1960.4824 13546.5001,-1970.4824 13553.5001,-1970.4824"/>
</g>
<!-- prose_179 -->
<g id="node180" class="node">
<title>prose_179</title>
<ellipse fill="none" stroke="#000000" cx="13665" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13665" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_179 -->
<g id="edge179" class="edge">
<title>section_171&#45;&gt;prose_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13557.8961,-2268.6346C13566.5357,-2248.4488 13580.546,-2214.7961 13591,-2185.2037 13618.2558,-2108.0496 13644.876,-2015.0829 13657.4638,-1969.7562"/>
<polygon fill="#000000" stroke="#000000" points="13660.8528,-1970.6323 13660.1436,-1960.0613 13654.1058,-1968.7673 13660.8528,-1970.6323"/>
</g>
<!-- codeblock_180 -->
<g id="node181" class="node">
<title>codeblock_180</title>
<ellipse fill="none" stroke="#000000" cx="13862" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13862" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 450&#45;474</text>
</g>
<!-- section_171&#45;&gt;codeblock_180 -->
<g id="edge180" class="edge">
<title>section_171&#45;&gt;codeblock_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13583.3529,-2270.465C13617.0791,-2252.7875 13669.3255,-2222.1197 13706,-2185.2037 13772.9372,-2117.8256 13826.2361,-2017.0928 13849.4242,-1969.2718"/>
<polygon fill="#000000" stroke="#000000" points="13852.6205,-1970.7007 13853.7826,-1960.1698 13846.307,-1967.6775 13852.6205,-1970.7007"/>
</g>
<!-- header_193 -->
<g id="node194" class="node">
<title>header_193</title>
<ellipse fill="none" stroke="#000000" cx="14257" cy="-1942.2032" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="14257" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_172&#45;&gt;header_193 -->
<g id="edge193" class="edge">
<title>section_172&#45;&gt;header_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14456.7934,-2269.9641C14429.4775,-2251.8876 14387.7159,-2220.9072 14361,-2185.2037 14309.4974,-2116.3748 14277.6805,-2018.157 14264.3172,-1970.4184"/>
<polygon fill="#000000" stroke="#000000" points="14267.6154,-1969.2103 14261.6014,-1960.4878 14260.8634,-1971.0569 14267.6154,-1969.2103"/>
</g>
<!-- prose_194 -->
<g id="node195" class="node">
<title>prose_194</title>
<ellipse fill="none" stroke="#000000" cx="14402" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14402" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_194 -->
<g id="edge194" class="edge">
<title>section_172&#45;&gt;prose_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14475.3758,-2268.8658C14466.0987,-2248.8824 14451.5331,-2215.406 14443,-2185.2037 14421.4619,-2108.9709 14409.6317,-2015.8943 14404.7335,-1970.2175"/>
<polygon fill="#000000" stroke="#000000" points="14408.2051,-1969.7624 14403.6876,-1960.1789 14401.2428,-1970.4878 14408.2051,-1969.7624"/>
</g>
<!-- prose_195 -->
<g id="node196" class="node">
<title>prose_195</title>
<ellipse fill="none" stroke="#000000" cx="14484" cy="-1942.2032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14484" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_195 -->
<g id="edge195" class="edge">
<title>section_172&#45;&gt;prose_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14484,-2268.7618C14484,-2212.3688 14484,-2039.1086 14484,-1970.5523"/>
<polygon fill="#000000" stroke="#000000" points="14487.5001,-1970.4824 14484,-1960.4824 14480.5001,-1970.4824 14487.5001,-1970.4824"/>
</g>
<!-- codeblock_196 -->
<g id="node197" class="node">
<title>codeblock_196</title>
<ellipse fill="none" stroke="#000000" cx="14679" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14679" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 483&#45;497</text>
</g>
<!-- section_172&#45;&gt;codeblock_196 -->
<g id="edge196" class="edge">
<title>section_172&#45;&gt;codeblock_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14494.2095,-2268.7618C14526.3177,-2212.0207 14625.3768,-2036.9652 14663.6696,-1969.2948"/>
<polygon fill="#000000" stroke="#000000" points="14666.7775,-1970.9093 14668.6563,-1960.4824 14660.6853,-1967.4619 14666.7775,-1970.9093"/>
</g>
<!-- codeblock_197 -->
<g id="node198" class="node">
<title>codeblock_197</title>
<ellipse fill="none" stroke="#000000" cx="14993" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14993" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 499&#45;506</text>
</g>
<!-- section_172&#45;&gt;codeblock_197 -->
<g id="edge197" class="edge">
<title>section_172&#45;&gt;codeblock_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14542.8551,-2275.4046C14604.5873,-2261.4473 14702.5242,-2233.4937 14775,-2185.2037 14865.5803,-2124.8508 14942.9418,-2018.2948 14975.9413,-1968.8224"/>
<polygon fill="#000000" stroke="#000000" points="14978.9959,-1970.548 14981.58,-1960.2731 14973.1524,-1966.6939 14978.9959,-1970.548"/>
</g>
<!-- codeblock_198 -->
<g id="node199" class="node">
<title>codeblock_198</title>
<ellipse fill="none" stroke="#000000" cx="15307" cy="-1942.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15307" y="-1938.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 508&#45;510</text>
</g>
<!-- section_172&#45;&gt;codeblock_198 -->
<g id="edge198" class="edge">
<title>section_172&#45;&gt;codeblock_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14555.1844,-2280.7732C14694.611,-2268.0085 14998.018,-2235.2598 15089,-2185.2037 15185.0659,-2132.3505 15260.4337,-2020.6065 15291.525,-1969.1627"/>
<polygon fill="#000000" stroke="#000000" points="15294.7013,-1970.6693 15296.8102,-1960.2865 15288.6868,-1967.088 15294.7013,-1970.6693"/>
</g>
<!-- leaf_175 -->
<g id="node176" class="node">
<title>leaf_175</title>
<polygon fill="none" stroke="#c0c0c0" points="13016,-902.7014 12962,-902.7014 12962,-866.7014 13016,-866.7014 13016,-902.7014"/>
</g>
<!-- raw_174&#45;&gt;leaf_175 -->
<g id="edge175" class="edge">
<title>raw_174&#45;&gt;leaf_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12891.9035,-1924.1018C12892.2672,-1882.7331 12896.5186,-1778.706 12928,-1699.2027 12935.1717,-1681.0913 12946.7505,-1681.6527 12953,-1663.2027 13047.5387,-1384.1044 13007.2755,-1016.4302 12993.1512,-912.8978"/>
<polygon fill="#000000" stroke="#000000" points="12996.6065,-912.3338 12991.757,-902.914 12989.6738,-913.302 12996.6065,-912.3338"/>
</g>
<!-- leaf_181 -->
<g id="node182" class="node">
<title>leaf_181</title>
<polygon fill="none" stroke="#c0c0c0" points="13302,-902.7014 13146,-902.7014 13146,-866.7014 13302,-866.7014 13302,-902.7014"/>
<text text-anchor="middle" x="13224" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_177&#45;&gt;leaf_181 -->
<g id="edge181" class="edge">
<title>header_177&#45;&gt;leaf_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13410.488,-1924.1312C13395.8521,-1883.6686 13359.0477,-1782.7782 13326,-1699.2027 13319.6262,-1683.0838 13315.3394,-1679.9841 13311,-1663.2027 13237.0053,-1377.0494 13225.9439,-1015.6778 13224.2905,-913.036"/>
<polygon fill="#000000" stroke="#000000" points="13227.7878,-912.8115 13224.1447,-902.8627 13220.7885,-912.9119 13227.7878,-912.8115"/>
</g>
<!-- raw_182 -->
<g id="node183" class="node">
<title>raw_182</title>
<ellipse fill="none" stroke="#000000" cx="13347" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13347" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_178&#45;&gt;raw_182 -->
<g id="edge182" class="edge">
<title>prose_178&#45;&gt;raw_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13552.7208,-1924.2483C13558.3521,-1879.9321 13566.2934,-1764.2406 13508,-1699.2027 13469.4128,-1656.151 13418.8243,-1708.5794 13383,-1663.2027 13289.206,-1544.399 13331.8659,-1038.5722 13344.1039,-913.0018"/>
<polygon fill="#000000" stroke="#000000" points="13347.6223,-912.9886 13345.1243,-902.6925 13340.6563,-912.2991 13347.6223,-912.9886"/>
</g>
<!-- prespace_183 -->
<g id="node184" class="node">
<title>prespace_183</title>
<ellipse fill="none" stroke="#000000" cx="13438" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13438" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_178&#45;&gt;prespace_183 -->
<g id="edge183" class="edge">
<title>prose_178&#45;&gt;prespace_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13548.107,-1923.944C13543.6,-1883.1031 13530.866,-1781.4972 13508,-1699.2027 13503.4041,-1682.6621 13497.769,-1679.9512 13494,-1663.2027 13429.3442,-1375.8919 13434.1074,-1015.3281 13437.0215,-912.9568"/>
<polygon fill="#000000" stroke="#000000" points="13440.5244,-912.9123 13437.3293,-902.8108 13433.5276,-912.7 13440.5244,-912.9123"/>
</g>
<!-- literal_184 -->
<g id="node185" class="node">
<title>literal_184</title>
<ellipse fill="none" stroke="#000000" cx="13534" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13534" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_178&#45;&gt;literal_184 -->
<g id="edge184" class="edge">
<title>prose_178&#45;&gt;literal_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13549.7223,-1923.8483C13547.8217,-1798.2314 13536.7403,-1065.8155 13534.4242,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="13537.9239,-912.6828 13534.2729,-902.7369 13530.9247,-912.7887 13537.9239,-912.6828"/>
</g>
<!-- raw_185 -->
<g id="node186" class="node">
<title>raw_185</title>
<ellipse fill="none" stroke="#000000" cx="13610" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13610" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_178&#45;&gt;raw_185 -->
<g id="edge185" class="edge">
<title>prose_178&#45;&gt;raw_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13551.823,-1923.942C13556.2133,-1879.4135 13567.4901,-1761.6792 13574,-1663.2027 13593.3747,-1370.1179 13605.7778,-1014.2762 13609.1006,-912.8763"/>
<polygon fill="#000000" stroke="#000000" points="13612.6006,-912.9294 13609.4275,-902.8209 13605.6043,-912.7018 13612.6006,-912.9294"/>
</g>
<!-- raw_190 -->
<g id="node191" class="node">
<title>raw_190</title>
<ellipse fill="none" stroke="#000000" cx="13682" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13682" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_190 -->
<g id="edge190" class="edge">
<title>prose_179&#45;&gt;raw_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13665.2951,-1923.8483C13667.3144,-1798.2314 13679.0885,-1065.8155 13681.5492,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="13685.0488,-912.7919 13681.7101,-902.7369 13678.0497,-912.6793 13685.0488,-912.7919"/>
</g>
<!-- leaf_192 -->
<g id="node193" class="node">
<title>leaf_192</title>
<polygon fill="none" stroke="#c0c0c0" points="14115.4016,-1072.3422 13726.5984,-1072.3422 13726.5984,-697.0606 14115.4016,-697.0606 14115.4016,-1072.3422"/>
<text text-anchor="middle" x="13921" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="13921" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="13921" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13921" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="13921" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13921" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="13921" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13921" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13921" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="13921" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13921" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="13921" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="13921" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="13921" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="13921" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="13921" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_180&#45;&gt;leaf_192 -->
<g id="edge192" class="edge">
<title>codeblock_180&#45;&gt;leaf_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13863.0241,-1923.8483C13868.509,-1825.5382 13894.7294,-1355.5687 13909.9637,-1082.5131"/>
<polygon fill="#000000" stroke="#000000" points="13913.4608,-1082.6607 13910.5234,-1072.4812 13906.4717,-1082.2707 13913.4608,-1082.6607"/>
</g>
<!-- leaf_186 -->
<g id="node187" class="node">
<title>leaf_186</title>
<polygon fill="none" stroke="#c0c0c0" points="13359.5,-63.0015 12888.5,-63.0015 12888.5,-7.1986 13359.5,-7.1986 13359.5,-63.0015"/>
<text text-anchor="middle" x="13124" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_182&#45;&gt;leaf_186 -->
<g id="edge186" class="edge">
<title>raw_182&#45;&gt;leaf_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13348.7539,-866.4855C13358.503,-761.3436 13402.3695,-232.3524 13311,-106.2001 13300.7109,-91.9941 13269.4311,-77.93 13235.3259,-66.1073"/>
<polygon fill="#000000" stroke="#000000" points="13236.241,-62.7221 13225.6467,-62.8339 13233.9984,-69.3531 13236.241,-62.7221"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="13432,-53.1 13378,-53.1 13378,-17.1 13432,-17.1 13432,-53.1"/>
</g>
<!-- prespace_183&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>prespace_183&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13437.2955,-866.5632C13433.0889,-758.2631 13411.2971,-197.2221 13406.1093,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13409.5975,-63.2859 13405.7119,-53.4293 13402.6028,-63.5576 13409.5975,-63.2859"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13550,-53.1 13450,-53.1 13450,-17.1 13550,-17.1 13550,-53.1"/>
<text text-anchor="middle" x="13500" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_184&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>literal_184&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13533.2741,-866.5632C13528.9401,-758.2631 13506.4879,-197.2221 13501.143,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13504.6307,-63.2813 13500.7335,-53.4293 13497.6363,-63.5613 13504.6307,-63.2813"/>
</g>
<!-- leaf_189 -->
<g id="node190" class="node">
<title>leaf_189</title>
<polygon fill="none" stroke="#c0c0c0" points="13808,-53.1 13568,-53.1 13568,-17.1 13808,-17.1 13808,-53.1"/>
<text text-anchor="middle" x="13688" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_185&#45;&gt;leaf_189 -->
<g id="edge189" class="edge">
<title>raw_185&#45;&gt;leaf_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13607.6974,-866.6335C13597.2861,-779.9167 13558.7878,-398.5735 13646,-106.2001 13650.7281,-90.3494 13659.7253,-74.3445 13668.1832,-61.5439"/>
<polygon fill="#000000" stroke="#000000" points="13671.114,-63.4589 13673.8935,-53.2351 13665.345,-59.4941 13671.114,-63.4589"/>
</g>
<!-- leaf_191 -->
<g id="node192" class="node">
<title>leaf_191</title>
<polygon fill="none" stroke="#c0c0c0" points="14213.5,-55.0021 13826.5,-55.0021 13826.5,-15.198 14213.5,-15.198 14213.5,-55.0021"/>
<text text-anchor="middle" x="14020" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_190&#45;&gt;leaf_191 -->
<g id="edge191" class="edge">
<title>raw_190&#45;&gt;leaf_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13680.0356,-866.6385C13668.9714,-761.2351 13618.3945,-226.1761 13718,-106.2001 13730.0433,-91.6938 13819.2481,-71.7875 13897.6095,-56.7271"/>
<polygon fill="#000000" stroke="#000000" points="13898.4304,-60.1337 13907.5976,-54.8221 13897.1189,-53.2576 13898.4304,-60.1337"/>
</g>
<!-- leaf_199 -->
<g id="node200" class="node">
<title>leaf_199</title>
<polygon fill="none" stroke="#c0c0c0" points="14342,-902.7014 14172,-902.7014 14172,-866.7014 14342,-866.7014 14342,-902.7014"/>
<text text-anchor="middle" x="14257" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_193&#45;&gt;leaf_199 -->
<g id="edge199" class="edge">
<title>header_193&#45;&gt;leaf_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14257,-1923.8483C14257,-1798.2314 14257,-1065.8155 14257,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="14260.5001,-912.7369 14257,-902.7369 14253.5001,-912.7369 14260.5001,-912.7369"/>
</g>
<!-- raw_200 -->
<g id="node201" class="node">
<title>raw_200</title>
<ellipse fill="none" stroke="#000000" cx="14394" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14394" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_194&#45;&gt;raw_200 -->
<g id="edge200" class="edge">
<title>prose_194&#45;&gt;raw_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14401.8611,-1923.8483C14400.9109,-1798.2314 14395.3701,-1065.8155 14394.2121,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="14397.7121,-912.7101 14394.1364,-902.7369 14390.7123,-912.7631 14397.7121,-912.7101"/>
</g>
<!-- raw_202 -->
<g id="node203" class="node">
<title>raw_202</title>
<ellipse fill="none" stroke="#000000" cx="14466" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14466" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_195&#45;&gt;raw_202 -->
<g id="edge202" class="edge">
<title>prose_195&#45;&gt;raw_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14483.6876,-1923.8483C14481.5494,-1798.2314 14469.0828,-1065.8155 14466.4773,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="14469.9768,-912.6759 14466.307,-902.7369 14462.9778,-912.7951 14469.9768,-912.6759"/>
</g>
<!-- leaf_204 -->
<g id="node205" class="node">
<title>leaf_204</title>
<polygon fill="none" stroke="#c0c0c0" points="14961,-988.9019 14511,-988.9019 14511,-780.5009 14961,-780.5009 14961,-988.9019"/>
<text text-anchor="middle" x="14736" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="14736" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="14736" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="14736" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="14736" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14736" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="14736" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="14736" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="14736" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="14736" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="14736" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14736" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="14736" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_196&#45;&gt;leaf_204 -->
<g id="edge204" class="edge">
<title>codeblock_196&#45;&gt;leaf_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14679.9893,-1923.8483C14685.8801,-1814.5589 14716.5279,-1245.9609 14729.8291,-999.1884"/>
<polygon fill="#000000" stroke="#000000" points="14733.3287,-999.2881 14730.3721,-989.1142 14726.3388,-998.9113 14733.3287,-999.2881"/>
</g>
<!-- leaf_205 -->
<g id="node206" class="node">
<title>leaf_205</title>
<polygon fill="none" stroke="#c0c0c0" points="15247,-935.1024 14979,-935.1024 14979,-834.3004 15247,-834.3004 15247,-935.1024"/>
<text text-anchor="middle" x="15113" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="15113" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="15113" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="15113" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="15113" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15113" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_197&#45;&gt;leaf_205 -->
<g id="edge205" class="edge">
<title>codeblock_197&#45;&gt;leaf_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14995.0828,-1923.8483C15008.5045,-1805.5697 15082.9727,-1149.3175 15106.1278,-945.2627"/>
<polygon fill="#000000" stroke="#000000" points="15109.6386,-945.3652 15107.2885,-935.0343 15102.6832,-944.5759 15109.6386,-945.3652"/>
</g>
<!-- leaf_206 -->
<g id="node207" class="node">
<title>leaf_206</title>
<polygon fill="none" stroke="#c0c0c0" points="15351,-902.7014 15265,-902.7014 15265,-866.7014 15351,-866.7014 15351,-902.7014"/>
<text text-anchor="middle" x="15308" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_198&#45;&gt;leaf_206 -->
<g id="edge206" class="edge">
<title>codeblock_198&#45;&gt;leaf_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15307.0174,-1923.8483C15307.1361,-1798.2314 15307.8287,-1065.8155 15307.9735,-912.7408"/>
<polygon fill="#000000" stroke="#000000" points="15311.4734,-912.7402 15307.9829,-902.7369 15304.4734,-912.7336 15311.4734,-912.7402"/>
</g>
<!-- leaf_201 -->
<g id="node202" class="node">
<title>leaf_201</title>
<polygon fill="none" stroke="#c0c0c0" points="14556,-63.0015 14232,-63.0015 14232,-7.1986 14556,-7.1986 14556,-63.0015"/>
<text text-anchor="middle" x="14394" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_200&#45;&gt;leaf_201 -->
<g id="edge201" class="edge">
<title>raw_200&#45;&gt;leaf_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14394,-866.5632C14394,-760.6464 14394,-221.6953 14394,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="14397.5001,-73.0758 14394,-63.0758 14390.5001,-73.0759 14397.5001,-73.0758"/>
</g>
<!-- leaf_203 -->
<g id="node204" class="node">
<title>leaf_203</title>
<polygon fill="none" stroke="#c0c0c0" points="14772,-55.0021 14574,-55.0021 14574,-15.198 14772,-15.198 14772,-55.0021"/>
<text text-anchor="middle" x="14673" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_202&#45;&gt;leaf_203 -->
<g id="edge203" class="edge">
<title>raw_202&#45;&gt;leaf_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14464.3052,-866.5276C14454.8888,-761.6229 14412.5782,-233.7404 14502,-106.2001 14508.6773,-96.6764 14562.4439,-75.2015 14607.9306,-58.3295"/>
<polygon fill="#000000" stroke="#000000" points="14609.3192,-61.548 14617.4914,-54.8051 14606.898,-54.98 14609.3192,-61.548"/>
</g>
</g>
</svg>
