<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="16280pt" height="2669pt"
 viewBox="0.00 0.00 16280.30 2668.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2664.8041)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2664.8041 16276.2972,-2664.8041 16276.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2642.8041" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1787" y="-2638.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 543</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2570.8041" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1787" y="-2566.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;441</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2624.6355C1787,-2616.9351 1787,-2607.7785 1787,-2599.2208"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2599.2174 1787,-2589.2174 1783.5001,-2599.2174 1790.5001,-2599.2174"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1168" cy="-2498.8041" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1168" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1725.4565,-2564.2514C1633.9363,-2554.4262 1456.5725,-2535.0747 1306,-2516.8041 1281.4502,-2513.8252 1254.4713,-2510.351 1230.9302,-2507.2537"/>
<polygon fill="#000000" stroke="#000000" points="1231.0962,-2503.7453 1220.7241,-2505.9062 1230.1799,-2510.6851 1231.0962,-2503.7453"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1347" cy="-2498.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1347" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1726.8328,-2563.4765C1654.436,-2554.2915 1529.3399,-2537.2463 1423,-2516.8041 1411.0534,-2514.5076 1398.1458,-2511.6099 1386.4181,-2508.8145"/>
<polygon fill="#000000" stroke="#000000" points="1387.0127,-2505.3573 1376.4695,-2506.402 1385.363,-2512.1602 1387.0127,-2505.3573"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1464" cy="-2498.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1464" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.5408,-2561.0354C1677.8804,-2551.2135 1594.4109,-2534.9576 1523,-2516.8041 1516.1661,-2515.0669 1508.9445,-2513.0325 1501.9868,-2510.9688"/>
<polygon fill="#000000" stroke="#000000" points="1502.6431,-2507.5104 1492.0577,-2507.9554 1500.6102,-2514.2087 1502.6431,-2507.5104"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1564" cy="-2498.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1564" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1742.3852,-2557.4544C1707.3486,-2546.8319 1657.3972,-2531.3811 1614,-2516.8041 1609.6517,-2515.3436 1605.1065,-2513.7714 1600.6048,-2512.186"/>
<polygon fill="#000000" stroke="#000000" points="1601.5075,-2508.7922 1590.9128,-2508.7326 1599.1579,-2515.3861 1601.5075,-2508.7922"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1655" cy="-2498.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1655" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1757.3766,-2554.6459C1736.5856,-2543.3054 1708.7908,-2528.1446 1687.4091,-2516.4818"/>
<polygon fill="#000000" stroke="#000000" points="1688.8366,-2513.2737 1678.3816,-2511.5577 1685.4846,-2519.4189 1688.8366,-2513.2737"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2498.8041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1787" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;26</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2552.6355C1787,-2544.9351 1787,-2535.7785 1787,-2527.2208"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2527.2174 1787,-2517.2174 1783.5001,-2527.2174 1790.5001,-2527.2174"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2066" cy="-2498.8041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2066" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 28&#45;30</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1834.9618,-2558.4269C1881.7022,-2546.3648 1952.9893,-2527.9682 2004.0105,-2514.8014"/>
<polygon fill="#000000" stroke="#000000" points="2005.1231,-2518.129 2013.9312,-2512.2412 2003.3739,-2511.3511 2005.1231,-2518.129"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2498.8041" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 33&#45;232</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1849.5748,-2565.2143C1995.3393,-2552.1932 2357.1653,-2519.8712 2516.0774,-2505.6756"/>
<polygon fill="#000000" stroke="#000000" points="2516.5979,-2509.1431 2526.2468,-2504.7672 2515.975,-2502.1709 2516.5979,-2509.1431"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7176" cy="-2498.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7176" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 283&#45;318</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.7108,-2569.9262C2417.6036,-2562.3789 6449.4215,-2508.5116 7090.2568,-2499.9497"/>
<polygon fill="#000000" stroke="#000000" points="7090.3884,-2503.4483 7100.3407,-2499.815 7090.2949,-2496.449 7090.3884,-2503.4483"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11355" cy="-2498.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11355" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 385&#45;441</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.8829,-2570.3083C2646.8948,-2564.3333 10366.6599,-2506.2415 11269.0475,-2499.4509"/>
<polygon fill="#000000" stroke="#000000" points="11269.3752,-2502.9486 11279.3485,-2499.3734 11269.3224,-2495.9488 11269.3752,-2502.9486"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="13199" cy="-2498.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13199" y="-2494.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 442&#45;508</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.0821,-2570.552C2478.9457,-2568.1396 7427.8692,-2548.5359 11439,-2516.8041 12082.4556,-2511.7138 12858.21,-2502.8183 13113.2212,-2499.8221"/>
<polygon fill="#000000" stroke="#000000" points="13113.5656,-2503.3184 13123.5237,-2499.701 13113.4832,-2496.3189 13113.5656,-2503.3184"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1209.5,-2389.504 1116.5,-2389.504 1116.5,-2353.504 1209.5,-2353.504 1209.5,-2389.504"/>
<text text-anchor="middle" x="1163" y="-2368.004" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.2836,-2480.5651C1166.4556,-2459.4849 1165.083,-2424.5384 1164.1151,-2399.8945"/>
<polygon fill="#000000" stroke="#000000" points="1167.6049,-2399.564 1163.715,-2389.7092 1160.6103,-2399.8388 1167.6049,-2399.564"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1255" cy="-2371.504" rx="27" ry="18"/>
<text text-anchor="middle" x="1255" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1328.4945,-2483.8905C1316.7283,-2473.7477 1301.7427,-2459.5364 1291,-2444.8041 1280.6158,-2430.5635 1271.8277,-2412.8688 1265.5343,-2398.4327"/>
<polygon fill="#000000" stroke="#000000" points="1268.6884,-2396.9039 1261.5868,-2389.0415 1262.2353,-2399.6164 1268.6884,-2396.9039"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1327" cy="-2371.504" rx="27" ry="18"/>
<text text-anchor="middle" x="1327" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1436.157,-2489.3809C1414.0092,-2480.7095 1383.447,-2465.968 1363,-2444.8041 1350.594,-2431.9631 1341.6818,-2414.0169 1335.8282,-2399.0962"/>
<polygon fill="#000000" stroke="#000000" points="1338.9844,-2397.5363 1332.2591,-2389.3497 1332.4113,-2399.9434 1338.9844,-2397.5363"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1399" cy="-2371.504" rx="27" ry="18"/>
<text text-anchor="middle" x="1399" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1536.0682,-2489.703C1502.9005,-2478.4611 1450.1569,-2459.0766 1435,-2444.8041 1421.7914,-2432.3662 1412.7926,-2414.0471 1407.0953,-2398.8345"/>
<polygon fill="#000000" stroke="#000000" points="1410.3998,-2397.681 1403.8171,-2389.3793 1403.7861,-2399.9741 1410.3998,-2397.681"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1471" cy="-2371.504" rx="27" ry="18"/>
<text text-anchor="middle" x="1471" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1627.7775,-2489.0148C1585.3582,-2473.741 1508.1793,-2445.8639 1507,-2444.8041 1493.5053,-2432.6773 1484.5064,-2414.3582 1478.8806,-2399.0679"/>
<polygon fill="#000000" stroke="#000000" points="1482.1808,-2397.9012 1475.6574,-2389.5528 1475.5509,-2400.1471 1482.1808,-2397.9012"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057.5,-2444.6048 1516.5,-2444.6048 1516.5,-2298.4032 2057.5,-2298.4032 2057.5,-2444.6048"/>
<text text-anchor="middle" x="1787" y="-2429.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2414.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1787" y="-2398.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1787" y="-2383.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1787" y="-2368.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1787" y="-2352.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1787" y="-2337.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints, &quot;must have string.codepoints&quot;)</text>
<text text-anchor="middle" x="1787" y="-2321.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1787" y="-2306.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2480.5651C1787,-2473.3196 1787,-2464.4359 1787,-2454.8955"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2454.7568 1787,-2444.7568 1783.5001,-2454.7569 1790.5001,-2454.7568"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2389.504 2075.5,-2389.504 2075.5,-2353.504 2266.5,-2353.504 2266.5,-2389.504"/>
<text text-anchor="middle" x="2171" y="-2368.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2080.5998,-2481.1036C2098.4204,-2459.4981 2128.7161,-2422.7682 2149.2768,-2397.8408"/>
<polygon fill="#000000" stroke="#000000" points="2152.1812,-2399.8201 2155.8442,-2389.8786 2146.7811,-2395.3659 2152.1812,-2399.8201"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2371.504" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2539.0747,-2487.0867C2506.3065,-2478.4845 2464.4768,-2464.7824 2431,-2444.8041 2409.6659,-2432.0724 2389.3413,-2412.6468 2374.7904,-2396.9916"/>
<polygon fill="#000000" stroke="#000000" points="2377.0415,-2394.2635 2367.7328,-2389.204 2371.8546,-2398.9642 2377.0415,-2394.2635"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2561.9542,-2482.5079C2545.9641,-2473.0342 2526.9511,-2459.9757 2513,-2444.8041 2500.5318,-2431.2452 2490.3849,-2413.2187 2483.3046,-2398.4355"/>
<polygon fill="#000000" stroke="#000000" points="2486.4508,-2396.8997 2479.101,-2389.2688 2480.0879,-2399.8176 2486.4508,-2396.8997"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2371.504" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 37&#45;142</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2480.5651C2593,-2459.4849 2593,-2424.5384 2593,-2399.8945"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2399.7091 2593,-2389.7092 2589.5001,-2399.7092 2596.5001,-2399.7091"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 143&#45;221</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2630.8031,-2483.5752C2688.3015,-2460.412 2797.7005,-2416.3408 2860.823,-2390.912"/>
<polygon fill="#000000" stroke="#000000" points="2862.1972,-2394.1318 2870.165,-2387.1486 2859.5815,-2387.6389 2862.1972,-2394.1318"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="3961" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3961" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 222&#45;232</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2659.4438,-2492.6211C2886.7767,-2471.4665 3633.0487,-2402.0217 3880.4854,-2378.9963"/>
<polygon fill="#000000" stroke="#000000" points="3880.8519,-2382.4774 3890.4846,-2378.0658 3880.2033,-2375.5075 3880.8519,-2382.4774"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4836" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4836" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 233&#45;282</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.7074,-2497.5582C2874.1536,-2493.5522 3514.7971,-2479.2032 4045,-2444.8041 4306.3141,-2427.8503 4615.1343,-2395.7225 4757.2397,-2380.256"/>
<polygon fill="#000000" stroke="#000000" points="4758.0303,-2383.6906 4767.5917,-2379.1267 4757.2711,-2376.7319 4758.0303,-2383.6906"/>
</g>
<!-- header_88 -->
<g id="node89" class="node">
<title>header_88</title>
<ellipse fill="none" stroke="#000000" cx="6977" cy="-2371.504" rx="107.339" ry="18"/>
<text text-anchor="middle" x="6977" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;header_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7149.5743,-2481.8996C7114.4839,-2459.4523 7052.3693,-2419.7177 7013.0123,-2394.541"/>
<polygon fill="#000000" stroke="#000000" points="7014.8045,-2391.5327 7004.4946,-2389.0922 7011.0324,-2397.4294 7014.8045,-2391.5327"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7135" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7135" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7170.2127,-2480.8351C7163.3448,-2459.5114 7151.8207,-2423.7303 7143.8355,-2398.9371"/>
<polygon fill="#000000" stroke="#000000" points="7147.1551,-2397.8271 7140.7579,-2389.3816 7140.4921,-2399.9731 7147.1551,-2397.8271"/>
</g>
<!-- prose_90 -->
<g id="node91" class="node">
<title>prose_90</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7217" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;prose_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7181.7873,-2480.8351C7188.6552,-2459.5114 7200.1793,-2423.7303 7208.1645,-2398.9371"/>
<polygon fill="#000000" stroke="#000000" points="7211.5079,-2399.9731 7211.2421,-2389.3816 7204.8449,-2397.8271 7211.5079,-2399.9731"/>
</g>
<!-- section_91 -->
<g id="node92" class="node">
<title>section_91</title>
<ellipse fill="none" stroke="#000000" cx="7808" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7808" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 293&#45;318</text>
</g>
<!-- section_10&#45;&gt;section_91 -->
<g id="edge91" class="edge">
<title>section_10&#45;&gt;section_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7233.7612,-2487.1696C7350.8035,-2463.5945 7615.4119,-2410.2959 7740.3108,-2385.1382"/>
<polygon fill="#000000" stroke="#000000" points="7741.033,-2388.5631 7750.1449,-2383.1574 7739.6507,-2381.701 7741.033,-2388.5631"/>
</g>
<!-- section_92 -->
<g id="node93" class="node">
<title>section_92</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9340" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 319&#45;384</text>
</g>
<!-- section_10&#45;&gt;section_92 -->
<g id="edge92" class="edge">
<title>section_10&#45;&gt;section_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7249.5516,-2494.4773C7577.8989,-2475.1619 8908.7944,-2396.8702 9256.5402,-2376.4136"/>
<polygon fill="#000000" stroke="#000000" points="9256.7626,-2379.9067 9266.5398,-2375.8254 9256.3514,-2372.9188 9256.7626,-2379.9067"/>
</g>
<!-- header_140 -->
<g id="node141" class="node">
<title>header_140</title>
<ellipse fill="none" stroke="#000000" cx="10416" cy="-2371.504" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10416" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_140 -->
<g id="edge140" class="edge">
<title>section_11&#45;&gt;header_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11280.2244,-2495.9342C11118.9313,-2489.3187 10742.832,-2471.4917 10618,-2444.8041 10562.947,-2433.0344 10502.6092,-2409.671 10462.3461,-2392.4716"/>
<polygon fill="#000000" stroke="#000000" points="10463.6309,-2389.214 10453.0627,-2388.463 10460.8559,-2395.6405 10463.6309,-2389.214"/>
</g>
<!-- prose_141 -->
<g id="node142" class="node">
<title>prose_141</title>
<ellipse fill="none" stroke="#000000" cx="10659" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10659" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_141 -->
<g id="edge141" class="edge">
<title>section_11&#45;&gt;prose_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11295.057,-2487.8404C11156.6247,-2462.5208 10817.553,-2400.5037 10699.959,-2378.9955"/>
<polygon fill="#000000" stroke="#000000" points="10700.395,-2375.5172 10689.9285,-2377.1609 10699.1355,-2382.403 10700.395,-2375.5172"/>
</g>
<!-- prose_142 -->
<g id="node143" class="node">
<title>prose_142</title>
<ellipse fill="none" stroke="#000000" cx="11199" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11199" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_142 -->
<g id="edge142" class="edge">
<title>section_11&#45;&gt;prose_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11333.636,-2481.3705C11305.5667,-2458.4653 11256.2671,-2418.2355 11225.7485,-2393.3315"/>
<polygon fill="#000000" stroke="#000000" points="11227.6326,-2390.3515 11217.672,-2386.7408 11223.2069,-2395.7749 11227.6326,-2390.3515"/>
</g>
<!-- prose_143 -->
<g id="node144" class="node">
<title>prose_143</title>
<ellipse fill="none" stroke="#000000" cx="11355" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11355" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_143 -->
<g id="edge143" class="edge">
<title>section_11&#45;&gt;prose_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11355,-2480.5651C11355,-2459.4849 11355,-2424.5384 11355,-2399.8945"/>
<polygon fill="#000000" stroke="#000000" points="11358.5001,-2399.7091 11355,-2389.7092 11351.5001,-2399.7092 11358.5001,-2399.7091"/>
</g>
<!-- prose_144 -->
<g id="node145" class="node">
<title>prose_144</title>
<ellipse fill="none" stroke="#000000" cx="11437" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11437" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_144 -->
<g id="edge144" class="edge">
<title>section_11&#45;&gt;prose_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11369.6954,-2480.7708C11377.8166,-2470.4879 11387.8758,-2457.2126 11396,-2444.8041 11405.7992,-2429.8374 11415.6227,-2412.3808 11423.1966,-2398.2583"/>
<polygon fill="#000000" stroke="#000000" points="11426.4671,-2399.561 11428.0527,-2389.0855 11420.2806,-2396.2858 11426.4671,-2399.561"/>
</g>
<!-- prose_145 -->
<g id="node146" class="node">
<title>prose_145</title>
<ellipse fill="none" stroke="#000000" cx="11519" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11519" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_145 -->
<g id="edge145" class="edge">
<title>section_11&#45;&gt;prose_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11404.7162,-2485.2052C11428.9603,-2476.6587 11457.2815,-2463.6176 11478,-2444.8041 11491.8139,-2432.2603 11502.0623,-2413.9412 11508.858,-2398.755"/>
<polygon fill="#000000" stroke="#000000" points="11512.1755,-2399.8949 11512.8279,-2389.3202 11505.7234,-2397.18 11512.1755,-2399.8949"/>
</g>
<!-- prose_146 -->
<g id="node147" class="node">
<title>prose_146</title>
<ellipse fill="none" stroke="#000000" cx="11601" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11601" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_146 -->
<g id="edge146" class="edge">
<title>section_11&#45;&gt;prose_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11416.0299,-2488.184C11467.9635,-2478.1769 11537.598,-2462.1612 11560,-2444.8041 11574.9392,-2433.2293 11585.2607,-2414.586 11591.811,-2398.9986"/>
<polygon fill="#000000" stroke="#000000" points="11595.2195,-2399.8904 11595.5815,-2389.3018 11588.6953,-2397.3535 11595.2195,-2399.8904"/>
</g>
<!-- codeblock_147 -->
<g id="node148" class="node">
<title>codeblock_147</title>
<ellipse fill="none" stroke="#000000" cx="11832" cy="-2371.504" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11832" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 402&#45;439</text>
</g>
<!-- section_11&#45;&gt;codeblock_147 -->
<g id="edge147" class="edge">
<title>section_11&#45;&gt;codeblock_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11420.7583,-2489.9191C11479.4453,-2481.1682 11567.3868,-2466.0244 11642,-2444.8041 11692.474,-2430.4491 11748.2871,-2408.1005 11786.2821,-2391.8525"/>
<polygon fill="#000000" stroke="#000000" points="11787.7452,-2395.0333 11795.5439,-2387.8617 11784.9751,-2388.6047 11787.7452,-2395.0333"/>
</g>
<!-- header_168 -->
<g id="node169" class="node">
<title>header_168</title>
<ellipse fill="none" stroke="#000000" cx="12865" cy="-2371.504" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="12865" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_168 -->
<g id="edge168" class="edge">
<title>section_12&#45;&gt;header_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13141.3633,-2487.0567C13100.7587,-2477.867 13045.5532,-2463.5132 12999,-2444.8041 12964.2251,-2430.8286 12927.004,-2409.9423 12900.6375,-2394.0358"/>
<polygon fill="#000000" stroke="#000000" points="12902.1456,-2390.856 12891.7858,-2388.6366 12898.5004,-2396.832 12902.1456,-2390.856"/>
</g>
<!-- prose_169 -->
<g id="node170" class="node">
<title>prose_169</title>
<ellipse fill="none" stroke="#000000" cx="13040" cy="-2371.504" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13040" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_169 -->
<g id="edge169" class="edge">
<title>section_12&#45;&gt;prose_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13163.8353,-2482.7584C13144.8081,-2473.1864 13121.4867,-2459.9567 13103,-2444.8041 13085.9677,-2430.8436 13069.8411,-2411.9321 13058.1681,-2396.8152"/>
<polygon fill="#000000" stroke="#000000" points="13060.6522,-2394.2961 13051.8367,-2388.4192 13055.0632,-2398.5108 13060.6522,-2394.2961"/>
</g>
<!-- codeblock_170 -->
<g id="node171" class="node">
<title>codeblock_170</title>
<ellipse fill="none" stroke="#000000" cx="13199" cy="-2371.504" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13199" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 444&#45;457</text>
</g>
<!-- section_12&#45;&gt;codeblock_170 -->
<g id="edge170" class="edge">
<title>section_12&#45;&gt;codeblock_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13199,-2480.5651C13199,-2459.4849 13199,-2424.5384 13199,-2399.8945"/>
<polygon fill="#000000" stroke="#000000" points="13202.5001,-2399.7091 13199,-2389.7092 13195.5001,-2399.7092 13202.5001,-2399.7091"/>
</g>
<!-- section_171 -->
<g id="node172" class="node">
<title>section_171</title>
<ellipse fill="none" stroke="#000000" cx="13555" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13555" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 460&#45;489</text>
</g>
<!-- section_12&#45;&gt;section_171 -->
<g id="edge171" class="edge">
<title>section_12&#45;&gt;section_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13240.8846,-2483.8268C13306.2746,-2460.4444 13432.4542,-2415.3245 13503.3714,-2389.9656"/>
<polygon fill="#000000" stroke="#000000" points="13504.7616,-2393.1856 13512.9993,-2386.5228 13502.4047,-2386.5943 13504.7616,-2393.1856"/>
</g>
<!-- section_172 -->
<g id="node173" class="node">
<title>section_172</title>
<ellipse fill="none" stroke="#000000" cx="14288" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14288" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 490&#45;508</text>
</g>
<!-- section_12&#45;&gt;section_172 -->
<g id="edge172" class="edge">
<title>section_12&#45;&gt;section_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13267.1218,-2490.8409C13459.4447,-2468.3591 14005.818,-2404.49 14209.8659,-2380.6376"/>
<polygon fill="#000000" stroke="#000000" points="14210.378,-2384.1016 14219.9039,-2379.4642 14209.5652,-2377.149 14210.378,-2384.1016"/>
</g>
<!-- section_173 -->
<g id="node174" class="node">
<title>section_173</title>
<ellipse fill="none" stroke="#000000" cx="15375" cy="-2371.504" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15375" y="-2367.304" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 509&#45;543</text>
</g>
<!-- section_12&#45;&gt;section_173 -->
<g id="edge173" class="edge">
<title>section_12&#45;&gt;section_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13273.8283,-2496.0595C13459.7034,-2489.0893 13957.3666,-2469.4945 14372,-2444.8041 14714.6644,-2424.3993 15122.5917,-2392.1019 15293.4249,-2378.2144"/>
<polygon fill="#000000" stroke="#000000" points="15293.912,-2381.6864 15303.5951,-2377.3866 15293.3441,-2374.7094 15293.912,-2381.6864"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2016.6045 0,-2016.6045 0,-1944.8021 324,-1944.8021 324,-2016.6045"/>
<text text-anchor="middle" x="162" y="-1953.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1251.3835,-2353.5199C1246.8363,-2336.0964 1237.1775,-2310.5501 1218,-2298.2038 1135.2508,-2244.9308 417.7741,-2312.1918 333,-2262.2038 244.2168,-2209.8518 195.6843,-2091.669 174.7359,-2026.3101"/>
<polygon fill="#000000" stroke="#000000" points="178.0495,-2025.1792 171.7261,-2016.6783 171.3681,-2027.267 178.0495,-2025.1792"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2008.0037 342.5,-2008.0037 342.5,-1953.4029 897.5,-1953.4029 897.5,-2008.0037"/>
<text text-anchor="middle" x="620" y="-1976.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1961.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1323.4033,-2353.4211C1318.949,-2336.1802 1309.5557,-2311.0042 1291,-2298.2038 1220.4505,-2249.5362 984.74,-2298.2908 907,-2262.2038 786.9841,-2206.4923 687.3273,-2078.9136 643.6953,-2016.4651"/>
<polygon fill="#000000" stroke="#000000" points="646.4788,-2014.3366 637.9142,-2008.0999 640.7202,-2018.3164 646.4788,-2014.3366"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2008.0037 916,-2008.0037 916,-1953.4029 1464,-1953.4029 1464,-2008.0037"/>
<text text-anchor="middle" x="1190" y="-1976.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1961.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1390.7667,-2354.2208C1383.5989,-2339.3015 1372.8425,-2317.2154 1363,-2298.2038 1309.7176,-2195.2846 1243.3096,-2075.6788 1210.4205,-2016.9835"/>
<polygon fill="#000000" stroke="#000000" points="1213.3815,-2015.1078 1205.437,-2008.0981 1207.2762,-2018.5321 1213.3815,-2015.1078"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2016.0036 1482,-2016.0036 1482,-1945.4029 2030,-1945.4029 2030,-2016.0036"/>
<text text-anchor="middle" x="1756" y="-1984.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1969.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1478.322,-2354.0765C1484.996,-2338.8725 1495.5384,-2316.4531 1507,-2298.2038 1572.6079,-2193.7424 1665.7737,-2082.7634 1717.5421,-2023.6602"/>
<polygon fill="#000000" stroke="#000000" points="1720.2857,-2025.8403 1724.2584,-2016.0184 1715.0278,-2021.2192 1720.2857,-2025.8403"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-1998.7033 2048,-1998.7033 2048,-1962.7033 2162,-1962.7033 2162,-1998.7033"/>
<text text-anchor="middle" x="2105" y="-1977.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2338.2285,-2353.8684C2323.647,-2337.4479 2299.9666,-2313.2986 2275,-2298.2038 2233.1425,-2272.8968 2203.7615,-2298.5243 2171,-2262.2038 2105.596,-2189.6947 2101.481,-2064.8365 2103.2757,-2009.057"/>
<polygon fill="#000000" stroke="#000000" points="2106.7812,-2008.9941 2103.6971,-1998.8581 2099.7872,-2008.7051 2106.7812,-2008.9941"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2466.7888,-2353.4289C2460.922,-2336.4457 2449.6831,-2311.6835 2431,-2298.2038 2362.0085,-2248.4272 2301.2626,-2324.1958 2243,-2262.2038 2177.0655,-2192.049 2190.8125,-2064.9811 2201.0141,-2008.759"/>
<polygon fill="#000000" stroke="#000000" points="2204.4768,-2009.2854 2202.9201,-1998.8056 2197.6017,-2007.9689 2204.4768,-2009.2854"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-1980.7033" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2577.3574,-2353.7618C2562.2343,-2337.4958 2537.995,-2313.6571 2513,-2298.2038 2474.9484,-2274.6782 2449.6256,-2294.8145 2419,-2262.2038 2350.8113,-2189.5953 2335.4403,-2064.7888 2331.9902,-2009.0398"/>
<polygon fill="#000000" stroke="#000000" points="2335.4742,-2008.6462 2331.4469,-1998.8467 2328.4842,-2009.0188 2335.4742,-2008.6462"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2572.9933,-2353.9839C2551.6455,-2334.0423 2518.6572,-2299.3842 2502,-2262.2038 2463.3351,-2175.9001 2459.008,-2061.3043 2459.2868,-2008.9553"/>
<polygon fill="#000000" stroke="#000000" points="2462.7887,-2008.802 2459.4055,-1998.7619 2455.7892,-2008.7205 2462.7887,-2008.802"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-1980.7033" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 39&#45;140</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2353.4386C2593,-2291.1998 2593,-2085.3398 2593,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2009.0277 2593,-1999.0277 2589.5001,-2009.0278 2596.5001,-2009.0277"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-1980.7033" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.941,-2353.4119C2893.574,-2331.8051 2879.3374,-2294.524 2868,-2262.2038 2835.5985,-2169.8353 2800.5077,-2059.1638 2784.6479,-2008.4989"/>
<polygon fill="#000000" stroke="#000000" points="2787.9742,-2007.4086 2781.651,-1998.9075 2781.2927,-2009.4963 2787.9742,-2007.4086"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2353.4386C2909,-2291.1998 2909,-2085.3398 2909,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-2009.0277 2909,-1999.0277 2905.5001,-2009.0278 2912.5001,-2009.0277"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2917.1968,-2353.3266C2926.5118,-2331.9458 2941.5186,-2295.1788 2950,-2262.2038 2973.3812,-2171.2998 2984.6435,-2060.2186 2988.8943,-2009.022"/>
<polygon fill="#000000" stroke="#000000" points="2992.4073,-2008.9991 2989.7187,-1998.7511 2985.4297,-2008.439 2992.4073,-2008.9991"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3212" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3212" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 150&#45;219</text>
</g>
<!-- section_27&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2932.0313,-2354.2144C2958.1204,-2333.9458 3001.0259,-2298.4883 3032,-2262.2038 3104.8615,-2176.8506 3170.3948,-2059.7404 3198.066,-2007.6143"/>
<polygon fill="#000000" stroke="#000000" points="3201.2192,-2009.1382 3202.7854,-1998.6598 3195.0266,-2005.8744 3201.2192,-2009.1382"/>
</g>
<!-- header_50 -->
<g id="node51" class="node">
<title>header_50</title>
<ellipse fill="none" stroke="#000000" cx="3720" cy="-1980.7033" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3720" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_50 -->
<g id="edge50" class="edge">
<title>section_28&#45;&gt;header_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3949.8594,-2353.4386C3911.2418,-2290.8171 3782.9633,-2082.8033 3736.7643,-2007.8879"/>
<polygon fill="#000000" stroke="#000000" points="3739.5285,-2005.7022 3731.3004,-1999.0277 3733.5703,-2009.3766 3739.5285,-2005.7022"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="3961" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3961" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_28&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3961,-2353.4386C3961,-2291.1998 3961,-2085.3398 3961,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="3964.5001,-2009.0277 3961,-1999.0277 3957.5001,-2009.0278 3964.5001,-2009.0277"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4043" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4043" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_28&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3969.1968,-2353.3266C3978.5118,-2331.9458 3993.5186,-2295.1788 4002,-2262.2038 4025.3812,-2171.2998 4036.6435,-2060.2186 4040.8943,-2009.022"/>
<polygon fill="#000000" stroke="#000000" points="4044.4073,-2008.9991 4041.7187,-1998.7511 4037.4297,-2008.439 4044.4073,-2008.9991"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="4181" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4181" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 228&#45;230</text>
</g>
<!-- section_28&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_28&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3986.9161,-2354.5806C4014.5767,-2335.284 4057.9303,-2301.3024 4084,-2262.2038 4139.1318,-2179.5187 4166.1636,-2062.2612 4176.2073,-2008.9926"/>
<polygon fill="#000000" stroke="#000000" points="4179.6921,-2009.3924 4178.0449,-1998.9264 4172.8059,-2008.1353 4179.6921,-2009.3924"/>
</g>
<!-- header_60 -->
<g id="node61" class="node">
<title>header_60</title>
<ellipse fill="none" stroke="#000000" cx="4590" cy="-1980.7033" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4590" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_60 -->
<g id="edge60" class="edge">
<title>section_29&#45;&gt;header_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4810.923,-2354.3473C4783.7885,-2334.7238 4740.6983,-2300.3428 4713,-2262.2038 4652.6213,-2179.0657 4613.4589,-2061.6327 4597.7752,-2008.6084"/>
<polygon fill="#000000" stroke="#000000" points="4601.1032,-2007.518 4594.9522,-1998.8915 4594.3812,-2009.471 4601.1032,-2007.518"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4754" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4754" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_29&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4827.8032,-2353.3266C4818.4882,-2331.9458 4803.4814,-2295.1788 4795,-2262.2038 4771.6188,-2171.2998 4760.3565,-2060.2186 4756.1057,-2009.022"/>
<polygon fill="#000000" stroke="#000000" points="4759.5703,-2008.439 4755.2813,-1998.7511 4752.5927,-2008.9991 4759.5703,-2008.439"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="4836" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4836" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_29&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4836,-2353.4386C4836,-2291.1998 4836,-2085.3398 4836,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="4839.5001,-2009.0277 4836,-1999.0277 4832.5001,-2009.0278 4839.5001,-2009.0277"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5466" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5466" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_29&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4863.4754,-2354.4605C4966.2252,-2290.7229 5327.4776,-2066.6313 5435.3577,-1999.7113"/>
<polygon fill="#000000" stroke="#000000" points="5437.4793,-2002.514 5444.1321,-1994.2684 5433.7893,-1996.5655 5437.4793,-2002.514"/>
</g>
<!-- prose_64 -->
<g id="node65" class="node">
<title>prose_64</title>
<ellipse fill="none" stroke="#000000" cx="5694" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5694" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_64 -->
<g id="edge64" class="edge">
<title>section_29&#45;&gt;prose_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4909.18,-2366.929C5061.9903,-2356.2135 5408.9361,-2325.4692 5507,-2262.2038 5604.4383,-2199.342 5662.8815,-2065.7669 5684.4659,-2008.1261"/>
<polygon fill="#000000" stroke="#000000" points="5687.8034,-2009.1903 5687.9556,-1998.5965 5681.2303,-2006.7832 5687.8034,-2009.1903"/>
</g>
<!-- codeblock_65 -->
<g id="node66" class="node">
<title>codeblock_65</title>
<ellipse fill="none" stroke="#000000" cx="5912" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5912" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 248&#45;280</text>
</g>
<!-- section_29&#45;&gt;codeblock_65 -->
<g id="edge65" class="edge">
<title>section_29&#45;&gt;codeblock_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4911.5704,-2370.5168C5102.4814,-2366.7511 5598.6607,-2348.6797 5735,-2262.2038 5831.3475,-2201.0936 5884.4242,-2066.5656 5903.6182,-2008.3992"/>
<polygon fill="#000000" stroke="#000000" points="5906.9819,-2009.3717 5906.7111,-1998.7803 5900.318,-2007.2289 5906.9819,-2009.3717"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1882,-912.6029 1544,-912.6029 1544,-856.7999 1882,-856.7999 1882,-912.6029"/>
<text text-anchor="middle" x="1713" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.2416,-1962.7304C2221.8268,-1912.8966 2243.6146,-1771.8663 2171,-1699.2027 2082.3101,-1610.453 1983.913,-1747.5212 1891,-1663.2027 1670.0544,-1462.6948 1694.7899,-1049.1619 1708.2864,-922.4418"/>
<polygon fill="#000000" stroke="#000000" points="1711.7714,-922.77 1709.3923,-912.4457 1704.8138,-922.0002 1711.7714,-922.77"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2042,-902.7014 1900,-902.7014 1900,-866.7014 2042,-866.7014 2042,-902.7014"/>
<text text-anchor="middle" x="1971" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.2772,-1962.5506C2330.986,-1912.2505 2322.7981,-1770.1254 2243,-1699.2027 2178.106,-1641.5265 2109.7931,-1727.0866 2051,-1663.2027 1848.0014,-1442.6272 1935.4878,-1024.0011 1963.5354,-912.542"/>
<polygon fill="#000000" stroke="#000000" points="1966.9573,-913.2877 1966.0523,-902.7315 1960.1769,-911.548 1966.9573,-913.2877"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2087" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2087" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2463.8977,-1962.6565C2473.534,-1912.6311 2492.6668,-1771.1509 2419,-1699.2027 2324.1913,-1606.6059 2213.139,-1760.3512 2123,-1663.2027 2019.9424,-1552.1311 2069.6575,-1039.5187 2083.7102,-912.9927"/>
<polygon fill="#000000" stroke="#000000" points="2087.2019,-913.262 2084.8434,-902.933 2080.2459,-912.4783 2087.2019,-913.262"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2680,-1663.2041 2132,-1663.2041 2132,-106.1988 2680,-106.1988 2680,-1663.2041"/>
<text text-anchor="middle" x="2406" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 2000</text>
<text text-anchor="middle" x="2406" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2406" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2406" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2406" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2406" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2406" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2406" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2406" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2406" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2406" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2406" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2406" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2406" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2406" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2406" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2406" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2406" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2406" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2406" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2406" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2406" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2406" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2406" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2406" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2406" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2406" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2406" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2406" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2406" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2406" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2406" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2406" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2406" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2406" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2406" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2406" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2406" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2406" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2406" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2406" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2406" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2406" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2406" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2406" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2406" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2406" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2406" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2406" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2406" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.9103,-1962.5946C2582.7352,-1920.5417 2563.7787,-1809.4383 2540.6192,-1673.701"/>
<polygon fill="#000000" stroke="#000000" points="2544.0049,-1672.7338 2538.8727,-1663.4649 2537.1046,-1673.9112 2544.0049,-1672.7338"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2114,-53.1 2060,-53.1 2060,-17.1 2114,-17.1 2114,-53.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2087,-866.5632C2087,-758.2631 2087,-197.2221 2087,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2090.5001,-63.4293 2087,-53.4293 2083.5001,-63.4293 2090.5001,-63.4293"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="2854,-902.7014 2698,-902.7014 2698,-866.7014 2854,-866.7014 2854,-902.7014"/>
<text text-anchor="middle" x="2776" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>header_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776,-1962.5946C2776,-1834.9848 2776,-1071.5395 2776,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="2779.5001,-913.0483 2776,-903.0483 2772.5001,-913.0484 2779.5001,-913.0483"/>
</g>
<!-- raw_45 -->
<g id="node46" class="node">
<title>raw_45</title>
<ellipse fill="none" stroke="#000000" cx="2899" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2899" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;raw_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.8348,-1962.5946C2907.6705,-1834.9848 2900.7047,-1071.5395 2899.2616,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="2902.7586,-913.0159 2899.1674,-903.0483 2895.7589,-913.0799 2902.7586,-913.0159"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_42&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.6695,-1962.5946C2988.3409,-1834.9848 2974.4094,-1071.5395 2971.5232,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="2975.0168,-912.9828 2971.3348,-903.0483 2968.0179,-913.1105 2975.0168,-912.9828"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="3571.5,-1412.5035 3016.5,-1412.5035 3016.5,-356.8993 3571.5,-356.8993 3571.5,-1412.5035"/>
<text text-anchor="middle" x="3294" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3294" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3294" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3294" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3294" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3294" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3294" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3294" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3294" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3294" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3294" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3294" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3294" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3294" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3294" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3294" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3294" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3294" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3294" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3294" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3294" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3294" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3294" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3294" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3294" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3294" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3294" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3294" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3294" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3294" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3294" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3294" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3294" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3294" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3294" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3294" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3294" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3294" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3294" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3294" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3294" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3294" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3294" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3294" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3294" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3294" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3294" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3294" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3294" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3294" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3294" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_43&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3213.3548,-1962.5946C3218.315,-1896.2971 3236.1155,-1658.3789 3253.7349,-1422.8801"/>
<polygon fill="#000000" stroke="#000000" points="3257.238,-1422.9676 3254.494,-1412.7343 3250.2575,-1422.4453 3257.238,-1422.9676"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2677,-63.0015 2157,-63.0015 2157,-7.1986 2677,-7.1986 2677,-63.0015"/>
<text text-anchor="middle" x="2417" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>raw_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.093,-866.5278C2912.8891,-760.4937 2966.925,-222.4545 2863,-106.2001 2854.7496,-96.9708 2746.0706,-79.5409 2638.0717,-64.2491"/>
<polygon fill="#000000" stroke="#000000" points="2638.3528,-60.7542 2627.9621,-62.8235 2637.3754,-67.6856 2638.3528,-60.7542"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3194.5,-62.4005 2695.5,-62.4005 2695.5,-7.7996 3194.5,-7.7996 3194.5,-62.4005"/>
<text text-anchor="middle" x="2945" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2945" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2970.4449,-866.5632C2967.2032,-760.635 2950.7067,-221.5794 2946.1611,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2949.647,-72.525 2945.8427,-62.6367 2942.6503,-72.7391 2949.647,-72.525"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="3920.5,-902.7014 3589.5,-902.7014 3589.5,-866.7014 3920.5,-866.7014 3920.5,-902.7014"/>
<text text-anchor="middle" x="3755" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_50&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_50&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3720.5783,-1962.5946C3724.6534,-1834.9848 3749.0335,-1071.5395 3754.0844,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="3757.593,-913.155 3754.4141,-903.0483 3750.5966,-912.9315 3757.593,-913.155"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="3966" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3966" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_51&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3961.0826,-1962.5946C3961.6648,-1834.9848 3965.1476,-1071.5395 3965.8692,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="3969.3705,-913.0642 3965.9163,-903.0483 3962.3706,-913.0322 3969.3705,-913.0642"/>
</g>
<!-- raw_57 -->
<g id="node58" class="node">
<title>raw_57</title>
<ellipse fill="none" stroke="#000000" cx="4040" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4040" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;raw_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4042.9504,-1962.5946C4042.6011,-1834.9848 4040.5114,-1071.5395 4040.0785,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="4043.5777,-913.0387 4040.0502,-903.0483 4036.5777,-913.0579 4043.5777,-913.0387"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4208,-902.7014 4154,-902.7014 4154,-866.7014 4208,-866.7014 4208,-902.7014"/>
</g>
<!-- codeblock_53&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>codeblock_53&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4181,-1962.5946C4181,-1834.9848 4181,-1071.5395 4181,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="4184.5001,-913.0483 4181,-903.0483 4177.5001,-913.0484 4184.5001,-913.0483"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3579,-63.0015 3213,-63.0015 3213,-7.1986 3579,-7.1986 3579,-63.0015"/>
<text text-anchor="middle" x="3396" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_55&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>raw_55&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.158,-866.4429C3980.3209,-759.9257 4036.0427,-219.6034 3929,-106.2001 3876.6957,-50.7878 3663.4211,-81.0594 3588,-70.2001 3575.9584,-68.4663 3563.518,-66.5285 3551.0275,-64.4779"/>
<polygon fill="#000000" stroke="#000000" points="3551.4451,-60.9994 3541.0063,-62.811 3550.2964,-67.9045 3551.4451,-60.9994"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="3942.5,-55.0021 3597.5,-55.0021 3597.5,-15.198 3942.5,-15.198 3942.5,-55.0021"/>
<text text-anchor="middle" x="3770" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_57&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>raw_57&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4045.7198,-866.9385C4074.0949,-775.1152 4191.0126,-349.1899 4002,-106.2001 3986.5094,-86.2857 3934.7245,-69.4415 3884.0003,-57.1541"/>
<polygon fill="#000000" stroke="#000000" points="3884.7537,-53.7358 3874.2161,-54.8355 3883.1396,-60.5471 3884.7537,-53.7358"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4699.5,-902.7014 4480.5,-902.7014 4480.5,-866.7014 4699.5,-866.7014 4699.5,-902.7014"/>
<text text-anchor="middle" x="4590" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>header_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4590,-1962.5946C4590,-1834.9848 4590,-1071.5395 4590,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="4593.5001,-913.0483 4590,-903.0483 4586.5001,-913.0484 4593.5001,-913.0483"/>
</g>
<!-- raw_67 -->
<g id="node68" class="node">
<title>raw_67</title>
<ellipse fill="none" stroke="#000000" cx="4749" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4749" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_67 -->
<g id="edge67" class="edge">
<title>prose_61&#45;&gt;raw_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4753.9174,-1962.5946C4753.3352,-1834.9848 4749.8524,-1071.5395 4749.1308,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="4752.6294,-913.0322 4749.0837,-903.0483 4745.6295,-913.0642 4752.6294,-913.0322"/>
</g>
<!-- raw_69 -->
<g id="node70" class="node">
<title>raw_69</title>
<ellipse fill="none" stroke="#000000" cx="4827" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4827" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_69 -->
<g id="edge69" class="edge">
<title>prose_62&#45;&gt;raw_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4835.8513,-1962.5946C4834.8034,-1834.9848 4828.5343,-1071.5395 4827.2354,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="4830.7328,-913.0192 4827.1507,-903.0483 4823.733,-913.0768 4830.7328,-913.0192"/>
</g>
<!-- raw_71 -->
<g id="node72" class="node">
<title>raw_71</title>
<ellipse fill="none" stroke="#000000" cx="5143" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5143" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_71 -->
<g id="edge71" class="edge">
<title>prose_63&#45;&gt;raw_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5452.933,-1963.9512C5418.1796,-1918.4784 5322.9934,-1787.7708 5277,-1663.2027 5173.6482,-1383.2859 5149.1817,-1016.8432 5144.1653,-913.1382"/>
<polygon fill="#000000" stroke="#000000" points="5147.6486,-912.6935 5143.6915,-902.8654 5140.656,-913.0161 5147.6486,-912.6935"/>
</g>
<!-- prespace_72 -->
<g id="node73" class="node">
<title>prespace_72</title>
<ellipse fill="none" stroke="#000000" cx="5332" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5332" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_72 -->
<g id="edge72" class="edge">
<title>prose_63&#45;&gt;prespace_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5460.4262,-1962.6683C5445.8105,-1914.5652 5406.2518,-1778.9837 5388,-1663.2027 5342.1927,-1372.622 5333.8047,-1015.0375 5332.3131,-913.0499"/>
<polygon fill="#000000" stroke="#000000" points="5335.8114,-912.8867 5332.1761,-902.9351 5328.812,-912.9816 5335.8114,-912.8867"/>
</g>
<!-- literal_73 -->
<g id="node74" class="node">
<title>literal_73</title>
<ellipse fill="none" stroke="#000000" cx="5428" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5428" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_73 -->
<g id="edge73" class="edge">
<title>prose_63&#45;&gt;literal_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5465.3721,-1962.5946C5460.9477,-1834.9848 5434.478,-1071.5395 5428.9941,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="5432.4806,-912.921 5428.6361,-903.0483 5425.4848,-913.1636 5432.4806,-912.921"/>
</g>
<!-- raw_74 -->
<g id="node75" class="node">
<title>raw_74</title>
<ellipse fill="none" stroke="#000000" cx="5504" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5504" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_74 -->
<g id="edge74" class="edge">
<title>prose_63&#45;&gt;raw_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5466.6279,-1962.5946C5471.0523,-1834.9848 5497.522,-1071.5395 5503.0059,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="5506.5152,-913.1636 5503.3639,-903.0483 5499.5194,-912.921 5506.5152,-913.1636"/>
</g>
<!-- prespace_75 -->
<g id="node76" class="node">
<title>prespace_75</title>
<ellipse fill="none" stroke="#000000" cx="5595" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5595" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_75 -->
<g id="edge75" class="edge">
<title>prose_63&#45;&gt;prespace_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5471.2743,-1962.6445C5485.107,-1914.4831 5522.5622,-1778.7715 5540,-1663.2027 5583.8854,-1372.3527 5592.8919,-1014.9556 5594.6159,-913.0312"/>
<polygon fill="#000000" stroke="#000000" points="5598.1171,-912.9772 5594.7767,-902.9228 5591.118,-912.8658 5598.1171,-912.9772"/>
</g>
<!-- literal_76 -->
<g id="node77" class="node">
<title>literal_76</title>
<ellipse fill="none" stroke="#000000" cx="5691" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5691" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_76 -->
<g id="edge76" class="edge">
<title>prose_63&#45;&gt;literal_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5479.5129,-1964.1538C5515.3124,-1919.1841 5612.4254,-1789.6143 5650,-1663.2027 5733.9006,-1380.9376 5704.8033,-1016.1382 5694.1773,-912.9795"/>
<polygon fill="#000000" stroke="#000000" points="5697.629,-912.3378 5693.0957,-902.7618 5690.6679,-913.0747 5697.629,-912.3378"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="5767" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5767" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_63&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5473.4831,-1963.0995C5494.7978,-1914.813 5560.3254,-1778.6052 5653,-1699.2027 5681.9941,-1674.3609 5709.6848,-1694.8798 5731,-1663.2027 5815.4114,-1537.7568 5779.8704,-1037.9501 5769.4874,-913.0844"/>
<polygon fill="#000000" stroke="#000000" points="5772.95,-912.4935 5768.62,-902.8239 5765.9749,-913.0832 5772.95,-912.4935"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5839" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5839" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_64&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_64&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5702.121,-1962.9415C5723.3581,-1915.507 5780.454,-1781.4191 5803,-1663.2027 5858.0878,-1374.358 5845.5878,-1014.8647 5840.5547,-912.8518"/>
<polygon fill="#000000" stroke="#000000" points="5844.0439,-912.5502 5840.0379,-902.742 5837.0531,-912.9077 5844.0439,-912.5502"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6390,-1127.7024 5884,-1127.7024 5884,-641.7005 6390,-641.7005 6390,-1127.7024"/>
<text text-anchor="middle" x="6137" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6137" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6137" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6137" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6137" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6137" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6137" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6137" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6137" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6137" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6137" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6137" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6137" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6137" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6137" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6137" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6137" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6137" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6137" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_65&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>codeblock_65&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5915.7176,-1962.5946C5935.0931,-1868.2143 6025.8706,-1426.0262 6084.97,-1138.1459"/>
<polygon fill="#000000" stroke="#000000" points="6088.4762,-1138.4706 6087.0588,-1127.971 6081.6192,-1137.0628 6088.4762,-1138.4706"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="4235.5,-63.0015 3960.5,-63.0015 3960.5,-7.1986 4235.5,-7.1986 4235.5,-63.0015"/>
<text text-anchor="middle" x="4098" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_67&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>raw_67&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4751.0641,-866.7372C4762.8187,-760.7553 4817.029,-217.9874 4708,-106.2001 4671.9721,-69.2607 4295.9732,-78.2167 4245,-70.2001 4235.3773,-68.6867 4225.4541,-66.8741 4215.5198,-64.8809"/>
<polygon fill="#000000" stroke="#000000" points="4216.0937,-61.4257 4205.5926,-62.8319 4214.6787,-68.2811 4216.0937,-61.4257"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="4816,-70.3004 4254,-70.3004 4254,.1003 4816,.1003 4816,-70.3004"/>
<text text-anchor="middle" x="4535" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4535" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4535" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_69&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>raw_69&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4832.6982,-866.8508C4860.9493,-774.59 4977.136,-346.8315 4785,-106.2001 4775.0281,-93.7113 4751.4345,-82.6902 4722.5207,-73.2808"/>
<polygon fill="#000000" stroke="#000000" points="4723.5459,-69.9343 4712.9567,-70.2826 4721.4519,-76.6137 4723.5459,-69.9343"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5354,-62.4005 4834,-62.4005 4834,-7.7996 5354,-7.7996 5354,-62.4005"/>
<text text-anchor="middle" x="5094" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5094" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5141.9539,-866.5632C5135.8446,-760.635 5104.755,-221.5794 5096.1882,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="5099.6582,-72.4186 5095.5882,-62.6367 5092.6698,-72.8217 5099.6582,-72.4186"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5426,-53.1 5372,-53.1 5372,-17.1 5426,-17.1 5426,-53.1"/>
<text text-anchor="middle" x="5399" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>prespace_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5332.7569,-866.5464C5336.4407,-780.9458 5353.7264,-409.1554 5388,-106.2001 5389.6016,-92.0433 5391.9597,-76.387 5394.0822,-63.3778"/>
<polygon fill="#000000" stroke="#000000" points="5397.5929,-63.6037 5395.788,-53.1637 5390.6885,-62.4506 5397.5929,-63.6037"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5509.5,-53.1 5444.5,-53.1 5444.5,-17.1 5509.5,-17.1 5509.5,-53.1"/>
<text text-anchor="middle" x="5477" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>literal_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5428.432,-866.5619C5430.5738,-781.0313 5441.049,-409.5083 5468,-106.2001 5469.2561,-92.0638 5471.1796,-76.4098 5472.9263,-63.3967"/>
<polygon fill="#000000" stroke="#000000" points="5476.4365,-63.5623 5474.3335,-53.1783 5469.5019,-62.6073 5476.4365,-63.5623"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5796,-54.4006 5528,-54.4006 5528,-15.7995 5796,-15.7995 5796,-54.4006"/>
<text text-anchor="middle" x="5662" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5662" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>raw_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5502.5697,-866.7002C5494.6419,-762.7666 5459.2925,-239.4258 5540,-106.2001 5552.6148,-85.3766 5573.8026,-70.0093 5595.0134,-58.9987"/>
<polygon fill="#000000" stroke="#000000" points="5596.6488,-62.0949 5604.0802,-54.5434 5593.5617,-55.8124 5596.6488,-62.0949"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5868,-53.1 5814,-53.1 5814,-17.1 5868,-17.1 5868,-53.1"/>
<text text-anchor="middle" x="5841" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>prespace_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5593.5385,-866.6033C5585.4039,-760.9991 5549.6202,-224.9911 5651,-106.2001 5696.6294,-52.7342 5743.3552,-103.9723 5805,-70.2001 5809.8804,-67.5264 5814.5625,-64.0077 5818.8426,-60.2306"/>
<polygon fill="#000000" stroke="#000000" points="5821.288,-62.7347 5826.0683,-53.2795 5816.4351,-57.69 5821.288,-62.7347"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="5944,-53.1 5886,-53.1 5886,-17.1 5944,-17.1 5944,-53.1"/>
<text text-anchor="middle" x="5915" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>literal_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5689.1556,-866.6474C5678.7883,-761.2947 5631.6944,-226.4751 5731,-106.2001 5773.5511,-54.6639 5818.15,-101.8741 5877,-70.2001 5882.0415,-67.4867 5886.9286,-63.948 5891.4255,-60.1634"/>
<polygon fill="#000000" stroke="#000000" points="5894.0184,-62.5356 5899.0477,-53.2106 5889.301,-57.364 5894.0184,-62.5356"/>
</g>
<!-- leaf_84 -->
<g id="node85" class="node">
<title>leaf_84</title>
<polygon fill="none" stroke="#c0c0c0" points="6048,-53.1 5962,-53.1 5962,-17.1 6048,-17.1 6048,-53.1"/>
<text text-anchor="middle" x="6005" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_77&#45;&gt;leaf_84 -->
<g id="edge84" class="edge">
<title>raw_77&#45;&gt;leaf_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5765.0433,-866.6449C5754.0231,-761.278 5703.6542,-226.3913 5803,-106.2001 5846.6795,-53.3555 5890.2501,-97.8206 5953,-70.2001 5959.9222,-67.1532 5966.9149,-63.1768 5973.4307,-58.9993"/>
<polygon fill="#000000" stroke="#000000" points="5975.6313,-61.737 5981.9687,-53.2466 5971.7198,-55.9318 5975.6313,-61.737"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6600,-62.4005 6066,-62.4005 6066,-7.7996 6600,-7.7996 6600,-62.4005"/>
<text text-anchor="middle" x="6333" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6333" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_85&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>raw_85&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5836.8999,-866.5214C5825.0637,-760.4515 5770.8382,-222.2425 5875,-106.2001 5883.5356,-96.6909 5996.3899,-79.1101 6107.9239,-63.8105"/>
<polygon fill="#000000" stroke="#000000" points="6108.5818,-67.2532 6118.016,-62.4318 6107.6343,-60.3177 6108.5818,-67.2532"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="7072.5,-1998.7033 6881.5,-1998.7033 6881.5,-1962.7033 7072.5,-1962.7033 7072.5,-1998.7033"/>
<text text-anchor="middle" x="6977" y="-1977.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_88&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>header_88&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6977,-2353.4386C6977,-2291.1998 6977,-2085.3398 6977,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="6980.5001,-2009.0277 6977,-1999.0277 6973.5001,-2009.0278 6980.5001,-2009.0277"/>
</g>
<!-- raw_94 -->
<g id="node95" class="node">
<title>raw_94</title>
<ellipse fill="none" stroke="#000000" cx="7126" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="7126" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_94 -->
<g id="edge94" class="edge">
<title>prose_89&#45;&gt;raw_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7134.584,-2353.4386C7133.1506,-2291.1998 7128.4097,-2085.3398 7126.658,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="7130.1514,-2008.9445 7126.422,-1999.0277 7123.1533,-2009.1057 7130.1514,-2008.9445"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="7217" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_90&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-2353.4386C7217,-2291.1998 7217,-2085.3398 7217,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-2009.0277 7217,-1999.0277 7213.5001,-2009.0278 7220.5001,-2009.0277"/>
</g>
<!-- header_98 -->
<g id="node99" class="node">
<title>header_98</title>
<ellipse fill="none" stroke="#000000" cx="7611" cy="-1980.7033" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7611" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_91&#45;&gt;header_98 -->
<g id="edge98" class="edge">
<title>section_91&#45;&gt;header_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7798.8934,-2353.4386C7767.3182,-2290.801 7662.4139,-2082.6961 7624.6744,-2007.8301"/>
<polygon fill="#000000" stroke="#000000" points="7627.6368,-2005.9312 7620.01,-1998.577 7621.3861,-2009.0821 7627.6368,-2005.9312"/>
</g>
<!-- prose_99 -->
<g id="node100" class="node">
<title>prose_99</title>
<ellipse fill="none" stroke="#000000" cx="7808" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7808" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_99 -->
<g id="edge99" class="edge">
<title>section_91&#45;&gt;prose_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7808,-2353.4386C7808,-2291.1998 7808,-2085.3398 7808,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="7811.5001,-2009.0277 7808,-1999.0277 7804.5001,-2009.0278 7811.5001,-2009.0277"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8191" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_91&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7825.2008,-2353.9529C7886.9943,-2290.9008 8097.8049,-2075.7965 8168.0301,-2004.141"/>
<polygon fill="#000000" stroke="#000000" points="8170.6328,-2006.4857 8175.1326,-1996.8939 8165.6334,-2001.5861 8170.6328,-2006.4857"/>
</g>
<!-- codeblock_101 -->
<g id="node102" class="node">
<title>codeblock_101</title>
<ellipse fill="none" stroke="#000000" cx="8525" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8525" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 302&#45;316</text>
</g>
<!-- section_91&#45;&gt;codeblock_101 -->
<g id="edge101" class="edge">
<title>section_91&#45;&gt;codeblock_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7877.73,-2364.5453C7965.2229,-2353.4243 8117.6483,-2325.993 8232,-2262.2038 8354.1727,-2194.0518 8462.8948,-2062.5537 8505.6859,-2006.7565"/>
<polygon fill="#000000" stroke="#000000" points="8508.4831,-2008.8602 8511.7475,-1998.7808 8502.91,-2004.6245 8508.4831,-2008.8602"/>
</g>
<!-- header_124 -->
<g id="node125" class="node">
<title>header_124</title>
<ellipse fill="none" stroke="#000000" cx="9101" cy="-1980.7033" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9101" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_92&#45;&gt;header_124 -->
<g id="edge124" class="edge">
<title>section_92&#45;&gt;header_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9328.9519,-2353.4386C9290.6548,-2290.8171 9163.4408,-2082.8033 9117.6252,-2007.8879"/>
<polygon fill="#000000" stroke="#000000" points="9120.4098,-2005.7328 9112.2066,-1999.0277 9114.4381,-2009.3849 9120.4098,-2005.7328"/>
</g>
<!-- prose_125 -->
<g id="node126" class="node">
<title>prose_125</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9340" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_125 -->
<g id="edge125" class="edge">
<title>section_92&#45;&gt;prose_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340,-2353.4386C9340,-2291.1998 9340,-2085.3398 9340,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="9343.5001,-2009.0277 9340,-1999.0277 9336.5001,-2009.0278 9343.5001,-2009.0277"/>
</g>
<!-- prose_126 -->
<g id="node127" class="node">
<title>prose_126</title>
<ellipse fill="none" stroke="#000000" cx="9477" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9477" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_126 -->
<g id="edge126" class="edge">
<title>section_92&#45;&gt;prose_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9346.9875,-2353.3865C9355.2858,-2331.7554 9369.4562,-2294.4508 9381,-2262.2038 9414.2138,-2169.4227 9451.2608,-2058.5253 9467.9657,-2008.0905"/>
<polygon fill="#000000" stroke="#000000" points="9471.3029,-2009.1465 9471.1207,-1998.5532 9464.6571,-2006.9479 9471.3029,-2009.1465"/>
</g>
<!-- codeblock_127 -->
<g id="node128" class="node">
<title>codeblock_127</title>
<ellipse fill="none" stroke="#000000" cx="9735" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9735" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 328&#45;382</text>
</g>
<!-- section_92&#45;&gt;codeblock_127 -->
<g id="edge127" class="edge">
<title>section_92&#45;&gt;codeblock_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9373.9342,-2355.3998C9411.6826,-2336.4626 9473.2377,-2302.4545 9518,-2262.2038 9607.3845,-2181.8285 9686.3878,-2060.7744 9719.0511,-2007.4919"/>
<polygon fill="#000000" stroke="#000000" points="9722.2218,-2009.0139 9724.4257,-1998.6508 9716.2403,-2005.3777 9722.2218,-2009.0139"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6921.5,-920.0018 6408.5,-920.0018 6408.5,-849.4011 6921.5,-849.4011 6921.5,-920.0018"/>
<text text-anchor="middle" x="6665" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6665" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_94&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_94&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7129.2291,-1962.6866C7136.9541,-1913.3452 7150.9921,-1774.6912 7081,-1699.2027 7034.0918,-1648.611 6981.0241,-1709.6402 6930,-1663.2027 6707.6834,-1460.8707 6671.8031,-1064.7546 6666.0702,-930.4746"/>
<polygon fill="#000000" stroke="#000000" points="6669.5547,-930.0063 6665.6677,-920.1503 6662.56,-930.2791 6669.5547,-930.0063"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="7494.5,-927.9017 6939.5,-927.9017 6939.5,-841.5011 7494.5,-841.5011 7494.5,-927.9017"/>
<text text-anchor="middle" x="7217" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7217" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7217" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-1962.5946C7217,-1840.7131 7217,-1138.7992 7217,-938.2198"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-937.9408 7217,-927.9408 7213.5001,-937.9409 7220.5001,-937.9408"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7619.5,-902.7014 7512.5,-902.7014 7512.5,-866.7014 7619.5,-866.7014 7619.5,-902.7014"/>
<text text-anchor="middle" x="7566" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_98&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>header_98&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7610.2565,-1962.5946C7605.017,-1834.9848 7573.6713,-1071.5395 7567.1772,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="7570.6607,-912.8963 7566.7533,-903.0483 7563.6666,-913.1835 7570.6607,-912.8963"/>
</g>
<!-- raw_103 -->
<g id="node104" class="node">
<title>raw_103</title>
<ellipse fill="none" stroke="#000000" cx="7665" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7665" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_103 -->
<g id="edge103" class="edge">
<title>prose_99&#45;&gt;raw_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7800.0322,-1962.9231C7779.195,-1915.4437 7723.1695,-1781.2553 7701,-1663.2027 7646.7278,-1374.2037 7658.6586,-1014.8181 7663.5011,-912.8412"/>
<polygon fill="#000000" stroke="#000000" points="7667.0026,-912.8951 7663.9987,-902.735 7660.0111,-912.5508 7667.0026,-912.8951"/>
</g>
<!-- prespace_104 -->
<g id="node105" class="node">
<title>prespace_104</title>
<ellipse fill="none" stroke="#000000" cx="7756" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7756" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_104 -->
<g id="edge104" class="edge">
<title>prose_99&#45;&gt;prespace_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7807.1408,-1962.5946C7801.0864,-1834.9848 7764.8646,-1071.5395 7757.3603,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="7760.8405,-912.8712 7756.8705,-903.0483 7753.8484,-913.203 7760.8405,-912.8712"/>
</g>
<!-- literal_105 -->
<g id="node106" class="node">
<title>literal_105</title>
<ellipse fill="none" stroke="#000000" cx="7852" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7852" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_105 -->
<g id="edge105" class="edge">
<title>prose_99&#45;&gt;literal_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7808.727,-1962.5946C7813.85,-1834.9848 7844.4992,-1071.5395 7850.8489,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="7854.3594,-913.1807 7851.2634,-903.0483 7847.365,-912.8998 7854.3594,-913.1807"/>
</g>
<!-- raw_106 -->
<g id="node107" class="node">
<title>raw_106</title>
<ellipse fill="none" stroke="#000000" cx="7928" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7928" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_106 -->
<g id="edge106" class="edge">
<title>prose_99&#45;&gt;raw_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7814.202,-1962.7352C7830.4302,-1914.7958 7874.1225,-1779.58 7892,-1663.2027 7936.5979,-1372.8837 7931.4453,-1015.117 7928.8487,-913.068"/>
<polygon fill="#000000" stroke="#000000" points="7932.3442,-912.8496 7928.5776,-902.947 7925.3467,-913.0372 7932.3442,-912.8496"/>
</g>
<!-- prespace_111 -->
<g id="node112" class="node">
<title>prespace_111</title>
<ellipse fill="none" stroke="#000000" cx="8019" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8019" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_111 -->
<g id="edge111" class="edge">
<title>prose_100&#45;&gt;prespace_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8182.5137,-1962.9729C8160.295,-1915.6153 8100.3865,-1781.6991 8075,-1663.2027 8013.3075,-1375.2411 8016.0026,-1015.1315 8018.2244,-912.9122"/>
<polygon fill="#000000" stroke="#000000" points="8021.7264,-912.861 8018.4622,-902.7816 8014.7284,-912.6967 8021.7264,-912.861"/>
</g>
<!-- literal_112 -->
<g id="node113" class="node">
<title>literal_112</title>
<ellipse fill="none" stroke="#000000" cx="8115" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8115" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_112 -->
<g id="edge112" class="edge">
<title>prose_100&#45;&gt;literal_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8188.5366,-1962.4876C8182.058,-1913.942 8164.3967,-1777.3722 8155,-1663.2027 8130.9005,-1370.3948 8118.9095,-1014.3604 8115.8211,-912.8955"/>
<polygon fill="#000000" stroke="#000000" points="8119.3176,-912.7239 8115.5188,-902.8335 8112.3208,-912.9341 8119.3176,-912.7239"/>
</g>
<!-- raw_113 -->
<g id="node114" class="node">
<title>raw_113</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8191" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_113 -->
<g id="edge113" class="edge">
<title>prose_100&#45;&gt;raw_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191,-1962.5946C8191,-1834.9848 8191,-1071.5395 8191,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="8194.5001,-913.0483 8191,-903.0483 8187.5001,-913.0484 8194.5001,-913.0483"/>
</g>
<!-- prespace_114 -->
<g id="node115" class="node">
<title>prespace_114</title>
<ellipse fill="none" stroke="#000000" cx="8282" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8282" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_114 -->
<g id="edge114" class="edge">
<title>prose_100&#45;&gt;prespace_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8193.3406,-1962.4769C8199.5185,-1913.9051 8216.508,-1777.2768 8227,-1663.2027 8253.9402,-1370.2967 8274.7408,-1014.3306 8280.4415,-912.8887"/>
<polygon fill="#000000" stroke="#000000" points="8283.9402,-913.0089 8281.0041,-902.829 8276.9511,-912.618 8283.9402,-913.0089"/>
</g>
<!-- literal_115 -->
<g id="node116" class="node">
<title>literal_115</title>
<ellipse fill="none" stroke="#000000" cx="8378" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8378" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_115 -->
<g id="edge115" class="edge">
<title>prose_100&#45;&gt;literal_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8201.6937,-1963.6616C8230.0292,-1917.4698 8306.9265,-1785.1362 8337,-1663.2027 8407.4365,-1377.6166 8387.8283,-1015.8492 8380.2975,-913.0748"/>
<polygon fill="#000000" stroke="#000000" points="8383.7714,-912.5958 8379.5273,-902.8882 8376.7913,-913.1236 8383.7714,-912.5958"/>
</g>
<!-- raw_116 -->
<g id="node117" class="node">
<title>raw_116</title>
<ellipse fill="none" stroke="#000000" cx="8454" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8454" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_116 -->
<g id="edge116" class="edge">
<title>prose_100&#45;&gt;raw_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8207.4002,-1965.1395C8251.4266,-1922.1373 8371.9794,-1796.0616 8418,-1663.2027 8514.5563,-1384.4502 8472.7534,-1015.8092 8458.2305,-912.5976"/>
<polygon fill="#000000" stroke="#000000" points="8461.6882,-912.0519 8456.7985,-902.6529 8454.7596,-913.0497 8461.6882,-912.0519"/>
</g>
<!-- leaf_123 -->
<g id="node124" class="node">
<title>leaf_123</title>
<polygon fill="none" stroke="#c0c0c0" points="8942.5,-981.6022 8499.5,-981.6022 8499.5,-787.8007 8942.5,-787.8007 8942.5,-981.6022"/>
<text text-anchor="middle" x="8721" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8721" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8721" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8721" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8721" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8721" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8721" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8721" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8721" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8721" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8721" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_101&#45;&gt;leaf_123 -->
<g id="edge123" class="edge">
<title>codeblock_101&#45;&gt;leaf_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8528.2384,-1962.5946C8548.3909,-1849.9052 8657.2155,-1241.3746 8701.8665,-991.6928"/>
<polygon fill="#000000" stroke="#000000" points="8705.3708,-991.9791 8703.6859,-981.5191 8698.4801,-990.7468 8705.3708,-991.9791"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7401.5,-63.0015 7112.5,-63.0015 7112.5,-7.1986 7401.5,-7.1986 7401.5,-63.0015"/>
<text text-anchor="middle" x="7257" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>raw_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7667.0567,-866.5357C7678.6427,-760.5472 7731.6384,-222.7227 7628,-106.2001 7595.514,-69.6755 7458.962,-79.6356 7411,-70.2001 7402.594,-68.5464 7393.946,-66.7735 7385.2405,-64.9353"/>
<polygon fill="#000000" stroke="#000000" points="7385.9071,-61.4988 7375.3969,-62.8349 7384.4463,-68.3447 7385.9071,-61.4988"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7474,-53.1 7420,-53.1 7420,-17.1 7474,-17.1 7474,-53.1"/>
<text text-anchor="middle" x="7447" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>prespace_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7757.6018,-866.5035C7766.5384,-760.3313 7806.1596,-221.6392 7701,-106.2001 7634.8688,-33.6045 7570.6329,-114.5164 7483,-70.2001 7477.9367,-67.6396 7473.1238,-64.1165 7468.7605,-60.2847"/>
<polygon fill="#000000" stroke="#000000" points="7471.0551,-57.6347 7461.4352,-53.1953 7466.187,-62.6648 7471.0551,-57.6347"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="7546,-53.1 7492,-53.1 7492,-17.1 7546,-17.1 7546,-53.1"/>
<text text-anchor="middle" x="7519" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>literal_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7853.9977,-866.4902C7865.2347,-760.2426 7916.3911,-221.1942 7811,-106.2001 7733.3691,-21.4957 7658.1458,-120.8195 7555,-70.2001 7549.9064,-67.7004 7545.0786,-64.2072 7540.7099,-60.3862"/>
<polygon fill="#000000" stroke="#000000" points="7543.0044,-57.7362 7533.3839,-53.2982 7538.137,-62.767 7543.0044,-57.7362"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="7783.5,-54.4006 7564.5,-54.4006 7564.5,-15.7995 7783.5,-15.7995 7783.5,-54.4006"/>
<text text-anchor="middle" x="7674" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7674" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_106&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>raw_106&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7929.8451,-866.4177C7940.1076,-760.8946 7986.3746,-230.1203 7892,-106.2001 7887.3853,-100.1407 7810.3581,-75.9102 7749.1585,-57.4036"/>
<polygon fill="#000000" stroke="#000000" points="7750.0704,-54.023 7739.4857,-54.4862 7748.049,-60.7248 7750.0704,-54.023"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="7856,-53.1 7802,-53.1 7802,-17.1 7856,-17.1 7856,-53.1"/>
</g>
<!-- prespace_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>prespace_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8024.0908,-866.7515C8048.9892,-774.8733 8149.4286,-352.013 7964,-106.2001 7935.8048,-68.8232 7904.6487,-95.0996 7865,-70.2001 7860.4954,-67.3712 7856.0954,-63.9002 7852.0056,-60.2531"/>
<polygon fill="#000000" stroke="#000000" points="7854.222,-57.5297 7844.577,-53.1452 7849.3826,-62.5875 7854.222,-57.5297"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8037.5,-53.1 7874.5,-53.1 7874.5,-17.1 8037.5,-17.1 8037.5,-53.1"/>
<text text-anchor="middle" x="7956" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>literal_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116.2728,-866.7115C8123.2978,-762.8416 8154.1851,-239.7985 8074,-106.2001 8061.0762,-84.6674 8038.903,-68.8372 8017.242,-57.6541"/>
<polygon fill="#000000" stroke="#000000" points="8018.5394,-54.3925 8008.0185,-53.1427 8015.4637,-60.6806 8018.5394,-54.3925"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8400.5,-54.4006 8055.5,-54.4006 8055.5,-15.7995 8400.5,-15.7995 8400.5,-54.4006"/>
<text text-anchor="middle" x="8228" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8228" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>raw_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191.7899,-866.5632C8196.4958,-758.5056 8220.8303,-199.7321 8226.7169,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8230.2153,-64.6746 8227.1538,-54.5318 8223.2219,-64.37 8230.2153,-64.6746"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="8473,-53.1 8419,-53.1 8419,-17.1 8473,-17.1 8473,-53.1"/>
<text text-anchor="middle" x="8446" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>prespace_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8277.3644,-866.5557C8255.1962,-775.4379 8167.9041,-362.0821 8338,-106.2001 8357.5861,-76.7359 8380.0853,-90.5886 8409,-70.2001 8413.2332,-67.2152 8417.4637,-63.7616 8421.4719,-60.2093"/>
<polygon fill="#000000" stroke="#000000" points="8423.9057,-62.7256 8428.8477,-53.354 8419.1401,-57.5982 8423.9057,-62.7256"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="8545,-53.1 8491,-53.1 8491,-17.1 8545,-17.1 8545,-53.1"/>
<text text-anchor="middle" x="8518" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_115&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>literal_115&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8376.6413,-866.676C8369.1294,-762.6063 8335.9171,-238.6287 8418,-106.2001 8435.1936,-78.4608 8455.8732,-89.7571 8482,-70.2001 8485.9832,-67.2185 8489.9774,-63.8245 8493.7802,-60.3496"/>
<polygon fill="#000000" stroke="#000000" points="8496.4405,-62.6486 8501.2523,-53.2095 8491.6044,-57.5877 8496.4405,-62.6486"/>
</g>
<!-- leaf_122 -->
<g id="node123" class="node">
<title>leaf_122</title>
<polygon fill="none" stroke="#c0c0c0" points="8999,-54.4006 8563,-54.4006 8563,-15.7995 8999,-15.7995 8999,-54.4006"/>
<text text-anchor="middle" x="8781" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8781" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_116&#45;&gt;leaf_122 -->
<g id="edge122" class="edge">
<title>raw_116&#45;&gt;leaf_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8452.0506,-866.651C8441.0721,-761.3184 8390.9002,-226.5942 8490,-106.2001 8508.2778,-83.9948 8565.0792,-67.7053 8623.7052,-56.3646"/>
<polygon fill="#000000" stroke="#000000" points="8624.712,-59.7366 8633.8912,-54.4459 8623.4161,-52.8576 8624.712,-59.7366"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="9151.5,-902.7014 8960.5,-902.7014 8960.5,-866.7014 9151.5,-866.7014 9151.5,-902.7014"/>
<text text-anchor="middle" x="9056" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_124&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>header_124&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9100.2565,-1962.5946C9095.017,-1834.9848 9063.6713,-1071.5395 9057.1772,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="9060.6607,-912.8963 9056.7533,-903.0483 9053.6666,-913.1835 9060.6607,-912.8963"/>
</g>
<!-- raw_129 -->
<g id="node130" class="node">
<title>raw_129</title>
<ellipse fill="none" stroke="#000000" cx="9197" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9197" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_129 -->
<g id="edge129" class="edge">
<title>prose_125&#45;&gt;raw_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9332.0322,-1962.9231C9311.195,-1915.4437 9255.1695,-1781.2553 9233,-1663.2027 9178.7278,-1374.2037 9190.6586,-1014.8181 9195.5011,-912.8412"/>
<polygon fill="#000000" stroke="#000000" points="9199.0026,-912.8951 9195.9987,-902.735 9192.0111,-912.5508 9199.0026,-912.8951"/>
</g>
<!-- prespace_130 -->
<g id="node131" class="node">
<title>prespace_130</title>
<ellipse fill="none" stroke="#000000" cx="9288" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9288" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_125&#45;&gt;prespace_130 -->
<g id="edge130" class="edge">
<title>prose_125&#45;&gt;prespace_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9339.1408,-1962.5946C9333.0864,-1834.9848 9296.8646,-1071.5395 9289.3603,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="9292.8405,-912.8712 9288.8705,-903.0483 9285.8484,-913.203 9292.8405,-912.8712"/>
</g>
<!-- literal_131 -->
<g id="node132" class="node">
<title>literal_131</title>
<ellipse fill="none" stroke="#000000" cx="9384" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9384" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_125&#45;&gt;literal_131 -->
<g id="edge131" class="edge">
<title>prose_125&#45;&gt;literal_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340.727,-1962.5946C9345.85,-1834.9848 9376.4992,-1071.5395 9382.8489,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="9386.3594,-913.1807 9383.2634,-903.0483 9379.365,-912.8998 9386.3594,-913.1807"/>
</g>
<!-- raw_132 -->
<g id="node133" class="node">
<title>raw_132</title>
<ellipse fill="none" stroke="#000000" cx="9460" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9460" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_132 -->
<g id="edge132" class="edge">
<title>prose_125&#45;&gt;raw_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9346.202,-1962.7352C9362.4302,-1914.7958 9406.1225,-1779.58 9424,-1663.2027 9468.5979,-1372.8837 9463.4453,-1015.117 9460.8487,-913.068"/>
<polygon fill="#000000" stroke="#000000" points="9464.3442,-912.8496 9460.5776,-902.947 9457.3467,-913.0372 9464.3442,-912.8496"/>
</g>
<!-- raw_137 -->
<g id="node138" class="node">
<title>raw_137</title>
<ellipse fill="none" stroke="#000000" cx="9532" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9532" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_126&#45;&gt;raw_137 -->
<g id="edge137" class="edge">
<title>prose_126&#45;&gt;raw_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9478.179,-1962.4539C9481.3016,-1913.8261 9489.9603,-1777.0725 9496,-1663.2027 9511.5573,-1369.8905 9526.6174,-1014.2071 9530.836,-912.8605"/>
<polygon fill="#000000" stroke="#000000" points="9534.3353,-912.9472 9531.2535,-902.8105 9527.3414,-912.6566 9534.3353,-912.9472"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="10132.5,-1298.4029 9577.5,-1298.4029 9577.5,-470.9999 10132.5,-470.9999 10132.5,-1298.4029"/>
<text text-anchor="middle" x="9855" y="-1283.1022" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9855" y="-1267.7021" font-family="Inconsolata" font-size="14.00" fill="#000000">local gsub = assert(string.gsub)</text>
<text text-anchor="middle" x="9855" y="-1236.3021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="9855" y="-1220.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9855" y="-1205.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="9855" y="-1190.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9855" y="-1174.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9855" y="-1159.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9855" y="-1143.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9855" y="-1128.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9855" y="-1113.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="9855" y="-1097.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9855" y="-1082.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="9855" y="-1066.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9855" y="-1051.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9855" y="-1036.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9855" y="-1020.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="9855" y="-1005.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9855" y="-989.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="9855" y="-974.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9855" y="-959.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9855" y="-943.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="9855" y="-928.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9855" y="-912.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9855" y="-897.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9855" y="-882.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9855" y="-866.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9855" y="-819.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="9855" y="-803.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9855" y="-788.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return c.alert &quot;No results found&quot;</text>
<text text-anchor="middle" x="9855" y="-773.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9855" y="-757.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="9855" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="9855" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local alt_seq = &quot; &#160;&#160;&#160;&quot;</text>
<text text-anchor="middle" x="9855" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i &lt; 10 then</text>
<text text-anchor="middle" x="9855" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alt_seq = a.bold(&quot;M&#45;&quot; .. tostring(i) .. &quot; &quot;)</text>
<text text-anchor="middle" x="9855" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9855" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local next_line = alt_seq</text>
<text text-anchor="middle" x="9855" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="9855" y="-634.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="9855" y="-619.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i == collection.hl then</text>
<text text-anchor="middle" x="9855" y="-603.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;next_line = c.highlight(next_line)</text>
<text text-anchor="middle" x="9855" y="-588.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9855" y="-572.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase .. next_line</text>
<text text-anchor="middle" x="9855" y="-557.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9855" y="-526.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="9855" y="-510.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9855" y="-479.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_127&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>codeblock_127&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9736.9827,-1962.5946C9745.4219,-1885.5162 9779.2599,-1576.4626 9808.5513,-1308.9337"/>
<polygon fill="#000000" stroke="#000000" points="9812.0696,-1308.9563 9809.6789,-1298.6347 9805.1112,-1308.1944 9812.0696,-1308.9563"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9264.5,-63.0015 9017.5,-63.0015 9017.5,-7.1986 9264.5,-7.1986 9264.5,-63.0015"/>
<text text-anchor="middle" x="9141" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_129&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_129&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9197.5622,-866.4528C9199.9142,-780.4306 9206.7926,-407.028 9160,-106.2001 9158.2886,-95.1975 9155.5405,-83.4464 9152.6599,-72.7314"/>
<polygon fill="#000000" stroke="#000000" points="9155.9551,-71.5189 9149.887,-62.834 9149.2146,-73.4074 9155.9551,-71.5189"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9337,-53.1 9283,-53.1 9283,-17.1 9337,-17.1 9337,-53.1"/>
<text text-anchor="middle" x="9310" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_130&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>prespace_130&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9288.4697,-866.5632C9291.2741,-758.2631 9305.8019,-197.2221 9309.2604,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9312.7652,-63.5166 9309.5254,-53.4293 9305.7676,-63.3353 9312.7652,-63.5166"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9413,-53.1 9355,-53.1 9355,-17.1 9413,-17.1 9413,-53.1"/>
<text text-anchor="middle" x="9384" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>literal_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9384,-866.5632C9384,-758.2631 9384,-197.2221 9384,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9387.5001,-63.4293 9384,-53.4293 9380.5001,-63.4293 9387.5001,-63.4293"/>
</g>
<!-- leaf_136 -->
<g id="node137" class="node">
<title>leaf_136</title>
<polygon fill="none" stroke="#c0c0c0" points="9958.5,-62.3005 9431.5,-62.3005 9431.5,-7.8996 9958.5,-7.8996 9958.5,-62.3005"/>
<text text-anchor="middle" x="9695" y="-47.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9695" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9695" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_132&#45;&gt;leaf_136 -->
<g id="edge136" class="edge">
<title>raw_132&#45;&gt;leaf_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9458.2076,-866.4573C9448.2418,-761.1569 9403.3621,-231.4239 9496,-106.2001 9507.0161,-91.309 9540.3028,-77.1033 9576.5773,-65.359"/>
<polygon fill="#000000" stroke="#000000" points="9577.8774,-68.6189 9586.3598,-62.2708 9575.77,-61.9437 9577.8774,-68.6189"/>
</g>
<!-- leaf_138 -->
<g id="node139" class="node">
<title>leaf_138</title>
<polygon fill="none" stroke="#c0c0c0" points="10489.5,-62.4005 9976.5,-62.4005 9976.5,-7.7996 10489.5,-7.7996 10489.5,-62.4005"/>
<text text-anchor="middle" x="10233" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10233" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_137&#45;&gt;leaf_138 -->
<g id="edge138" class="edge">
<title>raw_137&#45;&gt;leaf_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9529.791,-866.4204C9517.3344,-759.7754 9460.1772,-218.8489 9568,-106.2001 9598.7794,-74.0431 9922.7585,-75.1128 9967,-70.2001 9985.0519,-68.1956 10003.7758,-65.9874 10022.5481,-63.684"/>
<polygon fill="#000000" stroke="#000000" points="10023.1752,-67.1333 10032.6707,-62.4336 10022.317,-60.1861 10023.1752,-67.1333"/>
</g>
<!-- leaf_148 -->
<g id="node149" class="node">
<title>leaf_148</title>
<polygon fill="none" stroke="#c0c0c0" points="10426.5,-1998.7033 10235.5,-1998.7033 10235.5,-1962.7033 10426.5,-1962.7033 10426.5,-1998.7033"/>
<text text-anchor="middle" x="10331" y="-1977.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_140&#45;&gt;leaf_148 -->
<g id="edge148" class="edge">
<title>header_140&#45;&gt;leaf_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10412.0707,-2353.4386C10398.5059,-2291.0722 10353.575,-2084.4955 10337.1133,-2008.81"/>
<polygon fill="#000000" stroke="#000000" points="10340.5311,-2008.0554 10334.9856,-1999.0277 10333.691,-2009.5432 10340.5311,-2008.0554"/>
</g>
<!-- raw_149 -->
<g id="node150" class="node">
<title>raw_149</title>
<ellipse fill="none" stroke="#000000" cx="10472" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="10472" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_149 -->
<g id="edge149" class="edge">
<title>prose_141&#45;&gt;raw_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10633.0893,-2360.7741C10598.2309,-2344.8543 10537.2399,-2311.46 10508,-2262.2038 10459.5297,-2180.553 10463.6358,-2062.3012 10468.627,-2008.8314"/>
<polygon fill="#000000" stroke="#000000" points="10472.1239,-2009.0388 10469.6543,-1998.7358 10465.1599,-2008.3301 10472.1239,-2009.0388"/>
</g>
<!-- prespace_150 -->
<g id="node151" class="node">
<title>prespace_150</title>
<ellipse fill="none" stroke="#000000" cx="10563" cy="-1980.7033" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10563" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_141&#45;&gt;prespace_150 -->
<g id="edge150" class="edge">
<title>prose_141&#45;&gt;prespace_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10651.4777,-2353.6054C10642.7037,-2332.1849 10628.227,-2295.0827 10619,-2262.2038 10593.3579,-2170.8323 10574.8746,-2059.6109 10567.0906,-2008.6463"/>
<polygon fill="#000000" stroke="#000000" points="10570.545,-2008.0809 10565.5933,-1998.7144 10563.6232,-2009.1245 10570.545,-2008.0809"/>
</g>
<!-- literal_151 -->
<g id="node152" class="node">
<title>literal_151</title>
<ellipse fill="none" stroke="#000000" cx="10659" cy="-1980.7033" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10659" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_141&#45;&gt;literal_151 -->
<g id="edge151" class="edge">
<title>prose_141&#45;&gt;literal_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10659,-2353.4386C10659,-2291.1998 10659,-2085.3398 10659,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="10662.5001,-2009.0277 10659,-1999.0277 10655.5001,-2009.0278 10662.5001,-2009.0277"/>
</g>
<!-- raw_152 -->
<g id="node153" class="node">
<title>raw_152</title>
<ellipse fill="none" stroke="#000000" cx="10737" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="10737" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_152 -->
<g id="edge152" class="edge">
<title>prose_141&#45;&gt;raw_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10666.878,-2353.6993C10675.9941,-2332.369 10690.7997,-2295.3536 10699,-2262.2038 10721.5065,-2171.221 10731.5394,-2060.178 10735.2148,-2009.0063"/>
<polygon fill="#000000" stroke="#000000" points="10738.7264,-2008.958 10735.9236,-1998.7406 10731.743,-2008.4758 10738.7264,-2008.958"/>
</g>
<!-- raw_157 -->
<g id="node158" class="node">
<title>raw_157</title>
<ellipse fill="none" stroke="#000000" cx="11077" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="11077" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_142&#45;&gt;raw_157 -->
<g id="edge157" class="edge">
<title>prose_142&#45;&gt;raw_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11193.4409,-2353.6966C11174.0298,-2291.5175 11109.1709,-2083.7557 11085.6302,-2008.3483"/>
<polygon fill="#000000" stroke="#000000" points="11088.9128,-2007.1179 11082.5918,-1998.6153 11082.2308,-2009.204 11088.9128,-2007.1179"/>
</g>
<!-- raw_159 -->
<g id="node160" class="node">
<title>raw_159</title>
<ellipse fill="none" stroke="#000000" cx="11359" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="11359" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_143&#45;&gt;raw_159 -->
<g id="edge159" class="edge">
<title>prose_143&#45;&gt;raw_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11355.1849,-2353.4386C11355.8219,-2291.1998 11357.929,-2085.3398 11358.7075,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="11362.2098,-2009.0631 11358.8124,-1999.0277 11355.2102,-2008.9914 11362.2098,-2009.0631"/>
</g>
<!-- raw_161 -->
<g id="node162" class="node">
<title>raw_161</title>
<ellipse fill="none" stroke="#000000" cx="11446" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="11446" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_144&#45;&gt;raw_161 -->
<g id="edge161" class="edge">
<title>prose_144&#45;&gt;raw_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11437.416,-2353.4386C11438.8494,-2291.1998 11443.5903,-2085.3398 11445.342,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="11448.8467,-2009.1057 11445.578,-1999.0277 11441.8486,-2008.9445 11448.8467,-2009.1057"/>
</g>
<!-- raw_163 -->
<g id="node164" class="node">
<title>raw_163</title>
<ellipse fill="none" stroke="#000000" cx="11525" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="11525" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_145&#45;&gt;raw_163 -->
<g id="edge163" class="edge">
<title>prose_145&#45;&gt;raw_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11519.2774,-2353.4386C11520.2329,-2291.1998 11523.3935,-2085.3398 11524.5613,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="11528.0646,-2009.0803 11524.7187,-1999.0277 11521.0655,-2008.9728 11528.0646,-2009.0803"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="11601" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="11601" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_146&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_146&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11601,-2353.4386C11601,-2291.1998 11601,-2085.3398 11601,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="11604.5001,-2009.0277 11601,-1999.0277 11597.5001,-2009.0278 11604.5001,-2009.0277"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="12201.5,-2262.2044 11646.5,-2262.2044 11646.5,-1699.2022 12201.5,-1699.2022 12201.5,-2262.2044"/>
<text text-anchor="middle" x="11924" y="-2247.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="11924" y="-2231.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="11924" y="-2216.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="11924" y="-2200.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if frag == &quot;&quot; then</text>
<text text-anchor="middle" x="11924" y="-2185.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return collection, false</text>
<text text-anchor="middle" x="11924" y="-2170.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11924" y="-2154.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="11924" y="-2139.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="11924" y="-2123.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="11924" y="-2108.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11924" y="-2093.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11924" y="-2077.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11924" y="-2062.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11924" y="-2030.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11924" y="-2015.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11924" y="-2000.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11924" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="11924" y="-1969.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="11924" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="11924" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="11924" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="11924" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="11924" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11924" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11924" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11924" y="-1846.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11924" y="-1830.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11924" y="-1815.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11924" y="-1799.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11924" y="-1784.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11924" y="-1769.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="11924" y="-1753.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="11924" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.hl = 1</text>
<text text-anchor="middle" x="11924" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="11924" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_147&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>codeblock_147&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11836.2528,-2353.4386C11840.4037,-2335.8066 11847.268,-2306.6481 11855.3824,-2272.1796"/>
<polygon fill="#000000" stroke="#000000" points="11858.8183,-2272.858 11857.703,-2262.322 11852.0045,-2271.2539 11858.8183,-2272.858"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="10517,-912.6029 10151,-912.6029 10151,-856.7999 10517,-856.7999 10517,-912.6029"/>
<text text-anchor="middle" x="10334" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_149&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>raw_149&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10469.7199,-1962.5946C10453.948,-1837.3338 10361.0371,-1099.4312 10338.7864,-922.7154"/>
<polygon fill="#000000" stroke="#000000" points="10342.2344,-922.0823 10337.5125,-912.5979 10335.2893,-922.9568 10342.2344,-922.0823"/>
</g>
<!-- leaf_154 -->
<g id="node155" class="node">
<title>leaf_154</title>
<polygon fill="none" stroke="#c0c0c0" points="10589,-902.7014 10535,-902.7014 10535,-866.7014 10589,-866.7014 10589,-902.7014"/>
<text text-anchor="middle" x="10562" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_150&#45;&gt;leaf_154 -->
<g id="edge154" class="edge">
<title>prespace_150&#45;&gt;leaf_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10562.9835,-1962.5946C10562.867,-1834.9848 10562.1705,-1071.5395 10562.0262,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="10565.526,-913.0451 10562.0167,-903.0483 10558.526,-913.0515 10565.526,-913.0451"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="10693,-902.7014 10607,-902.7014 10607,-866.7014 10693,-866.7014 10693,-902.7014"/>
<text text-anchor="middle" x="10650" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_151&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>literal_151&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10658.8513,-1962.5946C10657.8034,-1834.9848 10651.5343,-1071.5395 10650.2354,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="10653.7328,-913.0192 10650.1507,-903.0483 10646.733,-913.0768 10653.7328,-913.0192"/>
</g>
<!-- leaf_156 -->
<g id="node157" class="node">
<title>leaf_156</title>
<polygon fill="none" stroke="#c0c0c0" points="10765,-902.7014 10711,-902.7014 10711,-866.7014 10765,-866.7014 10765,-902.7014"/>
<text text-anchor="middle" x="10738" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_152&#45;&gt;leaf_156 -->
<g id="edge156" class="edge">
<title>raw_152&#45;&gt;leaf_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10737.0165,-1962.5946C10737.133,-1834.9848 10737.8295,-1071.5395 10737.9738,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="10741.474,-913.0515 10737.9833,-903.0483 10734.474,-913.0451 10741.474,-913.0515"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11296.5,-904.6035 10783.5,-904.6035 10783.5,-864.7993 11296.5,-864.7993 11296.5,-904.6035"/>
<text text-anchor="middle" x="11040" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_157&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>raw_157&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11076.3887,-1962.5946C11072.0947,-1835.4013 11046.4755,-1076.5166 11041.0209,-914.9413"/>
<polygon fill="#000000" stroke="#000000" points="11044.5128,-914.6409 11040.6773,-904.7647 11037.5168,-914.8771 11044.5128,-914.6409"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11477.5,-904.6035 11314.5,-904.6035 11314.5,-864.7993 11477.5,-864.7993 11477.5,-904.6035"/>
<text text-anchor="middle" x="11396" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_159&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_159&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11359.6113,-1962.5946C11363.9053,-1835.4013 11389.5245,-1076.5166 11394.9791,-914.9413"/>
<polygon fill="#000000" stroke="#000000" points="11398.4832,-914.8771 11395.3227,-904.7647 11391.4872,-914.6409 11398.4832,-914.8771"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="12022.5,-919.9018 11495.5,-919.9018 11495.5,-849.501 12022.5,-849.501 12022.5,-919.9018"/>
<text text-anchor="middle" x="11759" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11759" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11759" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_161&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>raw_161&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11447.6849,-1962.716C11452.1212,-1917.7964 11465.4347,-1797.2656 11489,-1699.2027 11561.1873,-1398.808 11693.6054,-1050.5916 11741.2963,-929.1678"/>
<polygon fill="#000000" stroke="#000000" points="11744.5748,-930.3943 11744.9816,-919.8073 11738.0614,-927.8299 11744.5748,-930.3943"/>
</g>
<!-- leaf_164 -->
<g id="node165" class="node">
<title>leaf_164</title>
<polygon fill="none" stroke="#c0c0c0" points="12469.5,-904.6035 12040.5,-904.6035 12040.5,-864.7993 12469.5,-864.7993 12469.5,-904.6035"/>
<text text-anchor="middle" x="12255" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection</text>
</g>
<!-- raw_163&#45;&gt;leaf_164 -->
<g id="edge164" class="edge">
<title>raw_163&#45;&gt;leaf_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11520.9405,-1962.8588C11510.7087,-1912.7434 11489.7509,-1769.7801 11565,-1699.2027 11640.757,-1628.149 11950.4912,-1728.8235 12031,-1663.2027 12270.9728,-1467.6068 12263.8746,-1032.775 12257.1735,-914.7537"/>
<polygon fill="#000000" stroke="#000000" points="12260.6592,-914.411 12256.5546,-904.6436 12253.6722,-914.8388 12260.6592,-914.411"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="12994,-912.0018 12488,-912.0018 12488,-857.401 12994,-857.401 12994,-912.0018"/>
<text text-anchor="middle" x="12741" y="-880.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="12741" y="-865.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_165&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_165&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11596.5278,-1962.7676C11585.1648,-1912.4124 11561.1792,-1768.8788 11637,-1699.2027 11705.8674,-1635.9166 12403.198,-1719.3501 12478,-1663.2027 12724.3651,-1478.2781 12742.2359,-1051.4469 12741.7945,-922.3584"/>
<polygon fill="#000000" stroke="#000000" points="12745.2932,-922.1628 12741.7185,-912.1893 12738.2934,-922.2152 12745.2932,-922.1628"/>
</g>
<!-- leaf_174 -->
<g id="node175" class="node">
<title>leaf_174</title>
<polygon fill="none" stroke="#c0c0c0" points="12918.5,-1998.7033 12769.5,-1998.7033 12769.5,-1962.7033 12918.5,-1962.7033 12918.5,-1998.7033"/>
<text text-anchor="middle" x="12844" y="-1977.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_168&#45;&gt;leaf_174 -->
<g id="edge174" class="edge">
<title>header_168&#45;&gt;leaf_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12864.0292,-2353.4386C12860.6848,-2291.1998 12849.6227,-2085.3398 12845.5354,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="12849.0163,-2008.8255 12844.9847,-1999.0277 12842.0264,-2009.2012 12849.0163,-2008.8255"/>
</g>
<!-- raw_175 -->
<g id="node176" class="node">
<title>raw_175</title>
<ellipse fill="none" stroke="#000000" cx="12964" cy="-1980.7033" rx="27" ry="18"/>
<text text-anchor="middle" x="12964" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_169&#45;&gt;raw_175 -->
<g id="edge175" class="edge">
<title>prose_169&#45;&gt;raw_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13032.0819,-2353.7092C13022.9272,-2332.3884 13008.0845,-2295.3821 13000,-2262.2038 12977.8317,-2171.2265 12968.7372,-2060.1808 12965.5228,-2009.0074"/>
<polygon fill="#000000" stroke="#000000" points="12968.9996,-2008.514 12964.9073,-1998.7414 12962.0121,-2008.9329 12968.9996,-2008.514"/>
</g>
<!-- leaf_177 -->
<g id="node178" class="node">
<title>leaf_177</title>
<polygon fill="none" stroke="#c0c0c0" points="13389,-2082.0836 13009,-2082.0836 13009,-1879.323 13389,-1879.323 13389,-2082.0836"/>
<text text-anchor="middle" x="13199" y="-2066.9434" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="13199" y="-2051.5434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13199" y="-2036.1434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13199" y="-2020.7433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13199" y="-2005.3433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="13199" y="-1986.5833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="13199" y="-1967.8233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="13199" y="-1952.4233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13199" y="-1937.0232" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="13199" y="-1918.2632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13199" y="-1902.8632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="13199" y="-1887.4632" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_170&#45;&gt;leaf_177 -->
<g id="edge177" class="edge">
<title>codeblock_170&#45;&gt;leaf_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13199,-2353.4386C13199,-2307.7888 13199,-2184.8757 13199,-2092.5836"/>
<polygon fill="#000000" stroke="#000000" points="13202.5001,-2092.339 13199,-2082.339 13195.5001,-2092.339 13202.5001,-2092.339"/>
</g>
<!-- header_178 -->
<g id="node179" class="node">
<title>header_178</title>
<ellipse fill="none" stroke="#000000" cx="13489" cy="-1980.7033" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="13489" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_171&#45;&gt;header_178 -->
<g id="edge178" class="edge">
<title>section_171&#45;&gt;header_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13551.9491,-2353.4386C13541.4379,-2291.1998 13506.6714,-2085.3398 13493.8255,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="13497.2112,-2008.3052 13492.0947,-1999.0277 13490.3089,-2009.471 13497.2112,-2008.3052"/>
</g>
<!-- prose_179 -->
<g id="node180" class="node">
<title>prose_179</title>
<ellipse fill="none" stroke="#000000" cx="13622" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13622" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_179 -->
<g id="edge179" class="edge">
<title>section_171&#45;&gt;prose_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13559.5863,-2353.4142C13564.9592,-2331.8096 13573.9007,-2294.5306 13580,-2262.2038 13597.3689,-2170.1473 13612.047,-2060.0494 13618.4936,-2009.1218"/>
<polygon fill="#000000" stroke="#000000" points="13622.0042,-2009.2557 13619.7776,-1998.8975 13615.0588,-2008.3835 13622.0042,-2009.2557"/>
</g>
<!-- codeblock_180 -->
<g id="node181" class="node">
<title>codeblock_180</title>
<ellipse fill="none" stroke="#000000" cx="13830" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13830" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 466&#45;487</text>
</g>
<!-- section_171&#45;&gt;codeblock_180 -->
<g id="edge180" class="edge">
<title>section_171&#45;&gt;codeblock_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13575.2129,-2353.8444C13598.1114,-2333.2364 13635.7763,-2297.4681 13663,-2262.2038 13729.8752,-2175.577 13790.6441,-2059.9731 13816.6462,-2008.0172"/>
<polygon fill="#000000" stroke="#000000" points="13819.9159,-2009.3023 13821.2327,-1998.7896 13813.6475,-2006.1866 13819.9159,-2009.3023"/>
</g>
<!-- header_191 -->
<g id="node192" class="node">
<title>header_191</title>
<ellipse fill="none" stroke="#000000" cx="14207" cy="-1980.7033" rx="111.1981" ry="18"/>
<text text-anchor="middle" x="14207" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:index(cursor)</text>
</g>
<!-- section_172&#45;&gt;header_191 -->
<g id="edge191" class="edge">
<title>section_172&#45;&gt;header_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14284.2557,-2353.4386C14271.3556,-2291.1998 14228.6877,-2085.3398 14212.9222,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="14216.2548,-2008.1093 14210.7981,-1999.0277 14209.4005,-2009.53 14216.2548,-2008.1093"/>
</g>
<!-- prose_192 -->
<g id="node193" class="node">
<title>prose_192</title>
<ellipse fill="none" stroke="#000000" cx="14369" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14369" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_192 -->
<g id="edge192" class="edge">
<title>section_172&#45;&gt;prose_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14295.7416,-2353.2765C14304.5502,-2331.8486 14318.7762,-2295.0374 14327,-2262.2038 14349.817,-2171.1069 14361.904,-2060.1192 14366.6171,-2008.9836"/>
<polygon fill="#000000" stroke="#000000" points="14370.1297,-2008.9981 14367.5368,-1998.7255 14363.1577,-2008.373 14370.1297,-2008.9981"/>
</g>
<!-- codeblock_193 -->
<g id="node194" class="node">
<title>codeblock_193</title>
<ellipse fill="none" stroke="#000000" cx="14569" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14569" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 494&#45;507</text>
</g>
<!-- section_172&#45;&gt;codeblock_193 -->
<g id="edge193" class="edge">
<title>section_172&#45;&gt;codeblock_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14311.666,-2354.1163C14337.9039,-2334.0288 14380.4198,-2298.993 14410,-2262.2038 14477.9005,-2177.7554 14533.8148,-2060.5841 14557.2052,-2008.0716"/>
<polygon fill="#000000" stroke="#000000" points="14560.4833,-2009.3122 14561.3169,-1998.7502 14554.0787,-2006.4871 14560.4833,-2009.3122"/>
</g>
<!-- header_198 -->
<g id="node199" class="node">
<title>header_198</title>
<ellipse fill="none" stroke="#000000" cx="15058" cy="-1980.7033" rx="184.6938" ry="18"/>
<text text-anchor="middle" x="15058" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append(txtbuf, results, success)</text>
</g>
<!-- section_173&#45;&gt;header_198 -->
<g id="edge198" class="edge">
<title>section_173&#45;&gt;header_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15352.194,-2354.0186C15326.3117,-2333.5705 15283.5955,-2297.9485 15252,-2262.2038 15175.9816,-2176.2025 15104.1063,-2059.4933 15073.4956,-2007.5493"/>
<polygon fill="#000000" stroke="#000000" points="15076.5113,-2005.7728 15068.4362,-1998.914 15070.4716,-2009.3115 15076.5113,-2005.7728"/>
</g>
<!-- prose_199 -->
<g id="node200" class="node">
<title>prose_199</title>
<ellipse fill="none" stroke="#000000" cx="15293" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15293" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_173&#45;&gt;prose_199 -->
<g id="edge199" class="edge">
<title>section_173&#45;&gt;prose_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15366.8032,-2353.3266C15357.4882,-2331.9458 15342.4814,-2295.1788 15334,-2262.2038 15310.6188,-2171.2998 15299.3565,-2060.2186 15295.1057,-2009.022"/>
<polygon fill="#000000" stroke="#000000" points="15298.5703,-2008.439 15294.2813,-1998.7511 15291.5927,-2008.9991 15298.5703,-2008.439"/>
</g>
<!-- prose_200 -->
<g id="node201" class="node">
<title>prose_200</title>
<ellipse fill="none" stroke="#000000" cx="15375" cy="-1980.7033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15375" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_173&#45;&gt;prose_200 -->
<g id="edge200" class="edge">
<title>section_173&#45;&gt;prose_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15375,-2353.4386C15375,-2291.1998 15375,-2085.3398 15375,-2009.2759"/>
<polygon fill="#000000" stroke="#000000" points="15378.5001,-2009.0277 15375,-1999.0277 15371.5001,-2009.0278 15378.5001,-2009.0277"/>
</g>
<!-- codeblock_201 -->
<g id="node202" class="node">
<title>codeblock_201</title>
<ellipse fill="none" stroke="#000000" cx="15564" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15564" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 515&#45;530</text>
</g>
<!-- section_173&#45;&gt;codeblock_201 -->
<g id="edge201" class="edge">
<title>section_173&#45;&gt;codeblock_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15383.7368,-2353.4386C15413.9603,-2290.9447 15514.2127,-2083.65 15550.6307,-2008.3473"/>
<polygon fill="#000000" stroke="#000000" points="15553.9349,-2009.5541 15555.1379,-1999.0277 15547.6332,-2006.5064 15553.9349,-2009.5541"/>
</g>
<!-- codeblock_202 -->
<g id="node203" class="node">
<title>codeblock_202</title>
<ellipse fill="none" stroke="#000000" cx="15874" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15874" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 532&#45;539</text>
</g>
<!-- section_173&#45;&gt;codeblock_202 -->
<g id="edge202" class="edge">
<title>section_173&#45;&gt;codeblock_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15431.7508,-2359.5735C15492.7664,-2344.632 15590.3671,-2314.4285 15660,-2262.2038 15756.3348,-2189.9528 15830.6802,-2063.1551 15860.1762,-2007.8183"/>
<polygon fill="#000000" stroke="#000000" points="15863.2801,-2009.4356 15864.8406,-1998.9563 15857.0857,-2006.1752 15863.2801,-2009.4356"/>
</g>
<!-- codeblock_203 -->
<g id="node204" class="node">
<title>codeblock_203</title>
<ellipse fill="none" stroke="#000000" cx="16185" cy="-1980.7033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="16185" y="-1976.5033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 541&#45;543</text>
</g>
<!-- section_173&#45;&gt;codeblock_203 -->
<g id="edge203" class="edge">
<title>section_173&#45;&gt;codeblock_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15445.3799,-2364.9625C15583.1708,-2351.1335 15882.7061,-2315.7372 15970,-2262.2038 16073.5721,-2198.6878 16145.3354,-2065.5448 16172.6985,-2008.0762"/>
<polygon fill="#000000" stroke="#000000" points="16175.9289,-2009.4309 16176.9993,-1998.8903 16169.5893,-2006.4628 16175.9289,-2009.4309"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="13066,-902.7014 13012,-902.7014 13012,-866.7014 13066,-866.7014 13066,-902.7014"/>
</g>
<!-- raw_175&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>raw_175&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12966.7285,-1962.4994C12973.8934,-1913.9829 12993.3534,-1777.478 13003,-1663.2027 13027.7071,-1370.5192 13036.3988,-1014.3982 13038.4702,-912.9041"/>
<polygon fill="#000000" stroke="#000000" points="13041.9707,-912.9069 13038.6707,-902.8392 13034.9721,-912.7675 13041.9707,-912.9069"/>
</g>
<!-- leaf_181 -->
<g id="node182" class="node">
<title>leaf_181</title>
<polygon fill="none" stroke="#c0c0c0" points="13352,-902.7014 13196,-902.7014 13196,-866.7014 13352,-866.7014 13352,-902.7014"/>
<text text-anchor="middle" x="13274" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_178&#45;&gt;leaf_181 -->
<g id="edge181" class="edge">
<title>header_178&#45;&gt;leaf_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13486.2758,-1962.629C13478.613,-1915.9691 13453.697,-1788.8594 13398,-1699.2027 13385.8927,-1679.7134 13371.0869,-1683.8103 13361,-1663.2027 13230.4941,-1396.5794 13259.2885,-1018.6584 13270.6089,-913.066"/>
<polygon fill="#000000" stroke="#000000" points="13274.1132,-913.2207 13271.7373,-902.8957 13267.1559,-912.4487 13274.1132,-913.2207"/>
</g>
<!-- raw_182 -->
<g id="node183" class="node">
<title>raw_182</title>
<ellipse fill="none" stroke="#000000" cx="13397" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13397" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_182 -->
<g id="edge182" class="edge">
<title>prose_179&#45;&gt;raw_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13625.4282,-1962.7345C13633.6968,-1913.5155 13649.254,-1775.1451 13580,-1699.2027 13534.6762,-1649.5017 13475.7339,-1715.1475 13433,-1663.2027 13336.7381,-1546.1925 13381.3579,-1038.0328 13394.0293,-912.7138"/>
<polygon fill="#000000" stroke="#000000" points="13397.5125,-913.0561 13395.0516,-902.7511 13390.549,-912.3416 13397.5125,-913.0561"/>
</g>
<!-- prespace_183 -->
<g id="node184" class="node">
<title>prespace_183</title>
<ellipse fill="none" stroke="#000000" cx="13488" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13488" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_179&#45;&gt;prespace_183 -->
<g id="edge183" class="edge">
<title>prose_179&#45;&gt;prespace_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13623.0906,-1962.4087C13625.0941,-1915.758 13625.582,-1789.6634 13580,-1699.2027 13569.8179,-1678.9957 13553.404,-1683.7834 13544,-1663.2027 13421.0753,-1394.181 13467.0596,-1017.9515 13483.2817,-912.9098"/>
<polygon fill="#000000" stroke="#000000" points="13486.7765,-913.2177 13484.8833,-902.7934 13479.8626,-912.123 13486.7765,-913.2177"/>
</g>
<!-- literal_184 -->
<g id="node185" class="node">
<title>literal_184</title>
<ellipse fill="none" stroke="#000000" cx="13584" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13584" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_179&#45;&gt;literal_184 -->
<g id="edge184" class="edge">
<title>prose_179&#45;&gt;literal_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13621.3721,-1962.5946C13616.9477,-1834.9848 13590.478,-1071.5395 13584.9941,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="13588.4806,-912.921 13584.6361,-903.0483 13581.4848,-913.1636 13588.4806,-912.921"/>
</g>
<!-- raw_185 -->
<g id="node186" class="node">
<title>raw_185</title>
<ellipse fill="none" stroke="#000000" cx="13660" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13660" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_185 -->
<g id="edge185" class="edge">
<title>prose_179&#45;&gt;raw_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13622.6279,-1962.5946C13627.0523,-1834.9848 13653.522,-1071.5395 13659.0059,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="13662.5152,-913.1636 13659.3639,-903.0483 13655.5194,-912.921 13662.5152,-913.1636"/>
</g>
<!-- leaf_190 -->
<g id="node191" class="node">
<title>leaf_190</title>
<polygon fill="none" stroke="#c0c0c0" points="14093.4016,-1049.6422 13704.5984,-1049.6422 13704.5984,-719.7606 14093.4016,-719.7606 14093.4016,-1049.6422"/>
<text text-anchor="middle" x="13899" y="-1034.2217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="13899" y="-1018.8216" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="13899" y="-1000.0616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13899" y="-984.6616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13899" y="-969.2616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13899" y="-953.8615" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="13899" y="-935.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13899" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf(), nil, true</text>
<text text-anchor="middle" x="13899" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13899" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="13899" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13899" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="13899" y="-839.3414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13899" y="-823.9414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="13899" y="-805.1814" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="13899" y="-789.7813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="13899" y="-774.3813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="13899" y="-758.9813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="13899" y="-743.5812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13899" y="-728.1812" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_180&#45;&gt;leaf_190 -->
<g id="edge190" class="edge">
<title>codeblock_180&#45;&gt;leaf_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13831.1401,-1962.5946C13837.6544,-1859.1197 13870.4887,-1337.5768 13887.9845,-1059.6719"/>
<polygon fill="#000000" stroke="#000000" points="13891.4907,-1059.682 13888.6261,-1049.4818 13884.5046,-1059.2421 13891.4907,-1059.682"/>
</g>
<!-- leaf_186 -->
<g id="node187" class="node">
<title>leaf_186</title>
<polygon fill="none" stroke="#c0c0c0" points="13442.5,-63.0015 12971.5,-63.0015 12971.5,-7.1986 13442.5,-7.1986 13442.5,-63.0015"/>
<text text-anchor="middle" x="13207" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_182&#45;&gt;leaf_186 -->
<g id="edge186" class="edge">
<title>raw_182&#45;&gt;leaf_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13398.6198,-866.5791C13407.6141,-761.9643 13447.951,-235.4375 13361,-106.2001 13350.1513,-90.0754 13334.6613,-77.5392 13317.6442,-67.8129"/>
<polygon fill="#000000" stroke="#000000" points="13319.09,-64.6169 13308.6226,-62.9788 13315.7838,-70.7869 13319.09,-64.6169"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="13515,-53.1 13461,-53.1 13461,-17.1 13515,-17.1 13515,-53.1"/>
</g>
<!-- prespace_183&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>prespace_183&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13488,-866.5632C13488,-758.2631 13488,-197.2221 13488,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13491.5001,-63.4293 13488,-53.4293 13484.5001,-63.4293 13491.5001,-63.4293"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13633,-53.1 13533,-53.1 13533,-17.1 13633,-17.1 13633,-53.1"/>
<text text-anchor="middle" x="13583" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_184&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>literal_184&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13583.9787,-866.5632C13583.8512,-758.2631 13583.1908,-197.2221 13583.0336,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13586.5334,-63.4251 13583.0216,-53.4293 13579.5334,-63.4334 13586.5334,-63.4251"/>
</g>
<!-- leaf_189 -->
<g id="node190" class="node">
<title>leaf_189</title>
<polygon fill="none" stroke="#c0c0c0" points="13891,-55.0021 13651,-55.0021 13651,-15.198 13891,-15.198 13891,-55.0021"/>
<text text-anchor="middle" x="13771" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_185&#45;&gt;leaf_189 -->
<g id="edge189" class="edge">
<title>raw_185&#45;&gt;leaf_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13659.0351,-866.6202C13653.7903,-763.338 13631.2571,-247.6868 13696,-106.2001 13704.0628,-88.58 13718.671,-73.1726 13732.8669,-61.2469"/>
<polygon fill="#000000" stroke="#000000" points="13735.0581,-63.9762 13740.6669,-54.9878 13730.677,-58.5166 13735.0581,-63.9762"/>
</g>
<!-- leaf_194 -->
<g id="node195" class="node">
<title>leaf_194</title>
<polygon fill="none" stroke="#c0c0c0" points="14316.5,-902.7014 14111.5,-902.7014 14111.5,-866.7014 14316.5,-866.7014 14316.5,-902.7014"/>
<text text-anchor="middle" x="14214" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:index(cursor)</text>
</g>
<!-- header_191&#45;&gt;leaf_194 -->
<g id="edge194" class="edge">
<title>header_191&#45;&gt;leaf_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14207.1157,-1962.5946C14207.9307,-1834.9848 14212.8067,-1071.5395 14213.8169,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="14217.3188,-913.0705 14213.8828,-903.0483 14210.3189,-913.0257 14217.3188,-913.0705"/>
</g>
<!-- raw_195 -->
<g id="node196" class="node">
<title>raw_195</title>
<ellipse fill="none" stroke="#000000" cx="14362" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14362" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_192&#45;&gt;raw_195 -->
<g id="edge195" class="edge">
<title>prose_192&#45;&gt;raw_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14368.8843,-1962.5946C14368.0693,-1834.9848 14363.1933,-1071.5395 14362.1831,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="14365.6811,-913.0257 14362.1172,-903.0483 14358.6812,-913.0705 14365.6811,-913.0257"/>
</g>
<!-- leaf_197 -->
<g id="node198" class="node">
<title>leaf_197</title>
<polygon fill="none" stroke="#c0c0c0" points="14871,-981.0019 14407,-981.0019 14407,-788.4009 14871,-788.4009 14871,-981.0019"/>
<text text-anchor="middle" x="14639" y="-965.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.index(historian, cursor)</text>
<text text-anchor="middle" x="14639" y="-950.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (not cursor) or cursor &lt; 0 or cursor &gt; #historian + 1 then</text>
<text text-anchor="middle" x="14639" y="-935.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="14639" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14639" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[cursor]</text>
<text text-anchor="middle" x="14639" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="14639" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf = txtbuf:clone()</text>
<text text-anchor="middle" x="14639" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = cursor</text>
<text text-anchor="middle" x="14639" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="14639" y="-827.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="14639" y="-811.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf, result</text>
<text text-anchor="middle" x="14639" y="-796.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_193&#45;&gt;leaf_197 -->
<g id="edge197" class="edge">
<title>codeblock_193&#45;&gt;leaf_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14570.1566,-1962.5946C14577.3583,-1849.8366 14616.2672,-1240.6332 14632.1957,-991.237"/>
<polygon fill="#000000" stroke="#000000" points="14635.7001,-991.2786 14632.8447,-981.0758 14628.7144,-990.8323 14635.7001,-991.2786"/>
</g>
<!-- leaf_196 -->
<g id="node197" class="node">
<title>leaf_196</title>
<polygon fill="none" stroke="#c0c0c0" points="14496,-63.0015 14228,-63.0015 14228,-7.1986 14496,-7.1986 14496,-63.0015"/>
<text text-anchor="middle" x="14362" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Loads the history to an exact index.</text>
</g>
<!-- raw_195&#45;&gt;leaf_196 -->
<g id="edge196" class="edge">
<title>raw_195&#45;&gt;leaf_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14362,-866.5632C14362,-760.6464 14362,-221.6953 14362,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="14365.5001,-73.0758 14362,-63.0758 14358.5001,-73.0759 14365.5001,-73.0758"/>
</g>
<!-- leaf_204 -->
<g id="node205" class="node">
<title>leaf_204</title>
<polygon fill="none" stroke="#c0c0c0" points="15227,-902.7014 14889,-902.7014 14889,-866.7014 15227,-866.7014 15227,-902.7014"/>
<text text-anchor="middle" x="15058" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append(txtbuf, results, success)</text>
</g>
<!-- header_198&#45;&gt;leaf_204 -->
<g id="edge204" class="edge">
<title>header_198&#45;&gt;leaf_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15058,-1962.5946C15058,-1834.9848 15058,-1071.5395 15058,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="15061.5001,-913.0483 15058,-903.0483 15054.5001,-913.0484 15061.5001,-913.0483"/>
</g>
<!-- raw_205 -->
<g id="node206" class="node">
<title>raw_205</title>
<ellipse fill="none" stroke="#000000" cx="15272" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15272" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_199&#45;&gt;raw_205 -->
<g id="edge205" class="edge">
<title>prose_199&#45;&gt;raw_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15292.653,-1962.5946C15290.208,-1834.9848 15275.5799,-1071.5395 15272.5494,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="15276.0426,-912.9794 15272.3515,-903.0483 15269.0438,-913.1136 15276.0426,-912.9794"/>
</g>
<!-- raw_207 -->
<g id="node208" class="node">
<title>raw_207</title>
<ellipse fill="none" stroke="#000000" cx="15344" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15344" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_200&#45;&gt;raw_207 -->
<g id="edge207" class="edge">
<title>prose_200&#45;&gt;raw_207</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15374.4878,-1962.5946C15370.8784,-1834.9848 15349.2846,-1071.5395 15344.811,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="15348.3004,-912.9453 15344.5189,-903.0483 15341.3032,-913.1433 15348.3004,-912.9453"/>
</g>
<!-- leaf_209 -->
<g id="node210" class="node">
<title>leaf_209</title>
<polygon fill="none" stroke="#c0c0c0" points="15839,-996.3022 15389,-996.3022 15389,-773.1006 15839,-773.1006 15839,-996.3022"/>
<text text-anchor="middle" x="15614" y="-981.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="15614" y="-965.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf)</text>
<text text-anchor="middle" x="15614" y="-950.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or tostring(txtbuf) == &quot;&quot; then</text>
<text text-anchor="middle" x="15614" y="-935.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="15614" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="15614" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15614" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="15614" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="15614" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="15614" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="15614" y="-827.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="15614" y="-811.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15614" y="-796.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="15614" y="-781.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_201&#45;&gt;leaf_209 -->
<g id="edge209" class="edge">
<title>codeblock_201&#45;&gt;leaf_209</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15564.8261,-1962.5946C15569.8662,-1852.1153 15596.6482,-1265.0533 15608.4302,-1006.791"/>
<polygon fill="#000000" stroke="#000000" points="15611.9349,-1006.7672 15608.8943,-996.618 15604.9421,-1006.4481 15611.9349,-1006.7672"/>
</g>
<!-- leaf_210 -->
<g id="node211" class="node">
<title>leaf_210</title>
<polygon fill="none" stroke="#c0c0c0" points="16125,-935.1024 15857,-935.1024 15857,-834.3004 16125,-834.3004 16125,-935.1024"/>
<text text-anchor="middle" x="15991" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="15991" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="15991" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="15991" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="15991" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15991" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_202&#45;&gt;leaf_210 -->
<g id="edge210" class="edge">
<title>codeblock_202&#45;&gt;leaf_210</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15875.9331,-1962.5946C15888.7964,-1842.0973 15962.1807,-1154.6676 15984.5367,-945.2462"/>
<polygon fill="#000000" stroke="#000000" points="15988.0435,-945.3687 15985.6248,-935.0536 15981.083,-944.6256 15988.0435,-945.3687"/>
</g>
<!-- leaf_211 -->
<g id="node212" class="node">
<title>leaf_211</title>
<polygon fill="none" stroke="#c0c0c0" points="16229,-902.7014 16143,-902.7014 16143,-866.7014 16229,-866.7014 16229,-902.7014"/>
<text text-anchor="middle" x="16186" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_203&#45;&gt;leaf_211 -->
<g id="edge211" class="edge">
<title>codeblock_203&#45;&gt;leaf_211</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16185.0165,-1962.5946C16185.133,-1834.9848 16185.8295,-1071.5395 16185.9738,-913.3732"/>
<polygon fill="#000000" stroke="#000000" points="16189.474,-913.0515 16185.9833,-903.0483 16182.474,-913.0451 16189.474,-913.0515"/>
</g>
<!-- leaf_206 -->
<g id="node207" class="node">
<title>leaf_206</title>
<polygon fill="none" stroke="#c0c0c0" points="15330,-63.0015 15006,-63.0015 15006,-7.1986 15330,-7.1986 15330,-63.0015"/>
<text text-anchor="middle" x="15168" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_205&#45;&gt;leaf_206 -->
<g id="edge206" class="edge">
<title>raw_205&#45;&gt;leaf_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15275.5926,-866.7142C15292.2729,-778.8103 15356.3882,-387.2839 15236,-106.2001 15230.3182,-92.9341 15220.9795,-80.6799 15211.0169,-70.2146"/>
<polygon fill="#000000" stroke="#000000" points="15213.2505,-67.4994 15203.6956,-62.9216 15208.3103,-72.4587 15213.2505,-67.4994"/>
</g>
<!-- leaf_208 -->
<g id="node209" class="node">
<title>leaf_208</title>
<polygon fill="none" stroke="#c0c0c0" points="15546,-55.0021 15348,-55.0021 15348,-15.198 15546,-15.198 15546,-55.0021"/>
<text text-anchor="middle" x="15447" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_207&#45;&gt;leaf_208 -->
<g id="edge208" class="edge">
<title>raw_207&#45;&gt;leaf_208</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15340.4503,-866.7324C15323.971,-778.9142 15260.6522,-387.7273 15380,-106.2001 15387.194,-89.2303 15400.3537,-73.8557 15413.1178,-61.7798"/>
<polygon fill="#000000" stroke="#000000" points="15415.4731,-64.3688 15420.5394,-55.0638 15410.7762,-59.1785 15415.4731,-64.3688"/>
</g>
</g>
</svg>
