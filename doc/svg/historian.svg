<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="6910pt" height="1492pt"
 viewBox="0.00 0.00 6910.00 1491.64" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1487.6419)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1487.6419 6906,-1487.6419 6906,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1728" cy="-1465.6419" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1728" y="-1461.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 241</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1728" cy="-1393.6419" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1728" y="-1389.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;171</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1728,-1447.4732C1728,-1439.7728 1728,-1430.6162 1728,-1422.0585"/>
<polygon fill="#000000" stroke="#000000" points="1731.5001,-1422.0551 1728,-1412.0551 1724.5001,-1422.0552 1731.5001,-1422.0551"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1305" cy="-1321.6419" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1305" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1667.7149,-1386.2846C1597.1794,-1377.2462 1477.0436,-1360.5124 1375,-1339.6419 1369.6215,-1338.5418 1364.037,-1337.2921 1358.4738,-1335.9759"/>
<polygon fill="#000000" stroke="#000000" points="1359.0769,-1332.5205 1348.5325,-1333.553 1357.4193,-1339.3214 1359.0769,-1332.5205"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1416" cy="-1321.6419" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1416" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1669.191,-1385.4853C1613.8997,-1376.9748 1529.2172,-1361.7612 1458,-1339.6419 1455.5472,-1338.88 1453.0431,-1338.023 1450.5399,-1337.1071"/>
<polygon fill="#000000" stroke="#000000" points="1451.5872,-1333.7582 1440.9998,-1333.359 1449.0274,-1340.2734 1451.5872,-1333.7582"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1499" cy="-1321.6419" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1499" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1679.4359,-1381.387C1641.3795,-1371.3607 1587.3029,-1356.1777 1541,-1339.6419 1538.5813,-1338.7781 1536.1026,-1337.8449 1533.6178,-1336.8737"/>
<polygon fill="#000000" stroke="#000000" points="1534.6994,-1333.5351 1524.1178,-1333.0056 1532.0596,-1340.0183 1534.6994,-1333.5351"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1582" cy="-1321.6419" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1582" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1695.9597,-1377.8411C1672.0983,-1366.0739 1639.6044,-1350.0495 1615.4189,-1338.1224"/>
<polygon fill="#000000" stroke="#000000" points="1616.7832,-1334.8928 1606.2664,-1333.6088 1613.6871,-1341.1709 1616.7832,-1334.8928"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1664" cy="-1321.6419" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1664" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1712.1798,-1375.8441C1704.1184,-1366.775 1694.1979,-1355.6145 1685.4584,-1345.7825"/>
<polygon fill="#000000" stroke="#000000" points="1688.0204,-1343.3965 1678.7607,-1338.2477 1682.7885,-1348.0471 1688.0204,-1343.3965"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1792" cy="-1321.6419" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1792" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;23</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1743.8202,-1375.8441C1751.5126,-1367.1901 1760.8978,-1356.6318 1769.3344,-1347.1407"/>
<polygon fill="#000000" stroke="#000000" points="1772.1122,-1349.2838 1776.14,-1339.4844 1766.8803,-1344.6332 1772.1122,-1349.2838"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2009" cy="-1321.6419" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2009" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 25&#45;27</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1775.9863,-1381.3464C1823.2571,-1369.2343 1895.679,-1350.6778 1947.2255,-1337.4702"/>
<polygon fill="#000000" stroke="#000000" points="1948.1011,-1340.859 1956.9194,-1334.9863 1946.3636,-1334.078 1948.1011,-1340.859"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2315" cy="-1321.6419" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2315" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 30&#45;81</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1788.0607,-1386.275C1897.4038,-1372.8632 2128.3921,-1344.5307 2244.8035,-1330.252"/>
<polygon fill="#000000" stroke="#000000" points="2245.5247,-1333.6898 2255.0242,-1328.9983 2244.6724,-1326.7419 2245.5247,-1333.6898"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="3329" cy="-1321.6419" rx="70.655" ry="18"/>
<text text-anchor="middle" x="3329" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 82&#45;171</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1792.9938,-1390.719C2046.9008,-1379.3003 2971.5308,-1337.7179 3249.4574,-1325.219"/>
<polygon fill="#000000" stroke="#000000" points="3249.6298,-1328.7149 3259.4624,-1324.7691 3249.3152,-1321.722 3249.6298,-1328.7149"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="4699" cy="-1321.6419" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4699" y="-1317.4419" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 172&#45;216</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1793.5161,-1392.0541C2181.3909,-1382.6543 4174.8089,-1334.3452 4613.5287,-1323.7132"/>
<polygon fill="#000000" stroke="#000000" points="4613.6892,-1327.2104 4623.6015,-1323.4691 4613.5196,-1320.2125 4613.6892,-1327.2104"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1350.5,-1235.4418 1257.5,-1235.4418 1257.5,-1199.4418 1350.5,-1199.4418 1350.5,-1235.4418"/>
<text text-anchor="middle" x="1304" y="-1213.9418" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1304.8258,-1303.4916C1304.6733,-1287.6016 1304.4492,-1264.249 1304.2729,-1245.8795"/>
<polygon fill="#000000" stroke="#000000" points="1307.7714,-1245.6996 1304.1755,-1235.7337 1300.7718,-1245.7668 1307.7714,-1245.6996"/>
</g>
<!-- raw_13 -->
<g id="node14" class="node">
<title>raw_13</title>
<ellipse fill="none" stroke="#000000" cx="1396" cy="-1217.4418" rx="27" ry="18"/>
<text text-anchor="middle" x="1396" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;raw_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1412.5163,-1303.4916C1409.4333,-1287.4294 1404.8868,-1263.742 1401.344,-1245.284"/>
<polygon fill="#000000" stroke="#000000" points="1404.7661,-1244.545 1399.4438,-1235.384 1397.8916,-1245.8645 1404.7661,-1244.545"/>
</g>
<!-- raw_15 -->
<g id="node16" class="node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="1468" cy="-1217.4418" rx="27" ry="18"/>
<text text-anchor="middle" x="1468" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_4&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1493.6002,-1303.4916C1488.7994,-1287.3547 1481.7089,-1263.5215 1476.2067,-1245.0268"/>
<polygon fill="#000000" stroke="#000000" points="1479.5442,-1243.9708 1473.3379,-1235.384 1472.8348,-1245.9669 1479.5442,-1243.9708"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="1540" cy="-1217.4418" rx="27" ry="18"/>
<text text-anchor="middle" x="1540" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_5&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1574.8753,-1303.9657C1568.2889,-1287.6253 1558.4065,-1263.1075 1550.8413,-1244.3386"/>
<polygon fill="#000000" stroke="#000000" points="1554.0042,-1242.8233 1547.0195,-1234.8568 1547.5118,-1245.4402 1554.0042,-1242.8233"/>
</g>
<!-- raw_19 -->
<g id="node20" class="node">
<title>raw_19</title>
<ellipse fill="none" stroke="#000000" cx="1612" cy="-1217.4418" rx="27" ry="18"/>
<text text-anchor="middle" x="1612" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;raw_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1655.1789,-1303.9657C1646.9492,-1287.4747 1634.5632,-1262.6549 1625.1643,-1243.8211"/>
<polygon fill="#000000" stroke="#000000" points="1628.2878,-1242.2417 1620.6908,-1234.8568 1622.0244,-1245.3674 1628.2878,-1242.2417"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1939,-1267.8427 1657,-1267.8427 1657,-1167.0408 1939,-1167.0408 1939,-1267.8427"/>
<text text-anchor="middle" x="1798" y="-1252.4419" font-family="Inconsolata" font-size="14.00" fill="#000000">local Linebuf = require &quot;linebuf&quot;</text>
<text text-anchor="middle" x="1798" y="-1237.0418" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1798" y="-1221.6418" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1798" y="-1206.2418" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1798" y="-1190.8417" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1798" y="-1175.4417" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1793.0451,-1303.4916C1793.4643,-1296.2121 1793.9736,-1287.3665 1794.5043,-1278.1512"/>
<polygon fill="#000000" stroke="#000000" points="1798.0044,-1278.248 1795.0851,-1268.0633 1791.016,-1277.8455 1798.0044,-1278.248"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2148.5,-1235.4418 1957.5,-1235.4418 1957.5,-1199.4418 2148.5,-1199.4418 2148.5,-1235.4418"/>
<text text-anchor="middle" x="2053" y="-1213.9418" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_8&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2016.6642,-1303.4916C2023.4681,-1287.3788 2033.5121,-1263.5928 2041.3167,-1245.1099"/>
<polygon fill="#000000" stroke="#000000" points="2044.6102,-1246.3076 2045.276,-1235.7337 2038.1615,-1243.5845 2044.6102,-1246.3076"/>
</g>
<!-- header_23 -->
<g id="node24" class="node">
<title>header_23</title>
<ellipse fill="none" stroke="#000000" cx="2249" cy="-1217.4418" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2249" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:load()</text>
</g>
<!-- section_9&#45;&gt;header_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;header_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2303.5037,-1303.4916C2293.0933,-1287.0558 2277.626,-1262.6361 2265.825,-1244.0049"/>
<polygon fill="#000000" stroke="#000000" points="2268.6723,-1241.9592 2260.3646,-1235.384 2262.7587,-1245.7048 2268.6723,-1241.9592"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="2382" cy="-1217.4418" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2382" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2326.6705,-1303.4916C2337.3675,-1286.8554 2353.324,-1262.0393 2365.3567,-1243.3259"/>
<polygon fill="#000000" stroke="#000000" points="2368.4436,-1244.9963 2370.9081,-1234.6921 2362.5557,-1241.2104 2368.4436,-1244.9963"/>
</g>
<!-- codeblock_25 -->
<g id="node26" class="node">
<title>codeblock_25</title>
<ellipse fill="none" stroke="#000000" cx="2633" cy="-1217.4418" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2633" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 34&#45;79</text>
</g>
<!-- section_9&#45;&gt;codeblock_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;codeblock_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2357.2279,-1307.8049C2414.1594,-1289.15 2515.6057,-1255.9087 2578.3115,-1235.3617"/>
<polygon fill="#000000" stroke="#000000" points="2579.6171,-1238.6171 2588.03,-1232.1772 2577.4373,-1231.9651 2579.6171,-1238.6171"/>
</g>
<!-- header_36 -->
<g id="node37" class="node">
<title>header_36</title>
<ellipse fill="none" stroke="#000000" cx="3171" cy="-1217.4418" rx="107.339" ry="18"/>
<text text-anchor="middle" x="3171" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_36 -->
<g id="edge36" class="edge">
<title>section_10&#45;&gt;header_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3303.2629,-1304.6684C3276.8741,-1287.2651 3235.6436,-1260.0738 3206.235,-1240.6791"/>
<polygon fill="#000000" stroke="#000000" points="3207.7923,-1237.5135 3197.5173,-1234.9298 3203.9384,-1243.3571 3207.7923,-1237.5135"/>
</g>
<!-- prose_37 -->
<g id="node38" class="node">
<title>prose_37</title>
<ellipse fill="none" stroke="#000000" cx="3329" cy="-1217.4418" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3329" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_37 -->
<g id="edge37" class="edge">
<title>section_10&#45;&gt;prose_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3329,-1303.4916C3329,-1287.6016 3329,-1264.249 3329,-1245.8795"/>
<polygon fill="#000000" stroke="#000000" points="3332.5001,-1245.7336 3329,-1235.7337 3325.5001,-1245.7337 3332.5001,-1245.7336"/>
</g>
<!-- codeblock_38 -->
<g id="node39" class="node">
<title>codeblock_38</title>
<ellipse fill="none" stroke="#000000" cx="3538" cy="-1217.4418" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="3538" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 84&#45;126</text>
</g>
<!-- section_10&#45;&gt;codeblock_38 -->
<g id="edge38" class="edge">
<title>section_10&#45;&gt;codeblock_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3361.1982,-1305.5889C3397.2402,-1287.6197 3455.7889,-1258.4293 3495.5491,-1238.6063"/>
<polygon fill="#000000" stroke="#000000" points="3497.3404,-1241.6242 3504.7281,-1234.03 3494.217,-1235.3596 3497.3404,-1241.6242"/>
</g>
<!-- codeblock_39 -->
<g id="node40" class="node">
<title>codeblock_39</title>
<ellipse fill="none" stroke="#000000" cx="3922" cy="-1217.4418" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3922" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 129&#45;169</text>
</g>
<!-- section_10&#45;&gt;codeblock_39 -->
<g id="edge39" class="edge">
<title>section_10&#45;&gt;codeblock_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3387.2103,-1311.4133C3494.9264,-1292.4858 3725.2901,-1252.007 3845.4709,-1230.8892"/>
<polygon fill="#000000" stroke="#000000" points="3846.0969,-1234.3329 3855.3403,-1229.155 3844.8854,-1227.4385 3846.0969,-1234.3329"/>
</g>
<!-- header_45 -->
<g id="node46" class="node">
<title>header_45</title>
<ellipse fill="none" stroke="#000000" cx="4448" cy="-1217.4418" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="4448" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_11&#45;&gt;header_45 -->
<g id="edge45" class="edge">
<title>section_11&#45;&gt;header_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4661.151,-1305.9292C4616.9842,-1287.5938 4543.889,-1257.2491 4495.8318,-1237.2986"/>
<polygon fill="#000000" stroke="#000000" points="4497.1479,-1234.0554 4486.5701,-1233.4538 4494.4639,-1240.5205 4497.1479,-1234.0554"/>
</g>
<!-- prose_46 -->
<g id="node47" class="node">
<title>prose_46</title>
<ellipse fill="none" stroke="#000000" cx="4620" cy="-1217.4418" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4620" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_46 -->
<g id="edge46" class="edge">
<title>section_11&#45;&gt;prose_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4685.2393,-1303.4916C4672.4351,-1286.603 4653.2397,-1261.2845 4638.9818,-1242.4785"/>
<polygon fill="#000000" stroke="#000000" points="4641.6496,-1240.204 4632.819,-1234.3499 4636.0715,-1244.4331 4641.6496,-1240.204"/>
</g>
<!-- codeblock_47 -->
<g id="node48" class="node">
<title>codeblock_47</title>
<ellipse fill="none" stroke="#000000" cx="4768" cy="-1217.4418" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4768" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 174&#45;186</text>
</g>
<!-- section_11&#45;&gt;codeblock_47 -->
<g id="edge47" class="edge">
<title>section_11&#45;&gt;codeblock_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4711.0189,-1303.4916C4721.9519,-1286.9811 4738.22,-1262.414 4750.5782,-1243.7512"/>
<polygon fill="#000000" stroke="#000000" points="4753.5159,-1245.6542 4756.1188,-1235.384 4747.6795,-1241.7893 4753.5159,-1245.6542"/>
</g>
<!-- section_48 -->
<g id="node49" class="node">
<title>section_48</title>
<ellipse fill="none" stroke="#000000" cx="5137" cy="-1217.4418" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5137" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 189&#45;216</text>
</g>
<!-- section_11&#45;&gt;section_48 -->
<g id="edge48" class="edge">
<title>section_11&#45;&gt;section_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4752.7074,-1308.8649C4833.7895,-1289.5755 4987.1422,-1253.0929 5073.5935,-1232.5261"/>
<polygon fill="#000000" stroke="#000000" points="5074.6207,-1235.8795 5083.5391,-1230.1601 5073.0005,-1229.0696 5074.6207,-1235.8795"/>
</g>
<!-- section_49 -->
<g id="node50" class="node">
<title>section_49</title>
<ellipse fill="none" stroke="#000000" cx="6080" cy="-1217.4418" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="6080" y="-1213.2418" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 217&#45;241</text>
</g>
<!-- section_11&#45;&gt;section_49 -->
<g id="edge49" class="edge">
<title>section_11&#45;&gt;section_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4771.3042,-1316.1863C5006.5471,-1298.4366 5749.2449,-1242.3981 5997.9422,-1223.6332"/>
<polygon fill="#000000" stroke="#000000" points="5998.2884,-1227.1172 6007.9967,-1222.8746 5997.7616,-1220.137 5998.2884,-1227.1172"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-822.2422 0,-822.2422 0,-750.4399 324,-750.4399 324,-822.2422"/>
<text text-anchor="middle" x="162" y="-758.8411" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>raw_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1388.0869,-1199.7199C1381.9347,-1188.255 1372.2154,-1174.2119 1359,-1167.2417 1258.1038,-1114.0255 428.8633,-1193.0658 333,-1131.2417 227.5094,-1063.2086 184.7652,-909.3561 169.4795,-832.2284"/>
<polygon fill="#000000" stroke="#000000" points="172.9004,-831.4826 167.5835,-822.3185 166.0251,-832.7981 172.9004,-831.4826"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-813.6415 342.5,-813.6415 342.5,-759.0407 897.5,-759.0407 897.5,-813.6415"/>
<text text-anchor="middle" x="620" y="-782.5411" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-767.1411" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1460.3446,-1199.8705C1454.3783,-1188.4727 1444.927,-1174.4482 1432,-1167.2417 1329.8589,-1110.3004 1011.1215,-1184.4753 907,-1131.2417 771.2558,-1061.8405 675.3238,-896.9717 637.6687,-823.1685"/>
<polygon fill="#000000" stroke="#000000" points="640.5732,-821.1541 632.9509,-813.7953 634.3205,-824.3012 640.5732,-821.1541"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-813.6415 916,-813.6415 916,-759.0407 1464,-759.0407 1464,-813.6415"/>
<text text-anchor="middle" x="1190" y="-782.5411" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-767.1411" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1528.6862,-1200.8938C1521.7685,-1190.9739 1512.6198,-1178.1998 1504,-1167.2417 1490.9458,-1150.646 1486.5866,-1147.4043 1473,-1131.2417 1378.795,-1019.175 1269.4255,-884.5753 1218.6393,-821.8082"/>
<polygon fill="#000000" stroke="#000000" points="1221.1696,-819.371 1212.1596,-813.7968 1215.7269,-823.7731 1221.1696,-819.371"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-821.6414 1482,-821.6414 1482,-751.0407 2030,-751.0407 2030,-821.6414"/>
<text text-anchor="middle" x="1756" y="-790.5411" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new linebuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-775.1411" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>raw_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1617.9134,-1199.7384C1638.8195,-1137.1508 1709.6625,-925.0642 1740.943,-831.4181"/>
<polygon fill="#000000" stroke="#000000" points="1744.2628,-832.5266 1744.1113,-821.9328 1737.6234,-830.3088 1744.2628,-832.5266"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2197.5,-804.3411 2048.5,-804.3411 2048.5,-768.3411 2197.5,-768.3411 2197.5,-804.3411"/>
<text text-anchor="middle" x="2123" y="-782.8411" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:load()</text>
</g>
<!-- header_23&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>header_23&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2238.8139,-1199.4412C2229.4796,-1182.3364 2215.8107,-1155.671 2207,-1131.2417 2165.8609,-1017.1764 2138.3396,-874.7127 2127.8045,-814.8813"/>
<polygon fill="#000000" stroke="#000000" points="2131.1952,-813.9501 2126.0355,-804.6965 2124.2985,-815.148 2131.1952,-813.9501"/>
</g>
<!-- raw_27 -->
<g id="node28" class="node">
<title>raw_27</title>
<ellipse fill="none" stroke="#000000" cx="2243" cy="-786.3411" rx="27" ry="18"/>
<text text-anchor="middle" x="2243" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_27 -->
<g id="edge27" class="edge">
<title>prose_24&#45;&gt;raw_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2370.0342,-1200.3485C2362.2462,-1189.9896 2351.4372,-1176.9462 2340,-1167.2417 2315.9963,-1146.8742 2296.0096,-1157.731 2279,-1131.2417 2213.9625,-1029.9573 2228.5543,-876.5064 2238.0653,-814.1501"/>
<polygon fill="#000000" stroke="#000000" points="2241.522,-814.6982 2239.6486,-804.2703 2234.6102,-813.5905 2241.522,-814.6982"/>
</g>
<!-- prespace_28 -->
<g id="node29" class="node">
<title>prespace_28</title>
<ellipse fill="none" stroke="#000000" cx="2334" cy="-786.3411" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2334" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_24&#45;&gt;prespace_28 -->
<g id="edge28" class="edge">
<title>prose_24&#45;&gt;prespace_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2379.9986,-1199.4668C2372.5272,-1132.3639 2346.231,-896.1911 2337.1287,-814.4409"/>
<polygon fill="#000000" stroke="#000000" points="2340.5951,-813.9441 2336.0099,-804.3928 2333.6381,-814.7187 2340.5951,-813.9441"/>
</g>
<!-- literal_29 -->
<g id="node30" class="node">
<title>literal_29</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-786.3411" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2430" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_24&#45;&gt;literal_29 -->
<g id="edge29" class="edge">
<title>prose_24&#45;&gt;literal_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2384.0014,-1199.4668C2391.4728,-1132.3639 2417.769,-896.1911 2426.8713,-814.4409"/>
<polygon fill="#000000" stroke="#000000" points="2430.3619,-814.7187 2427.9901,-804.3928 2423.4049,-813.9441 2430.3619,-814.7187"/>
</g>
<!-- raw_30 -->
<g id="node31" class="node">
<title>raw_30</title>
<ellipse fill="none" stroke="#000000" cx="2506" cy="-786.3411" rx="27" ry="18"/>
<text text-anchor="middle" x="2506" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_30 -->
<g id="edge30" class="edge">
<title>prose_24&#45;&gt;raw_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2403.1758,-1203.4496C2424.0816,-1188.3481 2455.0275,-1162.2477 2470,-1131.2417 2521.9862,-1023.5852 2514.983,-875.4192 2509.2256,-814.3663"/>
<polygon fill="#000000" stroke="#000000" points="2512.7002,-813.9375 2508.215,-804.3389 2505.7355,-814.6395 2512.7002,-813.9375"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3057,-1131.1423 2551,-1131.1423 2551,-441.5399 3057,-441.5399 3057,-1131.1423"/>
<text text-anchor="middle" x="2804" y="-1116.0417" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2804" y="-1084.6416" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2804" y="-1069.2416" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2804" y="-1053.8416" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2804" y="-1038.4415" font-family="Inconsolata" font-size="14.00" fill="#000000">project TEXT,</text>
<text text-anchor="middle" x="2804" y="-1023.0415" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2804" y="-1007.6415" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP);</text>
<text text-anchor="middle" x="2804" y="-992.2414" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-960.8414" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2804" y="-945.4414" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS results (</text>
<text text-anchor="middle" x="2804" y="-930.0414" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2804" y="-914.6413" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2804" y="-899.2413" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY(line_id) REFERENCES repl(line_id),</text>
<text text-anchor="middle" x="2804" y="-883.8413" font-family="Inconsolata" font-size="14.00" fill="#000000">result text).</text>
<text text-anchor="middle" x="2804" y="-868.4412" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-837.0412" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line_stmt = [[</text>
<text text-anchor="middle" x="2804" y="-821.6412" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES(:project, :line);</text>
<text text-anchor="middle" x="2804" y="-806.2411" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-774.8411" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2804" y="-759.4411" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2804" y="-744.041" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-712.641" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2804" y="-697.241" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT line FROM repl</text>
<text text-anchor="middle" x="2804" y="-681.8409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %s</text>
<text text-anchor="middle" x="2804" y="-666.4409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2804" y="-651.0409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2804" y="-635.6409" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-604.2408" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-588.8408" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-557.4408" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2804" y="-542.0407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2804" y="-526.6407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2804" y="-511.2407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2804" y="-495.8406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-480.4406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-465.0406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2804" y="-449.6405" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_25&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>codeblock_25&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2640.1299,-1199.4668C2645.4826,-1185.9724 2653.5473,-1165.6407 2663.2806,-1141.1026"/>
<polygon fill="#000000" stroke="#000000" points="2666.6568,-1142.0836 2667.0905,-1131.4976 2660.1499,-1139.5025 2666.6568,-1142.0836"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2292,-276.3218 1926,-276.3218 1926,-220.5188 2292,-220.5188 2292,-276.3218"/>
<text text-anchor="middle" x="2109" y="-228.9203" font-family="Inconsolata" font-size="14.00" fill="#000000">This is where we either create query or create our</text>
</g>
<!-- raw_27&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>raw_27&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2243.3075,-768.3164C2243.7217,-716.3928 2241.6263,-562.4714 2206,-441.4405 2188.9895,-383.6521 2155.1387,-322.3936 2132.2764,-284.7693"/>
<polygon fill="#000000" stroke="#000000" points="2135.2219,-282.8773 2127.0041,-276.19 2129.258,-286.5424 2135.2219,-282.8773"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="2364,-266.4203 2310,-266.4203 2310,-230.4203 2364,-230.4203 2364,-266.4203"/>
<text text-anchor="middle" x="2337" y="-244.9203" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_28&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>prespace_28&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2334.1015,-768.1353C2334.5435,-688.8791 2336.302,-373.5767 2336.8417,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="2340.3426,-276.641 2336.8985,-266.6216 2333.3427,-276.6018 2340.3426,-276.641"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2466.5,-266.4203 2387.5,-266.4203 2387.5,-230.4203 2466.5,-230.4203 2466.5,-266.4203"/>
<text text-anchor="middle" x="2427" y="-244.9203" font-family="Inconsolata" font-size="14.00" fill="#000000">~/.bridge</text>
</g>
<!-- literal_29&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>literal_29&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2429.8985,-768.1353C2429.4565,-688.8791 2427.698,-373.5767 2427.1583,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="2430.6573,-276.6018 2427.1015,-266.6216 2423.6574,-276.641 2430.6573,-276.6018"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2571,-266.4203 2485,-266.4203 2485,-230.4203 2571,-230.4203 2571,-266.4203"/>
<text text-anchor="middle" x="2528" y="-244.9203" font-family="Inconsolata" font-size="14.00" fill="#000000"> database.</text>
</g>
<!-- raw_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>raw_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2506.7446,-768.1353C2509.986,-688.8791 2522.8813,-373.5767 2526.8389,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="2530.3439,-276.7563 2527.2556,-266.6216 2523.3498,-276.4701 2530.3439,-276.7563"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="3266.5,-804.3411 3075.5,-804.3411 3075.5,-768.3411 3266.5,-768.3411 3266.5,-804.3411"/>
<text text-anchor="middle" x="3171" y="-782.8411" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_36&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>header_36&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3171,-1199.1933C3171,-1131.7084 3171,-895.967 3171,-814.382"/>
<polygon fill="#000000" stroke="#000000" points="3174.5001,-814.3544 3171,-804.3544 3167.5001,-814.3545 3174.5001,-814.3544"/>
</g>
<!-- raw_41 -->
<g id="node42" class="node">
<title>raw_41</title>
<ellipse fill="none" stroke="#000000" cx="3312" cy="-786.3411" rx="27" ry="18"/>
<text text-anchor="middle" x="3312" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_37&#45;&gt;raw_41 -->
<g id="edge41" class="edge">
<title>prose_37&#45;&gt;raw_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3328.2804,-1199.1933C3325.6192,-1131.7084 3316.323,-895.967 3313.1058,-814.382"/>
<polygon fill="#000000" stroke="#000000" points="3316.6017,-814.2087 3312.7103,-804.3544 3309.6072,-814.4846 3316.6017,-814.2087"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="3870.5,-1107.0423 3357.5,-1107.0423 3357.5,-465.6399 3870.5,-465.6399 3870.5,-1107.0423"/>
<text text-anchor="middle" x="3614" y="-1091.7417" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="3614" y="-1060.3416" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; second_best is broke and I don&#39;t know why</text>
<text text-anchor="middle" x="3614" y="-1044.9416" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; also this fails on a single key search &gt;.&lt;</text>
<text text-anchor="middle" x="3614" y="-1029.5416" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="3614" y="-1014.1416" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="3614" y="-998.7415" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;&#160;&#160;&#160;&#160;&#160;&#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="3614" y="-983.3415" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="3614" y="-967.9415" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="3614" y="-952.5414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="3614" y="-937.1414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3614" y="-921.7414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="3614" y="-906.3413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="3614" y="-890.9413" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3614" y="-859.5413" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="3614" y="-844.1412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = {}</text>
<text text-anchor="middle" x="3614" y="-828.7412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="3614" y="-813.3412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="3614" y="-797.9411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="3614" y="-782.5411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="3614" y="-767.1411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="3614" y="-751.7411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="3614" y="-736.341" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3614" y="-720.941" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3614" y="-705.541" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local slip = &quot;&quot;</text>
<text text-anchor="middle" x="3614" y="-690.1409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="3614" y="-674.7409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="3614" y="-659.3409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="3614" y="-643.9408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="3614" y="-628.5408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local second = fuzz_patt(slip)</text>
<text text-anchor="middle" x="3614" y="-613.1408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="3614" y="-597.7407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(second, tostring(historian[i]))</text>
<text text-anchor="middle" x="3614" y="-582.3407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="3614" y="-566.9407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="3614" y="-551.5406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3614" y="-536.1406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3614" y="-520.7406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3614" y="-489.3406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best, slip</text>
<text text-anchor="middle" x="3614" y="-473.9405" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_38&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>codeblock_38&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3541.2171,-1199.1933C3544.3419,-1181.4682 3549.513,-1152.1356 3555.7005,-1117.0376"/>
<polygon fill="#000000" stroke="#000000" points="3559.1825,-1117.4459 3557.4718,-1106.9901 3552.2888,-1116.2305 3559.1825,-1117.4459"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="4345.5,-1091.1423 3888.5,-1091.1423 3888.5,-481.5399 4345.5,-481.5399 4345.5,-1091.1423"/>
<text text-anchor="middle" x="4117" y="-1076.0417" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert(table.reverse)</text>
<text text-anchor="middle" x="4117" y="-1044.6416" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="4117" y="-1029.2416" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.home_dir .. &quot;/.bridge&quot;)</text>
<text text-anchor="middle" x="4117" y="-1013.8416" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="4117" y="-998.4415" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec &quot;PRAGMA foreign_keys = ON;&quot;</text>
<text text-anchor="middle" x="4117" y="-983.0415" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_names = conn:exec(get_tables)</text>
<text text-anchor="middle" x="4117" y="-967.6415" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not table_names or not has(table_names.name, &quot;repl&quot;) then</text>
<text text-anchor="middle" x="4117" y="-952.2414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, err = sql.pexec(conn, create_repl_table)</text>
<text text-anchor="middle" x="4117" y="-936.8414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; success is nil for creation, false for error</text>
<text text-anchor="middle" x="4117" y="-921.4414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success == false then</text>
<text text-anchor="middle" x="4117" y="-906.0414" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="4117" y="-890.6413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4117" y="-875.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4117" y="-859.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt = conn:prepare(insert_line_stmt)</text>
<text text-anchor="middle" x="4117" y="-844.4412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_stmt = sql.format(get_recent, historian.project,</text>
<text text-anchor="middle" x="4117" y="-829.0412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="4117" y="-813.6412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local values, err = sql.pexec(conn, pop_stmt)</text>
<text text-anchor="middle" x="4117" y="-798.2411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if values then</text>
<text text-anchor="middle" x="4117" y="-782.8411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(reverse(values[1])) do</text>
<text text-anchor="middle" x="4117" y="-767.4411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = Linebuf(v)</text>
<text text-anchor="middle" x="4117" y="-752.041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4117" y="-736.641" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="4117" y="-721.241" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="4117" y="-705.8409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4117" y="-690.4409" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4117" y="-659.0409" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, linebuf)</text>
<text text-anchor="middle" x="4117" y="-643.6409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="4117" y="-628.2408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt:bindkv { project = historian.project,</text>
<text text-anchor="middle" x="4117" y="-612.8408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="4117" y="-597.4408" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local err = historian.insert_stmt:step()</text>
<text text-anchor="middle" x="4117" y="-582.0407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not err then</text>
<text text-anchor="middle" x="4117" y="-566.6407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="4117" y="-551.2407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4117" y="-535.8406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;error(error)</text>
<text text-anchor="middle" x="4117" y="-520.4406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4117" y="-505.0406" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="4117" y="-489.6405" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_39&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_39&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3930.1306,-1199.4668C3939.3667,-1179.0479 3955.684,-1142.9741 3974.9596,-1100.3601"/>
<polygon fill="#000000" stroke="#000000" points="3978.1838,-1101.7244 3979.1163,-1091.1707 3971.806,-1098.8395 3978.1838,-1101.7244"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="3339,-266.4203 3285,-266.4203 3285,-230.4203 3339,-230.4203 3339,-266.4203"/>
</g>
<!-- raw_41&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>raw_41&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3312,-768.1353C3312,-688.8791 3312,-373.5767 3312,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="3315.5001,-276.6215 3312,-266.6216 3308.5001,-276.6216 3315.5001,-276.6215"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="4512.5,-804.3411 4363.5,-804.3411 4363.5,-768.3411 4512.5,-768.3411 4512.5,-804.3411"/>
<text text-anchor="middle" x="4438" y="-782.8411" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_45&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>header_45&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4447.5767,-1199.1933C4446.0113,-1131.7084 4440.5429,-895.967 4438.6504,-814.382"/>
<polygon fill="#000000" stroke="#000000" points="4442.1489,-814.2706 4438.4178,-804.3544 4435.1508,-814.433 4442.1489,-814.2706"/>
</g>
<!-- raw_51 -->
<g id="node52" class="node">
<title>raw_51</title>
<ellipse fill="none" stroke="#000000" cx="4558" cy="-786.3411" rx="27" ry="18"/>
<text text-anchor="middle" x="4558" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_46&#45;&gt;raw_51 -->
<g id="edge51" class="edge">
<title>prose_46&#45;&gt;raw_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4613.5133,-1199.5327C4607.5215,-1182.271 4598.8388,-1155.3009 4594,-1131.2417 4570.6442,-1015.1136 4561.9243,-873.7579 4559.1392,-814.5498"/>
<polygon fill="#000000" stroke="#000000" points="4562.6319,-814.3076 4558.686,-804.475 4555.639,-814.6222 4562.6319,-814.3076"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="4970.9016,-880.322 4603.0984,-880.322 4603.0984,-692.3602 4970.9016,-692.3602 4970.9016,-880.322"/>
<text text-anchor="middle" x="4787" y="-864.8812" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="4787" y="-849.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="4787" y="-834.0812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="4787" y="-818.6811" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4787" y="-803.2811" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="4787" y="-784.5211" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf = historian[historian.cursor &#45; ]</text>
<text text-anchor="middle" x="4787" y="-765.7611" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[linebuf]</text>
<text text-anchor="middle" x="4787" y="-750.3611" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; </text>
<text text-anchor="middle" x="4787" y="-731.6011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="4787" y="-716.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return linebuf:clone(), result</text>
<text text-anchor="middle" x="4787" y="-700.801" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_47&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>codeblock_47&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4768.8043,-1199.1933C4771.0976,-1147.1585 4777.7998,-995.0899 4782.3967,-890.7876"/>
<polygon fill="#000000" stroke="#000000" points="4785.9049,-890.6767 4782.8487,-880.5322 4778.9117,-890.3684 4785.9049,-890.6767"/>
</g>
<!-- header_54 -->
<g id="node55" class="node">
<title>header_54</title>
<ellipse fill="none" stroke="#000000" cx="5071" cy="-786.3411" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="5071" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_48&#45;&gt;header_54 -->
<g id="edge54" class="edge">
<title>section_48&#45;&gt;header_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5134.2062,-1199.1933C5123.8745,-1131.7084 5087.7833,-895.967 5075.293,-814.382"/>
<polygon fill="#000000" stroke="#000000" points="5078.7309,-813.7096 5073.7578,-804.3544 5071.8115,-814.769 5078.7309,-813.7096"/>
</g>
<!-- prose_55 -->
<g id="node56" class="node">
<title>prose_55</title>
<ellipse fill="none" stroke="#000000" cx="5204" cy="-786.3411" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5204" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_48&#45;&gt;prose_55 -->
<g id="edge55" class="edge">
<title>section_48&#45;&gt;prose_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5143.1255,-1199.4916C5148.8061,-1182.2002 5157.0984,-1155.2093 5162,-1131.2417 5185.7798,-1014.9646 5197.8161,-873.689 5202.1136,-814.5259"/>
<polygon fill="#000000" stroke="#000000" points="5205.6113,-814.6814 5202.8271,-804.459 5198.6288,-814.1865 5205.6113,-814.6814"/>
</g>
<!-- codeblock_56 -->
<g id="node57" class="node">
<title>codeblock_56</title>
<ellipse fill="none" stroke="#000000" cx="5431" cy="-786.3411" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5431" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 194&#45;214</text>
</g>
<!-- section_48&#45;&gt;codeblock_56 -->
<g id="edge56" class="edge">
<title>section_48&#45;&gt;codeblock_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5163.9537,-1200.4889C5187.4888,-1184.7002 5221.4699,-1159.4121 5245,-1131.2417 5332.1688,-1026.8822 5396.6041,-875.2375 5420.6684,-813.7589"/>
<polygon fill="#000000" stroke="#000000" points="5423.9632,-814.9426 5424.309,-804.3534 5417.4352,-812.4157 5423.9632,-814.9426"/>
</g>
<!-- header_67 -->
<g id="node68" class="node">
<title>header_67</title>
<ellipse fill="none" stroke="#000000" cx="5830" cy="-786.3411" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="5830" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_49&#45;&gt;header_67 -->
<g id="edge67" class="edge">
<title>section_49&#45;&gt;header_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6048.504,-1200.9676C6022.4255,-1185.9118 5986.0382,-1161.4254 5963,-1131.2417 5885.3348,-1029.4878 5847.9546,-876.9185 5835.2317,-814.4901"/>
<polygon fill="#000000" stroke="#000000" points="5838.6464,-813.716 5833.2681,-804.5878 5831.7801,-815.0776 5838.6464,-813.716"/>
</g>
<!-- prose_68 -->
<g id="node69" class="node">
<title>prose_68</title>
<ellipse fill="none" stroke="#000000" cx="6004" cy="-786.3411" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6004" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_49&#45;&gt;prose_68 -->
<g id="edge68" class="edge">
<title>section_49&#45;&gt;prose_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6073.7286,-1199.4871C6067.8926,-1182.1925 6059.3186,-1155.1994 6054,-1131.2417 6028.2003,-1015.026 6012.5233,-873.7174 6006.649,-814.5358"/>
<polygon fill="#000000" stroke="#000000" points="6010.121,-814.0782 6005.6659,-804.4655 6003.1541,-814.7583 6010.121,-814.0782"/>
</g>
<!-- codeblock_69 -->
<g id="node70" class="node">
<title>codeblock_69</title>
<ellipse fill="none" stroke="#000000" cx="6150" cy="-786.3411" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6150" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 219&#45;226</text>
</g>
<!-- section_49&#45;&gt;codeblock_69 -->
<g id="edge69" class="edge">
<title>section_49&#45;&gt;codeblock_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6082.9631,-1199.1933C6093.921,-1131.7084 6132.1995,-895.967 6145.4469,-814.382"/>
<polygon fill="#000000" stroke="#000000" points="6148.927,-814.7862 6147.0751,-804.3544 6142.0175,-813.6642 6148.927,-814.7862"/>
</g>
<!-- codeblock_70 -->
<g id="node71" class="node">
<title>codeblock_70</title>
<ellipse fill="none" stroke="#000000" cx="6456" cy="-786.3411" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6456" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 228&#45;237</text>
</g>
<!-- section_49&#45;&gt;codeblock_70 -->
<g id="edge70" class="edge">
<title>section_49&#45;&gt;codeblock_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6123.1452,-1202.5879C6159.1931,-1188.5329 6210.2878,-1164.6056 6246,-1131.2417 6349.0865,-1034.9338 6419.8671,-876.9186 6445.4332,-813.7184"/>
<polygon fill="#000000" stroke="#000000" points="6448.6908,-814.9982 6449.1462,-804.4132 6442.1893,-812.4039 6448.6908,-814.9982"/>
</g>
<!-- codeblock_71 -->
<g id="node72" class="node">
<title>codeblock_71</title>
<ellipse fill="none" stroke="#000000" cx="6811" cy="-786.3411" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6811" y="-782.1411" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 239&#45;241</text>
</g>
<!-- section_49&#45;&gt;codeblock_71 -->
<g id="edge71" class="edge">
<title>section_49&#45;&gt;codeblock_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6150.4054,-1210.9094C6265.0269,-1199.2402 6485.8391,-1172.1396 6552,-1131.2417 6681.6515,-1051.0964 6768.8699,-880.3497 6799.1663,-813.7487"/>
<polygon fill="#000000" stroke="#000000" points="6802.4862,-814.8986 6803.3801,-804.3416 6796.0979,-812.037 6802.4862,-814.8986"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="4585,-266.4203 4531,-266.4203 4531,-230.4203 4585,-230.4203 4585,-266.4203"/>
</g>
<!-- raw_51&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>raw_51&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4558,-768.1353C4558,-688.8791 4558,-373.5767 4558,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="4561.5001,-276.6215 4558,-266.6216 4554.5001,-276.6216 4561.5001,-276.6215"/>
</g>
<!-- leaf_57 -->
<g id="node58" class="node">
<title>leaf_57</title>
<polygon fill="none" stroke="#c0c0c0" points="4972,-266.4203 4816,-266.4203 4816,-230.4203 4972,-230.4203 4972,-266.4203"/>
<text text-anchor="middle" x="4894" y="-244.9203" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_54&#45;&gt;leaf_57 -->
<g id="edge57" class="edge">
<title>header_54&#45;&gt;leaf_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5067.2712,-768.0784C5056.4374,-716.1503 5022.9866,-563.5224 4980,-441.4405 4958.6369,-380.7692 4926.1961,-312.6633 4907.8725,-275.766"/>
<polygon fill="#000000" stroke="#000000" points="4910.9178,-274.03 4903.3164,-266.6496 4904.6562,-277.1594 4910.9178,-274.03"/>
</g>
<!-- raw_58 -->
<g id="node59" class="node">
<title>raw_58</title>
<ellipse fill="none" stroke="#000000" cx="5017" cy="-248.4203" rx="27" ry="18"/>
<text text-anchor="middle" x="5017" y="-244.2203" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_55&#45;&gt;raw_58 -->
<g id="edge58" class="edge">
<title>prose_55&#45;&gt;raw_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5207.8115,-768.438C5218.5498,-712.7813 5243.245,-540.5862 5162,-441.4405 5129.6633,-401.9791 5087.3478,-443.1644 5053,-405.4405 5020.7183,-369.9858 5015.5289,-311.5947 5015.6226,-276.8903"/>
<polygon fill="#000000" stroke="#000000" points="5019.1288,-276.576 5015.811,-266.5141 5012.1299,-276.4489 5019.1288,-276.576"/>
</g>
<!-- prespace_59 -->
<g id="node60" class="node">
<title>prespace_59</title>
<ellipse fill="none" stroke="#000000" cx="5108" cy="-248.4203" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5108" y="-244.2203" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_55&#45;&gt;prespace_59 -->
<g id="edge59" class="edge">
<title>prose_55&#45;&gt;prespace_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5202.7678,-768.2352C5199.0536,-716.7197 5186.6735,-565.0732 5162,-441.4405 5150.0481,-381.5525 5129.1047,-313.062 5117.1152,-275.9096"/>
<polygon fill="#000000" stroke="#000000" points="5120.409,-274.7207 5113.9858,-266.295 5113.7527,-276.8872 5120.409,-274.7207"/>
</g>
<!-- literal_60 -->
<g id="node61" class="node">
<title>literal_60</title>
<ellipse fill="none" stroke="#000000" cx="5204" cy="-248.4203" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5204" y="-244.2203" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_55&#45;&gt;literal_60 -->
<g id="edge60" class="edge">
<title>prose_55&#45;&gt;literal_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5204,-768.1353C5204,-688.8791 5204,-373.5767 5204,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="5207.5001,-276.6215 5204,-266.6216 5200.5001,-276.6216 5207.5001,-276.6215"/>
</g>
<!-- raw_61 -->
<g id="node62" class="node">
<title>raw_61</title>
<ellipse fill="none" stroke="#000000" cx="5280" cy="-248.4203" rx="27" ry="18"/>
<text text-anchor="middle" x="5280" y="-244.2203" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_55&#45;&gt;raw_61 -->
<g id="edge61" class="edge">
<title>prose_55&#45;&gt;raw_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5206.5722,-768.1353C5217.7824,-688.7907 5262.4167,-372.8734 5276.0346,-276.487"/>
<polygon fill="#000000" stroke="#000000" points="5279.5337,-276.7386 5277.4672,-266.3473 5272.6026,-275.7593 5279.5337,-276.7386"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="5713.4016,-405.4608 5324.5984,-405.4608 5324.5984,-91.3798 5713.4016,-91.3798 5713.4016,-405.4608"/>
<text text-anchor="middle" x="5519" y="-390.2405" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="5519" y="-374.8405" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="5519" y="-356.0805" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="5519" y="-340.6804" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="5519" y="-325.2804" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5519" y="-309.8804" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf= historian[historian.cursor + ]</text>
<text text-anchor="middle" x="5519" y="-291.1204" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[linebuf]</text>
<text text-anchor="middle" x="5519" y="-275.7203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not linebuf then</text>
<text text-anchor="middle" x="5519" y="-260.3203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="5519" y="-244.9203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5519" y="-229.5203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + </text>
<text text-anchor="middle" x="5519" y="-210.7603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="5519" y="-195.3602" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not ( &gt; 0) and #linebuf.line &gt; 0 then</text>
<text text-anchor="middle" x="5519" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="5519" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf:clone(), nil, true</text>
<text text-anchor="middle" x="5519" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="5519" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf:clone(), result, false</text>
<text text-anchor="middle" x="5519" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5519" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_56&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>codeblock_56&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5433.9783,-768.1353C5442.9395,-713.358 5470.3464,-545.8268 5491.6475,-415.6186"/>
<polygon fill="#000000" stroke="#000000" points="5495.139,-415.9546 5493.2995,-405.5207 5488.2309,-414.8244 5495.139,-415.9546"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="5064,-55.6015 4586,-55.6015 4586,.2015 5064,.2015 5064,-55.6015"/>
<text text-anchor="middle" x="4825" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next linebuf in history, and a second flag to tell the</text>
</g>
<!-- raw_58&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>raw_58&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5017.9209,-230.315C5018.5537,-198.4228 5015.3148,-131.7903 4981,-91.4 4970.2554,-78.7531 4956.6128,-68.5832 4941.884,-60.4136"/>
<polygon fill="#000000" stroke="#000000" points="4943.0761,-57.0887 4932.5891,-55.5811 4939.8471,-63.2995 4943.0761,-57.0887"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="5136,-45.7 5082,-45.7 5082,-9.7 5136,-9.7 5136,-45.7"/>
</g>
<!-- prespace_59&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>prespace_59&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5108.0818,-230.3578C5108.2559,-191.9453 5108.6638,-101.9051 5108.8723,-55.8751"/>
<polygon fill="#000000" stroke="#000000" points="5112.373,-55.7183 5108.9184,-45.7025 5105.3731,-55.6865 5112.373,-55.7183"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="5254,-45.7 5154,-45.7 5154,-9.7 5254,-9.7 5254,-45.7"/>
<text text-anchor="middle" x="5204" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_60&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>literal_60&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5204,-230.3578C5204,-191.9453 5204,-101.9051 5204,-55.8751"/>
<polygon fill="#000000" stroke="#000000" points="5207.5001,-55.7025 5204,-45.7025 5200.5001,-55.7025 5207.5001,-55.7025"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="5512,-45.7 5272,-45.7 5272,-9.7 5512,-9.7 5512,-45.7"/>
<text text-anchor="middle" x="5392" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_61&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>raw_61&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5280.4852,-230.0697C5282.0719,-199.229 5288.695,-136.006 5316,-91.4 5325.4532,-75.9571 5339.9663,-62.4517 5353.7864,-51.8983"/>
<polygon fill="#000000" stroke="#000000" points="5356.2383,-54.4417 5362.2504,-45.7178 5352.1102,-48.7884 5356.2383,-54.4417"/>
</g>
<!-- leaf_72 -->
<g id="node73" class="node">
<title>leaf_72</title>
<polygon fill="none" stroke="#c0c0c0" points="5901,-266.4203 5731,-266.4203 5731,-230.4203 5901,-230.4203 5901,-266.4203"/>
<text text-anchor="middle" x="5816" y="-244.9203" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_67&#45;&gt;leaf_72 -->
<g id="edge72" class="edge">
<title>header_67&#45;&gt;leaf_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5829.5262,-768.1353C5827.4634,-688.8791 5819.2573,-373.5767 5816.7389,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="5820.2328,-276.5271 5816.4737,-266.6216 5813.2352,-276.7093 5820.2328,-276.5271"/>
</g>
<!-- raw_73 -->
<g id="node74" class="node">
<title>raw_73</title>
<ellipse fill="none" stroke="#000000" cx="5946" cy="-248.4203" rx="27" ry="18"/>
<text text-anchor="middle" x="5946" y="-244.2203" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_68&#45;&gt;raw_73 -->
<g id="edge73" class="edge">
<title>prose_68&#45;&gt;raw_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6002.037,-768.1353C5993.4914,-688.8791 5959.4947,-373.5767 5949.061,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="5952.5144,-276.1887 5947.9625,-266.6216 5945.5548,-276.9392 5952.5144,-276.1887"/>
</g>
<!-- leaf_75 -->
<g id="node76" class="node">
<title>leaf_75</title>
<polygon fill="none" stroke="#c0c0c0" points="6322.5,-298.8213 5991.5,-298.8213 5991.5,-198.0193 6322.5,-198.0193 6322.5,-298.8213"/>
<text text-anchor="middle" x="6157" y="-283.4204" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, linebuf)</text>
<text text-anchor="middle" x="6157" y="-268.0203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = linebuf</text>
<text text-anchor="middle" x="6157" y="-252.6203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="6157" y="-237.2203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:persist(linebuf)</text>
<text text-anchor="middle" x="6157" y="-221.8202" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6157" y="-206.4202" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_69&#45;&gt;leaf_75 -->
<g id="edge75" class="edge">
<title>codeblock_69&#45;&gt;leaf_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6150.2369,-768.1353C6151.1721,-696.2695 6154.6328,-430.3266 6156.2089,-309.2116"/>
<polygon fill="#000000" stroke="#000000" points="6159.7113,-309.0439 6156.3418,-298.9991 6152.7119,-308.9527 6159.7113,-309.0439"/>
</g>
<!-- leaf_76 -->
<g id="node77" class="node">
<title>leaf_76</title>
<polygon fill="none" stroke="#c0c0c0" points="6797.5,-314.1207 6340.5,-314.1207 6340.5,-182.7199 6797.5,-182.7199 6797.5,-314.1207"/>
<text text-anchor="middle" x="6569" y="-298.8204" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="6569" y="-283.4204" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="6569" y="-268.0203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="6569" y="-252.6203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This will also be load()ed once we have the tables for it</text>
<text text-anchor="middle" x="6569" y="-237.2203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.results = {} &#45;&#45; keyed by linebuf</text>
<text text-anchor="middle" x="6569" y="-221.8202" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="6569" y="-206.4202" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6569" y="-191.0202" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_70&#45;&gt;leaf_76 -->
<g id="edge76" class="edge">
<title>codeblock_70&#45;&gt;leaf_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6459.8245,-768.1353C6474.3134,-699.1627 6526.3552,-451.4249 6553.0136,-324.5214"/>
<polygon fill="#000000" stroke="#000000" points="6556.4917,-324.989 6555.1223,-314.4831 6549.6412,-323.5499 6556.4917,-324.989"/>
</g>
<!-- leaf_77 -->
<g id="node78" class="node">
<title>leaf_77</title>
<polygon fill="none" stroke="#c0c0c0" points="6902,-266.4203 6816,-266.4203 6816,-230.4203 6902,-230.4203 6902,-266.4203"/>
<text text-anchor="middle" x="6859" y="-244.9203" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_71&#45;&gt;leaf_77 -->
<g id="edge77" class="edge">
<title>codeblock_71&#45;&gt;leaf_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6812.6246,-768.1353C6819.6968,-688.8791 6847.832,-373.5767 6856.4667,-276.8098"/>
<polygon fill="#000000" stroke="#000000" points="6859.9731,-276.8931 6857.3759,-266.6216 6853.0008,-276.2709 6859.9731,-276.8931"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="5973,-45.7 5919,-45.7 5919,-9.7 5973,-9.7 5973,-45.7"/>
</g>
<!-- raw_73&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>raw_73&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5946,-230.3578C5946,-191.9453 5946,-101.9051 5946,-55.8751"/>
<polygon fill="#000000" stroke="#000000" points="5949.5001,-55.7025 5946,-45.7025 5942.5001,-55.7025 5949.5001,-55.7025"/>
</g>
</g>
</svg>
