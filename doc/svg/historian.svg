<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="15402pt" height="2701pt"
 viewBox="0.00 0.00 15402.30 2700.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2696.8041)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2696.8041 15398.2972,-2696.8041 15398.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2674.8041" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1916" y="-2670.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 518</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2602.8041" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1916" y="-2598.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;432</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2656.6355C1916,-2648.9351 1916,-2639.7785 1916,-2631.2208"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2631.2174 1916,-2621.2174 1912.5001,-2631.2174 1919.5001,-2631.2174"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-2530.8041" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1423" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.742,-2597.0377C1771.438,-2588.9045 1622.1023,-2572.3783 1496,-2548.8041 1489.769,-2547.6393 1483.2751,-2546.2686 1476.8422,-2544.8122"/>
<polygon fill="#000000" stroke="#000000" points="1477.3647,-2541.34 1466.8303,-2542.4701 1475.7702,-2548.156 1477.3647,-2541.34"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1537" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1537" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.6473,-2597.0588C1785.6726,-2589.805 1674.1491,-2574.9924 1581,-2548.8041 1577.9982,-2547.9602 1574.924,-2546.9733 1571.8643,-2545.904"/>
<polygon fill="#000000" stroke="#000000" points="1572.8384,-2542.5309 1562.2464,-2542.2823 1570.3715,-2549.0819 1572.8384,-2542.5309"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1622" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1622" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1858.8831,-2593.8224C1807.2649,-2584.9411 1729.5556,-2569.6584 1664,-2548.8041 1661.5525,-2548.0255 1659.0524,-2547.156 1656.552,-2546.231"/>
<polygon fill="#000000" stroke="#000000" points="1657.6046,-2542.8836 1647.0181,-2542.4631 1655.0318,-2549.3937 1657.6046,-2542.8836"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1705" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1705" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1870.7661,-2589.6355C1836.4995,-2579.3506 1788.4123,-2564.254 1747,-2548.8041 1744.7423,-2547.9618 1742.4291,-2547.066 1740.1053,-2546.1412"/>
<polygon fill="#000000" stroke="#000000" points="1741.188,-2542.8022 1730.6082,-2542.2393 1738.5278,-2549.2771 1741.188,-2542.8022"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1788" cy="-2530.8041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1788" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1886.9548,-2586.4662C1866.998,-2575.2405 1840.5,-2560.3354 1819.947,-2548.7743"/>
<polygon fill="#000000" stroke="#000000" points="1821.3986,-2545.5752 1810.9669,-2543.723 1817.9668,-2551.6762 1821.3986,-2545.5752"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1916" cy="-2530.8041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1916" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2584.6355C1916,-2576.9351 1916,-2567.7785 1916,-2559.2208"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2559.2174 1916,-2549.2174 1912.5001,-2559.2174 1919.5001,-2559.2174"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2130" cy="-2530.8041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2130" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1957.5151,-2588.8364C1991.3229,-2577.4618 2039.3025,-2561.3192 2076.0788,-2548.9458"/>
<polygon fill="#000000" stroke="#000000" points="2077.2896,-2552.2313 2085.6515,-2545.7251 2075.0574,-2545.5968 2077.2896,-2552.2313"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2530.8041" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;231</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1977.2733,-2596.2876C2101.3869,-2583.0879 2382.1528,-2553.228 2517.3937,-2538.845"/>
<polygon fill="#000000" stroke="#000000" points="2518.0882,-2542.2909 2527.6619,-2537.7529 2517.3478,-2535.3302 2518.0882,-2542.2909"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7176" cy="-2530.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7176" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 282&#45;317</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.029,-2601.9003C2539.7647,-2594.2659 6458.0244,-2540.6319 7090.0265,-2531.9809"/>
<polygon fill="#000000" stroke="#000000" points="7090.4664,-2535.4753 7100.4176,-2531.8387 7090.3706,-2528.476 7090.4664,-2535.4753"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11204" cy="-2530.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11204" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 373&#45;432</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1981.8595,-2602.2936C2762.3154,-2596.2435 10232.4913,-2538.3352 11118.3001,-2531.4685"/>
<polygon fill="#000000" stroke="#000000" points="11118.4443,-2534.9675 11128.4168,-2531.39 11118.3899,-2527.9678 11118.4443,-2534.9675"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="13036" cy="-2530.8041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13036" y="-2526.6041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 433&#45;484</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.0829,-2602.5384C2597.909,-2600.0383 7397.2978,-2580.045 11288,-2548.8041 11926.32,-2543.6787 12695.7294,-2534.8245 12949.9142,-2531.8288"/>
<polygon fill="#000000" stroke="#000000" points="12950.2275,-2535.3254 12960.1855,-2531.7076 12950.1449,-2528.3259 12950.2275,-2535.3254"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1468.5,-2429.204 1375.5,-2429.204 1375.5,-2393.204 1468.5,-2393.204 1468.5,-2429.204"/>
<text text-anchor="middle" x="1422" y="-2407.704" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1422.8481,-2512.6394C1422.6859,-2493.2334 1422.4265,-2462.2141 1422.2373,-2439.5819"/>
<polygon fill="#000000" stroke="#000000" points="1425.7369,-2439.51 1422.1533,-2429.5396 1418.7371,-2439.5686 1425.7369,-2439.51"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1514" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1514" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1533.5567,-2512.8988C1529.8135,-2493.4343 1523.7818,-2462.0695 1519.4058,-2439.3139"/>
<polygon fill="#000000" stroke="#000000" points="1522.7924,-2438.3908 1517.4669,-2429.2317 1515.9184,-2439.7128 1522.7924,-2438.3908"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1586" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1586" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1616.6104,-2512.8988C1610.7251,-2493.3462 1601.2251,-2461.7854 1594.3684,-2439.0056"/>
<polygon fill="#000000" stroke="#000000" points="1597.6602,-2437.7985 1591.4264,-2429.2317 1590.9573,-2439.8162 1597.6602,-2437.7985"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1658" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1658" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1698.065,-2513.1567C1690.3243,-2493.4592 1677.705,-2461.347 1668.6975,-2438.4258"/>
<polygon fill="#000000" stroke="#000000" points="1671.8785,-2436.9508 1664.9635,-2428.9238 1665.3635,-2439.5111 1671.8785,-2436.9508"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1730" cy="-2411.204" rx="27" ry="18"/>
<text text-anchor="middle" x="1730" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1779.5663,-2513.4132C1769.9445,-2493.5723 1754.0994,-2460.8988 1742.9184,-2437.8427"/>
<polygon fill="#000000" stroke="#000000" points="1745.9566,-2436.0864 1738.4439,-2428.6159 1739.6582,-2439.1409 1745.9566,-2436.0864"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057,-2476.9044 1775,-2476.9044 1775,-2345.5036 2057,-2345.5036 2057,-2476.9044"/>
<text text-anchor="middle" x="1916" y="-2461.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1916" y="-2446.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1916" y="-2430.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1916" y="-2415.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1916" y="-2400.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1916" y="-2384.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1916" y="-2369.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1916" y="-2353.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916,-2512.6394C1916,-2505.3645 1916,-2496.4574 1916,-2486.972"/>
<polygon fill="#000000" stroke="#000000" points="1919.5001,-2486.9219 1916,-2476.922 1912.5001,-2486.922 1919.5001,-2486.9219"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2429.204 2075.5,-2429.204 2075.5,-2393.204 2266.5,-2393.204 2266.5,-2429.204"/>
<text text-anchor="middle" x="2171" y="-2407.704" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2136.227,-2512.6394C2142.9097,-2493.1456 2153.6096,-2461.9331 2161.3769,-2439.2752"/>
<polygon fill="#000000" stroke="#000000" points="2164.7823,-2440.1342 2164.7144,-2429.5396 2158.1606,-2437.8642 2164.7823,-2440.1342"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2411.204" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2540.569,-2518.7281C2507.7843,-2509.8929 2465.4023,-2496.0702 2431,-2476.8041 2411.3309,-2465.7889 2391.9201,-2449.4896 2377.3823,-2435.8941"/>
<polygon fill="#000000" stroke="#000000" points="2379.4802,-2433.0571 2369.8364,-2428.6699 2374.6394,-2438.1135 2379.4802,-2433.0571"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2562.6368,-2514.462C2546.6527,-2504.8893 2527.4321,-2491.7527 2513,-2476.8041 2501.8906,-2465.2971 2492.2443,-2450.2993 2485.1042,-2437.5489"/>
<polygon fill="#000000" stroke="#000000" points="2488.1857,-2435.8891 2480.3629,-2428.7439 2482.0224,-2439.2079 2488.1857,-2435.8891"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2411.204" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;141</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2512.6394C2593,-2493.2334 2593,-2462.2141 2593,-2439.5819"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2439.5396 2593,-2429.5396 2589.5001,-2439.5397 2596.5001,-2439.5396"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 142&#45;220</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2632.7017,-2515.7778C2690.133,-2494.0411 2796.3573,-2453.8372 2859.0409,-2430.1126"/>
<polygon fill="#000000" stroke="#000000" points="2860.5997,-2433.265 2868.7133,-2426.4518 2858.1218,-2426.7182 2860.5997,-2433.265"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3963" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;231</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2660.0054,-2524.9546C2888.1147,-2505.0408 3634.0436,-2439.9217 3882.022,-2418.2733"/>
<polygon fill="#000000" stroke="#000000" points="3882.3866,-2421.7549 3892.0443,-2417.3984 3881.7777,-2414.7814 3882.3866,-2421.7549"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4840" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4840" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 232&#45;281</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.4147,-2529.3227C2873.7216,-2524.6545 3515.5884,-2508.6359 4047,-2476.8041 4308.2496,-2461.1551 4617.13,-2432.7407 4760.0626,-2419.0255"/>
<polygon fill="#000000" stroke="#000000" points="4760.445,-2422.5049 4770.064,-2418.0638 4759.7749,-2415.5371 4760.445,-2422.5049"/>
</g>
<!-- header_88 -->
<g id="node89" class="node">
<title>header_88</title>
<ellipse fill="none" stroke="#000000" cx="6977" cy="-2411.204" rx="107.339" ry="18"/>
<text text-anchor="middle" x="6977" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;header_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7147.9102,-2513.922C7113.0959,-2492.9984 7053.6297,-2457.2589 7014.8262,-2433.9378"/>
<polygon fill="#000000" stroke="#000000" points="7016.2896,-2430.7338 7005.9155,-2428.5824 7012.6837,-2436.7336 7016.2896,-2430.7338"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7135" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7135" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7169.773,-2512.6394C7163.0515,-2493.0322 7152.2659,-2461.5698 7144.4879,-2438.8809"/>
<polygon fill="#000000" stroke="#000000" points="7147.705,-2437.4723 7141.1513,-2429.1477 7141.0833,-2439.7424 7147.705,-2437.4723"/>
</g>
<!-- prose_90 -->
<g id="node91" class="node">
<title>prose_90</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7217" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;prose_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7182.227,-2512.6394C7188.9485,-2493.0322 7199.7341,-2461.5698 7207.5121,-2438.8809"/>
<polygon fill="#000000" stroke="#000000" points="7210.9167,-2439.7424 7210.8487,-2429.1477 7204.295,-2437.4723 7210.9167,-2439.7424"/>
</g>
<!-- section_91 -->
<g id="node92" class="node">
<title>section_91</title>
<ellipse fill="none" stroke="#000000" cx="7804" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7804" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 292&#45;317</text>
</g>
<!-- section_10&#45;&gt;section_91 -->
<g id="edge91" class="edge">
<title>section_10&#45;&gt;section_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7235.0807,-2519.5524C7351.4995,-2497.3809 7610.0282,-2448.1452 7734.4495,-2424.4496"/>
<polygon fill="#000000" stroke="#000000" points="7735.4502,-2427.822 7744.6188,-2422.5129 7734.1405,-2420.9456 7735.4502,-2427.822"/>
</g>
<!-- section_92 -->
<g id="node93" class="node">
<title>section_92</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9340" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 318&#45;372</text>
</g>
<!-- section_10&#45;&gt;section_92 -->
<g id="edge92" class="edge">
<title>section_10&#45;&gt;section_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7249.5516,-2526.7391C7577.8074,-2508.597 8908.0524,-2435.0769 9256.2491,-2415.8327"/>
<polygon fill="#000000" stroke="#000000" points="9256.4708,-2419.3259 9266.2623,-2415.2793 9256.0844,-2412.3366 9256.4708,-2419.3259"/>
</g>
<!-- header_140 -->
<g id="node141" class="node">
<title>header_140</title>
<ellipse fill="none" stroke="#000000" cx="10367" cy="-2411.204" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10367" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_140 -->
<g id="edge140" class="edge">
<title>section_11&#45;&gt;header_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11130.479,-2526.675C10987.0246,-2518.2684 10674.6014,-2498.147 10569,-2476.8041 10516.5798,-2466.2096 10458.7172,-2446.5626 10418.4058,-2431.5216"/>
<polygon fill="#000000" stroke="#000000" points="10419.3972,-2428.1549 10408.8054,-2427.9027 10416.9281,-2434.705 10419.3972,-2428.1549"/>
</g>
<!-- prose_141 -->
<g id="node142" class="node">
<title>prose_141</title>
<ellipse fill="none" stroke="#000000" cx="10610" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10610" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_141 -->
<g id="edge141" class="edge">
<title>section_11&#45;&gt;prose_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11146.2344,-2519.1732C11026.4436,-2495.0537 10753.5682,-2440.111 10650.4635,-2419.3512"/>
<polygon fill="#000000" stroke="#000000" points="10650.9485,-2415.8787 10640.4543,-2417.3359 10649.5667,-2422.741 10650.9485,-2415.8787"/>
</g>
<!-- prose_142 -->
<g id="node143" class="node">
<title>prose_142</title>
<ellipse fill="none" stroke="#000000" cx="11056" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11056" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_142 -->
<g id="edge142" class="edge">
<title>section_11&#45;&gt;prose_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11182.4795,-2513.4132C11156.0651,-2492.0675 11111.2709,-2455.8689 11082.6903,-2432.7727"/>
<polygon fill="#000000" stroke="#000000" points="11084.7115,-2429.906 11074.7338,-2426.3429 11080.3117,-2435.3505 11084.7115,-2429.906"/>
</g>
<!-- prose_143 -->
<g id="node144" class="node">
<title>prose_143</title>
<ellipse fill="none" stroke="#000000" cx="11204" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11204" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_143 -->
<g id="edge143" class="edge">
<title>section_11&#45;&gt;prose_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11204,-2512.6394C11204,-2493.2334 11204,-2462.2141 11204,-2439.5819"/>
<polygon fill="#000000" stroke="#000000" points="11207.5001,-2439.5396 11204,-2429.5396 11200.5001,-2439.5397 11207.5001,-2439.5396"/>
</g>
<!-- prose_144 -->
<g id="node145" class="node">
<title>prose_144</title>
<ellipse fill="none" stroke="#000000" cx="11286" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11286" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_144 -->
<g id="edge144" class="edge">
<title>section_11&#45;&gt;prose_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11218.0822,-2513.105C11226.1929,-2502.7053 11236.4429,-2489.2053 11245,-2476.8041 11253.8135,-2464.0314 11263.0235,-2449.4246 11270.4766,-2437.2415"/>
<polygon fill="#000000" stroke="#000000" points="11273.6046,-2438.8332 11275.798,-2428.4679 11267.6195,-2435.2031 11273.6046,-2438.8332"/>
</g>
<!-- prose_145 -->
<g id="node146" class="node">
<title>prose_145</title>
<ellipse fill="none" stroke="#000000" cx="11368" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11368" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_145 -->
<g id="edge145" class="edge">
<title>section_11&#45;&gt;prose_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11252.7315,-2516.9897C11277.008,-2508.3343 11305.654,-2495.2611 11327,-2476.8041 11339.2625,-2466.2012 11349.0762,-2451.0133 11356.0243,-2437.9211"/>
<polygon fill="#000000" stroke="#000000" points="11359.2172,-2439.3618 11360.5711,-2428.8538 11352.9598,-2436.224 11359.2172,-2439.3618"/>
</g>
<!-- prose_146 -->
<g id="node147" class="node">
<title>prose_146</title>
<ellipse fill="none" stroke="#000000" cx="11450" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11450" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_146 -->
<g id="edge146" class="edge">
<title>section_11&#45;&gt;prose_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11264.5801,-2519.9718C11316.4067,-2509.7914 11386.1458,-2493.6389 11409,-2476.8041 11422.2261,-2467.0616 11432.1731,-2451.6537 11438.9552,-2438.2181"/>
<polygon fill="#000000" stroke="#000000" points="11442.2519,-2439.4319 11443.3359,-2428.8926 11435.9162,-2436.4556 11442.2519,-2439.4319"/>
</g>
<!-- codeblock_147 -->
<g id="node148" class="node">
<title>codeblock_147</title>
<ellipse fill="none" stroke="#000000" cx="11681" cy="-2411.204" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11681" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 390&#45;430</text>
</g>
<!-- section_11&#45;&gt;codeblock_147 -->
<g id="edge147" class="edge">
<title>section_11&#45;&gt;codeblock_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11268.7207,-2521.4044C11327.288,-2512.2433 11415.6519,-2496.7849 11491,-2476.8041 11539.149,-2464.0359 11592.676,-2445.1109 11630.6134,-2430.8648"/>
<polygon fill="#000000" stroke="#000000" points="11632.28,-2433.9765 11640.3954,-2427.1654 11629.8038,-2427.429 11632.28,-2433.9765"/>
</g>
<!-- header_168 -->
<g id="node169" class="node">
<title>header_168</title>
<ellipse fill="none" stroke="#000000" cx="12782" cy="-2411.204" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="12782" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_168 -->
<g id="edge168" class="edge">
<title>section_12&#45;&gt;header_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12999.8916,-2514.9209C12975.9965,-2504.3202 12944.0197,-2489.9629 12916,-2476.8041 12885.2005,-2462.3399 12850.725,-2445.4462 12824.4566,-2432.4252"/>
<polygon fill="#000000" stroke="#000000" points="12825.6853,-2429.1276 12815.172,-2427.8148 12822.572,-2435.3972 12825.6853,-2429.1276"/>
</g>
<!-- prose_169 -->
<g id="node170" class="node">
<title>prose_169</title>
<ellipse fill="none" stroke="#000000" cx="12957" cy="-2411.204" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12957" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_169 -->
<g id="edge169" class="edge">
<title>section_12&#45;&gt;prose_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13024.1729,-2512.8988C13010.8731,-2492.7638 12989.1618,-2459.8945 12974.0351,-2436.9939"/>
<polygon fill="#000000" stroke="#000000" points="12976.8263,-2434.8692 12968.3944,-2428.4542 12970.9855,-2438.7273 12976.8263,-2434.8692"/>
</g>
<!-- codeblock_170 -->
<g id="node171" class="node">
<title>codeblock_170</title>
<ellipse fill="none" stroke="#000000" cx="13106" cy="-2411.204" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13106" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 435&#45;448</text>
</g>
<!-- section_12&#45;&gt;codeblock_170 -->
<g id="edge170" class="edge">
<title>section_12&#45;&gt;codeblock_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13046.4797,-2512.8988C13058.0781,-2493.082 13076.8961,-2460.9302 13090.2659,-2438.0869"/>
<polygon fill="#000000" stroke="#000000" points="13093.418,-2439.6302 13095.4487,-2429.2317 13087.3767,-2436.0943 13093.418,-2439.6302"/>
</g>
<!-- section_171 -->
<g id="node172" class="node">
<title>section_171</title>
<ellipse fill="none" stroke="#000000" cx="13550" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13550" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 451&#45;484</text>
</g>
<!-- section_12&#45;&gt;section_171 -->
<g id="edge171" class="edge">
<title>section_12&#45;&gt;section_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13090.0355,-2518.2309C13185.5721,-2496.0009 13383.8455,-2449.8657 13486.0355,-2426.0876"/>
<polygon fill="#000000" stroke="#000000" points="13486.9706,-2429.4636 13495.9172,-2423.7883 13485.3842,-2422.6457 13486.9706,-2429.4636"/>
</g>
<!-- section_172 -->
<g id="node173" class="node">
<title>section_172</title>
<ellipse fill="none" stroke="#000000" cx="14484" cy="-2411.204" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14484" y="-2407.004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 485&#45;518</text>
</g>
<!-- section_12&#45;&gt;section_172 -->
<g id="edge172" class="edge">
<title>section_12&#45;&gt;section_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13107.8065,-2524.8731C13351.3619,-2504.7562 14145.1454,-2439.1923 14402.5878,-2417.9284"/>
<polygon fill="#000000" stroke="#000000" points="14402.9381,-2421.4115 14412.6161,-2417.1001 14402.3619,-2414.4352 14402.9381,-2421.4115"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2040.3045 0,-2040.3045 0,-1968.5022 324,-1968.5022 324,-2040.3045"/>
<text text-anchor="middle" x="162" y="-1976.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1509.2631,-2393.2266C1504.1163,-2377.6528 1494.2259,-2356.0318 1477,-2345.6039 1368.2075,-2279.7448 441.6989,-2375.6173 333,-2309.6039 237.7522,-2251.7594 191.1966,-2120.0585 172.4629,-2050.0805"/>
<polygon fill="#000000" stroke="#000000" points="175.8028,-2049.0169 169.8983,-2040.2199 169.0282,-2050.7789 175.8028,-2049.0169"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2031.7037 342.5,-2031.7037 342.5,-1977.1029 897.5,-1977.1029 897.5,-2031.7037"/>
<text text-anchor="middle" x="620" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1581.4695,-2393.3409C1576.5146,-2377.8441 1566.9248,-2356.2718 1550,-2345.6039 1428.9306,-2269.2924 1036.7227,-2370.0461 907,-2309.6039 780.1775,-2250.5129 681.8997,-2107.9005 640.8764,-2040.6504"/>
<polygon fill="#000000" stroke="#000000" points="643.8597,-2038.8199 635.6997,-2032.0624 637.8647,-2042.4337 643.8597,-2038.8199"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2031.7037 916,-2031.7037 916,-1977.1029 1464,-1977.1029 1464,-2031.7037"/>
<text text-anchor="middle" x="1190" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1652.7687,-2393.4608C1647.4348,-2378.4781 1637.6842,-2357.601 1622,-2345.6039 1567.8877,-2304.2125 1531.7778,-2344.0503 1473,-2309.6039 1354.2132,-2239.9894 1255.4773,-2104.9306 1212.7489,-2040.4106"/>
<polygon fill="#000000" stroke="#000000" points="1215.5058,-2038.232 1207.0952,-2031.7889 1209.6521,-2042.0706 1215.5058,-2038.232"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2039.7037 1482,-2039.7037 1482,-1969.103 2030,-1969.103 2030,-2039.7037"/>
<text text-anchor="middle" x="1756" y="-2008.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1993.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.1507,-2393.1994C1734.9841,-2333.222 1747.3988,-2138.9791 1753.095,-2049.8551"/>
<polygon fill="#000000" stroke="#000000" points="1756.594,-2049.9809 1753.7391,-2039.778 1749.6083,-2049.5344 1756.594,-2049.9809"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-2022.4033 2048,-2022.4033 2048,-1986.4033 2162,-1986.4033 2162,-2022.4033"/>
<text text-anchor="middle" x="2105" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2335.8279,-2393.5156C2320.8942,-2378.9755 2298.0823,-2358.7053 2275,-2345.6039 2232.4615,-2321.4591 2203.4456,-2346.2068 2171,-2309.6039 2100.0783,-2229.5948 2099.261,-2091.7196 2102.6242,-2032.6271"/>
<polygon fill="#000000" stroke="#000000" points="2106.1236,-2032.7492 2103.2849,-2022.5418 2099.1386,-2032.2916 2106.1236,-2032.7492"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2465.6617,-2393.5315C2459.2854,-2378.3817 2447.9512,-2357.2182 2431,-2345.6039 2360.8192,-2297.5186 2300.9587,-2371.88 2243,-2309.6039 2170.9916,-2232.2314 2188.8722,-2091.841 2200.6424,-2032.2994"/>
<polygon fill="#000000" stroke="#000000" points="2204.0752,-2032.982 2202.6756,-2022.48 2197.2206,-2031.5626 2204.0752,-2032.982"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-2004.4033" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2575.1932,-2393.7378C2559.758,-2379.3334 2536.2962,-2359.1374 2513,-2345.6039 2474.317,-2323.1315 2449.2607,-2342.5534 2419,-2309.6039 2345.4336,-2229.5006 2332.989,-2091.6763 2331.1525,-2032.6122"/>
<polygon fill="#000000" stroke="#000000" points="2334.6498,-2032.4487 2330.9207,-2022.5319 2327.6516,-2032.6097 2334.6498,-2032.4487"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2571.323,-2393.9069C2549.8803,-2375.4661 2518.0171,-2344.2003 2502,-2309.6039 2458.3927,-2215.4131 2456.7637,-2088.6428 2458.5281,-2032.8139"/>
<polygon fill="#000000" stroke="#000000" points="2462.0329,-2032.7502 2458.9148,-2022.6246 2455.038,-2032.4847 2462.0329,-2032.7502"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2004.4033" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;139</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2393.1994C2593,-2329.0222 2593,-2111.1178 2593,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2032.6615 2593,-2022.6616 2589.5001,-2032.6616 2596.5001,-2032.6615"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-2004.4033" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.0881,-2393.0403C2892.4346,-2372.8595 2878.4121,-2339.211 2868,-2309.6039 2832.5424,-2208.7793 2798.2246,-2086.3847 2783.5062,-2032.3451"/>
<polygon fill="#000000" stroke="#000000" points="2786.825,-2031.2103 2780.8293,-2022.4752 2780.069,-2033.0427 2786.825,-2031.2103"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2393.1994C2909,-2329.0222 2909,-2111.1178 2909,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-2032.6615 2909,-2022.6616 2905.5001,-2032.6616 2912.5001,-2032.6615"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2917.8171,-2393.3187C2927.263,-2373.3815 2941.9757,-2339.9453 2950,-2309.6039 2976.3433,-2209.9947 2986.2594,-2087.3916 2989.5519,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="2993.0625,-2032.7823 2990.1413,-2022.5982 2986.074,-2032.3812 2993.0625,-2032.7823"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3212" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3212" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;218</text>
</g>
<!-- section_27&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2934.7889,-2393.9717C2961.3503,-2375.3508 3002.8675,-2343.7295 3032,-2309.6039 3110.1816,-2218.0225 3174.0427,-2088.0526 3199.7728,-2031.9456"/>
<polygon fill="#000000" stroke="#000000" points="3203.0405,-2033.2147 3203.9899,-2022.6625 3196.6672,-2030.3195 3203.0405,-2033.2147"/>
</g>
<!-- header_50 -->
<g id="node51" class="node">
<title>header_50</title>
<ellipse fill="none" stroke="#000000" cx="3722" cy="-2004.4033" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3722" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_50 -->
<g id="edge50" class="edge">
<title>section_28&#45;&gt;header_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3952.3336,-2393.1994C3914.08,-2328.6285 3783.6332,-2108.4383 3737.9551,-2031.335"/>
<polygon fill="#000000" stroke="#000000" points="3740.925,-2029.4811 3732.8167,-2022.6616 3734.9025,-2033.0491 3740.925,-2029.4811"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3963" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_28&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963,-2393.1994C3963,-2329.0222 3963,-2111.1178 3963,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="3966.5001,-2032.6615 3963,-2022.6616 3959.5001,-2032.6616 3966.5001,-2032.6615"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4045" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4045" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_28&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3971.8171,-2393.3187C3981.263,-2373.3815 3995.9757,-2339.9453 4004,-2309.6039 4030.3433,-2209.9947 4040.2594,-2087.3916 4043.5519,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="4047.0625,-2032.7823 4044.1413,-2022.5982 4040.074,-2032.3812 4047.0625,-2032.7823"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="4183" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4183" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;229</text>
</g>
<!-- section_28&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_28&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3991.7154,-2394.3832C4019.611,-2376.643 4061.2729,-2346.2122 4086,-2309.6039 4146.8101,-2219.575 4171.3025,-2089.1645 4179.49,-2032.4735"/>
<polygon fill="#000000" stroke="#000000" points="4182.9716,-2032.847 4180.8753,-2022.4616 4176.0377,-2031.8875 4182.9716,-2032.847"/>
</g>
<!-- header_60 -->
<g id="node61" class="node">
<title>header_60</title>
<ellipse fill="none" stroke="#000000" cx="4594" cy="-2004.4033" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4594" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_60 -->
<g id="edge60" class="edge">
<title>section_29&#45;&gt;header_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4812.3797,-2394.313C4784.9344,-2376.3054 4743.2525,-2345.4781 4717,-2309.6039 4651.076,-2219.5184 4614.1282,-2089.1377 4600.3308,-2032.464"/>
<polygon fill="#000000" stroke="#000000" points="4603.6692,-2031.3738 4597.95,-2022.4552 4596.8592,-2032.9938 4603.6692,-2031.3738"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4758" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4758" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_29&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4831.1829,-2393.3187C4821.737,-2373.3815 4807.0243,-2339.9453 4799,-2309.6039 4772.6567,-2209.9947 4762.7406,-2087.3916 4759.4481,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="4762.926,-2032.3812 4758.8587,-2022.5982 4755.9375,-2032.7823 4762.926,-2032.3812"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="4840" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4840" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_29&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4840,-2393.1994C4840,-2329.0222 4840,-2111.1178 4840,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="4843.5001,-2032.6615 4840,-2022.6616 4836.5001,-2032.6616 4843.5001,-2032.6615"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5466" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5466" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_29&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4866.1015,-2394.2422C4966.719,-2328.8567 5329.1168,-2093.3556 5436.0787,-2023.8474"/>
<polygon fill="#000000" stroke="#000000" points="5438.2895,-2026.5849 5444.7674,-2018.2011 5434.4752,-2020.7153 5438.2895,-2026.5849"/>
</g>
<!-- prose_64 -->
<g id="node65" class="node">
<title>prose_64</title>
<ellipse fill="none" stroke="#000000" cx="5694" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5694" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_64 -->
<g id="edge64" class="edge">
<title>section_29&#45;&gt;prose_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4914.0563,-2407.7034C5066.8404,-2399.2512 5410.7581,-2373.504 5507,-2309.6039 5610.5043,-2240.8818 5666.3968,-2093.3463 5685.9142,-2032.0193"/>
<polygon fill="#000000" stroke="#000000" points="5689.3175,-2032.8613 5688.9384,-2022.2733 5682.6319,-2030.7867 5689.3175,-2032.8613"/>
</g>
<!-- codeblock_65 -->
<g id="node66" class="node">
<title>codeblock_65</title>
<ellipse fill="none" stroke="#000000" cx="5985" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5985" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;279</text>
</g>
<!-- section_29&#45;&gt;codeblock_65 -->
<g id="edge65" class="edge">
<title>section_29&#45;&gt;codeblock_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4915.304,-2409.851C5104.3991,-2405.3277 5594.1523,-2386.3239 5735,-2309.6039 5855.7551,-2243.8284 5940.863,-2093.5199 5971.9699,-2031.7148"/>
<polygon fill="#000000" stroke="#000000" points="5975.1916,-2033.096 5976.4959,-2022.5818 5968.9195,-2029.9878 5975.1916,-2033.096"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1882,-912.6029 1544,-912.6029 1544,-856.7999 1882,-856.7999 1882,-912.6029"/>
<text text-anchor="middle" x="1713" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.4791,-1986.4723C2223.4218,-1933.9318 2249.9983,-1779.0315 2171,-1699.2027 2082.7453,-1610.0202 1983.913,-1747.5212 1891,-1663.2027 1670.0544,-1462.6948 1694.7899,-1049.1619 1708.2864,-922.4418"/>
<polygon fill="#000000" stroke="#000000" points="1711.7714,-922.77 1709.3923,-912.4457 1704.8138,-922.0002 1711.7714,-922.77"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2042,-902.7014 1900,-902.7014 1900,-866.7014 2042,-866.7014 2042,-902.7014"/>
<text text-anchor="middle" x="1971" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.7892,-1986.3061C2333.0335,-1933.3083 2328.9002,-1777.2776 2243,-1699.2027 2178.7521,-1640.8077 2109.7931,-1727.0866 2051,-1663.2027 1848.0014,-1442.6272 1935.4878,-1024.0011 1963.5354,-912.542"/>
<polygon fill="#000000" stroke="#000000" points="1966.9573,-913.2877 1966.0523,-902.7315 1960.1769,-911.548 1966.9573,-913.2877"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2087" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2087" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.1632,-1986.401C2475.1842,-1933.6646 2499.0725,-1778.2797 2419,-1699.2027 2324.7063,-1606.0815 2213.139,-1760.3512 2123,-1663.2027 2019.9424,-1552.1311 2069.6575,-1039.5187 2083.7102,-912.9927"/>
<polygon fill="#000000" stroke="#000000" points="2087.2019,-913.262 2084.8434,-902.933 2080.2459,-912.4783 2087.2019,-913.262"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2680,-1663.2041 2132,-1663.2041 2132,-106.1988 2680,-106.1988 2680,-1663.2041"/>
<text text-anchor="middle" x="2406" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2406" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2406" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2406" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2406" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2406" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2406" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2406" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2406" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2406" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2406" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2406" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2406" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2406" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2406" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2406" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2406" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2406" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2406" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2406" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2406" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2406" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2406" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2406" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2406" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2406" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2406" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2406" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2406" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2406" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2406" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2406" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2406" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2406" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2406" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2406" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2406" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2406" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2406" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2406" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2406" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2406" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2406" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2406" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2406" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2406" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2406" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2406" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2406" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2406" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.9869,-1986.3619C2582.5819,-1942.0228 2562.2977,-1820.5668 2537.7663,-1673.68"/>
<polygon fill="#000000" stroke="#000000" points="2541.1683,-1672.8022 2536.0687,-1663.5153 2534.2639,-1673.9553 2541.1683,-1672.8022"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2114,-53.1 2060,-53.1 2060,-17.1 2114,-17.1 2114,-53.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2087,-866.5632C2087,-758.2631 2087,-197.2221 2087,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2090.5001,-63.4293 2087,-53.4293 2083.5001,-63.4293 2090.5001,-63.4293"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="2854,-902.7014 2698,-902.7014 2698,-866.7014 2854,-866.7014 2854,-902.7014"/>
<text text-anchor="middle" x="2776" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>header_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776,-1986.3619C2776,-1857.1254 2776,-1072.7313 2776,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="2779.5001,-913.0559 2776,-903.0559 2772.5001,-913.056 2779.5001,-913.0559"/>
</g>
<!-- raw_45 -->
<g id="node46" class="node">
<title>raw_45</title>
<ellipse fill="none" stroke="#000000" cx="2899" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2899" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;raw_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.8389,-1986.3619C2907.6847,-1857.1254 2900.6793,-1072.7313 2899.2532,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="2902.7532,-913.0242 2899.1639,-903.0559 2895.7535,-913.0868 2902.7532,-913.0242"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_42&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.6777,-1986.3619C2988.3693,-1857.1254 2974.3586,-1072.7313 2971.5065,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="2975.006,-912.9918 2971.3278,-903.0559 2968.0071,-913.1169 2975.006,-912.9918"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="3571.5,-1412.5035 3016.5,-1412.5035 3016.5,-356.8993 3571.5,-356.8993 3571.5,-1412.5035"/>
<text text-anchor="middle" x="3294" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3294" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3294" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3294" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3294" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3294" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3294" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3294" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3294" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3294" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3294" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3294" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3294" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3294" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3294" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3294" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3294" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3294" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3294" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3294" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3294" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3294" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3294" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3294" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3294" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3294" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3294" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3294" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3294" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3294" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3294" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3294" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3294" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3294" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3294" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3294" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3294" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3294" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3294" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3294" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3294" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3294" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3294" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3294" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3294" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3294" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3294" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3294" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3294" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3294" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3294" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_43&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3213.3212,-1986.3619C3218.3144,-1918.1802 3236.662,-1667.6459 3254.6004,-1422.6984"/>
<polygon fill="#000000" stroke="#000000" points="3258.1063,-1422.7451 3255.3461,-1412.5162 3251.125,-1422.2338 3258.1063,-1422.7451"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2677,-63.0015 2157,-63.0015 2157,-7.1986 2677,-7.1986 2677,-63.0015"/>
<text text-anchor="middle" x="2417" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>raw_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.093,-866.5278C2912.8891,-760.4937 2966.925,-222.4545 2863,-106.2001 2854.7496,-96.9708 2746.0706,-79.5409 2638.0717,-64.2491"/>
<polygon fill="#000000" stroke="#000000" points="2638.3528,-60.7542 2627.9621,-62.8235 2637.3754,-67.6856 2638.3528,-60.7542"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3194.5,-62.4005 2695.5,-62.4005 2695.5,-7.7996 3194.5,-7.7996 3194.5,-62.4005"/>
<text text-anchor="middle" x="2945" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2945" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2970.4449,-866.5632C2967.2032,-760.635 2950.7067,-221.5794 2946.1611,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2949.647,-72.525 2945.8427,-62.6367 2942.6503,-72.7391 2949.647,-72.525"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="3920.5,-902.7014 3589.5,-902.7014 3589.5,-866.7014 3920.5,-866.7014 3920.5,-902.7014"/>
<text text-anchor="middle" x="3755" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_50&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_50&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3722.5317,-1986.3619C3726.3406,-1857.1254 3749.4584,-1072.7313 3754.1643,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="3757.6628,-913.1547 3754.4591,-903.0559 3750.6659,-912.9485 3757.6628,-913.1547"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="3966" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3966" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_51&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963.0483,-1986.3619C3963.3946,-1857.1254 3965.4962,-1072.7313 3965.924,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="3969.4239,-913.0653 3965.9508,-903.0559 3962.4239,-913.0465 3969.4239,-913.0653"/>
</g>
<!-- raw_57 -->
<g id="node58" class="node">
<title>raw_57</title>
<ellipse fill="none" stroke="#000000" cx="4040" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4040" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;raw_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4044.9194,-1986.3619C4044.3423,-1857.1254 4040.8396,-1072.7313 4040.1266,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4043.6267,-913.0402 4040.082,-903.0559 4036.6268,-913.0715 4043.6267,-913.0402"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4210,-902.7014 4156,-902.7014 4156,-866.7014 4210,-866.7014 4210,-902.7014"/>
</g>
<!-- codeblock_53&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>codeblock_53&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4183,-1986.3619C4183,-1857.1254 4183,-1072.7313 4183,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4186.5001,-913.0559 4183,-903.0559 4179.5001,-913.056 4186.5001,-913.0559"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3579,-63.0015 3213,-63.0015 3213,-7.1986 3579,-7.1986 3579,-63.0015"/>
<text text-anchor="middle" x="3396" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_55&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>raw_55&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.158,-866.4429C3980.3209,-759.9257 4036.0427,-219.6034 3929,-106.2001 3876.6957,-50.7878 3663.4211,-81.0594 3588,-70.2001 3575.9584,-68.4663 3563.518,-66.5285 3551.0275,-64.4779"/>
<polygon fill="#000000" stroke="#000000" points="3551.4451,-60.9994 3541.0063,-62.811 3550.2964,-67.9045 3551.4451,-60.9994"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="3942.5,-55.0021 3597.5,-55.0021 3597.5,-15.198 3942.5,-15.198 3942.5,-55.0021"/>
<text text-anchor="middle" x="3770" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_57&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>raw_57&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4045.7198,-866.9385C4074.0949,-775.1152 4191.0126,-349.1899 4002,-106.2001 3986.5094,-86.2857 3934.7245,-69.4415 3884.0003,-57.1541"/>
<polygon fill="#000000" stroke="#000000" points="3884.7537,-53.7358 3874.2161,-54.8355 3883.1396,-60.5471 3884.7537,-53.7358"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4703.5,-902.7014 4484.5,-902.7014 4484.5,-866.7014 4703.5,-866.7014 4703.5,-902.7014"/>
<text text-anchor="middle" x="4594" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>header_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4594,-1986.3619C4594,-1857.1254 4594,-1072.7313 4594,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4597.5001,-913.0559 4594,-903.0559 4590.5001,-913.056 4597.5001,-913.0559"/>
</g>
<!-- raw_67 -->
<g id="node68" class="node">
<title>raw_67</title>
<ellipse fill="none" stroke="#000000" cx="4753" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4753" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_67 -->
<g id="edge67" class="edge">
<title>prose_61&#45;&gt;raw_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4757.9194,-1986.3619C4757.3423,-1857.1254 4753.8396,-1072.7313 4753.1266,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4756.6267,-913.0402 4753.082,-903.0559 4749.6268,-913.0715 4756.6267,-913.0402"/>
</g>
<!-- raw_69 -->
<g id="node70" class="node">
<title>raw_69</title>
<ellipse fill="none" stroke="#000000" cx="4832" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4832" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_69 -->
<g id="edge69" class="edge">
<title>prose_62&#45;&gt;raw_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4839.8711,-1986.3619C4838.9477,-1857.1254 4833.3434,-1072.7313 4832.2026,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="4835.7026,-913.0306 4832.1311,-903.0559 4828.7028,-913.0807 4835.7026,-913.0306"/>
</g>
<!-- raw_71 -->
<g id="node72" class="node">
<title>raw_71</title>
<ellipse fill="none" stroke="#000000" cx="5143" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5143" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_71 -->
<g id="edge71" class="edge">
<title>prose_63&#45;&gt;raw_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5453.9752,-1987.6249C5420.2121,-1939.644 5323.9515,-1796.7163 5277,-1663.2027 5178.0111,-1381.7135 5150.4916,-1016.3711 5144.4602,-913.0319"/>
<polygon fill="#000000" stroke="#000000" points="5147.9406,-912.5835 5143.8841,-902.796 5140.9517,-912.977 5147.9406,-912.5835"/>
</g>
<!-- prespace_72 -->
<g id="node73" class="node">
<title>prespace_72</title>
<ellipse fill="none" stroke="#000000" cx="5332" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5332" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_72 -->
<g id="edge72" class="edge">
<title>prose_63&#45;&gt;prespace_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5460.8736,-1986.464C5446.6858,-1936.032 5406.7169,-1788.5062 5388,-1663.2027 5344.5414,-1372.2615 5334.5187,-1014.9279 5332.4759,-913.0249"/>
<polygon fill="#000000" stroke="#000000" points="5335.9733,-912.85 5332.2832,-902.9186 5328.9746,-912.9836 5335.9733,-912.85"/>
</g>
<!-- literal_73 -->
<g id="node74" class="node">
<title>literal_73</title>
<ellipse fill="none" stroke="#000000" cx="5428" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5428" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_73 -->
<g id="edge73" class="edge">
<title>prose_63&#45;&gt;literal_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5465.3877,-1986.3619C5461.0017,-1857.1254 5434.3813,-1072.7313 5428.9623,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="5432.4602,-912.9314 5428.6229,-903.0559 5425.4642,-913.1689 5432.4602,-912.9314"/>
</g>
<!-- raw_74 -->
<g id="node75" class="node">
<title>raw_74</title>
<ellipse fill="none" stroke="#000000" cx="5504" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5504" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_74 -->
<g id="edge74" class="edge">
<title>prose_63&#45;&gt;raw_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5466.6123,-1986.3619C5470.9983,-1857.1254 5497.6187,-1072.7313 5503.0377,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="5506.5358,-913.1689 5503.3771,-903.0559 5499.5398,-912.9314 5506.5358,-913.1689"/>
</g>
<!-- prespace_75 -->
<g id="node76" class="node">
<title>prespace_75</title>
<ellipse fill="none" stroke="#000000" cx="5595" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5595" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_75 -->
<g id="edge75" class="edge">
<title>prose_63&#45;&gt;prespace_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5470.8496,-1986.4436C5484.2736,-1935.9587 5522.1079,-1788.3087 5540,-1663.2027 5581.6433,-1372.0232 5592.2103,-1014.8554 5594.4605,-913.0083"/>
<polygon fill="#000000" stroke="#000000" points="5597.9618,-912.9797 5594.6745,-902.9078 5590.9634,-912.8314 5597.9618,-912.9797"/>
</g>
<!-- literal_76 -->
<g id="node77" class="node">
<title>literal_76</title>
<ellipse fill="none" stroke="#000000" cx="5691" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5691" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_76 -->
<g id="edge76" class="edge">
<title>prose_63&#45;&gt;literal_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5478.7374,-1987.4761C5513.8769,-1939.6684 5612.0861,-1798.3055 5650,-1663.2027 5729.5638,-1379.6847 5703.5013,-1015.7621 5693.8842,-912.8948"/>
<polygon fill="#000000" stroke="#000000" points="5697.3457,-912.3255 5692.9043,-902.7065 5690.3778,-912.9957 5697.3457,-912.3255"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="5767" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5767" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_63&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5472.6378,-1986.4145C5492.419,-1935.0234 5555.7067,-1785.7035 5653,-1699.2027 5681.5341,-1673.8338 5709.6848,-1694.8798 5731,-1663.2027 5815.4114,-1537.7568 5779.8704,-1037.9501 5769.4874,-913.0844"/>
<polygon fill="#000000" stroke="#000000" points="5772.95,-912.4935 5768.62,-902.8239 5765.9749,-913.0832 5772.95,-912.4935"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5839" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5839" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_64&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_64&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5701.498,-1986.7027C5722.191,-1936.8897 5780.0796,-1790.8174 5803,-1663.2027 5854.9816,-1373.7829 5844.6494,-1014.691 5840.3421,-912.8124"/>
<polygon fill="#000000" stroke="#000000" points="5843.8341,-912.5529 5839.8985,-902.7162 5836.8409,-912.8602 5843.8341,-912.5529"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6390,-1127.7024 5884,-1127.7024 5884,-641.7005 6390,-641.7005 6390,-1127.7024"/>
<text text-anchor="middle" x="6137" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6137" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6137" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6137" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6137" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6137" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6137" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6137" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6137" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6137" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6137" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6137" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6137" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6137" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6137" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6137" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6137" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6137" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6137" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_65&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>codeblock_65&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5987.4491,-1986.3619C6000.4892,-1890.3027 6062.6647,-1432.2891 6102.6294,-1137.8911"/>
<polygon fill="#000000" stroke="#000000" points="6106.1054,-1138.3038 6103.9825,-1127.9239 6099.169,-1137.3621 6106.1054,-1138.3038"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="4235.5,-63.0015 3960.5,-63.0015 3960.5,-7.1986 4235.5,-7.1986 4235.5,-63.0015"/>
<text text-anchor="middle" x="4098" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_67&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>raw_67&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4755.0652,-866.7361C4766.826,-760.7481 4821.066,-217.9513 4712,-106.2001 4675.6503,-68.9555 4296.4136,-78.2685 4245,-70.2001 4235.3768,-68.6899 4225.4532,-66.8796 4215.5187,-64.8879"/>
<polygon fill="#000000" stroke="#000000" points="4216.0923,-61.4326 4205.5913,-62.8401 4214.6781,-68.2882 4216.0923,-61.4326"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="4816,-70.3004 4254,-70.3004 4254,.1003 4816,.1003 4816,-70.3004"/>
<text text-anchor="middle" x="4535" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4535" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4535" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_69&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>raw_69&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4837.6886,-866.832C4865.8873,-774.4774 4981.802,-346.3259 4789,-106.2001 4778.9107,-93.6344 4755.1698,-82.6038 4726.0465,-73.214"/>
<polygon fill="#000000" stroke="#000000" points="4727.0003,-69.8454 4716.4122,-70.2232 4724.9249,-76.5307 4727.0003,-69.8454"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5354,-62.4005 4834,-62.4005 4834,-7.7996 5354,-7.7996 5354,-62.4005"/>
<text text-anchor="middle" x="5094" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5094" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5141.9539,-866.5632C5135.8446,-760.635 5104.755,-221.5794 5096.1882,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="5099.6582,-72.4186 5095.5882,-62.6367 5092.6698,-72.8217 5099.6582,-72.4186"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5426,-53.1 5372,-53.1 5372,-17.1 5426,-17.1 5426,-53.1"/>
<text text-anchor="middle" x="5399" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>prespace_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5332.7569,-866.5464C5336.4407,-780.9458 5353.7264,-409.1554 5388,-106.2001 5389.6016,-92.0433 5391.9597,-76.387 5394.0822,-63.3778"/>
<polygon fill="#000000" stroke="#000000" points="5397.5929,-63.6037 5395.788,-53.1637 5390.6885,-62.4506 5397.5929,-63.6037"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5509.5,-53.1 5444.5,-53.1 5444.5,-17.1 5509.5,-17.1 5509.5,-53.1"/>
<text text-anchor="middle" x="5477" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>literal_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5428.432,-866.5619C5430.5738,-781.0313 5441.049,-409.5083 5468,-106.2001 5469.2561,-92.0638 5471.1796,-76.4098 5472.9263,-63.3967"/>
<polygon fill="#000000" stroke="#000000" points="5476.4365,-63.5623 5474.3335,-53.1783 5469.5019,-62.6073 5476.4365,-63.5623"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5796,-54.4006 5528,-54.4006 5528,-15.7995 5796,-15.7995 5796,-54.4006"/>
<text text-anchor="middle" x="5662" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5662" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>raw_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5502.5697,-866.7002C5494.6419,-762.7666 5459.2925,-239.4258 5540,-106.2001 5552.6148,-85.3766 5573.8026,-70.0093 5595.0134,-58.9987"/>
<polygon fill="#000000" stroke="#000000" points="5596.6488,-62.0949 5604.0802,-54.5434 5593.5617,-55.8124 5596.6488,-62.0949"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5868,-53.1 5814,-53.1 5814,-17.1 5868,-17.1 5868,-53.1"/>
<text text-anchor="middle" x="5841" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>prespace_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5593.5385,-866.6033C5585.4039,-760.9991 5549.6202,-224.9911 5651,-106.2001 5696.6294,-52.7342 5743.3552,-103.9723 5805,-70.2001 5809.8804,-67.5264 5814.5625,-64.0077 5818.8426,-60.2306"/>
<polygon fill="#000000" stroke="#000000" points="5821.288,-62.7347 5826.0683,-53.2795 5816.4351,-57.69 5821.288,-62.7347"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="5944,-53.1 5886,-53.1 5886,-17.1 5944,-17.1 5944,-53.1"/>
<text text-anchor="middle" x="5915" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>literal_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5689.1556,-866.6474C5678.7883,-761.2947 5631.6944,-226.4751 5731,-106.2001 5773.5511,-54.6639 5818.15,-101.8741 5877,-70.2001 5882.0415,-67.4867 5886.9286,-63.948 5891.4255,-60.1634"/>
<polygon fill="#000000" stroke="#000000" points="5894.0184,-62.5356 5899.0477,-53.2106 5889.301,-57.364 5894.0184,-62.5356"/>
</g>
<!-- leaf_84 -->
<g id="node85" class="node">
<title>leaf_84</title>
<polygon fill="none" stroke="#c0c0c0" points="6048,-53.1 5962,-53.1 5962,-17.1 6048,-17.1 6048,-53.1"/>
<text text-anchor="middle" x="6005" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_77&#45;&gt;leaf_84 -->
<g id="edge84" class="edge">
<title>raw_77&#45;&gt;leaf_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5765.0433,-866.6449C5754.0231,-761.278 5703.6542,-226.3913 5803,-106.2001 5846.6795,-53.3555 5890.2501,-97.8206 5953,-70.2001 5959.9222,-67.1532 5966.9149,-63.1768 5973.4307,-58.9993"/>
<polygon fill="#000000" stroke="#000000" points="5975.6313,-61.737 5981.9687,-53.2466 5971.7198,-55.9318 5975.6313,-61.737"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6600,-62.4005 6066,-62.4005 6066,-7.7996 6600,-7.7996 6600,-62.4005"/>
<text text-anchor="middle" x="6333" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6333" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_85&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>raw_85&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5836.8999,-866.5214C5825.0637,-760.4515 5770.8382,-222.2425 5875,-106.2001 5883.5356,-96.6909 5996.3899,-79.1101 6107.9239,-63.8105"/>
<polygon fill="#000000" stroke="#000000" points="6108.5818,-67.2532 6118.016,-62.4318 6107.6343,-60.3177 6108.5818,-67.2532"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="7072.5,-2022.4033 6881.5,-2022.4033 6881.5,-1986.4033 7072.5,-1986.4033 7072.5,-2022.4033"/>
<text text-anchor="middle" x="6977" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_88&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>header_88&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6977,-2393.1994C6977,-2329.0222 6977,-2111.1178 6977,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="6980.5001,-2032.6615 6977,-2022.6616 6973.5001,-2032.6616 6980.5001,-2032.6615"/>
</g>
<!-- raw_94 -->
<g id="node95" class="node">
<title>raw_94</title>
<ellipse fill="none" stroke="#000000" cx="7127" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="7127" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_94 -->
<g id="edge94" class="edge">
<title>prose_89&#45;&gt;raw_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7134.6459,-2393.1994C7133.3838,-2329.0222 7129.0986,-2111.1178 7127.5577,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="7131.0551,-2032.5908 7127.3591,-2022.6616 7124.0565,-2032.7285 7131.0551,-2032.5908"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="7217" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_90&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-2393.1994C7217,-2329.0222 7217,-2111.1178 7217,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-2032.6615 7217,-2022.6616 7213.5001,-2032.6616 7220.5001,-2032.6615"/>
</g>
<!-- header_98 -->
<g id="node99" class="node">
<title>header_98</title>
<ellipse fill="none" stroke="#000000" cx="7655" cy="-2004.4033" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7655" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_91&#45;&gt;header_98 -->
<g id="edge98" class="edge">
<title>section_91&#45;&gt;header_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7796.3526,-2392.9438C7787.9307,-2372.6784 7774.1099,-2338.9563 7763,-2309.6039 7724.495,-2207.8734 7682.4866,-2085.535 7664.2767,-2031.8839"/>
<polygon fill="#000000" stroke="#000000" points="7667.584,-2030.7382 7661.0597,-2022.3904 7660.9543,-2032.9848 7667.584,-2030.7382"/>
</g>
<!-- prose_99 -->
<g id="node100" class="node">
<title>prose_99</title>
<ellipse fill="none" stroke="#000000" cx="7804" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7804" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_99 -->
<g id="edge99" class="edge">
<title>section_91&#45;&gt;prose_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7804,-2393.1994C7804,-2329.0222 7804,-2111.1178 7804,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="7807.5001,-2032.6615 7804,-2022.6616 7800.5001,-2032.6616 7807.5001,-2032.6615"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8191" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_91&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7820.8778,-2393.4627C7882.9198,-2328.2463 8098.3898,-2101.7518 8168.6546,-2027.892"/>
<polygon fill="#000000" stroke="#000000" points="8171.3858,-2030.099 8175.7426,-2020.4414 8166.3142,-2025.2742 8171.3858,-2030.099"/>
</g>
<!-- codeblock_101 -->
<g id="node102" class="node">
<title>codeblock_101</title>
<ellipse fill="none" stroke="#000000" cx="8525" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8525" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 301&#45;315</text>
</g>
<!-- section_91&#45;&gt;codeblock_101 -->
<g id="edge101" class="edge">
<title>section_91&#45;&gt;codeblock_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7877.1167,-2406.4418C7966.1972,-2397.9147 8118.7973,-2374.3338 8232,-2309.6039 8359.9711,-2236.4293 8467.3724,-2090.4078 8507.8033,-2030.7337"/>
<polygon fill="#000000" stroke="#000000" points="8510.8312,-2032.5026 8513.4941,-2022.2479 8505.0175,-2028.6038 8510.8312,-2032.5026"/>
</g>
<!-- header_124 -->
<g id="node125" class="node">
<title>header_124</title>
<ellipse fill="none" stroke="#000000" cx="9145" cy="-2004.4033" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9145" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_92&#45;&gt;header_124 -->
<g id="edge124" class="edge">
<title>section_92&#45;&gt;header_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9331.3695,-2393.1994C9300.4803,-2328.7597 9195.2979,-2109.3327 9158.1359,-2031.8069"/>
<polygon fill="#000000" stroke="#000000" points="9161.2308,-2030.1662 9153.7521,-2022.6616 9154.9186,-2033.192 9161.2308,-2030.1662"/>
</g>
<!-- prose_125 -->
<g id="node126" class="node">
<title>prose_125</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9340" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_125 -->
<g id="edge125" class="edge">
<title>section_92&#45;&gt;prose_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340,-2393.1994C9340,-2329.0222 9340,-2111.1178 9340,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="9343.5001,-2032.6615 9340,-2022.6616 9336.5001,-2032.6616 9343.5001,-2032.6615"/>
</g>
<!-- prose_126 -->
<g id="node127" class="node">
<title>prose_126</title>
<ellipse fill="none" stroke="#000000" cx="9455" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9455" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_126 -->
<g id="edge126" class="edge">
<title>section_92&#45;&gt;prose_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9348.2215,-2393.1444C9357.1459,-2373.0547 9371.4045,-2339.4857 9381,-2309.6039 9413.1927,-2209.3513 9438.9276,-2086.6657 9449.627,-2032.4486"/>
<polygon fill="#000000" stroke="#000000" points="9453.0793,-2033.0309 9451.5638,-2022.545 9446.2095,-2031.6873 9453.0793,-2033.0309"/>
</g>
<!-- codeblock_127 -->
<g id="node128" class="node">
<title>codeblock_127</title>
<ellipse fill="none" stroke="#000000" cx="9712" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9712" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 327&#45;370</text>
</g>
<!-- section_92&#45;&gt;codeblock_127 -->
<g id="edge127" class="edge">
<title>section_92&#45;&gt;codeblock_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9372.391,-2394.8521C9405.8201,-2376.9492 9458.2681,-2345.9061 9496,-2309.6039 9588.1996,-2220.8979 9666.4653,-2087.8713 9697.6001,-2031.3519"/>
<polygon fill="#000000" stroke="#000000" points="9700.8034,-2032.7885 9702.524,-2022.3343 9694.6596,-2029.4337 9700.8034,-2032.7885"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6921.5,-920.0018 6408.5,-920.0018 6408.5,-849.4011 6921.5,-849.4011 6921.5,-920.0018"/>
<text text-anchor="middle" x="6665" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6665" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_94&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_94&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7130.4532,-1986.4078C7139.3166,-1934.3528 7157.1396,-1782.0597 7081,-1699.2027 7034.318,-1648.4022 6981.0241,-1709.6402 6930,-1663.2027 6707.6834,-1460.8707 6671.8031,-1064.7546 6666.0702,-930.4746"/>
<polygon fill="#000000" stroke="#000000" points="6669.5547,-930.0063 6665.6677,-920.1503 6662.56,-930.2791 6669.5547,-930.0063"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="7494.5,-927.9017 6939.5,-927.9017 6939.5,-841.5011 7494.5,-841.5011 7494.5,-927.9017"/>
<text text-anchor="middle" x="7217" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7217" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7217" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-1986.3619C7217,-1862.9127 7217,-1141.6682 7217,-938.1514"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-938.0111 7217,-928.0112 7213.5001,-938.0112 7220.5001,-938.0111"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7619.5,-902.7014 7512.5,-902.7014 7512.5,-866.7014 7619.5,-866.7014 7619.5,-902.7014"/>
<text text-anchor="middle" x="7566" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_98&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>header_98&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7653.566,-1986.3619C7643.2936,-1857.1254 7580.9456,-1072.7313 7568.2539,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="7571.7404,-912.7471 7567.4589,-903.0559 7564.7624,-913.3019 7571.7404,-912.7471"/>
</g>
<!-- raw_103 -->
<g id="node104" class="node">
<title>raw_103</title>
<ellipse fill="none" stroke="#000000" cx="7665" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7665" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_103 -->
<g id="edge103" class="edge">
<title>prose_99&#45;&gt;raw_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7800.8815,-1986.3116C7792.226,-1938.2229 7765.6264,-1803.7634 7722,-1699.2027 7714.8674,-1682.1078 7706.246,-1680.9676 7701,-1663.2027 7617.6287,-1380.8781 7649.9672,-1016.1203 7661.5543,-912.9755"/>
<polygon fill="#000000" stroke="#000000" points="7665.0637,-913.0942 7662.7316,-902.7592 7658.1097,-912.2927 7665.0637,-913.0942"/>
</g>
<!-- prespace_104 -->
<g id="node105" class="node">
<title>prespace_104</title>
<ellipse fill="none" stroke="#000000" cx="7756" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7756" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_104 -->
<g id="edge104" class="edge">
<title>prose_99&#45;&gt;prespace_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7803.2266,-1986.3619C7797.6864,-1857.1254 7764.0606,-1072.7313 7757.2156,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="7760.712,-912.8968 7756.7868,-903.0559 7753.7184,-913.1967 7760.712,-912.8968"/>
</g>
<!-- literal_105 -->
<g id="node106" class="node">
<title>literal_105</title>
<ellipse fill="none" stroke="#000000" cx="7852" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7852" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_105 -->
<g id="edge105" class="edge">
<title>prose_99&#45;&gt;literal_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7804.7734,-1986.3619C7810.3136,-1857.1254 7843.9394,-1072.7313 7850.7844,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="7854.2816,-913.1967 7851.2132,-903.0559 7847.288,-912.8968 7854.2816,-913.1967"/>
</g>
<!-- raw_106 -->
<g id="node107" class="node">
<title>raw_106</title>
<ellipse fill="none" stroke="#000000" cx="7928" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7928" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_106 -->
<g id="edge106" class="edge">
<title>prose_99&#45;&gt;raw_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7810.005,-1986.5493C7826.5856,-1936.3387 7873.0262,-1789.3328 7892,-1663.2027 7935.6935,-1372.7462 7931.1704,-1015.0752 7928.786,-913.0585"/>
<polygon fill="#000000" stroke="#000000" points="7932.2821,-912.8513 7928.5363,-902.9407 7925.2842,-913.0241 7932.2821,-912.8513"/>
</g>
<!-- prespace_111 -->
<g id="node112" class="node">
<title>prespace_111</title>
<ellipse fill="none" stroke="#000000" cx="8019" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8019" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_111 -->
<g id="edge111" class="edge">
<title>prose_100&#45;&gt;prespace_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8183.1748,-1986.7276C8161.5529,-1936.9792 8100.8862,-1791.0587 8075,-1663.2027 8016.561,-1374.5632 8016.9855,-1014.9267 8018.4471,-912.8658"/>
<polygon fill="#000000" stroke="#000000" points="8021.9484,-912.8057 8018.6082,-902.7512 8014.9493,-912.6941 8021.9484,-912.8057"/>
</g>
<!-- literal_112 -->
<g id="node113" class="node">
<title>literal_112</title>
<ellipse fill="none" stroke="#000000" cx="8115" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8115" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_112 -->
<g id="edge112" class="edge">
<title>prose_100&#45;&gt;literal_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8188.7442,-1986.31C8182.4817,-1935.479 8164.7055,-1787.016 8155,-1663.2027 8132.0401,-1370.3032 8119.2559,-1014.3326 8115.9001,-912.8891"/>
<polygon fill="#000000" stroke="#000000" points="8119.3962,-912.7094 8115.5708,-902.8293 8112.3999,-912.9385 8119.3962,-912.7094"/>
</g>
<!-- raw_113 -->
<g id="node114" class="node">
<title>raw_113</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8191" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_113 -->
<g id="edge113" class="edge">
<title>prose_100&#45;&gt;raw_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191,-1986.3619C8191,-1857.1254 8191,-1072.7313 8191,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="8194.5001,-913.0559 8191,-903.0559 8187.5001,-913.056 8194.5001,-913.0559"/>
</g>
<!-- prespace_114 -->
<g id="node115" class="node">
<title>prespace_114</title>
<ellipse fill="none" stroke="#000000" cx="8282" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8282" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_114 -->
<g id="edge114" class="edge">
<title>prose_100&#45;&gt;prespace_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8193.1332,-1986.2998C8199.0775,-1935.4423 8216.1066,-1786.9171 8227,-1663.2027 8252.8002,-1370.1941 8274.3943,-1014.2994 8280.3625,-912.8816"/>
<polygon fill="#000000" stroke="#000000" points="8283.8608,-913.0121 8280.9521,-902.8244 8276.8728,-912.6024 8283.8608,-913.0121"/>
</g>
<!-- literal_115 -->
<g id="node116" class="node">
<title>literal_115</title>
<ellipse fill="none" stroke="#000000" cx="8378" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8378" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_115 -->
<g id="edge115" class="edge">
<title>prose_100&#45;&gt;literal_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8201.0715,-1987.0367C8228.8622,-1938.0897 8306.5736,-1794.0513 8337,-1663.2027 8403.6202,-1376.7023 8386.6754,-1015.573 8380.0363,-913.0122"/>
<polygon fill="#000000" stroke="#000000" points="8383.516,-912.5911 8379.3561,-902.8471 8376.5316,-913.0585 8383.516,-912.5911"/>
</g>
<!-- raw_116 -->
<g id="node117" class="node">
<title>raw_116</title>
<ellipse fill="none" stroke="#000000" cx="8454" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8454" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_116 -->
<g id="edge116" class="edge">
<title>prose_100&#45;&gt;raw_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8206.4629,-1988.4131C8249.6993,-1942.5059 8371.6997,-1804.5104 8418,-1663.2027 8509.7524,-1383.176 8471.4438,-1016.1531 8457.965,-912.8357"/>
<polygon fill="#000000" stroke="#000000" points="8461.4275,-912.3216 8456.6342,-902.8731 8454.4891,-913.2485 8461.4275,-912.3216"/>
</g>
<!-- leaf_123 -->
<g id="node124" class="node">
<title>leaf_123</title>
<polygon fill="none" stroke="#c0c0c0" points="8942.5,-981.6022 8499.5,-981.6022 8499.5,-787.8007 8942.5,-787.8007 8942.5,-981.6022"/>
<text text-anchor="middle" x="8721" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8721" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8721" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8721" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8721" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8721" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8721" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8721" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8721" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8721" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8721" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_101&#45;&gt;leaf_123 -->
<g id="edge123" class="edge">
<title>codeblock_101&#45;&gt;leaf_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8528.1581,-1986.3619C8548.1648,-1872.068 8657.8681,-1245.3591 8702.3019,-991.5191"/>
<polygon fill="#000000" stroke="#000000" points="8705.7707,-992.0009 8704.0475,-981.5472 8698.8756,-990.7939 8705.7707,-992.0009"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7401.5,-63.0015 7112.5,-63.0015 7112.5,-7.1986 7401.5,-7.1986 7401.5,-63.0015"/>
<text text-anchor="middle" x="7257" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>raw_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7667.0567,-866.5357C7678.6427,-760.5472 7731.6384,-222.7227 7628,-106.2001 7595.514,-69.6755 7458.962,-79.6356 7411,-70.2001 7402.594,-68.5464 7393.946,-66.7735 7385.2405,-64.9353"/>
<polygon fill="#000000" stroke="#000000" points="7385.9071,-61.4988 7375.3969,-62.8349 7384.4463,-68.3447 7385.9071,-61.4988"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7474,-53.1 7420,-53.1 7420,-17.1 7474,-17.1 7474,-53.1"/>
<text text-anchor="middle" x="7447" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>prespace_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7757.6018,-866.5035C7766.5384,-760.3313 7806.1596,-221.6392 7701,-106.2001 7634.8688,-33.6045 7570.6329,-114.5164 7483,-70.2001 7477.9367,-67.6396 7473.1238,-64.1165 7468.7605,-60.2847"/>
<polygon fill="#000000" stroke="#000000" points="7471.0551,-57.6347 7461.4352,-53.1953 7466.187,-62.6648 7471.0551,-57.6347"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="7546,-53.1 7492,-53.1 7492,-17.1 7546,-17.1 7546,-53.1"/>
<text text-anchor="middle" x="7519" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>literal_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7853.9977,-866.4902C7865.2347,-760.2426 7916.3911,-221.1942 7811,-106.2001 7733.3691,-21.4957 7658.1458,-120.8195 7555,-70.2001 7549.9064,-67.7004 7545.0786,-64.2072 7540.7099,-60.3862"/>
<polygon fill="#000000" stroke="#000000" points="7543.0044,-57.7362 7533.3839,-53.2982 7538.137,-62.767 7543.0044,-57.7362"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="7783.5,-54.4006 7564.5,-54.4006 7564.5,-15.7995 7783.5,-15.7995 7783.5,-54.4006"/>
<text text-anchor="middle" x="7674" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7674" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_106&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>raw_106&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7929.8451,-866.4177C7940.1076,-760.8946 7986.3746,-230.1203 7892,-106.2001 7887.3853,-100.1407 7810.3581,-75.9102 7749.1585,-57.4036"/>
<polygon fill="#000000" stroke="#000000" points="7750.0704,-54.023 7739.4857,-54.4862 7748.049,-60.7248 7750.0704,-54.023"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="7856,-53.1 7802,-53.1 7802,-17.1 7856,-17.1 7856,-53.1"/>
</g>
<!-- prespace_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>prespace_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8024.0908,-866.7515C8048.9892,-774.8733 8149.4286,-352.013 7964,-106.2001 7935.8048,-68.8232 7904.6487,-95.0996 7865,-70.2001 7860.4954,-67.3712 7856.0954,-63.9002 7852.0056,-60.2531"/>
<polygon fill="#000000" stroke="#000000" points="7854.222,-57.5297 7844.577,-53.1452 7849.3826,-62.5875 7854.222,-57.5297"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8037.5,-53.1 7874.5,-53.1 7874.5,-17.1 8037.5,-17.1 8037.5,-53.1"/>
<text text-anchor="middle" x="7956" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>literal_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116.2728,-866.7115C8123.2978,-762.8416 8154.1851,-239.7985 8074,-106.2001 8061.0762,-84.6674 8038.903,-68.8372 8017.242,-57.6541"/>
<polygon fill="#000000" stroke="#000000" points="8018.5394,-54.3925 8008.0185,-53.1427 8015.4637,-60.6806 8018.5394,-54.3925"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8400.5,-54.4006 8055.5,-54.4006 8055.5,-15.7995 8400.5,-15.7995 8400.5,-54.4006"/>
<text text-anchor="middle" x="8228" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8228" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>raw_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191.7899,-866.5632C8196.4958,-758.5056 8220.8303,-199.7321 8226.7169,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8230.2153,-64.6746 8227.1538,-54.5318 8223.2219,-64.37 8230.2153,-64.6746"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="8473,-53.1 8419,-53.1 8419,-17.1 8473,-17.1 8473,-53.1"/>
<text text-anchor="middle" x="8446" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>prespace_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8277.3644,-866.5557C8255.1962,-775.4379 8167.9041,-362.0821 8338,-106.2001 8357.5861,-76.7359 8380.0853,-90.5886 8409,-70.2001 8413.2332,-67.2152 8417.4637,-63.7616 8421.4719,-60.2093"/>
<polygon fill="#000000" stroke="#000000" points="8423.9057,-62.7256 8428.8477,-53.354 8419.1401,-57.5982 8423.9057,-62.7256"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="8545,-53.1 8491,-53.1 8491,-17.1 8545,-17.1 8545,-53.1"/>
<text text-anchor="middle" x="8518" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_115&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>literal_115&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8376.6413,-866.676C8369.1294,-762.6063 8335.9171,-238.6287 8418,-106.2001 8435.1936,-78.4608 8455.8732,-89.7571 8482,-70.2001 8485.9832,-67.2185 8489.9774,-63.8245 8493.7802,-60.3496"/>
<polygon fill="#000000" stroke="#000000" points="8496.4405,-62.6486 8501.2523,-53.2095 8491.6044,-57.5877 8496.4405,-62.6486"/>
</g>
<!-- leaf_122 -->
<g id="node123" class="node">
<title>leaf_122</title>
<polygon fill="none" stroke="#c0c0c0" points="8999,-54.4006 8563,-54.4006 8563,-15.7995 8999,-15.7995 8999,-54.4006"/>
<text text-anchor="middle" x="8781" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8781" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_116&#45;&gt;leaf_122 -->
<g id="edge122" class="edge">
<title>raw_116&#45;&gt;leaf_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8452.0506,-866.651C8441.0721,-761.3184 8390.9002,-226.5942 8490,-106.2001 8508.2778,-83.9948 8565.0792,-67.7053 8623.7052,-56.3646"/>
<polygon fill="#000000" stroke="#000000" points="8624.712,-59.7366 8633.8912,-54.4459 8623.4161,-52.8576 8624.712,-59.7366"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="9151.5,-902.7014 8960.5,-902.7014 8960.5,-866.7014 9151.5,-866.7014 9151.5,-902.7014"/>
<text text-anchor="middle" x="9056" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_124&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>header_124&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9143.566,-1986.3619C9133.2936,-1857.1254 9070.9456,-1072.7313 9058.2539,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="9061.7404,-912.7471 9057.4589,-903.0559 9054.7624,-913.3019 9061.7404,-912.7471"/>
</g>
<!-- raw_129 -->
<g id="node130" class="node">
<title>raw_129</title>
<ellipse fill="none" stroke="#000000" cx="9197" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9197" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_129 -->
<g id="edge129" class="edge">
<title>prose_125&#45;&gt;raw_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9336.5787,-1986.3209C9327.1322,-1938.2548 9298.4112,-1803.846 9254,-1699.2027 9246.7634,-1682.1516 9238.246,-1680.9676 9233,-1663.2027 9149.6287,-1380.8781 9181.9672,-1016.1203 9193.5543,-912.9755"/>
<polygon fill="#000000" stroke="#000000" points="9197.0637,-913.0942 9194.7316,-902.7592 9190.1097,-912.2927 9197.0637,-913.0942"/>
</g>
<!-- prespace_130 -->
<g id="node131" class="node">
<title>prespace_130</title>
<ellipse fill="none" stroke="#000000" cx="9288" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9288" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_125&#45;&gt;prespace_130 -->
<g id="edge130" class="edge">
<title>prose_125&#45;&gt;prespace_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9339.1621,-1986.3619C9333.1603,-1857.1254 9296.7323,-1072.7313 9289.3169,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="9292.8126,-912.8828 9288.8524,-903.0559 9285.8202,-913.2076 9292.8126,-912.8828"/>
</g>
<!-- literal_131 -->
<g id="node132" class="node">
<title>literal_131</title>
<ellipse fill="none" stroke="#000000" cx="9384" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9384" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_125&#45;&gt;literal_131 -->
<g id="edge131" class="edge">
<title>prose_125&#45;&gt;literal_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340.709,-1986.3619C9345.7875,-1857.1254 9376.6111,-1072.7313 9382.8857,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="9386.3833,-913.1857 9383.2787,-903.0559 9379.3887,-912.9108 9386.3833,-913.1857"/>
</g>
<!-- raw_132 -->
<g id="node133" class="node">
<title>raw_132</title>
<ellipse fill="none" stroke="#000000" cx="9460" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9460" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_132 -->
<g id="edge132" class="edge">
<title>prose_125&#45;&gt;raw_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9344.1311,-1986.4633C9355.0417,-1939.2874 9385.7334,-1807.9018 9414,-1699.2027 9418.1793,-1683.1314 9421.3777,-1679.6002 9424,-1663.2027 9470.3834,-1373.1636 9463.9881,-1015.2021 9460.9724,-913.0874"/>
<polygon fill="#000000" stroke="#000000" points="9464.4668,-912.8467 9460.659,-902.9598 9457.4701,-913.0633 9464.4668,-912.8467"/>
</g>
<!-- raw_137 -->
<g id="node138" class="node">
<title>raw_137</title>
<ellipse fill="none" stroke="#000000" cx="9532" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9532" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_126&#45;&gt;raw_137 -->
<g id="edge137" class="edge">
<title>prose_126&#45;&gt;raw_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9457.6469,-1986.3261C9464.9808,-1935.5367 9485.6994,-1787.1715 9496,-1663.2027 9520.3219,-1370.4869 9529.2817,-1014.3884 9531.4435,-912.9019"/>
<polygon fill="#000000" stroke="#000000" points="9534.944,-912.9085 9531.6531,-902.8377 9527.9455,-912.7626 9534.944,-912.9085"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="10083,-1212.8028 9577,-1212.8028 9577,-556.6001 10083,-556.6001 10083,-1212.8028"/>
<text text-anchor="middle" x="9830" y="-1197.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9830" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="9830" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9830" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="9830" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9830" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9830" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9830" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9830" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9830" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="9830" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="9830" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9830" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9830" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9830" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="9830" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9830" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="9830" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9830" y="-873.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="9830" y="-858.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9830" y="-843.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-827.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9830" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9830" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="9830" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9830" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return c.alert &quot;No results found&quot;</text>
<text text-anchor="middle" x="9830" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="9830" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="9830" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase</text>
<text text-anchor="middle" x="9830" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="9830" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="9830" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="9830" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-564.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_127&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>codeblock_127&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9713.9013,-1986.3619C9723.0894,-1899.1764 9763.7002,-1513.8206 9794.3217,-1223.2527"/>
<polygon fill="#000000" stroke="#000000" points="9797.8393,-1223.2687 9795.4067,-1212.957 9790.8779,-1222.535 9797.8393,-1223.2687"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9264.5,-63.0015 9017.5,-63.0015 9017.5,-7.1986 9264.5,-7.1986 9264.5,-63.0015"/>
<text text-anchor="middle" x="9141" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_129&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_129&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9197.5622,-866.4528C9199.9142,-780.4306 9206.7926,-407.028 9160,-106.2001 9158.2886,-95.1975 9155.5405,-83.4464 9152.6599,-72.7314"/>
<polygon fill="#000000" stroke="#000000" points="9155.9551,-71.5189 9149.887,-62.834 9149.2146,-73.4074 9155.9551,-71.5189"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9337,-53.1 9283,-53.1 9283,-17.1 9337,-17.1 9337,-53.1"/>
<text text-anchor="middle" x="9310" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_130&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>prespace_130&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9288.4697,-866.5632C9291.2741,-758.2631 9305.8019,-197.2221 9309.2604,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9312.7652,-63.5166 9309.5254,-53.4293 9305.7676,-63.3353 9312.7652,-63.5166"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9413,-53.1 9355,-53.1 9355,-17.1 9413,-17.1 9413,-53.1"/>
<text text-anchor="middle" x="9384" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>literal_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9384,-866.5632C9384,-758.2631 9384,-197.2221 9384,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9387.5001,-63.4293 9384,-53.4293 9380.5001,-63.4293 9387.5001,-63.4293"/>
</g>
<!-- leaf_136 -->
<g id="node137" class="node">
<title>leaf_136</title>
<polygon fill="none" stroke="#c0c0c0" points="9958.5,-62.3005 9431.5,-62.3005 9431.5,-7.8996 9958.5,-7.8996 9958.5,-62.3005"/>
<text text-anchor="middle" x="9695" y="-47.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9695" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9695" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_132&#45;&gt;leaf_136 -->
<g id="edge136" class="edge">
<title>raw_132&#45;&gt;leaf_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9458.2076,-866.4573C9448.2418,-761.1569 9403.3621,-231.4239 9496,-106.2001 9507.0161,-91.309 9540.3028,-77.1033 9576.5773,-65.359"/>
<polygon fill="#000000" stroke="#000000" points="9577.8774,-68.6189 9586.3598,-62.2708 9575.77,-61.9437 9577.8774,-68.6189"/>
</g>
<!-- leaf_138 -->
<g id="node139" class="node">
<title>leaf_138</title>
<polygon fill="none" stroke="#c0c0c0" points="10489.5,-62.4005 9976.5,-62.4005 9976.5,-7.7996 10489.5,-7.7996 10489.5,-62.4005"/>
<text text-anchor="middle" x="10233" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10233" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_137&#45;&gt;leaf_138 -->
<g id="edge138" class="edge">
<title>raw_137&#45;&gt;leaf_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9529.791,-866.4204C9517.3344,-759.7754 9460.1772,-218.8489 9568,-106.2001 9598.7794,-74.0431 9922.7585,-75.1128 9967,-70.2001 9985.0519,-68.1956 10003.7758,-65.9874 10022.5481,-63.684"/>
<polygon fill="#000000" stroke="#000000" points="10023.1752,-67.1333 10032.6707,-62.4336 10022.317,-60.1861 10023.1752,-67.1333"/>
</g>
<!-- leaf_148 -->
<g id="node149" class="node">
<title>leaf_148</title>
<polygon fill="none" stroke="#c0c0c0" points="10377.5,-2022.4033 10186.5,-2022.4033 10186.5,-1986.4033 10377.5,-1986.4033 10377.5,-2022.4033"/>
<text text-anchor="middle" x="10282" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_140&#45;&gt;leaf_148 -->
<g id="edge148" class="edge">
<title>header_140&#45;&gt;leaf_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10363.238,-2393.1994C10349.8283,-2329.0222 10304.2977,-2111.1178 10287.9253,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="10291.2864,-2031.7343 10285.815,-2022.6616 10284.4344,-2033.166 10291.2864,-2031.7343"/>
</g>
<!-- raw_149 -->
<g id="node150" class="node">
<title>raw_149</title>
<ellipse fill="none" stroke="#000000" cx="10423" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="10423" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_149 -->
<g id="edge149" class="edge">
<title>prose_141&#45;&gt;raw_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10582.8667,-2401.3018C10547.7912,-2386.9496 10487.8061,-2356.8026 10459,-2309.6039 10404.6872,-2220.6125 10412.3141,-2089.6557 10418.9674,-2032.6479"/>
<polygon fill="#000000" stroke="#000000" points="10422.4586,-2032.9347 10420.2248,-2022.5781 10415.5126,-2032.0673 10422.4586,-2032.9347"/>
</g>
<!-- prespace_150 -->
<g id="node151" class="node">
<title>prespace_150</title>
<ellipse fill="none" stroke="#000000" cx="10514" cy="-2004.4033" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10514" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_141&#45;&gt;prespace_150 -->
<g id="edge150" class="edge">
<title>prose_141&#45;&gt;prespace_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10601.8497,-2393.5804C10592.8966,-2373.5987 10578.6439,-2339.8615 10570,-2309.6039 10541.4815,-2209.7763 10524.1642,-2087.2836 10517.3457,-2032.828"/>
<polygon fill="#000000" stroke="#000000" points="10520.779,-2032.0701 10516.0857,-2022.5715 10513.8312,-2032.9237 10520.779,-2032.0701"/>
</g>
<!-- literal_151 -->
<g id="node152" class="node">
<title>literal_151</title>
<ellipse fill="none" stroke="#000000" cx="10610" cy="-2004.4033" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10610" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_141&#45;&gt;literal_151 -->
<g id="edge151" class="edge">
<title>prose_141&#45;&gt;literal_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10610,-2393.1994C10610,-2329.0222 10610,-2111.1178 10610,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="10613.5001,-2032.6615 10610,-2022.6616 10606.5001,-2032.6616 10613.5001,-2032.6615"/>
</g>
<!-- raw_152 -->
<g id="node153" class="node">
<title>raw_152</title>
<ellipse fill="none" stroke="#000000" cx="10687" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="10687" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_152 -->
<g id="edge152" class="edge">
<title>prose_141&#45;&gt;raw_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10618.493,-2393.6727C10627.7531,-2373.7737 10642.2801,-2340.1104 10650,-2309.6039 10675.235,-2209.8832 10683.4445,-2087.3365 10685.9611,-2032.8476"/>
<polygon fill="#000000" stroke="#000000" points="10689.4695,-2032.7261 10686.4039,-2022.5845 10682.476,-2032.4244 10689.4695,-2032.7261"/>
</g>
<!-- raw_157 -->
<g id="node158" class="node">
<title>raw_157</title>
<ellipse fill="none" stroke="#000000" cx="11023" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11023" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_142&#45;&gt;raw_157 -->
<g id="edge157" class="edge">
<title>prose_142&#45;&gt;raw_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11054.5395,-2393.1994C11049.3333,-2329.0222 11031.6568,-2111.1178 11025.3004,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11028.7783,-2032.3458 11024.4811,-2022.6616 11021.8012,-2032.9118 11028.7783,-2032.3458"/>
</g>
<!-- raw_159 -->
<g id="node160" class="node">
<title>raw_159</title>
<ellipse fill="none" stroke="#000000" cx="11214" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11214" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_143&#45;&gt;raw_159 -->
<g id="edge159" class="edge">
<title>prose_143&#45;&gt;raw_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11204.4426,-2393.1994C11206.0202,-2329.0222 11211.3767,-2111.1178 11213.3029,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11216.8043,-2032.7446 11213.5512,-2022.6616 11209.8064,-2032.5725 11216.8043,-2032.7446"/>
</g>
<!-- raw_161 -->
<g id="node162" class="node">
<title>raw_161</title>
<ellipse fill="none" stroke="#000000" cx="11296" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11296" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_144&#45;&gt;raw_161 -->
<g id="edge161" class="edge">
<title>prose_144&#45;&gt;raw_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11286.4426,-2393.1994C11288.0202,-2329.0222 11293.3767,-2111.1178 11295.3029,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11298.8043,-2032.7446 11295.5512,-2022.6616 11291.8064,-2032.5725 11298.8043,-2032.7446"/>
</g>
<!-- raw_163 -->
<g id="node164" class="node">
<title>raw_163</title>
<ellipse fill="none" stroke="#000000" cx="11373" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11373" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_145&#45;&gt;raw_163 -->
<g id="edge163" class="edge">
<title>prose_145&#45;&gt;raw_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11368.2213,-2393.1994C11369.0101,-2329.0222 11371.6884,-2111.1178 11372.6515,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11376.1523,-2032.7038 11372.7756,-2022.6616 11369.1529,-2032.6177 11376.1523,-2032.7038"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="11450" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="11450" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_146&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_146&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11450,-2393.1994C11450,-2329.0222 11450,-2111.1178 11450,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="11453.5001,-2032.6615 11450,-2022.6616 11446.5001,-2032.6616 11453.5001,-2032.6615"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="12050.5,-2309.8046 11495.5,-2309.8046 11495.5,-1699.0021 12050.5,-1699.0021 12050.5,-2309.8046"/>
<text text-anchor="middle" x="11773" y="-2278.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="11773" y="-2263.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="11773" y="-2247.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="11773" y="-2232.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if frag == &quot;&quot; then</text>
<text text-anchor="middle" x="11773" y="-2216.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return collection, false</text>
<text text-anchor="middle" x="11773" y="-2201.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-2186.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="11773" y="-2170.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="11773" y="-2155.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="11773" y="-2139.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function addTo(index)</text>
<text text-anchor="middle" x="11773" y="-2124.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-2093.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11773" y="-2077.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11773" y="-2062.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11773" y="-2046.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11773" y="-2015.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11773" y="-2000.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1969.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="11773" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="11773" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="11773" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="11773" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="11773" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="11773" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11773" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11773" y="-1846.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11773" y="-1830.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11773" y="-1815.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11773" y="-1799.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1784.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1769.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11773" y="-1753.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="11773" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="11773" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="11773" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_147&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>codeblock_147&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11685.0718,-2393.1994C11688.7433,-2376.9651 11694.6394,-2350.8938 11701.6866,-2319.7329"/>
<polygon fill="#000000" stroke="#000000" points="11705.1173,-2320.4299 11703.9095,-2309.9041 11698.2898,-2318.8857 11705.1173,-2320.4299"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="10467,-912.6029 10101,-912.6029 10101,-856.7999 10467,-856.7999 10467,-912.6029"/>
<text text-anchor="middle" x="10284" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_149&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>raw_149&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10420.8147,-1986.168C10415.1348,-1938.8175 10399.4149,-1808.0632 10386,-1699.2027 10349.111,-1399.8529 10303.5013,-1038.7688 10288.8032,-922.6258"/>
<polygon fill="#000000" stroke="#000000" points="10292.2463,-921.9552 10287.5182,-912.4739 10285.3017,-922.8343 10292.2463,-921.9552"/>
</g>
<!-- leaf_154 -->
<g id="node155" class="node">
<title>leaf_154</title>
<polygon fill="none" stroke="#c0c0c0" points="10539,-902.7014 10485,-902.7014 10485,-866.7014 10539,-866.7014 10539,-902.7014"/>
<text text-anchor="middle" x="10512" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_150&#45;&gt;leaf_154 -->
<g id="edge154" class="edge">
<title>prespace_150&#45;&gt;leaf_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10513.9678,-1986.3619C10513.7369,-1857.1254 10512.3359,-1072.7313 10512.0506,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="10515.5507,-913.0496 10512.0328,-903.0559 10508.5508,-913.0622 10515.5507,-913.0496"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="10643,-902.7014 10557,-902.7014 10557,-866.7014 10643,-866.7014 10643,-902.7014"/>
<text text-anchor="middle" x="10600" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_151&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>literal_151&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10609.8389,-1986.3619C10608.6847,-1857.1254 10601.6793,-1072.7313 10600.2532,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="10603.7532,-913.0242 10600.1639,-903.0559 10596.7535,-913.0868 10603.7532,-913.0242"/>
</g>
<!-- leaf_156 -->
<g id="node157" class="node">
<title>leaf_156</title>
<polygon fill="none" stroke="#c0c0c0" points="10715,-902.7014 10661,-902.7014 10661,-866.7014 10715,-866.7014 10715,-902.7014"/>
<text text-anchor="middle" x="10688" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_152&#45;&gt;leaf_156 -->
<g id="edge156" class="edge">
<title>raw_152&#45;&gt;leaf_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10687.0161,-1986.3619C10687.1315,-1857.1254 10687.8321,-1072.7313 10687.9747,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="10691.4746,-913.0591 10687.9836,-903.0559 10684.4746,-913.0528 10691.4746,-913.0591"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11246.5,-904.6035 10733.5,-904.6035 10733.5,-864.7993 11246.5,-864.7993 11246.5,-904.6035"/>
<text text-anchor="middle" x="10990" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_157&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>raw_157&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11022.4683,-1986.3619C11018.6756,-1857.6754 10995.738,-1079.3951 10990.8968,-915.1297"/>
<polygon fill="#000000" stroke="#000000" points="10994.3854,-914.687 10990.5922,-904.7945 10987.3884,-914.8933 10994.3854,-914.687"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11427.5,-904.6035 11264.5,-904.6035 11264.5,-864.7993 11427.5,-864.7993 11427.5,-904.6035"/>
<text text-anchor="middle" x="11346" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_159&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_159&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11216.1985,-1986.2809C11222.3698,-1935.3743 11240.3582,-1786.734 11255,-1663.2027 11289.5738,-1371.5082 11330.5426,-1018.2189 11342.54,-914.603"/>
<polygon fill="#000000" stroke="#000000" points="11346.03,-914.8904 11343.7033,-904.5542 11339.0764,-914.0854 11346.03,-914.8904"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="11972.5,-919.9018 11445.5,-919.9018 11445.5,-849.501 11972.5,-849.501 11972.5,-919.9018"/>
<text text-anchor="middle" x="11709" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11709" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11709" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_161&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>raw_161&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11292.615,-1986.4883C11284.0273,-1935.2943 11266.7665,-1786.4494 11337,-1699.2027 11366.3585,-1662.7325 11403.0849,-1696.4984 11436,-1663.2027 11647.5152,-1449.2419 11695.7244,-1062.2439 11706.2153,-930.2416"/>
<polygon fill="#000000" stroke="#000000" points="11709.7191,-930.3233 11706.9872,-920.0868 11702.7393,-929.7927 11709.7191,-930.3233"/>
</g>
<!-- leaf_164 -->
<g id="node165" class="node">
<title>leaf_164</title>
<polygon fill="none" stroke="#c0c0c0" points="12419.5,-904.6035 11990.5,-904.6035 11990.5,-864.7993 12419.5,-864.7993 12419.5,-904.6035"/>
<text text-anchor="middle" x="12205" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection</text>
</g>
<!-- raw_163&#45;&gt;leaf_164 -->
<g id="edge164" class="edge">
<title>raw_163&#45;&gt;leaf_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11368.7065,-1986.5577C11357.1388,-1933.5788 11331.4873,-1776.1226 11414,-1699.2027 11506.3498,-1613.1126 11882.5924,-1742.2972 11981,-1663.2027 12222.3063,-1469.2543 12214.2484,-1033.2368 12207.252,-914.8508"/>
<polygon fill="#000000" stroke="#000000" points="12210.7348,-914.4668 12206.6075,-904.709 12203.7489,-914.9109 12210.7348,-914.4668"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="12944,-912.0018 12438,-912.0018 12438,-857.401 12944,-857.401 12944,-912.0018"/>
<text text-anchor="middle" x="12691" y="-880.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="12691" y="-865.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_165&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_165&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11445.2806,-1986.5085C11432.4722,-1933.3921 11403.3071,-1775.5915 11486,-1699.2027 11562.9392,-1628.129 12344.0863,-1725.8893 12428,-1663.2027 12674.7881,-1478.843 12692.3684,-1051.6238 12691.8256,-922.3999"/>
<polygon fill="#000000" stroke="#000000" points="12695.324,-922.1908 12691.7415,-912.22 12688.3243,-922.2486 12695.324,-922.1908"/>
</g>
<!-- leaf_173 -->
<g id="node174" class="node">
<title>leaf_173</title>
<polygon fill="none" stroke="#c0c0c0" points="12846.5,-2022.4033 12697.5,-2022.4033 12697.5,-1986.4033 12846.5,-1986.4033 12846.5,-2022.4033"/>
<text text-anchor="middle" x="12772" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_168&#45;&gt;leaf_173 -->
<g id="edge173" class="edge">
<title>header_168&#45;&gt;leaf_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12781.5574,-2393.1994C12779.9798,-2329.0222 12774.6233,-2111.1178 12772.6971,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="12776.1936,-2032.5725 12772.4488,-2022.6616 12769.1957,-2032.7446 12776.1936,-2032.5725"/>
</g>
<!-- raw_174 -->
<g id="node175" class="node">
<title>raw_174</title>
<ellipse fill="none" stroke="#000000" cx="12892" cy="-2004.4033" rx="27" ry="18"/>
<text text-anchor="middle" x="12892" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_169&#45;&gt;raw_174 -->
<g id="edge174" class="edge">
<title>prose_169&#45;&gt;raw_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12950.9852,-2393.4318C12944.3995,-2373.3168 12933.9816,-2339.4606 12928,-2309.6039 12907.8012,-2208.7829 12897.6119,-2086.7926 12893.8089,-2032.6459"/>
<polygon fill="#000000" stroke="#000000" points="12897.2859,-2032.1882 12893.1126,-2022.45 12890.3021,-2032.6652 12897.2859,-2032.1882"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="13317,-2105.7836 12937,-2105.7836 12937,-1903.023 13317,-1903.023 13317,-2105.7836"/>
<text text-anchor="middle" x="13127" y="-2090.6435" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="13127" y="-2075.2434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13127" y="-2059.8434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13127" y="-2044.4434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13127" y="-2029.0433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="13127" y="-2010.2833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="13127" y="-1991.5233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="13127" y="-1976.1233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13127" y="-1960.7233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="13127" y="-1941.9633" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13127" y="-1926.5632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="13127" y="-1911.1632" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_170&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>codeblock_170&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13106.9294,-2393.1994C13109.3865,-2345.6018 13116.2088,-2213.4454 13121.2198,-2116.3733"/>
<polygon fill="#000000" stroke="#000000" points="13124.7245,-2116.3716 13121.7448,-2106.2045 13117.7338,-2116.0107 13124.7245,-2116.3716"/>
</g>
<!-- header_177 -->
<g id="node178" class="node">
<title>header_177</title>
<ellipse fill="none" stroke="#000000" cx="13417" cy="-2004.4033" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="13417" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_171&#45;&gt;header_177 -->
<g id="edge177" class="edge">
<title>section_171&#45;&gt;header_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13542.0881,-2393.0403C13533.4346,-2372.8595 13519.4121,-2339.211 13509,-2309.6039 13473.5424,-2208.7793 13439.2246,-2086.3847 13424.5062,-2032.3451"/>
<polygon fill="#000000" stroke="#000000" points="13427.825,-2031.2103 13421.8293,-2022.4752 13421.069,-2033.0427 13427.825,-2031.2103"/>
</g>
<!-- prose_178 -->
<g id="node179" class="node">
<title>prose_178</title>
<ellipse fill="none" stroke="#000000" cx="13550" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13550" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_178 -->
<g id="edge178" class="edge">
<title>section_171&#45;&gt;prose_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13550,-2393.1994C13550,-2329.0222 13550,-2111.1178 13550,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="13553.5001,-2032.6615 13550,-2022.6616 13546.5001,-2032.6616 13553.5001,-2032.6615"/>
</g>
<!-- prose_179 -->
<g id="node180" class="node">
<title>prose_179</title>
<ellipse fill="none" stroke="#000000" cx="13665" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13665" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_179 -->
<g id="edge179" class="edge">
<title>section_171&#45;&gt;prose_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13558.2215,-2393.1444C13567.1459,-2373.0547 13581.4045,-2339.4857 13591,-2309.6039 13623.1927,-2209.3513 13648.9276,-2086.6657 13659.627,-2032.4486"/>
<polygon fill="#000000" stroke="#000000" points="13663.0793,-2033.0309 13661.5638,-2022.545 13656.2095,-2031.6873 13663.0793,-2033.0309"/>
</g>
<!-- codeblock_180 -->
<g id="node181" class="node">
<title>codeblock_180</title>
<ellipse fill="none" stroke="#000000" cx="13862" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13862" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 458&#45;482</text>
</g>
<!-- section_171&#45;&gt;codeblock_180 -->
<g id="edge180" class="edge">
<title>section_171&#45;&gt;codeblock_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13585.0841,-2395.109C13619.4374,-2377.9267 13671.5058,-2347.915 13706,-2309.6039 13784.1539,-2222.8019 13834.1705,-2089.6872 13853.2524,-2032.3074"/>
<polygon fill="#000000" stroke="#000000" points="13856.677,-2033.0955 13856.4553,-2022.5029 13850.023,-2030.9218 13856.677,-2033.0955"/>
</g>
<!-- header_193 -->
<g id="node194" class="node">
<title>header_193</title>
<ellipse fill="none" stroke="#000000" cx="14257" cy="-2004.4033" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="14257" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_172&#45;&gt;header_193 -->
<g id="edge193" class="edge">
<title>section_172&#45;&gt;header_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14455.7062,-2394.4405C14427.9343,-2376.6398 14386.1832,-2346.0684 14361,-2309.6039 14298.8397,-2219.5978 14270.9799,-2089.1753 14261.2739,-2032.4773"/>
<polygon fill="#000000" stroke="#000000" points="14264.7029,-2031.7597 14259.6192,-2022.4642 14257.7965,-2032.901 14264.7029,-2031.7597"/>
</g>
<!-- prose_194 -->
<g id="node195" class="node">
<title>prose_194</title>
<ellipse fill="none" stroke="#000000" cx="14402" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14402" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_194 -->
<g id="edge194" class="edge">
<title>section_172&#45;&gt;prose_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14475.1829,-2393.3187C14465.737,-2373.3815 14451.0243,-2339.9453 14443,-2309.6039 14416.6567,-2209.9947 14406.7406,-2087.3916 14403.4481,-2032.868"/>
<polygon fill="#000000" stroke="#000000" points="14406.926,-2032.3812 14402.8587,-2022.5982 14399.9375,-2032.7823 14406.926,-2032.3812"/>
</g>
<!-- prose_195 -->
<g id="node196" class="node">
<title>prose_195</title>
<ellipse fill="none" stroke="#000000" cx="14484" cy="-2004.4033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14484" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_195 -->
<g id="edge195" class="edge">
<title>section_172&#45;&gt;prose_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14484,-2393.1994C14484,-2329.0222 14484,-2111.1178 14484,-2032.7613"/>
<polygon fill="#000000" stroke="#000000" points="14487.5001,-2032.6615 14484,-2022.6616 14480.5001,-2032.6616 14487.5001,-2032.6615"/>
</g>
<!-- codeblock_196 -->
<g id="node197" class="node">
<title>codeblock_196</title>
<ellipse fill="none" stroke="#000000" cx="14679" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14679" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 491&#45;505</text>
</g>
<!-- section_172&#45;&gt;codeblock_196 -->
<g id="edge196" class="edge">
<title>section_172&#45;&gt;codeblock_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14492.6305,-2393.1994C14523.5197,-2328.7597 14628.7021,-2109.3327 14665.8641,-2031.8069"/>
<polygon fill="#000000" stroke="#000000" points="14669.0814,-2033.192 14670.2479,-2022.6616 14662.7692,-2030.1662 14669.0814,-2033.192"/>
</g>
<!-- codeblock_197 -->
<g id="node198" class="node">
<title>codeblock_197</title>
<ellipse fill="none" stroke="#000000" cx="14993" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14993" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 507&#45;514</text>
</g>
<!-- section_172&#45;&gt;codeblock_197 -->
<g id="edge197" class="edge">
<title>section_172&#45;&gt;codeblock_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14546.2915,-2400.9021C14609.0408,-2388.0569 14706.1701,-2361.197 14775,-2309.6039 14878.6454,-2231.9139 14952.8459,-2090.6785 14980.7796,-2031.5644"/>
<polygon fill="#000000" stroke="#000000" points="14983.9612,-2033.023 14985.0117,-2022.4803 14977.616,-2030.0668 14983.9612,-2033.023"/>
</g>
<!-- codeblock_198 -->
<g id="node199" class="node">
<title>codeblock_198</title>
<ellipse fill="none" stroke="#000000" cx="15307" cy="-2004.4033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15307" y="-2000.2033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 516&#45;518</text>
</g>
<!-- section_172&#45;&gt;codeblock_198 -->
<g id="edge198" class="edge">
<title>section_172&#45;&gt;codeblock_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14556.4925,-2405.9547C14697.1727,-2394.6605 15001.1034,-2364.5228 15089,-2309.6039 15199.3738,-2240.6409 15270.2858,-2093.3209 15296.0746,-2032.0373"/>
<polygon fill="#000000" stroke="#000000" points="15299.3773,-2033.2093 15299.9611,-2022.6306 15292.9077,-2030.5363 15299.3773,-2033.2093"/>
</g>
<!-- leaf_175 -->
<g id="node176" class="node">
<title>leaf_175</title>
<polygon fill="none" stroke="#c0c0c0" points="13016,-902.7014 12962,-902.7014 12962,-866.7014 13016,-866.7014 13016,-902.7014"/>
</g>
<!-- raw_174&#45;&gt;leaf_175 -->
<g id="edge175" class="edge">
<title>raw_174&#45;&gt;leaf_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12891.1387,-1986.1396C12889.4789,-1937.6297 12888.9614,-1802.2296 12928,-1699.2027 12934.9023,-1680.9869 12946.7505,-1681.6527 12953,-1663.2027 13047.5387,-1384.1044 13007.2755,-1016.4302 12993.1512,-912.8978"/>
<polygon fill="#000000" stroke="#000000" points="12996.6065,-912.3338 12991.757,-902.914 12989.6738,-913.302 12996.6065,-912.3338"/>
</g>
<!-- leaf_181 -->
<g id="node182" class="node">
<title>leaf_181</title>
<polygon fill="none" stroke="#c0c0c0" points="13302,-902.7014 13146,-902.7014 13146,-866.7014 13302,-866.7014 13302,-902.7014"/>
<text text-anchor="middle" x="13224" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_177&#45;&gt;leaf_181 -->
<g id="edge181" class="edge">
<title>header_177&#45;&gt;leaf_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13412.3169,-1986.3024C13399.8578,-1938.7381 13364.2291,-1806.4957 13326,-1699.2027 13320.1823,-1682.8749 13315.3394,-1679.9841 13311,-1663.2027 13237.0053,-1377.0494 13225.9439,-1015.6778 13224.2905,-913.036"/>
<polygon fill="#000000" stroke="#000000" points="13227.7878,-912.8115 13224.1447,-902.8627 13220.7885,-912.9119 13227.7878,-912.8115"/>
</g>
<!-- raw_182 -->
<g id="node183" class="node">
<title>raw_182</title>
<ellipse fill="none" stroke="#000000" cx="13347" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13347" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_178&#45;&gt;raw_182 -->
<g id="edge182" class="edge">
<title>prose_178&#45;&gt;raw_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13553.6057,-1986.2377C13562.7718,-1934.3746 13581.3424,-1783.9176 13508,-1699.2027 13470.1588,-1655.4939 13418.8243,-1708.5794 13383,-1663.2027 13289.206,-1544.399 13331.8659,-1038.5722 13344.1039,-913.0018"/>
<polygon fill="#000000" stroke="#000000" points="13347.6223,-912.9886 13345.1243,-902.6925 13340.6563,-912.2991 13347.6223,-912.9886"/>
</g>
<!-- prespace_183 -->
<g id="node184" class="node">
<title>prespace_183</title>
<ellipse fill="none" stroke="#000000" cx="13438" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13438" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_178&#45;&gt;prespace_183 -->
<g id="edge183" class="edge">
<title>prose_178&#45;&gt;prespace_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13548.9856,-1986.2288C13546.0033,-1938.487 13535.667,-1805.8528 13508,-1699.2027 13503.6892,-1682.5855 13497.769,-1679.9512 13494,-1663.2027 13429.3442,-1375.8919 13434.1074,-1015.3281 13437.0215,-912.9568"/>
<polygon fill="#000000" stroke="#000000" points="13440.5244,-912.9123 13437.3293,-902.8108 13433.5276,-912.7 13440.5244,-912.9123"/>
</g>
<!-- literal_184 -->
<g id="node185" class="node">
<title>literal_184</title>
<ellipse fill="none" stroke="#000000" cx="13534" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13534" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_178&#45;&gt;literal_184 -->
<g id="edge184" class="edge">
<title>prose_178&#45;&gt;literal_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13549.7422,-1986.3619C13547.8955,-1857.1254 13536.6869,-1072.7313 13534.4052,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="13537.9049,-913.0049 13534.2623,-903.0559 13530.9056,-913.105 13537.9049,-913.0049"/>
</g>
<!-- raw_185 -->
<g id="node186" class="node">
<title>raw_185</title>
<ellipse fill="none" stroke="#000000" cx="13610" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13610" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_178&#45;&gt;raw_185 -->
<g id="edge185" class="edge">
<title>prose_178&#45;&gt;raw_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13551.4281,-1986.2883C13555.4067,-1935.4009 13566.7961,-1786.8056 13574,-1663.2027 13591.0901,-1369.9758 13605.0833,-1014.2331 13608.9423,-912.8665"/>
<polygon fill="#000000" stroke="#000000" points="13612.4419,-912.9399 13609.3234,-902.8144 13605.4469,-912.6746 13612.4419,-912.9399"/>
</g>
<!-- raw_190 -->
<g id="node191" class="node">
<title>raw_190</title>
<ellipse fill="none" stroke="#000000" cx="13682" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13682" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_190 -->
<g id="edge190" class="edge">
<title>prose_179&#45;&gt;raw_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13665.2739,-1986.3619C13667.2361,-1857.1254 13679.1452,-1072.7313 13681.5695,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="13685.069,-913.108 13681.7213,-903.0559 13678.0698,-913.0016 13685.069,-913.108"/>
</g>
<!-- leaf_192 -->
<g id="node193" class="node">
<title>leaf_192</title>
<polygon fill="none" stroke="#c0c0c0" points="14115.4016,-1072.3422 13726.5984,-1072.3422 13726.5984,-697.0606 14115.4016,-697.0606 14115.4016,-1072.3422"/>
<text text-anchor="middle" x="13921" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="13921" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="13921" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13921" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="13921" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13921" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="13921" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13921" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13921" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13921" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="13921" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13921" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="13921" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="13921" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="13921" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="13921" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="13921" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13921" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_180&#45;&gt;leaf_192 -->
<g id="edge192" class="edge">
<title>codeblock_180&#45;&gt;leaf_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13862.9506,-1986.3619C13868.3412,-1884.0605 13895.3633,-1371.2351 13910.5661,-1082.716"/>
<polygon fill="#000000" stroke="#000000" points="13914.0707,-1082.7185 13911.1019,-1072.5482 13907.0804,-1082.3501 13914.0707,-1082.7185"/>
</g>
<!-- leaf_186 -->
<g id="node187" class="node">
<title>leaf_186</title>
<polygon fill="none" stroke="#c0c0c0" points="13359.5,-63.0015 12888.5,-63.0015 12888.5,-7.1986 13359.5,-7.1986 13359.5,-63.0015"/>
<text text-anchor="middle" x="13124" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_182&#45;&gt;leaf_186 -->
<g id="edge186" class="edge">
<title>raw_182&#45;&gt;leaf_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13348.7539,-866.4855C13358.503,-761.3436 13402.3695,-232.3524 13311,-106.2001 13300.7109,-91.9941 13269.4311,-77.93 13235.3259,-66.1073"/>
<polygon fill="#000000" stroke="#000000" points="13236.241,-62.7221 13225.6467,-62.8339 13233.9984,-69.3531 13236.241,-62.7221"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="13432,-53.1 13378,-53.1 13378,-17.1 13432,-17.1 13432,-53.1"/>
</g>
<!-- prespace_183&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>prespace_183&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13437.2955,-866.5632C13433.0889,-758.2631 13411.2971,-197.2221 13406.1093,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13409.5975,-63.2859 13405.7119,-53.4293 13402.6028,-63.5576 13409.5975,-63.2859"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13550,-53.1 13450,-53.1 13450,-17.1 13550,-17.1 13550,-53.1"/>
<text text-anchor="middle" x="13500" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_184&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>literal_184&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13533.2741,-866.5632C13528.9401,-758.2631 13506.4879,-197.2221 13501.143,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13504.6307,-63.2813 13500.7335,-53.4293 13497.6363,-63.5613 13504.6307,-63.2813"/>
</g>
<!-- leaf_189 -->
<g id="node190" class="node">
<title>leaf_189</title>
<polygon fill="none" stroke="#c0c0c0" points="13808,-53.1 13568,-53.1 13568,-17.1 13808,-17.1 13808,-53.1"/>
<text text-anchor="middle" x="13688" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_185&#45;&gt;leaf_189 -->
<g id="edge189" class="edge">
<title>raw_185&#45;&gt;leaf_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13607.6974,-866.6335C13597.2861,-779.9167 13558.7878,-398.5735 13646,-106.2001 13650.7281,-90.3494 13659.7253,-74.3445 13668.1832,-61.5439"/>
<polygon fill="#000000" stroke="#000000" points="13671.114,-63.4589 13673.8935,-53.2351 13665.345,-59.4941 13671.114,-63.4589"/>
</g>
<!-- leaf_191 -->
<g id="node192" class="node">
<title>leaf_191</title>
<polygon fill="none" stroke="#c0c0c0" points="14213.5,-55.0021 13826.5,-55.0021 13826.5,-15.198 14213.5,-15.198 14213.5,-55.0021"/>
<text text-anchor="middle" x="14020" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_190&#45;&gt;leaf_191 -->
<g id="edge191" class="edge">
<title>raw_190&#45;&gt;leaf_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13680.0356,-866.6385C13668.9714,-761.2351 13618.3945,-226.1761 13718,-106.2001 13730.0433,-91.6938 13819.2481,-71.7875 13897.6095,-56.7271"/>
<polygon fill="#000000" stroke="#000000" points="13898.4304,-60.1337 13907.5976,-54.8221 13897.1189,-53.2576 13898.4304,-60.1337"/>
</g>
<!-- leaf_199 -->
<g id="node200" class="node">
<title>leaf_199</title>
<polygon fill="none" stroke="#c0c0c0" points="14342,-902.7014 14172,-902.7014 14172,-866.7014 14342,-866.7014 14342,-902.7014"/>
<text text-anchor="middle" x="14257" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_193&#45;&gt;leaf_199 -->
<g id="edge199" class="edge">
<title>header_193&#45;&gt;leaf_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14257,-1986.3619C14257,-1857.1254 14257,-1072.7313 14257,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="14260.5001,-913.0559 14257,-903.0559 14253.5001,-913.056 14260.5001,-913.0559"/>
</g>
<!-- raw_200 -->
<g id="node201" class="node">
<title>raw_200</title>
<ellipse fill="none" stroke="#000000" cx="14394" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14394" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_194&#45;&gt;raw_200 -->
<g id="edge200" class="edge">
<title>prose_194&#45;&gt;raw_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14401.8711,-1986.3619C14400.9477,-1857.1254 14395.3434,-1072.7313 14394.2026,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="14397.7026,-913.0306 14394.1311,-903.0559 14390.7028,-913.0807 14397.7026,-913.0306"/>
</g>
<!-- raw_202 -->
<g id="node203" class="node">
<title>raw_202</title>
<ellipse fill="none" stroke="#000000" cx="14466" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14466" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_195&#45;&gt;raw_202 -->
<g id="edge202" class="edge">
<title>prose_195&#45;&gt;raw_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14483.71,-1986.3619C14481.6324,-1857.1254 14469.0227,-1072.7313 14466.4558,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="14469.9554,-912.9984 14466.2951,-903.0559 14462.9563,-913.1109 14469.9554,-912.9984"/>
</g>
<!-- leaf_204 -->
<g id="node205" class="node">
<title>leaf_204</title>
<polygon fill="none" stroke="#c0c0c0" points="14961,-988.9019 14511,-988.9019 14511,-780.5009 14961,-780.5009 14961,-988.9019"/>
<text text-anchor="middle" x="14736" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="14736" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="14736" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="14736" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="14736" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14736" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="14736" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="14736" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="14736" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="14736" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="14736" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14736" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="14736" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_196&#45;&gt;leaf_204 -->
<g id="edge204" class="edge">
<title>codeblock_196&#45;&gt;leaf_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14679.9184,-1986.3619C14685.6802,-1873.1783 14717.0228,-1257.4873 14730.1804,-999.0218"/>
<polygon fill="#000000" stroke="#000000" points="14733.6848,-999.021 14730.6979,-988.856 14726.6939,-998.6651 14733.6848,-999.021"/>
</g>
<!-- leaf_205 -->
<g id="node206" class="node">
<title>leaf_205</title>
<polygon fill="none" stroke="#c0c0c0" points="15247,-935.1024 14979,-935.1024 14979,-834.3004 15247,-834.3004 15247,-935.1024"/>
<text text-anchor="middle" x="15113" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="15113" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="15113" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="15113" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="15113" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15113" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_197&#45;&gt;leaf_205 -->
<g id="edge205" class="edge">
<title>codeblock_197&#45;&gt;leaf_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14994.9335,-1986.3619C15008.0138,-1864.3122 15083.7162,-1157.9445 15106.5087,-945.271"/>
<polygon fill="#000000" stroke="#000000" points="15109.9998,-945.5401 15107.5854,-935.2241 15103.0396,-944.7941 15109.9998,-945.5401"/>
</g>
<!-- leaf_206 -->
<g id="node207" class="node">
<title>leaf_206</title>
<polygon fill="none" stroke="#c0c0c0" points="15351,-902.7014 15265,-902.7014 15265,-866.7014 15351,-866.7014 15351,-902.7014"/>
<text text-anchor="middle" x="15308" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_198&#45;&gt;leaf_206 -->
<g id="edge206" class="edge">
<title>codeblock_198&#45;&gt;leaf_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15307.0161,-1986.3619C15307.1315,-1857.1254 15307.8321,-1072.7313 15307.9747,-913.0574"/>
<polygon fill="#000000" stroke="#000000" points="15311.4746,-913.0591 15307.9836,-903.0559 15304.4746,-913.0528 15311.4746,-913.0591"/>
</g>
<!-- leaf_201 -->
<g id="node202" class="node">
<title>leaf_201</title>
<polygon fill="none" stroke="#c0c0c0" points="14556,-63.0015 14232,-63.0015 14232,-7.1986 14556,-7.1986 14556,-63.0015"/>
<text text-anchor="middle" x="14394" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_200&#45;&gt;leaf_201 -->
<g id="edge201" class="edge">
<title>raw_200&#45;&gt;leaf_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14394,-866.5632C14394,-760.6464 14394,-221.6953 14394,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="14397.5001,-73.0758 14394,-63.0758 14390.5001,-73.0759 14397.5001,-73.0758"/>
</g>
<!-- leaf_203 -->
<g id="node204" class="node">
<title>leaf_203</title>
<polygon fill="none" stroke="#c0c0c0" points="14772,-55.0021 14574,-55.0021 14574,-15.198 14772,-15.198 14772,-55.0021"/>
<text text-anchor="middle" x="14673" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_202&#45;&gt;leaf_203 -->
<g id="edge203" class="edge">
<title>raw_202&#45;&gt;leaf_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14464.3052,-866.5276C14454.8888,-761.6229 14412.5782,-233.7404 14502,-106.2001 14508.6773,-96.6764 14562.4439,-75.2015 14607.9306,-58.3295"/>
<polygon fill="#000000" stroke="#000000" points="14609.3192,-61.548 14617.4914,-54.8051 14606.898,-54.98 14609.3192,-61.548"/>
</g>
</g>
</svg>
