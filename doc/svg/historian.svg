<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="6191pt" height="1849pt"
 viewBox="0.00 0.00 6191.30 1849.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1845.0027)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1845.0027 6187.2972,-1845.0027 6187.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1633" cy="-1823.0027" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1633" y="-1818.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 194</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1633" cy="-1751.0027" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1633" y="-1746.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;125</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1633,-1804.834C1633,-1797.1336 1633,-1787.977 1633,-1779.4193"/>
<polygon fill="#000000" stroke="#000000" points="1636.5001,-1779.4159 1633,-1769.4159 1629.5001,-1779.416 1636.5001,-1779.4159"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1215" cy="-1679.0027" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1215" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1572.7042,-1743.7736C1502.49,-1734.8834 1383.2056,-1718.3152 1282,-1697.0027 1277.2414,-1696.0006 1272.3173,-1694.8668 1267.3982,-1693.6679"/>
<polygon fill="#000000" stroke="#000000" points="1267.9151,-1690.1887 1257.3628,-1691.1367 1266.2031,-1696.9762 1267.9151,-1690.1887"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1323" cy="-1679.0027" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1323" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1574.0999,-1742.9239C1518.9772,-1734.489 1434.7444,-1719.3446 1364,-1697.0027 1361.7483,-1696.2915 1359.4538,-1695.4958 1357.1582,-1694.6454"/>
<polygon fill="#000000" stroke="#000000" points="1358.408,-1691.3758 1347.823,-1690.9197 1355.8133,-1697.8772 1358.408,-1691.3758"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1405" cy="-1679.0027" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1405" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1584.395,-1738.8616C1546.3163,-1728.8972 1492.2298,-1713.7421 1446,-1697.0027 1443.7798,-1696.1987 1441.5092,-1695.3322 1439.2315,-1694.4291"/>
<polygon fill="#000000" stroke="#000000" points="1440.5167,-1691.1732 1429.9385,-1690.5788 1437.8372,-1697.64 1440.5167,-1691.1732"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1487" cy="-1679.0027" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1487" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1600.9597,-1735.2019C1577.0983,-1723.4347 1544.6044,-1707.4103 1520.4189,-1695.4832"/>
<polygon fill="#000000" stroke="#000000" points="1521.7832,-1692.2536 1511.2664,-1690.9697 1518.6871,-1698.5317 1521.7832,-1692.2536"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1569" cy="-1679.0027" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1569" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1617.1798,-1733.2049C1609.1184,-1724.1358 1599.1979,-1712.9753 1590.4584,-1703.1433"/>
<polygon fill="#000000" stroke="#000000" points="1593.0204,-1700.7573 1583.7607,-1695.6085 1587.7885,-1705.4079 1593.0204,-1700.7573"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1697" cy="-1679.0027" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1697" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;19</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1648.8202,-1733.2049C1656.5126,-1724.5509 1665.8978,-1713.9926 1674.3344,-1704.5015"/>
<polygon fill="#000000" stroke="#000000" points="1677.1122,-1706.6446 1681.14,-1696.8452 1671.8803,-1701.994 1677.1122,-1706.6446"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="1902" cy="-1679.0027" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1902" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 21&#45;23</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1680.164,-1738.3788C1724.8509,-1726.418 1792.1983,-1708.392 1840.9616,-1695.3401"/>
<polygon fill="#000000" stroke="#000000" points="1842.0069,-1698.6836 1850.7619,-1692.7169 1840.197,-1691.9216 1842.0069,-1698.6836"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2186" cy="-1679.0027" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2186" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 26&#45;40</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1692.4432,-1743.2632C1795.5087,-1729.8442 2006.8349,-1702.3298 2116.5083,-1688.0504"/>
<polygon fill="#000000" stroke="#000000" points="2117.0119,-1691.5145 2126.4763,-1686.7526 2116.108,-1684.5731 2117.0119,-1691.5145"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="2975" cy="-1679.0027" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2975" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 41&#45;125</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1697.7274,-1747.5299C1920.0631,-1735.6014 2652.2223,-1696.3201 2895.5702,-1683.2642"/>
<polygon fill="#000000" stroke="#000000" points="2895.9526,-1686.7488 2905.7507,-1682.718 2895.5776,-1679.7588 2895.9526,-1686.7488"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="4118" cy="-1679.0027" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4118" y="-1674.8027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 126&#45;169</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1698.5087,-1749.1046C2043.041,-1739.1222 3644.1268,-1692.7326 4032.8146,-1681.4708"/>
<polygon fill="#000000" stroke="#000000" points="4032.972,-1684.9678 4042.8664,-1681.1796 4032.7692,-1677.9707 4032.972,-1684.9678"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1261.5,-1623.6026 1168.5,-1623.6026 1168.5,-1587.6026 1261.5,-1587.6026 1261.5,-1623.6026"/>
<text text-anchor="middle" x="1215" y="-1602.1026" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1215,-1660.8588C1215,-1652.7424 1215,-1642.9827 1215,-1633.9388"/>
<polygon fill="#000000" stroke="#000000" points="1218.5001,-1633.7921 1215,-1623.7921 1211.5001,-1633.7921 1218.5001,-1633.7921"/>
</g>
<!-- raw_13 -->
<g id="node14" class="node">
<title>raw_13</title>
<ellipse fill="none" stroke="#000000" cx="1308" cy="-1605.6026" rx="27" ry="18"/>
<text text-anchor="middle" x="1308" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;raw_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1319.2921,-1660.8588C1317.6028,-1652.5925 1315.5652,-1642.6216 1313.6885,-1633.4384"/>
<polygon fill="#000000" stroke="#000000" points="1317.0966,-1632.6345 1311.6652,-1623.5377 1310.2384,-1634.0361 1317.0966,-1632.6345"/>
</g>
<!-- raw_15 -->
<g id="node16" class="node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="1382" cy="-1605.6026" rx="27" ry="18"/>
<text text-anchor="middle" x="1382" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_4&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1399.4323,-1661.2346C1396.7962,-1652.8219 1393.5875,-1642.5817 1390.6449,-1633.1911"/>
<polygon fill="#000000" stroke="#000000" points="1393.9262,-1631.9574 1387.5961,-1623.4615 1387.2465,-1634.0506 1393.9262,-1631.9574"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="1455" cy="-1605.6026" rx="27" ry="18"/>
<text text-anchor="middle" x="1455" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_5&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1479.2537,-1661.2346C1475.4525,-1652.5157 1470.7956,-1641.8337 1466.5821,-1632.169"/>
<polygon fill="#000000" stroke="#000000" points="1469.7694,-1630.7218 1462.5646,-1622.9538 1463.3526,-1633.5193 1469.7694,-1630.7218"/>
</g>
<!-- raw_19 -->
<g id="node20" class="node">
<title>raw_19</title>
<ellipse fill="none" stroke="#000000" cx="1528" cy="-1605.6026" rx="27" ry="18"/>
<text text-anchor="middle" x="1528" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;raw_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1559.2836,-1661.6079C1554.2434,-1652.5847 1547.9874,-1641.385 1542.3976,-1631.3778"/>
<polygon fill="#000000" stroke="#000000" points="1545.4375,-1629.6428 1537.5052,-1622.6193 1539.3263,-1633.0565 1545.4375,-1629.6428"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1820.5,-1624.9032 1573.5,-1624.9032 1573.5,-1586.302 1820.5,-1586.302 1820.5,-1624.9032"/>
<text text-anchor="middle" x="1697" y="-1609.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local Linebuf = require &quot;linebuf&quot;</text>
<text text-anchor="middle" x="1697" y="-1594.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql = require &quot;sqlayer&quot;</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1697,-1660.8588C1697,-1653.1324 1697,-1643.9169 1697,-1635.2473"/>
<polygon fill="#000000" stroke="#000000" points="1700.5001,-1635.0797 1697,-1625.0798 1693.5001,-1635.0798 1700.5001,-1635.0797"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2029.5,-1623.6026 1838.5,-1623.6026 1838.5,-1587.6026 2029.5,-1587.6026 2029.5,-1623.6026"/>
<text text-anchor="middle" x="1934" y="-1602.1026" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_8&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1909.9101,-1660.8588C1913.564,-1652.4777 1917.9818,-1642.3445 1922.031,-1633.0564"/>
<polygon fill="#000000" stroke="#000000" points="1925.2819,-1634.3576 1926.07,-1623.7921 1918.8652,-1631.5601 1925.2819,-1634.3576"/>
</g>
<!-- header_23 -->
<g id="node24" class="node">
<title>header_23</title>
<ellipse fill="none" stroke="#000000" cx="2123" cy="-1605.6026" rx="75.4743" ry="18"/>
<text text-anchor="middle" x="2123" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : clone(linebuf)</text>
</g>
<!-- section_9&#45;&gt;header_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;header_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2170.7495,-1661.2346C2162.9911,-1652.1955 2153.4218,-1641.0465 2144.8919,-1631.1085"/>
<polygon fill="#000000" stroke="#000000" points="2147.4974,-1628.7701 2138.3285,-1623.4615 2142.1856,-1633.3293 2147.4974,-1628.7701"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="2249" cy="-1605.6026" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2249" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2201.2505,-1661.2346C2209.2962,-1651.8607 2219.2895,-1640.2177 2228.0514,-1630.0094"/>
<polygon fill="#000000" stroke="#000000" points="2230.8963,-1632.0687 2234.7535,-1622.2009 2225.5846,-1627.5095 2230.8963,-1632.0687"/>
</g>
<!-- codeblock_25 -->
<g id="node26" class="node">
<title>codeblock_25</title>
<ellipse fill="none" stroke="#000000" cx="2445" cy="-1605.6026" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2445" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 30&#45;38</text>
</g>
<!-- section_9&#45;&gt;codeblock_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;codeblock_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2231.7078,-1666.0492C2274.6862,-1653.8692 2339.2432,-1635.5739 2386.0732,-1622.3023"/>
<polygon fill="#000000" stroke="#000000" points="2387.1162,-1625.6447 2395.783,-1619.5506 2385.2075,-1618.9099 2387.1162,-1625.6447"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="2870" cy="-1605.6026" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2870" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:load()</text>
</g>
<!-- section_10&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_10&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2950.647,-1661.9787C2936.4367,-1652.045 2918.3203,-1639.3808 2902.8593,-1628.5728"/>
<polygon fill="#000000" stroke="#000000" points="2904.786,-1625.6493 2894.5847,-1622.7885 2900.7754,-1631.3865 2904.786,-1625.6493"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="3042" cy="-1605.6026" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3042" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_10&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2991.2188,-1661.2346C2999.9835,-1651.6327 3010.9215,-1639.6499 3020.399,-1629.267"/>
<polygon fill="#000000" stroke="#000000" points="3023.145,-1631.4503 3027.3017,-1621.7049 3017.975,-1626.731 3023.145,-1631.4503"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="3344" cy="-1605.6026" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="3344" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 46&#45;124</text>
</g>
<!-- section_10&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>section_10&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3031.0432,-1667.8548C3095.7063,-1654.9922 3202.1615,-1633.8166 3272.6762,-1619.7901"/>
<polygon fill="#000000" stroke="#000000" points="3273.685,-1623.1581 3282.81,-1617.7743 3272.3193,-1616.2926 3273.685,-1623.1581"/>
</g>
<!-- header_43 -->
<g id="node44" class="node">
<title>header_43</title>
<ellipse fill="none" stroke="#000000" cx="3868" cy="-1605.6026" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="3868" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_11&#45;&gt;header_43 -->
<g id="edge43" class="edge">
<title>section_11&#45;&gt;header_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4070.3885,-1665.0239C4029.6903,-1653.0749 3970.9478,-1635.8281 3927.2219,-1622.9902"/>
<polygon fill="#000000" stroke="#000000" points="3928.1539,-1619.6161 3917.5729,-1620.1572 3926.1819,-1626.3326 3928.1539,-1619.6161"/>
</g>
<!-- prose_44 -->
<g id="node45" class="node">
<title>prose_44</title>
<ellipse fill="none" stroke="#000000" cx="4039" cy="-1605.6026" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4039" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_44 -->
<g id="edge44" class="edge">
<title>section_11&#45;&gt;prose_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4098.8763,-1661.2346C4088.1908,-1651.3065 4074.7657,-1638.833 4063.3371,-1628.2146"/>
<polygon fill="#000000" stroke="#000000" points="4065.5105,-1625.4564 4055.8022,-1621.2138 4060.7458,-1630.5846 4065.5105,-1625.4564"/>
</g>
<!-- codeblock_45 -->
<g id="node46" class="node">
<title>codeblock_45</title>
<ellipse fill="none" stroke="#000000" cx="4187" cy="-1605.6026" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4187" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 128&#45;144</text>
</g>
<!-- section_11&#45;&gt;codeblock_45 -->
<g id="edge45" class="edge">
<title>section_11&#45;&gt;codeblock_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4134.703,-1661.2346C4143.2843,-1652.106 4153.8886,-1640.8255 4163.3003,-1630.8136"/>
<polygon fill="#000000" stroke="#000000" points="4165.9125,-1633.1449 4170.2117,-1623.4615 4160.8122,-1628.3503 4165.9125,-1633.1449"/>
</g>
<!-- section_46 -->
<g id="node47" class="node">
<title>section_46</title>
<ellipse fill="none" stroke="#000000" cx="4555" cy="-1605.6026" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4555" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 147&#45;169</text>
</g>
<!-- section_11&#45;&gt;section_46 -->
<g id="edge46" class="edge">
<title>section_11&#45;&gt;section_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4180.1474,-1668.5642C4260.0792,-1655.1385 4398.6337,-1631.8664 4483.0485,-1617.6878"/>
<polygon fill="#000000" stroke="#000000" points="4483.7849,-1621.1133 4493.067,-1616.0051 4482.6254,-1614.21 4483.7849,-1621.1133"/>
</g>
<!-- section_47 -->
<g id="node48" class="node">
<title>section_47</title>
<ellipse fill="none" stroke="#000000" cx="5511" cy="-1605.6026" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5511" y="-1601.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 170&#45;194</text>
</g>
<!-- section_11&#45;&gt;section_47 -->
<g id="edge47" class="edge">
<title>section_11&#45;&gt;section_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4191.9102,-1675.1082C4429.9107,-1662.5674 5175.459,-1623.283 5427.0913,-1610.0239"/>
<polygon fill="#000000" stroke="#000000" points="5427.4659,-1613.5092 5437.2678,-1609.4877 5427.0975,-1606.5189 5427.4659,-1613.5092"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-986.5027 0,-986.5027 0,-914.7004 324,-914.7004 324,-986.5027"/>
<text text-anchor="middle" x="162" y="-923.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>raw_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1287.7423,-1593.2253C1282.1814,-1590.4021 1276.0205,-1587.7734 1270,-1586.2026 1169.1869,-1559.8997 414.9427,-1614.5494 333,-1550.2026 158.8015,-1413.4105 153.8257,-1112.2436 158.8472,-996.847"/>
<polygon fill="#000000" stroke="#000000" points="162.3558,-996.7504 159.3418,-986.5933 155.3639,-996.413 162.3558,-996.7504"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-977.902 342.5,-977.902 342.5,-923.3011 897.5,-923.3011 897.5,-977.902"/>
<text text-anchor="middle" x="620" y="-946.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-931.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1361.6938,-1593.4033C1356.1333,-1590.5787 1349.9847,-1587.9048 1344,-1586.2026 1250.2774,-1559.5448 987.2397,-1605.4852 907,-1550.2026 707.4187,-1412.6975 642.1476,-1097.2887 625.1364,-988.3938"/>
<polygon fill="#000000" stroke="#000000" points="628.553,-987.5793 623.5944,-978.2165 621.632,-988.628 628.553,-987.5793"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-977.902 916,-977.902 916,-923.3011 1464,-923.3011 1464,-977.902"/>
<text text-anchor="middle" x="1190" y="-946.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-931.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1447.9119,-1588.0829C1412.4903,-1500.5314 1254.4062,-1109.7945 1204.8843,-987.391"/>
<polygon fill="#000000" stroke="#000000" points="1208.0994,-986.0056 1201.1044,-978.0482 1201.6104,-988.631 1208.0994,-986.0056"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-985.9019 1482,-985.9019 1482,-915.3012 2030,-915.3012 2030,-985.9019"/>
<text text-anchor="middle" x="1756" y="-954.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new linebuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-939.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>raw_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1534.2167,-1587.7432C1564.266,-1501.4173 1694.8692,-1126.2189 1740.33,-995.6185"/>
<polygon fill="#000000" stroke="#000000" points="1743.7244,-996.5136 1743.7064,-985.9188 1737.1134,-994.2123 1743.7244,-996.5136"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2197.5,-968.6015 2048.5,-968.6015 2048.5,-932.6015 2197.5,-932.6015 2197.5,-968.6015"/>
<text text-anchor="middle" x="2123" y="-947.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">**** clone(linebuf)</text>
</g>
<!-- header_23&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>header_23&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2123,-1587.4005C2123,-1496.3198 2123,-1090.0276 2123,-978.8209"/>
<polygon fill="#000000" stroke="#000000" points="2126.5001,-978.7156 2123,-968.7157 2119.5001,-978.7157 2126.5001,-978.7156"/>
</g>
<!-- raw_27 -->
<g id="node28" class="node">
<title>raw_27</title>
<ellipse fill="none" stroke="#000000" cx="2243" cy="-950.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="2243" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_27 -->
<g id="edge27" class="edge">
<title>prose_24&#45;&gt;raw_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2248.8333,-1587.4005C2247.9989,-1496.3198 2244.2772,-1090.0276 2243.2585,-978.8209"/>
<polygon fill="#000000" stroke="#000000" points="2246.7575,-978.6832 2243.1659,-968.7157 2239.7578,-978.7473 2246.7575,-978.6832"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2738,-1009.0024 2288,-1009.0024 2288,-892.2007 2738,-892.2007 2738,-1009.0024"/>
<text text-anchor="middle" x="2513" y="-993.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local cl = assert(table.clone, &quot;table.clone must be provided&quot;)</text>
<text text-anchor="middle" x="2513" y="-962.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function clone(linebuf)</text>
<text text-anchor="middle" x="2513" y="-946.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = cl(linebuf)</text>
<text text-anchor="middle" x="2513" y="-931.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;lb.line = cl(lb.line)</text>
<text text-anchor="middle" x="2513" y="-916.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lb</text>
<text text-anchor="middle" x="2513" y="-900.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_25&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>codeblock_25&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2446.8897,-1587.4005C2455.4258,-1505.1778 2490.6304,-1166.0733 2505.891,-1019.0785"/>
<polygon fill="#000000" stroke="#000000" points="2509.4032,-1019.141 2506.9546,-1008.833 2502.4406,-1018.4181 2509.4032,-1019.141"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2391,-231.1017 2095,-231.1017 2095,-175.2988 2391,-175.2988 2391,-231.1017"/>
<text text-anchor="middle" x="2243" y="-183.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">Does a slightly less than shallow clone.</text>
</g>
<!-- raw_27&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>raw_27&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2243,-932.4967C2243,-835.5829 2243,-377.4714 2243,-241.3992"/>
<polygon fill="#000000" stroke="#000000" points="2246.5001,-241.0662 2243,-231.0663 2239.5001,-241.0663 2246.5001,-241.0662"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2905.5,-968.6015 2756.5,-968.6015 2756.5,-932.6015 2905.5,-932.6015 2905.5,-968.6015"/>
<text text-anchor="middle" x="2831" y="-947.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:load()</text>
</g>
<!-- header_30&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>header_30&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2868.9162,-1587.4005C2863.4931,-1496.3198 2839.3017,-1090.0276 2832.6802,-978.8209"/>
<polygon fill="#000000" stroke="#000000" points="2836.1668,-978.4899 2832.0785,-968.7157 2829.1792,-978.906 2836.1668,-978.4899"/>
</g>
<!-- raw_34 -->
<g id="node35" class="node">
<title>raw_34</title>
<ellipse fill="none" stroke="#000000" cx="2951" cy="-950.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="2951" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_34 -->
<g id="edge34" class="edge">
<title>prose_31&#45;&gt;raw_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3021.7635,-1591.365C3009.3614,-1581.3954 2994.4751,-1566.9024 2987,-1550.2026 2896.3036,-1347.5826 2931.5487,-1067.3431 2945.9984,-978.6694"/>
<polygon fill="#000000" stroke="#000000" points="2949.486,-979.0342 2947.6873,-968.5932 2942.5823,-977.877 2949.486,-979.0342"/>
</g>
<!-- prespace_35 -->
<g id="node36" class="node">
<title>prespace_35</title>
<ellipse fill="none" stroke="#000000" cx="3042" cy="-950.6015" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="3042" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_31&#45;&gt;prespace_35 -->
<g id="edge35" class="edge">
<title>prose_31&#45;&gt;prespace_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3042,-1587.4005C3042,-1496.3198 3042,-1090.0276 3042,-978.8209"/>
<polygon fill="#000000" stroke="#000000" points="3045.5001,-978.7156 3042,-968.7157 3038.5001,-978.7157 3045.5001,-978.7156"/>
</g>
<!-- literal_36 -->
<g id="node37" class="node">
<title>literal_36</title>
<ellipse fill="none" stroke="#000000" cx="3138" cy="-950.6015" rx="31.481" ry="18"/>
<text text-anchor="middle" x="3138" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_31&#45;&gt;literal_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;literal_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3062.19,-1591.3441C3074.5731,-1581.366 3089.4556,-1566.8712 3097,-1550.2026 3188.5858,-1347.853 3156.2082,-1067.4343 3142.6994,-978.6924"/>
<polygon fill="#000000" stroke="#000000" points="3146.1251,-977.9453 3141.1179,-968.6083 3139.2096,-979.0299 3146.1251,-977.9453"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="3214" cy="-950.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="3214" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_31&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3073.8101,-1602.2571C3105.8667,-1597.0387 3153.9361,-1583.7699 3178,-1550.2026 3244.4588,-1457.4974 3223.6239,-1085.3939 3216.1555,-979.092"/>
<polygon fill="#000000" stroke="#000000" points="3219.6258,-978.5521 3215.4173,-968.829 3212.6438,-979.0543 3219.6258,-978.5521"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="3765,-1550.3037 3259,-1550.3037 3259,-350.8994 3765,-350.8994 3765,-1550.3037"/>
<text text-anchor="middle" x="3512" y="-1535.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 50</text>
<text text-anchor="middle" x="3512" y="-1503.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="3512" y="-1488.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE repl (</text>
<text text-anchor="middle" x="3512" y="-1472.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="3512" y="-1457.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">project TEXT,</text>
<text text-anchor="middle" x="3512" y="-1442.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="3512" y="-1426.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP);</text>
<text text-anchor="middle" x="3512" y="-1411.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="3512" y="-1379.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line_stmt = [[</text>
<text text-anchor="middle" x="3512" y="-1364.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES(?, ?);</text>
<text text-anchor="middle" x="3512" y="-1349.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="3512" y="-1317.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="3512" y="-1302.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="3512" y="-1286.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="3512" y="-1255.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="3512" y="-1240.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT line FROM repl</text>
<text text-anchor="middle" x="3512" y="-1224.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = ?</text>
<text text-anchor="middle" x="3512" y="-1209.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="3512" y="-1193.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT ?;</text>
<text text-anchor="middle" x="3512" y="-1178.402" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="3512" y="-1147.002" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="3512" y="-1131.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="3512" y="-1100.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="3512" y="-1084.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="3512" y="-1069.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="3512" y="-1054.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="3512" y="-1038.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3512" y="-1023.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3512" y="-1007.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="3512" y="-992.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3512" y="-961.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3512" y="-945.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.home_dir .. &quot;/.bridge&quot;)</text>
<text text-anchor="middle" x="3512" y="-930.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3512" y="-914.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_names = conn:exec(get_tables)</text>
<text text-anchor="middle" x="3512" y="-899.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not table_names or not has(table_names, &quot;repl&quot;) then</text>
<text text-anchor="middle" x="3512" y="-884.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, err = sql.pexec(conn, create_repl_table)</text>
<text text-anchor="middle" x="3512" y="-868.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; success is nil for creation, false for error</text>
<text text-anchor="middle" x="3512" y="-853.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success == false then</text>
<text text-anchor="middle" x="3512" y="-837.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="3512" y="-822.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3512" y="-807.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3512" y="-791.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt = conn:prepare(insert_line_stmt)</text>
<text text-anchor="middle" x="3512" y="-776.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_stmt = conn:prepare(get_recent)</text>
<text text-anchor="middle" x="3512" y="-760.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.pop_stmt = pop_stmt &#45;&#45; remove</text>
<text text-anchor="middle" x="3512" y="-745.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;pop_stmt:bind(historian.project, historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3512" y="-730.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local values, err = pop_stmt:step()</text>
<text text-anchor="middle" x="3512" y="-714.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if values then</text>
<text text-anchor="middle" x="3512" y="-699.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.values = values</text>
<text text-anchor="middle" x="3512" y="-683.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return values</text>
<text text-anchor="middle" x="3512" y="-668.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3512" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if values then</text>
<text text-anchor="middle" x="3512" y="-621.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return values</text>
<text text-anchor="middle" x="3512" y="-606.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3512" y="-590.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return false, err</text>
<text text-anchor="middle" x="3512" y="-575.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3512" y="-560.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3512" y="-544.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3512" y="-513.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, linebuf)</text>
<text text-anchor="middle" x="3512" y="-497.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="3512" y="-482.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt:bind(historian.project, lb)</text>
<text text-anchor="middle" x="3512" y="-467.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local err = historian.insert_stmt:step()</text>
<text text-anchor="middle" x="3512" y="-451.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not err then</text>
<text text-anchor="middle" x="3512" y="-436.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="3512" y="-420.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3512" y="-405.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;error(error)</text>
<text text-anchor="middle" x="3512" y="-390.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3512" y="-374.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="3512" y="-359.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>codeblock_32&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3348.6686,-1587.4005C3350.5131,-1580.2093 3352.8615,-1571.0531 3355.6369,-1560.2324"/>
<polygon fill="#000000" stroke="#000000" points="3359.0896,-1560.8583 3358.1839,-1550.3023 3352.3091,-1559.1192 3359.0896,-1560.8583"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="3000,-231.1017 2634,-231.1017 2634,-175.2988 3000,-175.2988 3000,-231.1017"/>
<text text-anchor="middle" x="2817" y="-183.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">This is where we either create query or create our</text>
</g>
<!-- raw_34&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_34&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2953.1669,-932.5595C2961.415,-858.3094 2986.8518,-569.9522 2914,-351.0005 2900.0213,-308.9883 2870.9948,-267.3913 2848.3187,-239.0825"/>
<polygon fill="#000000" stroke="#000000" points="2850.8418,-236.6383 2841.8097,-231.1 2845.4167,-241.062 2850.8418,-236.6383"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3072,-221.2002 3018,-221.2002 3018,-185.2002 3072,-185.2002 3072,-221.2002"/>
<text text-anchor="middle" x="3045" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>prespace_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3042.0727,-932.4967C3042.4718,-833.0613 3044.3972,-353.388 3044.8866,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="3048.3867,-231.4146 3044.9269,-221.4006 3041.3867,-231.3864 3048.3867,-231.4146"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="3174.5,-221.2002 3095.5,-221.2002 3095.5,-185.2002 3174.5,-185.2002 3174.5,-221.2002"/>
<text text-anchor="middle" x="3135" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">~/.bridge</text>
</g>
<!-- literal_36&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>literal_36&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3137.9273,-932.4967C3137.5282,-833.0613 3135.6028,-353.388 3135.1134,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="3138.6133,-231.3864 3135.0731,-221.4006 3131.6133,-231.4146 3138.6133,-231.3864"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="3279,-223.1023 3193,-223.1023 3193,-183.2982 3279,-183.2982 3279,-223.1023"/>
<text text-anchor="middle" x="3236" y="-207.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> database.</text>
</g>
<!-- raw_37&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>raw_37&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3214.5329,-932.4967C3217.4439,-833.6023 3231.4259,-358.5962 3235.1091,-233.466"/>
<polygon fill="#000000" stroke="#000000" points="3238.618,-233.211 3235.4139,-223.1124 3231.6211,-233.005 3238.618,-233.211"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3932.5,-968.6015 3783.5,-968.6015 3783.5,-932.6015 3932.5,-932.6015 3932.5,-968.6015"/>
<text text-anchor="middle" x="3858" y="-947.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_43&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>header_43&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3867.7221,-1587.4005C3866.3316,-1496.3198 3860.1286,-1090.0276 3858.4308,-978.8209"/>
<polygon fill="#000000" stroke="#000000" points="3861.9289,-978.661 3858.2766,-968.7157 3854.9297,-978.768 3861.9289,-978.661"/>
</g>
<!-- raw_49 -->
<g id="node50" class="node">
<title>raw_49</title>
<ellipse fill="none" stroke="#000000" cx="3978" cy="-950.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="3978" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_44&#45;&gt;raw_49 -->
<g id="edge49" class="edge">
<title>prose_44&#45;&gt;raw_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4029.1814,-1588.2307C4023.682,-1577.5988 4017.2865,-1563.5207 4014,-1550.2026 3961.0482,-1335.6228 3971.0977,-1065.3817 3976.1261,-978.7077"/>
<polygon fill="#000000" stroke="#000000" points="3979.6265,-978.8063 3976.7384,-968.6127 3972.6393,-978.3825 3979.6265,-978.8063"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="4389,-1070.102 4023,-1070.102 4023,-831.1011 4389,-831.1011 4389,-1070.102"/>
<text text-anchor="middle" x="4206" y="-1054.9018" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="4206" y="-1039.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="4206" y="-1024.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf(1)</text>
<text text-anchor="middle" x="4206" y="-1008.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4206" y="-993.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local minus = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="4206" y="-977.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf</text>
<text text-anchor="middle" x="4206" y="-962.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == #historian then</text>
<text text-anchor="middle" x="4206" y="-947.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = clone(historian[#historian])</text>
<text text-anchor="middle" x="4206" y="-931.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4206" y="-916.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;linebuf = clone(historian[historian.cursor])</text>
<text text-anchor="middle" x="4206" y="-900.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4206" y="-885.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; minus</text>
<text text-anchor="middle" x="4206" y="-870.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="4206" y="-854.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return linebuf</text>
<text text-anchor="middle" x="4206" y="-839.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_45&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>codeblock_45&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4187.528,-1587.4005C4189.6223,-1515.2019 4197.462,-1244.9381 4202.2293,-1080.5928"/>
<polygon fill="#000000" stroke="#000000" points="4205.7331,-1080.5094 4202.5246,-1070.4121 4198.736,-1080.3064 4205.7331,-1080.5094"/>
</g>
<!-- header_52 -->
<g id="node53" class="node">
<title>header_52</title>
<ellipse fill="none" stroke="#000000" cx="4489" cy="-950.6015" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="4489" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_46&#45;&gt;header_52 -->
<g id="edge52" class="edge">
<title>section_46&#45;&gt;header_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4553.1659,-1587.4005C4543.9883,-1496.3198 4503.049,-1090.0276 4491.8435,-978.8209"/>
<polygon fill="#000000" stroke="#000000" points="4495.3102,-978.3144 4490.8252,-968.7157 4488.3455,-979.0162 4495.3102,-978.3144"/>
</g>
<!-- prose_53 -->
<g id="node54" class="node">
<title>prose_53</title>
<ellipse fill="none" stroke="#000000" cx="4622" cy="-950.6015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4622" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_46&#45;&gt;prose_53 -->
<g id="edge53" class="edge">
<title>section_46&#45;&gt;prose_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4565.0241,-1587.7253C4570.4488,-1577.1495 4576.6988,-1563.2995 4580,-1550.2026 4634.0552,-1335.7503 4627.3944,-1065.4256 4623.4999,-978.7191"/>
<polygon fill="#000000" stroke="#000000" points="4626.9908,-978.4429 4623.0203,-968.6202 4619.9987,-978.775 4626.9908,-978.4429"/>
</g>
<!-- codeblock_54 -->
<g id="node55" class="node">
<title>codeblock_54</title>
<ellipse fill="none" stroke="#000000" cx="4853" cy="-950.6015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4853" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 152&#45;167</text>
</g>
<!-- section_46&#45;&gt;codeblock_54 -->
<g id="edge54" class="edge">
<title>section_46&#45;&gt;codeblock_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4601.0474,-1591.3283C4622.5401,-1582.5578 4646.8776,-1569.272 4663,-1550.2026 4814.2318,-1371.3264 4845.4242,-1071.234 4851.5626,-978.6536"/>
<polygon fill="#000000" stroke="#000000" points="4855.0571,-978.8497 4852.1799,-968.6531 4848.0704,-978.4185 4855.0571,-978.8497"/>
</g>
<!-- header_65 -->
<g id="node66" class="node">
<title>header_65</title>
<ellipse fill="none" stroke="#000000" cx="5261" cy="-950.6015" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="5261" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_47&#45;&gt;header_65 -->
<g id="edge65" class="edge">
<title>section_47&#45;&gt;header_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5459.1839,-1592.4119C5436.0267,-1583.9814 5410.3294,-1570.6695 5394,-1550.2026 5251.3529,-1371.4117 5254.3787,-1071.2616 5259.1071,-978.6603"/>
<polygon fill="#000000" stroke="#000000" points="5262.6025,-978.8378 5259.6678,-968.6575 5255.6135,-978.4459 5262.6025,-978.8378"/>
</g>
<!-- prose_66 -->
<g id="node67" class="node">
<title>prose_66</title>
<ellipse fill="none" stroke="#000000" cx="5435" cy="-950.6015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5435" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_47&#45;&gt;prose_66 -->
<g id="edge66" class="edge">
<title>section_47&#45;&gt;prose_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5503.1402,-1587.4831C5498.8537,-1576.8265 5493.8537,-1562.9765 5491,-1550.2026 5442.8,-1334.4427 5436.0189,-1066.0246 5435.1184,-979.1476"/>
<polygon fill="#000000" stroke="#000000" points="5438.6173,-978.9849 5435.0324,-969.015 5431.6175,-979.0444 5438.6173,-978.9849"/>
</g>
<!-- codeblock_67 -->
<g id="node68" class="node">
<title>codeblock_67</title>
<ellipse fill="none" stroke="#000000" cx="5587" cy="-950.6015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5587" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 172&#45;179</text>
</g>
<!-- section_47&#45;&gt;codeblock_67 -->
<g id="edge67" class="edge">
<title>section_47&#45;&gt;codeblock_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5513.112,-1587.4005C5523.6801,-1496.3198 5570.8223,-1090.0276 5583.7257,-978.8209"/>
<polygon fill="#000000" stroke="#000000" points="5587.2222,-979.0525 5584.8982,-968.7157 5580.2689,-978.2456 5587.2222,-979.0525"/>
</g>
<!-- codeblock_68 -->
<g id="node69" class="node">
<title>codeblock_68</title>
<ellipse fill="none" stroke="#000000" cx="5857" cy="-950.6015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5857" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 181&#45;190</text>
</g>
<!-- section_47&#45;&gt;codeblock_68 -->
<g id="edge68" class="edge">
<title>section_47&#45;&gt;codeblock_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5567.4916,-1593.4451C5611.121,-1582.985 5666.7162,-1566.9683 5683,-1550.2026 5845.3564,-1383.0406 5857.7351,-1073.7695 5857.5344,-978.9668"/>
<polygon fill="#000000" stroke="#000000" points="5861.0327,-978.711 5857.4599,-968.7368 5854.0329,-978.762 5861.0327,-978.711"/>
</g>
<!-- codeblock_69 -->
<g id="node70" class="node">
<title>codeblock_69</title>
<ellipse fill="none" stroke="#000000" cx="6096" cy="-950.6015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6096" y="-946.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 192&#45;194</text>
</g>
<!-- section_47&#45;&gt;codeblock_69 -->
<g id="edge69" class="edge">
<title>section_47&#45;&gt;codeblock_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5584.1526,-1600.9569C5702.6413,-1592.7702 5926.0748,-1574.3316 5953,-1550.2026 6124.8975,-1396.1568 6108.647,-1076.057 6099.2665,-979.0642"/>
<polygon fill="#000000" stroke="#000000" points="6102.7229,-978.4585 6098.2237,-968.8665 6095.7592,-979.1706 6102.7229,-978.4585"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="4005,-221.2002 3951,-221.2002 3951,-185.2002 4005,-185.2002 4005,-221.2002"/>
</g>
<!-- raw_49&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>raw_49&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3978,-932.4967C3978,-833.0613 3978,-353.388 3978,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="3981.5001,-231.4006 3978,-221.4006 3974.5001,-231.4006 3981.5001,-231.4006"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="4390,-221.2002 4234,-221.2002 4234,-185.2002 4390,-185.2002 4390,-221.2002"/>
<text text-anchor="middle" x="4312" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_52&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>header_52&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4488.7047,-932.6014C4486.9908,-858.5154 4475.4229,-570.711 4398,-351.0005 4381.9049,-305.3257 4351.4028,-257.8478 4331.3893,-229.4101"/>
<polygon fill="#000000" stroke="#000000" points="4334.201,-227.3248 4325.5425,-221.219 4328.5036,-231.3916 4334.201,-227.3248"/>
</g>
<!-- raw_56 -->
<g id="node57" class="node">
<title>raw_56</title>
<ellipse fill="none" stroke="#000000" cx="4435" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="4435" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_53&#45;&gt;raw_56 -->
<g id="edge56" class="edge">
<title>prose_53&#45;&gt;raw_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4627.1345,-932.7031C4648.528,-854.0582 4722.9953,-534.9187 4580,-351.0005 4548.6849,-310.7235 4506.9402,-351.2104 4471,-315.0005 4448.7526,-292.5861 4440.2476,-256.3732 4436.9999,-231.2612"/>
<polygon fill="#000000" stroke="#000000" points="4440.4716,-230.8113 4435.9051,-221.2511 4433.5131,-231.5724 4440.4716,-230.8113"/>
</g>
<!-- prespace_57 -->
<g id="node58" class="node">
<title>prespace_57</title>
<ellipse fill="none" stroke="#000000" cx="4526" cy="-203.2002" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="4526" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_53&#45;&gt;prespace_57 -->
<g id="edge57" class="edge">
<title>prose_53&#45;&gt;prespace_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4622.5696,-932.1909C4624.4693,-858.2487 4627.9911,-576.0373 4580,-351.0005 4570.7236,-307.5024 4551.4062,-259.5537 4538.5708,-230.4076"/>
<polygon fill="#000000" stroke="#000000" points="4541.6057,-228.6204 4534.3282,-220.9205 4535.2156,-231.4781 4541.6057,-228.6204"/>
</g>
<!-- literal_58 -->
<g id="node59" class="node">
<title>literal_58</title>
<ellipse fill="none" stroke="#000000" cx="4622" cy="-203.2002" rx="31.481" ry="18"/>
<text text-anchor="middle" x="4622" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_53&#45;&gt;literal_58 -->
<g id="edge58" class="edge">
<title>prose_53&#45;&gt;literal_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4622,-932.4967C4622,-833.0613 4622,-353.388 4622,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="4625.5001,-231.4006 4622,-221.4006 4618.5001,-231.4006 4625.5001,-231.4006"/>
</g>
<!-- raw_59 -->
<g id="node60" class="node">
<title>raw_59</title>
<ellipse fill="none" stroke="#000000" cx="4698" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="4698" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_53&#45;&gt;raw_59 -->
<g id="edge59" class="edge">
<title>prose_53&#45;&gt;raw_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4623.841,-932.4967C4633.9522,-833.0613 4682.7281,-353.388 4695.128,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="4698.6196,-231.7034 4696.1493,-221.4006 4691.6555,-230.9952 4698.6196,-231.7034"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="5151,-314.801 4743,-314.801 4743,-91.5995 5151,-91.5995 5151,-314.801"/>
<text text-anchor="middle" x="4947" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="4947" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local plus = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="4947" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="4947" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf(1)</text>
<text text-anchor="middle" x="4947" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4947" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + plus</text>
<text text-anchor="middle" x="4947" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf = clone(historian[historian.cursor])</text>
<text text-anchor="middle" x="4947" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="4947" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (plus &gt; 0) and #linebuf.line &gt; 0 then</text>
<text text-anchor="middle" x="4947" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, true</text>
<text text-anchor="middle" x="4947" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4947" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, false</text>
<text text-anchor="middle" x="4947" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4947" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_54&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>codeblock_54&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4855.277,-932.4967C4865.5806,-850.5723 4908.346,-510.5412 4931.6661,-325.121"/>
<polygon fill="#000000" stroke="#000000" points="4935.158,-325.4046 4932.9333,-315.046 4928.2127,-324.5311 4935.158,-325.4046"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="4482,-55.6015 4004,-55.6015 4004,.2015 4482,.2015 4482,-55.6015"/>
<text text-anchor="middle" x="4243" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next linebuf in history, and a second flag to tell the</text>
</g>
<!-- raw_56&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>raw_56&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4433.7967,-184.9823C4431.261,-160.696 4423.3926,-117.7247 4399,-91.4 4387.1989,-78.6642 4372.4846,-68.4098 4356.8423,-60.1709"/>
<polygon fill="#000000" stroke="#000000" points="4358.0531,-56.8643 4347.5402,-55.5493 4354.9385,-63.1332 4358.0531,-56.8643"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4554,-45.7 4500,-45.7 4500,-9.7 4554,-9.7 4554,-45.7"/>
</g>
<!-- prespace_57&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>prespace_57&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4526.1033,-185.0797C4526.2774,-154.5231 4526.6306,-92.5279 4526.838,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="4530.3402,-55.7418 4526.8973,-45.722 4523.3403,-55.7019 4530.3402,-55.7418"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="4672,-45.7 4572,-45.7 4572,-9.7 4672,-9.7 4672,-45.7"/>
<text text-anchor="middle" x="4622" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_58&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>literal_58&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4622,-185.0797C4622,-154.5231 4622,-92.5279 4622,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="4625.5001,-55.722 4622,-45.722 4618.5001,-55.7221 4625.5001,-55.722"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="4930,-45.7 4690,-45.7 4690,-9.7 4930,-9.7 4930,-45.7"/>
<text text-anchor="middle" x="4810" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_59&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>raw_59&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4700.6171,-185.1968C4704.6782,-161.9061 4714.1902,-120.8356 4734,-91.4 4744.2851,-76.1174 4759.2495,-62.4818 4773.1849,-51.7863"/>
<polygon fill="#000000" stroke="#000000" points="4775.2685,-54.5985 4781.2278,-45.8385 4771.1064,-48.9703 4775.2685,-54.5985"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="5339,-221.2002 5169,-221.2002 5169,-185.2002 5339,-185.2002 5339,-221.2002"/>
<text text-anchor="middle" x="5254" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_65&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>header_65&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5260.8304,-932.4967C5259.8991,-833.0613 5255.4066,-353.388 5254.2645,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="5257.7641,-231.3674 5254.1705,-221.4006 5250.7644,-231.433 5257.7641,-231.3674"/>
</g>
<!-- raw_71 -->
<g id="node72" class="node">
<title>raw_71</title>
<ellipse fill="none" stroke="#000000" cx="5384" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="5384" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_66&#45;&gt;raw_71 -->
<g id="edge71" class="edge">
<title>prose_66&#45;&gt;raw_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5433.7646,-932.4967C5426.9795,-833.0613 5394.2483,-353.388 5385.9273,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="5389.4147,-231.1391 5385.2419,-221.4006 5382.4309,-231.6157 5389.4147,-231.1391"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="5760.5,-253.6012 5429.5,-253.6012 5429.5,-152.7993 5760.5,-152.7993 5760.5,-253.6012"/>
<text text-anchor="middle" x="5595" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, linebuf)</text>
<text text-anchor="middle" x="5595" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = linebuf</text>
<text text-anchor="middle" x="5595" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="5595" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:persist(linebuf)</text>
<text text-anchor="middle" x="5595" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="5595" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_67&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>codeblock_67&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5587.1938,-932.4967C5588.1803,-840.3322 5592.6633,-421.5043 5594.353,-263.644"/>
<polygon fill="#000000" stroke="#000000" points="5597.8529,-263.6666 5594.4602,-253.6297 5590.8533,-263.5916 5597.8529,-263.6666"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="6075,-268.9007 5779,-268.9007 5779,-137.4998 6075,-137.4998 6075,-268.9007"/>
<text text-anchor="middle" x="5927" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(linebuf)</text>
<text text-anchor="middle" x="5927" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="5927" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[1] = linebuf</text>
<text text-anchor="middle" x="5927" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = linebuf and 1 or 0</text>
<text text-anchor="middle" x="5927" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="5927" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="5927" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5927" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_68&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>codeblock_68&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5858.6957,-932.4967C5867.0592,-843.1982 5904.1441,-447.2363 5919.8905,-279.1099"/>
<polygon fill="#000000" stroke="#000000" points="5923.3805,-279.3788 5920.8283,-269.096 5916.411,-278.726 5923.3805,-279.3788"/>
</g>
<!-- leaf_75 -->
<g id="node76" class="node">
<title>leaf_75</title>
<polygon fill="none" stroke="#c0c0c0" points="6179,-221.2002 6093,-221.2002 6093,-185.2002 6179,-185.2002 6179,-221.2002"/>
<text text-anchor="middle" x="6136" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_69&#45;&gt;leaf_75 -->
<g id="edge75" class="edge">
<title>codeblock_69&#45;&gt;leaf_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6096.9689,-932.4967C6102.2906,-833.0613 6127.9621,-353.388 6134.4884,-231.444"/>
<polygon fill="#000000" stroke="#000000" points="6137.9864,-231.5734 6135.0259,-221.4006 6130.9964,-231.1992 6137.9864,-231.5734"/>
</g>
<!-- leaf_72 -->
<g id="node73" class="node">
<title>leaf_72</title>
<polygon fill="none" stroke="#c0c0c0" points="5411,-45.7 5357,-45.7 5357,-9.7 5411,-9.7 5411,-45.7"/>
</g>
<!-- raw_71&#45;&gt;leaf_72 -->
<g id="edge72" class="edge">
<title>raw_71&#45;&gt;leaf_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5384,-185.0797C5384,-154.5231 5384,-92.5279 5384,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="5387.5001,-55.722 5384,-45.722 5380.5001,-55.7221 5387.5001,-55.722"/>
</g>
</g>
</svg>
