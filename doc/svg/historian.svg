<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="13346pt" height="2293pt"
 viewBox="0.00 0.00 13346.30 2293.28" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2289.2833)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2289.2833 13342.2972,-2289.2833 13342.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1779" cy="-2267.2833" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1779" y="-2263.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 485</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1779" cy="-2195.2833" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1779" y="-2191.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;399</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1779,-2249.1146C1779,-2241.4142 1779,-2232.2576 1779,-2223.6999"/>
<polygon fill="#000000" stroke="#000000" points="1782.5001,-2223.6965 1779,-2213.6966 1775.5001,-2223.6966 1782.5001,-2223.6965"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1356" cy="-2123.2833" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1356" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1718.7149,-2187.926C1648.1794,-2178.8877 1528.0436,-2162.1539 1426,-2141.2833 1420.6215,-2140.1832 1415.037,-2138.9335 1409.4738,-2137.6173"/>
<polygon fill="#000000" stroke="#000000" points="1410.0769,-2134.1619 1399.5325,-2135.1944 1408.4193,-2140.9628 1410.0769,-2134.1619"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1467" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1467" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1720.191,-2187.1268C1664.8997,-2178.6163 1580.2172,-2163.4026 1509,-2141.2833 1506.5472,-2140.5215 1504.0431,-2139.6645 1501.5399,-2138.7485"/>
<polygon fill="#000000" stroke="#000000" points="1502.5872,-2135.3996 1491.9998,-2135.0004 1500.0274,-2141.9148 1502.5872,-2135.3996"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1550" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1550" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1730.4359,-2183.0285C1692.3795,-2173.0022 1638.3029,-2157.8192 1592,-2141.2833 1589.5813,-2140.4195 1587.1026,-2139.4863 1584.6178,-2138.5151"/>
<polygon fill="#000000" stroke="#000000" points="1585.6994,-2135.1765 1575.1178,-2134.647 1583.0596,-2141.6597 1585.6994,-2135.1765"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1633" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1633" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1746.9597,-2179.4826C1723.0983,-2167.7153 1690.6044,-2151.6909 1666.4189,-2139.7639"/>
<polygon fill="#000000" stroke="#000000" points="1667.7832,-2136.5342 1657.2664,-2135.2503 1664.6871,-2142.8123 1667.7832,-2136.5342"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1715" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1715" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1763.1798,-2177.4855C1755.1184,-2168.4164 1745.1979,-2157.2559 1736.4584,-2147.424"/>
<polygon fill="#000000" stroke="#000000" points="1739.0204,-2145.0379 1729.7607,-2139.8891 1733.7885,-2149.6885 1739.0204,-2145.0379"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1843" cy="-2123.2833" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1843" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1794.8202,-2177.4855C1802.5126,-2168.8316 1811.8978,-2158.2733 1820.3344,-2148.7821"/>
<polygon fill="#000000" stroke="#000000" points="1823.1122,-2150.9252 1827.14,-2141.1258 1817.8803,-2146.2747 1823.1122,-2150.9252"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2060" cy="-2123.2833" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2060" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1826.9863,-2182.9879C1874.2571,-2170.8758 1946.679,-2152.3193 1998.2255,-2139.1116"/>
<polygon fill="#000000" stroke="#000000" points="1999.1011,-2142.5004 2007.9194,-2136.6278 1997.3636,-2135.7195 1999.1011,-2142.5004"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2526" cy="-2123.2833" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2526" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;231</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1841.0845,-2189.2992C1977.1601,-2176.1835 2301.3355,-2144.9377 2449.6119,-2130.646"/>
<polygon fill="#000000" stroke="#000000" points="2450.3608,-2134.0901 2459.9789,-2129.6468 2449.6892,-2127.1224 2450.3608,-2134.0901"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7256" cy="-2123.2833" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7256" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 282&#45;317</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1844.8094,-2194.4182C2415.6733,-2186.9137 6523.3123,-2132.9151 7170.31,-2124.4098"/>
<polygon fill="#000000" stroke="#000000" points="7170.5346,-2127.9072 7180.4877,-2124.276 7170.4426,-2120.9078 7170.5346,-2127.9072"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="10931" cy="-2123.2833" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="10931" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 400&#45;451</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1844.8435,-2194.7653C2618.5708,-2188.6783 9966.827,-2130.8686 10845.2604,-2123.9578"/>
<polygon fill="#000000" stroke="#000000" points="10845.3236,-2127.4575 10855.2957,-2123.8789 10845.2684,-2120.4577 10845.3236,-2127.4575"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1401.5,-2021.6832 1308.5,-2021.6832 1308.5,-1985.6832 1401.5,-1985.6832 1401.5,-2021.6832"/>
<text text-anchor="middle" x="1355" y="-2000.1832" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1355.8481,-2105.1186C1355.6859,-2085.7125 1355.4265,-2054.6933 1355.2373,-2032.0611"/>
<polygon fill="#000000" stroke="#000000" points="1358.7369,-2031.9891 1355.1533,-2022.0188 1351.7371,-2032.0477 1358.7369,-2031.9891"/>
</g>
<!-- raw_13 -->
<g id="node14" class="node">
<title>raw_13</title>
<ellipse fill="none" stroke="#000000" cx="1447" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1447" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;raw_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1463.9624,-2105.1186C1460.6984,-2085.5997 1455.4697,-2054.3322 1451.6796,-2031.6672"/>
<polygon fill="#000000" stroke="#000000" points="1455.1021,-2030.9127 1450.0006,-2021.6269 1448.198,-2032.0673 1455.1021,-2030.9127"/>
</g>
<!-- raw_15 -->
<g id="node16" class="node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="1519" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1519" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_4&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1545.359,-2105.3779C1540.291,-2085.8254 1532.1105,-2054.2645 1526.2061,-2031.4847"/>
<polygon fill="#000000" stroke="#000000" points="1529.5699,-2030.5128 1523.6727,-2021.7109 1522.7938,-2032.2692 1529.5699,-2030.5128"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="1591" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1591" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_5&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1626.7122,-2105.3779C1619.7751,-2085.6238 1608.5337,-2053.6124 1600.5166,-2030.7829"/>
<polygon fill="#000000" stroke="#000000" points="1603.8094,-2029.596 1597.1937,-2021.3205 1597.2048,-2031.9154 1603.8094,-2029.596"/>
</g>
<!-- raw_19 -->
<g id="node20" class="node">
<title>raw_19</title>
<ellipse fill="none" stroke="#000000" cx="1663" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1663" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;raw_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1707.3272,-2105.6359C1698.6753,-2085.7363 1684.5143,-2053.1661 1674.5301,-2030.2025"/>
<polygon fill="#000000" stroke="#000000" points="1677.7323,-2028.7893 1670.5352,-2021.0141 1671.3128,-2031.5804 1677.7323,-2028.7893"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1990,-2069.3836 1708,-2069.3836 1708,-1937.9828 1990,-1937.9828 1990,-2069.3836"/>
<text text-anchor="middle" x="1849" y="-2054.0833" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1849" y="-2038.6833" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1849" y="-2023.2832" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1849" y="-2007.8832" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1849" y="-1992.4832" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1849" y="-1977.0831" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1849" y="-1961.6831" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1849" y="-1946.2831" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1843.9113,-2105.1186C1844.2762,-2097.8436 1844.7231,-2088.9366 1845.1989,-2079.4511"/>
<polygon fill="#000000" stroke="#000000" points="1848.6976,-2079.564 1845.7031,-2069.4011 1841.7064,-2079.2132 1848.6976,-2079.564"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2199.5,-2021.6832 2008.5,-2021.6832 2008.5,-1985.6832 2199.5,-1985.6832 2199.5,-2021.6832"/>
<text text-anchor="middle" x="2104" y="-2000.1832" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_8&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2066.6827,-2105.1186C2073.8866,-2085.5369 2085.4407,-2054.1309 2093.7853,-2031.4487"/>
<polygon fill="#000000" stroke="#000000" points="2097.0865,-2032.6123 2097.2545,-2022.0188 2090.5169,-2030.1954 2097.0865,-2032.6123"/>
</g>
<!-- header_23 -->
<g id="node24" class="node">
<title>header_23</title>
<ellipse fill="none" stroke="#000000" cx="2286" cy="-2003.6832" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2286" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;header_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2473.569,-2111.2072C2440.7843,-2102.3721 2398.4023,-2088.5494 2364,-2069.2833 2344.3309,-2058.2681 2324.9201,-2041.9688 2310.3823,-2028.3732"/>
<polygon fill="#000000" stroke="#000000" points="2312.4802,-2025.5363 2302.8364,-2021.1491 2307.6394,-2030.5927 2312.4802,-2025.5363"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="2405" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2405" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2495.6368,-2106.9412C2479.6527,-2097.3684 2460.4321,-2084.2318 2446,-2069.2833 2434.8906,-2057.7763 2425.2443,-2042.7784 2418.1042,-2030.028"/>
<polygon fill="#000000" stroke="#000000" points="2421.1857,-2028.3683 2413.3629,-2021.223 2415.0224,-2031.6871 2421.1857,-2028.3683"/>
</g>
<!-- section_25 -->
<g id="node26" class="node">
<title>section_25</title>
<ellipse fill="none" stroke="#000000" cx="2526" cy="-2003.6832" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2526" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;141</text>
</g>
<!-- section_9&#45;&gt;section_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;section_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2526,-2105.1186C2526,-2085.7125 2526,-2054.6933 2526,-2032.0611"/>
<polygon fill="#000000" stroke="#000000" points="2529.5001,-2032.0188 2526,-2022.0188 2522.5001,-2032.0188 2529.5001,-2032.0188"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 142&#45;220</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2570.6845,-2109.3296C2640.8415,-2087.4215 2776.7,-2044.9967 2853.1828,-2021.1133"/>
<polygon fill="#000000" stroke="#000000" points="2854.612,-2024.3338 2863.1142,-2018.012 2852.5254,-2017.652 2854.612,-2024.3338"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="3968" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3968" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;231</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593.1368,-2117.7149C2830.3004,-2098.0445 3628.3002,-2031.858 3886.5918,-2010.4352"/>
<polygon fill="#000000" stroke="#000000" points="3886.9759,-2013.9154 3896.6523,-2009.6008 3886.3972,-2006.9394 3886.9759,-2013.9154"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="4856" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4856" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 232&#45;281</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2596.4046,-2121.9449C2813.4231,-2117.572 3491.2843,-2102.0618 4052,-2069.2833 4317.3836,-2053.7694 4631.2483,-2025.1954 4775.7918,-2011.4584"/>
<polygon fill="#000000" stroke="#000000" points="4776.2803,-2014.9278 4785.9034,-2010.4954 4775.6165,-2007.9594 4776.2803,-2014.9278"/>
</g>
<!-- header_87 -->
<g id="node88" class="node">
<title>header_87</title>
<ellipse fill="none" stroke="#000000" cx="7057" cy="-2003.6832" rx="107.339" ry="18"/>
<text text-anchor="middle" x="7057" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_87 -->
<g id="edge87" class="edge">
<title>section_10&#45;&gt;header_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7227.9102,-2106.4012C7193.0959,-2085.4776 7133.6297,-2049.738 7094.8262,-2026.4169"/>
<polygon fill="#000000" stroke="#000000" points="7096.2896,-2023.213 7085.9155,-2021.0616 7092.6837,-2029.2128 7096.2896,-2023.213"/>
</g>
<!-- prose_88 -->
<g id="node89" class="node">
<title>prose_88</title>
<ellipse fill="none" stroke="#000000" cx="7215" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7215" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;prose_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7249.773,-2105.1186C7243.0515,-2085.5114 7232.2659,-2054.049 7224.4879,-2031.3601"/>
<polygon fill="#000000" stroke="#000000" points="7227.705,-2029.9515 7221.1513,-2021.6269 7221.0833,-2032.2215 7227.705,-2029.9515"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7297" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7297" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7262.227,-2105.1186C7268.9485,-2085.5114 7279.7341,-2054.049 7287.5121,-2031.3601"/>
<polygon fill="#000000" stroke="#000000" points="7290.9167,-2032.2215 7290.8487,-2021.6269 7284.295,-2029.9515 7290.9167,-2032.2215"/>
</g>
<!-- section_90 -->
<g id="node91" class="node">
<title>section_90</title>
<ellipse fill="none" stroke="#000000" cx="7888" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7888" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 292&#45;317</text>
</g>
<!-- section_10&#45;&gt;section_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;section_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7315.173,-2112.0853C7432.439,-2089.8938 7693.7725,-2040.4389 7818.7845,-2016.7816"/>
<polygon fill="#000000" stroke="#000000" points="7819.4606,-2020.2158 7828.6354,-2014.9174 7818.159,-2013.3379 7819.4606,-2020.2158"/>
</g>
<!-- section_91 -->
<g id="node92" class="node">
<title>section_91</title>
<ellipse fill="none" stroke="#000000" cx="9674" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9674" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 318&#45;399</text>
</g>
<!-- section_10&#45;&gt;section_91 -->
<g id="edge91" class="edge">
<title>section_10&#45;&gt;section_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7330.018,-2119.6222C7685.2673,-2102.0507 9213.7122,-2026.4501 9590.0358,-2007.8362"/>
<polygon fill="#000000" stroke="#000000" points="9590.2232,-2011.3313 9600.038,-2007.3415 9589.8773,-2004.3399 9590.2232,-2011.3313"/>
</g>
<!-- header_139 -->
<g id="node140" class="node">
<title>header_139</title>
<ellipse fill="none" stroke="#000000" cx="10677" cy="-2003.6832" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="10677" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_11&#45;&gt;header_139 -->
<g id="edge139" class="edge">
<title>section_11&#45;&gt;header_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10894.8916,-2107.4C10870.9965,-2096.7994 10839.0197,-2082.4421 10811,-2069.2833 10780.2005,-2054.819 10745.725,-2037.9253 10719.4566,-2024.9043"/>
<polygon fill="#000000" stroke="#000000" points="10720.6853,-2021.6067 10710.172,-2020.294 10717.572,-2027.8763 10720.6853,-2021.6067"/>
</g>
<!-- prose_140 -->
<g id="node141" class="node">
<title>prose_140</title>
<ellipse fill="none" stroke="#000000" cx="10852" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10852" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_140 -->
<g id="edge140" class="edge">
<title>section_11&#45;&gt;prose_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10919.1729,-2105.3779C10905.8731,-2085.243 10884.1618,-2052.3737 10869.0351,-2029.473"/>
<polygon fill="#000000" stroke="#000000" points="10871.8263,-2027.3484 10863.3944,-2020.9334 10865.9855,-2031.2065 10871.8263,-2027.3484"/>
</g>
<!-- codeblock_141 -->
<g id="node142" class="node">
<title>codeblock_141</title>
<ellipse fill="none" stroke="#000000" cx="11011" cy="-2003.6832" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11011" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 402&#45;415</text>
</g>
<!-- section_11&#45;&gt;codeblock_141 -->
<g id="edge141" class="edge">
<title>section_11&#45;&gt;codeblock_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10942.9768,-2105.3779C10956.2911,-2085.4731 10977.9297,-2053.1233 10993.2215,-2030.2621"/>
<polygon fill="#000000" stroke="#000000" points="10996.2906,-2031.9688 10998.9413,-2021.7109 10990.4723,-2028.0769 10996.2906,-2031.9688"/>
</g>
<!-- section_142 -->
<g id="node143" class="node">
<title>section_142</title>
<ellipse fill="none" stroke="#000000" cx="11445" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11445" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 418&#45;451</text>
</g>
<!-- section_11&#45;&gt;section_142 -->
<g id="edge142" class="edge">
<title>section_11&#45;&gt;section_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10985.0355,-2110.71C11080.5721,-2088.4801 11278.8455,-2042.3448 11381.0355,-2018.5667"/>
<polygon fill="#000000" stroke="#000000" points="11381.9706,-2021.9427 11390.9172,-2016.2674 11380.3842,-2015.1249 11381.9706,-2021.9427"/>
</g>
<!-- section_143 -->
<g id="node144" class="node">
<title>section_143</title>
<ellipse fill="none" stroke="#000000" cx="12427" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="12427" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 452&#45;485</text>
</g>
<!-- section_11&#45;&gt;section_143 -->
<g id="edge143" class="edge">
<title>section_11&#45;&gt;section_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11002.6512,-2117.555C11251.8361,-2097.6335 12079.8541,-2031.4363 12344.7431,-2010.2593"/>
<polygon fill="#000000" stroke="#000000" points="12345.3662,-2013.7208 12355.0554,-2009.4349 12344.8083,-2006.743 12345.3662,-2013.7208"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-1836.544 0,-1836.544 0,-1764.7417 324,-1764.7417 324,-1836.544"/>
<text text-anchor="middle" x="162" y="-1773.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>raw_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1442.2583,-1985.7138C1437.1082,-1970.1454 1427.2157,-1948.5278 1410,-1938.083 1307.6332,-1875.977 447.9233,-1935.6798 333,-1902.083 290.7251,-1889.7244 248.1106,-1864.4847 215.9974,-1842.2747"/>
<polygon fill="#000000" stroke="#000000" points="217.8412,-1839.2926 207.6476,-1836.4045 213.8153,-1845.0191 217.8412,-1839.2926"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-1827.9433 342.5,-1827.9433 342.5,-1773.3425 897.5,-1773.3425 897.5,-1827.9433"/>
<text text-anchor="middle" x="620" y="-1796.8429" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1781.4429" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1514.453,-1985.8462C1509.4869,-1970.367 1499.8901,-1948.8058 1483,-1938.083 1374.7267,-1869.3452 1032.6657,-1927.6983 907,-1902.083 831.0926,-1886.6103 748.0129,-1855.5965 690.8638,-1831.9129"/>
<polygon fill="#000000" stroke="#000000" points="692.1426,-1828.6541 681.5662,-1828.0296 689.4448,-1835.1133 692.1426,-1828.6541"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-1827.9433 916,-1827.9433 916,-1773.3425 1464,-1773.3425 1464,-1827.9433"/>
<text text-anchor="middle" x="1190" y="-1796.8429" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1781.4429" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1585.1663,-1985.8235C1579.5501,-1971.1791 1569.7206,-1950.8516 1555,-1938.083 1543.9326,-1928.4832 1380.9581,-1869.0293 1276.5624,-1831.5287"/>
<polygon fill="#000000" stroke="#000000" points="1277.5574,-1828.1672 1266.9629,-1828.0829 1275.1924,-1834.7556 1277.5574,-1828.1672"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-1835.9432 1482,-1835.9432 1482,-1765.3425 2030,-1765.3425 2030,-1835.9432"/>
<text text-anchor="middle" x="1756" y="-1804.8429" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1789.4429" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>raw_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1670.9291,-1986.3721C1685.1182,-1955.3941 1715.2651,-1889.5766 1735.5862,-1845.2109"/>
<polygon fill="#000000" stroke="#000000" points="1738.7818,-1846.6388 1739.7641,-1836.0896 1732.4176,-1843.7238 1738.7818,-1846.6388"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-1818.6429 2048,-1818.6429 2048,-1782.6429 2162,-1782.6429 2162,-1818.6429"/>
<text text-anchor="middle" x="2105" y="-1797.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_23&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>header_23&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2264.7921,-1986.134C2236.0378,-1962.141 2186.4913,-1920.0332 2171,-1902.083 2150.911,-1878.8053 2132.2218,-1848.9916 2119.8969,-1827.7216"/>
<polygon fill="#000000" stroke="#000000" points="2122.854,-1825.8416 2114.8596,-1818.889 2116.7734,-1829.3095 2122.854,-1825.8416"/>
</g>
<!-- raw_30 -->
<g id="node31" class="node">
<title>raw_30</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_30 -->
<g id="edge30" class="edge">
<title>prose_24&#45;&gt;raw_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2398.1095,-1985.8282C2391.5011,-1970.9832 2380.136,-1950.3672 2364,-1938.083 2319.3572,-1904.0968 2283.6889,-1940.7154 2243,-1902.083 2222.7605,-1882.8665 2213.8836,-1851.547 2210.0001,-1828.7862"/>
<polygon fill="#000000" stroke="#000000" points="2213.4334,-1828.0773 2208.5055,-1818.6983 2206.509,-1829.1033 2213.4334,-1828.0773"/>
</g>
<!-- header_32 -->
<g id="node33" class="node">
<title>header_32</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-1800.6429" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_25&#45;&gt;header_32 -->
<g id="edge32" class="edge">
<title>section_25&#45;&gt;header_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2506.5201,-1986.2373C2484.6521,-1966.4148 2448.3855,-1932.8199 2419,-1902.083 2395.2474,-1877.238 2369.667,-1847.366 2352.2418,-1826.497"/>
<polygon fill="#000000" stroke="#000000" points="2354.8408,-1824.1483 2345.7571,-1818.6951 2349.4575,-1828.6227 2354.8408,-1824.1483"/>
</g>
<!-- prose_33 -->
<g id="node34" class="node">
<title>prose_33</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_25&#45;&gt;prose_33 -->
<g id="edge33" class="edge">
<title>section_25&#45;&gt;prose_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2520.1429,-1985.6647C2508.5723,-1950.0692 2482.7176,-1870.5304 2468.9801,-1828.2689"/>
<polygon fill="#000000" stroke="#000000" points="2472.2639,-1827.0492 2465.8439,-1818.621 2465.6068,-1829.2132 2472.2639,-1827.0492"/>
</g>
<!-- codeblock_34 -->
<g id="node35" class="node">
<title>codeblock_34</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-1800.6429" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;139</text>
</g>
<!-- section_25&#45;&gt;codeblock_34 -->
<g id="edge34" class="edge">
<title>section_25&#45;&gt;codeblock_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2531.9458,-1985.6647C2543.6917,-1950.0692 2569.9382,-1870.5304 2583.8839,-1828.2689"/>
<polygon fill="#000000" stroke="#000000" points="2587.2575,-1829.2141 2587.0675,-1818.621 2580.6101,-1827.0205 2587.2575,-1829.2141"/>
</g>
<!-- header_39 -->
<g id="node40" class="node">
<title>header_39</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-1800.6429" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_26&#45;&gt;header_39 -->
<g id="edge39" class="edge">
<title>section_26&#45;&gt;header_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2897.1971,-1985.6647C2873.6834,-1949.7682 2820.896,-1869.182 2793.3991,-1827.2047"/>
<polygon fill="#000000" stroke="#000000" points="2796.1838,-1825.0683 2787.7764,-1818.621 2790.3282,-1828.9039 2796.1838,-1825.0683"/>
</g>
<!-- prose_40 -->
<g id="node41" class="node">
<title>prose_40</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_40 -->
<g id="edge40" class="edge">
<title>section_26&#45;&gt;prose_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-1985.6647C2909,-1950.309 2909,-1871.6001 2909,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-1828.9128 2909,-1818.9128 2905.5001,-1828.9129 2912.5001,-1828.9128"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_26&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2916.277,-1985.6647C2930.7192,-1949.9041 2963.0735,-1869.7916 2980.0795,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="2983.357,-1828.9141 2983.8564,-1818.3311 2976.8663,-1826.2928 2983.357,-1828.9141"/>
</g>
<!-- codeblock_42 -->
<g id="node43" class="node">
<title>codeblock_42</title>
<ellipse fill="none" stroke="#000000" cx="3211" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3211" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;218</text>
</g>
<!-- section_26&#45;&gt;codeblock_42 -->
<g id="edge42" class="edge">
<title>section_26&#45;&gt;codeblock_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2934.4881,-1986.547C2988.7031,-1950.0972 3115.4962,-1864.8519 3176.7191,-1823.6906"/>
<polygon fill="#000000" stroke="#000000" points="3178.9138,-1826.4326 3185.2598,-1817.9485 3175.0082,-1820.6234 3178.9138,-1826.4326"/>
</g>
<!-- header_49 -->
<g id="node50" class="node">
<title>header_49</title>
<ellipse fill="none" stroke="#000000" cx="3727" cy="-1800.6429" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3727" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_27&#45;&gt;header_49 -->
<g id="edge49" class="edge">
<title>section_27&#45;&gt;header_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3947.0344,-1986.0199C3903.9678,-1949.7367 3805.4594,-1866.7442 3756.1874,-1825.233"/>
<polygon fill="#000000" stroke="#000000" points="3758.3371,-1822.4675 3748.4343,-1818.7011 3753.8269,-1827.8209 3758.3371,-1822.4675"/>
</g>
<!-- prose_50 -->
<g id="node51" class="node">
<title>prose_50</title>
<ellipse fill="none" stroke="#000000" cx="3968" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3968" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_50 -->
<g id="edge50" class="edge">
<title>section_27&#45;&gt;prose_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968,-1985.6647C3968,-1950.309 3968,-1871.6001 3968,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="3971.5001,-1828.9128 3968,-1818.9128 3964.5001,-1828.9129 3971.5001,-1828.9128"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="4050" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4050" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_27&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3975.277,-1985.6647C3989.7192,-1949.9041 4022.0735,-1869.7916 4039.0795,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="4042.357,-1828.9141 4042.8564,-1818.3311 4035.8663,-1826.2928 4042.357,-1828.9141"/>
</g>
<!-- codeblock_52 -->
<g id="node53" class="node">
<title>codeblock_52</title>
<ellipse fill="none" stroke="#000000" cx="4188" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4188" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;229</text>
</g>
<!-- section_27&#45;&gt;codeblock_52 -->
<g id="edge52" class="edge">
<title>section_27&#45;&gt;codeblock_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3990.4335,-1986.4495C4015.6081,-1966.8172 4057.3304,-1933.3922 4091,-1902.083 4117.5822,-1877.3644 4146.0735,-1847.0643 4165.2509,-1826.0487"/>
<polygon fill="#000000" stroke="#000000" points="4167.9917,-1828.2367 4172.1214,-1818.4798 4162.8086,-1823.5319 4167.9917,-1828.2367"/>
</g>
<!-- header_59 -->
<g id="node60" class="node">
<title>header_59</title>
<ellipse fill="none" stroke="#000000" cx="4610" cy="-1800.6429" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4610" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_28&#45;&gt;header_59 -->
<g id="edge59" class="edge">
<title>section_28&#45;&gt;header_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4835.0262,-1986.3721C4791.2209,-1950.2166 4689.9157,-1866.6026 4639.5426,-1825.0263"/>
<polygon fill="#000000" stroke="#000000" points="4641.5623,-1822.1552 4631.622,-1818.489 4637.1064,-1827.5538 4641.5623,-1822.1552"/>
</g>
<!-- prose_60 -->
<g id="node61" class="node">
<title>prose_60</title>
<ellipse fill="none" stroke="#000000" cx="4774" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4774" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_60 -->
<g id="edge60" class="edge">
<title>section_28&#45;&gt;prose_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4848.723,-1985.6647C4834.2808,-1949.9041 4801.9265,-1869.7916 4784.9205,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="4788.1337,-1826.2928 4781.1436,-1818.3311 4781.643,-1828.9141 4788.1337,-1826.2928"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4856" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4856" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_28&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4856,-1985.6647C4856,-1950.309 4856,-1871.6001 4856,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="4859.5001,-1828.9128 4856,-1818.9128 4852.5001,-1828.9129 4859.5001,-1828.9128"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="5546" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5546" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_28&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4903.6987,-1989.6473C5033.2291,-1951.5315 5389.691,-1846.6386 5507.5835,-1811.9474"/>
<polygon fill="#000000" stroke="#000000" points="5508.667,-1815.277 5517.2722,-1809.0964 5506.6909,-1808.5617 5508.667,-1815.277"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5774" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5774" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_28&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4926.3768,-1997.1404C5084.7429,-1981.8953 5464.8207,-1942.2427 5587,-1902.083 5646.8407,-1882.4137 5709.9443,-1843.9305 5745.4047,-1820.4306"/>
<polygon fill="#000000" stroke="#000000" points="5747.4479,-1823.2747 5753.8057,-1814.7995 5743.5504,-1817.4601 5747.4479,-1823.2747"/>
</g>
<!-- codeblock_64 -->
<g id="node65" class="node">
<title>codeblock_64</title>
<ellipse fill="none" stroke="#000000" cx="6065" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6065" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;279</text>
</g>
<!-- section_28&#45;&gt;codeblock_64 -->
<g id="edge64" class="edge">
<title>section_28&#45;&gt;codeblock_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4928.7765,-1998.6207C5122.372,-1984.732 5646.7084,-1944.2503 5815,-1902.083 5890.8199,-1883.0856 5974.0214,-1845.7518 6022.7641,-1822.0593"/>
<polygon fill="#000000" stroke="#000000" points="6024.6019,-1825.0564 6032.0407,-1817.5122 6021.5209,-1818.7708 6024.6019,-1825.0564"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="1887,-912.6029 1549,-912.6029 1549,-856.7999 1887,-856.7999 1887,-912.6029"/>
<text text-anchor="middle" x="1718" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_30&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>raw_30&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2206.0678,-1782.38C2203.8287,-1759.1632 2196.2841,-1719.6478 2171,-1699.2027 2075.1502,-1621.6973 1987.1858,-1746.1451 1896,-1663.2027 1675.285,-1462.4409 1699.8634,-1049.081 1713.304,-922.4225"/>
<polygon fill="#000000" stroke="#000000" points="1716.7885,-922.7546 1714.4054,-912.4313 1709.8306,-921.9875 1716.7885,-922.7546"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2047,-902.7014 1905,-902.7014 1905,-866.7014 2047,-866.7014 2047,-902.7014"/>
<text text-anchor="middle" x="1976" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_32&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>header_32&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2320.7598,-1782.7258C2306.4873,-1759.5064 2278.3421,-1719.589 2243,-1699.2027 2169.6854,-1656.9129 2113.1639,-1725.6187 2056,-1663.2027 1853.5357,-1442.1367 1940.6354,-1023.8655 1968.5659,-912.514"/>
<polygon fill="#000000" stroke="#000000" points="1971.9856,-913.2685 1971.0725,-902.713 1965.2038,-911.534 1971.9856,-913.2685"/>
</g>
<!-- raw_36 -->
<g id="node37" class="node">
<title>raw_36</title>
<ellipse fill="none" stroke="#000000" cx="2092" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2092" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_33&#45;&gt;raw_36 -->
<g id="edge36" class="edge">
<title>prose_33&#45;&gt;raw_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2458.1437,-1782.2833C2454.7342,-1758.9619 2445.2138,-1719.3336 2419,-1699.2027 2315.6418,-1619.829 2216.5404,-1758.8255 2128,-1663.2027 2025.0568,-1552.0251 2074.6862,-1039.4922 2088.7156,-912.9877"/>
<polygon fill="#000000" stroke="#000000" points="2092.2071,-913.2583 2089.8469,-902.9298 2085.251,-912.4758 2092.2071,-913.2583"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2685,-1663.2041 2137,-1663.2041 2137,-106.1988 2685,-106.1988 2685,-1663.2041"/>
<text text-anchor="middle" x="2411" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2411" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2411" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2411" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2411" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2411" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2411" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2411" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2411" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2411" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2411" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2411" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2411" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2411" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2411" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2411" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2411" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2411" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2411" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2411" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2411" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2411" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2411" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2411" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2411" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2411" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2411" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2411" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2411" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2411" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2411" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2411" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2411" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2411" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2411" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2411" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2411" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2411" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2411" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2411" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2411" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2411" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2411" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2411" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2411" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2411" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2411" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2411" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2411" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2411" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2411" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2411" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2411" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2411" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2411" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2411" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2411" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2411" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2411" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2411" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_34&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>codeblock_34&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.3645,-1782.3466C2585.1608,-1761.191 2577.5447,-1722.8617 2567.7475,-1673.5558"/>
<polygon fill="#000000" stroke="#000000" points="2571.1412,-1672.6762 2565.7593,-1663.5501 2564.2754,-1674.0405 2571.1412,-1672.6762"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="2119,-53.1 2065,-53.1 2065,-17.1 2119,-17.1 2119,-53.1"/>
</g>
<!-- raw_36&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>raw_36&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2092,-866.5632C2092,-758.2631 2092,-197.2221 2092,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2095.5001,-63.4293 2092,-53.4293 2088.5001,-63.4293 2095.5001,-63.4293"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="2859,-902.7014 2703,-902.7014 2703,-866.7014 2859,-866.7014 2859,-902.7014"/>
<text text-anchor="middle" x="2781" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_39&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>header_39&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776.0999,-1782.3466C2776.723,-1668.1955 2780.0756,-1054.0449 2780.8433,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="2784.3451,-913.0603 2780.8999,-903.0413 2777.3453,-913.022 2784.3451,-913.0603"/>
</g>
<!-- raw_44 -->
<g id="node45" class="node">
<title>raw_44</title>
<ellipse fill="none" stroke="#000000" cx="2904" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2904" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_40&#45;&gt;raw_44 -->
<g id="edge44" class="edge">
<title>prose_40&#45;&gt;raw_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.9001,-1782.3466C2908.277,-1668.1955 2904.9244,-1054.0449 2904.1567,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="2907.6547,-913.022 2904.1001,-903.0413 2900.6549,-913.0603 2907.6547,-913.022"/>
</g>
<!-- raw_46 -->
<g id="node47" class="node">
<title>raw_46</title>
<ellipse fill="none" stroke="#000000" cx="2976" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2976" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_46 -->
<g id="edge46" class="edge">
<title>prose_41&#45;&gt;raw_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.7004,-1782.3466C2988.831,-1668.1955 2978.7733,-1054.0449 2976.4701,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="2979.9637,-912.9826 2976.3003,-903.0413 2972.9647,-913.0973 2979.9637,-912.9826"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3576.5,-1412.5035 3021.5,-1412.5035 3021.5,-356.8993 3576.5,-356.8993 3576.5,-1412.5035"/>
<text text-anchor="middle" x="3299" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3299" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3299" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3299" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3299" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3299" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3299" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3299" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3299" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3299" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3299" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3299" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3299" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3299" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3299" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3299" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3299" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3299" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3299" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3299" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3299" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3299" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3299" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3299" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3299" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3299" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3299" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3299" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3299" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3299" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3299" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3299" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3299" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3299" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3299" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3299" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3299" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3299" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3299" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3299" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3299" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3299" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3299" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3299" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3299" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3299" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3299" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3299" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3299" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3299" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3299" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3299" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3299" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3299" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3299" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3299" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3299" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_42&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_42&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3212.7578,-1782.3466C3217.5982,-1731.966 3231.7959,-1584.1907 3247.3099,-1422.7138"/>
<polygon fill="#000000" stroke="#000000" points="3250.8135,-1422.8429 3248.286,-1412.5539 3243.8456,-1422.1734 3250.8135,-1422.8429"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="2708,-63.0015 2188,-63.0015 2188,-7.1986 2708,-7.1986 2708,-63.0015"/>
<text text-anchor="middle" x="2448" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_44&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>raw_44&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2906.0764,-866.5426C2917.7776,-760.5929 2971.3653,-222.9525 2868,-106.2001 2860.2086,-97.3996 2756.5492,-79.8018 2654.174,-64.3163"/>
<polygon fill="#000000" stroke="#000000" points="2654.6839,-60.8537 2644.274,-62.8247 2653.6409,-67.7756 2654.6839,-60.8537"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="3225.5,-62.4005 2726.5,-62.4005 2726.5,-7.7996 3225.5,-7.7996 3225.5,-62.4005"/>
<text text-anchor="middle" x="2976" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2976" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_46&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>raw_46&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2976,-866.5632C2976,-760.635 2976,-221.5794 2976,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2979.5001,-72.6367 2976,-62.6367 2972.5001,-72.6368 2979.5001,-72.6367"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="3925.5,-902.7014 3594.5,-902.7014 3594.5,-866.7014 3925.5,-866.7014 3925.5,-902.7014"/>
<text text-anchor="middle" x="3760" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_49&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>header_49&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3727.6592,-1782.3466C3731.7719,-1668.1955 3753.8988,-1054.0449 3758.9658,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="3762.4768,-913.1608 3759.3392,-903.0413 3755.4814,-912.9087 3762.4768,-913.1608"/>
</g>
<!-- raw_54 -->
<g id="node55" class="node">
<title>raw_54</title>
<ellipse fill="none" stroke="#000000" cx="3971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_50&#45;&gt;raw_54 -->
<g id="edge54" class="edge">
<title>prose_50&#45;&gt;raw_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.0599,-1782.3466C3968.4338,-1668.1955 3970.4453,-1054.0449 3970.906,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="3974.4071,-913.0527 3970.9399,-903.0413 3967.4071,-913.0297 3974.4071,-913.0527"/>
</g>
<!-- raw_56 -->
<g id="node57" class="node">
<title>raw_56</title>
<ellipse fill="none" stroke="#000000" cx="4048" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4048" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_56 -->
<g id="edge56" class="edge">
<title>prose_51&#45;&gt;raw_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4049.96,-1782.3466C4049.7108,-1668.1955 4048.3698,-1054.0449 4048.0627,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4051.562,-913.0336 4048.04,-903.0413 4044.562,-913.0489 4051.562,-913.0336"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="4215,-902.7014 4161,-902.7014 4161,-866.7014 4215,-866.7014 4215,-902.7014"/>
</g>
<!-- codeblock_52&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>codeblock_52&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4188,-1782.3466C4188,-1668.1955 4188,-1054.0449 4188,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4191.5001,-913.0412 4188,-903.0413 4184.5001,-913.0413 4191.5001,-913.0412"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3610,-63.0015 3244,-63.0015 3244,-7.1986 3610,-7.1986 3610,-63.0015"/>
<text text-anchor="middle" x="3427" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_54&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>raw_54&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3973.1435,-866.4566C3985.2235,-760.0173 4040.5535,-220.0631 3934,-106.2001 3885.8589,-54.7566 3688.6927,-80.541 3619,-70.2001 3607.2815,-68.4613 3595.1829,-66.5428 3583.0264,-64.5261"/>
<polygon fill="#000000" stroke="#000000" points="3583.25,-61.0148 3572.8085,-62.8108 3582.0911,-67.9182 3583.25,-61.0148"/>
</g>
<!-- leaf_57 -->
<g id="node58" class="node">
<title>leaf_57</title>
<polygon fill="none" stroke="#c0c0c0" points="3973.5,-55.0021 3628.5,-55.0021 3628.5,-15.198 3973.5,-15.198 3973.5,-55.0021"/>
<text text-anchor="middle" x="3801" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_56&#45;&gt;leaf_57 -->
<g id="edge57" class="edge">
<title>raw_56&#45;&gt;leaf_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4053.4764,-867.0485C4080.6252,-775.7741 4192.2448,-352.1496 4007,-106.2001 3992.9481,-87.5434 3944.533,-70.3443 3898.1698,-57.5365"/>
<polygon fill="#000000" stroke="#000000" points="3898.8877,-54.1049 3888.3207,-54.8711 3897.0592,-60.8619 3898.8877,-54.1049"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4719.5,-902.7014 4500.5,-902.7014 4500.5,-866.7014 4719.5,-866.7014 4719.5,-902.7014"/>
<text text-anchor="middle" x="4610" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_59&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>header_59&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4610,-1782.3466C4610,-1668.1955 4610,-1054.0449 4610,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4613.5001,-913.0412 4610,-903.0413 4606.5001,-913.0413 4613.5001,-913.0412"/>
</g>
<!-- raw_66 -->
<g id="node67" class="node">
<title>raw_66</title>
<ellipse fill="none" stroke="#000000" cx="4769" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4769" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_60&#45;&gt;raw_66 -->
<g id="edge66" class="edge">
<title>prose_60&#45;&gt;raw_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4773.9001,-1782.3466C4773.277,-1668.1955 4769.9244,-1054.0449 4769.1567,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4772.6547,-913.022 4769.1001,-903.0413 4765.6549,-913.0603 4772.6547,-913.022"/>
</g>
<!-- raw_68 -->
<g id="node69" class="node">
<title>raw_68</title>
<ellipse fill="none" stroke="#000000" cx="4848" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4848" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_68 -->
<g id="edge68" class="edge">
<title>prose_61&#45;&gt;raw_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4855.8402,-1782.3466C4854.8432,-1668.1955 4849.4791,-1054.0449 4848.2507,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4851.7475,-913.0103 4848.1602,-903.0413 4844.7478,-913.0715 4851.7475,-913.0103"/>
</g>
<!-- raw_70 -->
<g id="node71" class="node">
<title>raw_70</title>
<ellipse fill="none" stroke="#000000" cx="5223" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5223" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_70 -->
<g id="edge70" class="edge">
<title>prose_62&#45;&gt;raw_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5519.9346,-1789.6551C5478.1228,-1770.5691 5396.7375,-1727.116 5357,-1663.2027 5198.4302,-1408.1614 5213.0916,-1019.8176 5220.6481,-912.8333"/>
<polygon fill="#000000" stroke="#000000" points="5224.1411,-913.0555 5221.3942,-902.823 5217.1605,-912.5351 5224.1411,-913.0555"/>
</g>
<!-- prespace_71 -->
<g id="node72" class="node">
<title>prespace_71</title>
<ellipse fill="none" stroke="#000000" cx="5412" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5412" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_62&#45;&gt;prespace_71 -->
<g id="edge71" class="edge">
<title>prose_62&#45;&gt;prespace_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5533.2421,-1783.9926C5515.0591,-1759.2151 5482.3109,-1710.4684 5468,-1663.2027 5382.5648,-1381.0302 5401.9013,-1016.166 5409.6314,-912.9857"/>
<polygon fill="#000000" stroke="#000000" points="5413.1402,-913.0068 5410.4246,-902.7659 5406.1612,-912.4651 5413.1402,-913.0068"/>
</g>
<!-- literal_72 -->
<g id="node73" class="node">
<title>literal_72</title>
<ellipse fill="none" stroke="#000000" cx="5508" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5508" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_62&#45;&gt;literal_72 -->
<g id="edge72" class="edge">
<title>prose_62&#45;&gt;literal_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5545.2409,-1782.3466C5540.5051,-1668.1955 5515.0256,-1054.0449 5509.1909,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="5512.6725,-912.8876 5508.7609,-903.0413 5505.6785,-913.1778 5512.6725,-912.8876"/>
</g>
<!-- raw_73 -->
<g id="node74" class="node">
<title>raw_73</title>
<ellipse fill="none" stroke="#000000" cx="5584" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5584" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_73 -->
<g id="edge73" class="edge">
<title>prose_62&#45;&gt;raw_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5546.7591,-1782.3466C5551.4949,-1668.1955 5576.9744,-1054.0449 5582.8091,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="5586.3215,-913.1778 5583.2391,-903.0413 5579.3275,-912.8876 5586.3215,-913.1778"/>
</g>
<!-- prespace_74 -->
<g id="node75" class="node">
<title>prespace_74</title>
<ellipse fill="none" stroke="#000000" cx="5675" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5675" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_62&#45;&gt;prespace_74 -->
<g id="edge74" class="edge">
<title>prose_62&#45;&gt;prespace_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5558.1017,-1783.8827C5575.3497,-1758.9683 5606.4154,-1710.0528 5620,-1663.2027 5702.0969,-1380.0689 5684.3742,-1015.8774 5677.2037,-912.9208"/>
<polygon fill="#000000" stroke="#000000" points="5680.6786,-912.4453 5676.4673,-902.7235 5673.6968,-912.9496 5680.6786,-912.4453"/>
</g>
<!-- literal_75 -->
<g id="node76" class="node">
<title>literal_75</title>
<ellipse fill="none" stroke="#000000" cx="5771" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5771" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_62&#45;&gt;literal_75 -->
<g id="edge75" class="edge">
<title>prose_62&#45;&gt;literal_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5572.2442,-1789.9542C5614.1836,-1771.2931 5695.1303,-1728.4304 5730,-1663.2027 5801.2288,-1529.9614 5779.4021,-1037.0063 5772.6546,-913.1033"/>
<polygon fill="#000000" stroke="#000000" points="5776.1379,-912.7035 5772.0879,-902.9133 5769.1487,-913.0923 5776.1379,-912.7035"/>
</g>
<!-- raw_76 -->
<g id="node77" class="node">
<title>raw_76</title>
<ellipse fill="none" stroke="#000000" cx="5847" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5847" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_76 -->
<g id="edge76" class="edge">
<title>prose_62&#45;&gt;raw_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5568.779,-1787.6668C5603.7438,-1767.8907 5672.9085,-1729.3293 5733,-1699.2027 5767.1316,-1682.0911 5789.6848,-1694.8798 5811,-1663.2027 5895.4114,-1537.7568 5859.8704,-1037.9501 5849.4874,-913.0844"/>
<polygon fill="#000000" stroke="#000000" points="5852.95,-912.4935 5848.62,-902.8239 5845.9749,-913.0832 5852.95,-912.4935"/>
</g>
<!-- raw_84 -->
<g id="node85" class="node">
<title>raw_84</title>
<ellipse fill="none" stroke="#000000" cx="5919" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5919" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_84 -->
<g id="edge84" class="edge">
<title>prose_63&#45;&gt;raw_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5791.6067,-1785.4571C5817.1836,-1762.1545 5863.6667,-1714.8232 5883,-1663.2027 5986.4676,-1386.9409 5939.8033,-1016.548 5923.6866,-912.762"/>
<polygon fill="#000000" stroke="#000000" points="5927.1235,-912.0882 5922.0983,-902.7609 5920.2102,-913.1862 5927.1235,-912.0882"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6470,-1127.7024 5964,-1127.7024 5964,-641.7005 6470,-641.7005 6470,-1127.7024"/>
<text text-anchor="middle" x="6217" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6217" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6217" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6217" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6217" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6217" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6217" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6217" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6217" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6217" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6217" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6217" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6217" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6217" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6217" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6217" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6217" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6217" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6217" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6217" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6217" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6217" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6217" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6217" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6217" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_64&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>codeblock_64&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6068.0363,-1782.3466C6081.3649,-1702.0293 6135.7709,-1374.1825 6174.9809,-1137.9057"/>
<polygon fill="#000000" stroke="#000000" points="6178.4765,-1138.2202 6176.6609,-1127.7821 6171.5709,-1137.0742 6178.4765,-1138.2202"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="4266.5,-63.0015 3991.5,-63.0015 3991.5,-7.1986 4266.5,-7.1986 4266.5,-63.0015"/>
<text text-anchor="middle" x="4129" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_66&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>raw_66&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4771.0611,-866.7402C4782.7979,-760.7755 4836.9239,-218.0898 4728,-106.2001 4692.8567,-70.0999 4325.7621,-78.0741 4276,-70.2001 4266.3787,-68.6777 4256.4565,-66.8587 4246.523,-64.8611"/>
<polygon fill="#000000" stroke="#000000" points="4247.098,-61.406 4236.5964,-62.8083 4245.6804,-68.261 4247.098,-61.406"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="4847,-70.3004 4285,-70.3004 4285,.1003 4847,.1003 4847,-70.3004"/>
<text text-anchor="middle" x="4566" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4566" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4566" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_68&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>raw_68&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4853.616,-866.8898C4881.4524,-774.8238 4995.8487,-347.8812 4805,-106.2001 4795.2982,-93.9142 4772.0023,-82.8954 4743.5678,-73.4082"/>
<polygon fill="#000000" stroke="#000000" points="4744.3313,-69.9774 4733.74,-70.25 4742.1896,-76.6417 4744.3313,-69.9774"/>
</g>
<!-- leaf_77 -->
<g id="node78" class="node">
<title>leaf_77</title>
<polygon fill="none" stroke="#c0c0c0" points="5385,-62.4005 4865,-62.4005 4865,-7.7996 5385,-7.7996 5385,-62.4005"/>
<text text-anchor="middle" x="5125" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5125" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_70&#45;&gt;leaf_77 -->
<g id="edge77" class="edge">
<title>raw_70&#45;&gt;leaf_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5220.9078,-866.5632C5208.6769,-760.5289 5146.3855,-220.4998 5129.3252,-72.5967"/>
<polygon fill="#000000" stroke="#000000" points="5132.7992,-72.1698 5128.1763,-62.6367 5125.8453,-72.972 5132.7992,-72.1698"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5457,-53.1 5403,-53.1 5403,-17.1 5457,-17.1 5457,-53.1"/>
<text text-anchor="middle" x="5430" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>prespace_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5412.3843,-866.5632C5414.6788,-758.2631 5426.5652,-197.2221 5429.3949,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="5432.899,-63.5012 5429.6117,-53.4293 5425.9005,-63.3529 5432.899,-63.5012"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5540.5,-53.1 5475.5,-53.1 5475.5,-17.1 5540.5,-17.1 5540.5,-53.1"/>
<text text-anchor="middle" x="5508" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>literal_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5508,-866.5632C5508,-758.2631 5508,-197.2221 5508,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="5511.5001,-63.4293 5508,-53.4293 5504.5001,-63.4293 5511.5001,-63.4293"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5827,-54.4006 5559,-54.4006 5559,-15.7995 5827,-15.7995 5827,-54.4006"/>
<text text-anchor="middle" x="5693" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5693" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>raw_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5583.0647,-866.6337C5577.9846,-763.4262 5556.2139,-248.1207 5620,-106.2001 5627.8815,-88.6642 5642.2262,-73.204 5656.1266,-61.2173"/>
<polygon fill="#000000" stroke="#000000" points="5658.707,-63.6268 5664.2074,-54.5716 5654.2606,-58.2203 5658.707,-63.6268"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5899,-53.1 5845,-53.1 5845,-17.1 5899,-17.1 5899,-53.1"/>
<text text-anchor="middle" x="5872" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>prespace_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5673.697,-866.4082C5666.5531,-760.8315 5635.8279,-229.8066 5731,-106.2001 5761.097,-67.1111 5793.9813,-96.0499 5836,-70.2001 5840.5306,-67.4129 5844.9441,-63.9638 5849.0395,-60.3258"/>
<polygon fill="#000000" stroke="#000000" points="5851.661,-62.6618 5856.4704,-53.2215 5846.8236,-57.6021 5851.661,-62.6618"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5975,-53.1 5917,-53.1 5917,-17.1 5975,-17.1 5975,-53.1"/>
<text text-anchor="middle" x="5946" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>literal_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5769.3337,-866.4682C5760.0909,-761.2292 5718.7841,-231.7834 5811,-106.2001 5838.2168,-69.1351 5868.8107,-94.2576 5908,-70.2001 5912.5708,-67.3942 5917.0769,-63.9873 5921.2999,-60.4126"/>
<polygon fill="#000000" stroke="#000000" points="5923.9389,-62.7453 5929.0142,-53.4451 5919.247,-57.5504 5923.9389,-62.7453"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="6079,-53.1 5993,-53.1 5993,-17.1 6079,-17.1 6079,-53.1"/>
<text text-anchor="middle" x="6036" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>raw_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5845.2062,-866.4562C5835.2323,-761.1498 5790.3148,-231.3889 5883,-106.2001 5911.3563,-67.8995 5941.4707,-91.7006 5984,-70.2001 5990.5491,-66.8892 5997.2528,-62.8899 6003.5761,-58.7937"/>
<polygon fill="#000000" stroke="#000000" points="6005.5563,-61.68 6011.9127,-53.2037 6001.6578,-55.866 6005.5563,-61.68"/>
</g>
<!-- leaf_85 -->
<g id="node86" class="node">
<title>leaf_85</title>
<polygon fill="none" stroke="#c0c0c0" points="6631,-62.4005 6097,-62.4005 6097,-7.7996 6631,-7.7996 6631,-62.4005"/>
<text text-anchor="middle" x="6364" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6364" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_84&#45;&gt;leaf_85 -->
<g id="edge85" class="edge">
<title>raw_84&#45;&gt;leaf_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5916.9313,-866.5494C5905.2739,-760.6384 5851.8931,-223.1808 5955,-106.2001 5962.653,-97.5174 6065.6301,-79.643 6166.3284,-63.9893"/>
<polygon fill="#000000" stroke="#000000" points="6167.0303,-67.4225 6176.3769,-62.4334 6165.9591,-60.5049 6167.0303,-67.4225"/>
</g>
<!-- leaf_92 -->
<g id="node93" class="node">
<title>leaf_92</title>
<polygon fill="none" stroke="#c0c0c0" points="7152.5,-1818.6429 6961.5,-1818.6429 6961.5,-1782.6429 7152.5,-1782.6429 7152.5,-1818.6429"/>
<text text-anchor="middle" x="7057" y="-1797.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_87&#45;&gt;leaf_92 -->
<g id="edge92" class="edge">
<title>header_87&#45;&gt;leaf_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7057,-1985.6647C7057,-1950.309 7057,-1871.6001 7057,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="7060.5001,-1828.9128 7057,-1818.9128 7053.5001,-1828.9129 7060.5001,-1828.9128"/>
</g>
<!-- raw_93 -->
<g id="node94" class="node">
<title>raw_93</title>
<ellipse fill="none" stroke="#000000" cx="7207" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="7207" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_88&#45;&gt;raw_93 -->
<g id="edge93" class="edge">
<title>prose_88&#45;&gt;raw_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7214.2901,-1985.6647C7212.897,-1950.309 7209.7958,-1871.6001 7208.1223,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="7211.6109,-1828.7673 7207.7199,-1818.9128 7204.6164,-1829.0429 7211.6109,-1828.7673"/>
</g>
<!-- raw_95 -->
<g id="node96" class="node">
<title>raw_95</title>
<ellipse fill="none" stroke="#000000" cx="7297" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="7297" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_95 -->
<g id="edge95" class="edge">
<title>prose_89&#45;&gt;raw_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7297,-1985.6647C7297,-1950.309 7297,-1871.6001 7297,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="7300.5001,-1828.9128 7297,-1818.9128 7293.5001,-1828.9129 7300.5001,-1828.9128"/>
</g>
<!-- header_97 -->
<g id="node98" class="node">
<title>header_97</title>
<ellipse fill="none" stroke="#000000" cx="7691" cy="-1800.6429" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7691" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_90&#45;&gt;header_97 -->
<g id="edge97" class="edge">
<title>section_90&#45;&gt;header_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7870.8622,-1986.0199C7835.6999,-1949.7794 7755.3247,-1866.9399 7715.0012,-1825.38"/>
<polygon fill="#000000" stroke="#000000" points="7717.4334,-1822.8606 7707.9579,-1818.1208 7712.4095,-1827.7351 7717.4334,-1822.8606"/>
</g>
<!-- prose_98 -->
<g id="node99" class="node">
<title>prose_98</title>
<ellipse fill="none" stroke="#000000" cx="7888" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7888" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_90&#45;&gt;prose_98 -->
<g id="edge98" class="edge">
<title>section_90&#45;&gt;prose_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7888,-1985.6647C7888,-1950.309 7888,-1871.6001 7888,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="7891.5001,-1828.9128 7888,-1818.9128 7884.5001,-1828.9129 7891.5001,-1828.9128"/>
</g>
<!-- prose_99 -->
<g id="node100" class="node">
<title>prose_99</title>
<ellipse fill="none" stroke="#000000" cx="8512" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8512" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_90&#45;&gt;prose_99 -->
<g id="edge99" class="edge">
<title>section_90&#45;&gt;prose_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7932.8765,-1989.081C8050.3501,-1950.8569 8365.3192,-1848.3706 8474.2861,-1812.9144"/>
<polygon fill="#000000" stroke="#000000" points="8475.4506,-1816.2162 8483.8769,-1809.7937 8473.2847,-1809.5597 8475.4506,-1816.2162"/>
</g>
<!-- codeblock_100 -->
<g id="node101" class="node">
<title>codeblock_100</title>
<ellipse fill="none" stroke="#000000" cx="8846" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8846" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 301&#45;315</text>
</g>
<!-- section_90&#45;&gt;codeblock_100 -->
<g id="edge100" class="edge">
<title>section_90&#45;&gt;codeblock_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7958.7177,-1997.1439C8081.1276,-1984.8813 8339.8547,-1954.7977 8553,-1902.083 8640.9288,-1880.3366 8739.8525,-1843.3526 8797.3298,-1820.557"/>
<polygon fill="#000000" stroke="#000000" points="8798.8868,-1823.7042 8806.879,-1816.7489 8796.2938,-1817.2022 8798.8868,-1823.7042"/>
</g>
<!-- header_123 -->
<g id="node124" class="node">
<title>header_123</title>
<ellipse fill="none" stroke="#000000" cx="9435" cy="-1800.6429" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9435" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_91&#45;&gt;header_123 -->
<g id="edge123" class="edge">
<title>section_91&#45;&gt;header_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9653.2084,-1986.0199C9610.3916,-1949.6453 9512.3158,-1866.3258 9463.5769,-1824.9201"/>
<polygon fill="#000000" stroke="#000000" points="9465.8009,-1822.217 9455.9137,-1818.4099 9461.2688,-1827.5518 9465.8009,-1822.217"/>
</g>
<!-- prose_124 -->
<g id="node125" class="node">
<title>prose_124</title>
<ellipse fill="none" stroke="#000000" cx="9674" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9674" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_124 -->
<g id="edge124" class="edge">
<title>section_91&#45;&gt;prose_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9674,-1985.6647C9674,-1950.309 9674,-1871.6001 9674,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="9677.5001,-1828.9128 9674,-1818.9128 9670.5001,-1828.9129 9677.5001,-1828.9128"/>
</g>
<!-- prose_125 -->
<g id="node126" class="node">
<title>prose_125</title>
<ellipse fill="none" stroke="#000000" cx="9813" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9813" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_125 -->
<g id="edge125" class="edge">
<title>section_91&#45;&gt;prose_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9686.3353,-1985.6647C9711.1574,-1949.4065 9767.1934,-1867.5536 9795.6765,-1825.9478"/>
<polygon fill="#000000" stroke="#000000" points="9798.7171,-1827.702 9801.4781,-1817.4732 9792.941,-1823.7477 9798.7171,-1827.702"/>
</g>
<!-- codeblock_126 -->
<g id="node127" class="node">
<title>codeblock_126</title>
<ellipse fill="none" stroke="#000000" cx="10072" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="10072" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 327&#45;397</text>
</g>
<!-- section_91&#45;&gt;codeblock_126 -->
<g id="edge126" class="edge">
<title>section_91&#45;&gt;codeblock_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9706.2329,-1987.2395C9777.8094,-1950.7246 9949.9755,-1862.8938 10029.9093,-1822.1155"/>
<polygon fill="#000000" stroke="#000000" points="10031.8698,-1825.0446 10039.1871,-1817.3824 10028.6887,-1818.8091 10031.8698,-1825.0446"/>
</g>
<!-- leaf_94 -->
<g id="node95" class="node">
<title>leaf_94</title>
<polygon fill="none" stroke="#c0c0c0" points="7001.5,-920.0018 6488.5,-920.0018 6488.5,-849.4011 7001.5,-849.4011 7001.5,-920.0018"/>
<text text-anchor="middle" x="6745" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6745" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_93&#45;&gt;leaf_94 -->
<g id="edge94" class="edge">
<title>raw_93&#45;&gt;leaf_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7203.8551,-1782.6758C7198.8812,-1759.7787 7186.9596,-1720.6086 7161,-1699.2027 7107.7705,-1655.3106 7061.0241,-1709.6402 7010,-1663.2027 6787.6834,-1460.8707 6751.8031,-1064.7546 6746.0702,-930.4746"/>
<polygon fill="#000000" stroke="#000000" points="6749.5547,-930.0063 6745.6677,-920.1503 6742.56,-930.2791 6749.5547,-930.0063"/>
</g>
<!-- leaf_96 -->
<g id="node97" class="node">
<title>leaf_96</title>
<polygon fill="none" stroke="#c0c0c0" points="7574.5,-927.9017 7019.5,-927.9017 7019.5,-841.5011 7574.5,-841.5011 7574.5,-927.9017"/>
<text text-anchor="middle" x="7297" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7297" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7297" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_95&#45;&gt;leaf_96 -->
<g id="edge96" class="edge">
<title>raw_95&#45;&gt;leaf_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7297,-1782.3466C7297,-1673.9451 7297,-1114.6439 7297,-938.1368"/>
<polygon fill="#000000" stroke="#000000" points="7300.5001,-938.0508 7297,-928.0509 7293.5001,-938.0509 7300.5001,-938.0508"/>
</g>
<!-- leaf_101 -->
<g id="node102" class="node">
<title>leaf_101</title>
<polygon fill="none" stroke="#c0c0c0" points="7699.5,-902.7014 7592.5,-902.7014 7592.5,-866.7014 7699.5,-866.7014 7699.5,-902.7014"/>
<text text-anchor="middle" x="7646" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_97&#45;&gt;leaf_101 -->
<g id="edge101" class="edge">
<title>header_97&#45;&gt;leaf_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7690.1011,-1782.3466C7684.4929,-1668.1955 7654.3198,-1054.0449 7647.4103,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="7650.8876,-912.8574 7646.901,-903.0413 7643.896,-913.201 7650.8876,-912.8574"/>
</g>
<!-- raw_102 -->
<g id="node103" class="node">
<title>raw_102</title>
<ellipse fill="none" stroke="#000000" cx="7745" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7745" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_98&#45;&gt;raw_102 -->
<g id="edge102" class="edge">
<title>prose_98&#45;&gt;raw_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7870.7132,-1785.3855C7845.6016,-1761.9917 7799.9663,-1714.5454 7781,-1663.2027 7678.7762,-1386.4783 7724.5656,-1016.4108 7740.3955,-912.7315"/>
<polygon fill="#000000" stroke="#000000" points="7743.8707,-913.1612 7741.9557,-902.7409 7736.9546,-912.0811 7743.8707,-913.1612"/>
</g>
<!-- prespace_103 -->
<g id="node104" class="node">
<title>prespace_103</title>
<ellipse fill="none" stroke="#000000" cx="7836" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7836" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_98&#45;&gt;prespace_103 -->
<g id="edge103" class="edge">
<title>prose_98&#45;&gt;prespace_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7886.9613,-1782.3466C7880.4807,-1668.1955 7845.614,-1054.0449 7837.6296,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="7841.1025,-912.8268 7837.0412,-903.0413 7834.1137,-913.2236 7841.1025,-912.8268"/>
</g>
<!-- literal_104 -->
<g id="node105" class="node">
<title>literal_104</title>
<ellipse fill="none" stroke="#000000" cx="7932" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7932" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_98&#45;&gt;literal_104 -->
<g id="edge104" class="edge">
<title>prose_98&#45;&gt;literal_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7888.8789,-1782.3466C7894.3625,-1668.1955 7923.8651,-1054.0449 7930.6211,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="7934.135,-913.1977 7931.119,-903.0413 7927.1431,-912.8618 7934.135,-913.1977"/>
</g>
<!-- raw_105 -->
<g id="node106" class="node">
<title>raw_105</title>
<ellipse fill="none" stroke="#000000" cx="8008" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8008" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_98&#45;&gt;raw_105 -->
<g id="edge105" class="edge">
<title>prose_98&#45;&gt;raw_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7901.9141,-1784.2203C7921.7136,-1759.7264 7957.2495,-1711.3296 7972,-1663.2027 8058.2638,-1381.7484 8023.9012,-1016.3816 8011.6412,-913.0343"/>
<polygon fill="#000000" stroke="#000000" points="8015.078,-912.3017 8010.396,-902.7976 8008.1292,-913.1471 8015.078,-912.3017"/>
</g>
<!-- prespace_110 -->
<g id="node111" class="node">
<title>prespace_110</title>
<ellipse fill="none" stroke="#000000" cx="8237" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8237" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_110 -->
<g id="edge110" class="edge">
<title>prose_99&#45;&gt;prespace_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8489.8429,-1787.3705C8456.1332,-1765.8881 8392.655,-1720.107 8362,-1663.2027 8220.1348,-1399.8616 8229.3814,-1018.8696 8235.1306,-912.9466"/>
<polygon fill="#000000" stroke="#000000" points="8238.6369,-912.9376 8235.7209,-902.7519 8231.6486,-912.5328 8238.6369,-912.9376"/>
</g>
<!-- literal_111 -->
<g id="node112" class="node">
<title>literal_111</title>
<ellipse fill="none" stroke="#000000" cx="8402" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8402" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_111 -->
<g id="edge111" class="edge">
<title>prose_99&#45;&gt;literal_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8506.2805,-1782.6197C8498.2374,-1756.5507 8483.7079,-1706.6771 8476,-1663.2027 8424.5471,-1372.9951 8407.1445,-1015.1509 8403.043,-913.0757"/>
<polygon fill="#000000" stroke="#000000" points="8406.5352,-912.8075 8402.6466,-902.9521 8399.5406,-913.0814 8406.5352,-912.8075"/>
</g>
<!-- raw_112 -->
<g id="node113" class="node">
<title>raw_112</title>
<ellipse fill="none" stroke="#000000" cx="8512" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8512" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_112 -->
<g id="edge112" class="edge">
<title>prose_99&#45;&gt;raw_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8512,-1782.3466C8512,-1668.1955 8512,-1054.0449 8512,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="8515.5001,-913.0412 8512,-903.0413 8508.5001,-913.0413 8515.5001,-913.0412"/>
</g>
<!-- prespace_113 -->
<g id="node114" class="node">
<title>prespace_113</title>
<ellipse fill="none" stroke="#000000" cx="8603" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8603" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_113 -->
<g id="edge113" class="edge">
<title>prose_99&#45;&gt;prespace_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8517.8626,-1782.6442C8526.0799,-1756.605 8540.8196,-1706.7673 8548,-1663.2027 8595.836,-1372.9762 8602.0928,-1015.1451 8602.8897,-913.0744"/>
<polygon fill="#000000" stroke="#000000" points="8606.3904,-912.9742 8602.9568,-902.9512 8599.3905,-912.9278 8606.3904,-912.9742"/>
</g>
<!-- literal_114 -->
<g id="node115" class="node">
<title>literal_114</title>
<ellipse fill="none" stroke="#000000" cx="8699" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8699" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_114 -->
<g id="edge114" class="edge">
<title>prose_99&#45;&gt;literal_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8534.3087,-1787.5881C8568.1128,-1766.3967 8631.2059,-1720.9989 8658,-1663.2027 8782.2536,-1395.1816 8724.4271,-1018.2464 8704.6861,-912.9749"/>
<polygon fill="#000000" stroke="#000000" points="8708.0627,-911.9986 8702.7431,-902.8361 8701.1878,-913.3161 8708.0627,-911.9986"/>
</g>
<!-- raw_115 -->
<g id="node116" class="node">
<title>raw_115</title>
<ellipse fill="none" stroke="#000000" cx="8775" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8775" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_115 -->
<g id="edge115" class="edge">
<title>prose_99&#45;&gt;raw_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8541.3652,-1792.7087C8591.9838,-1777.2945 8694.51,-1738.0516 8739,-1663.2027 8816.2565,-1533.2282 8786.0539,-1036.8004 8777.1415,-912.8655"/>
<polygon fill="#000000" stroke="#000000" points="8780.6169,-912.4001 8776.3963,-902.6823 8773.6356,-912.9111 8780.6169,-912.4001"/>
</g>
<!-- leaf_122 -->
<g id="node123" class="node">
<title>leaf_122</title>
<polygon fill="none" stroke="#c0c0c0" points="9263.5,-981.6022 8820.5,-981.6022 8820.5,-787.8007 9263.5,-787.8007 9263.5,-981.6022"/>
<text text-anchor="middle" x="9042" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="9042" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="9042" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="9042" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="9042" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="9042" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="9042" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="9042" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9042" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="9042" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="9042" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_100&#45;&gt;leaf_122 -->
<g id="edge122" class="edge">
<title>codeblock_100&#45;&gt;leaf_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8849.9152,-1782.3466C8871.1196,-1683.2549 8972.9495,-1207.3863 9019.1346,-991.5554"/>
<polygon fill="#000000" stroke="#000000" points="9022.6212,-991.9878 9021.2913,-981.4768 9015.7762,-990.523 9022.6212,-991.9878"/>
</g>
<!-- leaf_106 -->
<g id="node107" class="node">
<title>leaf_106</title>
<polygon fill="none" stroke="#c0c0c0" points="7726.5,-63.0015 7437.5,-63.0015 7437.5,-7.1986 7726.5,-7.1986 7726.5,-63.0015"/>
<text text-anchor="middle" x="7582" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_102&#45;&gt;leaf_106 -->
<g id="edge106" class="edge">
<title>raw_102&#45;&gt;leaf_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7746.4328,-866.6817C7754.3713,-762.644 7789.7228,-238.8164 7708,-106.2001 7698.3271,-90.5034 7683.8416,-77.9626 7668.0987,-68.0584"/>
<polygon fill="#000000" stroke="#000000" points="7669.6352,-64.9009 7659.2459,-62.824 7666.0725,-70.9264 7669.6352,-64.9009"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7799,-53.1 7745,-53.1 7745,-17.1 7799,-17.1 7799,-53.1"/>
<text text-anchor="middle" x="7772" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>prespace_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7835.091,-866.5655C7830.7266,-781.0513 7810.8958,-409.5908 7781,-106.2001 7779.6083,-92.0765 7777.6701,-76.4238 7775.9486,-63.4085"/>
<polygon fill="#000000" stroke="#000000" points="7779.3754,-62.6298 7774.5703,-53.1873 7772.4382,-63.5654 7779.3754,-62.6298"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7871,-53.1 7817,-53.1 7817,-17.1 7871,-17.1 7871,-53.1"/>
<text text-anchor="middle" x="7844" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>literal_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7934.4607,-866.5267C7945.5754,-779.3188 7986.5297,-396.0643 7891,-106.2001 7885.694,-90.1002 7875.7245,-74.1711 7866.3281,-61.4843"/>
<polygon fill="#000000" stroke="#000000" points="7868.8591,-59.0352 7859.9787,-53.2568 7863.3174,-63.3119 7868.8591,-59.0352"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="8108.5,-54.4006 7889.5,-54.4006 7889.5,-15.7995 8108.5,-15.7995 8108.5,-54.4006"/>
<text text-anchor="middle" x="7999" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7999" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>raw_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8007.8079,-866.5632C8006.6632,-758.5056 8000.744,-199.7321 7999.3121,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8002.8117,-64.4941 7999.2058,-54.5318 7995.8121,-64.5683 8002.8117,-64.4941"/>
</g>
<!-- leaf_116 -->
<g id="node117" class="node">
<title>leaf_116</title>
<polygon fill="none" stroke="#c0c0c0" points="8181,-53.1 8127,-53.1 8127,-17.1 8181,-17.1 8181,-53.1"/>
</g>
<!-- prespace_110&#45;&gt;leaf_116 -->
<g id="edge116" class="edge">
<title>prespace_110&#45;&gt;leaf_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8235.228,-866.5632C8224.6479,-758.2631 8169.8382,-197.2221 8156.7901,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="8160.2464,-63.0416 8155.7906,-53.4293 8153.2796,-63.7222 8160.2464,-63.0416"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="8362.5,-53.1 8199.5,-53.1 8199.5,-17.1 8362.5,-17.1 8362.5,-53.1"/>
<text text-anchor="middle" x="8281" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>literal_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8399.5296,-866.5841C8387.862,-781.1537 8336.9637,-410.0136 8292,-106.2001 8289.9142,-92.1065 8287.5033,-76.4571 8285.4712,-63.4361"/>
<polygon fill="#000000" stroke="#000000" points="8288.8745,-62.5462 8283.8687,-53.2085 8281.9589,-63.6298 8288.8745,-62.5462"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8725.5,-54.4006 8380.5,-54.4006 8380.5,-15.7995 8725.5,-15.7995 8725.5,-54.4006"/>
<text text-anchor="middle" x="8553" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8553" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>raw_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8512.6767,-866.5884C8515.9016,-781.1774 8530.2897,-410.1116 8548,-106.2001 8548.7986,-92.4957 8549.844,-77.3168 8550.7724,-64.5151"/>
<polygon fill="#000000" stroke="#000000" points="8554.2729,-64.6352 8551.5167,-54.4052 8547.2918,-64.1212 8554.2729,-64.6352"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8798,-53.1 8744,-53.1 8744,-17.1 8798,-17.1 8798,-53.1"/>
<text text-anchor="middle" x="8771" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>prespace_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8598.3307,-866.7841C8575.7603,-775.9267 8485.9415,-360.4976 8659,-106.2001 8679.8023,-75.6325 8703.5524,-91.1776 8734,-70.2001 8738.2654,-67.2614 8742.5134,-63.8328 8746.5294,-60.2918"/>
<polygon fill="#000000" stroke="#000000" points="8748.9605,-62.8107 8753.9096,-53.4428 8744.1988,-57.6797 8748.9605,-62.8107"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="8870,-53.1 8816,-53.1 8816,-17.1 8870,-17.1 8870,-53.1"/>
<text text-anchor="middle" x="8843" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>literal_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8697.5902,-866.6439C8689.7912,-762.3937 8655.236,-237.5718 8739,-106.2001 8757.3847,-77.3663 8779.3649,-90.3417 8807,-70.2001 8811.0209,-67.2695 8815.036,-63.9038 8818.8485,-60.4421"/>
<polygon fill="#000000" stroke="#000000" points="8821.5056,-62.7446 8826.3266,-53.3101 8816.6745,-57.6789 8821.5056,-62.7446"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="9324,-54.4006 8888,-54.4006 8888,-15.7995 9324,-15.7995 9324,-54.4006"/>
<text text-anchor="middle" x="9106" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="9106" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_115&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>raw_115&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8773.045,-866.6464C8762.0346,-761.2875 8711.712,-226.439 8811,-106.2001 8829.4693,-83.8336 8886.6341,-67.5533 8945.7868,-56.2618"/>
<polygon fill="#000000" stroke="#000000" points="8946.4866,-59.6917 8955.6781,-54.4222 8945.2066,-52.8097 8946.4866,-59.6917"/>
</g>
<!-- leaf_127 -->
<g id="node128" class="node">
<title>leaf_127</title>
<polygon fill="none" stroke="#c0c0c0" points="9489.5,-902.7014 9298.5,-902.7014 9298.5,-866.7014 9489.5,-866.7014 9489.5,-902.7014"/>
<text text-anchor="middle" x="9394" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_123&#45;&gt;leaf_127 -->
<g id="edge127" class="edge">
<title>header_123&#45;&gt;leaf_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9434.181,-1782.3466C9429.0713,-1668.1955 9401.5803,-1054.0449 9395.2849,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="9398.7647,-912.8747 9394.8209,-903.0413 9391.7717,-913.1878 9398.7647,-912.8747"/>
</g>
<!-- raw_128 -->
<g id="node129" class="node">
<title>raw_128</title>
<ellipse fill="none" stroke="#000000" cx="9535" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9535" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_124&#45;&gt;raw_128 -->
<g id="edge128" class="edge">
<title>prose_124&#45;&gt;raw_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9656.9514,-1784.852C9632.6894,-1761.1449 9589.1351,-1713.7187 9571,-1663.2027 9471.3233,-1385.5507 9515.3211,-1016.1356 9530.5636,-912.6702"/>
<polygon fill="#000000" stroke="#000000" points="9534.0366,-913.1106 9532.0661,-902.7006 9527.1148,-912.0673 9534.0366,-913.1106"/>
</g>
<!-- prespace_129 -->
<g id="node130" class="node">
<title>prespace_129</title>
<ellipse fill="none" stroke="#000000" cx="9626" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9626" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_124&#45;&gt;prespace_129 -->
<g id="edge129" class="edge">
<title>prose_124&#45;&gt;prespace_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9673.0412,-1782.3466C9667.0591,-1668.1955 9634.8745,-1054.0449 9627.5043,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="9630.9797,-912.8444 9626.9611,-903.0413 9623.9893,-913.2108 9630.9797,-912.8444"/>
</g>
<!-- literal_130 -->
<g id="node131" class="node">
<title>literal_130</title>
<ellipse fill="none" stroke="#000000" cx="9722" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9722" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_124&#45;&gt;literal_130 -->
<g id="edge130" class="edge">
<title>prose_124&#45;&gt;literal_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9674.9588,-1782.3466C9680.9409,-1668.1955 9713.1255,-1054.0449 9720.4957,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="9724.0107,-913.2108 9721.0389,-903.0413 9717.0203,-912.8444 9724.0107,-913.2108"/>
</g>
<!-- raw_131 -->
<g id="node132" class="node">
<title>raw_131</title>
<ellipse fill="none" stroke="#000000" cx="9798" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9798" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_124&#45;&gt;raw_131 -->
<g id="edge131" class="edge">
<title>prose_124&#45;&gt;raw_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9688.5765,-1784.3459C9709.3184,-1760.0084 9746.5461,-1711.8045 9762,-1663.2027 9851.2926,-1382.382 9814.7095,-1015.9161 9801.8006,-912.7827"/>
<polygon fill="#000000" stroke="#000000" points="9805.269,-912.3118 9800.5257,-902.8381 9798.3258,-913.202 9805.269,-912.3118"/>
</g>
<!-- raw_136 -->
<g id="node137" class="node">
<title>raw_136</title>
<ellipse fill="none" stroke="#000000" cx="9870" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9870" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_136 -->
<g id="edge136" class="edge">
<title>prose_125&#45;&gt;raw_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9816.3986,-1782.4899C9821.1662,-1756.2629 9829.7331,-1706.1987 9834,-1663.2027 9863.0065,-1370.914 9868.7058,-1014.5182 9869.7681,-912.9315"/>
<polygon fill="#000000" stroke="#000000" points="9873.2686,-912.891 9869.8667,-902.8572 9866.2689,-912.8224 9873.2686,-912.891"/>
</g>
<!-- leaf_138 -->
<g id="node139" class="node">
<title>leaf_138</title>
<polygon fill="none" stroke="#c0c0c0" points="10470.5,-1421.3035 9915.5,-1421.3035 9915.5,-348.0993 10470.5,-348.0993 10470.5,-1421.3035"/>
<text text-anchor="middle" x="10193" y="-1406.3024" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = assert(table.concat)</text>
<text text-anchor="middle" x="10193" y="-1374.9024" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="10193" y="-1359.5024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="10193" y="-1344.1023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="10193" y="-1328.7023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="10193" y="-1313.3023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="10193" y="-1297.9022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="10193" y="-1282.5022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(char)</text>
<text text-anchor="middle" x="10193" y="-1267.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="10193" y="-1251.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="10193" y="-1236.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-1220.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="10193" y="-1205.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="10193" y="-1190.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="10193" y="-1174.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="10193" y="-1159.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="10193" y="-1143.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-1128.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="10193" y="-1113.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="10193" y="-1097.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="10193" y="-1082.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-1066.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="10193" y="-1051.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="10193" y="-1036.1017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="10193" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="10193" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="10193" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return &quot;{ &#160;}&quot;</text>
<text text-anchor="middle" x="10193" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="10193" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="10193" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase</text>
<text text-anchor="middle" x="10193" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="10193" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="10193" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="10193" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="10193" y="-803.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
<text text-anchor="middle" x="10193" y="-756.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="10193" y="-741.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="10193" y="-725.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="10193" y="-710.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="10193" y="-694.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="10193" y="-679.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="10193" y="-664.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="10193" y="-648.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="10193" y="-633.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="10193" y="-617.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-602.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-587.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="10193" y="-571.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="10193" y="-556.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="10193" y="-540.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="10193" y="-525.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="10193" y="-510.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local second = fuzz_patt(slip)</text>
<text text-anchor="middle" x="10193" y="-494.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="10193" y="-479.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(second, tostring(historian[i]))</text>
<text text-anchor="middle" x="10193" y="-463.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="10193" y="-448.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="10193" y="-433.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-417.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-402.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10193" y="-386.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="10193" y="-371.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="10193" y="-356.1005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_126&#45;&gt;leaf_138 -->
<g id="edge138" class="edge">
<title>codeblock_126&#45;&gt;leaf_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10074.417,-1782.3466C10080.9543,-1732.8613 10099.9046,-1589.4118 10120.7907,-1431.3085"/>
<polygon fill="#000000" stroke="#000000" points="10124.2652,-1431.7315 10122.1051,-1421.3592 10117.3255,-1430.8147 10124.2652,-1431.7315"/>
</g>
<!-- leaf_132 -->
<g id="node133" class="node">
<title>leaf_132</title>
<polygon fill="none" stroke="#c0c0c0" points="9589.5,-63.0015 9342.5,-63.0015 9342.5,-7.1986 9589.5,-7.1986 9589.5,-63.0015"/>
<text text-anchor="middle" x="9466" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_128&#45;&gt;leaf_132 -->
<g id="edge132" class="edge">
<title>raw_128&#45;&gt;leaf_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9536.6011,-866.532C9543.7082,-780.1145 9569.0265,-402.5922 9498,-106.2001 9495.243,-94.6953 9490.6388,-82.7589 9485.7699,-72.0267"/>
<polygon fill="#000000" stroke="#000000" points="9488.9108,-70.4815 9481.4629,-62.9464 9482.5862,-73.4815 9488.9108,-70.4815"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9662,-53.1 9608,-53.1 9608,-17.1 9662,-17.1 9662,-53.1"/>
<text text-anchor="middle" x="9635" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_129&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>prespace_129&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9626.1921,-866.5632C9627.3394,-758.2631 9633.2826,-197.2221 9634.6975,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9638.1996,-63.4658 9634.8058,-53.4293 9631.2,-63.3916 9638.1996,-63.4658"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9738,-53.1 9680,-53.1 9680,-17.1 9738,-17.1 9738,-53.1"/>
<text text-anchor="middle" x="9709" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_130&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>literal_130&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9721.7225,-866.5632C9720.0653,-758.2631 9711.4807,-197.2221 9709.437,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9712.9331,-63.3745 9709.2805,-53.4293 9705.934,-63.4817 9712.9331,-63.3745"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="10283.5,-62.3005 9756.5,-62.3005 9756.5,-7.8996 10283.5,-7.8996 10283.5,-62.3005"/>
<text text-anchor="middle" x="10020" y="-47.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="10020" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="10020" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>raw_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9796.2495,-866.4879C9786.5196,-761.36 9742.7431,-232.4339 9834,-106.2001 9844.4136,-91.7952 9876.4728,-77.4907 9911.1078,-65.5301"/>
<polygon fill="#000000" stroke="#000000" points="9912.5703,-68.7307 9920.9291,-62.2206 9910.335,-62.0972 9912.5703,-68.7307"/>
</g>
<!-- leaf_137 -->
<g id="node138" class="node">
<title>leaf_137</title>
<polygon fill="none" stroke="#c0c0c0" points="10814.5,-62.4005 10301.5,-62.4005 10301.5,-7.7996 10814.5,-7.7996 10814.5,-62.4005"/>
<text text-anchor="middle" x="10558" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10558" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_136&#45;&gt;leaf_137 -->
<g id="edge137" class="edge">
<title>raw_136&#45;&gt;leaf_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9867.796,-866.4253C9855.3682,-759.8078 9798.3471,-219.0112 9906,-106.2001 9935.7379,-75.0373 10249.1953,-75.0185 10292,-70.2001 10309.9508,-68.1794 10328.5672,-65.9655 10347.2355,-63.6632"/>
<polygon fill="#000000" stroke="#000000" points="10347.8096,-67.1189 10357.3024,-62.4139 10346.9475,-60.1722 10347.8096,-67.1189"/>
</g>
<!-- leaf_144 -->
<g id="node145" class="node">
<title>leaf_144</title>
<polygon fill="none" stroke="#c0c0c0" points="10741.5,-1818.6429 10592.5,-1818.6429 10592.5,-1782.6429 10741.5,-1782.6429 10741.5,-1818.6429"/>
<text text-anchor="middle" x="10667" y="-1797.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_139&#45;&gt;leaf_144 -->
<g id="edge144" class="edge">
<title>header_139&#45;&gt;leaf_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10676.1126,-1985.6647C10674.3713,-1950.309 10670.4947,-1871.6001 10668.4029,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="10671.8876,-1828.7285 10667.8998,-1818.9128 10664.8961,-1829.0729 10671.8876,-1828.7285"/>
</g>
<!-- raw_145 -->
<g id="node146" class="node">
<title>raw_145</title>
<ellipse fill="none" stroke="#000000" cx="10787" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="10787" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_140&#45;&gt;raw_145 -->
<g id="edge145" class="edge">
<title>prose_140&#45;&gt;raw_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10846.2317,-1985.6647C10834.8077,-1949.9796 10809.245,-1870.1295 10795.742,-1827.9502"/>
<polygon fill="#000000" stroke="#000000" points="10799.0449,-1826.7878 10792.6626,-1818.3311 10792.3782,-1828.9221 10799.0449,-1826.7878"/>
</g>
<!-- leaf_147 -->
<g id="node148" class="node">
<title>leaf_147</title>
<polygon fill="none" stroke="#c0c0c0" points="11212,-1902.0232 10832,-1902.0232 10832,-1699.2626 11212,-1699.2626 11212,-1902.0232"/>
<text text-anchor="middle" x="11022" y="-1886.883" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="11022" y="-1871.483" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="11022" y="-1856.083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="11022" y="-1840.6829" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11022" y="-1825.2829" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="11022" y="-1806.5229" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="11022" y="-1787.7629" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="11022" y="-1772.3629" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="11022" y="-1756.9628" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="11022" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="11022" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="11022" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_141&#45;&gt;leaf_147 -->
<g id="edge147" class="edge">
<title>codeblock_141&#45;&gt;leaf_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11011.9762,-1985.6647C11012.9075,-1968.4748 11014.394,-1941.0366 11015.9401,-1912.4976"/>
<polygon fill="#000000" stroke="#000000" points="11019.4425,-1912.5469 11016.4887,-1902.3722 11012.4527,-1912.1681 11019.4425,-1912.5469"/>
</g>
<!-- header_148 -->
<g id="node149" class="node">
<title>header_148</title>
<ellipse fill="none" stroke="#000000" cx="11312" cy="-1800.6429" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="11312" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_142&#45;&gt;header_148 -->
<g id="edge148" class="edge">
<title>section_142&#45;&gt;header_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11433.1971,-1985.6647C11409.6834,-1949.7682 11356.896,-1869.182 11329.3991,-1827.2047"/>
<polygon fill="#000000" stroke="#000000" points="11332.1838,-1825.0683 11323.7764,-1818.621 11326.3282,-1828.9039 11332.1838,-1825.0683"/>
</g>
<!-- prose_149 -->
<g id="node150" class="node">
<title>prose_149</title>
<ellipse fill="none" stroke="#000000" cx="11445" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11445" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_142&#45;&gt;prose_149 -->
<g id="edge149" class="edge">
<title>section_142&#45;&gt;prose_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11445,-1985.6647C11445,-1950.309 11445,-1871.6001 11445,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="11448.5001,-1828.9128 11445,-1818.9128 11441.5001,-1828.9129 11448.5001,-1828.9128"/>
</g>
<!-- prose_150 -->
<g id="node151" class="node">
<title>prose_150</title>
<ellipse fill="none" stroke="#000000" cx="11560" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11560" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_142&#45;&gt;prose_150 -->
<g id="edge150" class="edge">
<title>section_142&#45;&gt;prose_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11455.2055,-1985.6647C11475.5965,-1949.663 11521.4479,-1868.7093 11545.1641,-1826.8367"/>
<polygon fill="#000000" stroke="#000000" points="11548.2618,-1828.4693 11550.1447,-1818.0431 11542.1709,-1825.0195 11548.2618,-1828.4693"/>
</g>
<!-- codeblock_151 -->
<g id="node152" class="node">
<title>codeblock_151</title>
<ellipse fill="none" stroke="#000000" cx="11765" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11765" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 425&#45;449</text>
</g>
<!-- section_142&#45;&gt;codeblock_151 -->
<g id="edge151" class="edge">
<title>section_142&#45;&gt;codeblock_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11471.7326,-1986.7213C11529.1184,-1950.3099 11664.1426,-1864.637 11728.9952,-1823.4879"/>
<polygon fill="#000000" stroke="#000000" points="11731.0966,-1826.2998 11737.6651,-1817.9869 11727.3462,-1820.3892 11731.0966,-1826.2998"/>
</g>
<!-- header_164 -->
<g id="node165" class="node">
<title>header_164</title>
<ellipse fill="none" stroke="#000000" cx="12200" cy="-1800.6429" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="12200" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_143&#45;&gt;header_164 -->
<g id="edge164" class="edge">
<title>section_143&#45;&gt;header_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12404.7667,-1986.2303C12379.7717,-1966.4016 12338.2098,-1932.8011 12304,-1902.083 12276.0874,-1877.0194 12245.5033,-1846.8379 12224.774,-1825.9458"/>
<polygon fill="#000000" stroke="#000000" points="12227.1256,-1823.3461 12217.6059,-1818.6956 12222.1477,-1828.2676 12227.1256,-1823.3461"/>
</g>
<!-- prose_165 -->
<g id="node166" class="node">
<title>prose_165</title>
<ellipse fill="none" stroke="#000000" cx="12345" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12345" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_143&#45;&gt;prose_165 -->
<g id="edge165" class="edge">
<title>section_143&#45;&gt;prose_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12419.723,-1985.6647C12405.2808,-1949.9041 12372.9265,-1869.7916 12355.9205,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="12359.1337,-1826.2928 12352.1436,-1818.3311 12352.643,-1828.9141 12359.1337,-1826.2928"/>
</g>
<!-- prose_166 -->
<g id="node167" class="node">
<title>prose_166</title>
<ellipse fill="none" stroke="#000000" cx="12427" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12427" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_143&#45;&gt;prose_166 -->
<g id="edge166" class="edge">
<title>section_143&#45;&gt;prose_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12427,-1985.6647C12427,-1950.309 12427,-1871.6001 12427,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="12430.5001,-1828.9128 12427,-1818.9128 12423.5001,-1828.9129 12430.5001,-1828.9128"/>
</g>
<!-- codeblock_167 -->
<g id="node168" class="node">
<title>codeblock_167</title>
<ellipse fill="none" stroke="#000000" cx="12623" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="12623" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 458&#45;472</text>
</g>
<!-- section_143&#45;&gt;codeblock_167 -->
<g id="edge167" class="edge">
<title>section_143&#45;&gt;codeblock_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12444.0508,-1986.0199C12478.947,-1949.8703 12558.6013,-1867.3548 12598.8182,-1825.6932"/>
<polygon fill="#000000" stroke="#000000" points="12601.4219,-1828.0355 12605.849,-1818.4099 12596.3856,-1823.1738 12601.4219,-1828.0355"/>
</g>
<!-- codeblock_168 -->
<g id="node169" class="node">
<title>codeblock_168</title>
<ellipse fill="none" stroke="#000000" cx="12937" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="12937" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 474&#45;481</text>
</g>
<!-- section_143&#45;&gt;codeblock_168 -->
<g id="edge168" class="edge">
<title>section_143&#45;&gt;codeblock_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12472.7965,-1989.33C12530.7418,-1970.8096 12633.3183,-1936.8214 12719,-1902.083 12781.1706,-1876.8769 12851.1956,-1843.3413 12894.7128,-1821.8677"/>
<polygon fill="#000000" stroke="#000000" points="12896.4415,-1824.9173 12903.8503,-1817.3437 12893.3356,-1818.6441 12896.4415,-1824.9173"/>
</g>
<!-- codeblock_169 -->
<g id="node170" class="node">
<title>codeblock_169</title>
<ellipse fill="none" stroke="#000000" cx="13251" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13251" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 483&#45;485</text>
</g>
<!-- section_143&#45;&gt;codeblock_169 -->
<g id="edge169" class="edge">
<title>section_143&#45;&gt;codeblock_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12498.8865,-1997.9383C12613.8591,-1987.3579 12845.2743,-1960.3215 13033,-1902.083 13098.5592,-1881.7445 13169.8402,-1845.6817 13212.4442,-1822.4861"/>
<polygon fill="#000000" stroke="#000000" points="13214.2641,-1825.4798 13221.3456,-1817.5992 13210.8954,-1819.3436 13214.2641,-1825.4798"/>
</g>
<!-- leaf_146 -->
<g id="node147" class="node">
<title>leaf_146</title>
<polygon fill="none" stroke="#c0c0c0" points="10814,-902.7014 10760,-902.7014 10760,-866.7014 10814,-866.7014 10814,-902.7014"/>
</g>
<!-- raw_145&#45;&gt;leaf_146 -->
<g id="edge146" class="edge">
<title>raw_145&#45;&gt;leaf_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10787,-1782.3466C10787,-1668.1955 10787,-1054.0449 10787,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="10790.5001,-913.0412 10787,-903.0413 10783.5001,-913.0413 10790.5001,-913.0412"/>
</g>
<!-- leaf_152 -->
<g id="node153" class="node">
<title>leaf_152</title>
<polygon fill="none" stroke="#c0c0c0" points="11213,-902.7014 11057,-902.7014 11057,-866.7014 11213,-866.7014 11213,-902.7014"/>
<text text-anchor="middle" x="11135" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_148&#45;&gt;leaf_152 -->
<g id="edge152" class="edge">
<title>header_148&#45;&gt;leaf_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11296.107,-1782.6033C11275.1652,-1757.6844 11239.0019,-1710.4343 11222,-1663.2027 11121.6815,-1384.5156 11129.0865,-1016.553 11133.5315,-912.9252"/>
<polygon fill="#000000" stroke="#000000" points="11137.028,-913.0813 11133.9874,-902.9321 11130.0352,-912.7622 11137.028,-913.0813"/>
</g>
<!-- raw_153 -->
<g id="node154" class="node">
<title>raw_153</title>
<ellipse fill="none" stroke="#000000" cx="11258" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="11258" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_149&#45;&gt;raw_153 -->
<g id="edge153" class="edge">
<title>prose_149&#45;&gt;raw_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11442.2365,-1782.6456C11437.846,-1760.082 11427.1587,-1721.6468 11403,-1699.2027 11365.6226,-1664.4782 11324.8351,-1703.8483 11294,-1663.2027 11202.5226,-1542.6213 11243.4412,-1038.2023 11255.2111,-912.9466"/>
<polygon fill="#000000" stroke="#000000" points="11258.6963,-913.267 11256.1619,-902.9798 11251.728,-912.6022 11258.6963,-913.267"/>
</g>
<!-- prespace_154 -->
<g id="node155" class="node">
<title>prespace_154</title>
<ellipse fill="none" stroke="#000000" cx="11349" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="11349" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_149&#45;&gt;prespace_154 -->
<g id="edge154" class="edge">
<title>prose_149&#45;&gt;prespace_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11438.4525,-1782.7039C11429.2815,-1756.7373 11412.8549,-1706.9873 11405,-1663.2027 11353.0555,-1373.6561 11348.9391,-1015.3518 11348.8878,-913.1215"/>
<polygon fill="#000000" stroke="#000000" points="11352.3878,-912.9852 11348.8963,-902.9822 11345.3878,-912.9793 11352.3878,-912.9852"/>
</g>
<!-- literal_155 -->
<g id="node156" class="node">
<title>literal_155</title>
<ellipse fill="none" stroke="#000000" cx="11445" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="11445" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_149&#45;&gt;literal_155 -->
<g id="edge155" class="edge">
<title>prose_149&#45;&gt;literal_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11445,-1782.3466C11445,-1668.1955 11445,-1054.0449 11445,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="11448.5001,-913.0412 11445,-903.0413 11441.5001,-913.0413 11448.5001,-913.0412"/>
</g>
<!-- raw_156 -->
<g id="node157" class="node">
<title>raw_156</title>
<ellipse fill="none" stroke="#000000" cx="11521" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="11521" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_149&#45;&gt;raw_156 -->
<g id="edge156" class="edge">
<title>prose_149&#45;&gt;raw_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11451.6998,-1782.7302C11461.056,-1756.7956 11477.7061,-1707.0842 11485,-1663.2027 11533.1613,-1373.4535 11525.5285,-1015.2902 11522.0957,-913.1075"/>
<polygon fill="#000000" stroke="#000000" points="11525.5887,-912.844 11521.74,-902.973 11518.593,-913.0896 11525.5887,-912.844"/>
</g>
<!-- raw_161 -->
<g id="node162" class="node">
<title>raw_161</title>
<ellipse fill="none" stroke="#000000" cx="11593" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="11593" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_150&#45;&gt;raw_161 -->
<g id="edge161" class="edge">
<title>prose_150&#45;&gt;raw_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11560.6592,-1782.3466C11564.7719,-1668.1955 11586.8988,-1054.0449 11591.9658,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="11595.4768,-913.1608 11592.3392,-903.0413 11588.4814,-912.9087 11595.4768,-913.1608"/>
</g>
<!-- leaf_163 -->
<g id="node164" class="node">
<title>leaf_163</title>
<polygon fill="none" stroke="#c0c0c0" points="12026.4016,-1072.3422 11637.5984,-1072.3422 11637.5984,-697.0606 12026.4016,-697.0606 12026.4016,-1072.3422"/>
<text text-anchor="middle" x="11832" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="11832" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="11832" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="11832" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="11832" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11832" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="11832" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="11832" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="11832" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11832" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="11832" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="11832" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="11832" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="11832" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11832" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="11832" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="11832" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="11832" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="11832" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="11832" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="11832" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="11832" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11832" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_151&#45;&gt;leaf_163 -->
<g id="edge163" class="edge">
<title>codeblock_151&#45;&gt;leaf_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11766.3384,-1782.3466C11772.6885,-1695.5356 11800.1913,-1319.5509 11817.5261,-1082.571"/>
<polygon fill="#000000" stroke="#000000" points="11821.0277,-1082.6754 11818.2667,-1072.4467 11814.0464,-1082.1647 11821.0277,-1082.6754"/>
</g>
<!-- leaf_157 -->
<g id="node158" class="node">
<title>leaf_157</title>
<polygon fill="none" stroke="#c0c0c0" points="11303.5,-63.0015 10832.5,-63.0015 10832.5,-7.1986 11303.5,-7.1986 11303.5,-63.0015"/>
<text text-anchor="middle" x="11068" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_153&#45;&gt;leaf_157 -->
<g id="edge157" class="edge">
<title>raw_153&#45;&gt;leaf_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11259.6198,-866.5791C11268.6141,-761.9643 11308.951,-235.4375 11222,-106.2001 11211.1513,-90.0754 11195.6613,-77.5392 11178.6442,-67.8129"/>
<polygon fill="#000000" stroke="#000000" points="11180.09,-64.6169 11169.6226,-62.9788 11176.7838,-70.7869 11180.09,-64.6169"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11376,-53.1 11322,-53.1 11322,-17.1 11376,-17.1 11376,-53.1"/>
</g>
<!-- prespace_154&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>prespace_154&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11349,-866.5632C11349,-758.2631 11349,-197.2221 11349,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="11352.5001,-63.4293 11349,-53.4293 11345.5001,-63.4293 11352.5001,-63.4293"/>
</g>
<!-- leaf_159 -->
<g id="node160" class="node">
<title>leaf_159</title>
<polygon fill="none" stroke="#c0c0c0" points="11494,-53.1 11394,-53.1 11394,-17.1 11494,-17.1 11494,-53.1"/>
<text text-anchor="middle" x="11444" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_155&#45;&gt;leaf_159 -->
<g id="edge159" class="edge">
<title>literal_155&#45;&gt;leaf_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11444.9787,-866.5632C11444.8512,-758.2631 11444.1908,-197.2221 11444.0336,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="11447.5334,-63.4251 11444.0216,-53.4293 11440.5334,-63.4334 11447.5334,-63.4251"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11752,-53.1 11512,-53.1 11512,-17.1 11752,-17.1 11752,-53.1"/>
<text text-anchor="middle" x="11632" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_156&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_156&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11520.0351,-866.6202C11514.7903,-763.338 11492.2571,-247.6868 11557,-106.2001 11565.4407,-87.7541 11581.0549,-71.733 11595.8598,-59.5929"/>
<polygon fill="#000000" stroke="#000000" points="11598.2354,-62.178 11603.9507,-53.2569 11593.9196,-56.6668 11598.2354,-62.178"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="12157.5,-55.0021 11770.5,-55.0021 11770.5,-15.198 12157.5,-15.198 12157.5,-55.0021"/>
<text text-anchor="middle" x="11964" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_161&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>raw_161&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11590.9963,-866.6056C11579.7087,-761.0146 11528.0758,-225.069 11629,-106.2001 11636.2821,-97.6232 11752.1095,-74.3251 11845.5532,-56.7169"/>
<polygon fill="#000000" stroke="#000000" points="11846.2023,-60.1563 11855.384,-54.8698 11844.9096,-53.2767 11846.2023,-60.1563"/>
</g>
<!-- leaf_170 -->
<g id="node171" class="node">
<title>leaf_170</title>
<polygon fill="none" stroke="#c0c0c0" points="12285,-902.7014 12115,-902.7014 12115,-866.7014 12285,-866.7014 12285,-902.7014"/>
<text text-anchor="middle" x="12200" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_164&#45;&gt;leaf_170 -->
<g id="edge170" class="edge">
<title>header_164&#45;&gt;leaf_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12200,-1782.3466C12200,-1668.1955 12200,-1054.0449 12200,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="12203.5001,-913.0412 12200,-903.0413 12196.5001,-913.0413 12203.5001,-913.0412"/>
</g>
<!-- raw_171 -->
<g id="node172" class="node">
<title>raw_171</title>
<ellipse fill="none" stroke="#000000" cx="12338" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="12338" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_165&#45;&gt;raw_171 -->
<g id="edge171" class="edge">
<title>prose_165&#45;&gt;raw_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12344.8602,-1782.3466C12343.9878,-1668.1955 12339.2942,-1054.0449 12338.2194,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="12341.7166,-913.0142 12338.1402,-903.0413 12334.7168,-913.0678 12341.7166,-913.0142"/>
</g>
<!-- raw_173 -->
<g id="node174" class="node">
<title>raw_173</title>
<ellipse fill="none" stroke="#000000" cx="12410" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="12410" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_166&#45;&gt;raw_173 -->
<g id="edge173" class="edge">
<title>prose_166&#45;&gt;raw_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12426.6604,-1782.3466C12424.5418,-1668.1955 12413.143,-1054.0449 12410.5328,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="12414.0255,-912.9746 12410.3404,-903.0413 12407.0267,-913.1045 12414.0255,-912.9746"/>
</g>
<!-- leaf_175 -->
<g id="node176" class="node">
<title>leaf_175</title>
<polygon fill="none" stroke="#c0c0c0" points="12905,-988.9019 12455,-988.9019 12455,-780.5009 12905,-780.5009 12905,-988.9019"/>
<text text-anchor="middle" x="12680" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="12680" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="12680" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="12680" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="12680" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="12680" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="12680" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="12680" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="12680" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="12680" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="12680" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="12680" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="12680" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_167&#45;&gt;leaf_175 -->
<g id="edge175" class="edge">
<title>codeblock_167&#45;&gt;leaf_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12624.1386,-1782.3466C12630.2318,-1684.4338 12659.2177,-1218.656 12672.8642,-999.3681"/>
<polygon fill="#000000" stroke="#000000" points="12676.3743,-999.3127 12673.5023,-989.1146 12669.3878,-998.8779 12676.3743,-999.3127"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="13191,-935.1024 12923,-935.1024 12923,-834.3004 13191,-834.3004 13191,-935.1024"/>
<text text-anchor="middle" x="13057" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="13057" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="13057" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="13057" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="13057" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="13057" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_168&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>codeblock_168&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12939.397,-1782.3466C12953.4187,-1675.3219 13025.0228,-1128.7781 13049.0941,-945.0456"/>
<polygon fill="#000000" stroke="#000000" points="13052.5789,-945.3893 13050.4077,-935.0194 13045.6382,-944.48 13052.5789,-945.3893"/>
</g>
<!-- leaf_177 -->
<g id="node178" class="node">
<title>leaf_177</title>
<polygon fill="none" stroke="#c0c0c0" points="13295,-902.7014 13209,-902.7014 13209,-866.7014 13295,-866.7014 13295,-902.7014"/>
<text text-anchor="middle" x="13252" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_169&#45;&gt;leaf_177 -->
<g id="edge177" class="edge">
<title>codeblock_169&#45;&gt;leaf_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13251.02,-1782.3466C13251.1446,-1668.1955 13251.8151,-1054.0449 13251.9687,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="13255.469,-913.0451 13251.98,-903.0413 13248.469,-913.0374 13255.469,-913.0451"/>
</g>
<!-- leaf_172 -->
<g id="node173" class="node">
<title>leaf_172</title>
<polygon fill="none" stroke="#c0c0c0" points="12500,-63.0015 12176,-63.0015 12176,-7.1986 12500,-7.1986 12500,-63.0015"/>
<text text-anchor="middle" x="12338" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_171&#45;&gt;leaf_172 -->
<g id="edge172" class="edge">
<title>raw_171&#45;&gt;leaf_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12338,-866.5632C12338,-760.6464 12338,-221.6953 12338,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="12341.5001,-73.0758 12338,-63.0758 12334.5001,-73.0759 12341.5001,-73.0758"/>
</g>
<!-- leaf_174 -->
<g id="node175" class="node">
<title>leaf_174</title>
<polygon fill="none" stroke="#c0c0c0" points="12716,-55.0021 12518,-55.0021 12518,-15.198 12716,-15.198 12716,-55.0021"/>
<text text-anchor="middle" x="12617" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_173&#45;&gt;leaf_174 -->
<g id="edge174" class="edge">
<title>raw_173&#45;&gt;leaf_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12408.3052,-866.5276C12398.8888,-761.6229 12356.5782,-233.7404 12446,-106.2001 12452.6773,-96.6764 12506.4439,-75.2015 12551.9306,-58.3295"/>
<polygon fill="#000000" stroke="#000000" points="12553.3192,-61.548 12561.4914,-54.8051 12550.898,-54.98 12553.3192,-61.548"/>
</g>
</g>
</svg>
