<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="6433pt" height="1244pt"
 viewBox="0.00 0.00 6433.30 1244.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1240.2017)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1240.2017 6429.2972,-1240.2017 6429.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1218.2017" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1433" y="-1214.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 193</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1146.2017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1433" y="-1142.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;131</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1433,-1200.033C1433,-1192.3326 1433,-1183.176 1433,-1174.6183"/>
<polygon fill="#000000" stroke="#000000" points="1436.5001,-1174.6149 1433,-1164.6149 1429.5001,-1174.615 1436.5001,-1174.6149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1079" cy="-1074.2017" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1079" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1376.6436,-1136.9099C1318.582,-1127.0303 1225.5848,-1110.3513 1146,-1092.2017 1141.3285,-1091.1363 1136.491,-1089.9674 1131.6518,-1088.7528"/>
<polygon fill="#000000" stroke="#000000" points="1132.3256,-1085.3123 1121.7692,-1086.2142 1130.5839,-1092.0922 1132.3256,-1085.3123"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1187" cy="-1074.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1187" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1381.3638,-1134.9591C1339.5034,-1125.2842 1279.2574,-1110.0815 1228,-1092.2017 1225.7705,-1091.4239 1223.4928,-1090.5774 1221.2098,-1089.6892"/>
<polygon fill="#000000" stroke="#000000" points="1222.4846,-1086.4292 1211.9043,-1085.874 1219.8291,-1092.906 1222.4846,-1086.4292"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1269" cy="-1074.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1269" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1398.2198,-1130.9323C1370.38,-1118.71 1331.5246,-1101.6515 1303.7047,-1089.4379"/>
<polygon fill="#000000" stroke="#000000" points="1304.9243,-1086.1509 1294.3609,-1085.3357 1302.1103,-1092.5604 1304.9243,-1086.1509"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1351" cy="-1074.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1351" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1413.1501,-1128.7725C1402.0588,-1119.0338 1388.1239,-1106.7982 1376.2613,-1096.3823"/>
<polygon fill="#000000" stroke="#000000" points="1378.264,-1093.483 1368.4403,-1089.5151 1373.6454,-1098.7431 1378.264,-1093.483"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1433" cy="-1074.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1433" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1433,-1128.033C1433,-1120.3326 1433,-1111.176 1433,-1102.6183"/>
<polygon fill="#000000" stroke="#000000" points="1436.5001,-1102.6149 1433,-1092.6149 1429.5001,-1102.615 1436.5001,-1102.6149"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1603" cy="-1074.2017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1603" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;20</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1469.0526,-1130.9323C1494.4235,-1120.187 1528.6201,-1105.7037 1556.11,-1094.0609"/>
<polygon fill="#000000" stroke="#000000" points="1557.6852,-1097.1948 1565.5284,-1090.072 1554.9552,-1090.7491 1557.6852,-1097.1948"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="1820" cy="-1074.2017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1820" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 22&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1487.6268,-1136.0385C1556.2206,-1123.2769 1674.0237,-1101.36 1749.3919,-1087.338"/>
<polygon fill="#000000" stroke="#000000" points="1750.0875,-1090.7688 1759.2786,-1085.4987 1748.8071,-1083.8869 1750.0875,-1090.7688"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2804" cy="-1074.2017" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2804" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 27&#45;131</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1497.7449,-1142.8015C1723.7746,-1130.9312 2477.452,-1091.3508 2724.6907,-1078.3667"/>
<polygon fill="#000000" stroke="#000000" points="2724.8746,-1081.862 2734.6772,-1077.8422 2724.5074,-1074.8716 2724.8746,-1081.862"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="4288" cy="-1074.2017" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4288" y="-1070.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 132&#45;170</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1498.6805,-1144.5453C1876.9939,-1135.0046 3776.0297,-1087.113 4202.7732,-1076.351"/>
<polygon fill="#000000" stroke="#000000" points="4202.9698,-1079.8472 4212.8783,-1076.0961 4202.7932,-1072.8495 4202.9698,-1079.8472"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="1125.5,-1011.1016 1032.5,-1011.1016 1032.5,-975.1016 1125.5,-975.1016 1125.5,-1011.1016"/>
<text text-anchor="middle" x="1079" y="-989.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>header_2&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1079,-1055.7988C1079,-1045.6699 1079,-1032.8815 1079,-1021.5003"/>
<polygon fill="#000000" stroke="#000000" points="1082.5001,-1021.1522 1079,-1011.1523 1075.5001,-1021.1523 1082.5001,-1021.1522"/>
</g>
<!-- raw_12 -->
<g id="node13" class="node">
<title>raw_12</title>
<ellipse fill="none" stroke="#000000" cx="1179" cy="-993.1016" rx="27" ry="18"/>
<text text-anchor="middle" x="1179" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_12 -->
<g id="edge12" class="edge">
<title>prose_3&#45;&gt;raw_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1185.2245,-1056.2029C1184.2166,-1045.9846 1182.9323,-1032.965 1181.7924,-1021.4091"/>
<polygon fill="#000000" stroke="#000000" points="1185.263,-1020.9385 1180.7982,-1011.3305 1178.2968,-1021.6258 1185.263,-1020.9385"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1260" cy="-993.1016" rx="27" ry="18"/>
<text text-anchor="middle" x="1260" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_4&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1267.0026,-1056.2029C1265.8686,-1045.9846 1264.4238,-1032.965 1263.1414,-1021.4091"/>
<polygon fill="#000000" stroke="#000000" points="1266.6046,-1020.8834 1262.0229,-1011.3305 1259.6473,-1021.6555 1266.6046,-1020.8834"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1341" cy="-993.1016" rx="27" ry="18"/>
<text text-anchor="middle" x="1341" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_5&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1348.7807,-1056.2029C1347.5119,-1045.9132 1345.8929,-1032.7828 1344.4606,-1021.1669"/>
<polygon fill="#000000" stroke="#000000" points="1347.9107,-1020.5465 1343.2131,-1011.05 1340.9633,-1021.4032 1347.9107,-1020.5465"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-993.1016" rx="27" ry="18"/>
<text text-anchor="middle" x="1423" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_6&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1430.7807,-1056.2029C1429.5119,-1045.9132 1427.8929,-1032.7828 1426.4606,-1021.1669"/>
<polygon fill="#000000" stroke="#000000" points="1429.9107,-1020.5465 1425.2131,-1011.05 1422.9633,-1021.4032 1429.9107,-1020.5465"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1750,-1020.3021 1468,-1020.3021 1468,-965.9011 1750,-965.9011 1750,-1020.3021"/>
<text text-anchor="middle" x="1609" y="-1005.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local Linebuf = require &quot;linebuf&quot;</text>
<text text-anchor="middle" x="1609" y="-989.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1609" y="-974.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>codeblock_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1604.3316,-1056.2029C1604.8985,-1048.5403 1605.5819,-1039.3024 1606.2489,-1030.2877"/>
<polygon fill="#000000" stroke="#000000" points="1609.7403,-1030.5316 1606.9877,-1020.3006 1602.7594,-1030.0151 1609.7403,-1030.5316"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1959.5,-1011.1016 1768.5,-1011.1016 1768.5,-975.1016 1959.5,-975.1016 1959.5,-1011.1016"/>
<text text-anchor="middle" x="1864" y="-989.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_8&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1829.765,-1056.2029C1835.4786,-1045.6718 1842.8064,-1032.1653 1849.2155,-1020.3521"/>
<polygon fill="#000000" stroke="#000000" points="1852.4177,-1021.7893 1854.1101,-1011.3305 1846.2649,-1018.4511 1852.4177,-1021.7893"/>
</g>
<!-- header_22 -->
<g id="node23" class="node">
<title>header_22</title>
<ellipse fill="none" stroke="#000000" cx="2210" cy="-993.1016" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2210" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:load()</text>
</g>
<!-- section_9&#45;&gt;header_22 -->
<g id="edge22" class="edge">
<title>section_9&#45;&gt;header_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2740.3137,-1066.3336C2658.8109,-1056.1683 2513.2883,-1037.6944 2389,-1020.2017 2355.5796,-1015.498 2318.7027,-1009.9723 2287.1489,-1005.1417"/>
<polygon fill="#000000" stroke="#000000" points="2287.5176,-1001.6574 2277.1023,-1003.5997 2286.4556,-1008.5764 2287.5176,-1001.6574"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-993.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2430" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2750.0166,-1062.4956C2674.2064,-1046.0565 2537.9235,-1016.5043 2470.3108,-1001.8428"/>
<polygon fill="#000000" stroke="#000000" points="2470.9732,-998.4052 2460.4586,-999.7064 2469.4897,-1005.2462 2470.9732,-998.4052"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="2804" cy="-993.1016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2804" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 32&#45;70</text>
</g>
<!-- section_9&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2804,-1055.7988C2804,-1045.6699 2804,-1032.8815 2804,-1021.5003"/>
<polygon fill="#000000" stroke="#000000" points="2807.5001,-1021.1522 2804,-1011.1523 2800.5001,-1021.1523 2807.5001,-1021.1522"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="3017" cy="-993.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3017" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2843.5645,-1059.1374C2882.7705,-1044.2097 2942.3291,-1021.5327 2980.4494,-1007.0183"/>
<polygon fill="#000000" stroke="#000000" points="2982.0253,-1010.1634 2990.1254,-1003.3341 2979.5345,-1003.6216 2982.0253,-1010.1634"/>
</g>
<!-- codeblock_26 -->
<g id="node27" class="node">
<title>codeblock_26</title>
<ellipse fill="none" stroke="#000000" cx="3217" cy="-993.1016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3217" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 72&#45;89</text>
</g>
<!-- section_9&#45;&gt;codeblock_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;codeblock_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2860.1288,-1063.1797C2934.7899,-1048.5187 3066.7299,-1022.6099 3147.5678,-1006.7359"/>
<polygon fill="#000000" stroke="#000000" points="3148.513,-1010.1172 3157.6512,-1004.7558 3147.1642,-1003.2484 3148.513,-1010.1172"/>
</g>
<!-- codeblock_27 -->
<g id="node28" class="node">
<title>codeblock_27</title>
<ellipse fill="none" stroke="#000000" cx="3536" cy="-993.1016" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="3536" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 91&#45;129</text>
</g>
<!-- section_9&#45;&gt;codeblock_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;codeblock_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2869.4076,-1067.2919C2964.7734,-1057.1791 3147.5641,-1037.651 3303,-1020.2017 3352.8414,-1014.6064 3408.6525,-1008.1227 3453.1544,-1002.9003"/>
<polygon fill="#000000" stroke="#000000" points="3453.8163,-1006.3467 3463.3397,-1001.7039 3452.9996,-999.3945 3453.8163,-1006.3467"/>
</g>
<!-- header_42 -->
<g id="node43" class="node">
<title>header_42</title>
<ellipse fill="none" stroke="#000000" cx="4012" cy="-993.1016" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="4012" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_10&#45;&gt;header_42 -->
<g id="edge42" class="edge">
<title>section_10&#45;&gt;header_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4240.2396,-1060.1677C4193.375,-1046.397 4121.7852,-1025.361 4071.3018,-1010.5269"/>
<polygon fill="#000000" stroke="#000000" points="4072.0812,-1007.108 4061.5001,-1007.6467 4070.1077,-1013.8241 4072.0812,-1007.108"/>
</g>
<!-- prose_43 -->
<g id="node44" class="node">
<title>prose_43</title>
<ellipse fill="none" stroke="#000000" cx="4204" cy="-993.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4204" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_43 -->
<g id="edge43" class="edge">
<title>section_10&#45;&gt;prose_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4269.7733,-1056.6042C4257.4305,-1044.6875 4241.0035,-1028.8276 4227.654,-1015.939"/>
<polygon fill="#000000" stroke="#000000" points="4229.829,-1013.1739 4220.2038,-1008.746 4224.967,-1018.2098 4229.829,-1013.1739"/>
</g>
<!-- codeblock_44 -->
<g id="node45" class="node">
<title>codeblock_44</title>
<ellipse fill="none" stroke="#000000" cx="4357" cy="-993.1016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4357" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 134&#45;145</text>
</g>
<!-- section_10&#45;&gt;codeblock_44 -->
<g id="edge44" class="edge">
<title>section_10&#45;&gt;codeblock_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4303.3133,-1056.2029C4312.6932,-1045.1782 4324.8475,-1030.8925 4335.2187,-1018.7026"/>
<polygon fill="#000000" stroke="#000000" points="4337.9152,-1020.9344 4341.7295,-1011.05 4332.5837,-1016.3984 4337.9152,-1020.9344"/>
</g>
<!-- section_45 -->
<g id="node46" class="node">
<title>section_45</title>
<ellipse fill="none" stroke="#000000" cx="4778" cy="-993.1016" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4778" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 148&#45;170</text>
</g>
<!-- section_10&#45;&gt;section_45 -->
<g id="edge45" class="edge">
<title>section_10&#45;&gt;section_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4350.0588,-1063.9303C4440.8422,-1048.9047 4609.4847,-1020.9926 4705.7332,-1005.0625"/>
<polygon fill="#000000" stroke="#000000" points="4706.3788,-1008.5034 4715.6731,-1003.4174 4705.2357,-1001.5973 4706.3788,-1008.5034"/>
</g>
<!-- section_46 -->
<g id="node47" class="node">
<title>section_46</title>
<ellipse fill="none" stroke="#000000" cx="5770" cy="-993.1016" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5770" y="-988.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 171&#45;193</text>
</g>
<!-- section_10&#45;&gt;section_46 -->
<g id="edge46" class="edge">
<title>section_10&#45;&gt;section_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4361.7459,-1070.166C4611.0423,-1056.5237 5421.4928,-1012.1731 5685.8051,-997.709"/>
<polygon fill="#000000" stroke="#000000" points="5686.3097,-1001.1868 5696.1035,-997.1455 5685.9271,-994.1972 5686.3097,-1001.1868"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-676.4022 0,-676.4022 0,-604.5999 324,-604.5999 324,-676.4022"/>
<text text-anchor="middle" x="162" y="-613.001" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>raw_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1161.1554,-979.544C1153.2617,-974.3153 1143.6029,-968.9036 1134,-966.0016 1048.7195,-940.2289 409.3632,-975.889 333,-930.0016 242.3379,-875.5218 194.349,-753.1276 174.0453,-686.2533"/>
<polygon fill="#000000" stroke="#000000" points="177.3268,-685.0074 171.1353,-676.4099 170.614,-686.9919 177.3268,-685.0074"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-667.8014 342.5,-667.8014 342.5,-613.2006 897.5,-613.2006 897.5,-667.8014"/>
<text text-anchor="middle" x="620" y="-636.701" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-621.301" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1241.615,-979.5944C1233.7858,-974.5065 1224.3205,-969.1858 1215,-966.0016 1084.5802,-921.4455 1030.9172,-990.3265 907,-930.0016 786.0586,-871.1253 686.5043,-740.1005 643.2426,-676.509"/>
<polygon fill="#000000" stroke="#000000" points="646.0021,-674.3406 637.5154,-667.9981 640.1945,-678.2486 646.0021,-674.3406"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-667.8014 916,-667.8014 916,-613.2006 1464,-613.2006 1464,-667.8014"/>
<text text-anchor="middle" x="1190" y="-636.701" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-621.301" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1333.5119,-975.6161C1310.1046,-920.9576 1237.9621,-752.4975 1205.7802,-677.3494"/>
<polygon fill="#000000" stroke="#000000" points="1208.8493,-675.6251 1201.6952,-667.8104 1202.4145,-678.3808 1208.8493,-675.6251"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-675.8014 1482,-675.8014 1482,-605.2007 2030,-605.2007 2030,-675.8014"/>
<text text-anchor="middle" x="1756" y="-644.701" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new linebuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-629.301" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1437.7383,-977.4958C1486.1471,-926.2376 1641.4067,-761.8394 1715.6788,-683.1955"/>
<polygon fill="#000000" stroke="#000000" points="1718.2858,-685.5326 1722.6073,-675.8592 1713.1966,-680.7263 1718.2858,-685.5326"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2197.5,-658.501 2048.5,-658.501 2048.5,-622.501 2197.5,-622.501 2197.5,-658.501"/>
<text text-anchor="middle" x="2123" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:load()</text>
</g>
<!-- header_22&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>header_22&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2205.445,-974.6407C2191.1451,-916.685 2147.0804,-738.0961 2129.9306,-668.5899"/>
<polygon fill="#000000" stroke="#000000" points="2133.3036,-667.6495 2127.5099,-658.7792 2126.5074,-669.3265 2133.3036,-667.6495"/>
</g>
<!-- raw_29 -->
<g id="node30" class="node">
<title>raw_29</title>
<ellipse fill="none" stroke="#000000" cx="2243" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="2243" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_23&#45;&gt;raw_29 -->
<g id="edge29" class="edge">
<title>prose_23&#45;&gt;raw_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2398.341,-989.2278C2363.2071,-983.1309 2307.6903,-967.7932 2279,-930.0016 2219.2817,-851.3389 2229.6527,-724.5412 2237.9859,-668.5805"/>
<polygon fill="#000000" stroke="#000000" points="2241.4958,-668.7926 2239.604,-658.3681 2234.5821,-667.6971 2241.4958,-668.7926"/>
</g>
<!-- prespace_30 -->
<g id="node31" class="node">
<title>prespace_30</title>
<ellipse fill="none" stroke="#000000" cx="2334" cy="-640.501" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2334" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_23&#45;&gt;prespace_30 -->
<g id="edge30" class="edge">
<title>prose_23&#45;&gt;prespace_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2416.9326,-976.3707C2408.0368,-964.1675 2396.7022,-946.8782 2390,-930.0016 2353.7627,-838.7537 2340.3909,-721.7427 2335.9627,-668.7836"/>
<polygon fill="#000000" stroke="#000000" points="2339.449,-668.4718 2335.1702,-658.7794 2332.4709,-669.0246 2339.449,-668.4718"/>
</g>
<!-- literal_31 -->
<g id="node32" class="node">
<title>literal_31</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-640.501" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2430" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_23&#45;&gt;literal_31 -->
<g id="edge31" class="edge">
<title>prose_23&#45;&gt;literal_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2430,-974.6407C2430,-916.804 2430,-738.829 2430,-669.0195"/>
<polygon fill="#000000" stroke="#000000" points="2433.5001,-668.7791 2430,-658.7792 2426.5001,-668.7792 2433.5001,-668.7791"/>
</g>
<!-- raw_32 -->
<g id="node33" class="node">
<title>raw_32</title>
<ellipse fill="none" stroke="#000000" cx="2506" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="2506" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_23&#45;&gt;raw_32 -->
<g id="edge32" class="edge">
<title>prose_23&#45;&gt;raw_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2443.4198,-976.5039C2452.4817,-964.3633 2463.8699,-947.0943 2470,-930.0016 2502.7231,-838.7592 2506.6392,-722.1378 2506.5314,-669.0808"/>
<polygon fill="#000000" stroke="#000000" points="2510.029,-668.73 2506.4562,-658.7558 2503.0292,-668.7811 2510.029,-668.73"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="3057,-923.502 2551,-923.502 2551,-357.5001 3057,-357.5001 3057,-923.502"/>
<text text-anchor="middle" x="2804" y="-908.3015" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 50</text>
<text text-anchor="middle" x="2804" y="-876.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2804" y="-861.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE repl (</text>
<text text-anchor="middle" x="2804" y="-846.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2804" y="-830.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">project TEXT,</text>
<text text-anchor="middle" x="2804" y="-815.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2804" y="-799.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP);</text>
<text text-anchor="middle" x="2804" y="-784.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-753.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line_stmt = [[</text>
<text text-anchor="middle" x="2804" y="-737.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES(?, ?);</text>
<text text-anchor="middle" x="2804" y="-722.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-690.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2804" y="-675.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2804" y="-660.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-628.701" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2804" y="-613.301" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT line FROM repl</text>
<text text-anchor="middle" x="2804" y="-597.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %s</text>
<text text-anchor="middle" x="2804" y="-582.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2804" y="-567.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2804" y="-551.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-520.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-504.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-473.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2804" y="-458.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2804" y="-442.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2804" y="-427.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2804" y="-411.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-396.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-381.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2804" y="-365.7006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_24&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2804,-974.6407C2804,-964.3946 2804,-950.3781 2804,-933.8604"/>
<polygon fill="#000000" stroke="#000000" points="2807.5001,-933.8556 2804,-923.8557 2800.5001,-933.8557 2807.5001,-933.8556"/>
</g>
<!-- raw_38 -->
<g id="node39" class="node">
<title>raw_38</title>
<ellipse fill="none" stroke="#000000" cx="3102" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="3102" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_38 -->
<g id="edge38" class="edge">
<title>prose_25&#45;&gt;raw_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3033.2573,-977.283C3044.4228,-965.3813 3058.5287,-948.0749 3066,-930.0016 3103.1996,-840.0149 3104.8295,-721.9107 3103.3347,-668.6733"/>
<polygon fill="#000000" stroke="#000000" points="3106.8309,-668.499 3102.9919,-658.6242 3099.835,-668.7377 3106.8309,-668.499"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="3429,-768.0015 3147,-768.0015 3147,-513.0005 3429,-513.0005 3429,-768.0015"/>
<text text-anchor="middle" x="3288" y="-752.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local STATCOL = 81</text>
<text text-anchor="middle" x="3288" y="-737.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local STAT_TOP = 1</text>
<text text-anchor="middle" x="3288" y="-722.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local STAT_RUN = 2</text>
<text text-anchor="middle" x="3288" y="-690.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function colwrite(str, col, row)</text>
<text text-anchor="middle" x="3288" y="-675.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;col = col or STATCOL</text>
<text text-anchor="middle" x="3288" y="-659.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;row = row or STAT_TOP</text>
<text text-anchor="middle" x="3288" y="-644.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local dash = a.stash()</text>
<text text-anchor="middle" x="3288" y="-629.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.cursor.hide()</text>
<text text-anchor="middle" x="3288" y="-613.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.jump(row, col)</text>
<text text-anchor="middle" x="3288" y="-598.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.erase.right()</text>
<text text-anchor="middle" x="3288" y="-582.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. str</text>
<text text-anchor="middle" x="3288" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.pop()</text>
<text text-anchor="middle" x="3288" y="-552.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.cursor.show()</text>
<text text-anchor="middle" x="3288" y="-536.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(dash)</text>
<text text-anchor="middle" x="3288" y="-521.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_26&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>codeblock_26&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3220.7173,-974.6407C3228.0901,-938.0258 3245.1584,-853.2613 3260.2579,-778.274"/>
<polygon fill="#000000" stroke="#000000" points="3263.7358,-778.7322 3262.2788,-768.238 3256.8736,-777.3503 3263.7358,-778.7322"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="3904.5,-930.0021 3447.5,-930.0021 3447.5,-350.9999 3904.5,-350.9999 3904.5,-930.0021"/>
<text text-anchor="middle" x="3676" y="-914.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert(table.reverse)</text>
<text text-anchor="middle" x="3676" y="-883.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3676" y="-868.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.home_dir .. &quot;/.bridge&quot;)</text>
<text text-anchor="middle" x="3676" y="-852.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3676" y="-837.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_names = conn:exec(get_tables)</text>
<text text-anchor="middle" x="3676" y="-821.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not table_names or not has(table_names.name, &quot;repl&quot;) then</text>
<text text-anchor="middle" x="3676" y="-806.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, err = sql.pexec(conn, create_repl_table)</text>
<text text-anchor="middle" x="3676" y="-791.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; success is nil for creation, false for error</text>
<text text-anchor="middle" x="3676" y="-775.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success == false then</text>
<text text-anchor="middle" x="3676" y="-760.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="3676" y="-744.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-729.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-714.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt = conn:prepare(insert_line_stmt)</text>
<text text-anchor="middle" x="3676" y="-698.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_stmt = sql.format(get_recent, historian.project,</text>
<text text-anchor="middle" x="3676" y="-683.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3676" y="-667.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local values, err = sql.pexec(conn, pop_stmt)</text>
<text text-anchor="middle" x="3676" y="-652.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if values then</text>
<text text-anchor="middle" x="3676" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(reverse(values[1])) do</text>
<text text-anchor="middle" x="3676" y="-621.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = Linebuf(v)</text>
<text text-anchor="middle" x="3676" y="-606.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-590.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3676" y="-575.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="3676" y="-560.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-544.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3676" y="-513.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, linebuf)</text>
<text text-anchor="middle" x="3676" y="-497.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="3676" y="-482.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt:bind(historian.project, lb)</text>
<text text-anchor="middle" x="3676" y="-467.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local err = historian.insert_stmt:step()</text>
<text text-anchor="middle" x="3676" y="-451.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not err then</text>
<text text-anchor="middle" x="3676" y="-436.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="3676" y="-420.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3676" y="-405.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;error(error)</text>
<text text-anchor="middle" x="3676" y="-390.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3676" y="-374.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="3676" y="-359.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_27&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>codeblock_27&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3543.1351,-975.1313C3546.7232,-966.0943 3551.5105,-954.0372 3557.1385,-939.8627"/>
<polygon fill="#000000" stroke="#000000" points="3560.5168,-940.8385 3560.9542,-930.2527 3554.0109,-938.2553 3560.5168,-940.8385"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2292,-231.1017 1926,-231.1017 1926,-175.2988 2292,-175.2988 2292,-231.1017"/>
<text text-anchor="middle" x="2109" y="-183.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">This is where we either create query or create our</text>
</g>
<!-- raw_29&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>raw_29&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2243.4664,-622.2106C2244.0711,-575.4639 2242.0028,-448.4336 2206,-351.0005 2190.605,-309.3375 2161.6185,-267.5477 2139.3263,-239.088"/>
<polygon fill="#000000" stroke="#000000" points="2141.9055,-236.7082 2132.94,-231.0627 2136.4281,-241.0669 2141.9055,-236.7082"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2364,-221.2002 2310,-221.2002 2310,-185.2002 2364,-185.2002 2364,-221.2002"/>
<text text-anchor="middle" x="2337" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>prespace_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2334.1251,-622.2675C2334.5921,-554.1996 2336.2356,-314.6301 2336.8045,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="2340.3056,-231.5354 2336.8744,-221.5116 2333.3058,-231.4873 2340.3056,-231.5354"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2466.5,-221.2002 2387.5,-221.2002 2387.5,-185.2002 2466.5,-185.2002 2466.5,-221.2002"/>
<text text-anchor="middle" x="2427" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">~/.bridge</text>
</g>
<!-- literal_31&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>literal_31&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2429.8749,-622.2675C2429.4079,-554.1996 2427.7644,-314.6301 2427.1955,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="2430.6942,-231.4873 2427.1256,-221.5116 2423.6944,-231.5354 2430.6942,-231.4873"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2571,-223.1023 2485,-223.1023 2485,-183.2982 2571,-183.2982 2571,-223.1023"/>
<text text-anchor="middle" x="2528" y="-207.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> database.</text>
</g>
<!-- raw_32&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>raw_32&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2506.9173,-622.2675C2510.3218,-554.5947 2522.2545,-317.4056 2526.4926,-233.1641"/>
<polygon fill="#000000" stroke="#000000" points="2529.9972,-233.1584 2527.0041,-222.9952 2523.006,-232.8067 2529.9972,-233.1584"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3218.5,-223.1023 2985.5,-223.1023 2985.5,-183.2982 3218.5,-183.2982 3218.5,-223.1023"/>
<text text-anchor="middle" x="3102" y="-191.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">bring in colwrite for diagnosis</text>
</g>
<!-- raw_38&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>raw_38&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3102,-622.2675C3102,-554.5947 3102,-317.4056 3102,-233.1641"/>
<polygon fill="#000000" stroke="#000000" points="3105.5001,-232.9952 3102,-222.9952 3098.5001,-232.9952 3105.5001,-232.9952"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="4071.5,-658.501 3922.5,-658.501 3922.5,-622.501 4071.5,-622.501 4071.5,-658.501"/>
<text text-anchor="middle" x="3997" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_42&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>header_42&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4011.2147,-974.6407C4008.7542,-916.804 4001.183,-738.829 3998.2132,-669.0195"/>
<polygon fill="#000000" stroke="#000000" points="4001.6995,-668.6213 3997.7776,-658.7792 3994.7059,-668.9189 4001.6995,-668.6213"/>
</g>
<!-- raw_48 -->
<g id="node49" class="node">
<title>raw_48</title>
<ellipse fill="none" stroke="#000000" cx="4117" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="4117" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_43&#45;&gt;raw_48 -->
<g id="edge48" class="edge">
<title>prose_43&#45;&gt;raw_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4187.3196,-977.6589C4175.6571,-965.8118 4160.8209,-948.4108 4153,-930.0016 4114.9261,-840.3813 4113.7351,-722.0932 4115.5026,-668.7414"/>
<polygon fill="#000000" stroke="#000000" points="4119.0029,-668.7998 4115.899,-658.6699 4112.0084,-668.5245 4119.0029,-668.7998"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="4612,-721.5013 4162,-721.5013 4162,-559.5007 4612,-559.5007 4612,-721.5013"/>
<text text-anchor="middle" x="4387" y="-706.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="4387" y="-690.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="4387" y="-675.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="4387" y="-660.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4387" y="-644.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="4387" y="-629.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf = historian[historian.cursor &#45; delta]:clone()</text>
<text text-anchor="middle" x="4387" y="-613.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; delta</text>
<text text-anchor="middle" x="4387" y="-598.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="4387" y="-583.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return linebuf</text>
<text text-anchor="middle" x="4387" y="-567.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_44&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_44&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4358.5707,-974.6407C4362.3552,-930.1602 4372.1855,-814.6213 4379.2256,-731.8758"/>
<polygon fill="#000000" stroke="#000000" points="4382.7309,-731.9615 4380.0914,-721.7007 4375.7561,-731.368 4382.7309,-731.9615"/>
</g>
<!-- header_51 -->
<g id="node52" class="node">
<title>header_51</title>
<ellipse fill="none" stroke="#000000" cx="4712" cy="-640.501" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="4712" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_45&#45;&gt;header_51 -->
<g id="edge51" class="edge">
<title>section_45&#45;&gt;header_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4774.5445,-974.6407C4763.7186,-916.804 4730.4051,-738.829 4717.3381,-669.0195"/>
<polygon fill="#000000" stroke="#000000" points="4720.7015,-667.9645 4715.4213,-658.7792 4713.821,-669.2524 4720.7015,-667.9645"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4845" cy="-640.501" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4845" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_45&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_45&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4786.487,-974.9848C4791.9725,-962.5741 4798.8398,-945.5995 4803,-930.0016 4827.9877,-836.3147 4839.0646,-721.3505 4843.0817,-668.9531"/>
<polygon fill="#000000" stroke="#000000" points="4846.589,-668.9823 4843.8342,-658.7519 4839.6079,-668.4672 4846.589,-668.9823"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="5085" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5085" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 153&#45;168</text>
</g>
<!-- section_45&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_45&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4813.9325,-977.139C4836.3042,-966.0463 4864.7618,-949.7344 4886,-930.0016 4973.4607,-848.7398 5043.5193,-722.4873 5071.6528,-667.5586"/>
<polygon fill="#000000" stroke="#000000" points="5074.8645,-668.9634 5076.2615,-658.4611 5068.6201,-665.8 5074.8645,-668.9634"/>
</g>
<!-- header_64 -->
<g id="node65" class="node">
<title>header_64</title>
<ellipse fill="none" stroke="#000000" cx="5520" cy="-640.501" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="5520" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_46&#45;&gt;header_64 -->
<g id="edge64" class="edge">
<title>section_46&#45;&gt;header_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5727.5058,-978.0735C5703.1464,-967.6907 5673.4464,-951.7992 5653,-930.0016 5579.2355,-851.3622 5540.6916,-724.6227 5526.5008,-668.6348"/>
<polygon fill="#000000" stroke="#000000" points="5529.8493,-667.5948 5524.0576,-658.7231 5523.0528,-669.2702 5529.8493,-667.5948"/>
</g>
<!-- prose_65 -->
<g id="node66" class="node">
<title>prose_65</title>
<ellipse fill="none" stroke="#000000" cx="5694" cy="-640.501" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5694" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_46&#45;&gt;prose_65 -->
<g id="edge65" class="edge">
<title>section_46&#45;&gt;prose_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5763.6606,-975.0379C5759.4148,-962.5067 5753.9083,-945.3714 5750,-930.0016 5725.9136,-835.2799 5706.607,-720.8244 5698.3474,-668.7524"/>
<polygon fill="#000000" stroke="#000000" points="5701.7647,-667.9527 5696.7548,-658.6173 5694.8496,-669.0394 5701.7647,-667.9527"/>
</g>
<!-- codeblock_66 -->
<g id="node67" class="node">
<title>codeblock_66</title>
<ellipse fill="none" stroke="#000000" cx="5846" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5846" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 173&#45;180</text>
</g>
<!-- section_46&#45;&gt;codeblock_66 -->
<g id="edge66" class="edge">
<title>section_46&#45;&gt;codeblock_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5773.9791,-974.6407C5786.4709,-916.685 5824.9642,-738.0961 5839.9457,-668.5899"/>
<polygon fill="#000000" stroke="#000000" points="5843.3746,-669.2921 5842.0603,-658.7792 5836.5318,-667.8172 5843.3746,-669.2921"/>
</g>
<!-- codeblock_67 -->
<g id="node68" class="node">
<title>codeblock_67</title>
<ellipse fill="none" stroke="#000000" cx="6109" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6109" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 182&#45;189</text>
</g>
<!-- section_46&#45;&gt;codeblock_67 -->
<g id="edge67" class="edge">
<title>section_46&#45;&gt;codeblock_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5829.767,-981.955C5865.4897,-972.8469 5909.9984,-956.9338 5942,-930.0016 6029.1379,-856.667 6080.8285,-725.5976 6100.2026,-668.4392"/>
<polygon fill="#000000" stroke="#000000" points="6103.6209,-669.2506 6103.4453,-658.6572 6096.9764,-667.0479 6103.6209,-669.2506"/>
</g>
<!-- codeblock_68 -->
<g id="node69" class="node">
<title>codeblock_68</title>
<ellipse fill="none" stroke="#000000" cx="6338" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6338" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 191&#45;193</text>
</g>
<!-- section_46&#45;&gt;codeblock_68 -->
<g id="edge68" class="edge">
<title>section_46&#45;&gt;codeblock_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5844.9876,-990.7173C5954.0638,-985.8583 6149.5398,-971.4753 6205,-930.0016 6292.3609,-864.6722 6324.054,-728.1764 6334.002,-668.9435"/>
<polygon fill="#000000" stroke="#000000" points="6337.4983,-669.2432 6335.615,-658.8171 6330.5854,-668.142 6337.4983,-669.2432"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4144,-221.2002 4090,-221.2002 4090,-185.2002 4144,-185.2002 4144,-221.2002"/>
</g>
<!-- raw_48&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>raw_48&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4117,-622.2675C4117,-554.1996 4117,-314.6301 4117,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="4120.5001,-231.5116 4117,-221.5116 4113.5001,-231.5116 4120.5001,-231.5116"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="4613,-221.2002 4457,-221.2002 4457,-185.2002 4613,-185.2002 4613,-221.2002"/>
<text text-anchor="middle" x="4535" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_51&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_51&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4707.798,-622.3737C4696.7345,-576.0097 4664.6221,-449.8036 4621,-351.0005 4601.5248,-306.8895 4572.1436,-259.2563 4553.2659,-230.3268"/>
<polygon fill="#000000" stroke="#000000" points="4555.9549,-228.0462 4547.5318,-221.6195 4550.1087,-231.8962 4555.9549,-228.0462"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="4658" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="4658" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_52&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4848.2839,-622.3206C4856.1838,-572.4668 4870.8859,-431.9358 4803,-351.0005 4770.2137,-311.9118 4729.9402,-351.2104 4694,-315.0005 4671.7526,-292.5861 4663.2476,-256.3732 4659.9999,-231.2612"/>
<polygon fill="#000000" stroke="#000000" points="4663.4716,-230.8113 4658.9051,-221.2511 4656.5131,-231.5724 4663.4716,-230.8113"/>
</g>
<!-- prespace_56 -->
<g id="node57" class="node">
<title>prespace_56</title>
<ellipse fill="none" stroke="#000000" cx="4749" cy="-203.2002" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="4749" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_52&#45;&gt;prespace_56 -->
<g id="edge56" class="edge">
<title>prose_52&#45;&gt;prespace_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4843.6698,-622.2928C4840.0254,-576.2553 4828.4113,-451.7025 4803,-351.0005 4792.1179,-307.8761 4773.2371,-259.8258 4760.9324,-230.5562"/>
<polygon fill="#000000" stroke="#000000" points="4764.0133,-228.8573 4756.8783,-221.0252 4757.5719,-231.5973 4764.0133,-228.8573"/>
</g>
<!-- literal_57 -->
<g id="node58" class="node">
<title>literal_57</title>
<ellipse fill="none" stroke="#000000" cx="4845" cy="-203.2002" rx="31.481" ry="18"/>
<text text-anchor="middle" x="4845" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_52&#45;&gt;literal_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;literal_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4845,-622.2675C4845,-554.1996 4845,-314.6301 4845,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="4848.5001,-231.5116 4845,-221.5116 4841.5001,-231.5116 4848.5001,-231.5116"/>
</g>
<!-- raw_58 -->
<g id="node59" class="node">
<title>raw_58</title>
<ellipse fill="none" stroke="#000000" cx="4921" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="4921" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_58 -->
<g id="edge58" class="edge">
<title>prose_52&#45;&gt;raw_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4848.121,-622.543C4859.895,-554.7958 4901.6798,-314.3677 4916.0799,-231.5102"/>
<polygon fill="#000000" stroke="#000000" points="4919.5468,-232.0022 4917.8108,-221.5506 4912.6502,-230.8036 4919.5468,-232.0022"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="5409.5,-314.801 4966.5,-314.801 4966.5,-91.5995 5409.5,-91.5995 5409.5,-314.801"/>
<text text-anchor="middle" x="5188" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="5188" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="5188" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="5188" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="5188" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5188" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf= historian[historian.cursor + delta]:clone()</text>
<text text-anchor="middle" x="5188" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + delta</text>
<text text-anchor="middle" x="5188" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="5188" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (delta &gt; 0) and #linebuf.line &gt; 0 then</text>
<text text-anchor="middle" x="5188" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, true</text>
<text text-anchor="middle" x="5188" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="5188" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, false</text>
<text text-anchor="middle" x="5188" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5188" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_53&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>codeblock_53&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5089.2946,-622.2675C5101.0605,-572.314 5134.582,-429.9938 5159.3104,-325.006"/>
<polygon fill="#000000" stroke="#000000" points="5162.7891,-325.5029 5161.675,-314.9668 5155.9755,-323.898 5162.7891,-325.5029"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4705,-55.6015 4227,-55.6015 4227,.2015 4705,.2015 4705,-55.6015"/>
<text text-anchor="middle" x="4466" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next linebuf in history, and a second flag to tell the</text>
</g>
<!-- raw_55&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>raw_55&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4656.7967,-184.9823C4654.261,-160.696 4646.3926,-117.7247 4622,-91.4 4610.1989,-78.6642 4595.4846,-68.4098 4579.8423,-60.1709"/>
<polygon fill="#000000" stroke="#000000" points="4581.0531,-56.8643 4570.5402,-55.5493 4577.9385,-63.1332 4581.0531,-56.8643"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="4777,-45.7 4723,-45.7 4723,-9.7 4777,-9.7 4777,-45.7"/>
</g>
<!-- prespace_56&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>prespace_56&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4749.1033,-185.0797C4749.2774,-154.5231 4749.6306,-92.5279 4749.838,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="4753.3402,-55.7418 4749.8973,-45.722 4746.3403,-55.7019 4753.3402,-55.7418"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4895,-45.7 4795,-45.7 4795,-9.7 4895,-9.7 4895,-45.7"/>
<text text-anchor="middle" x="4845" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_57&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>literal_57&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4845,-185.0797C4845,-154.5231 4845,-92.5279 4845,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="4848.5001,-55.722 4845,-45.722 4841.5001,-55.7221 4848.5001,-55.722"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="5153,-45.7 4913,-45.7 4913,-9.7 5153,-9.7 5153,-45.7"/>
<text text-anchor="middle" x="5033" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_58&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>raw_58&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4923.6171,-185.1968C4927.6782,-161.9061 4937.1902,-120.8356 4957,-91.4 4967.2851,-76.1174 4982.2495,-62.4818 4996.1849,-51.7863"/>
<polygon fill="#000000" stroke="#000000" points="4998.2685,-54.5985 5004.2278,-45.8385 4994.1064,-48.9703 4998.2685,-54.5985"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="5598,-221.2002 5428,-221.2002 5428,-185.2002 5598,-185.2002 5598,-221.2002"/>
<text text-anchor="middle" x="5513" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_64&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>header_64&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5519.7081,-622.2675C5518.6185,-554.1996 5514.7837,-314.6301 5513.4563,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="5516.9528,-231.4543 5513.2931,-221.5116 5509.9537,-231.5664 5516.9528,-231.4543"/>
</g>
<!-- raw_70 -->
<g id="node71" class="node">
<title>raw_70</title>
<ellipse fill="none" stroke="#000000" cx="5643" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="5643" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_65&#45;&gt;raw_70 -->
<g id="edge70" class="edge">
<title>prose_65&#45;&gt;raw_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5691.8735,-622.2675C5683.927,-554.1301 5655.9384,-314.141 5646.2947,-231.4509"/>
<polygon fill="#000000" stroke="#000000" points="5649.7705,-231.0388 5645.1356,-221.5116 5642.8176,-231.8498 5649.7705,-231.0388"/>
</g>
<!-- leaf_72 -->
<g id="node73" class="node">
<title>leaf_72</title>
<polygon fill="none" stroke="#c0c0c0" points="6019.5,-253.6012 5688.5,-253.6012 5688.5,-152.7993 6019.5,-152.7993 6019.5,-253.6012"/>
<text text-anchor="middle" x="5854" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, linebuf)</text>
<text text-anchor="middle" x="5854" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = linebuf</text>
<text text-anchor="middle" x="5854" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="5854" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:persist(linebuf)</text>
<text text-anchor="middle" x="5854" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="5854" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_66&#45;&gt;leaf_72 -->
<g id="edge72" class="edge">
<title>codeblock_66&#45;&gt;leaf_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5846.3336,-622.2675C5847.4443,-561.5533 5851.0511,-364.3925 5852.8941,-263.6522"/>
<polygon fill="#000000" stroke="#000000" points="5856.394,-263.6859 5853.0776,-253.6235 5849.3951,-263.5578 5856.394,-263.6859"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="6306,-253.6012 6038,-253.6012 6038,-152.7993 6306,-152.7993 6306,-253.6012"/>
<text text-anchor="middle" x="6172" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="6172" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="6172" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="6172" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="6172" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6172" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_67&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>codeblock_67&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6111.6268,-622.2675C6120.3736,-561.5533 6148.7777,-364.3925 6163.2909,-263.6522"/>
<polygon fill="#000000" stroke="#000000" points="6166.774,-264.0204 6164.7357,-253.6235 6159.8455,-263.0222 6166.774,-264.0204"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="6410,-221.2002 6324,-221.2002 6324,-185.2002 6410,-185.2002 6410,-221.2002"/>
<text text-anchor="middle" x="6367" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_68&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>codeblock_68&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6339.2092,-622.2675C6343.7232,-554.1996 6359.6104,-314.6301 6365.1097,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="6368.6162,-231.7213 6365.7857,-221.5116 6361.6315,-231.2581 6368.6162,-231.7213"/>
</g>
<!-- leaf_71 -->
<g id="node72" class="node">
<title>leaf_71</title>
<polygon fill="none" stroke="#c0c0c0" points="5670,-45.7 5616,-45.7 5616,-9.7 5670,-9.7 5670,-45.7"/>
</g>
<!-- raw_70&#45;&gt;leaf_71 -->
<g id="edge71" class="edge">
<title>raw_70&#45;&gt;leaf_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5643,-185.0797C5643,-154.5231 5643,-92.5279 5643,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="5646.5001,-55.722 5643,-45.722 5639.5001,-55.7221 5646.5001,-55.722"/>
</g>
</g>
</svg>
