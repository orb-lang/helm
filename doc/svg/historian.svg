<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="11865pt" height="2293pt"
 viewBox="0.00 0.00 11865.30 2293.28" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2289.2833)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2289.2833 11861.2972,-2289.2833 11861.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1780" cy="-2267.2833" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1780" y="-2263.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 430</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1780" cy="-2195.2833" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1780" y="-2191.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;344</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1780,-2249.1146C1780,-2241.4142 1780,-2232.2576 1780,-2223.6999"/>
<polygon fill="#000000" stroke="#000000" points="1783.5001,-2223.6965 1780,-2213.6966 1776.5001,-2223.6966 1783.5001,-2223.6965"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1357" cy="-2123.2833" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1357" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1719.7149,-2187.926C1649.1794,-2178.8877 1529.0436,-2162.1539 1427,-2141.2833 1421.6215,-2140.1832 1416.037,-2138.9335 1410.4738,-2137.6173"/>
<polygon fill="#000000" stroke="#000000" points="1411.0769,-2134.1619 1400.5325,-2135.1944 1409.4193,-2140.9628 1411.0769,-2134.1619"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1468" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1468" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1721.191,-2187.1268C1665.8997,-2178.6163 1581.2172,-2163.4026 1510,-2141.2833 1507.5472,-2140.5215 1505.0431,-2139.6645 1502.5399,-2138.7485"/>
<polygon fill="#000000" stroke="#000000" points="1503.5872,-2135.3996 1492.9998,-2135.0004 1501.0274,-2141.9148 1503.5872,-2135.3996"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1551" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1551" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.4359,-2183.0285C1693.3795,-2173.0022 1639.3029,-2157.8192 1593,-2141.2833 1590.5813,-2140.4195 1588.1026,-2139.4863 1585.6178,-2138.5151"/>
<polygon fill="#000000" stroke="#000000" points="1586.6994,-2135.1765 1576.1178,-2134.647 1584.0596,-2141.6597 1586.6994,-2135.1765"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1634" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1634" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1747.9597,-2179.4826C1724.0983,-2167.7153 1691.6044,-2151.6909 1667.4189,-2139.7639"/>
<polygon fill="#000000" stroke="#000000" points="1668.7832,-2136.5342 1658.2664,-2135.2503 1665.6871,-2142.8123 1668.7832,-2136.5342"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1716" cy="-2123.2833" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1716" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1764.1798,-2177.4855C1756.1184,-2168.4164 1746.1979,-2157.2559 1737.4584,-2147.424"/>
<polygon fill="#000000" stroke="#000000" points="1740.0204,-2145.0379 1730.7607,-2139.8891 1734.7885,-2149.6885 1740.0204,-2145.0379"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1844" cy="-2123.2833" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1844" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1795.8202,-2177.4855C1803.5126,-2168.8316 1812.8978,-2158.2733 1821.3344,-2148.7821"/>
<polygon fill="#000000" stroke="#000000" points="1824.1122,-2150.9252 1828.14,-2141.1258 1818.8803,-2146.2747 1824.1122,-2150.9252"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2061" cy="-2123.2833" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2061" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1827.9863,-2182.9879C1875.2571,-2170.8758 1947.679,-2152.3193 1999.2255,-2139.1116"/>
<polygon fill="#000000" stroke="#000000" points="2000.1011,-2142.5004 2008.9194,-2136.6278 1998.3636,-2135.7195 2000.1011,-2142.5004"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2527" cy="-2123.2833" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2527" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;231</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1842.0845,-2189.2992C1978.1601,-2176.1835 2302.3355,-2144.9377 2450.6119,-2130.646"/>
<polygon fill="#000000" stroke="#000000" points="2451.3608,-2134.0901 2460.9789,-2129.6468 2450.6892,-2127.1224 2451.3608,-2134.0901"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="6810" cy="-2123.2833" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="6810" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 282&#45;291</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1845.9013,-2194.34C2388.2002,-2186.5774 6109.7076,-2133.3074 6724.1741,-2124.5118"/>
<polygon fill="#000000" stroke="#000000" points="6724.3364,-2128.0099 6734.2853,-2124.3671 6724.2362,-2121.0107 6724.3364,-2128.0099"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="9450" cy="-2123.2833" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9450" y="-2119.0833" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 345&#45;396</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1845.728,-2194.6663C2543.1354,-2188.1196 8571.2618,-2131.5322 9364.0825,-2124.0898"/>
<polygon fill="#000000" stroke="#000000" points="9364.3073,-2127.588 9374.274,-2123.9941 9364.2415,-2120.5883 9364.3073,-2127.588"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1402.5,-2021.6832 1309.5,-2021.6832 1309.5,-1985.6832 1402.5,-1985.6832 1402.5,-2021.6832"/>
<text text-anchor="middle" x="1356" y="-2000.1832" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1356.8481,-2105.1186C1356.6859,-2085.7125 1356.4265,-2054.6933 1356.2373,-2032.0611"/>
<polygon fill="#000000" stroke="#000000" points="1359.7369,-2031.9891 1356.1533,-2022.0188 1352.7371,-2032.0477 1359.7369,-2031.9891"/>
</g>
<!-- raw_13 -->
<g id="node14" class="node">
<title>raw_13</title>
<ellipse fill="none" stroke="#000000" cx="1448" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1448" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;raw_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1464.9624,-2105.1186C1461.6984,-2085.5997 1456.4697,-2054.3322 1452.6796,-2031.6672"/>
<polygon fill="#000000" stroke="#000000" points="1456.1021,-2030.9127 1451.0006,-2021.6269 1449.198,-2032.0673 1456.1021,-2030.9127"/>
</g>
<!-- raw_15 -->
<g id="node16" class="node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="1520" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1520" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_4&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1546.359,-2105.3779C1541.291,-2085.8254 1533.1105,-2054.2645 1527.2061,-2031.4847"/>
<polygon fill="#000000" stroke="#000000" points="1530.5699,-2030.5128 1524.6727,-2021.7109 1523.7938,-2032.2692 1530.5699,-2030.5128"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="1592" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1592" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_5&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1627.7122,-2105.3779C1620.7751,-2085.6238 1609.5337,-2053.6124 1601.5166,-2030.7829"/>
<polygon fill="#000000" stroke="#000000" points="1604.8094,-2029.596 1598.1937,-2021.3205 1598.2048,-2031.9154 1604.8094,-2029.596"/>
</g>
<!-- raw_19 -->
<g id="node20" class="node">
<title>raw_19</title>
<ellipse fill="none" stroke="#000000" cx="1664" cy="-2003.6832" rx="27" ry="18"/>
<text text-anchor="middle" x="1664" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;raw_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1708.3272,-2105.6359C1699.6753,-2085.7363 1685.5143,-2053.1661 1675.5301,-2030.2025"/>
<polygon fill="#000000" stroke="#000000" points="1678.7323,-2028.7893 1671.5352,-2021.0141 1672.3128,-2031.5804 1678.7323,-2028.7893"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1991,-2069.3836 1709,-2069.3836 1709,-1937.9828 1991,-1937.9828 1991,-2069.3836"/>
<text text-anchor="middle" x="1850" y="-2054.0833" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1850" y="-2038.6833" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1850" y="-2023.2832" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1850" y="-2007.8832" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1850" y="-1992.4832" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1850" y="-1977.0831" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1850" y="-1961.6831" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1850" y="-1946.2831" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1844.9113,-2105.1186C1845.2762,-2097.8436 1845.7231,-2088.9366 1846.1989,-2079.4511"/>
<polygon fill="#000000" stroke="#000000" points="1849.6976,-2079.564 1846.7031,-2069.4011 1842.7064,-2079.2132 1849.6976,-2079.564"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2200.5,-2021.6832 2009.5,-2021.6832 2009.5,-1985.6832 2200.5,-1985.6832 2200.5,-2021.6832"/>
<text text-anchor="middle" x="2105" y="-2000.1832" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_8&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2067.6827,-2105.1186C2074.8866,-2085.5369 2086.4407,-2054.1309 2094.7853,-2031.4487"/>
<polygon fill="#000000" stroke="#000000" points="2098.0865,-2032.6123 2098.2545,-2022.0188 2091.5169,-2030.1954 2098.0865,-2032.6123"/>
</g>
<!-- header_23 -->
<g id="node24" class="node">
<title>header_23</title>
<ellipse fill="none" stroke="#000000" cx="2287" cy="-2003.6832" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2287" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;header_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2474.569,-2111.2072C2441.7843,-2102.3721 2399.4023,-2088.5494 2365,-2069.2833 2345.3309,-2058.2681 2325.9201,-2041.9688 2311.3823,-2028.3732"/>
<polygon fill="#000000" stroke="#000000" points="2313.4802,-2025.5363 2303.8364,-2021.1491 2308.6394,-2030.5927 2313.4802,-2025.5363"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="2406" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2406" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2496.6368,-2106.9412C2480.6527,-2097.3684 2461.4321,-2084.2318 2447,-2069.2833 2435.8906,-2057.7763 2426.2443,-2042.7784 2419.1042,-2030.028"/>
<polygon fill="#000000" stroke="#000000" points="2422.1857,-2028.3683 2414.3629,-2021.223 2416.0224,-2031.6871 2422.1857,-2028.3683"/>
</g>
<!-- section_25 -->
<g id="node26" class="node">
<title>section_25</title>
<ellipse fill="none" stroke="#000000" cx="2527" cy="-2003.6832" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2527" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;141</text>
</g>
<!-- section_9&#45;&gt;section_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;section_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2527,-2105.1186C2527,-2085.7125 2527,-2054.6933 2527,-2032.0611"/>
<polygon fill="#000000" stroke="#000000" points="2530.5001,-2032.0188 2527,-2022.0188 2523.5001,-2032.0188 2530.5001,-2032.0188"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 142&#45;220</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2571.9436,-2109.2119C2641.9696,-2087.2875 2776.9656,-2045.0217 2853.1457,-2021.1705"/>
<polygon fill="#000000" stroke="#000000" points="2854.5424,-2024.4009 2863.0398,-2018.0728 2852.4509,-2017.7206 2854.5424,-2024.4009"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="3968" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3968" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;231</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2594.5697,-2117.6751C2832.0521,-2097.9646 3627.9673,-2031.9052 3886.2873,-2010.4651"/>
<polygon fill="#000000" stroke="#000000" points="3886.6739,-2013.9452 3896.3501,-2009.63 3886.0948,-2006.9692 3886.6739,-2013.9452"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="4907" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4907" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 232&#45;281</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2597.3516,-2121.8228C2814.2079,-2117.0996 3491.5741,-2100.6916 4052,-2069.2833 4336.9734,-2053.3123 4674.6454,-2024.4704 4826.2534,-2010.9932"/>
<polygon fill="#000000" stroke="#000000" points="4826.7563,-2014.4624 4836.4063,-2010.0889 4826.1352,-2007.49 4826.7563,-2014.4624"/>
</g>
<!-- header_87 -->
<g id="node88" class="node">
<title>header_87</title>
<ellipse fill="none" stroke="#000000" cx="6652" cy="-2003.6832" rx="107.339" ry="18"/>
<text text-anchor="middle" x="6652" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_87 -->
<g id="edge87" class="edge">
<title>section_10&#45;&gt;header_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6787.0254,-2105.8924C6759.7223,-2085.2249 6714.0245,-2050.6334 6683.4534,-2027.4922"/>
<polygon fill="#000000" stroke="#000000" points="6685.3454,-2024.5348 6675.2597,-2021.2899 6681.1206,-2030.1161 6685.3454,-2024.5348"/>
</g>
<!-- prose_88 -->
<g id="node89" class="node">
<title>prose_88</title>
<ellipse fill="none" stroke="#000000" cx="6810" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6810" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;prose_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6810,-2105.1186C6810,-2085.7125 6810,-2054.6933 6810,-2032.0611"/>
<polygon fill="#000000" stroke="#000000" points="6813.5001,-2032.0188 6810,-2022.0188 6806.5001,-2032.0188 6813.5001,-2032.0188"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7127" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7127" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6850.4703,-2108.0144C6912.7658,-2084.511 7031.1799,-2039.8349 7090.7953,-2017.3427"/>
<polygon fill="#000000" stroke="#000000" points="7092.0645,-2020.6048 7100.1852,-2013.8 7089.5935,-2014.0554 7092.0645,-2020.6048"/>
</g>
<!-- section_90 -->
<g id="node91" class="node">
<title>section_90</title>
<ellipse fill="none" stroke="#000000" cx="7884" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7884" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 292&#45;344</text>
</g>
<!-- section_10&#45;&gt;section_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;section_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6878.4073,-2115.6655C7068.6756,-2094.4773 7603.3862,-2034.9322 7805.3918,-2012.4369"/>
<polygon fill="#000000" stroke="#000000" points="7805.7836,-2015.915 7815.3348,-2011.3297 7805.0088,-2008.958 7805.7836,-2015.915"/>
</g>
<!-- header_122 -->
<g id="node123" class="node">
<title>header_122</title>
<ellipse fill="none" stroke="#000000" cx="9196" cy="-2003.6832" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="9196" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_11&#45;&gt;header_122 -->
<g id="edge122" class="edge">
<title>section_11&#45;&gt;header_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9413.8916,-2107.4C9389.9965,-2096.7994 9358.0197,-2082.4421 9330,-2069.2833 9299.2005,-2054.819 9264.725,-2037.9253 9238.4566,-2024.9043"/>
<polygon fill="#000000" stroke="#000000" points="9239.6853,-2021.6067 9229.172,-2020.294 9236.572,-2027.8763 9239.6853,-2021.6067"/>
</g>
<!-- prose_123 -->
<g id="node124" class="node">
<title>prose_123</title>
<ellipse fill="none" stroke="#000000" cx="9371" cy="-2003.6832" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9371" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_123 -->
<g id="edge123" class="edge">
<title>section_11&#45;&gt;prose_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9438.1729,-2105.3779C9424.8731,-2085.243 9403.1618,-2052.3737 9388.0351,-2029.473"/>
<polygon fill="#000000" stroke="#000000" points="9390.8263,-2027.3484 9382.3944,-2020.9334 9384.9855,-2031.2065 9390.8263,-2027.3484"/>
</g>
<!-- codeblock_124 -->
<g id="node125" class="node">
<title>codeblock_124</title>
<ellipse fill="none" stroke="#000000" cx="9520" cy="-2003.6832" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9520" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 347&#45;360</text>
</g>
<!-- section_11&#45;&gt;codeblock_124 -->
<g id="edge124" class="edge">
<title>section_11&#45;&gt;codeblock_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9460.4797,-2105.3779C9472.0781,-2085.5612 9490.8961,-2053.4094 9504.2659,-2030.5661"/>
<polygon fill="#000000" stroke="#000000" points="9507.418,-2032.1093 9509.4487,-2021.7109 9501.3767,-2028.5734 9507.418,-2032.1093"/>
</g>
<!-- section_125 -->
<g id="node126" class="node">
<title>section_125</title>
<ellipse fill="none" stroke="#000000" cx="9964" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9964" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 363&#45;396</text>
</g>
<!-- section_11&#45;&gt;section_125 -->
<g id="edge125" class="edge">
<title>section_11&#45;&gt;section_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9504.0355,-2110.71C9599.5721,-2088.4801 9797.8455,-2042.3448 9900.0355,-2018.5667"/>
<polygon fill="#000000" stroke="#000000" points="9900.9706,-2021.9427 9909.9172,-2016.2674 9899.3842,-2015.1249 9900.9706,-2021.9427"/>
</g>
<!-- section_126 -->
<g id="node127" class="node">
<title>section_126</title>
<ellipse fill="none" stroke="#000000" cx="10947" cy="-2003.6832" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="10947" y="-1999.4832" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 397&#45;430</text>
</g>
<!-- section_11&#45;&gt;section_126 -->
<g id="edge126" class="edge">
<title>section_11&#45;&gt;section_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9521.6991,-2117.555C9771.0506,-2097.6335 10599.6221,-2031.4363 10864.6881,-2010.2593"/>
<polygon fill="#000000" stroke="#000000" points="10865.3179,-2013.7203 10875.0073,-2009.4349 10864.7603,-2006.7425 10865.3179,-2013.7203"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-1836.544 0,-1836.544 0,-1764.7417 324,-1764.7417 324,-1836.544"/>
<text text-anchor="middle" x="162" y="-1773.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>raw_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1443.2584,-1985.7137C1438.1083,-1970.1452 1428.2158,-1948.5275 1411,-1938.083 1308.5373,-1875.921 448.0304,-1935.7092 333,-1902.083 290.725,-1889.725 248.1104,-1864.4853 215.9972,-1842.2752"/>
<polygon fill="#000000" stroke="#000000" points="217.841,-1839.2931 207.6474,-1836.405 213.8151,-1845.0196 217.841,-1839.2931"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-1827.9433 342.5,-1827.9433 342.5,-1773.3425 897.5,-1773.3425 897.5,-1827.9433"/>
<text text-anchor="middle" x="620" y="-1796.8429" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1781.4429" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1515.4533,-1985.8458C1510.4874,-1970.3662 1500.8907,-1948.8049 1484,-1938.083 1375.5357,-1869.2322 1032.8844,-1927.7358 907,-1902.083 831.0918,-1886.6144 748.0121,-1855.6 690.8634,-1831.9152"/>
<polygon fill="#000000" stroke="#000000" points="692.1422,-1828.6563 681.5657,-1828.0317 689.4442,-1835.1155 692.1422,-1828.6563"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-1827.9433 916,-1827.9433 916,-1773.3425 1464,-1773.3425 1464,-1827.9433"/>
<text text-anchor="middle" x="1190" y="-1796.8429" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1781.4429" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1586.1693,-1985.8201C1580.5548,-1971.1736 1570.7263,-1950.845 1556,-1938.083 1544.9017,-1928.4651 1381.4809,-1869.0176 1276.7994,-1831.523"/>
<polygon fill="#000000" stroke="#000000" points="1277.7682,-1828.1523 1267.1736,-1828.0778 1275.4092,-1834.7429 1277.7682,-1828.1523"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-1835.9432 1482,-1835.9432 1482,-1765.3425 2030,-1765.3425 2030,-1835.9432"/>
<text text-anchor="middle" x="1756" y="-1804.8429" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1789.4429" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>raw_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1671.8439,-1986.3721C1685.8804,-1955.3941 1715.7031,-1889.5766 1735.8057,-1845.2109"/>
<polygon fill="#000000" stroke="#000000" points="1738.9994,-1846.6427 1739.9387,-1836.0896 1732.6234,-1843.7537 1738.9994,-1846.6427"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-1818.6429 2048,-1818.6429 2048,-1782.6429 2162,-1782.6429 2162,-1818.6429"/>
<text text-anchor="middle" x="2105" y="-1797.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_23&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>header_23&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2266.5481,-1986.3019C2235.4628,-1959.8043 2179.0659,-1911.3888 2171,-1902.083 2150.8611,-1878.8485 2132.1791,-1849.0286 2119.8695,-1827.7453"/>
<polygon fill="#000000" stroke="#000000" points="2122.8273,-1825.8665 2114.8392,-1818.9065 2116.7436,-1829.3288 2122.8273,-1825.8665"/>
</g>
<!-- raw_30 -->
<g id="node31" class="node">
<title>raw_30</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_30 -->
<g id="edge30" class="edge">
<title>prose_24&#45;&gt;raw_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2399.1164,-1985.8191C2392.5124,-1970.9684 2381.1497,-1950.3491 2365,-1938.083 2319.9797,-1903.8891 2284.0416,-1940.9628 2243,-1902.083 2222.7389,-1882.8892 2213.8657,-1851.5659 2209.9889,-1828.798"/>
<polygon fill="#000000" stroke="#000000" points="2213.422,-1828.0874 2208.4976,-1818.7066 2206.4972,-1829.1108 2213.422,-1828.0874"/>
</g>
<!-- header_32 -->
<g id="node33" class="node">
<title>header_32</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-1800.6429" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_25&#45;&gt;header_32 -->
<g id="edge32" class="edge">
<title>section_25&#45;&gt;header_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2507.3164,-1986.268C2485.2247,-1966.473 2448.6019,-1932.9027 2419,-1902.083 2395.0472,-1877.1448 2369.3118,-1847.0548 2351.8989,-1826.1526"/>
<polygon fill="#000000" stroke="#000000" points="2354.5051,-1823.8123 2345.4282,-1818.3479 2349.1163,-1828.2801 2354.5051,-1823.8123"/>
</g>
<!-- prose_33 -->
<g id="node34" class="node">
<title>prose_33</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_25&#45;&gt;prose_33 -->
<g id="edge33" class="edge">
<title>section_25&#45;&gt;prose_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2521.0542,-1985.6647C2509.3083,-1950.0692 2483.0618,-1870.5304 2469.1161,-1828.2689"/>
<polygon fill="#000000" stroke="#000000" points="2472.3899,-1827.0205 2465.9325,-1818.621 2465.7425,-1829.2141 2472.3899,-1827.0205"/>
</g>
<!-- codeblock_34 -->
<g id="node35" class="node">
<title>codeblock_34</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-1800.6429" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;139</text>
</g>
<!-- section_25&#45;&gt;codeblock_34 -->
<g id="edge34" class="edge">
<title>section_25&#45;&gt;codeblock_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2532.8571,-1985.6647C2544.4277,-1950.0692 2570.2824,-1870.5304 2584.0199,-1828.2689"/>
<polygon fill="#000000" stroke="#000000" points="2587.3932,-1829.2132 2587.1561,-1818.621 2580.7361,-1827.0492 2587.3932,-1829.2132"/>
</g>
<!-- header_39 -->
<g id="node40" class="node">
<title>header_39</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-1800.6429" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_26&#45;&gt;header_39 -->
<g id="edge39" class="edge">
<title>section_26&#45;&gt;header_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2897.1971,-1985.6647C2873.6834,-1949.7682 2820.896,-1869.182 2793.3991,-1827.2047"/>
<polygon fill="#000000" stroke="#000000" points="2796.1838,-1825.0683 2787.7764,-1818.621 2790.3282,-1828.9039 2796.1838,-1825.0683"/>
</g>
<!-- prose_40 -->
<g id="node41" class="node">
<title>prose_40</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_40 -->
<g id="edge40" class="edge">
<title>section_26&#45;&gt;prose_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-1985.6647C2909,-1950.309 2909,-1871.6001 2909,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-1828.9128 2909,-1818.9128 2905.5001,-1828.9129 2912.5001,-1828.9128"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_26&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2916.277,-1985.6647C2930.7192,-1949.9041 2963.0735,-1869.7916 2980.0795,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="2983.357,-1828.9141 2983.8564,-1818.3311 2976.8663,-1826.2928 2983.357,-1828.9141"/>
</g>
<!-- codeblock_42 -->
<g id="node43" class="node">
<title>codeblock_42</title>
<ellipse fill="none" stroke="#000000" cx="3214" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3214" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;218</text>
</g>
<!-- section_26&#45;&gt;codeblock_42 -->
<g id="edge42" class="edge">
<title>section_26&#45;&gt;codeblock_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2934.4795,-1986.7213C2989.0635,-1950.3844 3117.3442,-1864.9872 3179.3029,-1823.7409"/>
<polygon fill="#000000" stroke="#000000" points="3181.5618,-1826.4419 3187.9465,-1817.9869 3177.6827,-1820.6149 3181.5618,-1826.4419"/>
</g>
<!-- header_49 -->
<g id="node50" class="node">
<title>header_49</title>
<ellipse fill="none" stroke="#000000" cx="3727" cy="-1800.6429" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3727" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_27&#45;&gt;header_49 -->
<g id="edge49" class="edge">
<title>section_27&#45;&gt;header_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3947.0344,-1986.0199C3903.9678,-1949.7367 3805.4594,-1866.7442 3756.1874,-1825.233"/>
<polygon fill="#000000" stroke="#000000" points="3758.3371,-1822.4675 3748.4343,-1818.7011 3753.8269,-1827.8209 3758.3371,-1822.4675"/>
</g>
<!-- prose_50 -->
<g id="node51" class="node">
<title>prose_50</title>
<ellipse fill="none" stroke="#000000" cx="3968" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3968" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_50 -->
<g id="edge50" class="edge">
<title>section_27&#45;&gt;prose_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968,-1985.6647C3968,-1950.309 3968,-1871.6001 3968,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="3971.5001,-1828.9128 3968,-1818.9128 3964.5001,-1828.9129 3971.5001,-1828.9128"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="4050" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4050" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_27&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3975.277,-1985.6647C3989.7192,-1949.9041 4022.0735,-1869.7916 4039.0795,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="4042.357,-1828.9141 4042.8564,-1818.3311 4035.8663,-1826.2928 4042.357,-1828.9141"/>
</g>
<!-- codeblock_52 -->
<g id="node53" class="node">
<title>codeblock_52</title>
<ellipse fill="none" stroke="#000000" cx="4188" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4188" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;229</text>
</g>
<!-- section_27&#45;&gt;codeblock_52 -->
<g id="edge52" class="edge">
<title>section_27&#45;&gt;codeblock_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3990.4335,-1986.4495C4015.6081,-1966.8172 4057.3304,-1933.3922 4091,-1902.083 4117.5822,-1877.3644 4146.0735,-1847.0643 4165.2509,-1826.0487"/>
<polygon fill="#000000" stroke="#000000" points="4167.9917,-1828.2367 4172.1214,-1818.4798 4162.8086,-1823.5319 4167.9917,-1828.2367"/>
</g>
<!-- header_59 -->
<g id="node60" class="node">
<title>header_59</title>
<ellipse fill="none" stroke="#000000" cx="4661" cy="-1800.6429" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4661" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_28&#45;&gt;header_59 -->
<g id="edge59" class="edge">
<title>section_28&#45;&gt;header_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4886.0262,-1986.3721C4842.2209,-1950.2166 4740.9157,-1866.6026 4690.5426,-1825.0263"/>
<polygon fill="#000000" stroke="#000000" points="4692.5623,-1822.1552 4682.622,-1818.489 4688.1064,-1827.5538 4692.5623,-1822.1552"/>
</g>
<!-- prose_60 -->
<g id="node61" class="node">
<title>prose_60</title>
<ellipse fill="none" stroke="#000000" cx="4825" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4825" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_60 -->
<g id="edge60" class="edge">
<title>section_28&#45;&gt;prose_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4899.723,-1985.6647C4885.2808,-1949.9041 4852.9265,-1869.7916 4835.9205,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="4839.1337,-1826.2928 4832.1436,-1818.3311 4832.643,-1828.9141 4839.1337,-1826.2928"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4907" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4907" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_28&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4907,-1985.6647C4907,-1950.309 4907,-1871.6001 4907,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="4910.5001,-1828.9128 4907,-1818.9128 4903.5001,-1828.9129 4910.5001,-1828.9128"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="5546" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5546" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_28&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4952.443,-1989.2438C5072.5804,-1951.0705 5396.9621,-1847.9992 5508.0648,-1812.6967"/>
<polygon fill="#000000" stroke="#000000" points="5509.3633,-1815.9566 5517.8339,-1809.5926 5507.2435,-1809.2853 5509.3633,-1815.9566"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5774" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5774" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_28&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4981.6674,-2000.9844C5108.9819,-1994.5378 5374.881,-1973.0074 5587,-1902.083 5646.7395,-1882.1085 5709.8767,-1843.7267 5745.3709,-1820.3286"/>
<polygon fill="#000000" stroke="#000000" points="5747.4008,-1823.1819 5753.7804,-1814.7231 5743.5182,-1817.3573 5747.4008,-1823.1819"/>
</g>
<!-- codeblock_64 -->
<g id="node65" class="node">
<title>codeblock_64</title>
<ellipse fill="none" stroke="#000000" cx="6065" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6065" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;279</text>
</g>
<!-- section_28&#45;&gt;codeblock_64 -->
<g id="edge64" class="edge">
<title>section_28&#45;&gt;codeblock_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4982.3876,-2002.1902C5139.588,-1997.5714 5512.8768,-1978.7281 5815,-1902.083 5890.7637,-1882.8627 5973.9823,-1845.5966 6022.7436,-1821.9783"/>
<polygon fill="#000000" stroke="#000000" points="6024.5743,-1824.9794 6032.024,-1817.446 6021.5024,-1818.6894 6024.5743,-1824.9794"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="1887,-912.6029 1549,-912.6029 1549,-856.7999 1887,-856.7999 1887,-912.6029"/>
<text text-anchor="middle" x="1718" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_30&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>raw_30&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2206.0678,-1782.38C2203.8287,-1759.1632 2196.2841,-1719.6478 2171,-1699.2027 2075.1502,-1621.6973 1987.1858,-1746.1451 1896,-1663.2027 1675.285,-1462.4409 1699.8634,-1049.081 1713.304,-922.4225"/>
<polygon fill="#000000" stroke="#000000" points="1716.7885,-922.7546 1714.4054,-912.4313 1709.8306,-921.9875 1716.7885,-922.7546"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2047,-902.7014 1905,-902.7014 1905,-866.7014 2047,-866.7014 2047,-902.7014"/>
<text text-anchor="middle" x="1976" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_32&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>header_32&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2320.7598,-1782.7258C2306.4873,-1759.5064 2278.3421,-1719.589 2243,-1699.2027 2169.6854,-1656.9129 2113.1639,-1725.6187 2056,-1663.2027 1853.5357,-1442.1367 1940.6354,-1023.8655 1968.5659,-912.514"/>
<polygon fill="#000000" stroke="#000000" points="1971.9856,-913.2685 1971.0725,-902.713 1965.2038,-911.534 1971.9856,-913.2685"/>
</g>
<!-- raw_36 -->
<g id="node37" class="node">
<title>raw_36</title>
<ellipse fill="none" stroke="#000000" cx="2092" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2092" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_33&#45;&gt;raw_36 -->
<g id="edge36" class="edge">
<title>prose_33&#45;&gt;raw_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2458.1437,-1782.2833C2454.7342,-1758.9619 2445.2138,-1719.3336 2419,-1699.2027 2315.6418,-1619.829 2216.5404,-1758.8255 2128,-1663.2027 2025.0568,-1552.0251 2074.6862,-1039.4922 2088.7156,-912.9877"/>
<polygon fill="#000000" stroke="#000000" points="2092.2071,-913.2583 2089.8469,-902.9298 2085.251,-912.4758 2092.2071,-913.2583"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2685,-1663.2041 2137,-1663.2041 2137,-106.1988 2685,-106.1988 2685,-1663.2041"/>
<text text-anchor="middle" x="2411" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2411" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2411" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2411" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2411" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2411" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2411" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2411" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2411" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2411" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2411" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2411" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2411" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2411" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2411" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2411" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2411" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2411" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2411" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2411" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2411" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2411" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2411" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2411" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2411" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2411" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2411" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2411" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2411" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2411" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2411" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2411" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2411" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2411" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2411" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2411" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2411" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2411" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2411" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2411" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2411" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2411" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2411" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2411" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2411" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2411" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2411" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2411" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2411" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2411" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2411" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2411" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2411" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2411" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2411" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2411" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2411" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2411" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2411" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2411" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_34&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>codeblock_34&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.3645,-1782.3466C2585.1608,-1761.191 2577.5447,-1722.8617 2567.7475,-1673.5558"/>
<polygon fill="#000000" stroke="#000000" points="2571.1412,-1672.6762 2565.7593,-1663.5501 2564.2754,-1674.0405 2571.1412,-1672.6762"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="2119,-53.1 2065,-53.1 2065,-17.1 2119,-17.1 2119,-53.1"/>
</g>
<!-- raw_36&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>raw_36&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2092,-866.5632C2092,-758.2631 2092,-197.2221 2092,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2095.5001,-63.4293 2092,-53.4293 2088.5001,-63.4293 2095.5001,-63.4293"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="2859,-902.7014 2703,-902.7014 2703,-866.7014 2859,-866.7014 2859,-902.7014"/>
<text text-anchor="middle" x="2781" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_39&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>header_39&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776.0999,-1782.3466C2776.723,-1668.1955 2780.0756,-1054.0449 2780.8433,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="2784.3451,-913.0603 2780.8999,-903.0413 2777.3453,-913.022 2784.3451,-913.0603"/>
</g>
<!-- raw_44 -->
<g id="node45" class="node">
<title>raw_44</title>
<ellipse fill="none" stroke="#000000" cx="2904" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2904" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_40&#45;&gt;raw_44 -->
<g id="edge44" class="edge">
<title>prose_40&#45;&gt;raw_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.9001,-1782.3466C2908.277,-1668.1955 2904.9244,-1054.0449 2904.1567,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="2907.6547,-913.022 2904.1001,-903.0413 2900.6549,-913.0603 2907.6547,-913.022"/>
</g>
<!-- raw_46 -->
<g id="node47" class="node">
<title>raw_46</title>
<ellipse fill="none" stroke="#000000" cx="2976" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2976" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_46 -->
<g id="edge46" class="edge">
<title>prose_41&#45;&gt;raw_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.7004,-1782.3466C2988.831,-1668.1955 2978.7733,-1054.0449 2976.4701,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="2979.9637,-912.9826 2976.3003,-903.0413 2972.9647,-913.0973 2979.9637,-912.9826"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3576.5,-1412.5035 3021.5,-1412.5035 3021.5,-356.8993 3576.5,-356.8993 3576.5,-1412.5035"/>
<text text-anchor="middle" x="3299" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3299" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3299" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3299" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3299" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3299" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3299" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3299" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3299" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3299" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3299" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3299" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3299" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3299" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3299" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3299" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3299" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3299" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3299" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3299" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3299" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3299" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3299" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3299" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3299" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3299" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3299" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3299" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3299" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3299" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3299" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3299" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3299" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3299" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3299" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3299" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3299" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3299" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3299" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3299" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3299" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3299" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3299" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3299" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3299" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3299" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3299" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3299" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3299" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3299" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3299" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3299" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3299" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3299" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3299" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3299" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3299" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_42&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_42&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3215.6979,-1782.3466C3220.3733,-1731.966 3234.0869,-1584.1907 3249.0721,-1422.7138"/>
<polygon fill="#000000" stroke="#000000" points="3252.5758,-1422.8346 3250.0149,-1412.5539 3245.6058,-1422.1877 3252.5758,-1422.8346"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="2708,-63.0015 2188,-63.0015 2188,-7.1986 2708,-7.1986 2708,-63.0015"/>
<text text-anchor="middle" x="2448" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_44&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>raw_44&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2906.0764,-866.5426C2917.7776,-760.5929 2971.3653,-222.9525 2868,-106.2001 2860.2086,-97.3996 2756.5492,-79.8018 2654.174,-64.3163"/>
<polygon fill="#000000" stroke="#000000" points="2654.6839,-60.8537 2644.274,-62.8247 2653.6409,-67.7756 2654.6839,-60.8537"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="3225.5,-62.4005 2726.5,-62.4005 2726.5,-7.7996 3225.5,-7.7996 3225.5,-62.4005"/>
<text text-anchor="middle" x="2976" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2976" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_46&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>raw_46&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2976,-866.5632C2976,-760.635 2976,-221.5794 2976,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2979.5001,-72.6367 2976,-62.6367 2972.5001,-72.6368 2979.5001,-72.6367"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="3925.5,-902.7014 3594.5,-902.7014 3594.5,-866.7014 3925.5,-866.7014 3925.5,-902.7014"/>
<text text-anchor="middle" x="3760" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_49&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>header_49&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3727.6592,-1782.3466C3731.7719,-1668.1955 3753.8988,-1054.0449 3758.9658,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="3762.4768,-913.1608 3759.3392,-903.0413 3755.4814,-912.9087 3762.4768,-913.1608"/>
</g>
<!-- raw_54 -->
<g id="node55" class="node">
<title>raw_54</title>
<ellipse fill="none" stroke="#000000" cx="3971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_50&#45;&gt;raw_54 -->
<g id="edge54" class="edge">
<title>prose_50&#45;&gt;raw_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.0599,-1782.3466C3968.4338,-1668.1955 3970.4453,-1054.0449 3970.906,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="3974.4071,-913.0527 3970.9399,-903.0413 3967.4071,-913.0297 3974.4071,-913.0527"/>
</g>
<!-- raw_56 -->
<g id="node57" class="node">
<title>raw_56</title>
<ellipse fill="none" stroke="#000000" cx="4048" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4048" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_56 -->
<g id="edge56" class="edge">
<title>prose_51&#45;&gt;raw_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4049.96,-1782.3466C4049.7108,-1668.1955 4048.3698,-1054.0449 4048.0627,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4051.562,-913.0336 4048.04,-903.0413 4044.562,-913.0489 4051.562,-913.0336"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="4215,-902.7014 4161,-902.7014 4161,-866.7014 4215,-866.7014 4215,-902.7014"/>
</g>
<!-- codeblock_52&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>codeblock_52&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4188,-1782.3466C4188,-1668.1955 4188,-1054.0449 4188,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4191.5001,-913.0412 4188,-903.0413 4184.5001,-913.0413 4191.5001,-913.0412"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3610,-63.0015 3244,-63.0015 3244,-7.1986 3610,-7.1986 3610,-63.0015"/>
<text text-anchor="middle" x="3427" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_54&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>raw_54&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3973.1435,-866.4566C3985.2235,-760.0173 4040.5535,-220.0631 3934,-106.2001 3885.8589,-54.7566 3688.6927,-80.541 3619,-70.2001 3607.2815,-68.4613 3595.1829,-66.5428 3583.0264,-64.5261"/>
<polygon fill="#000000" stroke="#000000" points="3583.25,-61.0148 3572.8085,-62.8108 3582.0911,-67.9182 3583.25,-61.0148"/>
</g>
<!-- leaf_57 -->
<g id="node58" class="node">
<title>leaf_57</title>
<polygon fill="none" stroke="#c0c0c0" points="3973.5,-55.0021 3628.5,-55.0021 3628.5,-15.198 3973.5,-15.198 3973.5,-55.0021"/>
<text text-anchor="middle" x="3801" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_56&#45;&gt;leaf_57 -->
<g id="edge57" class="edge">
<title>raw_56&#45;&gt;leaf_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4053.4764,-867.0485C4080.6252,-775.7741 4192.2448,-352.1496 4007,-106.2001 3992.9481,-87.5434 3944.533,-70.3443 3898.1698,-57.5365"/>
<polygon fill="#000000" stroke="#000000" points="3898.8877,-54.1049 3888.3207,-54.8711 3897.0592,-60.8619 3898.8877,-54.1049"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4770.5,-902.7014 4551.5,-902.7014 4551.5,-866.7014 4770.5,-866.7014 4770.5,-902.7014"/>
<text text-anchor="middle" x="4661" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_59&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>header_59&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4661,-1782.3466C4661,-1668.1955 4661,-1054.0449 4661,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4664.5001,-913.0412 4661,-903.0413 4657.5001,-913.0413 4664.5001,-913.0412"/>
</g>
<!-- raw_66 -->
<g id="node67" class="node">
<title>raw_66</title>
<ellipse fill="none" stroke="#000000" cx="4820" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4820" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_60&#45;&gt;raw_66 -->
<g id="edge66" class="edge">
<title>prose_60&#45;&gt;raw_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4824.9001,-1782.3466C4824.277,-1668.1955 4820.9244,-1054.0449 4820.1567,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4823.6547,-913.022 4820.1001,-903.0413 4816.6549,-913.0603 4823.6547,-913.022"/>
</g>
<!-- raw_68 -->
<g id="node69" class="node">
<title>raw_68</title>
<ellipse fill="none" stroke="#000000" cx="4899" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4899" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_68 -->
<g id="edge68" class="edge">
<title>prose_61&#45;&gt;raw_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4906.8402,-1782.3466C4905.8432,-1668.1955 4900.4791,-1054.0449 4899.2507,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="4902.7475,-913.0103 4899.1602,-903.0413 4895.7478,-913.0715 4902.7475,-913.0103"/>
</g>
<!-- raw_70 -->
<g id="node71" class="node">
<title>raw_70</title>
<ellipse fill="none" stroke="#000000" cx="5223" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5223" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_70 -->
<g id="edge70" class="edge">
<title>prose_62&#45;&gt;raw_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5519.9346,-1789.6551C5478.1228,-1770.5691 5396.7375,-1727.116 5357,-1663.2027 5198.4302,-1408.1614 5213.0916,-1019.8176 5220.6481,-912.8333"/>
<polygon fill="#000000" stroke="#000000" points="5224.1411,-913.0555 5221.3942,-902.823 5217.1605,-912.5351 5224.1411,-913.0555"/>
</g>
<!-- prespace_71 -->
<g id="node72" class="node">
<title>prespace_71</title>
<ellipse fill="none" stroke="#000000" cx="5412" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5412" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_62&#45;&gt;prespace_71 -->
<g id="edge71" class="edge">
<title>prose_62&#45;&gt;prespace_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5533.2421,-1783.9926C5515.0591,-1759.2151 5482.3109,-1710.4684 5468,-1663.2027 5382.5648,-1381.0302 5401.9013,-1016.166 5409.6314,-912.9857"/>
<polygon fill="#000000" stroke="#000000" points="5413.1402,-913.0068 5410.4246,-902.7659 5406.1612,-912.4651 5413.1402,-913.0068"/>
</g>
<!-- literal_72 -->
<g id="node73" class="node">
<title>literal_72</title>
<ellipse fill="none" stroke="#000000" cx="5508" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5508" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_62&#45;&gt;literal_72 -->
<g id="edge72" class="edge">
<title>prose_62&#45;&gt;literal_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5545.2409,-1782.3466C5540.5051,-1668.1955 5515.0256,-1054.0449 5509.1909,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="5512.6725,-912.8876 5508.7609,-903.0413 5505.6785,-913.1778 5512.6725,-912.8876"/>
</g>
<!-- raw_73 -->
<g id="node74" class="node">
<title>raw_73</title>
<ellipse fill="none" stroke="#000000" cx="5584" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5584" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_73 -->
<g id="edge73" class="edge">
<title>prose_62&#45;&gt;raw_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5546.7591,-1782.3466C5551.4949,-1668.1955 5576.9744,-1054.0449 5582.8091,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="5586.3215,-913.1778 5583.2391,-903.0413 5579.3275,-912.8876 5586.3215,-913.1778"/>
</g>
<!-- prespace_74 -->
<g id="node75" class="node">
<title>prespace_74</title>
<ellipse fill="none" stroke="#000000" cx="5675" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5675" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_62&#45;&gt;prespace_74 -->
<g id="edge74" class="edge">
<title>prose_62&#45;&gt;prespace_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5558.1017,-1783.8827C5575.3497,-1758.9683 5606.4154,-1710.0528 5620,-1663.2027 5702.0969,-1380.0689 5684.3742,-1015.8774 5677.2037,-912.9208"/>
<polygon fill="#000000" stroke="#000000" points="5680.6786,-912.4453 5676.4673,-902.7235 5673.6968,-912.9496 5680.6786,-912.4453"/>
</g>
<!-- literal_75 -->
<g id="node76" class="node">
<title>literal_75</title>
<ellipse fill="none" stroke="#000000" cx="5771" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5771" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_62&#45;&gt;literal_75 -->
<g id="edge75" class="edge">
<title>prose_62&#45;&gt;literal_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5572.2442,-1789.9542C5614.1836,-1771.2931 5695.1303,-1728.4304 5730,-1663.2027 5801.2288,-1529.9614 5779.4021,-1037.0063 5772.6546,-913.1033"/>
<polygon fill="#000000" stroke="#000000" points="5776.1379,-912.7035 5772.0879,-902.9133 5769.1487,-913.0923 5776.1379,-912.7035"/>
</g>
<!-- raw_76 -->
<g id="node77" class="node">
<title>raw_76</title>
<ellipse fill="none" stroke="#000000" cx="5847" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5847" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_76 -->
<g id="edge76" class="edge">
<title>prose_62&#45;&gt;raw_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5568.779,-1787.6668C5603.7438,-1767.8907 5672.9085,-1729.3293 5733,-1699.2027 5767.1316,-1682.0911 5789.6848,-1694.8798 5811,-1663.2027 5895.4114,-1537.7568 5859.8704,-1037.9501 5849.4874,-913.0844"/>
<polygon fill="#000000" stroke="#000000" points="5852.95,-912.4935 5848.62,-902.8239 5845.9749,-913.0832 5852.95,-912.4935"/>
</g>
<!-- raw_84 -->
<g id="node85" class="node">
<title>raw_84</title>
<ellipse fill="none" stroke="#000000" cx="5919" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5919" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_84 -->
<g id="edge84" class="edge">
<title>prose_63&#45;&gt;raw_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5791.6067,-1785.4571C5817.1836,-1762.1545 5863.6667,-1714.8232 5883,-1663.2027 5986.4676,-1386.9409 5939.8033,-1016.548 5923.6866,-912.762"/>
<polygon fill="#000000" stroke="#000000" points="5927.1235,-912.0882 5922.0983,-902.7609 5920.2102,-913.1862 5927.1235,-912.0882"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6470,-1127.7024 5964,-1127.7024 5964,-641.7005 6470,-641.7005 6470,-1127.7024"/>
<text text-anchor="middle" x="6217" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6217" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6217" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6217" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6217" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6217" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6217" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6217" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6217" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6217" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6217" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6217" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6217" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6217" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6217" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6217" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6217" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6217" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6217" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6217" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6217" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6217" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6217" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6217" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6217" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_64&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>codeblock_64&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6068.0363,-1782.3466C6081.3649,-1702.0293 6135.7709,-1374.1825 6174.9809,-1137.9057"/>
<polygon fill="#000000" stroke="#000000" points="6178.4765,-1138.2202 6176.6609,-1127.7821 6171.5709,-1137.0742 6178.4765,-1138.2202"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="4266.5,-63.0015 3991.5,-63.0015 3991.5,-7.1986 4266.5,-7.1986 4266.5,-63.0015"/>
<text text-anchor="middle" x="4129" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_66&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>raw_66&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4822.0741,-866.7274C4833.8864,-760.689 4888.3722,-217.6516 4779,-106.2001 4739.7543,-66.2083 4331.378,-78.735 4276,-70.2001 4266.2755,-68.7013 4256.2456,-66.8885 4246.2086,-64.8858"/>
<polygon fill="#000000" stroke="#000000" points="4246.6802,-61.4096 4236.1803,-62.8243 4245.2707,-68.2662 4246.6802,-61.4096"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="4847,-70.3004 4285,-70.3004 4285,.1003 4847,.1003 4847,-70.3004"/>
<text text-anchor="middle" x="4566" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4566" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4566" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_68&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>raw_68&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4904.7377,-867.0195C4933.4888,-774.7193 5052.8952,-343.4211 4856,-106.2001 4845.2452,-93.2426 4821.2713,-82.2826 4791.4806,-73.1408"/>
<polygon fill="#000000" stroke="#000000" points="4792.1947,-69.7026 4781.6133,-70.2363 4790.218,-76.4177 4792.1947,-69.7026"/>
</g>
<!-- leaf_77 -->
<g id="node78" class="node">
<title>leaf_77</title>
<polygon fill="none" stroke="#c0c0c0" points="5385,-62.4005 4865,-62.4005 4865,-7.7996 5385,-7.7996 5385,-62.4005"/>
<text text-anchor="middle" x="5125" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5125" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_70&#45;&gt;leaf_77 -->
<g id="edge77" class="edge">
<title>raw_70&#45;&gt;leaf_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5220.9078,-866.5632C5208.6769,-760.5289 5146.3855,-220.4998 5129.3252,-72.5967"/>
<polygon fill="#000000" stroke="#000000" points="5132.7992,-72.1698 5128.1763,-62.6367 5125.8453,-72.972 5132.7992,-72.1698"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5457,-53.1 5403,-53.1 5403,-17.1 5457,-17.1 5457,-53.1"/>
<text text-anchor="middle" x="5430" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>prespace_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5412.3843,-866.5632C5414.6788,-758.2631 5426.5652,-197.2221 5429.3949,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="5432.899,-63.5012 5429.6117,-53.4293 5425.9005,-63.3529 5432.899,-63.5012"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5540.5,-53.1 5475.5,-53.1 5475.5,-17.1 5540.5,-17.1 5540.5,-53.1"/>
<text text-anchor="middle" x="5508" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>literal_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5508,-866.5632C5508,-758.2631 5508,-197.2221 5508,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="5511.5001,-63.4293 5508,-53.4293 5504.5001,-63.4293 5511.5001,-63.4293"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5827,-54.4006 5559,-54.4006 5559,-15.7995 5827,-15.7995 5827,-54.4006"/>
<text text-anchor="middle" x="5693" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5693" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>raw_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5583.0647,-866.6337C5577.9846,-763.4262 5556.2139,-248.1207 5620,-106.2001 5627.8815,-88.6642 5642.2262,-73.204 5656.1266,-61.2173"/>
<polygon fill="#000000" stroke="#000000" points="5658.707,-63.6268 5664.2074,-54.5716 5654.2606,-58.2203 5658.707,-63.6268"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5899,-53.1 5845,-53.1 5845,-17.1 5899,-17.1 5899,-53.1"/>
<text text-anchor="middle" x="5872" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>prespace_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5673.697,-866.4082C5666.5531,-760.8315 5635.8279,-229.8066 5731,-106.2001 5761.097,-67.1111 5793.9813,-96.0499 5836,-70.2001 5840.5306,-67.4129 5844.9441,-63.9638 5849.0395,-60.3258"/>
<polygon fill="#000000" stroke="#000000" points="5851.661,-62.6618 5856.4704,-53.2215 5846.8236,-57.6021 5851.661,-62.6618"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5975,-53.1 5917,-53.1 5917,-17.1 5975,-17.1 5975,-53.1"/>
<text text-anchor="middle" x="5946" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>literal_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5769.3337,-866.4682C5760.0909,-761.2292 5718.7841,-231.7834 5811,-106.2001 5838.2168,-69.1351 5868.8107,-94.2576 5908,-70.2001 5912.5708,-67.3942 5917.0769,-63.9873 5921.2999,-60.4126"/>
<polygon fill="#000000" stroke="#000000" points="5923.9389,-62.7453 5929.0142,-53.4451 5919.247,-57.5504 5923.9389,-62.7453"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="6079,-53.1 5993,-53.1 5993,-17.1 6079,-17.1 6079,-53.1"/>
<text text-anchor="middle" x="6036" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>raw_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5845.2062,-866.4562C5835.2323,-761.1498 5790.3148,-231.3889 5883,-106.2001 5911.3563,-67.8995 5941.4707,-91.7006 5984,-70.2001 5990.5491,-66.8892 5997.2528,-62.8899 6003.5761,-58.7937"/>
<polygon fill="#000000" stroke="#000000" points="6005.5563,-61.68 6011.9127,-53.2037 6001.6578,-55.866 6005.5563,-61.68"/>
</g>
<!-- leaf_85 -->
<g id="node86" class="node">
<title>leaf_85</title>
<polygon fill="none" stroke="#c0c0c0" points="6631,-62.4005 6097,-62.4005 6097,-7.7996 6631,-7.7996 6631,-62.4005"/>
<text text-anchor="middle" x="6364" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6364" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_84&#45;&gt;leaf_85 -->
<g id="edge85" class="edge">
<title>raw_84&#45;&gt;leaf_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5916.9313,-866.5494C5905.2739,-760.6384 5851.8931,-223.1808 5955,-106.2001 5962.653,-97.5174 6065.6301,-79.643 6166.3284,-63.9893"/>
<polygon fill="#000000" stroke="#000000" points="6167.0303,-67.4225 6176.3769,-62.4334 6165.9591,-60.5049 6167.0303,-67.4225"/>
</g>
<!-- leaf_91 -->
<g id="node92" class="node">
<title>leaf_91</title>
<polygon fill="none" stroke="#c0c0c0" points="6747.5,-1818.6429 6556.5,-1818.6429 6556.5,-1782.6429 6747.5,-1782.6429 6747.5,-1818.6429"/>
<text text-anchor="middle" x="6652" y="-1797.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_87&#45;&gt;leaf_91 -->
<g id="edge91" class="edge">
<title>header_87&#45;&gt;leaf_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6652,-1985.6647C6652,-1950.309 6652,-1871.6001 6652,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="6655.5001,-1828.9128 6652,-1818.9128 6648.5001,-1828.9129 6655.5001,-1828.9128"/>
</g>
<!-- raw_92 -->
<g id="node93" class="node">
<title>raw_92</title>
<ellipse fill="none" stroke="#000000" cx="6802" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="6802" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_88&#45;&gt;raw_92 -->
<g id="edge92" class="edge">
<title>prose_88&#45;&gt;raw_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6809.2901,-1985.6647C6807.897,-1950.309 6804.7958,-1871.6001 6803.1223,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="6806.6109,-1828.7673 6802.7199,-1818.9128 6799.6164,-1829.0429 6806.6109,-1828.7673"/>
</g>
<!-- raw_94 -->
<g id="node95" class="node">
<title>raw_94</title>
<ellipse fill="none" stroke="#000000" cx="7184" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="7184" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_94 -->
<g id="edge94" class="edge">
<title>prose_89&#45;&gt;raw_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7132.0584,-1985.6647C7142.0512,-1950.0692 7164.3803,-1870.5304 7176.2445,-1828.2689"/>
<polygon fill="#000000" stroke="#000000" points="7179.6198,-1829.1948 7178.953,-1818.621 7172.8803,-1827.3028 7179.6198,-1829.1948"/>
</g>
<!-- header_96 -->
<g id="node97" class="node">
<title>header_96</title>
<ellipse fill="none" stroke="#000000" cx="7686" cy="-1800.6429" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7686" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_90&#45;&gt;header_96 -->
<g id="edge96" class="edge">
<title>section_90&#45;&gt;header_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7866.7752,-1986.0199C7831.4344,-1949.7794 7750.6512,-1866.9399 7710.123,-1825.38"/>
<polygon fill="#000000" stroke="#000000" points="7712.5315,-1822.8366 7703.044,-1818.1208 7707.5199,-1827.7238 7712.5315,-1822.8366"/>
</g>
<!-- prose_97 -->
<g id="node98" class="node">
<title>prose_97</title>
<ellipse fill="none" stroke="#000000" cx="7884" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7884" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_90&#45;&gt;prose_97 -->
<g id="edge97" class="edge">
<title>section_90&#45;&gt;prose_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7884,-1985.6647C7884,-1950.309 7884,-1871.6001 7884,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="7887.5001,-1828.9128 7884,-1818.9128 7880.5001,-1828.9129 7887.5001,-1828.9128"/>
</g>
<!-- prose_98 -->
<g id="node99" class="node">
<title>prose_98</title>
<ellipse fill="none" stroke="#000000" cx="8389" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8389" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_90&#45;&gt;prose_98 -->
<g id="edge98" class="edge">
<title>section_90&#45;&gt;prose_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7922.788,-1988.0881C8017.8298,-1949.8756 8261.256,-1852.0037 8353.1527,-1815.0557"/>
<polygon fill="#000000" stroke="#000000" points="8354.6075,-1818.2431 8362.58,-1811.2653 8351.9962,-1811.7484 8354.6075,-1818.2431"/>
</g>
<!-- codeblock_99 -->
<g id="node100" class="node">
<title>codeblock_99</title>
<ellipse fill="none" stroke="#000000" cx="8751" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8751" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 301&#45;342</text>
</g>
<!-- section_90&#45;&gt;codeblock_99 -->
<g id="edge99" class="edge">
<title>section_90&#45;&gt;codeblock_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7948.8506,-1994.2431C8051.6847,-1978.6867 8258.1224,-1945.0617 8430,-1902.083 8525.5315,-1878.195 8634.3597,-1841.8109 8697.6015,-1819.7266"/>
<polygon fill="#000000" stroke="#000000" points="8699.0718,-1822.9201 8707.3511,-1816.3091 8696.7562,-1816.3142 8699.0718,-1822.9201"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="7001.5,-920.0018 6488.5,-920.0018 6488.5,-849.4011 7001.5,-849.4011 7001.5,-920.0018"/>
<text text-anchor="middle" x="6745" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6745" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_92&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>raw_92&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6800.8614,-1782.3466C6794.0142,-1672.3175 6758.258,-1097.7465 6747.8468,-930.4478"/>
<polygon fill="#000000" stroke="#000000" points="6751.327,-930.0178 6747.2125,-920.2545 6744.3405,-930.4526 6751.327,-930.0178"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="7574.5,-927.9017 7019.5,-927.9017 7019.5,-841.5011 7574.5,-841.5011 7574.5,-927.9017"/>
<text text-anchor="middle" x="7297" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7297" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7297" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_94&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_94&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7186.2572,-1782.3466C7199.6307,-1673.9451 7268.6319,-1114.6439 7290.4077,-938.1368"/>
<polygon fill="#000000" stroke="#000000" points="7293.9011,-938.4042 7291.652,-928.0509 7286.9538,-937.547 7293.9011,-938.4042"/>
</g>
<!-- leaf_100 -->
<g id="node101" class="node">
<title>leaf_100</title>
<polygon fill="none" stroke="#c0c0c0" points="7699.5,-902.7014 7592.5,-902.7014 7592.5,-866.7014 7699.5,-866.7014 7699.5,-902.7014"/>
<text text-anchor="middle" x="7646" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_96&#45;&gt;leaf_100 -->
<g id="edge100" class="edge">
<title>header_96&#45;&gt;leaf_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7685.201,-1782.3466C7680.2159,-1668.1955 7653.3954,-1054.0449 7647.2536,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="7650.734,-912.879 7646.8009,-903.0413 7643.7406,-913.1845 7650.734,-912.879"/>
</g>
<!-- raw_101 -->
<g id="node102" class="node">
<title>raw_101</title>
<ellipse fill="none" stroke="#000000" cx="7745" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7745" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_97&#45;&gt;raw_101 -->
<g id="edge101" class="edge">
<title>prose_97&#45;&gt;raw_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7866.9514,-1784.852C7842.6894,-1761.1449 7799.1351,-1713.7187 7781,-1663.2027 7681.3233,-1385.5507 7725.3211,-1016.1356 7740.5636,-912.6702"/>
<polygon fill="#000000" stroke="#000000" points="7744.0366,-913.1106 7742.0661,-902.7006 7737.1148,-912.0673 7744.0366,-913.1106"/>
</g>
<!-- prespace_102 -->
<g id="node103" class="node">
<title>prespace_102</title>
<ellipse fill="none" stroke="#000000" cx="7836" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7836" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_97&#45;&gt;prespace_102 -->
<g id="edge102" class="edge">
<title>prose_97&#45;&gt;prespace_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7883.0412,-1782.3466C7877.0591,-1668.1955 7844.8745,-1054.0449 7837.5043,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="7840.9797,-912.8444 7836.9611,-903.0413 7833.9893,-913.2108 7840.9797,-912.8444"/>
</g>
<!-- literal_103 -->
<g id="node104" class="node">
<title>literal_103</title>
<ellipse fill="none" stroke="#000000" cx="7932" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7932" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_97&#45;&gt;literal_103 -->
<g id="edge103" class="edge">
<title>prose_97&#45;&gt;literal_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7884.9588,-1782.3466C7890.9409,-1668.1955 7923.1255,-1054.0449 7930.4957,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="7934.0107,-913.2108 7931.0389,-903.0413 7927.0203,-912.8444 7934.0107,-913.2108"/>
</g>
<!-- raw_104 -->
<g id="node105" class="node">
<title>raw_104</title>
<ellipse fill="none" stroke="#000000" cx="8008" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8008" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_97&#45;&gt;raw_104 -->
<g id="edge104" class="edge">
<title>prose_97&#45;&gt;raw_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7898.5765,-1784.3459C7919.3184,-1760.0084 7956.5461,-1711.8045 7972,-1663.2027 8061.2926,-1382.382 8024.7095,-1015.9161 8011.8006,-912.7827"/>
<polygon fill="#000000" stroke="#000000" points="8015.269,-912.3118 8010.5257,-902.8381 8008.3258,-913.202 8015.269,-912.3118"/>
</g>
<!-- prespace_109 -->
<g id="node110" class="node">
<title>prespace_109</title>
<ellipse fill="none" stroke="#000000" cx="8171" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8171" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_98&#45;&gt;prespace_109 -->
<g id="edge109" class="edge">
<title>prose_98&#45;&gt;prespace_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8368.8461,-1786.4594C8338.8703,-1764.1034 8283.3555,-1717.5751 8258,-1663.2027 8132.5407,-1394.1679 8157.7759,-1017.9476 8167.9377,-912.9089"/>
<polygon fill="#000000" stroke="#000000" points="8171.4368,-913.0923 8168.9526,-902.7928 8164.4718,-912.3935 8171.4368,-913.0923"/>
</g>
<!-- literal_110 -->
<g id="node111" class="node">
<title>literal_110</title>
<ellipse fill="none" stroke="#000000" cx="8298" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8298" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_98&#45;&gt;literal_110 -->
<g id="edge110" class="edge">
<title>prose_98&#45;&gt;literal_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8383.1374,-1782.6442C8374.9201,-1756.605 8360.1804,-1706.7673 8353,-1663.2027 8305.164,-1372.9762 8298.9072,-1015.1451 8298.1103,-913.0744"/>
<polygon fill="#000000" stroke="#000000" points="8301.6095,-912.9278 8298.0432,-902.9512 8294.6096,-912.9742 8301.6095,-912.9278"/>
</g>
<!-- raw_111 -->
<g id="node112" class="node">
<title>raw_111</title>
<ellipse fill="none" stroke="#000000" cx="8389" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8389" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_98&#45;&gt;raw_111 -->
<g id="edge111" class="edge">
<title>prose_98&#45;&gt;raw_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8389,-1782.3466C8389,-1668.1955 8389,-1054.0449 8389,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="8392.5001,-913.0412 8389,-903.0413 8385.5001,-913.0413 8392.5001,-913.0412"/>
</g>
<!-- prespace_112 -->
<g id="node113" class="node">
<title>prespace_112</title>
<ellipse fill="none" stroke="#000000" cx="8480" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8480" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_98&#45;&gt;prespace_112 -->
<g id="edge112" class="edge">
<title>prose_98&#45;&gt;prespace_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8394.8626,-1782.6442C8403.0799,-1756.605 8417.8196,-1706.7673 8425,-1663.2027 8472.836,-1372.9762 8479.0928,-1015.1451 8479.8897,-913.0744"/>
<polygon fill="#000000" stroke="#000000" points="8483.3904,-912.9742 8479.9568,-902.9512 8476.3905,-912.9278 8483.3904,-912.9742"/>
</g>
<!-- literal_113 -->
<g id="node114" class="node">
<title>literal_113</title>
<ellipse fill="none" stroke="#000000" cx="8576" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8576" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_98&#45;&gt;literal_113 -->
<g id="edge113" class="edge">
<title>prose_98&#45;&gt;literal_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8411.3087,-1787.5881C8445.1128,-1766.3967 8508.2059,-1720.9989 8535,-1663.2027 8659.2536,-1395.1816 8601.4271,-1018.2464 8581.6861,-912.9749"/>
<polygon fill="#000000" stroke="#000000" points="8585.0627,-911.9986 8579.7431,-902.8361 8578.1878,-913.3161 8585.0627,-911.9986"/>
</g>
<!-- raw_114 -->
<g id="node115" class="node">
<title>raw_114</title>
<ellipse fill="none" stroke="#000000" cx="8652" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8652" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_98&#45;&gt;raw_114 -->
<g id="edge114" class="edge">
<title>prose_98&#45;&gt;raw_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8418.3652,-1792.7087C8468.9838,-1777.2945 8571.51,-1738.0516 8616,-1663.2027 8693.2565,-1533.2282 8663.0539,-1036.8004 8654.1415,-912.8655"/>
<polygon fill="#000000" stroke="#000000" points="8657.6169,-912.4001 8653.3963,-902.6823 8650.6356,-912.9111 8657.6169,-912.4001"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="9252.5,-1198.1027 8697.5,-1198.1027 8697.5,-571.3002 9252.5,-571.3002 9252.5,-1198.1027"/>
<text text-anchor="middle" x="8975" y="-1182.702" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8975" y="-1151.302" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8975" y="-1135.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8975" y="-1120.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8975" y="-1105.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8975" y="-1089.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8975" y="-1074.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8975" y="-1058.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8975" y="-1043.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8975" y="-1028.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8975" y="-1012.7017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="8975" y="-981.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = function() return &quot;waaaaaaa!&quot; end}</text>
<text text-anchor="middle" x="8975" y="-949.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="8975" y="-934.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="8975" y="-919.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="8975" y="-903.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="8975" y="-888.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="8975" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="8975" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="8975" y="-842.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="8975" y="-826.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8975" y="-811.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8975" y="-795.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="8975" y="-780.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="8975" y="-765.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="8975" y="-749.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="8975" y="-734.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local second = fuzz_patt(slip)</text>
<text text-anchor="middle" x="8975" y="-718.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="8975" y="-703.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(second, tostring(historian[i]))</text>
<text text-anchor="middle" x="8975" y="-688.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="8975" y="-672.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="8975" y="-657.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8975" y="-641.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8975" y="-626.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8975" y="-595.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="8975" y="-579.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_99&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>codeblock_99&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8755.4745,-1782.3466C8773.2398,-1709.7038 8840.5245,-1434.5749 8895.9723,-1207.8477"/>
<polygon fill="#000000" stroke="#000000" points="8899.3782,-1208.6537 8898.3541,-1198.1085 8892.5786,-1206.9908 8899.3782,-1208.6537"/>
</g>
<!-- leaf_105 -->
<g id="node106" class="node">
<title>leaf_105</title>
<polygon fill="none" stroke="#c0c0c0" points="7735.5,-63.0015 7446.5,-63.0015 7446.5,-7.1986 7735.5,-7.1986 7735.5,-63.0015"/>
<text text-anchor="middle" x="7591" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_101&#45;&gt;leaf_105 -->
<g id="edge105" class="edge">
<title>raw_101&#45;&gt;leaf_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7746.3674,-866.7212C7753.9382,-762.9061 7787.5697,-240.1194 7708,-106.2001 7698.7803,-90.6829 7684.7354,-78.1153 7669.5393,-68.1129"/>
<polygon fill="#000000" stroke="#000000" points="7671.3448,-65.1142 7661.0019,-62.8175 7667.655,-71.0628 7671.3448,-65.1142"/>
</g>
<!-- leaf_106 -->
<g id="node107" class="node">
<title>leaf_106</title>
<polygon fill="none" stroke="#c0c0c0" points="7808,-53.1 7754,-53.1 7754,-17.1 7808,-17.1 7808,-53.1"/>
<text text-anchor="middle" x="7781" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_102&#45;&gt;leaf_106 -->
<g id="edge106" class="edge">
<title>prespace_102&#45;&gt;leaf_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7834.8258,-866.5632C7827.8149,-758.2631 7791.4952,-197.2221 7782.8489,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="7786.3254,-63.1823 7782.1866,-53.4293 7779.34,-63.6345 7786.3254,-63.1823"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7880,-53.1 7826,-53.1 7826,-17.1 7880,-17.1 7880,-53.1"/>
<text text-anchor="middle" x="7853" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>literal_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7933.8809,-866.7029C7942.3309,-780.3048 7972.9137,-400.2024 7891,-106.2001 7886.6774,-90.6856 7878.5631,-74.7531 7870.9391,-61.9129"/>
<polygon fill="#000000" stroke="#000000" points="7873.7669,-59.8306 7865.5356,-53.1601 7867.8105,-63.5078 7873.7669,-59.8306"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="8117.5,-54.4006 7898.5,-54.4006 7898.5,-15.7995 8117.5,-15.7995 8117.5,-54.4006"/>
<text text-anchor="middle" x="8008" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="8008" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>raw_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8008,-866.5632C8008,-758.5056 8008,-199.7321 8008,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8011.5001,-64.5318 8008,-54.5318 8004.5001,-64.5318 8011.5001,-64.5318"/>
</g>
<!-- leaf_115 -->
<g id="node116" class="node">
<title>leaf_115</title>
<polygon fill="none" stroke="#c0c0c0" points="8190,-53.1 8136,-53.1 8136,-17.1 8190,-17.1 8190,-53.1"/>
</g>
<!-- prespace_109&#45;&gt;leaf_115 -->
<g id="edge115" class="edge">
<title>prespace_109&#45;&gt;leaf_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8170.8292,-866.5632C8169.8094,-758.2631 8164.5266,-197.2221 8163.2689,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="8166.7667,-63.3959 8163.1726,-53.4293 8159.767,-63.4618 8166.7667,-63.3959"/>
</g>
<!-- leaf_116 -->
<g id="node117" class="node">
<title>leaf_116</title>
<polygon fill="none" stroke="#c0c0c0" points="8371.5,-53.1 8208.5,-53.1 8208.5,-17.1 8371.5,-17.1 8371.5,-53.1"/>
<text text-anchor="middle" x="8290" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_110&#45;&gt;leaf_116 -->
<g id="edge116" class="edge">
<title>literal_110&#45;&gt;leaf_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8297.8292,-866.5632C8296.8094,-758.2631 8291.5266,-197.2221 8290.2689,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="8293.7667,-63.3959 8290.1726,-53.4293 8286.767,-63.4618 8293.7667,-63.3959"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="8734.5,-54.4006 8389.5,-54.4006 8389.5,-15.7995 8734.5,-15.7995 8734.5,-54.4006"/>
<text text-anchor="middle" x="8562" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8562" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>raw_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8387.4715,-866.639C8378.9908,-762.3612 8341.0562,-237.4107 8425,-106.2001 8438.7079,-84.7736 8461.0857,-69.4613 8483.8193,-58.675"/>
<polygon fill="#000000" stroke="#000000" points="8485.5166,-61.75 8493.2144,-54.4702 8482.6571,-55.3607 8485.5166,-61.75"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8807,-53.1 8753,-53.1 8753,-17.1 8807,-17.1 8807,-53.1"/>
<text text-anchor="middle" x="8780" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>prespace_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8478.4382,-866.5151C8469.7325,-760.4092 8431.2502,-222.0303 8536,-106.2001 8598.6344,-36.9402 8659.5602,-112.1261 8743,-70.2001 8748.1425,-67.6161 8753.059,-64.0815 8757.5326,-60.2455"/>
<polygon fill="#000000" stroke="#000000" points="8760.1802,-62.5598 8765.06,-53.1556 8755.3808,-57.4642 8760.1802,-62.5598"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8879,-53.1 8825,-53.1 8825,-17.1 8879,-17.1 8879,-53.1"/>
<text text-anchor="middle" x="8852" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>literal_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8574.0432,-866.5515C8563.0358,-760.653 8512.917,-223.2538 8616,-106.2001 8675.6909,-38.4194 8735.6986,-111.5392 8816,-70.2001 8821.0447,-67.6031 8825.8484,-64.0621 8830.2084,-60.2238"/>
<polygon fill="#000000" stroke="#000000" points="8832.7823,-62.6035 8837.5333,-53.1336 8827.9138,-57.5738 8832.7823,-62.6035"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="9333,-54.4006 8897,-54.4006 8897,-15.7995 9333,-15.7995 9333,-54.4006"/>
<text text-anchor="middle" x="9115" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="9115" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>raw_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8649.919,-866.5384C8638.191,-760.5651 8584.4772,-222.8129 8688,-106.2001 8690.5105,-103.3722 8858.7818,-75.9748 8983.3059,-56.0332"/>
<polygon fill="#000000" stroke="#000000" points="8984.0011,-59.4666 8993.3223,-54.4301 8982.8948,-52.5545 8984.0011,-59.4666"/>
</g>
<!-- leaf_127 -->
<g id="node128" class="node">
<title>leaf_127</title>
<polygon fill="none" stroke="#c0c0c0" points="9260.5,-1818.6429 9111.5,-1818.6429 9111.5,-1782.6429 9260.5,-1782.6429 9260.5,-1818.6429"/>
<text text-anchor="middle" x="9186" y="-1797.1429" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_122&#45;&gt;leaf_127 -->
<g id="edge127" class="edge">
<title>header_122&#45;&gt;leaf_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9195.1126,-1985.6647C9193.3713,-1950.309 9189.4947,-1871.6001 9187.4029,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="9190.8876,-1828.7285 9186.8998,-1818.9128 9183.8961,-1829.0729 9190.8876,-1828.7285"/>
</g>
<!-- raw_128 -->
<g id="node129" class="node">
<title>raw_128</title>
<ellipse fill="none" stroke="#000000" cx="9306" cy="-1800.6429" rx="27" ry="18"/>
<text text-anchor="middle" x="9306" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_123&#45;&gt;raw_128 -->
<g id="edge128" class="edge">
<title>prose_123&#45;&gt;raw_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9365.2317,-1985.6647C9353.8077,-1949.9796 9328.245,-1870.1295 9314.742,-1827.9502"/>
<polygon fill="#000000" stroke="#000000" points="9318.0449,-1826.7878 9311.6626,-1818.3311 9311.3782,-1828.9221 9318.0449,-1826.7878"/>
</g>
<!-- leaf_130 -->
<g id="node131" class="node">
<title>leaf_130</title>
<polygon fill="none" stroke="#c0c0c0" points="9731,-1902.0232 9351,-1902.0232 9351,-1699.2626 9731,-1699.2626 9731,-1902.0232"/>
<text text-anchor="middle" x="9541" y="-1886.883" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="9541" y="-1871.483" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="9541" y="-1856.083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="9541" y="-1840.6829" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9541" y="-1825.2829" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="9541" y="-1806.5229" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; ]</text>
<text text-anchor="middle" x="9541" y="-1787.7629" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="9541" y="-1772.3629" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="9541" y="-1756.9628" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; </text>
<text text-anchor="middle" x="9541" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="9541" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="9541" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_124&#45;&gt;leaf_130 -->
<g id="edge130" class="edge">
<title>codeblock_124&#45;&gt;leaf_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9521.8636,-1985.6647C9523.6415,-1968.4748 9526.4794,-1941.0366 9529.4311,-1912.4976"/>
<polygon fill="#000000" stroke="#000000" points="9532.9309,-1912.6792 9530.4784,-1902.3722 9525.9681,-1911.959 9532.9309,-1912.6792"/>
</g>
<!-- header_131 -->
<g id="node132" class="node">
<title>header_131</title>
<ellipse fill="none" stroke="#000000" cx="9831" cy="-1800.6429" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="9831" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_125&#45;&gt;header_131 -->
<g id="edge131" class="edge">
<title>section_125&#45;&gt;header_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9952.1971,-1985.6647C9928.6834,-1949.7682 9875.896,-1869.182 9848.3991,-1827.2047"/>
<polygon fill="#000000" stroke="#000000" points="9851.1838,-1825.0683 9842.7764,-1818.621 9845.3282,-1828.9039 9851.1838,-1825.0683"/>
</g>
<!-- prose_132 -->
<g id="node133" class="node">
<title>prose_132</title>
<ellipse fill="none" stroke="#000000" cx="9964" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9964" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_125&#45;&gt;prose_132 -->
<g id="edge132" class="edge">
<title>section_125&#45;&gt;prose_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9964,-1985.6647C9964,-1950.309 9964,-1871.6001 9964,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="9967.5001,-1828.9128 9964,-1818.9128 9960.5001,-1828.9129 9967.5001,-1828.9128"/>
</g>
<!-- prose_133 -->
<g id="node134" class="node">
<title>prose_133</title>
<ellipse fill="none" stroke="#000000" cx="10079" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10079" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_125&#45;&gt;prose_133 -->
<g id="edge133" class="edge">
<title>section_125&#45;&gt;prose_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9974.2055,-1985.6647C9994.5965,-1949.663 10040.4479,-1868.7093 10064.1641,-1826.8367"/>
<polygon fill="#000000" stroke="#000000" points="10067.2618,-1828.4693 10069.1447,-1818.0431 10061.1709,-1825.0195 10067.2618,-1828.4693"/>
</g>
<!-- codeblock_134 -->
<g id="node135" class="node">
<title>codeblock_134</title>
<ellipse fill="none" stroke="#000000" cx="10284" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="10284" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 370&#45;394</text>
</g>
<!-- section_125&#45;&gt;codeblock_134 -->
<g id="edge134" class="edge">
<title>section_125&#45;&gt;codeblock_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9990.7326,-1986.7213C10048.1184,-1950.3099 10183.1426,-1864.637 10247.9952,-1823.4879"/>
<polygon fill="#000000" stroke="#000000" points="10250.0966,-1826.2998 10256.6651,-1817.9869 10246.3462,-1820.3892 10250.0966,-1826.2998"/>
</g>
<!-- header_147 -->
<g id="node148" class="node">
<title>header_147</title>
<ellipse fill="none" stroke="#000000" cx="10720" cy="-1800.6429" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="10720" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_126&#45;&gt;header_147 -->
<g id="edge147" class="edge">
<title>section_126&#45;&gt;header_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10924.7667,-1986.2303C10899.7717,-1966.4016 10858.2098,-1932.8011 10824,-1902.083 10796.0874,-1877.0194 10765.5033,-1846.8379 10744.774,-1825.9458"/>
<polygon fill="#000000" stroke="#000000" points="10747.1256,-1823.3461 10737.6059,-1818.6956 10742.1477,-1828.2676 10747.1256,-1823.3461"/>
</g>
<!-- prose_148 -->
<g id="node149" class="node">
<title>prose_148</title>
<ellipse fill="none" stroke="#000000" cx="10865" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10865" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_126&#45;&gt;prose_148 -->
<g id="edge148" class="edge">
<title>section_126&#45;&gt;prose_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10939.723,-1985.6647C10925.2808,-1949.9041 10892.9265,-1869.7916 10875.9205,-1827.6832"/>
<polygon fill="#000000" stroke="#000000" points="10879.1337,-1826.2928 10872.1436,-1818.3311 10872.643,-1828.9141 10879.1337,-1826.2928"/>
</g>
<!-- prose_149 -->
<g id="node150" class="node">
<title>prose_149</title>
<ellipse fill="none" stroke="#000000" cx="10947" cy="-1800.6429" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10947" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_126&#45;&gt;prose_149 -->
<g id="edge149" class="edge">
<title>section_126&#45;&gt;prose_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10947,-1985.6647C10947,-1950.309 10947,-1871.6001 10947,-1829.128"/>
<polygon fill="#000000" stroke="#000000" points="10950.5001,-1828.9128 10947,-1818.9128 10943.5001,-1828.9129 10950.5001,-1828.9128"/>
</g>
<!-- codeblock_150 -->
<g id="node151" class="node">
<title>codeblock_150</title>
<ellipse fill="none" stroke="#000000" cx="11142" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11142" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 403&#45;417</text>
</g>
<!-- section_126&#45;&gt;codeblock_150 -->
<g id="edge150" class="edge">
<title>section_126&#45;&gt;codeblock_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10963.9638,-1986.0199C10998.6819,-1949.8703 11077.9298,-1867.3548 11117.9416,-1825.6932"/>
<polygon fill="#000000" stroke="#000000" points="11120.534,-1828.0468 11124.9365,-1818.4099 11115.4853,-1823.198 11120.534,-1828.0468"/>
</g>
<!-- codeblock_151 -->
<g id="node152" class="node">
<title>codeblock_151</title>
<ellipse fill="none" stroke="#000000" cx="11456" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11456" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 419&#45;426</text>
</g>
<!-- section_126&#45;&gt;codeblock_151 -->
<g id="edge151" class="edge">
<title>section_126&#45;&gt;codeblock_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10992.6354,-1989.3106C11050.3778,-1970.77 11152.5984,-1936.7608 11238,-1902.083 11300.1572,-1876.8438 11370.1856,-1843.3167 11413.7072,-1821.8539"/>
<polygon fill="#000000" stroke="#000000" points="11415.435,-1824.9041 11422.8457,-1817.3323 11412.3307,-1818.6301 11415.435,-1824.9041"/>
</g>
<!-- codeblock_152 -->
<g id="node153" class="node">
<title>codeblock_152</title>
<ellipse fill="none" stroke="#000000" cx="11770" cy="-1800.6429" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11770" y="-1796.4429" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 428&#45;430</text>
</g>
<!-- section_126&#45;&gt;codeblock_152 -->
<g id="edge152" class="edge">
<title>section_126&#45;&gt;codeblock_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11018.7677,-1997.9222C11133.5504,-1987.3197 11364.5835,-1960.2533 11552,-1902.083 11617.5565,-1881.7356 11688.8382,-1845.6754 11731.4431,-1822.4827"/>
<polygon fill="#000000" stroke="#000000" points="11733.2627,-1825.4766 11740.3448,-1817.5965 11729.8944,-1819.3402 11733.2627,-1825.4766"/>
</g>
<!-- leaf_129 -->
<g id="node130" class="node">
<title>leaf_129</title>
<polygon fill="none" stroke="#c0c0c0" points="9333,-902.7014 9279,-902.7014 9279,-866.7014 9333,-866.7014 9333,-902.7014"/>
</g>
<!-- raw_128&#45;&gt;leaf_129 -->
<g id="edge129" class="edge">
<title>raw_128&#45;&gt;leaf_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9306,-1782.3466C9306,-1668.1955 9306,-1054.0449 9306,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="9309.5001,-913.0412 9306,-903.0413 9302.5001,-913.0413 9309.5001,-913.0412"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9732,-902.7014 9576,-902.7014 9576,-866.7014 9732,-866.7014 9732,-902.7014"/>
<text text-anchor="middle" x="9654" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>header_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9815.107,-1782.6033C9794.1652,-1757.6844 9758.0019,-1710.4343 9741,-1663.2027 9640.6815,-1384.5156 9648.0865,-1016.553 9652.5315,-912.9252"/>
<polygon fill="#000000" stroke="#000000" points="9656.028,-913.0813 9652.9874,-902.9321 9649.0352,-912.7622 9656.028,-913.0813"/>
</g>
<!-- raw_136 -->
<g id="node137" class="node">
<title>raw_136</title>
<ellipse fill="none" stroke="#000000" cx="9777" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9777" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_132&#45;&gt;raw_136 -->
<g id="edge136" class="edge">
<title>prose_132&#45;&gt;raw_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9961.2365,-1782.6456C9956.846,-1760.082 9946.1587,-1721.6468 9922,-1699.2027 9884.6226,-1664.4782 9843.8351,-1703.8483 9813,-1663.2027 9721.5226,-1542.6213 9762.4412,-1038.2023 9774.2111,-912.9466"/>
<polygon fill="#000000" stroke="#000000" points="9777.6963,-913.267 9775.1619,-902.9798 9770.728,-912.6022 9777.6963,-913.267"/>
</g>
<!-- prespace_137 -->
<g id="node138" class="node">
<title>prespace_137</title>
<ellipse fill="none" stroke="#000000" cx="9868" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9868" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_132&#45;&gt;prespace_137 -->
<g id="edge137" class="edge">
<title>prose_132&#45;&gt;prespace_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9957.4525,-1782.7039C9948.2815,-1756.7373 9931.8549,-1706.9873 9924,-1663.2027 9872.0555,-1373.6561 9867.9391,-1015.3518 9867.8878,-913.1215"/>
<polygon fill="#000000" stroke="#000000" points="9871.3878,-912.9852 9867.8963,-902.9822 9864.3878,-912.9793 9871.3878,-912.9852"/>
</g>
<!-- literal_138 -->
<g id="node139" class="node">
<title>literal_138</title>
<ellipse fill="none" stroke="#000000" cx="9964" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9964" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_132&#45;&gt;literal_138 -->
<g id="edge138" class="edge">
<title>prose_132&#45;&gt;literal_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9964,-1782.3466C9964,-1668.1955 9964,-1054.0449 9964,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="9967.5001,-913.0412 9964,-903.0413 9960.5001,-913.0413 9967.5001,-913.0412"/>
</g>
<!-- raw_139 -->
<g id="node140" class="node">
<title>raw_139</title>
<ellipse fill="none" stroke="#000000" cx="10040" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="10040" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_132&#45;&gt;raw_139 -->
<g id="edge139" class="edge">
<title>prose_132&#45;&gt;raw_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9970.6998,-1782.7302C9980.056,-1756.7956 9996.7061,-1707.0842 10004,-1663.2027 10052.1613,-1373.4535 10044.5285,-1015.2902 10041.0957,-913.1075"/>
<polygon fill="#000000" stroke="#000000" points="10044.5887,-912.844 10040.74,-902.973 10037.593,-913.0896 10044.5887,-912.844"/>
</g>
<!-- raw_144 -->
<g id="node145" class="node">
<title>raw_144</title>
<ellipse fill="none" stroke="#000000" cx="10112" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="10112" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_133&#45;&gt;raw_144 -->
<g id="edge144" class="edge">
<title>prose_133&#45;&gt;raw_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10079.6592,-1782.3466C10083.7719,-1668.1955 10105.8988,-1054.0449 10110.9658,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="10114.4768,-913.1608 10111.3392,-903.0413 10107.4814,-912.9087 10114.4768,-913.1608"/>
</g>
<!-- leaf_146 -->
<g id="node147" class="node">
<title>leaf_146</title>
<polygon fill="none" stroke="#c0c0c0" points="10545.4016,-1072.3422 10156.5984,-1072.3422 10156.5984,-697.0606 10545.4016,-697.0606 10545.4016,-1072.3422"/>
<text text-anchor="middle" x="10351" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="10351" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local  = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="10351" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="10351" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="10351" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10351" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + ]</text>
<text text-anchor="middle" x="10351" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="10351" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="10351" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10351" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="10351" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="10351" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="10351" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="10351" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10351" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + </text>
<text text-anchor="middle" x="10351" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="10351" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not ( &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="10351" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="10351" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="10351" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="10351" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="10351" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="10351" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_134&#45;&gt;leaf_146 -->
<g id="edge146" class="edge">
<title>codeblock_134&#45;&gt;leaf_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10285.3384,-1782.3466C10291.6885,-1695.5356 10319.1913,-1319.5509 10336.5261,-1082.571"/>
<polygon fill="#000000" stroke="#000000" points="10340.0277,-1082.6754 10337.2667,-1072.4467 10333.0464,-1082.1647 10340.0277,-1082.6754"/>
</g>
<!-- leaf_140 -->
<g id="node141" class="node">
<title>leaf_140</title>
<polygon fill="none" stroke="#c0c0c0" points="9822.5,-63.0015 9351.5,-63.0015 9351.5,-7.1986 9822.5,-7.1986 9822.5,-63.0015"/>
<text text-anchor="middle" x="9587" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_136&#45;&gt;leaf_140 -->
<g id="edge140" class="edge">
<title>raw_136&#45;&gt;leaf_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9778.6198,-866.5791C9787.6141,-761.9643 9827.951,-235.4375 9741,-106.2001 9730.1513,-90.0754 9714.6613,-77.5392 9697.6442,-67.8129"/>
<polygon fill="#000000" stroke="#000000" points="9699.09,-64.6169 9688.6226,-62.9788 9695.7838,-70.7869 9699.09,-64.6169"/>
</g>
<!-- leaf_141 -->
<g id="node142" class="node">
<title>leaf_141</title>
<polygon fill="none" stroke="#c0c0c0" points="9895,-53.1 9841,-53.1 9841,-17.1 9895,-17.1 9895,-53.1"/>
</g>
<!-- prespace_137&#45;&gt;leaf_141 -->
<g id="edge141" class="edge">
<title>prespace_137&#45;&gt;leaf_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9868,-866.5632C9868,-758.2631 9868,-197.2221 9868,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9871.5001,-63.4293 9868,-53.4293 9864.5001,-63.4293 9871.5001,-63.4293"/>
</g>
<!-- leaf_142 -->
<g id="node143" class="node">
<title>leaf_142</title>
<polygon fill="none" stroke="#c0c0c0" points="10013,-53.1 9913,-53.1 9913,-17.1 10013,-17.1 10013,-53.1"/>
<text text-anchor="middle" x="9963" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_138&#45;&gt;leaf_142 -->
<g id="edge142" class="edge">
<title>literal_138&#45;&gt;leaf_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9963.9787,-866.5632C9963.8512,-758.2631 9963.1908,-197.2221 9963.0336,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9966.5334,-63.4251 9963.0216,-53.4293 9959.5334,-63.4334 9966.5334,-63.4251"/>
</g>
<!-- leaf_143 -->
<g id="node144" class="node">
<title>leaf_143</title>
<polygon fill="none" stroke="#c0c0c0" points="10271,-53.1 10031,-53.1 10031,-17.1 10271,-17.1 10271,-53.1"/>
<text text-anchor="middle" x="10151" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_139&#45;&gt;leaf_143 -->
<g id="edge143" class="edge">
<title>raw_139&#45;&gt;leaf_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10039.0351,-866.6202C10033.7903,-763.338 10011.2571,-247.6868 10076,-106.2001 10084.4407,-87.7541 10100.0549,-71.733 10114.8598,-59.5929"/>
<polygon fill="#000000" stroke="#000000" points="10117.2354,-62.178 10122.9507,-53.2569 10112.9196,-56.6668 10117.2354,-62.178"/>
</g>
<!-- leaf_145 -->
<g id="node146" class="node">
<title>leaf_145</title>
<polygon fill="none" stroke="#c0c0c0" points="10676.5,-55.0021 10289.5,-55.0021 10289.5,-15.198 10676.5,-15.198 10676.5,-55.0021"/>
<text text-anchor="middle" x="10483" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_144&#45;&gt;leaf_145 -->
<g id="edge145" class="edge">
<title>raw_144&#45;&gt;leaf_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10109.9963,-866.6056C10098.7087,-761.0146 10047.0758,-225.069 10148,-106.2001 10155.2821,-97.6232 10271.1095,-74.3251 10364.5532,-56.7169"/>
<polygon fill="#000000" stroke="#000000" points="10365.2023,-60.1563 10374.384,-54.8698 10363.9096,-53.2767 10365.2023,-60.1563"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="10805,-902.7014 10635,-902.7014 10635,-866.7014 10805,-866.7014 10805,-902.7014"/>
<text text-anchor="middle" x="10720" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_147&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>header_147&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10720,-1782.3466C10720,-1668.1955 10720,-1054.0449 10720,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="10723.5001,-913.0412 10720,-903.0413 10716.5001,-913.0413 10723.5001,-913.0412"/>
</g>
<!-- raw_154 -->
<g id="node155" class="node">
<title>raw_154</title>
<ellipse fill="none" stroke="#000000" cx="10857" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="10857" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_148&#45;&gt;raw_154 -->
<g id="edge154" class="edge">
<title>prose_148&#45;&gt;raw_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10864.8402,-1782.3466C10863.8432,-1668.1955 10858.4791,-1054.0449 10857.2507,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="10860.7475,-913.0103 10857.1602,-903.0413 10853.7478,-913.0715 10860.7475,-913.0103"/>
</g>
<!-- raw_156 -->
<g id="node157" class="node">
<title>raw_156</title>
<ellipse fill="none" stroke="#000000" cx="10929" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="10929" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_149&#45;&gt;raw_156 -->
<g id="edge156" class="edge">
<title>prose_149&#45;&gt;raw_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10946.6404,-1782.3466C10944.3972,-1668.1955 10932.3279,-1054.0449 10929.5641,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="10933.0563,-912.9705 10929.3604,-903.0413 10926.0577,-913.1081 10933.0563,-912.9705"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11424,-988.9019 10974,-988.9019 10974,-780.5009 11424,-780.5009 11424,-988.9019"/>
<text text-anchor="middle" x="11199" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="11199" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="11199" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="11199" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="11199" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11199" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="11199" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="11199" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="11199" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="11199" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="11199" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11199" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="11199" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_150&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>codeblock_150&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11143.1386,-1782.3466C11149.2318,-1684.4338 11178.2177,-1218.656 11191.8642,-999.3681"/>
<polygon fill="#000000" stroke="#000000" points="11195.3743,-999.3127 11192.5023,-989.1146 11188.3878,-998.8779 11195.3743,-999.3127"/>
</g>
<!-- leaf_159 -->
<g id="node160" class="node">
<title>leaf_159</title>
<polygon fill="none" stroke="#c0c0c0" points="11710,-935.1024 11442,-935.1024 11442,-834.3004 11710,-834.3004 11710,-935.1024"/>
<text text-anchor="middle" x="11576" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="11576" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="11576" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="11576" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="11576" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="11576" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_151&#45;&gt;leaf_159 -->
<g id="edge159" class="edge">
<title>codeblock_151&#45;&gt;leaf_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11458.397,-1782.3466C11472.4187,-1675.3219 11544.0228,-1128.7781 11568.0941,-945.0456"/>
<polygon fill="#000000" stroke="#000000" points="11571.5789,-945.3893 11569.4077,-935.0194 11564.6382,-944.48 11571.5789,-945.3893"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11814,-902.7014 11728,-902.7014 11728,-866.7014 11814,-866.7014 11814,-902.7014"/>
<text text-anchor="middle" x="11771" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_152&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>codeblock_152&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11770.02,-1782.3466C11770.1446,-1668.1955 11770.8151,-1054.0449 11770.9687,-913.4061"/>
<polygon fill="#000000" stroke="#000000" points="11774.469,-913.0451 11770.98,-903.0413 11767.469,-913.0374 11774.469,-913.0451"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="11019,-63.0015 10695,-63.0015 10695,-7.1986 11019,-7.1986 11019,-63.0015"/>
<text text-anchor="middle" x="10857" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_154&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>raw_154&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10857,-866.5632C10857,-760.6464 10857,-221.6953 10857,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="10860.5001,-73.0758 10857,-63.0758 10853.5001,-73.0759 10860.5001,-73.0758"/>
</g>
<!-- leaf_157 -->
<g id="node158" class="node">
<title>leaf_157</title>
<polygon fill="none" stroke="#c0c0c0" points="11235,-55.0021 11037,-55.0021 11037,-15.198 11235,-15.198 11235,-55.0021"/>
<text text-anchor="middle" x="11136" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_156&#45;&gt;leaf_157 -->
<g id="edge157" class="edge">
<title>raw_156&#45;&gt;leaf_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10927.3052,-866.5276C10917.8888,-761.6229 10875.5782,-233.7404 10965,-106.2001 10971.6773,-96.6764 11025.4439,-75.2015 11070.9306,-58.3295"/>
<polygon fill="#000000" stroke="#000000" points="11072.3192,-61.548 11080.4914,-54.8051 11069.898,-54.98 11072.3192,-61.548"/>
</g>
</g>
</svg>
