<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="16149pt" height="2669pt"
 viewBox="0.00 0.00 16149.00 2669.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2665.4041)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2665.4041 16145,-2665.4041 16145,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2643.4041" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1787" y="-2639.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 540</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2571.4041" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1787" y="-2567.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;435</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2625.2354C1787,-2617.535 1787,-2608.3784 1787,-2599.8207"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2599.8173 1787,-2589.8174 1783.5001,-2599.8174 1790.5001,-2599.8173"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1168" cy="-2499.4041" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1168" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1723.9539,-2566.2643C1626.4015,-2557.9857 1433.1005,-2540.284 1270,-2517.4041 1256.1003,-2515.4542 1241.1943,-2513.02 1227.1878,-2510.5781"/>
<polygon fill="#000000" stroke="#000000" points="1227.6322,-2507.1024 1217.1751,-2508.8055 1226.4118,-2513.9952 1227.6322,-2507.1024"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1311" cy="-2499.4041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1311" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1723.5646,-2566.5148C1641.3362,-2559.4202 1493.8081,-2544.1098 1370,-2517.4041 1363.0369,-2515.9021 1355.7091,-2513.9655 1348.6762,-2511.9215"/>
<polygon fill="#000000" stroke="#000000" points="1349.2453,-2508.4369 1338.6601,-2508.888 1347.2162,-2515.1364 1349.2453,-2508.4369"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1411" cy="-2499.4041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1411" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1725.926,-2564.6474C1659.8995,-2556.5665 1551.9065,-2541.087 1461,-2517.4041 1456.3882,-2516.2026 1451.6017,-2514.7531 1446.8989,-2513.2046"/>
<polygon fill="#000000" stroke="#000000" points="1448.0406,-2509.8961 1437.4458,-2509.9348 1445.7523,-2516.5116 1448.0406,-2509.8961"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1502" cy="-2499.4041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1502" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1731.5351,-2561.5274C1682.4645,-2552.1757 1609.2037,-2536.708 1547,-2517.4041 1543.8659,-2516.4315 1540.6423,-2515.3374 1537.4292,-2514.1815"/>
<polygon fill="#000000" stroke="#000000" points="1538.5133,-2510.8497 1527.9217,-2510.5879 1536.0383,-2517.3976 1538.5133,-2510.8497"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1588" cy="-2499.4041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1588" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1747.2077,-2557.0069C1711.592,-2544.1208 1659.78,-2525.3747 1625.0336,-2512.8032"/>
<polygon fill="#000000" stroke="#000000" points="1625.869,-2509.3835 1615.2748,-2509.2724 1623.4874,-2515.9659 1625.869,-2509.3835"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1787" cy="-2499.4041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1787" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;26</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2553.2354C1787,-2545.535 1787,-2536.3784 1787,-2527.8207"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2527.8173 1787,-2517.8174 1783.5001,-2527.8174 1790.5001,-2527.8173"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2066" cy="-2499.4041" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2066" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 28&#45;30</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1834.9618,-2559.0268C1881.7022,-2546.9648 1952.9893,-2528.5681 2004.0105,-2515.4014"/>
<polygon fill="#000000" stroke="#000000" points="2005.1231,-2518.729 2013.9312,-2512.8412 2003.3739,-2511.9511 2005.1231,-2518.729"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2499.4041" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 33&#45;232</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1849.5748,-2565.8143C1995.3393,-2552.7931 2357.1653,-2520.4712 2516.0774,-2506.2756"/>
<polygon fill="#000000" stroke="#000000" points="2516.5979,-2509.7431 2526.2468,-2505.3672 2515.975,-2502.7709 2516.5979,-2509.7431"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="7176" cy="-2499.4041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7176" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 283&#45;318</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.7108,-2570.5262C2417.6036,-2562.9789 6449.4215,-2509.1116 7090.2568,-2500.5497"/>
<polygon fill="#000000" stroke="#000000" points="7090.3884,-2504.0483 7100.3407,-2500.4149 7090.2949,-2497.0489 7090.3884,-2504.0483"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="11299" cy="-2499.4041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11299" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 379&#45;435</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.8204,-2570.9059C2643.8582,-2564.9182 10314.7074,-2506.8546 11213.2242,-2500.0534"/>
<polygon fill="#000000" stroke="#000000" points="11213.5086,-2503.5514 11223.4817,-2499.9757 11213.4555,-2496.5516 11213.5086,-2503.5514"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="13144" cy="-2499.4041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13144" y="-2495.2041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 436&#45;506</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.6987,-2571.1503C2474.9311,-2568.7226 7395.1411,-2549.0053 11383,-2517.4041 12026.8211,-2512.3022 12803.0164,-2503.4142 13058.1724,-2500.421"/>
<polygon fill="#000000" stroke="#000000" points="13058.5226,-2503.9173 13068.4808,-2500.3 13058.4403,-2496.9177 13058.5226,-2503.9173"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1209.5,-2390.1039 1116.5,-2390.1039 1116.5,-2354.1039 1209.5,-2354.1039 1209.5,-2390.1039"/>
<text text-anchor="middle" x="1163" y="-2368.604" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.2836,-2481.1651C1166.4556,-2460.0848 1165.083,-2425.1384 1164.1151,-2400.4945"/>
<polygon fill="#000000" stroke="#000000" points="1167.6049,-2400.164 1163.715,-2390.3091 1160.6103,-2400.4388 1167.6049,-2400.164"/>
</g>
<!-- raw_14 -->
<g id="node15" class="node">
<title>raw_14</title>
<ellipse fill="none" stroke="#000000" cx="1255" cy="-2372.1039" rx="27" ry="18"/>
<text text-anchor="middle" x="1255" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_14 -->
<g id="edge14" class="edge">
<title>prose_3&#45;&gt;raw_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1303.2134,-2481.7035C1293.7683,-2460.2326 1277.7523,-2423.8249 1266.7911,-2398.9077"/>
<polygon fill="#000000" stroke="#000000" points="1269.9509,-2397.3983 1262.7204,-2389.6542 1263.5434,-2400.217 1269.9509,-2397.3983"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1327" cy="-2372.1039" rx="27" ry="18"/>
<text text-anchor="middle" x="1327" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_4&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1394.6238,-2483.3427C1384.7067,-2473.075 1372.2336,-2459.1475 1363,-2445.4041 1353.2354,-2430.8703 1344.5138,-2413.3001 1338.1014,-2399.0057"/>
<polygon fill="#000000" stroke="#000000" points="1341.253,-2397.4768 1334.0465,-2389.7104 1334.837,-2400.2757 1341.253,-2397.4768"/>
</g>
<!-- raw_18 -->
<g id="node19" class="node">
<title>raw_18</title>
<ellipse fill="none" stroke="#000000" cx="1399" cy="-2372.1039" rx="27" ry="18"/>
<text text-anchor="middle" x="1399" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_18 -->
<g id="edge18" class="edge">
<title>prose_5&#45;&gt;raw_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1480.6241,-2485.8252C1466.3385,-2475.9402 1447.8749,-2461.5064 1435,-2445.4041 1423.9936,-2431.6387 1415.1876,-2413.9577 1409.0404,-2399.4099"/>
<polygon fill="#000000" stroke="#000000" points="1412.2015,-2397.8903 1405.215,-2389.9255 1405.7097,-2400.5087 1412.2015,-2397.8903"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1471" cy="-2372.1039" rx="27" ry="18"/>
<text text-anchor="middle" x="1471" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_6&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1563.5288,-2487.5532C1546.0105,-2478.093 1522.8187,-2463.4524 1507,-2445.4041 1495.3072,-2432.0632 1486.4443,-2414.2525 1480.4383,-2399.5284"/>
<polygon fill="#000000" stroke="#000000" points="1483.5981,-2397.9942 1476.7371,-2389.9209 1477.066,-2400.5106 1483.5981,-2397.9942"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2057.5,-2445.2048 1516.5,-2445.2048 1516.5,-2299.0031 2057.5,-2299.0031 2057.5,-2445.2048"/>
<text text-anchor="middle" x="1787" y="-2430.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1787" y="-2414.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1787" y="-2399.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1787" y="-2384.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1787" y="-2368.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1787" y="-2353.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1787" y="-2337.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints, &quot;must have string.codepoints&quot;)</text>
<text text-anchor="middle" x="1787" y="-2322.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1787" y="-2307.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_7&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1787,-2481.1651C1787,-2473.9196 1787,-2465.0359 1787,-2455.4955"/>
<polygon fill="#000000" stroke="#000000" points="1790.5001,-2455.3568 1787,-2445.3568 1783.5001,-2455.3568 1790.5001,-2455.3568"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2266.5,-2390.1039 2075.5,-2390.1039 2075.5,-2354.1039 2266.5,-2354.1039 2266.5,-2390.1039"/>
<text text-anchor="middle" x="2171" y="-2368.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_8&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2080.5998,-2481.7035C2098.4204,-2460.0981 2128.7161,-2423.3682 2149.2768,-2398.4408"/>
<polygon fill="#000000" stroke="#000000" points="2152.1812,-2400.42 2155.8442,-2390.4785 2146.7811,-2395.9659 2152.1812,-2400.42"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="2353" cy="-2372.1039" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2353" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2539.0747,-2487.6867C2506.3065,-2479.0844 2464.4768,-2465.3823 2431,-2445.4041 2409.6659,-2432.6723 2389.3413,-2413.2468 2374.7904,-2397.5916"/>
<polygon fill="#000000" stroke="#000000" points="2377.0415,-2394.8635 2367.7328,-2389.804 2371.8546,-2399.5642 2377.0415,-2394.8635"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2472" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2472" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2561.9542,-2483.1078C2545.9641,-2473.6342 2526.9511,-2460.5756 2513,-2445.4041 2500.5318,-2431.8452 2490.3849,-2413.8186 2483.3046,-2399.0355"/>
<polygon fill="#000000" stroke="#000000" points="2486.4508,-2397.4997 2479.101,-2389.8687 2480.0879,-2400.4175 2486.4508,-2397.4997"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2372.1039" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2593" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 37&#45;142</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2481.1651C2593,-2460.0848 2593,-2425.1384 2593,-2400.4945"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2400.3091 2593,-2390.3091 2589.5001,-2400.3092 2596.5001,-2400.3091"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 143&#45;221</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2630.8031,-2484.1752C2688.3015,-2461.012 2797.7005,-2416.9408 2860.823,-2391.512"/>
<polygon fill="#000000" stroke="#000000" points="2862.1972,-2394.7318 2870.165,-2387.7486 2859.5815,-2388.2388 2862.1972,-2394.7318"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3963" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 222&#45;232</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2659.5409,-2493.2211C2887.2062,-2472.0665 3634.5693,-2402.6217 3882.3677,-2379.5963"/>
<polygon fill="#000000" stroke="#000000" points="3882.7482,-2383.0761 3892.3815,-2378.6658 3882.1005,-2376.1061 3882.7482,-2383.0761"/>
</g>
<!-- section_29 -->
<g id="node30" class="node">
<title>section_29</title>
<ellipse fill="none" stroke="#000000" cx="4887" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4887" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 233&#45;282</text>
</g>
<!-- section_9&#45;&gt;section_29 -->
<g id="edge29" class="edge">
<title>section_9&#45;&gt;section_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2663.4216,-2498.0349C2873.7474,-2493.6776 3515.6614,-2478.4329 4047,-2445.4041 4327.1133,-2427.9918 4658.7918,-2395.5487 4807.6964,-2380.354"/>
<polygon fill="#000000" stroke="#000000" points="4808.0762,-2383.8335 4817.6682,-2379.3343 4807.364,-2376.8698 4808.0762,-2383.8335"/>
</g>
<!-- header_88 -->
<g id="node89" class="node">
<title>header_88</title>
<ellipse fill="none" stroke="#000000" cx="6977" cy="-2372.1039" rx="107.339" ry="18"/>
<text text-anchor="middle" x="6977" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;header_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7149.5743,-2482.4996C7114.4839,-2460.0523 7052.3693,-2420.3176 7013.0123,-2395.141"/>
<polygon fill="#000000" stroke="#000000" points="7014.8045,-2392.1326 7004.4946,-2389.6922 7011.0324,-2398.0294 7014.8045,-2392.1326"/>
</g>
<!-- prose_89 -->
<g id="node90" class="node">
<title>prose_89</title>
<ellipse fill="none" stroke="#000000" cx="7135" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7135" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;prose_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7170.2127,-2481.4351C7163.3448,-2460.1113 7151.8207,-2424.3302 7143.8355,-2399.5371"/>
<polygon fill="#000000" stroke="#000000" points="7147.1551,-2398.427 7140.7579,-2389.9815 7140.4921,-2400.573 7147.1551,-2398.427"/>
</g>
<!-- prose_90 -->
<g id="node91" class="node">
<title>prose_90</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7217" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_90 -->
<g id="edge90" class="edge">
<title>section_10&#45;&gt;prose_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7181.7873,-2481.4351C7188.6552,-2460.1113 7200.1793,-2424.3302 7208.1645,-2399.5371"/>
<polygon fill="#000000" stroke="#000000" points="7211.5079,-2400.573 7211.2421,-2389.9815 7204.8449,-2398.427 7211.5079,-2400.573"/>
</g>
<!-- section_91 -->
<g id="node92" class="node">
<title>section_91</title>
<ellipse fill="none" stroke="#000000" cx="7808" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7808" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 293&#45;318</text>
</g>
<!-- section_10&#45;&gt;section_91 -->
<g id="edge91" class="edge">
<title>section_10&#45;&gt;section_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7233.7612,-2487.7696C7350.8035,-2464.1944 7615.4119,-2410.8959 7740.3108,-2385.7382"/>
<polygon fill="#000000" stroke="#000000" points="7741.033,-2389.1631 7750.1449,-2383.7574 7739.6507,-2382.3009 7741.033,-2389.1631"/>
</g>
<!-- section_92 -->
<g id="node93" class="node">
<title>section_92</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9340" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 319&#45;378</text>
</g>
<!-- section_10&#45;&gt;section_92 -->
<g id="edge92" class="edge">
<title>section_10&#45;&gt;section_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7249.5516,-2495.0773C7577.8989,-2475.7619 8908.7944,-2397.4702 9256.5402,-2377.0136"/>
<polygon fill="#000000" stroke="#000000" points="9256.7626,-2380.5066 9266.5398,-2376.4253 9256.3514,-2373.5187 9256.7626,-2380.5066"/>
</g>
<!-- header_140 -->
<g id="node141" class="node">
<title>header_140</title>
<ellipse fill="none" stroke="#000000" cx="10366" cy="-2372.1039" rx="107.339" ry="18"/>
<text text-anchor="middle" x="10366" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_11&#45;&gt;header_140 -->
<g id="edge140" class="edge">
<title>section_11&#45;&gt;header_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11224.2288,-2496.4823C11063.9152,-2489.7938 10691.6577,-2471.8793 10568,-2445.4041 10512.9505,-2433.6179 10452.6121,-2410.2575 10412.3479,-2393.0632"/>
<polygon fill="#000000" stroke="#000000" points="10413.6325,-2389.8056 10403.0642,-2389.0559 10410.8583,-2396.2325 10413.6325,-2389.8056"/>
</g>
<!-- prose_141 -->
<g id="node142" class="node">
<title>prose_141</title>
<ellipse fill="none" stroke="#000000" cx="10609" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="10609" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_141 -->
<g id="edge141" class="edge">
<title>section_11&#45;&gt;prose_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11239.2742,-2488.3851C11101.8283,-2463.0273 10766.0135,-2401.0718 10649.5601,-2379.587"/>
<polygon fill="#000000" stroke="#000000" points="10650.0961,-2376.1269 10639.627,-2377.7544 10648.826,-2383.0107 10650.0961,-2376.1269"/>
</g>
<!-- prose_142 -->
<g id="node143" class="node">
<title>prose_142</title>
<ellipse fill="none" stroke="#000000" cx="11184" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11184" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_142 -->
<g id="edge142" class="edge">
<title>section_11&#45;&gt;prose_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11283.0097,-2481.7035C11262.8501,-2459.3877 11228.1141,-2420.9364 11205.6063,-2396.0212"/>
<polygon fill="#000000" stroke="#000000" points="11208.0628,-2393.5193 11198.7622,-2388.445 11202.8685,-2398.2118 11208.0628,-2393.5193"/>
</g>
<!-- prose_143 -->
<g id="node144" class="node">
<title>prose_143</title>
<ellipse fill="none" stroke="#000000" cx="11299" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11299" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_143 -->
<g id="edge143" class="edge">
<title>section_11&#45;&gt;prose_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11299,-2481.1651C11299,-2460.0848 11299,-2425.1384 11299,-2400.4945"/>
<polygon fill="#000000" stroke="#000000" points="11302.5001,-2400.3091 11299,-2390.3091 11295.5001,-2400.3092 11302.5001,-2400.3091"/>
</g>
<!-- prose_144 -->
<g id="node145" class="node">
<title>prose_144</title>
<ellipse fill="none" stroke="#000000" cx="11381" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11381" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_144 -->
<g id="edge144" class="edge">
<title>section_11&#45;&gt;prose_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11313.6954,-2481.3708C11321.8166,-2471.0879 11331.8758,-2457.8126 11340,-2445.4041 11349.7992,-2430.4374 11359.6227,-2412.9807 11367.1966,-2398.8583"/>
<polygon fill="#000000" stroke="#000000" points="11370.4671,-2400.161 11372.0527,-2389.6854 11364.2806,-2396.8858 11370.4671,-2400.161"/>
</g>
<!-- prose_145 -->
<g id="node146" class="node">
<title>prose_145</title>
<ellipse fill="none" stroke="#000000" cx="11463" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11463" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_145 -->
<g id="edge145" class="edge">
<title>section_11&#45;&gt;prose_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11348.7162,-2485.8052C11372.9603,-2477.2587 11401.2815,-2464.2176 11422,-2445.4041 11435.8139,-2432.8603 11446.0623,-2414.5411 11452.858,-2399.355"/>
<polygon fill="#000000" stroke="#000000" points="11456.1755,-2400.4949 11456.8279,-2389.9201 11449.7234,-2397.78 11456.1755,-2400.4949"/>
</g>
<!-- prose_146 -->
<g id="node147" class="node">
<title>prose_146</title>
<ellipse fill="none" stroke="#000000" cx="11545" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="11545" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_146 -->
<g id="edge146" class="edge">
<title>section_11&#45;&gt;prose_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11360.0299,-2488.7839C11411.9635,-2478.7769 11481.598,-2462.7612 11504,-2445.4041 11518.9392,-2433.8292 11529.2607,-2415.186 11535.811,-2399.5986"/>
<polygon fill="#000000" stroke="#000000" points="11539.2195,-2400.4904 11539.5815,-2389.9017 11532.6953,-2397.9535 11539.2195,-2400.4904"/>
</g>
<!-- codeblock_147 -->
<g id="node148" class="node">
<title>codeblock_147</title>
<ellipse fill="none" stroke="#000000" cx="11776" cy="-2372.1039" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="11776" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 396&#45;433</text>
</g>
<!-- section_11&#45;&gt;codeblock_147 -->
<g id="edge147" class="edge">
<title>section_11&#45;&gt;codeblock_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11364.7583,-2490.5191C11423.4453,-2481.7682 11511.3868,-2466.6244 11586,-2445.4041 11636.474,-2431.0491 11692.2871,-2408.7005 11730.2821,-2392.4525"/>
<polygon fill="#000000" stroke="#000000" points="11731.7452,-2395.6332 11739.5439,-2388.4617 11728.9751,-2389.2046 11731.7452,-2395.6332"/>
</g>
<!-- header_168 -->
<g id="node169" class="node">
<title>header_168</title>
<ellipse fill="none" stroke="#000000" cx="12810" cy="-2372.1039" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="12810" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_12&#45;&gt;header_168 -->
<g id="edge168" class="edge">
<title>section_12&#45;&gt;header_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13086.3633,-2487.6567C13045.7587,-2478.467 12990.5532,-2464.1131 12944,-2445.4041 12909.2251,-2431.4286 12872.004,-2410.5422 12845.6375,-2394.6357"/>
<polygon fill="#000000" stroke="#000000" points="12847.1456,-2391.4559 12836.7858,-2389.2366 12843.5004,-2397.432 12847.1456,-2391.4559"/>
</g>
<!-- prose_169 -->
<g id="node170" class="node">
<title>prose_169</title>
<ellipse fill="none" stroke="#000000" cx="12985" cy="-2372.1039" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="12985" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_169 -->
<g id="edge169" class="edge">
<title>section_12&#45;&gt;prose_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13108.8353,-2483.3584C13089.8081,-2473.7864 13066.4867,-2460.5566 13048,-2445.4041 13030.9677,-2431.4436 13014.8411,-2412.5321 13003.1681,-2397.4151"/>
<polygon fill="#000000" stroke="#000000" points="13005.6522,-2394.8961 12996.8367,-2389.0191 13000.0632,-2399.1107 13005.6522,-2394.8961"/>
</g>
<!-- codeblock_170 -->
<g id="node171" class="node">
<title>codeblock_170</title>
<ellipse fill="none" stroke="#000000" cx="13144" cy="-2372.1039" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13144" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 438&#45;451</text>
</g>
<!-- section_12&#45;&gt;codeblock_170 -->
<g id="edge170" class="edge">
<title>section_12&#45;&gt;codeblock_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13144,-2481.1651C13144,-2460.0848 13144,-2425.1384 13144,-2400.4945"/>
<polygon fill="#000000" stroke="#000000" points="13147.5001,-2400.3091 13144,-2390.3091 13140.5001,-2400.3092 13147.5001,-2400.3091"/>
</g>
<!-- section_171 -->
<g id="node172" class="node">
<title>section_171</title>
<ellipse fill="none" stroke="#000000" cx="13567" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13567" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 454&#45;487</text>
</g>
<!-- section_12&#45;&gt;section_171 -->
<g id="edge171" class="edge">
<title>section_12&#45;&gt;section_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13190.8846,-2485.2944C13269.0972,-2461.7566 13425.9093,-2414.5646 13510.2389,-2389.186"/>
<polygon fill="#000000" stroke="#000000" points="13511.3383,-2392.5103 13519.9054,-2386.2769 13509.321,-2385.8072 13511.3383,-2392.5103"/>
</g>
<!-- section_172 -->
<g id="node173" class="node">
<title>section_172</title>
<ellipse fill="none" stroke="#000000" cx="14281" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14281" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 488&#45;506</text>
</g>
<!-- section_12&#45;&gt;section_172 -->
<g id="edge172" class="edge">
<title>section_12&#45;&gt;section_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13213.3193,-2492.2365C13310.9781,-2482.0895 13494.6258,-2462.8283 13651,-2445.4041 13850.1147,-2423.2174 14084.4325,-2395.5416 14203.3332,-2381.3865"/>
<polygon fill="#000000" stroke="#000000" points="14203.9158,-2384.8419 14213.4316,-2380.1838 14203.0879,-2377.8911 14203.9158,-2384.8419"/>
</g>
<!-- section_173 -->
<g id="node174" class="node">
<title>section_173</title>
<ellipse fill="none" stroke="#000000" cx="15287" cy="-2372.1039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15287" y="-2367.9039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 507&#45;540</text>
</g>
<!-- section_12&#45;&gt;section_173 -->
<g id="edge173" class="edge">
<title>section_12&#45;&gt;section_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13219.0766,-2497.0023C13410.3229,-2490.6846 13931.3769,-2472.2213 14365,-2445.4041 14676.2977,-2426.152 15045.9839,-2393.9173 15206.2501,-2379.4835"/>
<polygon fill="#000000" stroke="#000000" points="15206.8558,-2382.9432 15216.5009,-2378.5589 15206.2269,-2375.9715 15206.8558,-2382.9432"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2016.9044 0,-2016.9044 0,-1945.1021 324,-1945.1021 324,-2016.9044"/>
<text text-anchor="middle" x="162" y="-1953.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1251.3835,-2354.1199C1246.8363,-2336.6964 1237.1775,-2311.1501 1218,-2298.8038 1135.2508,-2245.5308 417.7623,-2312.8118 333,-2262.8038 244.16,-2210.39 195.6507,-2092.0837 174.721,-2026.6571"/>
<polygon fill="#000000" stroke="#000000" points="178.0326,-2025.5198 171.7141,-2017.0153 171.3501,-2027.6039 178.0326,-2025.5198"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2008.3037 342.5,-2008.3037 342.5,-1953.7029 897.5,-1953.7029 897.5,-2008.3037"/>
<text text-anchor="middle" x="620" y="-1977.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1961.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1323.4033,-2354.0211C1318.949,-2336.7802 1309.5557,-2311.6042 1291,-2298.8038 1220.4505,-2250.1361 984.7304,-2298.9115 907,-2262.8038 786.9362,-2207.0312 687.3024,-2079.3173 643.6856,-2016.8028"/>
<polygon fill="#000000" stroke="#000000" points="646.4671,-2014.6712 637.9066,-2008.4288 640.7058,-2018.6471 646.4671,-2014.6712"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2008.3037 916,-2008.3037 916,-1953.7029 1464,-1953.7029 1464,-2008.3037"/>
<text text-anchor="middle" x="1190" y="-1977.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1961.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>raw_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1390.7648,-2354.8217C1383.5958,-2339.9031 1372.8387,-2317.8173 1363,-2298.8038 1309.6992,-2195.799 1243.2994,-2076.075 1210.4162,-2017.3205"/>
<polygon fill="#000000" stroke="#000000" points="1213.3745,-2015.4398 1205.4336,-2008.4261 1207.2675,-2018.861 1213.3745,-2015.4398"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2016.3036 1482,-2016.3036 1482,-1945.7029 2030,-1945.7029 2030,-2016.3036"/>
<text text-anchor="middle" x="1756" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-1969.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1478.3241,-2354.6778C1484.9994,-2339.4747 1495.5426,-2317.0557 1507,-2298.8038 1572.6223,-2194.2662 1665.7827,-2083.1739 1717.5463,-2024.0074"/>
<polygon fill="#000000" stroke="#000000" points="1720.295,-2026.1815 1724.262,-2016.3573 1715.0344,-2021.5635 1720.295,-2026.1815"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-1999.0033 2048,-1999.0033 2048,-1963.0033 2162,-1963.0033 2162,-1999.0033"/>
<text text-anchor="middle" x="2105" y="-1977.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_24&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>header_24&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2338.2285,-2354.4684C2323.647,-2338.0479 2299.9666,-2313.8986 2275,-2298.8038 2233.1425,-2273.4968 2203.7572,-2299.1282 2171,-2262.8038 2105.5385,-2190.2137 2101.4534,-2065.2244 2103.2658,-2009.3865"/>
<polygon fill="#000000" stroke="#000000" points="2106.7718,-2009.3138 2103.6905,-1999.177 2099.7778,-2009.0228 2106.7718,-2009.3138"/>
</g>
<!-- raw_31 -->
<g id="node32" class="node">
<title>raw_31</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_31 -->
<g id="edge31" class="edge">
<title>prose_25&#45;&gt;raw_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2466.7888,-2354.0289C2460.922,-2337.0457 2449.6831,-2312.2835 2431,-2298.8038 2362.0085,-2249.0272 2301.2585,-2324.7996 2243,-2262.8038 2177.0011,-2192.571 2190.782,-2065.3694 2201.0032,-2009.0883"/>
<polygon fill="#000000" stroke="#000000" points="2204.4679,-2009.6046 2202.9128,-1999.1245 2197.593,-2008.287 2204.4679,-2009.6046"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-1981.0033" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_26&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2577.3574,-2354.3618C2562.2343,-2338.0958 2537.995,-2314.2571 2513,-2298.8038 2474.9484,-2275.2782 2449.6207,-2295.4191 2419,-2262.8038 2350.7561,-2190.1145 2335.4138,-2065.1767 2331.9806,-2009.3694"/>
<polygon fill="#000000" stroke="#000000" points="2335.4643,-2008.9666 2331.4406,-1999.1656 2328.4741,-2009.3366 2335.4643,-2008.9666"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_26&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2572.9922,-2354.5844C2551.6434,-2334.6431 2518.6543,-2299.9854 2502,-2262.8038 2463.3015,-2176.4071 2458.991,-2061.6897 2459.2804,-2009.2852"/>
<polygon fill="#000000" stroke="#000000" points="2462.7824,-2009.1218 2459.4012,-1999.081 2455.7829,-2009.0388 2462.7824,-2009.1218"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-1981.0033" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 39&#45;140</text>
</g>
<!-- section_26&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_26&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2593,-2354.0247C2593,-2291.7381 2593,-2085.7201 2593,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="2596.5001,-2009.3418 2593,-1999.3418 2589.5001,-2009.3418 2596.5001,-2009.3418"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-1981.0033" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_27&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_27&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.9392,-2354.0125C2893.5705,-2332.4063 2879.3323,-2295.1257 2868,-2262.8038 2835.5819,-2170.3413 2800.4992,-2059.5497 2784.6446,-2008.8294"/>
<polygon fill="#000000" stroke="#000000" points="2787.9684,-2007.7311 2781.6487,-1999.2275 2781.2861,-2009.8161 2787.9684,-2007.7311"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_27&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2354.0247C2909,-2291.7381 2909,-2085.7201 2909,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-2009.3418 2909,-1999.3418 2905.5001,-2009.3418 2912.5001,-2009.3418"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_27&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2917.1977,-2353.9268C2926.5135,-2332.5462 2941.5211,-2295.7795 2950,-2262.8038 2973.3987,-2171.8031 2984.6525,-2060.6034 2988.8978,-2009.3522"/>
<polygon fill="#000000" stroke="#000000" points="2992.4116,-2009.3179 2989.7211,-1999.0704 2985.434,-2008.7591 2992.4116,-2009.3179"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3212" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3212" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 150&#45;219</text>
</g>
<!-- section_27&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>section_27&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2932.0345,-2354.817C2958.1265,-2334.551 3001.0347,-2299.0958 3032,-2262.8038 3104.8959,-2177.3684 3170.4117,-2060.1289 3198.0722,-2007.9446"/>
<polygon fill="#000000" stroke="#000000" points="3201.23,-2009.4594 3202.7897,-1998.98 3195.0354,-2006.1995 3201.23,-2009.4594"/>
</g>
<!-- header_50 -->
<g id="node51" class="node">
<title>header_50</title>
<ellipse fill="none" stroke="#000000" cx="3722" cy="-1981.0033" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3722" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_28&#45;&gt;header_50 -->
<g id="edge50" class="edge">
<title>section_28&#45;&gt;header_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3952.0185,-2354.2829C3913.6052,-2291.9448 3785.0924,-2083.3912 3738.7997,-2008.2662"/>
<polygon fill="#000000" stroke="#000000" points="3741.5504,-2006.0583 3733.3245,-1999.381 3735.5909,-2009.7306 3741.5504,-2006.0583"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="3963" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3963" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_28&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963,-2354.0247C3963,-2291.7381 3963,-2085.7201 3963,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="3966.5001,-2009.3418 3963,-1999.3418 3959.5001,-2009.3418 3966.5001,-2009.3418"/>
</g>
<!-- prose_52 -->
<g id="node53" class="node">
<title>prose_52</title>
<ellipse fill="none" stroke="#000000" cx="4045" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4045" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_52 -->
<g id="edge52" class="edge">
<title>section_28&#45;&gt;prose_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3971.1977,-2353.9268C3980.5135,-2332.5462 3995.5211,-2295.7795 4004,-2262.8038 4027.3987,-2171.8031 4038.6525,-2060.6034 4042.8978,-2009.3522"/>
<polygon fill="#000000" stroke="#000000" points="4046.4116,-2009.3179 4043.7211,-1999.0704 4039.434,-2008.7591 4046.4116,-2009.3179"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="4183" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4183" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 228&#45;230</text>
</g>
<!-- section_28&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>section_28&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3988.9186,-2355.1822C4016.5813,-2335.887 4059.9367,-2301.9067 4086,-2262.8038 4141.1707,-2180.0309 4168.183,-2062.6482 4178.2145,-2009.3228"/>
<polygon fill="#000000" stroke="#000000" points="4181.7013,-2009.7112 4180.0497,-1999.2459 4174.8146,-2008.4569 4181.7013,-2009.7112"/>
</g>
<!-- header_60 -->
<g id="node61" class="node">
<title>header_60</title>
<ellipse fill="none" stroke="#000000" cx="4641" cy="-1981.0033" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4641" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_29&#45;&gt;header_60 -->
<g id="edge60" class="edge">
<title>section_29&#45;&gt;header_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4861.9202,-2354.9494C4834.7832,-2335.3276 4791.6908,-2300.9482 4764,-2262.8038 4703.5835,-2179.5795 4664.4402,-2062.0201 4648.7683,-2008.9385"/>
<polygon fill="#000000" stroke="#000000" points="4652.0942,-2007.8407 4645.9475,-1999.2112 4645.3712,-2009.7903 4652.0942,-2007.8407"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4805" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4805" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_29&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4878.8023,-2353.9268C4869.4865,-2332.5462 4854.4789,-2295.7795 4846,-2262.8038 4822.6013,-2171.8031 4811.3475,-2060.6034 4807.1022,-2009.3522"/>
<polygon fill="#000000" stroke="#000000" points="4810.566,-2008.7591 4806.2789,-1999.0704 4803.5884,-2009.3179 4810.566,-2008.7591"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="4887" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4887" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_29&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4887,-2354.0247C4887,-2291.7381 4887,-2085.7201 4887,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="4890.5001,-2009.3418 4887,-1999.3418 4883.5001,-2009.3418 4890.5001,-2009.3418"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5466" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5466" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_29&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4912.2512,-2355.0474C5006.377,-2291.4676 5336.5408,-2068.4499 5436.8665,-2000.6822"/>
<polygon fill="#000000" stroke="#000000" points="5438.9819,-2003.477 5445.3095,-1994.9792 5435.0637,-1997.6764 5438.9819,-2003.477"/>
</g>
<!-- prose_64 -->
<g id="node65" class="node">
<title>prose_64</title>
<ellipse fill="none" stroke="#000000" cx="5674" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5674" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_29&#45;&gt;prose_64 -->
<g id="edge64" class="edge">
<title>section_29&#45;&gt;prose_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4959.5175,-2366.8818C5103.4856,-2355.3158 5419.0778,-2323.623 5507,-2262.8038 5599.242,-2198.9965 5648.4753,-2066.2477 5666.2202,-2008.6551"/>
<polygon fill="#000000" stroke="#000000" points="5669.6527,-2009.3934 5669.1704,-1998.8095 5662.9472,-2007.3841 5669.6527,-2009.3934"/>
</g>
<!-- codeblock_65 -->
<g id="node66" class="node">
<title>codeblock_65</title>
<ellipse fill="none" stroke="#000000" cx="5975" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5975" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 248&#45;280</text>
</g>
<!-- section_29&#45;&gt;codeblock_65 -->
<g id="edge65" class="edge">
<title>section_29&#45;&gt;codeblock_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4961.3172,-2368.7353C5139.1636,-2359.6583 5584.1918,-2330.6432 5715,-2262.8038 5832.5111,-2201.8606 5924.3461,-2065.5545 5959.4867,-2007.7441"/>
<polygon fill="#000000" stroke="#000000" points="5962.4913,-2009.5391 5964.635,-1999.1634 5956.4888,-2005.9376 5962.4913,-2009.5391"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="1882,-912.6029 1544,-912.6029 1544,-856.7999 1882,-856.7999 1882,-912.6029"/>
<text text-anchor="middle" x="1713" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_31&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>raw_31&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.249,-1963.0116C2221.8533,-1913.1257 2243.6859,-1771.9474 2171,-1699.2027 2082.316,-1610.4471 1983.913,-1747.5212 1891,-1663.2027 1670.0544,-1462.6948 1694.7899,-1049.1619 1708.2864,-922.4418"/>
<polygon fill="#000000" stroke="#000000" points="1711.7714,-922.77 1709.3923,-912.4457 1704.8138,-922.0002 1711.7714,-922.77"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2042,-902.7014 1900,-902.7014 1900,-866.7014 2042,-866.7014 2042,-902.7014"/>
<text text-anchor="middle" x="1971" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_33&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_33&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.284,-1962.8318C2331.0107,-1912.4796 2322.8648,-1770.2063 2243,-1699.2027 2178.1148,-1641.5167 2109.7931,-1727.0866 2051,-1663.2027 1848.0014,-1442.6272 1935.4878,-1024.0011 1963.5354,-912.542"/>
<polygon fill="#000000" stroke="#000000" points="1966.9573,-913.2877 1966.0523,-902.7315 1960.1769,-911.548 1966.9573,-913.2877"/>
</g>
<!-- raw_37 -->
<g id="node38" class="node">
<title>raw_37</title>
<ellipse fill="none" stroke="#000000" cx="2087" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2087" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_34&#45;&gt;raw_37 -->
<g id="edge37" class="edge">
<title>prose_34&#45;&gt;raw_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2463.9051,-1962.9377C2473.5605,-1912.86 2492.7382,-1771.2316 2419,-1699.2027 2324.1983,-1606.5987 2213.139,-1760.3512 2123,-1663.2027 2019.9424,-1552.1311 2069.6575,-1039.5187 2083.7102,-912.9927"/>
<polygon fill="#000000" stroke="#000000" points="2087.2019,-913.262 2084.8434,-902.933 2080.2459,-912.4783 2087.2019,-913.262"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2680,-1663.2041 2132,-1663.2041 2132,-106.1988 2680,-106.1988 2680,-1663.2041"/>
<text text-anchor="middle" x="2406" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 2000</text>
<text text-anchor="middle" x="2406" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2406" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2406" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2406" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2406" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2406" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2406" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2406" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2406" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2406" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2406" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2406" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2406" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2406" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2406" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2406" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2406" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2406" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2406" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2406" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2406" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2406" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2406" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2406" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2406" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2406" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2406" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2406" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2406" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2406" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2406" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2406" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2406" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2406" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2406" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2406" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2406" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2406" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2406" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2406" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2406" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2406" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2406" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2406" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2406" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2406" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2406" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2406" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2406" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2406" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2406" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2406" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2406" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2406" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2406" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2406" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2406" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2406" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2406" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2589.9103,-1962.8896C2582.7294,-1920.7913 2563.7481,-1809.512 2540.5631,-1673.5882"/>
<polygon fill="#000000" stroke="#000000" points="2543.9464,-1672.6072 2538.8147,-1663.3381 2537.0461,-1673.7842 2543.9464,-1672.6072"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2114,-53.1 2060,-53.1 2060,-17.1 2114,-17.1 2114,-53.1"/>
</g>
<!-- raw_37&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>raw_37&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2087,-866.5632C2087,-758.2631 2087,-197.2221 2087,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2090.5001,-63.4293 2087,-53.4293 2083.5001,-63.4293 2090.5001,-63.4293"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="2854,-902.7014 2698,-902.7014 2698,-866.7014 2854,-866.7014 2854,-902.7014"/>
<text text-anchor="middle" x="2776" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>header_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776,-1962.8896C2776,-1835.2449 2776,-1071.5906 2776,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="2779.5001,-913.0533 2776,-903.0533 2772.5001,-913.0534 2779.5001,-913.0533"/>
</g>
<!-- raw_45 -->
<g id="node46" class="node">
<title>raw_45</title>
<ellipse fill="none" stroke="#000000" cx="2899" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2899" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;raw_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.8348,-1962.8896C2907.6705,-1835.2449 2900.7047,-1071.5906 2899.2616,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="2902.7586,-913.021 2899.1674,-903.0533 2895.7589,-913.0849 2902.7586,-913.021"/>
</g>
<!-- raw_47 -->
<g id="node48" class="node">
<title>raw_47</title>
<ellipse fill="none" stroke="#000000" cx="2971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_47 -->
<g id="edge47" class="edge">
<title>prose_42&#45;&gt;raw_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.6695,-1962.8896C2988.3409,-1835.2449 2974.4094,-1071.5906 2971.5232,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="2975.0167,-912.9878 2971.3348,-903.0533 2968.0179,-913.1155 2975.0167,-912.9878"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="3571.5,-1412.5035 3016.5,-1412.5035 3016.5,-356.8993 3571.5,-356.8993 3571.5,-1412.5035"/>
<text text-anchor="middle" x="3294" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3294" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3294" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3294" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3294" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3294" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3294" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3294" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3294" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3294" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3294" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3294" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3294" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3294" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3294" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3294" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3294" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3294" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3294" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3294" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3294" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3294" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3294" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3294" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3294" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3294" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3294" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3294" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3294" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3294" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3294" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3294" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3294" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3294" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3294" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3294" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3294" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3294" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3294" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3294" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3294" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3294" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3294" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3294" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3294" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3294" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3294" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3294" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3294" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3294" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3294" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3294" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3294" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3294" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3294" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3294" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_43&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3213.3548,-1962.8896C3218.3176,-1896.5397 3236.1339,-1658.3444 3253.7622,-1422.6618"/>
<polygon fill="#000000" stroke="#000000" points="3257.266,-1422.7414 3254.5217,-1412.5082 3250.2855,-1422.2192 3257.266,-1422.7414"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="2677,-63.0015 2157,-63.0015 2157,-7.1986 2677,-7.1986 2677,-63.0015"/>
<text text-anchor="middle" x="2417" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and results, and (eventually) user config.</text>
</g>
<!-- raw_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>raw_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.093,-866.5278C2912.8891,-760.4937 2966.925,-222.4545 2863,-106.2001 2854.7496,-96.9708 2746.0706,-79.5409 2638.0717,-64.2491"/>
<polygon fill="#000000" stroke="#000000" points="2638.3528,-60.7542 2627.9621,-62.8235 2637.3754,-67.6856 2638.3528,-60.7542"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3194.5,-62.4005 2695.5,-62.4005 2695.5,-7.7996 3194.5,-7.7996 3194.5,-62.4005"/>
<text text-anchor="middle" x="2945" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2945" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_47&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>raw_47&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2970.4449,-866.5632C2967.2032,-760.635 2950.7067,-221.5794 2946.1611,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2949.647,-72.525 2945.8427,-62.6367 2942.6503,-72.7391 2949.647,-72.525"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="3920.5,-902.7014 3589.5,-902.7014 3589.5,-866.7014 3920.5,-866.7014 3920.5,-902.7014"/>
<text text-anchor="middle" x="3755" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_50&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>header_50&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3722.5452,-1962.8896C3726.3875,-1835.2449 3749.3744,-1071.5906 3754.1367,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="3757.645,-913.1542 3754.4476,-903.0533 3750.6482,-912.9435 3757.645,-913.1542"/>
</g>
<!-- raw_55 -->
<g id="node56" class="node">
<title>raw_55</title>
<ellipse fill="none" stroke="#000000" cx="3966" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3966" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_55 -->
<g id="edge55" class="edge">
<title>prose_51&#45;&gt;raw_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3963.0496,-1962.8896C3963.3989,-1835.2449 3965.4886,-1071.5906 3965.9215,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="3969.4223,-913.0629 3965.9498,-903.0533 3962.4223,-913.0437 3969.4223,-913.0629"/>
</g>
<!-- raw_57 -->
<g id="node58" class="node">
<title>raw_57</title>
<ellipse fill="none" stroke="#000000" cx="4040" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4040" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_52&#45;&gt;raw_57 -->
<g id="edge57" class="edge">
<title>prose_52&#45;&gt;raw_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4044.9174,-1962.8896C4044.3352,-1835.2449 4040.8524,-1071.5906 4040.1308,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="4043.6294,-913.0372 4040.0837,-903.0533 4036.6294,-913.0692 4043.6294,-913.0372"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4210,-902.7014 4156,-902.7014 4156,-866.7014 4210,-866.7014 4210,-902.7014"/>
</g>
<!-- codeblock_53&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>codeblock_53&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4183,-1962.8896C4183,-1835.2449 4183,-1071.5906 4183,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="4186.5001,-913.0533 4183,-903.0533 4179.5001,-913.0534 4186.5001,-913.0533"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="3579,-63.0015 3213,-63.0015 3213,-7.1986 3579,-7.1986 3579,-63.0015"/>
<text text-anchor="middle" x="3396" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_55&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>raw_55&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.158,-866.4429C3980.3209,-759.9257 4036.0427,-219.6034 3929,-106.2001 3876.6957,-50.7878 3663.4211,-81.0594 3588,-70.2001 3575.9584,-68.4663 3563.518,-66.5285 3551.0275,-64.4779"/>
<polygon fill="#000000" stroke="#000000" points="3551.4451,-60.9994 3541.0063,-62.811 3550.2964,-67.9045 3551.4451,-60.9994"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="3942.5,-55.0021 3597.5,-55.0021 3597.5,-15.198 3942.5,-15.198 3942.5,-55.0021"/>
<text text-anchor="middle" x="3770" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_57&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>raw_57&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4045.7198,-866.9385C4074.0949,-775.1152 4191.0126,-349.1899 4002,-106.2001 3986.5094,-86.2857 3934.7245,-69.4415 3884.0003,-57.1541"/>
<polygon fill="#000000" stroke="#000000" points="3884.7537,-53.7358 3874.2161,-54.8355 3883.1396,-60.5471 3884.7537,-53.7358"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4750.5,-902.7014 4531.5,-902.7014 4531.5,-866.7014 4750.5,-866.7014 4750.5,-902.7014"/>
<text text-anchor="middle" x="4641" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>header_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4641,-1962.8896C4641,-1835.2449 4641,-1071.5906 4641,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="4644.5001,-913.0533 4641,-903.0533 4637.5001,-913.0534 4644.5001,-913.0533"/>
</g>
<!-- raw_67 -->
<g id="node68" class="node">
<title>raw_67</title>
<ellipse fill="none" stroke="#000000" cx="4800" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4800" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_67 -->
<g id="edge67" class="edge">
<title>prose_61&#45;&gt;raw_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4804.9174,-1962.8896C4804.3352,-1835.2449 4800.8524,-1071.5906 4800.1308,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="4803.6294,-913.0372 4800.0837,-903.0533 4796.6294,-913.0692 4803.6294,-913.0372"/>
</g>
<!-- raw_69 -->
<g id="node70" class="node">
<title>raw_69</title>
<ellipse fill="none" stroke="#000000" cx="4879" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4879" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_69 -->
<g id="edge69" class="edge">
<title>prose_62&#45;&gt;raw_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4886.8678,-1962.8896C4885.9364,-1835.2449 4880.3638,-1071.5906 4879.2093,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="4882.7069,-913.0275 4879.1339,-903.0533 4875.7071,-913.0786 4882.7069,-913.0275"/>
</g>
<!-- raw_71 -->
<g id="node72" class="node">
<title>raw_71</title>
<ellipse fill="none" stroke="#000000" cx="5143" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5143" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_71 -->
<g id="edge71" class="edge">
<title>prose_63&#45;&gt;raw_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5452.9337,-1964.233C5418.1819,-1918.7114 5322.9996,-1787.8673 5277,-1663.2027 5173.7063,-1383.2645 5149.1992,-1016.8368 5144.1692,-913.1368"/>
<polygon fill="#000000" stroke="#000000" points="5147.6525,-912.6921 5143.6941,-902.8645 5140.66,-913.0156 5147.6525,-912.6921"/>
</g>
<!-- prespace_72 -->
<g id="node73" class="node">
<title>prespace_72</title>
<ellipse fill="none" stroke="#000000" cx="5332" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5332" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_72 -->
<g id="edge72" class="edge">
<title>prose_63&#45;&gt;prespace_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5460.4266,-1962.9508C5445.8119,-1914.8011 5406.2554,-1779.0889 5388,-1663.2027 5342.2245,-1372.617 5333.8144,-1015.0359 5332.3153,-913.0495"/>
<polygon fill="#000000" stroke="#000000" points="5335.8135,-912.8862 5332.1775,-902.9348 5328.8142,-912.9816 5335.8135,-912.8862"/>
</g>
<!-- literal_73 -->
<g id="node74" class="node">
<title>literal_73</title>
<ellipse fill="none" stroke="#000000" cx="5428" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5428" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_73 -->
<g id="edge73" class="edge">
<title>prose_63&#45;&gt;literal_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5465.3721,-1962.8896C5460.9477,-1835.2449 5434.478,-1071.5906 5428.9941,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="5432.4805,-912.9261 5428.6361,-903.0533 5425.4847,-913.1686 5432.4805,-912.9261"/>
</g>
<!-- raw_74 -->
<g id="node75" class="node">
<title>raw_74</title>
<ellipse fill="none" stroke="#000000" cx="5504" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5504" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_74 -->
<g id="edge74" class="edge">
<title>prose_63&#45;&gt;raw_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5466.6279,-1962.8896C5471.0523,-1835.2449 5497.522,-1071.5906 5503.0059,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="5506.5153,-913.1686 5503.3639,-903.0533 5499.5195,-912.9261 5506.5153,-913.1686"/>
</g>
<!-- prespace_75 -->
<g id="node76" class="node">
<title>prespace_75</title>
<ellipse fill="none" stroke="#000000" cx="5595" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5595" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_63&#45;&gt;prespace_75 -->
<g id="edge75" class="edge">
<title>prose_63&#45;&gt;prespace_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5471.2739,-1962.927C5485.1056,-1914.7191 5522.5587,-1778.8769 5540,-1663.2027 5583.8551,-1372.3481 5592.8827,-1014.9542 5594.6138,-913.0309"/>
<polygon fill="#000000" stroke="#000000" points="5598.115,-912.9772 5594.7753,-902.9226 5591.1159,-912.8653 5598.115,-912.9772"/>
</g>
<!-- literal_76 -->
<g id="node77" class="node">
<title>literal_76</title>
<ellipse fill="none" stroke="#000000" cx="5691" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5691" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_63&#45;&gt;literal_76 -->
<g id="edge76" class="edge">
<title>prose_63&#45;&gt;literal_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5476.5633,-1963.8566C5514.2134,-1902.598 5640.1297,-1696.4342 5650,-1663.2027 5733.8428,-1380.9205 5704.7859,-1016.1331 5694.1734,-912.9783"/>
<polygon fill="#000000" stroke="#000000" points="5697.6253,-912.3376 5693.0932,-902.761 5690.6641,-913.0736 5697.6253,-912.3376"/>
</g>
<!-- raw_77 -->
<g id="node78" class="node">
<title>raw_77</title>
<ellipse fill="none" stroke="#000000" cx="5767" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5767" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_77 -->
<g id="edge77" class="edge">
<title>prose_63&#45;&gt;raw_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5471.8211,-1962.9763C5488.6542,-1913.6051 5542.0675,-1774.8559 5633,-1699.2027 5668.6704,-1669.526 5703.5699,-1700.6284 5731,-1663.2027 5820.3825,-1541.249 5781.1324,-1038.8366 5769.7277,-913.2532"/>
<polygon fill="#000000" stroke="#000000" points="5773.1795,-912.5692 5768.7755,-902.9331 5766.2091,-913.2124 5773.1795,-912.5692"/>
</g>
<!-- raw_85 -->
<g id="node86" class="node">
<title>raw_85</title>
<ellipse fill="none" stroke="#000000" cx="5839" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5839" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_64&#45;&gt;raw_85 -->
<g id="edge85" class="edge">
<title>prose_64&#45;&gt;raw_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5683.4668,-1963.7641C5708.5482,-1917.0783 5776.5941,-1783.601 5803,-1663.2027 5865.9942,-1375.9787 5847.9764,-1015.3543 5841.0959,-912.9627"/>
<polygon fill="#000000" stroke="#000000" points="5844.5757,-912.5487 5840.3926,-902.8147 5837.5924,-913.0328 5844.5757,-912.5487"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6390,-1127.7024 5884,-1127.7024 5884,-641.7005 6390,-641.7005 6390,-1127.7024"/>
<text text-anchor="middle" x="6137" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6137" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6137" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6137" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6137" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6137" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6137" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6137" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6137" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6137" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6137" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6137" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6137" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6137" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6137" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6137" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6137" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6137" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6137" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6137" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6137" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6137" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6137" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_65&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>codeblock_65&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5977.6767,-1962.8896C5991.6321,-1868.4491 6057.0344,-1425.852 6099.5849,-1137.9006"/>
<polygon fill="#000000" stroke="#000000" points="6103.0893,-1138.1276 6101.0888,-1127.7233 6096.1645,-1137.1042 6103.0893,-1138.1276"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="4235.5,-63.0015 3960.5,-63.0015 3960.5,-7.1986 4235.5,-7.1986 4235.5,-63.0015"/>
<text text-anchor="middle" x="4098" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_67&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>raw_67&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4802.0766,-866.725C4813.9031,-760.6726 4868.4571,-217.5683 4759,-106.2001 4718.8693,-65.3687 4301.5896,-78.8776 4245,-70.2001 4235.2743,-68.7087 4225.2437,-66.9012 4215.2061,-64.902"/>
<polygon fill="#000000" stroke="#000000" points="4215.6768,-61.4257 4205.1773,-62.8435 4214.2694,-68.2827 4215.6768,-61.4257"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="4816,-70.3004 4254,-70.3004 4254,.1003 4816,.1003 4816,-70.3004"/>
<text text-anchor="middle" x="4535" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4535" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4535" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_69&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>raw_69&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4884.7744,-866.9889C4913.7101,-774.5349 5033.898,-342.5852 4836,-106.2001 4825.0754,-93.1508 4801.1056,-82.2046 4771.2208,-73.12"/>
<polygon fill="#000000" stroke="#000000" points="4771.899,-69.6721 4761.3192,-70.2355 4769.9412,-76.3927 4771.899,-69.6721"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5354,-62.4005 4834,-62.4005 4834,-7.7996 5354,-7.7996 5354,-62.4005"/>
<text text-anchor="middle" x="5094" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5094" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>raw_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5141.9539,-866.5632C5135.8446,-760.635 5104.755,-221.5794 5096.1882,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="5099.6582,-72.4186 5095.5882,-62.6367 5092.6698,-72.8217 5099.6582,-72.4186"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5426,-53.1 5372,-53.1 5372,-17.1 5426,-17.1 5426,-53.1"/>
<text text-anchor="middle" x="5399" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>prespace_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5332.7569,-866.5464C5336.4407,-780.9458 5353.7264,-409.1554 5388,-106.2001 5389.6016,-92.0433 5391.9597,-76.387 5394.0822,-63.3778"/>
<polygon fill="#000000" stroke="#000000" points="5397.5929,-63.6037 5395.788,-53.1637 5390.6885,-62.4506 5397.5929,-63.6037"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5509.5,-53.1 5444.5,-53.1 5444.5,-17.1 5509.5,-17.1 5509.5,-53.1"/>
<text text-anchor="middle" x="5477" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>literal_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5428.432,-866.5619C5430.5738,-781.0313 5441.049,-409.5083 5468,-106.2001 5469.2561,-92.0638 5471.1796,-76.4098 5472.9263,-63.3967"/>
<polygon fill="#000000" stroke="#000000" points="5476.4365,-63.5623 5474.3335,-53.1783 5469.5019,-62.6073 5476.4365,-63.5623"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5796,-54.4006 5528,-54.4006 5528,-15.7995 5796,-15.7995 5796,-54.4006"/>
<text text-anchor="middle" x="5662" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5662" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>raw_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5502.5697,-866.7002C5494.6419,-762.7666 5459.2925,-239.4258 5540,-106.2001 5552.6148,-85.3766 5573.8026,-70.0093 5595.0134,-58.9987"/>
<polygon fill="#000000" stroke="#000000" points="5596.6488,-62.0949 5604.0802,-54.5434 5593.5617,-55.8124 5596.6488,-62.0949"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5868,-53.1 5814,-53.1 5814,-17.1 5868,-17.1 5868,-53.1"/>
<text text-anchor="middle" x="5841" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>prespace_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5593.5385,-866.6033C5585.4039,-760.9991 5549.6202,-224.9911 5651,-106.2001 5696.6294,-52.7342 5743.3552,-103.9723 5805,-70.2001 5809.8804,-67.5264 5814.5625,-64.0077 5818.8426,-60.2306"/>
<polygon fill="#000000" stroke="#000000" points="5821.288,-62.7347 5826.0683,-53.2795 5816.4351,-57.69 5821.288,-62.7347"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="5944,-53.1 5886,-53.1 5886,-17.1 5944,-17.1 5944,-53.1"/>
<text text-anchor="middle" x="5915" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>literal_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5689.1556,-866.6474C5678.7883,-761.2947 5631.6944,-226.4751 5731,-106.2001 5773.5511,-54.6639 5818.15,-101.8741 5877,-70.2001 5882.0415,-67.4867 5886.9286,-63.948 5891.4255,-60.1634"/>
<polygon fill="#000000" stroke="#000000" points="5894.0184,-62.5356 5899.0477,-53.2106 5889.301,-57.364 5894.0184,-62.5356"/>
</g>
<!-- leaf_84 -->
<g id="node85" class="node">
<title>leaf_84</title>
<polygon fill="none" stroke="#c0c0c0" points="6048,-53.1 5962,-53.1 5962,-17.1 6048,-17.1 6048,-53.1"/>
<text text-anchor="middle" x="6005" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_77&#45;&gt;leaf_84 -->
<g id="edge84" class="edge">
<title>raw_77&#45;&gt;leaf_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5765.0433,-866.6449C5754.0231,-761.278 5703.6542,-226.3913 5803,-106.2001 5846.6795,-53.3555 5890.2501,-97.8206 5953,-70.2001 5959.9222,-67.1532 5966.9149,-63.1768 5973.4307,-58.9993"/>
<polygon fill="#000000" stroke="#000000" points="5975.6313,-61.737 5981.9687,-53.2466 5971.7198,-55.9318 5975.6313,-61.737"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6600,-62.4005 6066,-62.4005 6066,-7.7996 6600,-7.7996 6600,-62.4005"/>
<text text-anchor="middle" x="6333" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6333" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_85&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>raw_85&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5836.8999,-866.5214C5825.0637,-760.4515 5770.8382,-222.2425 5875,-106.2001 5883.5356,-96.6909 5996.3899,-79.1101 6107.9239,-63.8105"/>
<polygon fill="#000000" stroke="#000000" points="6108.5818,-67.2532 6118.016,-62.4318 6107.6343,-60.3177 6108.5818,-67.2532"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="7072.5,-1999.0033 6881.5,-1999.0033 6881.5,-1963.0033 7072.5,-1963.0033 7072.5,-1999.0033"/>
<text text-anchor="middle" x="6977" y="-1977.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_88&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>header_88&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6977,-2354.0247C6977,-2291.7381 6977,-2085.7201 6977,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="6980.5001,-2009.3418 6977,-1999.3418 6973.5001,-2009.3418 6980.5001,-2009.3418"/>
</g>
<!-- raw_94 -->
<g id="node95" class="node">
<title>raw_94</title>
<ellipse fill="none" stroke="#000000" cx="7127" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="7127" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_89&#45;&gt;raw_94 -->
<g id="edge94" class="edge">
<title>prose_89&#45;&gt;raw_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7134.6302,-2354.0247C7133.3561,-2291.7381 7129.142,-2085.7201 7127.5849,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="7131.079,-2009.2681 7127.3751,-1999.3418 7124.0805,-2009.4113 7131.079,-2009.2681"/>
</g>
<!-- raw_96 -->
<g id="node97" class="node">
<title>raw_96</title>
<ellipse fill="none" stroke="#000000" cx="7217" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="7217" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_90&#45;&gt;raw_96 -->
<g id="edge96" class="edge">
<title>prose_90&#45;&gt;raw_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-2354.0247C7217,-2291.7381 7217,-2085.7201 7217,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-2009.3418 7217,-1999.3418 7213.5001,-2009.3418 7220.5001,-2009.3418"/>
</g>
<!-- header_98 -->
<g id="node99" class="node">
<title>header_98</title>
<ellipse fill="none" stroke="#000000" cx="7611" cy="-1981.0033" rx="58.0685" ry="18"/>
<text text-anchor="middle" x="7611" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : fuss_patt</text>
</g>
<!-- section_91&#45;&gt;header_98 -->
<g id="edge98" class="edge">
<title>section_91&#45;&gt;header_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7798.8934,-2354.0247C7767.3182,-2291.339 7662.4139,-2083.0744 7624.6744,-2008.1509"/>
<polygon fill="#000000" stroke="#000000" points="7627.6345,-2006.2472 7620.01,-1998.8907 7621.3828,-2009.3963 7627.6345,-2006.2472"/>
</g>
<!-- prose_99 -->
<g id="node100" class="node">
<title>prose_99</title>
<ellipse fill="none" stroke="#000000" cx="7808" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7808" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_99 -->
<g id="edge99" class="edge">
<title>section_91&#45;&gt;prose_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7808,-2354.0247C7808,-2291.7381 7808,-2085.7201 7808,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="7811.5001,-2009.3418 7808,-1999.3418 7804.5001,-2009.3418 7811.5001,-2009.3418"/>
</g>
<!-- prose_100 -->
<g id="node101" class="node">
<title>prose_100</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8191" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_91&#45;&gt;prose_100 -->
<g id="edge100" class="edge">
<title>section_91&#45;&gt;prose_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7825.2008,-2354.5394C7886.9943,-2291.4389 8097.8049,-2076.1695 8168.0301,-2004.459"/>
<polygon fill="#000000" stroke="#000000" points="8170.6365,-2006.7998 8175.1326,-1997.2063 8165.6352,-2001.9021 8170.6365,-2006.7998"/>
</g>
<!-- codeblock_101 -->
<g id="node102" class="node">
<title>codeblock_101</title>
<ellipse fill="none" stroke="#000000" cx="8525" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8525" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 302&#45;316</text>
</g>
<!-- section_91&#45;&gt;codeblock_101 -->
<g id="edge101" class="edge">
<title>section_91&#45;&gt;codeblock_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7877.7354,-2365.1551C7965.234,-2354.0441 8117.6653,-2326.6234 8232,-2262.8038 8354.2171,-2194.5844 8462.9147,-2062.9432 8505.6926,-2007.085"/>
<polygon fill="#000000" stroke="#000000" points="8508.4948,-2009.1822 8511.7524,-1999.1006 8502.9188,-2004.9504 8508.4948,-2009.1822"/>
</g>
<!-- header_124 -->
<g id="node125" class="node">
<title>header_124</title>
<ellipse fill="none" stroke="#000000" cx="9101" cy="-1981.0033" rx="100.1229" ry="18"/>
<text text-anchor="middle" x="9101" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : __repr for collection</text>
</g>
<!-- section_92&#45;&gt;header_124 -->
<g id="edge124" class="edge">
<title>section_92&#45;&gt;header_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9329.1096,-2354.2829C9290.9275,-2291.8015 9162.9824,-2082.4316 9117.3449,-2007.7502"/>
<polygon fill="#000000" stroke="#000000" points="9120.1553,-2005.6368 9111.9543,-1998.929 9114.1823,-2009.287 9120.1553,-2005.6368"/>
</g>
<!-- prose_125 -->
<g id="node126" class="node">
<title>prose_125</title>
<ellipse fill="none" stroke="#000000" cx="9340" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9340" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_125 -->
<g id="edge125" class="edge">
<title>section_92&#45;&gt;prose_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340,-2354.0247C9340,-2291.7381 9340,-2085.7201 9340,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="9343.5001,-2009.3418 9340,-1999.3418 9336.5001,-2009.3418 9343.5001,-2009.3418"/>
</g>
<!-- prose_126 -->
<g id="node127" class="node">
<title>prose_126</title>
<ellipse fill="none" stroke="#000000" cx="9455" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="9455" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_92&#45;&gt;prose_126 -->
<g id="edge126" class="edge">
<title>section_92&#45;&gt;prose_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9347.3915,-2354.123C9356.0782,-2332.6231 9370.6221,-2295.4447 9381,-2262.8038 9410.1894,-2170.9966 9436.9044,-2059.8218 9448.6712,-2008.9095"/>
<polygon fill="#000000" stroke="#000000" points="9452.1224,-2009.5186 9450.9507,-1998.9887 9445.3002,-2007.951 9452.1224,-2009.5186"/>
</g>
<!-- codeblock_127 -->
<g id="node128" class="node">
<title>codeblock_127</title>
<ellipse fill="none" stroke="#000000" cx="9712" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9712" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 328&#45;376</text>
</g>
<!-- section_92&#45;&gt;codeblock_127 -->
<g id="edge127" class="edge">
<title>section_92&#45;&gt;codeblock_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9369.2913,-2355.3342C9402.211,-2335.6727 9456.2417,-2300.895 9496,-2262.8038 9582.4989,-2179.9317 9662.1429,-2060.4908 9695.4945,-2007.7554"/>
<polygon fill="#000000" stroke="#000000" points="9698.6385,-2009.3302 9700.9928,-1999.0002 9692.7105,-2005.6074 9698.6385,-2009.3302"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="6921.5,-920.0018 6408.5,-920.0018 6408.5,-849.4011 6921.5,-849.4011 6921.5,-920.0018"/>
<text text-anchor="middle" x="6665" y="-872.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a &#39;fuzzy search&#39;, that attempts to find a string containing the</text>
<text text-anchor="middle" x="6665" y="-857.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">letters of the fragment in order.</text>
</g>
<!-- raw_94&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>raw_94&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7130.1618,-1962.9595C7137.7028,-1913.5452 7151.2283,-1774.6963 7081,-1699.2027 7034.0086,-1648.6883 6981.0241,-1709.6402 6930,-1663.2027 6707.6834,-1460.8707 6671.8031,-1064.7546 6666.0702,-930.4746"/>
<polygon fill="#000000" stroke="#000000" points="6669.5547,-930.0063 6665.6677,-920.1503 6662.56,-930.2791 6669.5547,-930.0063"/>
</g>
<!-- leaf_97 -->
<g id="node98" class="node">
<title>leaf_97</title>
<polygon fill="none" stroke="#c0c0c0" points="7494.5,-927.9017 6939.5,-927.9017 6939.5,-841.5011 7494.5,-841.5011 7494.5,-927.9017"/>
<text text-anchor="middle" x="7217" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">If it finds nothing, it switches the last two letters and tries again. This</text>
<text text-anchor="middle" x="7217" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">is an affordance for incremental searches, it&#39;s easy to make this mistake and</text>
<text text-anchor="middle" x="7217" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">harmless to suggest the alternative.</text>
</g>
<!-- raw_96&#45;&gt;leaf_97 -->
<g id="edge97" class="edge">
<title>raw_96&#45;&gt;leaf_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7217,-1962.8896C7217,-1840.9747 7217,-1138.8687 7217,-938.2345"/>
<polygon fill="#000000" stroke="#000000" points="7220.5001,-937.9526 7217,-927.9527 7213.5001,-937.9527 7220.5001,-937.9526"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7619.5,-902.7014 7512.5,-902.7014 7512.5,-866.7014 7619.5,-866.7014 7619.5,-902.7014"/>
<text text-anchor="middle" x="7566" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** fuss_patt</text>
</g>
<!-- header_98&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>header_98&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7610.2565,-1962.8896C7605.017,-1835.2449 7573.6713,-1071.5906 7567.1772,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="7570.6606,-912.9013 7566.7533,-903.0533 7563.6665,-913.1885 7570.6606,-912.9013"/>
</g>
<!-- raw_103 -->
<g id="node104" class="node">
<title>raw_103</title>
<ellipse fill="none" stroke="#000000" cx="7665" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7665" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_103 -->
<g id="edge103" class="edge">
<title>prose_99&#45;&gt;raw_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7800.0324,-1963.2054C7779.1957,-1915.6788 7723.1715,-1781.3587 7701,-1663.2027 7646.7691,-1374.1959 7658.671,-1014.8158 7663.504,-912.8407"/>
<polygon fill="#000000" stroke="#000000" points="7667.0055,-912.8945 7664.0006,-902.7347 7660.0139,-912.5508 7667.0055,-912.8945"/>
</g>
<!-- prespace_104 -->
<g id="node105" class="node">
<title>prespace_104</title>
<ellipse fill="none" stroke="#000000" cx="7756" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7756" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_99&#45;&gt;prespace_104 -->
<g id="edge104" class="edge">
<title>prose_99&#45;&gt;prespace_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7807.1408,-1962.8896C7801.0864,-1835.2449 7764.8646,-1071.5906 7757.3603,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="7760.8404,-912.8763 7756.8705,-903.0533 7753.8483,-913.208 7760.8404,-912.8763"/>
</g>
<!-- literal_105 -->
<g id="node106" class="node">
<title>literal_105</title>
<ellipse fill="none" stroke="#000000" cx="7852" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7852" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_99&#45;&gt;literal_105 -->
<g id="edge105" class="edge">
<title>prose_99&#45;&gt;literal_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7808.727,-1962.8896C7813.85,-1835.2449 7844.4992,-1071.5906 7850.8489,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="7854.3595,-913.1857 7851.2634,-903.0533 7847.3651,-912.9049 7854.3595,-913.1857"/>
</g>
<!-- raw_106 -->
<g id="node107" class="node">
<title>raw_106</title>
<ellipse fill="none" stroke="#000000" cx="7928" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7928" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_99&#45;&gt;raw_106 -->
<g id="edge106" class="edge">
<title>prose_99&#45;&gt;raw_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7814.2018,-1963.0176C7830.4294,-1915.0316 7874.1203,-1779.6849 7892,-1663.2027 7936.564,-1372.8785 7931.435,-1015.1154 7928.8463,-913.0676"/>
<polygon fill="#000000" stroke="#000000" points="7932.3419,-912.8497 7928.576,-902.9468 7925.3444,-913.0367 7932.3419,-912.8497"/>
</g>
<!-- prespace_111 -->
<g id="node112" class="node">
<title>prespace_111</title>
<ellipse fill="none" stroke="#000000" cx="8019" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8019" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_111 -->
<g id="edge111" class="edge">
<title>prose_100&#45;&gt;prespace_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8182.6747,-1963.5979C8160.5866,-1916.4994 8100.4511,-1782.0889 8075,-1663.2027 8013.3513,-1375.2317 8016.0158,-1015.1287 8018.2274,-912.9116"/>
<polygon fill="#000000" stroke="#000000" points="8021.7294,-912.8603 8018.4642,-902.7812 8014.7313,-912.6966 8021.7294,-912.8603"/>
</g>
<!-- literal_112 -->
<g id="node113" class="node">
<title>literal_112</title>
<ellipse fill="none" stroke="#000000" cx="8115" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8115" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_112 -->
<g id="edge112" class="edge">
<title>prose_100&#45;&gt;literal_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8188.5369,-1962.7702C8182.059,-1914.1786 8164.3994,-1777.4792 8155,-1663.2027 8130.916,-1370.3935 8118.9142,-1014.36 8115.8222,-912.8954"/>
<polygon fill="#000000" stroke="#000000" points="8119.3187,-912.7237 8115.5195,-902.8335 8112.3218,-912.9342 8119.3187,-912.7237"/>
</g>
<!-- raw_113 -->
<g id="node114" class="node">
<title>raw_113</title>
<ellipse fill="none" stroke="#000000" cx="8191" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8191" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_113 -->
<g id="edge113" class="edge">
<title>prose_100&#45;&gt;raw_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191,-1962.8896C8191,-1835.2449 8191,-1071.5906 8191,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="8194.5001,-913.0533 8191,-903.0533 8187.5001,-913.0534 8194.5001,-913.0533"/>
</g>
<!-- prespace_114 -->
<g id="node115" class="node">
<title>prespace_114</title>
<ellipse fill="none" stroke="#000000" cx="8282" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="8282" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_100&#45;&gt;prespace_114 -->
<g id="edge114" class="edge">
<title>prose_100&#45;&gt;prespace_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8193.3401,-1962.7595C8199.517,-1914.1417 8216.5042,-1777.3837 8227,-1663.2027 8253.9247,-1370.2953 8274.7361,-1014.3302 8280.4405,-912.8886"/>
<polygon fill="#000000" stroke="#000000" points="8283.9391,-913.0089 8281.0034,-902.829 8276.9501,-912.6178 8283.9391,-913.0089"/>
</g>
<!-- literal_115 -->
<g id="node116" class="node">
<title>literal_115</title>
<ellipse fill="none" stroke="#000000" cx="8378" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="8378" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_100&#45;&gt;literal_115 -->
<g id="edge115" class="edge">
<title>prose_100&#45;&gt;literal_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8201.6936,-1963.9439C8230.0286,-1917.7044 8306.9249,-1785.2367 8337,-1663.2027 8407.3854,-1377.604 8387.8128,-1015.8454 8380.294,-913.0739"/>
<polygon fill="#000000" stroke="#000000" points="8383.768,-912.5957 8379.525,-902.8876 8376.7878,-913.1227 8383.768,-912.5957"/>
</g>
<!-- raw_116 -->
<g id="node117" class="node">
<title>raw_116</title>
<ellipse fill="none" stroke="#000000" cx="8454" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8454" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_100&#45;&gt;raw_116 -->
<g id="edge116" class="edge">
<title>prose_100&#45;&gt;raw_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8207.4003,-1965.4213C8251.427,-1922.3697 8371.9803,-1796.1549 8418,-1663.2027 8514.494,-1384.4286 8472.7349,-1015.8028 8458.2264,-912.5962"/>
<polygon fill="#000000" stroke="#000000" points="8461.6842,-912.0516 8456.7958,-902.652 8454.7555,-913.0485 8461.6842,-912.0516"/>
</g>
<!-- leaf_123 -->
<g id="node124" class="node">
<title>leaf_123</title>
<polygon fill="none" stroke="#c0c0c0" points="8942.5,-981.6022 8499.5,-981.6022 8499.5,-787.8007 8942.5,-787.8007 8942.5,-981.6022"/>
<text text-anchor="middle" x="8721" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="8721" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="8721" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="8721" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="8721" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="8721" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="8721" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="8721" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8721" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="8721" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="8721" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_101&#45;&gt;leaf_123 -->
<g id="edge123" class="edge">
<title>codeblock_101&#45;&gt;leaf_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8528.2384,-1962.8896C8548.3909,-1850.1694 8657.2155,-1241.4722 8701.8665,-991.7221"/>
<polygon fill="#000000" stroke="#000000" points="8705.3713,-992.0056 8703.6859,-981.5456 8698.4805,-990.7736 8705.3713,-992.0056"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7401.5,-63.0015 7112.5,-63.0015 7112.5,-7.1986 7401.5,-7.1986 7401.5,-63.0015"/>
<text text-anchor="middle" x="7257" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Here we incrementally build up a single</text>
</g>
<!-- raw_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>raw_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7667.0567,-866.5357C7678.6427,-760.5472 7731.6384,-222.7227 7628,-106.2001 7595.514,-69.6755 7458.962,-79.6356 7411,-70.2001 7402.594,-68.5464 7393.946,-66.7735 7385.2405,-64.9353"/>
<polygon fill="#000000" stroke="#000000" points="7385.9071,-61.4988 7375.3969,-62.8349 7384.4463,-68.3447 7385.9071,-61.4988"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="7474,-53.1 7420,-53.1 7420,-17.1 7474,-17.1 7474,-53.1"/>
<text text-anchor="middle" x="7447" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>prespace_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7757.6018,-866.5035C7766.5384,-760.3313 7806.1596,-221.6392 7701,-106.2001 7634.8688,-33.6045 7570.6329,-114.5164 7483,-70.2001 7477.9367,-67.6396 7473.1238,-64.1165 7468.7605,-60.2847"/>
<polygon fill="#000000" stroke="#000000" points="7471.0551,-57.6347 7461.4352,-53.1953 7466.187,-62.6648 7471.0551,-57.6347"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="7546,-53.1 7492,-53.1 7492,-17.1 7546,-17.1 7546,-53.1"/>
<text text-anchor="middle" x="7519" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>literal_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7853.9977,-866.4902C7865.2347,-760.2426 7916.3911,-221.1942 7811,-106.2001 7733.3691,-21.4957 7658.1458,-120.8195 7555,-70.2001 7549.9064,-67.7004 7545.0786,-64.2072 7540.7099,-60.3862"/>
<polygon fill="#000000" stroke="#000000" points="7543.0044,-57.7362 7533.3839,-53.2982 7538.137,-62.767 7543.0044,-57.7362"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="7783.5,-54.4006 7564.5,-54.4006 7564.5,-15.7995 7783.5,-15.7995 7783.5,-54.4006"/>
<text text-anchor="middle" x="7674" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> pattern which will recognize</text>
<text text-anchor="middle" x="7674" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">our desired lines.</text>
</g>
<!-- raw_106&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>raw_106&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7929.8451,-866.4177C7940.1076,-760.8946 7986.3746,-230.1203 7892,-106.2001 7887.3853,-100.1407 7810.3581,-75.9102 7749.1585,-57.4036"/>
<polygon fill="#000000" stroke="#000000" points="7750.0704,-54.023 7739.4857,-54.4862 7748.049,-60.7248 7750.0704,-54.023"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="7856,-53.1 7802,-53.1 7802,-17.1 7856,-17.1 7856,-53.1"/>
</g>
<!-- prespace_111&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>prespace_111&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8024.0908,-866.7515C8048.9892,-774.8733 8149.4286,-352.013 7964,-106.2001 7935.8048,-68.8232 7904.6487,-95.0996 7865,-70.2001 7860.4954,-67.3712 7856.0954,-63.9002 7852.0056,-60.2531"/>
<polygon fill="#000000" stroke="#000000" points="7854.222,-57.5297 7844.577,-53.1452 7849.3826,-62.5875 7854.222,-57.5297"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8037.5,-53.1 7874.5,-53.1 7874.5,-17.1 8037.5,-17.1 8037.5,-53.1"/>
<text text-anchor="middle" x="7956" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">(P(1) &#45; P(frag[n]))^0</text>
</g>
<!-- literal_112&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>literal_112&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116.2728,-866.7115C8123.2978,-762.8416 8154.1851,-239.7985 8074,-106.2001 8061.0762,-84.6674 8038.903,-68.8372 8017.242,-57.6541"/>
<polygon fill="#000000" stroke="#000000" points="8018.5394,-54.3925 8008.0185,-53.1427 8015.4637,-60.6806 8018.5394,-54.3925"/>
</g>
<!-- leaf_119 -->
<g id="node120" class="node">
<title>leaf_119</title>
<polygon fill="none" stroke="#c0c0c0" points="8400.5,-54.4006 8055.5,-54.4006 8055.5,-15.7995 8400.5,-15.7995 8400.5,-54.4006"/>
<text text-anchor="middle" x="8228" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> matches anything that isn&#39;t the next fragment,</text>
<text text-anchor="middle" x="8228" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">including</text>
</g>
<!-- raw_113&#45;&gt;leaf_119 -->
<g id="edge119" class="edge">
<title>raw_113&#45;&gt;leaf_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8191.7899,-866.5632C8196.4958,-758.5056 8220.8303,-199.7321 8226.7169,-64.564"/>
<polygon fill="#000000" stroke="#000000" points="8230.2153,-64.6746 8227.1538,-54.5318 8223.2219,-64.37 8230.2153,-64.6746"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="8473,-53.1 8419,-53.1 8419,-17.1 8473,-17.1 8473,-53.1"/>
<text text-anchor="middle" x="8446" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_114&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>prespace_114&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8277.3644,-866.5557C8255.1962,-775.4379 8167.9041,-362.0821 8338,-106.2001 8357.5861,-76.7359 8380.0853,-90.5886 8409,-70.2001 8413.2332,-67.2152 8417.4637,-63.7616 8421.4719,-60.2093"/>
<polygon fill="#000000" stroke="#000000" points="8423.9057,-62.7256 8428.8477,-53.354 8419.1401,-57.5982 8423.9057,-62.7256"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="8545,-53.1 8491,-53.1 8491,-17.1 8545,-17.1 8545,-53.1"/>
<text text-anchor="middle" x="8518" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">&quot;&quot;</text>
</g>
<!-- literal_115&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>literal_115&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8376.6413,-866.676C8369.1294,-762.6063 8335.9171,-238.6287 8418,-106.2001 8435.1936,-78.4608 8455.8732,-89.7571 8482,-70.2001 8485.9832,-67.2185 8489.9774,-63.8245 8493.7802,-60.3496"/>
<polygon fill="#000000" stroke="#000000" points="8496.4405,-62.6486 8501.2523,-53.2095 8491.6044,-57.5877 8496.4405,-62.6486"/>
</g>
<!-- leaf_122 -->
<g id="node123" class="node">
<title>leaf_122</title>
<polygon fill="none" stroke="#c0c0c0" points="8999,-54.4006 8563,-54.4006 8563,-15.7995 8999,-15.7995 8999,-54.4006"/>
<text text-anchor="middle" x="8781" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">. &#160;We then require this to be followed by the next fragment,</text>
<text text-anchor="middle" x="8781" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">and so on.</text>
</g>
<!-- raw_116&#45;&gt;leaf_122 -->
<g id="edge122" class="edge">
<title>raw_116&#45;&gt;leaf_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8452.0506,-866.651C8441.0721,-761.3184 8390.9002,-226.5942 8490,-106.2001 8508.2778,-83.9948 8565.0792,-67.7053 8623.7052,-56.3646"/>
<polygon fill="#000000" stroke="#000000" points="8624.712,-59.7366 8633.8912,-54.4459 8623.4161,-52.8576 8624.712,-59.7366"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="9151.5,-902.7014 8960.5,-902.7014 8960.5,-866.7014 9151.5,-866.7014 9151.5,-902.7014"/>
<text text-anchor="middle" x="9056" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** __repr for collection</text>
</g>
<!-- header_124&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>header_124&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9100.2565,-1962.8896C9095.017,-1835.2449 9063.6713,-1071.5906 9057.1772,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="9060.6606,-912.9013 9056.7533,-903.0533 9053.6665,-913.1885 9060.6606,-912.9013"/>
</g>
<!-- raw_129 -->
<g id="node130" class="node">
<title>raw_129</title>
<ellipse fill="none" stroke="#000000" cx="9197" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9197" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_129 -->
<g id="edge129" class="edge">
<title>prose_125&#45;&gt;raw_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9332.0324,-1963.2054C9311.1957,-1915.6788 9255.1715,-1781.3587 9233,-1663.2027 9178.7691,-1374.1959 9190.671,-1014.8158 9195.504,-912.8407"/>
<polygon fill="#000000" stroke="#000000" points="9199.0055,-912.8945 9196.0006,-902.7347 9192.0139,-912.5508 9199.0055,-912.8945"/>
</g>
<!-- prespace_130 -->
<g id="node131" class="node">
<title>prespace_130</title>
<ellipse fill="none" stroke="#000000" cx="9288" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="9288" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_125&#45;&gt;prespace_130 -->
<g id="edge130" class="edge">
<title>prose_125&#45;&gt;prespace_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9339.1408,-1962.8896C9333.0864,-1835.2449 9296.8646,-1071.5906 9289.3603,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="9292.8404,-912.8763 9288.8705,-903.0533 9285.8483,-913.208 9292.8404,-912.8763"/>
</g>
<!-- literal_131 -->
<g id="node132" class="node">
<title>literal_131</title>
<ellipse fill="none" stroke="#000000" cx="9384" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="9384" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_125&#45;&gt;literal_131 -->
<g id="edge131" class="edge">
<title>prose_125&#45;&gt;literal_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9340.727,-1962.8896C9345.85,-1835.2449 9376.4992,-1071.5906 9382.8489,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="9386.3595,-913.1857 9383.2634,-903.0533 9379.3651,-912.9049 9386.3595,-913.1857"/>
</g>
<!-- raw_132 -->
<g id="node133" class="node">
<title>raw_132</title>
<ellipse fill="none" stroke="#000000" cx="9460" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9460" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_125&#45;&gt;raw_132 -->
<g id="edge132" class="edge">
<title>prose_125&#45;&gt;raw_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9344.5879,-1963.1761C9356.0756,-1918.618 9387.0863,-1798.8192 9414,-1699.2027 9418.3312,-1683.1717 9421.3777,-1679.6002 9424,-1663.2027 9470.3834,-1373.1636 9463.9881,-1015.2021 9460.9724,-913.0874"/>
<polygon fill="#000000" stroke="#000000" points="9464.4668,-912.8467 9460.659,-902.9598 9457.4701,-913.0633 9464.4668,-912.8467"/>
</g>
<!-- raw_137 -->
<g id="node138" class="node">
<title>raw_137</title>
<ellipse fill="none" stroke="#000000" cx="9532" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="9532" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_126&#45;&gt;raw_137 -->
<g id="edge137" class="edge">
<title>prose_126&#45;&gt;raw_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9457.883,-1962.7887C9465.4511,-1914.2422 9485.9889,-1777.6436 9496,-1663.2027 9521.5968,-1370.5957 9529.6693,-1014.4215 9531.5318,-912.9094"/>
<polygon fill="#000000" stroke="#000000" points="9535.0324,-912.9035 9531.7112,-902.8427 9528.0335,-912.7787 9535.0324,-912.9035"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="10083,-1251.3029 9577,-1251.3029 9577,-518.0999 10083,-518.0999 10083,-1251.3029"/>
<text text-anchor="middle" x="9830" y="-1236.3021" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat, litpat = assert(table.concat), assert(string.litpat)</text>
<text text-anchor="middle" x="9830" y="-1204.9021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _highlight(line, frag, c, best)</text>
<text text-anchor="middle" x="9830" y="-1189.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local hl = {}</text>
<text text-anchor="middle" x="9830" y="-1174.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local og_line = line &#45;&#45; debugging</text>
<text text-anchor="middle" x="9830" y="-1158.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while #frag &gt; 0 do</text>
<text text-anchor="middle" x="9830" y="-1143.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local char</text>
<text text-anchor="middle" x="9830" y="-1127.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;char, frag = frag:sub(1,1), frag:sub(2)</text>
<text text-anchor="middle" x="9830" y="-1112.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local at = line:find(litpat(char))</text>
<text text-anchor="middle" x="9830" y="-1097.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not at then</text>
<text text-anchor="middle" x="9830" y="-1081.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error (&quot;can&#39;t find &quot; .. char .. &quot; in: &quot; .. line)</text>
<text text-anchor="middle" x="9830" y="-1066.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-1050.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local color</text>
<text text-anchor="middle" x="9830" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; highlight the last two differently if this is a &#39;second best&#39;</text>
<text text-anchor="middle" x="9830" y="-1020.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; search</text>
<text text-anchor="middle" x="9830" y="-1004.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not best and #frag &lt;= 1 then</text>
<text text-anchor="middle" x="9830" y="-989.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.alert</text>
<text text-anchor="middle" x="9830" y="-973.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9830" y="-958.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;color = c.search_hl</text>
<text text-anchor="middle" x="9830" y="-943.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-927.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = c.base(line:sub(1, at &#45;1))</text>
<text text-anchor="middle" x="9830" y="-912.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;hl[#hl + 1] = color(char)</text>
<text text-anchor="middle" x="9830" y="-896.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line = line:sub(at + 1)</text>
<text text-anchor="middle" x="9830" y="-881.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-866.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;hl[#hl + 1] = c.base(line)</text>
<text text-anchor="middle" x="9830" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return concat(hl):gsub(&quot;\n&quot;, c.stresc(&quot;\\n&quot;))</text>
<text text-anchor="middle" x="9830" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-803.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _collect_repr(collection, c)</text>
<text text-anchor="middle" x="9830" y="-788.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="9830" y="-773.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return c.alert &quot;No results found&quot;</text>
<text text-anchor="middle" x="9830" y="-757.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-742.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="9830" y="-726.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(collection) do</text>
<text text-anchor="middle" x="9830" y="-711.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local alt_seq = &quot; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;</text>
<text text-anchor="middle" x="9830" y="-696.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i &lt; 10 then</text>
<text text-anchor="middle" x="9830" y="-680.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;alt_seq = a.bold(&quot;M&#45;&quot; .. tostring(i) .. &quot; &quot;)</text>
<text text-anchor="middle" x="9830" y="-665.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-649.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase</text>
<text text-anchor="middle" x="9830" y="-634.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. alt_seq</text>
<text text-anchor="middle" x="9830" y="-619.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. _highlight(v, collection.frag, c, collection.best)</text>
<text text-anchor="middle" x="9830" y="-603.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot;</text>
<text text-anchor="middle" x="9830" y="-588.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="9830" y="-572.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="9830" y="-557.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9830" y="-526.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local collect_M = {__repr = _collect_repr}</text>
</g>
<!-- codeblock_127&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>codeblock_127&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9713.9497,-1962.8896C9722.7407,-1881.2145 9759.5596,-1539.1417 9789.4002,-1261.9016"/>
<polygon fill="#000000" stroke="#000000" points="9792.9129,-1261.9707 9790.5033,-1251.6536 9785.9531,-1261.2215 9792.9129,-1261.9707"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="9264.5,-63.0015 9017.5,-63.0015 9017.5,-7.1986 9264.5,-7.1986 9264.5,-63.0015"/>
<text text-anchor="middle" x="9141" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">We use a pseudo&#45;metamethod called</text>
</g>
<!-- raw_129&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>raw_129&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9197.5622,-866.4528C9199.9142,-780.4306 9206.7926,-407.028 9160,-106.2001 9158.2886,-95.1975 9155.5405,-83.4464 9152.6599,-72.7314"/>
<polygon fill="#000000" stroke="#000000" points="9155.9551,-71.5189 9149.887,-62.834 9149.2146,-73.4074 9155.9551,-71.5189"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="9337,-53.1 9283,-53.1 9283,-17.1 9337,-17.1 9337,-53.1"/>
<text text-anchor="middle" x="9310" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_130&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>prespace_130&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9288.4697,-866.5632C9291.2741,-758.2631 9305.8019,-197.2221 9309.2604,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9312.7652,-63.5166 9309.5254,-53.4293 9305.7676,-63.3353 9312.7652,-63.5166"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="9413,-53.1 9355,-53.1 9355,-17.1 9413,-17.1 9413,-53.1"/>
<text text-anchor="middle" x="9384" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">__repr</text>
</g>
<!-- literal_131&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>literal_131&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9384,-866.5632C9384,-758.2631 9384,-197.2221 9384,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="9387.5001,-63.4293 9384,-53.4293 9380.5001,-63.4293 9387.5001,-63.4293"/>
</g>
<!-- leaf_136 -->
<g id="node137" class="node">
<title>leaf_136</title>
<polygon fill="none" stroke="#c0c0c0" points="9958.5,-62.3005 9431.5,-62.3005 9431.5,-7.8996 9958.5,-7.8996 9958.5,-62.3005"/>
<text text-anchor="middle" x="9695" y="-47.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> to specify custom table</text>
<text text-anchor="middle" x="9695" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representations. &#160;These take the table as the first value and receive the</text>
<text text-anchor="middle" x="9695" y="-16.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local color palette for consistency.</text>
</g>
<!-- raw_132&#45;&gt;leaf_136 -->
<g id="edge136" class="edge">
<title>raw_132&#45;&gt;leaf_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9458.2076,-866.4573C9448.2418,-761.1569 9403.3621,-231.4239 9496,-106.2001 9507.0161,-91.309 9540.3028,-77.1033 9576.5773,-65.359"/>
<polygon fill="#000000" stroke="#000000" points="9577.8774,-68.6189 9586.3598,-62.2708 9575.77,-61.9437 9577.8774,-68.6189"/>
</g>
<!-- leaf_138 -->
<g id="node139" class="node">
<title>leaf_138</title>
<polygon fill="none" stroke="#c0c0c0" points="10489.5,-62.4005 9976.5,-62.4005 9976.5,-7.7996 10489.5,-7.7996 10489.5,-62.4005"/>
<text text-anchor="middle" x="10233" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">In this case we want to highlight the letters of the fragment, which we</text>
<text text-anchor="middle" x="10233" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">attach to the collection.</text>
</g>
<!-- raw_137&#45;&gt;leaf_138 -->
<g id="edge138" class="edge">
<title>raw_137&#45;&gt;leaf_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9529.791,-866.4204C9517.3344,-759.7754 9460.1772,-218.8489 9568,-106.2001 9598.7794,-74.0431 9922.7585,-75.1128 9967,-70.2001 9985.0519,-68.1956 10003.7758,-65.9874 10022.5481,-63.684"/>
<polygon fill="#000000" stroke="#000000" points="10023.1752,-67.1333 10032.6707,-62.4336 10022.317,-60.1861 10023.1752,-67.1333"/>
</g>
<!-- leaf_148 -->
<g id="node149" class="node">
<title>leaf_148</title>
<polygon fill="none" stroke="#c0c0c0" points="10376.5,-1999.0033 10185.5,-1999.0033 10185.5,-1963.0033 10376.5,-1963.0033 10376.5,-1999.0033"/>
<text text-anchor="middle" x="10281" y="-1977.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_140&#45;&gt;leaf_148 -->
<g id="edge148" class="edge">
<title>header_140&#45;&gt;leaf_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10362.0707,-2354.0247C10348.5059,-2291.6105 10303.575,-2084.8751 10287.1133,-2009.1315"/>
<polygon fill="#000000" stroke="#000000" points="10290.5296,-2008.3703 10284.9856,-1999.3418 10283.6893,-2009.857 10290.5296,-2008.3703"/>
</g>
<!-- raw_149 -->
<g id="node150" class="node">
<title>raw_149</title>
<ellipse fill="none" stroke="#000000" cx="10422" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="10422" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_149 -->
<g id="edge149" class="edge">
<title>prose_141&#45;&gt;raw_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10583.0884,-2361.3746C10548.2289,-2345.4554 10487.2366,-2312.062 10458,-2262.8038 10409.4844,-2181.0642 10413.6134,-2062.6872 10418.6187,-2009.161"/>
<polygon fill="#000000" stroke="#000000" points="10422.1167,-2009.3582 10419.6488,-1999.0548 10415.1527,-2008.6484 10422.1167,-2009.3582"/>
</g>
<!-- prespace_150 -->
<g id="node151" class="node">
<title>prespace_150</title>
<ellipse fill="none" stroke="#000000" cx="10513" cy="-1981.0033" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="10513" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_141&#45;&gt;prespace_150 -->
<g id="edge150" class="edge">
<title>prose_141&#45;&gt;prespace_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10601.4765,-2354.2057C10592.7014,-2332.7855 10578.2236,-2295.6836 10569,-2262.8038 10543.3409,-2171.336 10524.8659,-2059.9956 10517.0873,-2008.9763"/>
<polygon fill="#000000" stroke="#000000" points="10520.5403,-2008.4015 10515.591,-1999.0337 10513.6182,-2009.4433 10520.5403,-2008.4015"/>
</g>
<!-- literal_151 -->
<g id="node152" class="node">
<title>literal_151</title>
<ellipse fill="none" stroke="#000000" cx="10609" cy="-1981.0033" rx="31.481" ry="18"/>
<text text-anchor="middle" x="10609" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_141&#45;&gt;literal_151 -->
<g id="edge151" class="edge">
<title>prose_141&#45;&gt;literal_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10609,-2354.0247C10609,-2291.7381 10609,-2085.7201 10609,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="10612.5001,-2009.3418 10609,-1999.3418 10605.5001,-2009.3418 10612.5001,-2009.3418"/>
</g>
<!-- raw_152 -->
<g id="node153" class="node">
<title>raw_152</title>
<ellipse fill="none" stroke="#000000" cx="10687" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="10687" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_141&#45;&gt;raw_152 -->
<g id="edge152" class="edge">
<title>prose_141&#45;&gt;raw_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10616.8788,-2354.2995C10625.9957,-2332.9694 10640.802,-2295.9542 10649,-2262.8038 10671.5237,-2171.7241 10681.5482,-2060.5627 10685.2182,-2009.3364"/>
<polygon fill="#000000" stroke="#000000" points="10688.7305,-2009.2767 10685.9259,-1999.0599 10681.7471,-2008.7958 10688.7305,-2009.2767"/>
</g>
<!-- raw_157 -->
<g id="node158" class="node">
<title>raw_157</title>
<ellipse fill="none" stroke="#000000" cx="11119" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="11119" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_142&#45;&gt;raw_157 -->
<g id="edge157" class="edge">
<title>prose_142&#45;&gt;raw_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11180.9953,-2354.0247C11170.6434,-2291.7381 11136.4037,-2085.7201 11123.7524,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="11127.14,-2008.6326 11122.0478,-1999.3418 11120.2347,-2009.7803 11127.14,-2008.6326"/>
</g>
<!-- raw_159 -->
<g id="node160" class="node">
<title>raw_159</title>
<ellipse fill="none" stroke="#000000" cx="11314" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="11314" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_143&#45;&gt;raw_159 -->
<g id="edge159" class="edge">
<title>prose_143&#45;&gt;raw_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11299.6934,-2354.0247C11302.0823,-2291.7381 11309.9838,-2085.7201 11312.9033,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="11316.4107,-2009.4686 11313.2967,-1999.3418 11309.4159,-2009.2003 11316.4107,-2009.4686"/>
</g>
<!-- raw_161 -->
<g id="node162" class="node">
<title>raw_161</title>
<ellipse fill="none" stroke="#000000" cx="11391" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="11391" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_144&#45;&gt;raw_161 -->
<g id="edge161" class="edge">
<title>prose_144&#45;&gt;raw_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11381.4623,-2354.0247C11383.0549,-2291.7381 11388.3225,-2085.7201 11390.2689,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="11393.7743,-2009.428 11390.5311,-1999.3418 11386.7765,-2009.249 11393.7743,-2009.428"/>
</g>
<!-- raw_163 -->
<g id="node164" class="node">
<title>raw_163</title>
<ellipse fill="none" stroke="#000000" cx="11468" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="11468" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_145&#45;&gt;raw_163 -->
<g id="edge163" class="edge">
<title>prose_145&#45;&gt;raw_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11463.2311,-2354.0247C11464.0274,-2291.7381 11466.6613,-2085.7201 11467.6344,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="11471.1373,-2009.3858 11467.7656,-1999.3418 11464.1379,-2009.2962 11471.1373,-2009.3858"/>
</g>
<!-- raw_165 -->
<g id="node166" class="node">
<title>raw_165</title>
<ellipse fill="none" stroke="#000000" cx="11545" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="11545" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_146&#45;&gt;raw_165 -->
<g id="edge165" class="edge">
<title>prose_146&#45;&gt;raw_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11545,-2354.0247C11545,-2291.7381 11545,-2085.7201 11545,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="11548.5001,-2009.3418 11545,-1999.3418 11541.5001,-2009.3418 11548.5001,-2009.3418"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="12145.5,-2262.6045 11590.5,-2262.6045 11590.5,-1699.4021 12145.5,-1699.4021 12145.5,-2262.6045"/>
<text text-anchor="middle" x="11868" y="-2231.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="11868" y="-2216.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = setmeta({}, collect_M)</text>
<text text-anchor="middle" x="11868" y="-2200.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.frag = frag</text>
<text text-anchor="middle" x="11868" y="-2185.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if frag == &quot;&quot; then</text>
<text text-anchor="middle" x="11868" y="-2170.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return collection, false</text>
<text text-anchor="middle" x="11868" y="-2154.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11868" y="-2139.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursors = {}</text>
<text text-anchor="middle" x="11868" y="-2123.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="11868" y="-2108.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="11868" y="-2093.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11868" y="-2077.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11868" y="-2062.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11868" y="-2046.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11868" y="-2015.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11868" y="-2000.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11868" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11868" y="-1969.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="11868" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="11868" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="11868" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="11868" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;collection.frag = slip</text>
<text text-anchor="middle" x="11868" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = fuzz_patt(slip)</text>
<text text-anchor="middle" x="11868" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="11868" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="11868" y="-1846.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="11868" y="-1830.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="11868" y="-1815.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursors[#cursors + 1] = i</text>
<text text-anchor="middle" x="11868" y="-1799.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11868" y="-1784.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11868" y="-1769.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="11868" y="-1753.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.best = best</text>
<text text-anchor="middle" x="11868" y="-1738.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;collection.cursors = cursors</text>
<text text-anchor="middle" x="11868" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="11868" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_147&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>codeblock_147&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11780.2528,-2354.0247C11784.4037,-2336.3792 11791.268,-2307.1983 11799.3824,-2272.7033"/>
<polygon fill="#000000" stroke="#000000" points="11802.8201,-2273.374 11801.703,-2262.8382 11796.0061,-2271.771 11802.8201,-2273.374"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="10467,-912.6029 10101,-912.6029 10101,-856.7999 10467,-856.7999 10467,-912.6029"/>
<text text-anchor="middle" x="10284" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an incremental &#39;fuzzy&#39; search, returning a</text>
</g>
<!-- raw_149&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>raw_149&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10419.7199,-1962.8896C10403.948,-1837.5946 10311.0371,-1099.49 10288.7864,-922.7258"/>
<polygon fill="#000000" stroke="#000000" points="10292.2341,-922.0901 10287.5125,-912.6055 10285.2889,-922.9644 10292.2341,-922.0901"/>
</g>
<!-- leaf_154 -->
<g id="node155" class="node">
<title>leaf_154</title>
<polygon fill="none" stroke="#c0c0c0" points="10539,-902.7014 10485,-902.7014 10485,-866.7014 10539,-866.7014 10539,-902.7014"/>
<text text-anchor="middle" x="10512" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_150&#45;&gt;leaf_154 -->
<g id="edge154" class="edge">
<title>prespace_150&#45;&gt;leaf_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10512.9835,-1962.8896C10512.867,-1835.2449 10512.1705,-1071.5906 10512.0262,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="10515.526,-913.0501 10512.0167,-903.0533 10508.526,-913.0566 10515.526,-913.0501"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="10643,-902.7014 10557,-902.7014 10557,-866.7014 10643,-866.7014 10643,-902.7014"/>
<text text-anchor="middle" x="10600" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">collection</text>
</g>
<!-- literal_151&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>literal_151&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10608.8513,-1962.8896C10607.8034,-1835.2449 10601.5343,-1071.5906 10600.2354,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="10603.7327,-913.0242 10600.1507,-903.0533 10596.733,-913.0818 10603.7327,-913.0242"/>
</g>
<!-- leaf_156 -->
<g id="node157" class="node">
<title>leaf_156</title>
<polygon fill="none" stroke="#c0c0c0" points="10715,-902.7014 10661,-902.7014 10661,-866.7014 10715,-866.7014 10715,-902.7014"/>
<text text-anchor="middle" x="10688" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">.</text>
</g>
<!-- raw_152&#45;&gt;leaf_156 -->
<g id="edge156" class="edge">
<title>raw_152&#45;&gt;leaf_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10687.0165,-1962.8896C10687.133,-1835.2449 10687.8295,-1071.5906 10687.9738,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="10691.474,-913.0566 10687.9833,-903.0533 10684.474,-913.0501 10691.474,-913.0566"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="11246.5,-904.6035 10733.5,-904.6035 10733.5,-864.7993 11246.5,-864.7993 11246.5,-904.6035"/>
<text text-anchor="middle" x="10990" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The array portion of a collection is any line which matches the search.</text>
</g>
<!-- raw_157&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>raw_157&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11116.8686,-1962.8896C11101.8979,-1835.6615 11012.5768,-1076.5691 10993.5593,-914.9496"/>
<polygon fill="#000000" stroke="#000000" points="10997.0062,-914.2926 10992.3615,-904.7702 10990.0541,-915.1107 10997.0062,-914.2926"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="11427.5,-904.6035 11264.5,-904.6035 11264.5,-864.7993 11427.5,-864.7993 11427.5,-904.6035"/>
<text text-anchor="middle" x="11346" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">The other fields are:</text>
</g>
<!-- raw_159&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>raw_159&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11314.5287,-1962.8896C11318.2424,-1835.6615 11340.3996,-1076.5691 11345.1171,-914.9496"/>
<polygon fill="#000000" stroke="#000000" points="11348.6209,-914.8681 11345.4142,-904.7702 11341.6238,-914.6638 11348.6209,-914.8681"/>
</g>
<!-- leaf_162 -->
<g id="node163" class="node">
<title>leaf_162</title>
<polygon fill="none" stroke="#c0c0c0" points="11972.5,-919.9018 11445.5,-919.9018 11445.5,-849.501 11972.5,-849.501 11972.5,-919.9018"/>
<text text-anchor="middle" x="11709" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #fields</text>
<text text-anchor="middle" x="11709" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;best : &#160;Whether this is a best&#45;fit collection, that is, one with all</text>
<text text-anchor="middle" x="11709" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;codepoints in order.</text>
</g>
<!-- raw_161&#45;&gt;leaf_162 -->
<g id="edge162" class="edge">
<title>raw_161&#45;&gt;leaf_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11392.467,-1962.983C11396.3788,-1917.9841 11408.4041,-1797.2588 11432,-1699.2027 11504.3833,-1398.404 11640.9848,-1051.1202 11690.491,-929.5136"/>
<polygon fill="#000000" stroke="#000000" points="11693.7802,-930.7169 11694.3185,-920.1357 11687.2992,-928.0717 11693.7802,-930.7169"/>
</g>
<!-- leaf_164 -->
<g id="node165" class="node">
<title>leaf_164</title>
<polygon fill="none" stroke="#c0c0c0" points="12419.5,-904.6035 11990.5,-904.6035 11990.5,-864.7993 12419.5,-864.7993 12419.5,-904.6035"/>
<text text-anchor="middle" x="12205" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;frag : &#160;The fragment, used to highlight the collection</text>
</g>
<!-- raw_163&#45;&gt;leaf_164 -->
<g id="edge164" class="edge">
<title>raw_163&#45;&gt;leaf_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11464.0022,-1963.1267C11453.9437,-1912.9237 11433.4827,-1769.7267 11509,-1699.2027 11585.8814,-1627.4049 11899.4283,-1729.6236 11981,-1663.2027 12221.0683,-1467.7239 12213.9014,-1032.8079 12207.1791,-914.7606"/>
<polygon fill="#000000" stroke="#000000" points="12210.6646,-914.415 12206.5584,-904.6482 12203.6777,-914.8439 12210.6646,-914.415"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="12944,-912.0018 12438,-912.0018 12438,-857.401 12944,-857.401 12944,-912.0018"/>
<text text-anchor="middle" x="12691" y="-880.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;cursors : &#160;This is an array, each value is the cursor position of</text>
<text text-anchor="middle" x="12691" y="-865.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;the corresponding line in the history.</text>
</g>
<!-- raw_165&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>raw_165&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11540.5191,-1963.0477C11529.1335,-1912.6369 11505.0938,-1768.9455 11581,-1699.2027 11650.3632,-1635.4717 12352.6567,-1719.7385 12428,-1663.2027 12674.3931,-1478.3154 12692.2447,-1051.4586 12691.7965,-922.3611"/>
<polygon fill="#000000" stroke="#000000" points="12695.2952,-922.1647 12691.72,-912.1913 12688.2954,-922.2174 12695.2952,-922.1647"/>
</g>
<!-- leaf_174 -->
<g id="node175" class="node">
<title>leaf_174</title>
<polygon fill="none" stroke="#c0c0c0" points="12863.5,-1999.0033 12714.5,-1999.0033 12714.5,-1963.0033 12863.5,-1963.0033 12863.5,-1999.0033"/>
<text text-anchor="middle" x="12789" y="-1977.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_168&#45;&gt;leaf_174 -->
<g id="edge174" class="edge">
<title>header_168&#45;&gt;leaf_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12809.0292,-2354.0247C12805.6848,-2291.7381 12794.6227,-2085.7201 12790.5354,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="12794.0159,-2009.1397 12789.9847,-1999.3418 12787.026,-2009.5151 12794.0159,-2009.1397"/>
</g>
<!-- raw_175 -->
<g id="node176" class="node">
<title>raw_175</title>
<ellipse fill="none" stroke="#000000" cx="12909" cy="-1981.0033" rx="27" ry="18"/>
<text text-anchor="middle" x="12909" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_169&#45;&gt;raw_175 -->
<g id="edge175" class="edge">
<title>prose_169&#45;&gt;raw_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12977.0811,-2354.3093C12967.9257,-2332.9887 12953.0823,-2295.9826 12945,-2262.8038 12922.8145,-2171.7296 12913.7284,-2060.5655 12910.5193,-2009.3375"/>
<polygon fill="#000000" stroke="#000000" points="12913.9956,-2008.8339 12909.905,-1999.0606 12907.0081,-2009.2517 12913.9956,-2008.8339"/>
</g>
<!-- leaf_177 -->
<g id="node178" class="node">
<title>leaf_177</title>
<polygon fill="none" stroke="#c0c0c0" points="13334,-2082.3836 12954,-2082.3836 12954,-1879.623 13334,-1879.623 13334,-2082.3836"/>
<text text-anchor="middle" x="13144" y="-2067.2434" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="13144" y="-2051.8434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13144" y="-2036.4434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13144" y="-2021.0433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13144" y="-2005.6433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="13144" y="-1986.8833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="13144" y="-1968.1233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="13144" y="-1952.7233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13144" y="-1937.3232" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="13144" y="-1918.5632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13144" y="-1903.1632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="13144" y="-1887.7632" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_170&#45;&gt;leaf_177 -->
<g id="edge177" class="edge">
<title>codeblock_170&#45;&gt;leaf_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13144,-2354.0247C13144,-2308.3399 13144,-2185.3324 13144,-2092.9694"/>
<polygon fill="#000000" stroke="#000000" points="13147.5001,-2092.717 13144,-2082.717 13140.5001,-2092.717 13147.5001,-2092.717"/>
</g>
<!-- header_178 -->
<g id="node179" class="node">
<title>header_178</title>
<ellipse fill="none" stroke="#000000" cx="13434" cy="-1981.0033" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="13434" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_171&#45;&gt;header_178 -->
<g id="edge178" class="edge">
<title>section_171&#45;&gt;header_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13559.9392,-2354.0125C13551.5705,-2332.4063 13537.3323,-2295.1257 13526,-2262.8038 13493.5819,-2170.3413 13458.4992,-2059.5497 13442.6446,-2008.8294"/>
<polygon fill="#000000" stroke="#000000" points="13445.9684,-2007.7311 13439.6487,-1999.2275 13439.2861,-2009.8161 13445.9684,-2007.7311"/>
</g>
<!-- prose_179 -->
<g id="node180" class="node">
<title>prose_179</title>
<ellipse fill="none" stroke="#000000" cx="13567" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13567" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_179 -->
<g id="edge179" class="edge">
<title>section_171&#45;&gt;prose_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13567,-2354.0247C13567,-2291.7381 13567,-2085.7201 13567,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="13570.5001,-2009.3418 13567,-1999.3418 13563.5001,-2009.3418 13570.5001,-2009.3418"/>
</g>
<!-- prose_180 -->
<g id="node181" class="node">
<title>prose_180</title>
<ellipse fill="none" stroke="#000000" cx="13649" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="13649" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_171&#45;&gt;prose_180 -->
<g id="edge180" class="edge">
<title>section_171&#45;&gt;prose_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13575.1977,-2353.9268C13584.5135,-2332.5462 13599.5211,-2295.7795 13608,-2262.8038 13631.3987,-2171.8031 13642.6525,-2060.6034 13646.8978,-2009.3522"/>
<polygon fill="#000000" stroke="#000000" points="13650.4116,-2009.3179 13647.7211,-1999.0704 13643.434,-2008.7591 13650.4116,-2009.3179"/>
</g>
<!-- codeblock_181 -->
<g id="node182" class="node">
<title>codeblock_181</title>
<ellipse fill="none" stroke="#000000" cx="13838" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="13838" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 461&#45;485</text>
</g>
<!-- section_171&#45;&gt;codeblock_181 -->
<g id="edge181" class="edge">
<title>section_171&#45;&gt;codeblock_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13591.0824,-2354.9232C13617.7349,-2335.0212 13660.7773,-2300.1511 13690,-2262.8038 13755.7428,-2178.7828 13806.4979,-2061.2236 13827.4818,-2008.4946"/>
<polygon fill="#000000" stroke="#000000" points="13830.7604,-2009.7209 13831.164,-1999.1337 13824.2463,-2007.1584 13830.7604,-2009.7209"/>
</g>
<!-- header_194 -->
<g id="node195" class="node">
<title>header_194</title>
<ellipse fill="none" stroke="#000000" cx="14200" cy="-1981.0033" rx="111.1981" ry="18"/>
<text text-anchor="middle" x="14200" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:index(cursor)</text>
</g>
<!-- section_172&#45;&gt;header_194 -->
<g id="edge194" class="edge">
<title>section_172&#45;&gt;header_194</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14277.2557,-2354.0247C14264.3556,-2291.7381 14221.6877,-2085.7201 14205.9222,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="14209.2534,-2008.4242 14203.7981,-1999.3418 14202.3989,-2009.8438 14209.2534,-2008.4242"/>
</g>
<!-- prose_195 -->
<g id="node196" class="node">
<title>prose_195</title>
<ellipse fill="none" stroke="#000000" cx="14362" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="14362" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_172&#45;&gt;prose_195 -->
<g id="edge195" class="edge">
<title>section_172&#45;&gt;prose_195</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14288.7425,-2353.8767C14297.552,-2332.449 14311.7787,-2295.638 14320,-2262.8038 14342.8337,-2171.6102 14354.9126,-2060.504 14359.6204,-2009.3137"/>
<polygon fill="#000000" stroke="#000000" points="14363.134,-2009.3168 14360.539,-1999.0447 14356.1619,-2008.6931 14363.134,-2009.3168"/>
</g>
<!-- codeblock_196 -->
<g id="node197" class="node">
<title>codeblock_196</title>
<ellipse fill="none" stroke="#000000" cx="14548" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14548" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 492&#45;505</text>
</g>
<!-- section_172&#45;&gt;codeblock_196 -->
<g id="edge196" class="edge">
<title>section_172&#45;&gt;codeblock_196</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14304.9336,-2354.9272C14331.4114,-2335.0288 14374.1416,-2300.1619 14403,-2262.8038 14467.9356,-2178.7427 14517.3948,-2061.2039 14537.7903,-2008.4873"/>
<polygon fill="#000000" stroke="#000000" points="14541.0663,-2009.7193 14541.3679,-1999.1288 14534.5278,-2007.2197 14541.0663,-2009.7193"/>
</g>
<!-- header_201 -->
<g id="node202" class="node">
<title>header_201</title>
<ellipse fill="none" stroke="#000000" cx="14970" cy="-1981.0033" rx="184.6938" ry="18"/>
<text text-anchor="middle" x="14970" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append(txtbuf, results, success)</text>
</g>
<!-- section_173&#45;&gt;header_201 -->
<g id="edge201" class="edge">
<title>section_173&#45;&gt;header_201</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15264.1908,-2354.6215C15238.3055,-2334.176 15195.5866,-2298.5564 15164,-2262.8038 15087.948,-2176.7214 15016.0899,-2059.8825 14985.4896,-2007.8798"/>
<polygon fill="#000000" stroke="#000000" points="14988.5026,-2006.0988 14980.432,-1999.2348 14982.4607,-2009.6336 14988.5026,-2006.0988"/>
</g>
<!-- prose_202 -->
<g id="node203" class="node">
<title>prose_202</title>
<ellipse fill="none" stroke="#000000" cx="15205" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15205" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_173&#45;&gt;prose_202 -->
<g id="edge202" class="edge">
<title>section_173&#45;&gt;prose_202</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15278.8023,-2353.9268C15269.4865,-2332.5462 15254.4789,-2295.7795 15246,-2262.8038 15222.6013,-2171.8031 15211.3475,-2060.6034 15207.1022,-2009.3522"/>
<polygon fill="#000000" stroke="#000000" points="15210.566,-2008.7591 15206.2789,-1999.0704 15203.5884,-2009.3179 15210.566,-2008.7591"/>
</g>
<!-- prose_203 -->
<g id="node204" class="node">
<title>prose_203</title>
<ellipse fill="none" stroke="#000000" cx="15287" cy="-1981.0033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="15287" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_173&#45;&gt;prose_203 -->
<g id="edge203" class="edge">
<title>section_173&#45;&gt;prose_203</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15287,-2354.0247C15287,-2291.7381 15287,-2085.7201 15287,-2009.5979"/>
<polygon fill="#000000" stroke="#000000" points="15290.5001,-2009.3418 15287,-1999.3418 15283.5001,-2009.3418 15290.5001,-2009.3418"/>
</g>
<!-- codeblock_204 -->
<g id="node205" class="node">
<title>codeblock_204</title>
<ellipse fill="none" stroke="#000000" cx="15476" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15476" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 513&#45;527</text>
</g>
<!-- section_173&#45;&gt;codeblock_204 -->
<g id="edge204" class="edge">
<title>section_173&#45;&gt;codeblock_204</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15295.7368,-2354.0247C15325.9603,-2291.4828 15426.2127,-2084.029 15462.6307,-2008.6685"/>
<polygon fill="#000000" stroke="#000000" points="15465.9381,-2009.8685 15467.1379,-1999.3418 15459.6354,-2006.8227 15465.9381,-2009.8685"/>
</g>
<!-- codeblock_205 -->
<g id="node206" class="node">
<title>codeblock_205</title>
<ellipse fill="none" stroke="#000000" cx="15761" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15761" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 529&#45;536</text>
</g>
<!-- section_173&#45;&gt;codeblock_205 -->
<g id="edge205" class="edge">
<title>section_173&#45;&gt;codeblock_205</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15345.4864,-2360.6969C15407.0894,-2346.3317 15504.3582,-2316.7369 15572,-2262.8038 15662.3774,-2190.7429 15725.2457,-2063.5932 15749.6794,-2008.1387"/>
<polygon fill="#000000" stroke="#000000" points="15752.8953,-2009.5198 15753.6624,-1998.9528 15746.473,-2006.735 15752.8953,-2009.5198"/>
</g>
<!-- codeblock_206 -->
<g id="node207" class="node">
<title>codeblock_206</title>
<ellipse fill="none" stroke="#000000" cx="16051" cy="-1981.0033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="16051" y="-1976.8033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 538&#45;540</text>
</g>
<!-- section_173&#45;&gt;codeblock_206 -->
<g id="edge206" class="edge">
<title>section_173&#45;&gt;codeblock_206</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15357.2232,-2365.3284C15490.7607,-2351.3736 15775.2795,-2316.1888 15857,-2262.8038 15955.041,-2198.7572 16017.1383,-2066.2125 16040.5038,-2008.6688"/>
<polygon fill="#000000" stroke="#000000" points="16043.8478,-2009.7314 16044.2929,-1999.1459 16037.3437,-2007.1434 16043.8478,-2009.7314"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="13016,-902.7014 12962,-902.7014 12962,-866.7014 13016,-866.7014 13016,-902.7014"/>
</g>
<!-- raw_175&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>raw_175&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12910.7429,-1962.7841C12915.1706,-1917.8261 12927.736,-1798.0757 12945,-1699.2027 12947.8192,-1683.0567 12950.8356,-1679.4495 12953,-1663.2027 12991.7871,-1372.0504 12990.6789,-1014.8637 12989.446,-913.0102"/>
<polygon fill="#000000" stroke="#000000" points="12992.9444,-912.8619 12989.3126,-902.909 12985.945,-912.9544 12992.9444,-912.8619"/>
</g>
<!-- leaf_182 -->
<g id="node183" class="node">
<title>leaf_182</title>
<polygon fill="none" stroke="#c0c0c0" points="13269,-902.7014 13113,-902.7014 13113,-866.7014 13269,-866.7014 13269,-902.7014"/>
<text text-anchor="middle" x="13191" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_178&#45;&gt;leaf_182 -->
<g id="edge182" class="edge">
<title>header_178&#45;&gt;leaf_182</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13432.6764,-1962.6638C13428.3025,-1914.2602 13410.4693,-1781.1708 13343,-1699.2027 13322.0128,-1673.7056 13296.3223,-1690.6775 13278,-1663.2027 13112.5877,-1415.1626 13166.6738,-1021.0527 13185.6287,-912.931"/>
<polygon fill="#000000" stroke="#000000" points="13189.1216,-913.2823 13187.447,-902.8206 13182.2321,-912.0432 13189.1216,-913.2823"/>
</g>
<!-- raw_183 -->
<g id="node184" class="node">
<title>raw_183</title>
<ellipse fill="none" stroke="#000000" cx="13314" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13314" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_183 -->
<g id="edge183" class="edge">
<title>prose_179&#45;&gt;raw_183</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13570.5834,-1962.878C13579.2487,-1913.2556 13595.7256,-1773.9241 13525,-1699.2027 13470.4143,-1641.5331 13401.5826,-1723.5734 13350,-1663.2027 13251.5735,-1548.0074 13297.8163,-1038.4869 13310.9277,-912.799"/>
<polygon fill="#000000" stroke="#000000" points="13314.4132,-913.1195 13311.9853,-902.8067 13307.4521,-912.3827 13314.4132,-913.1195"/>
</g>
<!-- prespace_184 -->
<g id="node185" class="node">
<title>prespace_184</title>
<ellipse fill="none" stroke="#000000" cx="13405" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="13405" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_179&#45;&gt;prespace_184 -->
<g id="edge184" class="edge">
<title>prose_179&#45;&gt;prespace_184</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13569.3954,-1962.905C13574.7355,-1915.0919 13582.9422,-1783.3215 13525,-1699.2027 13506.487,-1672.3261 13478.4766,-1690.7646 13461,-1663.2027 13301.9237,-1412.3288 13374.2268,-1020.2385 13398.2853,-912.7555"/>
<polygon fill="#000000" stroke="#000000" points="13401.7661,-913.2343 13400.582,-902.7058 13394.942,-911.6747 13401.7661,-913.2343"/>
</g>
<!-- literal_185 -->
<g id="node186" class="node">
<title>literal_185</title>
<ellipse fill="none" stroke="#000000" cx="13501" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="13501" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_179&#45;&gt;literal_185 -->
<g id="edge185" class="edge">
<title>prose_179&#45;&gt;literal_185</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13565.3115,-1962.7462C13560.8543,-1914.0956 13548.5944,-1777.2646 13541,-1663.2027 13521.4818,-1370.0538 13506.3021,-1014.2568 13502.1386,-912.8719"/>
<polygon fill="#000000" stroke="#000000" points="13505.6332,-912.6667 13501.7277,-902.818 13498.6391,-912.9526 13505.6332,-912.6667"/>
</g>
<!-- raw_186 -->
<g id="node187" class="node">
<title>raw_186</title>
<ellipse fill="none" stroke="#000000" cx="13577" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13577" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_179&#45;&gt;raw_186 -->
<g id="edge186" class="edge">
<title>prose_179&#45;&gt;raw_186</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13567.1652,-1962.8896C13568.3295,-1835.2449 13575.2953,-1071.5906 13576.7384,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="13580.2411,-913.0849 13576.8326,-903.0533 13573.2414,-913.021 13580.2411,-913.0849"/>
</g>
<!-- raw_191 -->
<g id="node192" class="node">
<title>raw_191</title>
<ellipse fill="none" stroke="#000000" cx="13649" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="13649" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_180&#45;&gt;raw_191 -->
<g id="edge191" class="edge">
<title>prose_180&#45;&gt;raw_191</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13649,-1962.8896C13649,-1835.2449 13649,-1071.5906 13649,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="13652.5001,-913.0533 13649,-903.0533 13645.5001,-913.0534 13652.5001,-913.0533"/>
</g>
<!-- leaf_193 -->
<g id="node194" class="node">
<title>leaf_193</title>
<polygon fill="none" stroke="#c0c0c0" points="14082.4016,-1072.3422 13693.5984,-1072.3422 13693.5984,-697.0606 14082.4016,-697.0606 14082.4016,-1072.3422"/>
<text text-anchor="middle" x="13888" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="13888" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="13888" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="13888" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13888" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="13888" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13888" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13888" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="13888" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="13888" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="13888" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="13888" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="13888" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="13888" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="13888" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="13888" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="13888" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="13888" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="13888" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="13888" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_181&#45;&gt;leaf_193 -->
<g id="edge193" class="edge">
<title>codeblock_181&#45;&gt;leaf_193</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13838.8261,-1962.8896C13843.4181,-1862.2051 13866.0579,-1365.8052 13878.9579,-1082.9598"/>
<polygon fill="#000000" stroke="#000000" points="13882.4723,-1082.7218 13879.4316,-1072.5727 13875.4795,-1082.4028 13882.4723,-1082.7218"/>
</g>
<!-- leaf_187 -->
<g id="node188" class="node">
<title>leaf_187</title>
<polygon fill="none" stroke="#c0c0c0" points="13355.5,-63.0015 12884.5,-63.0015 12884.5,-7.1986 13355.5,-7.1986 13355.5,-63.0015"/>
<text text-anchor="middle" x="13120" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_183&#45;&gt;leaf_187 -->
<g id="edge187" class="edge">
<title>raw_183&#45;&gt;leaf_187</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13315.6387,-866.5663C13324.7397,-761.8793 13365.5753,-235.0153 13278,-106.2001 13266.9829,-89.995 13251.3415,-77.4332 13234.1428,-67.7099"/>
<polygon fill="#000000" stroke="#000000" points="13235.4984,-64.4674 13225.0232,-62.8797 13232.222,-70.6533 13235.4984,-64.4674"/>
</g>
<!-- leaf_188 -->
<g id="node189" class="node">
<title>leaf_188</title>
<polygon fill="none" stroke="#c0c0c0" points="13428,-53.1 13374,-53.1 13374,-17.1 13428,-17.1 13428,-53.1"/>
</g>
<!-- prespace_184&#45;&gt;leaf_188 -->
<g id="edge188" class="edge">
<title>prespace_184&#45;&gt;leaf_188</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13404.9146,-866.5632C13404.4047,-758.2631 13401.7633,-197.2221 13401.1345,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13404.6334,-63.4127 13401.0863,-53.4293 13397.6335,-63.4457 13404.6334,-63.4127"/>
</g>
<!-- leaf_189 -->
<g id="node190" class="node">
<title>leaf_189</title>
<polygon fill="none" stroke="#c0c0c0" points="13546,-53.1 13446,-53.1 13446,-17.1 13546,-17.1 13546,-53.1"/>
<text text-anchor="middle" x="13496" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_185&#45;&gt;leaf_189 -->
<g id="edge189" class="edge">
<title>literal_185&#45;&gt;leaf_189</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13500.8933,-866.5632C13500.2559,-758.2631 13496.9541,-197.2221 13496.1681,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="13499.6668,-63.4085 13496.1079,-53.4293 13492.6669,-63.4497 13499.6668,-63.4085"/>
</g>
<!-- leaf_190 -->
<g id="node191" class="node">
<title>leaf_190</title>
<polygon fill="none" stroke="#c0c0c0" points="13804,-53.1 13564,-53.1 13564,-17.1 13804,-17.1 13804,-53.1"/>
<text text-anchor="middle" x="13684" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_186&#45;&gt;leaf_190 -->
<g id="edge190" class="edge">
<title>raw_186&#45;&gt;leaf_190</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13576.0953,-866.6473C13571.1851,-763.5154 13550.2009,-248.5602 13613,-106.2001 13621.0197,-88.0201 13635.9591,-71.9421 13650.0727,-59.6949"/>
<polygon fill="#000000" stroke="#000000" points="13652.3216,-62.3768 13657.7795,-53.2959 13647.85,-56.9913 13652.3216,-62.3768"/>
</g>
<!-- leaf_192 -->
<g id="node193" class="node">
<title>leaf_192</title>
<polygon fill="none" stroke="#c0c0c0" points="14209.5,-55.0021 13822.5,-55.0021 13822.5,-15.198 14209.5,-15.198 14209.5,-55.0021"/>
<text text-anchor="middle" x="14016" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_191&#45;&gt;leaf_192 -->
<g id="edge192" class="edge">
<title>raw_191&#45;&gt;leaf_192</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13647.0006,-866.6093C13635.7377,-761.0392 13584.2217,-225.1927 13685,-106.2001 13692.1927,-97.7074 13806.7674,-74.3708 13899.1254,-56.7308"/>
<polygon fill="#000000" stroke="#000000" points="13899.9578,-60.1353 13909.1264,-54.8262 13898.6482,-53.2588 13899.9578,-60.1353"/>
</g>
<!-- leaf_197 -->
<g id="node198" class="node">
<title>leaf_197</title>
<polygon fill="none" stroke="#c0c0c0" points="14305.5,-902.7014 14100.5,-902.7014 14100.5,-866.7014 14305.5,-866.7014 14305.5,-902.7014"/>
<text text-anchor="middle" x="14203" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:index(cursor)</text>
</g>
<!-- header_194&#45;&gt;leaf_197 -->
<g id="edge197" class="edge">
<title>header_194&#45;&gt;leaf_197</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14200.0496,-1962.8896C14200.3989,-1835.2449 14202.4886,-1071.5906 14202.9215,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="14206.4223,-913.0629 14202.9498,-903.0533 14199.4223,-913.0437 14206.4223,-913.0629"/>
</g>
<!-- raw_198 -->
<g id="node199" class="node">
<title>raw_198</title>
<ellipse fill="none" stroke="#000000" cx="14358" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="14358" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_195&#45;&gt;raw_198 -->
<g id="edge198" class="edge">
<title>prose_195&#45;&gt;raw_198</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14361.9339,-1962.8896C14361.4682,-1835.2449 14358.6819,-1071.5906 14358.1046,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="14361.6035,-913.0405 14358.067,-903.0533 14354.6036,-913.0661 14361.6035,-913.0405"/>
</g>
<!-- leaf_200 -->
<g id="node201" class="node">
<title>leaf_200</title>
<polygon fill="none" stroke="#c0c0c0" points="14783,-981.0019 14403,-981.0019 14403,-788.4009 14783,-788.4009 14783,-981.0019"/>
<text text-anchor="middle" x="14593" y="-965.9016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.index(historian, cursor)</text>
<text text-anchor="middle" x="14593" y="-950.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if cursor &lt; 0 or cursor &gt; #historian + 1 then</text>
<text text-anchor="middle" x="14593" y="-935.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="14593" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="14593" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[cursor]</text>
<text text-anchor="middle" x="14593" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="14593" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf = txtbuf:clone()</text>
<text text-anchor="middle" x="14593" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = cursor</text>
<text text-anchor="middle" x="14593" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="14593" y="-827.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="14593" y="-811.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf, result</text>
<text text-anchor="middle" x="14593" y="-796.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_196&#45;&gt;leaf_200 -->
<g id="edge200" class="edge">
<title>codeblock_196&#45;&gt;leaf_200</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14548.7435,-1962.8896C14553.3732,-1850.1007 14578.386,-1240.7306 14588.6258,-991.2662"/>
<polygon fill="#000000" stroke="#000000" points="14592.1299,-991.2373 14589.043,-981.1022 14585.1358,-990.9502 14592.1299,-991.2373"/>
</g>
<!-- leaf_199 -->
<g id="node200" class="node">
<title>leaf_199</title>
<polygon fill="none" stroke="#c0c0c0" points="14496,-63.0015 14228,-63.0015 14228,-7.1986 14496,-7.1986 14496,-63.0015"/>
<text text-anchor="middle" x="14362" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Loads the history to an exact index.</text>
</g>
<!-- raw_198&#45;&gt;leaf_199 -->
<g id="edge199" class="edge">
<title>raw_198&#45;&gt;leaf_199</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14358.0854,-866.5632C14358.5841,-760.6464 14361.1215,-221.6953 14361.8211,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="14365.3211,-73.0922 14361.8683,-63.0758 14358.3211,-73.0592 14365.3211,-73.0922"/>
</g>
<!-- leaf_207 -->
<g id="node208" class="node">
<title>leaf_207</title>
<polygon fill="none" stroke="#c0c0c0" points="15139,-902.7014 14801,-902.7014 14801,-866.7014 15139,-866.7014 15139,-902.7014"/>
<text text-anchor="middle" x="14970" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append(txtbuf, results, success)</text>
</g>
<!-- header_201&#45;&gt;leaf_207 -->
<g id="edge207" class="edge">
<title>header_201&#45;&gt;leaf_207</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14970,-1962.8896C14970,-1835.2449 14970,-1071.5906 14970,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="14973.5001,-913.0533 14970,-903.0533 14966.5001,-913.0534 14973.5001,-913.0533"/>
</g>
<!-- raw_208 -->
<g id="node209" class="node">
<title>raw_208</title>
<ellipse fill="none" stroke="#000000" cx="15184" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15184" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_202&#45;&gt;raw_208 -->
<g id="edge208" class="edge">
<title>prose_202&#45;&gt;raw_208</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15204.653,-1962.8896C15202.208,-1835.2449 15187.5799,-1071.5906 15184.5494,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="15188.0425,-912.9844 15184.3515,-903.0533 15181.0438,-913.1186 15188.0425,-912.9844"/>
</g>
<!-- raw_210 -->
<g id="node211" class="node">
<title>raw_210</title>
<ellipse fill="none" stroke="#000000" cx="15256" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="15256" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_203&#45;&gt;raw_210 -->
<g id="edge210" class="edge">
<title>prose_203&#45;&gt;raw_210</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15286.4878,-1962.8896C15282.8784,-1835.2449 15261.2846,-1071.5906 15256.811,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="15260.3003,-912.9504 15256.5189,-903.0533 15253.3031,-913.1483 15260.3003,-912.9504"/>
</g>
<!-- leaf_212 -->
<g id="node213" class="node">
<title>leaf_212</title>
<polygon fill="none" stroke="#c0c0c0" points="15751,-988.9019 15301,-988.9019 15301,-780.5009 15751,-780.5009 15751,-988.9019"/>
<text text-anchor="middle" x="15526" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="15526" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="15526" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="15526" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="15526" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15526" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="15526" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="15526" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="15526" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="15526" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="15526" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="15526" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="15526" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_204&#45;&gt;leaf_212 -->
<g id="edge212" class="edge">
<title>codeblock_204&#45;&gt;leaf_212</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15476.8261,-1962.8896C15481.9163,-1851.2812 15509.183,-1253.4315 15520.7772,-999.2161"/>
<polygon fill="#000000" stroke="#000000" points="15524.2741,-999.3625 15521.2334,-989.2134 15517.2814,-999.0435 15524.2741,-999.3625"/>
</g>
<!-- leaf_213 -->
<g id="node214" class="node">
<title>leaf_213</title>
<polygon fill="none" stroke="#c0c0c0" points="16037,-935.1024 15769,-935.1024 15769,-834.3004 16037,-834.3004 16037,-935.1024"/>
<text text-anchor="middle" x="15903" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="15903" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="15903" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="15903" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="15903" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15903" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_205&#45;&gt;leaf_213 -->
<g id="edge213" class="edge">
<title>codeblock_205&#45;&gt;leaf_213</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15763.3462,-1962.8896C15778.958,-1842.3593 15868.0227,-1154.7415 15895.1557,-945.2627"/>
<polygon fill="#000000" stroke="#000000" points="15898.6627,-945.4342 15896.4763,-935.0674 15891.7207,-944.535 15898.6627,-945.4342"/>
</g>
<!-- leaf_214 -->
<g id="node215" class="node">
<title>leaf_214</title>
<polygon fill="none" stroke="#c0c0c0" points="16141,-902.7014 16055,-902.7014 16055,-866.7014 16141,-866.7014 16141,-902.7014"/>
<text text-anchor="middle" x="16098" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_206&#45;&gt;leaf_214 -->
<g id="edge214" class="edge">
<title>codeblock_206&#45;&gt;leaf_214</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M16051.7766,-1962.8896C16057.2489,-1835.2449 16089.9878,-1071.5906 16096.7705,-913.3811"/>
<polygon fill="#000000" stroke="#000000" points="16100.2816,-913.1941 16097.2132,-903.0533 16093.288,-912.8942 16100.2816,-913.1941"/>
</g>
<!-- leaf_209 -->
<g id="node210" class="node">
<title>leaf_209</title>
<polygon fill="none" stroke="#c0c0c0" points="15242,-63.0015 14918,-63.0015 14918,-7.1986 15242,-7.1986 15242,-63.0015"/>
<text text-anchor="middle" x="15080" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_208&#45;&gt;leaf_209 -->
<g id="edge209" class="edge">
<title>raw_208&#45;&gt;leaf_209</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15187.5926,-866.7142C15204.2729,-778.8103 15268.3882,-387.2839 15148,-106.2001 15142.3182,-92.9341 15132.9795,-80.6799 15123.0169,-70.2146"/>
<polygon fill="#000000" stroke="#000000" points="15125.2505,-67.4994 15115.6956,-62.9216 15120.3103,-72.4587 15125.2505,-67.4994"/>
</g>
<!-- leaf_211 -->
<g id="node212" class="node">
<title>leaf_211</title>
<polygon fill="none" stroke="#c0c0c0" points="15458,-55.0021 15260,-55.0021 15260,-15.198 15458,-15.198 15458,-55.0021"/>
<text text-anchor="middle" x="15359" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_210&#45;&gt;leaf_211 -->
<g id="edge211" class="edge">
<title>raw_210&#45;&gt;leaf_211</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15252.4503,-866.7324C15235.971,-778.9142 15172.6522,-387.7273 15292,-106.2001 15299.194,-89.2303 15312.3537,-73.8557 15325.1178,-61.7798"/>
<polygon fill="#000000" stroke="#000000" points="15327.4731,-64.3688 15332.5394,-55.0638 15322.7762,-59.1785 15327.4731,-64.3688"/>
</g>
</g>
</svg>
