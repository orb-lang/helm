<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="7265pt" height="1260pt"
 viewBox="0.00 0.00 7265.30 1259.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1255.6017)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1255.6017 7261.2972,-1255.6017 7261.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1728" cy="-1233.6017" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1728" y="-1229.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 209</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1728" cy="-1161.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1728" y="-1157.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;147</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1728,-1215.433C1728,-1207.7326 1728,-1198.576 1728,-1190.0183"/>
<polygon fill="#000000" stroke="#000000" points="1731.5001,-1190.0149 1728,-1180.015 1724.5001,-1190.015 1731.5001,-1190.0149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1305" cy="-1089.6017" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1305" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1667.7149,-1154.2444C1597.1794,-1145.2061 1477.0436,-1128.4723 1375,-1107.6017 1369.6215,-1106.5016 1364.037,-1105.2519 1358.4738,-1103.9357"/>
<polygon fill="#000000" stroke="#000000" points="1359.0769,-1100.4803 1348.5325,-1101.5128 1357.4193,-1107.2812 1359.0769,-1100.4803"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1416" cy="-1089.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1416" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1669.191,-1153.4452C1613.8997,-1144.9347 1529.2172,-1129.721 1458,-1107.6017 1455.5472,-1106.8399 1453.0431,-1105.9829 1450.5399,-1105.0669"/>
<polygon fill="#000000" stroke="#000000" points="1451.5872,-1101.718 1440.9998,-1101.3188 1449.0274,-1108.2332 1451.5872,-1101.718"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1499" cy="-1089.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1499" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1679.4359,-1149.3469C1641.3795,-1139.3206 1587.3029,-1124.1376 1541,-1107.6017 1538.5813,-1106.7379 1536.1026,-1105.8047 1533.6178,-1104.8335"/>
<polygon fill="#000000" stroke="#000000" points="1534.6994,-1101.4949 1524.1178,-1100.9654 1532.0596,-1107.9781 1534.6994,-1101.4949"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1582" cy="-1089.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1582" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1695.9597,-1145.801C1672.0983,-1134.0337 1639.6044,-1118.0093 1615.4189,-1106.0823"/>
<polygon fill="#000000" stroke="#000000" points="1616.7832,-1102.8526 1606.2664,-1101.5687 1613.6871,-1109.1307 1616.7832,-1102.8526"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1664" cy="-1089.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1664" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1712.1798,-1143.8039C1704.1184,-1134.7348 1694.1979,-1123.5743 1685.4584,-1113.7424"/>
<polygon fill="#000000" stroke="#000000" points="1688.0204,-1111.3563 1678.7607,-1106.2075 1682.7885,-1116.0069 1688.0204,-1111.3563"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1792" cy="-1089.6017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1792" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;21</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1743.8202,-1143.8039C1751.5126,-1135.15 1760.8978,-1124.5917 1769.3344,-1115.1005"/>
<polygon fill="#000000" stroke="#000000" points="1772.1122,-1117.2436 1776.14,-1107.4442 1766.8803,-1112.5931 1772.1122,-1117.2436"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2009" cy="-1089.6017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2009" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 23&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1775.9863,-1149.3063C1823.2571,-1137.1942 1895.679,-1118.6377 1947.2255,-1105.43"/>
<polygon fill="#000000" stroke="#000000" points="1948.1011,-1108.8188 1956.9194,-1102.9462 1946.3636,-1102.0379 1948.1011,-1108.8188"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2316" cy="-1089.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2316" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 28&#45;72</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1788.163,-1154.2348C1897.6924,-1140.823 2129.0742,-1112.4906 2245.6839,-1098.2118"/>
<polygon fill="#000000" stroke="#000000" points="2246.4215,-1101.6477 2255.922,-1096.9582 2245.5707,-1094.6996 2246.4215,-1101.6477"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="3485" cy="-1089.6017" rx="70.655" ry="18"/>
<text text-anchor="middle" x="3485" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 73&#45;147</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1793.1421,-1158.9322C2064.7366,-1147.8026 3106.6513,-1105.106 3404.8409,-1092.8865"/>
<polygon fill="#000000" stroke="#000000" points="3405.284,-1096.3714 3415.1322,-1092.4648 3404.9973,-1089.3773 3405.284,-1096.3714"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="5120" cy="-1089.6017" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5120" y="-1085.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 148&#45;186</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1793.4812,-1160.2118C2216.0383,-1151.2424 4555.5599,-1101.5827 5034.3768,-1091.4192"/>
<polygon fill="#000000" stroke="#000000" points="5034.7464,-1094.9122 5044.6699,-1091.2007 5034.5978,-1087.9138 5034.7464,-1094.9122"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1350.5,-1018.8016 1257.5,-1018.8016 1257.5,-982.8016 1350.5,-982.8016 1350.5,-1018.8016"/>
<text text-anchor="middle" x="1304" y="-997.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1304.7928,-1071.2023C1304.6565,-1059.0965 1304.4753,-1043.0093 1304.3206,-1029.269"/>
<polygon fill="#000000" stroke="#000000" points="1307.816,-1028.8336 1304.2035,-1018.8737 1300.8164,-1028.9125 1307.816,-1028.8336"/>
</g>
<!-- raw_13 -->
<g id="node14" class="node">
<title>raw_13</title>
<ellipse fill="none" stroke="#000000" cx="1396" cy="-1000.8016" rx="27" ry="18"/>
<text text-anchor="middle" x="1396" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;raw_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1411.9527,-1071.6317C1409.1876,-1059.3547 1405.4678,-1042.8389 1402.3158,-1028.8437"/>
<polygon fill="#000000" stroke="#000000" points="1405.653,-1027.7315 1400.0413,-1018.7449 1398.8241,-1029.2696 1405.653,-1027.7315"/>
</g>
<!-- raw_15 -->
<g id="node16" class="node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="1468" cy="-1000.8016" rx="27" ry="18"/>
<text text-anchor="middle" x="1468" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_4&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1492.7267,-1071.6317C1488.3703,-1059.1528 1482.4851,-1042.2944 1477.5491,-1028.1553"/>
<polygon fill="#000000" stroke="#000000" points="1480.7586,-1026.7295 1474.1582,-1018.4419 1474.1497,-1029.0367 1480.7586,-1026.7295"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="1540" cy="-1000.8016" rx="27" ry="18"/>
<text text-anchor="middle" x="1540" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_5&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1573.7022,-1072.0577C1567.6807,-1059.3266 1559.4275,-1041.8769 1552.5955,-1027.4322"/>
<polygon fill="#000000" stroke="#000000" points="1555.5773,-1025.5504 1548.1377,-1018.0071 1549.2494,-1028.5434 1555.5773,-1025.5504"/>
</g>
<!-- raw_19 -->
<g id="node20" class="node">
<title>raw_19</title>
<ellipse fill="none" stroke="#000000" cx="1612" cy="-1000.8016" rx="27" ry="18"/>
<text text-anchor="middle" x="1612" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;raw_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1653.9739,-1072.4801C1646.2996,-1059.3748 1635.5939,-1041.0928 1626.9154,-1026.2725"/>
<polygon fill="#000000" stroke="#000000" points="1629.8925,-1024.4302 1621.819,-1017.5695 1623.852,-1027.9674 1629.8925,-1024.4302"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1939,-1035.4029 1657,-1035.4029 1657,-966.2004 1939,-966.2004 1939,-1035.4029"/>
<text text-anchor="middle" x="1798" y="-1020.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">local Linebuf = require &quot;linebuf&quot;</text>
<text text-anchor="middle" x="1798" y="-1005.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1798" y="-989.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1798" y="-974.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1793.2432,-1071.2023C1793.747,-1063.7464 1794.3528,-1054.7803 1794.9608,-1045.7823"/>
<polygon fill="#000000" stroke="#000000" points="1798.4606,-1045.9019 1795.6428,-1035.6887 1791.4765,-1045.4299 1798.4606,-1045.9019"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2148.5,-1018.8016 1957.5,-1018.8016 1957.5,-982.8016 2148.5,-982.8016 2148.5,-1018.8016"/>
<text text-anchor="middle" x="2053" y="-997.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_8&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2017.9041,-1071.6317C2024.0657,-1059.1963 2032.3822,-1042.412 2039.373,-1028.3034"/>
<polygon fill="#000000" stroke="#000000" points="2042.6544,-1029.564 2043.9582,-1019.0497 2036.3822,-1026.4561 2042.6544,-1029.564"/>
</g>
<!-- header_23 -->
<g id="node24" class="node">
<title>header_23</title>
<ellipse fill="none" stroke="#000000" cx="2249" cy="-1000.8016" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2249" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:load()</text>
</g>
<!-- section_9&#45;&gt;header_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;header_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2302.4416,-1071.6317C2292.7244,-1058.7529 2279.4879,-1041.2095 2268.6194,-1026.8046"/>
<polygon fill="#000000" stroke="#000000" points="2271.3553,-1024.6196 2262.5383,-1018.7449 2265.7674,-1028.8357 2271.3553,-1024.6196"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="2382" cy="-1000.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2382" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2329.3561,-1071.6317C2339.1801,-1058.414 2352.6558,-1040.2829 2363.5137,-1025.674"/>
<polygon fill="#000000" stroke="#000000" points="2366.4006,-1027.6572 2369.5568,-1017.5434 2360.7825,-1023.4815 2366.4006,-1027.6572"/>
</g>
<!-- codeblock_25 -->
<g id="node26" class="node">
<title>codeblock_25</title>
<ellipse fill="none" stroke="#000000" cx="2633" cy="-1000.8016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2633" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 33&#45;70</text>
</g>
<!-- section_9&#45;&gt;codeblock_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;codeblock_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2362.0945,-1076.6894C2417.9688,-1061.0375 2512.2393,-1034.6299 2573.5361,-1017.459"/>
<polygon fill="#000000" stroke="#000000" points="2574.7693,-1020.7484 2583.4545,-1014.6806 2572.881,-1014.0079 2574.7693,-1020.7484"/>
</g>
<!-- header_36 -->
<g id="node37" class="node">
<title>header_36</title>
<ellipse fill="none" stroke="#000000" cx="3187" cy="-1000.8016" rx="107.339" ry="18"/>
<text text-anchor="middle" x="3187" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_36 -->
<g id="edge36" class="edge">
<title>section_10&#45;&gt;header_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3439.0906,-1075.9213C3388.342,-1060.7989 3306.2985,-1036.351 3249.6633,-1019.4744"/>
<polygon fill="#000000" stroke="#000000" points="3250.332,-1016.0217 3239.7489,-1016.5201 3248.3329,-1022.7302 3250.332,-1016.0217"/>
</g>
<!-- prose_37 -->
<g id="node38" class="node">
<title>prose_37</title>
<ellipse fill="none" stroke="#000000" cx="3406" cy="-1000.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3406" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_37 -->
<g id="edge37" class="edge">
<title>section_10&#45;&gt;prose_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3469.0132,-1071.6317C3456.9921,-1058.1194 3440.403,-1039.4723 3427.2633,-1024.7027"/>
<polygon fill="#000000" stroke="#000000" points="3429.6311,-1022.0984 3420.3693,-1016.9534 3424.4011,-1026.7512 3429.6311,-1022.0984"/>
</g>
<!-- codeblock_38 -->
<g id="node39" class="node">
<title>codeblock_38</title>
<ellipse fill="none" stroke="#000000" cx="3564" cy="-1000.8016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3564" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 76&#45;91</text>
</g>
<!-- section_10&#45;&gt;codeblock_38 -->
<g id="edge38" class="edge">
<title>section_10&#45;&gt;codeblock_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3500.9868,-1071.6317C3512.6275,-1058.547 3528.5517,-1040.6474 3541.4792,-1026.1162"/>
<polygon fill="#000000" stroke="#000000" points="3544.2747,-1028.2396 3548.3066,-1018.4419 3539.0448,-1023.5868 3544.2747,-1028.2396"/>
</g>
<!-- codeblock_39 -->
<g id="node40" class="node">
<title>codeblock_39</title>
<ellipse fill="none" stroke="#000000" cx="3891" cy="-1000.8016" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="3891" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 93&#45;104</text>
</g>
<!-- section_10&#45;&gt;codeblock_39 -->
<g id="edge39" class="edge">
<title>section_10&#45;&gt;codeblock_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3538.9137,-1077.8097C3612.0372,-1061.8162 3742.6805,-1033.242 3822.6179,-1015.7581"/>
<polygon fill="#000000" stroke="#000000" points="3823.5667,-1019.1334 3832.5879,-1013.5775 3822.0709,-1012.2951 3823.5667,-1019.1334"/>
</g>
<!-- codeblock_40 -->
<g id="node41" class="node">
<title>codeblock_40</title>
<ellipse fill="none" stroke="#000000" cx="4368" cy="-1000.8016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4368" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 107&#45;145</text>
</g>
<!-- section_10&#45;&gt;codeblock_40 -->
<g id="edge40" class="edge">
<title>section_10&#45;&gt;codeblock_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3551.0074,-1082.9636C3707.7174,-1067.2038 4102.277,-1027.5244 4279.4544,-1009.7063"/>
<polygon fill="#000000" stroke="#000000" points="4279.9242,-1013.1768 4289.5237,-1008.6937 4279.2237,-1006.212 4279.9242,-1013.1768"/>
</g>
<!-- header_47 -->
<g id="node48" class="node">
<title>header_47</title>
<ellipse fill="none" stroke="#000000" cx="4844" cy="-1000.8016" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="4844" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_11&#45;&gt;header_47 -->
<g id="edge47" class="edge">
<title>section_11&#45;&gt;header_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5075.0416,-1075.1368C5027.3992,-1059.8083 4952.0634,-1035.5699 4900.4545,-1018.9653"/>
<polygon fill="#000000" stroke="#000000" points="4901.3769,-1015.5854 4890.7855,-1015.8543 4899.2329,-1022.249 4901.3769,-1015.5854"/>
</g>
<!-- prose_48 -->
<g id="node49" class="node">
<title>prose_48</title>
<ellipse fill="none" stroke="#000000" cx="5036" cy="-1000.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5036" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_48 -->
<g id="edge48" class="edge">
<title>section_11&#45;&gt;prose_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5103.0013,-1071.6317C5090.1011,-1057.9943 5072.2533,-1039.1266 5058.2219,-1024.2934"/>
<polygon fill="#000000" stroke="#000000" points="5060.6934,-1021.813 5051.2787,-1016.9534 5055.6081,-1026.6234 5060.6934,-1021.813"/>
</g>
<!-- codeblock_49 -->
<g id="node50" class="node">
<title>codeblock_49</title>
<ellipse fill="none" stroke="#000000" cx="5189" cy="-1000.8016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5189" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 150&#45;161</text>
</g>
<!-- section_11&#45;&gt;codeblock_49 -->
<g id="edge49" class="edge">
<title>section_11&#45;&gt;codeblock_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5133.9632,-1071.6317C5143.9703,-1058.7529 5157.602,-1041.2095 5168.795,-1026.8046"/>
<polygon fill="#000000" stroke="#000000" points="5171.6856,-1028.7888 5175.0576,-1018.7449 5166.1581,-1024.4938 5171.6856,-1028.7888"/>
</g>
<!-- section_50 -->
<g id="node51" class="node">
<title>section_50</title>
<ellipse fill="none" stroke="#000000" cx="5610" cy="-1000.8016" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5610" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 164&#45;186</text>
</g>
<!-- section_11&#45;&gt;section_50 -->
<g id="edge50" class="edge">
<title>section_11&#45;&gt;section_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5180.5751,-1078.624C5271.5824,-1062.1312 5443.174,-1031.0346 5539.6138,-1013.5573"/>
<polygon fill="#000000" stroke="#000000" points="5540.3477,-1016.9814 5549.5633,-1011.7542 5539.0994,-1010.0936 5540.3477,-1016.9814"/>
</g>
<!-- section_51 -->
<g id="node52" class="node">
<title>section_51</title>
<ellipse fill="none" stroke="#000000" cx="6602" cy="-1000.8016" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="6602" y="-996.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 187&#45;209</text>
</g>
<!-- section_11&#45;&gt;section_51 -->
<g id="edge51" class="edge">
<title>section_11&#45;&gt;section_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5193.2397,-1085.2132C5442.0588,-1070.3042 6254.0687,-1021.6493 6518.1739,-1005.8244"/>
<polygon fill="#000000" stroke="#000000" points="6518.6903,-1009.2998 6528.463,-1005.2079 6518.2715,-1002.3124 6518.6903,-1009.2998"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-676.4022 0,-676.4022 0,-604.5999 324,-604.5999 324,-676.4022"/>
<text text-anchor="middle" x="162" y="-613.001" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>raw_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1383.3776,-984.493C1376.9241,-977.4513 1368.442,-969.9372 1359,-966.0016 1253.7102,-922.1148 431.063,-988.2738 333,-930.0016 241.9516,-875.8976 194.0674,-753.0669 173.8975,-686.1041"/>
<polygon fill="#000000" stroke="#000000" points="177.1806,-684.8613 171.0083,-676.2501 170.4633,-686.8309 177.1806,-684.8613"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-667.8014 342.5,-667.8014 342.5,-613.2006 897.5,-613.2006 897.5,-667.8014"/>
<text text-anchor="middle" x="620" y="-636.701" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-621.301" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1455.7427,-984.6382C1449.4689,-977.6284 1441.2136,-970.0991 1432,-966.0016 1218.2988,-870.9635 1119.6777,-1027.3084 907,-930.0016 784.3762,-873.8972 685.2992,-740.935 642.6472,-676.6038"/>
<polygon fill="#000000" stroke="#000000" points="645.4154,-674.4425 637.0067,-667.997 639.5607,-678.2794 645.4154,-674.4425"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-667.8014 916,-667.8014 916,-613.2006 1464,-613.2006 1464,-667.8014"/>
<text text-anchor="middle" x="1190" y="-636.701" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-621.301" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1524.9609,-985.32C1472.7166,-931.538 1298.2427,-751.9293 1223.9564,-675.4568"/>
<polygon fill="#000000" stroke="#000000" points="1226.1445,-672.6861 1216.6662,-667.952 1221.1235,-677.5636 1226.1445,-672.6861"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-675.8014 1482,-675.8014 1482,-605.2007 2030,-605.2007 2030,-675.8014"/>
<text text-anchor="middle" x="1756" y="-644.701" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new linebuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-629.301" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>raw_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1619.141,-982.9343C1640.7908,-928.7644 1706.159,-765.2077 1738.0767,-685.3466"/>
<polygon fill="#000000" stroke="#000000" points="1741.3369,-686.6202 1741.7981,-676.0354 1734.8368,-684.0223 1741.3369,-686.6202"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2197.5,-658.501 2048.5,-658.501 2048.5,-622.501 2197.5,-622.501 2197.5,-658.501"/>
<text text-anchor="middle" x="2123" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:load()</text>
</g>
<!-- header_23&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>header_23&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2236.6157,-982.8477C2227.449,-968.9261 2215.1828,-948.8849 2207,-930.0016 2167.0924,-837.9076 2139.8346,-721.3183 2128.6711,-668.6239"/>
<polygon fill="#000000" stroke="#000000" points="2132.0634,-667.7458 2126.5942,-658.6717 2125.211,-669.1759 2132.0634,-667.7458"/>
</g>
<!-- raw_27 -->
<g id="node28" class="node">
<title>raw_27</title>
<ellipse fill="none" stroke="#000000" cx="2243" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="2243" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_27 -->
<g id="edge27" class="edge">
<title>prose_24&#45;&gt;raw_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2364.5083,-985.2524C2357.1502,-978.9939 2348.3676,-971.8815 2340,-966.0016 2314.2431,-947.902 2296.2699,-956.322 2279,-930.0016 2225.08,-847.8239 2232.2214,-723.8754 2238.8334,-668.7088"/>
<polygon fill="#000000" stroke="#000000" points="2242.3259,-668.9902 2240.1304,-658.6253 2235.3831,-668.097 2242.3259,-668.9902"/>
</g>
<!-- prespace_28 -->
<g id="node29" class="node">
<title>prespace_28</title>
<ellipse fill="none" stroke="#000000" cx="2334" cy="-640.501" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2334" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_24&#45;&gt;prespace_28 -->
<g id="edge28" class="edge">
<title>prose_24&#45;&gt;prespace_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2379.5537,-982.4389C2371.7217,-923.6502 2347.2268,-739.7851 2337.774,-668.8294"/>
<polygon fill="#000000" stroke="#000000" points="2341.2314,-668.2769 2336.4414,-658.8267 2334.2927,-669.2014 2341.2314,-668.2769"/>
</g>
<!-- literal_29 -->
<g id="node30" class="node">
<title>literal_29</title>
<ellipse fill="none" stroke="#000000" cx="2430" cy="-640.501" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2430" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_24&#45;&gt;literal_29 -->
<g id="edge29" class="edge">
<title>prose_24&#45;&gt;literal_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2384.4463,-982.4389C2392.2783,-923.6502 2416.7732,-739.7851 2426.226,-668.8294"/>
<polygon fill="#000000" stroke="#000000" points="2429.7073,-669.2014 2427.5586,-658.8267 2422.7686,-668.2769 2429.7073,-669.2014"/>
</g>
<!-- raw_30 -->
<g id="node31" class="node">
<title>raw_30</title>
<ellipse fill="none" stroke="#000000" cx="2506" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="2506" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_30 -->
<g id="edge30" class="edge">
<title>prose_24&#45;&gt;raw_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2405.7761,-988.6012C2426.439,-976.6413 2455.2979,-956.378 2470,-930.0016 2517.6385,-844.5353 2513.8781,-723.1936 2509.1652,-668.7961"/>
<polygon fill="#000000" stroke="#000000" points="2512.6212,-668.1655 2508.194,-658.54 2505.6524,-668.8255 2512.6212,-668.1655"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3057,-923.502 2551,-923.502 2551,-357.5001 3057,-357.5001 3057,-923.502"/>
<text text-anchor="middle" x="2804" y="-908.3015" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 500</text>
<text text-anchor="middle" x="2804" y="-876.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2804" y="-861.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE repl (</text>
<text text-anchor="middle" x="2804" y="-846.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2804" y="-830.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">project TEXT,</text>
<text text-anchor="middle" x="2804" y="-815.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2804" y="-799.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP);</text>
<text text-anchor="middle" x="2804" y="-784.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-753.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line_stmt = [[</text>
<text text-anchor="middle" x="2804" y="-737.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES(?, ?);</text>
<text text-anchor="middle" x="2804" y="-722.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-690.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2804" y="-675.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2804" y="-660.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-628.701" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2804" y="-613.301" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT line FROM repl</text>
<text text-anchor="middle" x="2804" y="-597.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %s</text>
<text text-anchor="middle" x="2804" y="-582.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2804" y="-567.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2804" y="-551.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2804" y="-520.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-504.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2804" y="-473.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2804" y="-458.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2804" y="-442.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2804" y="-427.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2804" y="-411.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-396.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2804" y="-381.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2804" y="-365.7006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_25&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>codeblock_25&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2641.715,-982.4389C2647.4065,-970.4469 2655.568,-953.2503 2665.2409,-932.8694"/>
<polygon fill="#000000" stroke="#000000" points="2668.5056,-934.1535 2669.6313,-923.6187 2662.1817,-931.1521 2668.5056,-934.1535"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2292,-231.1017 1926,-231.1017 1926,-175.2988 2292,-175.2988 2292,-231.1017"/>
<text text-anchor="middle" x="2109" y="-183.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">This is where we either create query or create our</text>
</g>
<!-- raw_27&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>raw_27&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2243.4664,-622.2106C2244.0711,-575.4639 2242.0028,-448.4336 2206,-351.0005 2190.605,-309.3375 2161.6185,-267.5477 2139.3263,-239.088"/>
<polygon fill="#000000" stroke="#000000" points="2141.9055,-236.7082 2132.94,-231.0627 2136.4281,-241.0669 2141.9055,-236.7082"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="2364,-221.2002 2310,-221.2002 2310,-185.2002 2364,-185.2002 2364,-221.2002"/>
<text text-anchor="middle" x="2337" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_28&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>prespace_28&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2334.1251,-622.2675C2334.5921,-554.1996 2336.2356,-314.6301 2336.8045,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="2340.3056,-231.5354 2336.8744,-221.5116 2333.3058,-231.4873 2340.3056,-231.5354"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2466.5,-221.2002 2387.5,-221.2002 2387.5,-185.2002 2466.5,-185.2002 2466.5,-221.2002"/>
<text text-anchor="middle" x="2427" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">~/.bridge</text>
</g>
<!-- literal_29&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>literal_29&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2429.8749,-622.2675C2429.4079,-554.1996 2427.7644,-314.6301 2427.1955,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="2430.6942,-231.4873 2427.1256,-221.5116 2423.6944,-231.5354 2430.6942,-231.4873"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2571,-223.1023 2485,-223.1023 2485,-183.2982 2571,-183.2982 2571,-223.1023"/>
<text text-anchor="middle" x="2528" y="-207.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> database.</text>
</g>
<!-- raw_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>raw_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2506.9173,-622.2675C2510.3218,-554.5947 2522.2545,-317.4056 2526.4926,-233.1641"/>
<polygon fill="#000000" stroke="#000000" points="2529.9972,-233.1584 2527.0041,-222.9952 2523.006,-232.8067 2529.9972,-233.1584"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="3266.5,-658.501 3075.5,-658.501 3075.5,-622.501 3266.5,-622.501 3266.5,-658.501"/>
<text text-anchor="middle" x="3171" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_36&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>header_36&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3186.1846,-982.4389C3183.5739,-923.6502 3175.4089,-739.7851 3172.258,-668.8294"/>
<polygon fill="#000000" stroke="#000000" points="3175.7541,-668.6616 3171.8138,-658.8267 3168.761,-668.9722 3175.7541,-668.6616"/>
</g>
<!-- raw_42 -->
<g id="node43" class="node">
<title>raw_42</title>
<ellipse fill="none" stroke="#000000" cx="3312" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="3312" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_37&#45;&gt;raw_42 -->
<g id="edge42" class="edge">
<title>prose_37&#45;&gt;raw_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3388.9621,-985.4394C3375.4468,-972.1757 3357.3293,-951.7615 3348,-930.0016 3309.6307,-840.5074 3308.5879,-722.156 3310.4477,-668.7649"/>
<polygon fill="#000000" stroke="#000000" points="3313.9482,-668.821 3310.8621,-658.6856 3306.9541,-668.5333 3313.9482,-668.821"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3800.5,-752.1018 3357.5,-752.1018 3357.5,-528.9002 3800.5,-528.9002 3800.5,-752.1018"/>
<text text-anchor="middle" x="3579" y="-737.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = L.P</text>
<text text-anchor="middle" x="3579" y="-721.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzzMatch(frag, string)</text>
<text text-anchor="middle" x="3579" y="-706.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="3579" y="-690.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = (P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="3579" y="-675.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i,v in ipairs(frag) do</text>
<text text-anchor="middle" x="3579" y="-660.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if i &lt; #frag then</text>
<text text-anchor="middle" x="3579" y="-644.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="3579" y="-629.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3579" y="-613.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patt * (P(v))</text>
<text text-anchor="middle" x="3579" y="-598.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3579" y="-583.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3579" y="-567.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return L.match(patt, string)</text>
<text text-anchor="middle" x="3579" y="-552.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3579" y="-536.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.fuzzMatch = fuzzMatch</text>
</g>
<!-- codeblock_38&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_38&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3564.7645,-982.4389C3566.4363,-942.2828 3570.5375,-843.7698 3573.9108,-762.7448"/>
<polygon fill="#000000" stroke="#000000" points="3577.4203,-762.5873 3574.3393,-752.4504 3570.4263,-762.2961 3577.4203,-762.5873"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="4261.5,-721.5013 3818.5,-721.5013 3818.5,-559.5007 4261.5,-559.5007 4261.5,-721.5013"/>
<text text-anchor="middle" x="4040" y="-706.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="4040" y="-690.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = {}</text>
<text text-anchor="middle" x="4040" y="-675.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="4040" y="-660.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = fuzzMatch(frag, tostring(historian[i]))</text>
<text text-anchor="middle" x="4040" y="-644.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="4040" y="-629.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="4040" y="-613.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4040" y="-598.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4040" y="-583.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection</text>
<text text-anchor="middle" x="4040" y="-567.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_39&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>codeblock_39&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3898.5938,-982.4389C3917.4282,-936.895 3967.306,-816.2843 4002.4676,-731.2589"/>
<polygon fill="#000000" stroke="#000000" points="4005.7703,-732.4312 4006.3575,-721.8527 3999.3016,-729.7561 4005.7703,-732.4312"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="4736.5,-930.0021 4279.5,-930.0021 4279.5,-350.9999 4736.5,-350.9999 4736.5,-930.0021"/>
<text text-anchor="middle" x="4508" y="-914.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert(table.reverse)</text>
<text text-anchor="middle" x="4508" y="-883.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="4508" y="-868.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.home_dir .. &quot;/.bridge&quot;)</text>
<text text-anchor="middle" x="4508" y="-852.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="4508" y="-837.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_names = conn:exec(get_tables)</text>
<text text-anchor="middle" x="4508" y="-821.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not table_names or not has(table_names.name, &quot;repl&quot;) then</text>
<text text-anchor="middle" x="4508" y="-806.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local success, err = sql.pexec(conn, create_repl_table)</text>
<text text-anchor="middle" x="4508" y="-791.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; success is nil for creation, false for error</text>
<text text-anchor="middle" x="4508" y="-775.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if success == false then</text>
<text text-anchor="middle" x="4508" y="-760.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="4508" y="-744.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4508" y="-729.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4508" y="-714.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt = conn:prepare(insert_line_stmt)</text>
<text text-anchor="middle" x="4508" y="-698.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_stmt = sql.format(get_recent, historian.project,</text>
<text text-anchor="middle" x="4508" y="-683.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="4508" y="-667.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local values, err = sql.pexec(conn, pop_stmt)</text>
<text text-anchor="middle" x="4508" y="-652.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if values then</text>
<text text-anchor="middle" x="4508" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(reverse(values[1])) do</text>
<text text-anchor="middle" x="4508" y="-621.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = Linebuf(v)</text>
<text text-anchor="middle" x="4508" y="-606.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4508" y="-590.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="4508" y="-575.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.up = false</text>
<text text-anchor="middle" x="4508" y="-560.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4508" y="-544.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4508" y="-513.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, linebuf)</text>
<text text-anchor="middle" x="4508" y="-497.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="4508" y="-482.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_stmt:bind(historian.project, lb)</text>
<text text-anchor="middle" x="4508" y="-467.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local err = historian.insert_stmt:step()</text>
<text text-anchor="middle" x="4508" y="-451.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not err then</text>
<text text-anchor="middle" x="4508" y="-436.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_stmt:clearbind():reset()</text>
<text text-anchor="middle" x="4508" y="-420.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="4508" y="-405.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;error(error)</text>
<text text-anchor="middle" x="4508" y="-390.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4508" y="-374.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="4508" y="-359.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_40&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>codeblock_40&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4375.1351,-982.4389C4379.287,-971.7537 4385.0444,-956.9366 4391.8521,-939.4165"/>
<polygon fill="#000000" stroke="#000000" points="4395.1453,-940.6046 4395.5048,-930.0158 4388.6206,-938.0692 4395.1453,-940.6046"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="3339,-223.2002 3285,-223.2002 3285,-183.2002 3339,-183.2002 3339,-223.2002"/>
</g>
<!-- raw_42&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>raw_42&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3312,-622.2675C3312,-554.6721 3312,-317.9482 3312,-233.4538"/>
<polygon fill="#000000" stroke="#000000" points="3315.5001,-233.2474 3312,-223.2475 3308.5001,-233.2475 3315.5001,-233.2474"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="4903.5,-658.501 4754.5,-658.501 4754.5,-622.501 4903.5,-622.501 4903.5,-658.501"/>
<text text-anchor="middle" x="4829" y="-637.001" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_47&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>header_47&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4843.2355,-982.4389C4840.788,-923.6502 4833.1334,-739.7851 4830.1794,-668.8294"/>
<polygon fill="#000000" stroke="#000000" points="4833.676,-668.6725 4829.7629,-658.8267 4826.682,-668.9637 4833.676,-668.6725"/>
</g>
<!-- raw_53 -->
<g id="node54" class="node">
<title>raw_53</title>
<ellipse fill="none" stroke="#000000" cx="4949" cy="-640.501" rx="27" ry="18"/>
<text text-anchor="middle" x="4949" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_48&#45;&gt;raw_53 -->
<g id="edge53" class="edge">
<title>prose_48&#45;&gt;raw_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5020.8012,-984.7744C5008.9565,-971.2743 4993.1906,-950.8719 4985,-930.0016 4949.4274,-839.3594 4946.9807,-721.5843 4947.9679,-668.5513"/>
<polygon fill="#000000" stroke="#000000" points="4951.4671,-668.6245 4948.2111,-658.5424 4944.4691,-668.4544 4951.4671,-668.6245"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="5444,-721.5013 4994,-721.5013 4994,-559.5007 5444,-559.5007 5444,-721.5013"/>
<text text-anchor="middle" x="5219" y="-706.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="5219" y="-690.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="5219" y="-675.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="5219" y="-660.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5219" y="-644.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="5219" y="-629.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf = historian[historian.cursor &#45; delta]:clone()</text>
<text text-anchor="middle" x="5219" y="-613.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; delta</text>
<text text-anchor="middle" x="5219" y="-598.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="5219" y="-583.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return linebuf</text>
<text text-anchor="middle" x="5219" y="-567.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_49&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>codeblock_49&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5190.5289,-982.4389C5194.3096,-937.0334 5204.3026,-817.0168 5211.3785,-732.0352"/>
<polygon fill="#000000" stroke="#000000" points="5214.8844,-732.1086 5212.2264,-721.8527 5207.9086,-731.5277 5214.8844,-732.1086"/>
</g>
<!-- header_56 -->
<g id="node57" class="node">
<title>header_56</title>
<ellipse fill="none" stroke="#000000" cx="5544" cy="-640.501" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="5544" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_50&#45;&gt;header_56 -->
<g id="edge56" class="edge">
<title>section_50&#45;&gt;header_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5606.6363,-982.4389C5595.8674,-923.6502 5562.1869,-739.7851 5549.1892,-668.8294"/>
<polygon fill="#000000" stroke="#000000" points="5552.6015,-668.0324 5547.3569,-658.8267 5545.7161,-669.2937 5552.6015,-668.0324"/>
</g>
<!-- prose_57 -->
<g id="node58" class="node">
<title>prose_57</title>
<ellipse fill="none" stroke="#000000" cx="5677" cy="-640.501" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5677" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_50&#45;&gt;prose_57 -->
<g id="edge57" class="edge">
<title>section_50&#45;&gt;prose_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5617.4722,-982.7631C5623.0554,-968.6298 5630.4748,-948.3533 5635,-930.0016 5658.2135,-835.8594 5670.1626,-721.119 5674.7377,-668.8648"/>
<polygon fill="#000000" stroke="#000000" points="5678.2427,-668.9535 5675.6035,-658.6926 5671.2679,-668.3598 5678.2427,-668.9535"/>
</g>
<!-- codeblock_58 -->
<g id="node59" class="node">
<title>codeblock_58</title>
<ellipse fill="none" stroke="#000000" cx="5917" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5917" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 169&#45;184</text>
</g>
<!-- section_50&#45;&gt;codeblock_58 -->
<g id="edge58" class="edge">
<title>section_50&#45;&gt;codeblock_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5641.6375,-984.4309C5664.5027,-971.6134 5695.2428,-952.2648 5718,-930.0016 5803.1335,-846.7158 5874.1775,-722.0424 5903.0914,-667.5822"/>
<polygon fill="#000000" stroke="#000000" points="5906.2813,-669.036 5907.8378,-658.5561 5900.0857,-665.778 5906.2813,-669.036"/>
</g>
<!-- header_69 -->
<g id="node70" class="node">
<title>header_69</title>
<ellipse fill="none" stroke="#000000" cx="6352" cy="-640.501" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="6352" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_51&#45;&gt;header_69 -->
<g id="edge69" class="edge">
<title>section_51&#45;&gt;header_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6564.2468,-985.1224C6539.1104,-973.1102 6506.8159,-954.4463 6485,-930.0016 6413.2074,-849.558 6373.6323,-723.762 6358.8374,-668.3268"/>
<polygon fill="#000000" stroke="#000000" points="6362.19,-667.3121 6356.2836,-658.5163 6355.4157,-669.0755 6362.19,-667.3121"/>
</g>
<!-- prose_70 -->
<g id="node71" class="node">
<title>prose_70</title>
<ellipse fill="none" stroke="#000000" cx="6526" cy="-640.501" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6526" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_51&#45;&gt;prose_70 -->
<g id="edge70" class="edge">
<title>section_51&#45;&gt;prose_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6596.3943,-982.5754C6592.1277,-968.3413 6586.2798,-948.0207 6582,-930.0016 6559.4145,-834.9109 6539.3701,-720.6367 6530.6384,-668.6809"/>
<polygon fill="#000000" stroke="#000000" points="6534.0492,-667.8563 6528.95,-658.5693 6527.1448,-669.0092 6534.0492,-667.8563"/>
</g>
<!-- codeblock_71 -->
<g id="node72" class="node">
<title>codeblock_71</title>
<ellipse fill="none" stroke="#000000" cx="6678" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6678" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 189&#45;196</text>
</g>
<!-- section_51&#45;&gt;codeblock_71 -->
<g id="edge71" class="edge">
<title>section_51&#45;&gt;codeblock_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6605.8733,-982.4389C6618.2739,-923.6502 6657.0575,-739.7851 6672.0246,-668.8294"/>
<polygon fill="#000000" stroke="#000000" points="6675.4951,-669.3338 6674.1345,-658.8267 6668.6458,-667.889 6675.4951,-669.3338"/>
</g>
<!-- codeblock_72 -->
<g id="node73" class="node">
<title>codeblock_72</title>
<ellipse fill="none" stroke="#000000" cx="6941" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6941" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 198&#45;205</text>
</g>
<!-- section_51&#45;&gt;codeblock_72 -->
<g id="edge72" class="edge">
<title>section_51&#45;&gt;codeblock_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6656.5699,-988.25C6693.1073,-977.6337 6740.4688,-959.3531 6774,-930.0016 6859.6962,-854.9872 6912.1559,-724.8139 6931.9672,-668.165"/>
<polygon fill="#000000" stroke="#000000" points="6935.3577,-669.0675 6935.2872,-658.4729 6928.7354,-666.7991 6935.3577,-669.0675"/>
</g>
<!-- codeblock_73 -->
<g id="node74" class="node">
<title>codeblock_73</title>
<ellipse fill="none" stroke="#000000" cx="7170" cy="-640.501" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7170" y="-636.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 207&#45;209</text>
</g>
<!-- section_51&#45;&gt;codeblock_73 -->
<g id="edge73" class="edge">
<title>section_51&#45;&gt;codeblock_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6676.1419,-997.0473C6785.1097,-990.1711 6981.6014,-972.1808 7037,-930.0016 7123.7928,-863.9194 7155.7932,-727.8307 7165.9122,-668.8244"/>
<polygon fill="#000000" stroke="#000000" points="7169.4018,-669.1706 7167.5552,-658.7379 7162.4929,-668.0451 7169.4018,-669.1706"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="4976,-221.2002 4922,-221.2002 4922,-185.2002 4976,-185.2002 4976,-221.2002"/>
</g>
<!-- raw_53&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>raw_53&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4949,-622.2675C4949,-554.1996 4949,-314.6301 4949,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="4952.5001,-231.5116 4949,-221.5116 4945.5001,-231.5116 4952.5001,-231.5116"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="5445,-221.2002 5289,-221.2002 5289,-185.2002 5445,-185.2002 5445,-221.2002"/>
<text text-anchor="middle" x="5367" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_56&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>header_56&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5539.798,-622.3737C5528.7345,-576.0097 5496.6221,-449.8036 5453,-351.0005 5433.5248,-306.8895 5404.1436,-259.2563 5385.2659,-230.3268"/>
<polygon fill="#000000" stroke="#000000" points="5387.9549,-228.0462 5379.5318,-221.6195 5382.1087,-231.8962 5387.9549,-228.0462"/>
</g>
<!-- raw_60 -->
<g id="node61" class="node">
<title>raw_60</title>
<ellipse fill="none" stroke="#000000" cx="5490" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="5490" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_57&#45;&gt;raw_60 -->
<g id="edge60" class="edge">
<title>prose_57&#45;&gt;raw_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5680.2839,-622.3206C5688.1838,-572.4668 5702.8859,-431.9358 5635,-351.0005 5602.2137,-311.9118 5561.9402,-351.2104 5526,-315.0005 5503.7526,-292.5861 5495.2476,-256.3732 5491.9999,-231.2612"/>
<polygon fill="#000000" stroke="#000000" points="5495.4716,-230.8113 5490.9051,-221.2511 5488.5131,-231.5724 5495.4716,-230.8113"/>
</g>
<!-- prespace_61 -->
<g id="node62" class="node">
<title>prespace_61</title>
<ellipse fill="none" stroke="#000000" cx="5581" cy="-203.2002" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5581" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_57&#45;&gt;prespace_61 -->
<g id="edge61" class="edge">
<title>prose_57&#45;&gt;prespace_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5675.6698,-622.2928C5672.0254,-576.2553 5660.4113,-451.7025 5635,-351.0005 5624.1179,-307.8761 5605.2371,-259.8258 5592.9324,-230.5562"/>
<polygon fill="#000000" stroke="#000000" points="5596.0133,-228.8573 5588.8783,-221.0252 5589.5719,-231.5973 5596.0133,-228.8573"/>
</g>
<!-- literal_62 -->
<g id="node63" class="node">
<title>literal_62</title>
<ellipse fill="none" stroke="#000000" cx="5677" cy="-203.2002" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5677" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_57&#45;&gt;literal_62 -->
<g id="edge62" class="edge">
<title>prose_57&#45;&gt;literal_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5677,-622.2675C5677,-554.1996 5677,-314.6301 5677,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="5680.5001,-231.5116 5677,-221.5116 5673.5001,-231.5116 5680.5001,-231.5116"/>
</g>
<!-- raw_63 -->
<g id="node64" class="node">
<title>raw_63</title>
<ellipse fill="none" stroke="#000000" cx="5753" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="5753" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_57&#45;&gt;raw_63 -->
<g id="edge63" class="edge">
<title>prose_57&#45;&gt;raw_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5680.121,-622.543C5691.895,-554.7958 5733.6798,-314.3677 5748.0799,-231.5102"/>
<polygon fill="#000000" stroke="#000000" points="5751.5468,-232.0022 5749.8108,-221.5506 5744.6502,-230.8036 5751.5468,-232.0022"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="6241.5,-314.801 5798.5,-314.801 5798.5,-91.5995 6241.5,-91.5995 6241.5,-314.801"/>
<text text-anchor="middle" x="6020" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="6020" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local delta = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="6020" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 then</text>
<text text-anchor="middle" x="6020" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Linebuf()</text>
<text text-anchor="middle" x="6020" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6020" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local linebuf= historian[historian.cursor + delta]:clone()</text>
<text text-anchor="middle" x="6020" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + delta</text>
<text text-anchor="middle" x="6020" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;linebuf.cursor = #linebuf.line + 1</text>
<text text-anchor="middle" x="6020" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (delta &gt; 0) and #linebuf.line &gt; 0 then</text>
<text text-anchor="middle" x="6020" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, true</text>
<text text-anchor="middle" x="6020" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6020" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return linebuf, false</text>
<text text-anchor="middle" x="6020" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6020" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_58&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>codeblock_58&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5921.2946,-622.2675C5933.0605,-572.314 5966.582,-429.9938 5991.3104,-325.006"/>
<polygon fill="#000000" stroke="#000000" points="5994.7891,-325.5029 5993.675,-314.9668 5987.9755,-323.898 5994.7891,-325.5029"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="5537,-55.6015 5059,-55.6015 5059,.2015 5537,.2015 5537,-55.6015"/>
<text text-anchor="middle" x="5298" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next linebuf in history, and a second flag to tell the</text>
</g>
<!-- raw_60&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>raw_60&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5488.7967,-184.9823C5486.261,-160.696 5478.3926,-117.7247 5454,-91.4 5442.1989,-78.6642 5427.4846,-68.4098 5411.8423,-60.1709"/>
<polygon fill="#000000" stroke="#000000" points="5413.0531,-56.8643 5402.5402,-55.5493 5409.9385,-63.1332 5413.0531,-56.8643"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="5609,-45.7 5555,-45.7 5555,-9.7 5609,-9.7 5609,-45.7"/>
</g>
<!-- prespace_61&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>prespace_61&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5581.1033,-185.0797C5581.2774,-154.5231 5581.6306,-92.5279 5581.838,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="5585.3402,-55.7418 5581.8973,-45.722 5578.3403,-55.7019 5585.3402,-55.7418"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="5727,-45.7 5627,-45.7 5627,-9.7 5727,-9.7 5727,-45.7"/>
<text text-anchor="middle" x="5677" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_62&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>literal_62&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5677,-185.0797C5677,-154.5231 5677,-92.5279 5677,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="5680.5001,-55.722 5677,-45.722 5673.5001,-55.7221 5680.5001,-55.722"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="5985,-45.7 5745,-45.7 5745,-9.7 5985,-9.7 5985,-45.7"/>
<text text-anchor="middle" x="5865" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_63&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>raw_63&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5755.6171,-185.1968C5759.6782,-161.9061 5769.1902,-120.8356 5789,-91.4 5799.2851,-76.1174 5814.2495,-62.4818 5828.1849,-51.7863"/>
<polygon fill="#000000" stroke="#000000" points="5830.2685,-54.5985 5836.2278,-45.8385 5826.1064,-48.9703 5830.2685,-54.5985"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="6430,-221.2002 6260,-221.2002 6260,-185.2002 6430,-185.2002 6430,-221.2002"/>
<text text-anchor="middle" x="6345" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_69&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>header_69&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6351.7081,-622.2675C6350.6185,-554.1996 6346.7837,-314.6301 6345.4563,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="6348.9528,-231.4543 6345.2931,-221.5116 6341.9537,-231.5664 6348.9528,-231.4543"/>
</g>
<!-- raw_75 -->
<g id="node76" class="node">
<title>raw_75</title>
<ellipse fill="none" stroke="#000000" cx="6475" cy="-203.2002" rx="27" ry="18"/>
<text text-anchor="middle" x="6475" y="-199.0002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_70&#45;&gt;raw_75 -->
<g id="edge75" class="edge">
<title>prose_70&#45;&gt;raw_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6523.8735,-622.2675C6515.927,-554.1301 6487.9384,-314.141 6478.2947,-231.4509"/>
<polygon fill="#000000" stroke="#000000" points="6481.7705,-231.0388 6477.1356,-221.5116 6474.8176,-231.8498 6481.7705,-231.0388"/>
</g>
<!-- leaf_77 -->
<g id="node78" class="node">
<title>leaf_77</title>
<polygon fill="none" stroke="#c0c0c0" points="6851.5,-253.6012 6520.5,-253.6012 6520.5,-152.7993 6851.5,-152.7993 6851.5,-253.6012"/>
<text text-anchor="middle" x="6686" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, linebuf)</text>
<text text-anchor="middle" x="6686" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = linebuf</text>
<text text-anchor="middle" x="6686" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="6686" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:persist(linebuf)</text>
<text text-anchor="middle" x="6686" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6686" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_71&#45;&gt;leaf_77 -->
<g id="edge77" class="edge">
<title>codeblock_71&#45;&gt;leaf_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6678.3336,-622.2675C6679.4443,-561.5533 6683.0511,-364.3925 6684.8941,-263.6522"/>
<polygon fill="#000000" stroke="#000000" points="6688.394,-263.6859 6685.0776,-253.6235 6681.3951,-263.5578 6688.394,-263.6859"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="7138,-253.6012 6870,-253.6012 6870,-152.7993 7138,-152.7993 7138,-253.6012"/>
<text text-anchor="middle" x="7004" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="7004" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="7004" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="7004" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="7004" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7004" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_72&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>codeblock_72&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6943.6268,-622.2675C6952.3736,-561.5533 6980.7777,-364.3925 6995.2909,-263.6522"/>
<polygon fill="#000000" stroke="#000000" points="6998.774,-264.0204 6996.7357,-253.6235 6991.8455,-263.0222 6998.774,-264.0204"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="7242,-221.2002 7156,-221.2002 7156,-185.2002 7242,-185.2002 7242,-221.2002"/>
<text text-anchor="middle" x="7199" y="-199.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_73&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>codeblock_73&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7171.2092,-622.2675C7175.7232,-554.1996 7191.6104,-314.6301 7197.1097,-231.7042"/>
<polygon fill="#000000" stroke="#000000" points="7200.6162,-231.7213 7197.7857,-221.5116 7193.6315,-231.2581 7200.6162,-231.7213"/>
</g>
<!-- leaf_76 -->
<g id="node77" class="node">
<title>leaf_76</title>
<polygon fill="none" stroke="#c0c0c0" points="6502,-45.7 6448,-45.7 6448,-9.7 6502,-9.7 6502,-45.7"/>
</g>
<!-- raw_75&#45;&gt;leaf_76 -->
<g id="edge76" class="edge">
<title>raw_75&#45;&gt;leaf_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6475,-185.0797C6475,-154.5231 6475,-92.5279 6475,-56.1322"/>
<polygon fill="#000000" stroke="#000000" points="6478.5001,-55.722 6475,-45.722 6471.5001,-55.7221 6478.5001,-55.722"/>
</g>
</g>
</svg>
