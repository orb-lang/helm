<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="9400pt" height="2716pt"
 viewBox="0.00 0.00 9400.30 2716.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2712.2042)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2712.2042 9396.2972,-2712.2042 9396.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1788" cy="-2690.2042" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1788" y="-2686.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 414</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1788" cy="-2618.2042" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1788" y="-2614.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;328</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1788,-2672.0355C1788,-2664.3351 1788,-2655.1785 1788,-2646.6208"/>
<polygon fill="#000000" stroke="#000000" points="1791.5001,-2646.6174 1788,-2636.6174 1784.5001,-2646.6175 1791.5001,-2646.6174"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1362" cy="-2546.2042" rx="57.0821" ry="18"/>
<text text-anchor="middle" x="1362" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Historian</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1727.834,-2610.9655C1656.7845,-2601.9825 1535.2106,-2585.2457 1432,-2564.2042 1426.6208,-2563.1075 1421.0358,-2561.86 1415.4724,-2560.5452"/>
<polygon fill="#000000" stroke="#000000" points="1416.075,-2557.0897 1405.5307,-2558.1239 1414.4185,-2563.8909 1416.075,-2557.0897"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1473" cy="-2546.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1473" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1729.0711,-2610.2021C1673.1757,-2601.7596 1587.2326,-2586.5552 1515,-2564.2042 1512.5464,-2563.4449 1510.0417,-2562.5899 1507.5381,-2561.6753"/>
<polygon fill="#000000" stroke="#000000" points="1508.5845,-2558.3262 1497.9971,-2557.9303 1506.0268,-2564.8422 1508.5845,-2558.3262"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1556" cy="-2546.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1556" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1739.0429,-2606.1337C1700.3491,-2596.1532 1645.1859,-2580.9433 1598,-2564.2042 1595.5795,-2563.3455 1593.0994,-2562.4161 1590.6137,-2561.4476"/>
<polygon fill="#000000" stroke="#000000" points="1591.6934,-2558.1085 1581.1115,-2557.5855 1589.0577,-2564.5933 1591.6934,-2558.1085"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1639" cy="-2546.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1639" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1755.3013,-2602.4034C1730.8419,-2590.5841 1697.4944,-2574.4699 1672.7785,-2562.5266"/>
<polygon fill="#000000" stroke="#000000" points="1674.2918,-2559.3707 1663.765,-2558.1711 1671.2461,-2565.6734 1674.2918,-2559.3707"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1721" cy="-2546.2042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1721" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1771.4382,-2600.4064C1762.8766,-2591.2059 1752.312,-2579.8528 1743.0672,-2569.9182"/>
<polygon fill="#000000" stroke="#000000" points="1745.3742,-2567.2595 1735.9996,-2562.3231 1740.2497,-2572.0282 1745.3742,-2567.2595"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1850" cy="-2546.2042" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1850" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 16&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1803.3258,-2600.4064C1810.7779,-2591.7524 1819.8698,-2581.1941 1828.0427,-2571.703"/>
<polygon fill="#000000" stroke="#000000" points="1830.7625,-2573.9083 1834.6356,-2564.0467 1825.4581,-2569.3406 1830.7625,-2573.9083"/>
</g>
<!-- codeblock_8 -->
<g id="node9" class="node">
<title>codeblock_8</title>
<ellipse fill="none" stroke="#000000" cx="2064" cy="-2546.2042" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2064" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 27&#45;29</text>
</g>
<!-- section_1&#45;&gt;codeblock_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;codeblock_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1835.7604,-2605.7449C1881.9018,-2593.708 1952.0111,-2575.4187 2002.3461,-2562.2878"/>
<polygon fill="#000000" stroke="#000000" points="2003.3438,-2565.6447 2012.1365,-2559.7338 2001.5768,-2558.8714 2003.3438,-2565.6447"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="2527" cy="-2546.2042" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2527" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 32&#45;231</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1850.0524,-2612.1585C1984.8368,-2599.0265 2304.0065,-2567.9302 2450.7663,-2553.6315"/>
<polygon fill="#000000" stroke="#000000" points="2451.4167,-2557.0848 2461.0302,-2552.6315 2450.7379,-2550.1178 2451.4167,-2557.0848"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="6003" cy="-2546.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="6003" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 283&#45;328</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.784,-2617.0804C2339.6118,-2608.7816 5367.3575,-2557.0621 5917.35,-2547.6672"/>
<polygon fill="#000000" stroke="#000000" points="5917.647,-2551.1627 5927.5857,-2547.4924 5917.5274,-2544.1638 5917.647,-2551.1627"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="7035" cy="-2546.2042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7035" y="-2542.0042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 329&#45;380</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853.6638,-2617.5378C2249.9313,-2613.4837 4363.0003,-2591.3986 6087,-2564.2042 6405.2022,-2559.1848 6783.4496,-2551.4811 6949.5799,-2548.0099"/>
<polygon fill="#000000" stroke="#000000" points="6949.8087,-2551.506 6959.7333,-2547.7975 6949.6623,-2544.5075 6949.8087,-2551.506"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1402.5,-2444.604 1309.5,-2444.604 1309.5,-2408.604 1402.5,-2408.604 1402.5,-2444.604"/>
<text text-anchor="middle" x="1356" y="-2423.104" font-family="Inconsolata" font-size="14.00" fill="#000000">* Historian</text>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1361.0887,-2528.0395C1360.1152,-2508.6334 1358.559,-2477.6141 1357.4236,-2454.982"/>
<polygon fill="#000000" stroke="#000000" points="1360.9166,-2454.7517 1356.9198,-2444.9397 1353.9254,-2455.1025 1360.9166,-2454.7517"/>
</g>
<!-- raw_13 -->
<g id="node14" class="node">
<title>raw_13</title>
<ellipse fill="none" stroke="#000000" cx="1448" cy="-2426.604" rx="27" ry="18"/>
<text text-anchor="middle" x="1448" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;raw_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1469.2572,-2528.2988C1465.1886,-2508.8344 1458.6324,-2477.4695 1453.8758,-2454.714"/>
<polygon fill="#000000" stroke="#000000" points="1457.2404,-2453.7041 1451.7683,-2444.6318 1450.3885,-2455.1364 1457.2404,-2453.7041"/>
</g>
<!-- raw_15 -->
<g id="node16" class="node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="1520" cy="-2426.604" rx="27" ry="18"/>
<text text-anchor="middle" x="1520" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_4&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1550.6104,-2528.2988C1544.7251,-2508.7463 1535.2251,-2477.1854 1528.3684,-2454.4056"/>
<polygon fill="#000000" stroke="#000000" points="1531.6602,-2453.1986 1525.4264,-2444.6318 1524.9573,-2455.2162 1531.6602,-2453.1986"/>
</g>
<!-- raw_17 -->
<g id="node18" class="node">
<title>raw_17</title>
<ellipse fill="none" stroke="#000000" cx="1592" cy="-2426.604" rx="27" ry="18"/>
<text text-anchor="middle" x="1592" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_5&#45;&gt;raw_17 -->
<g id="edge17" class="edge">
<title>prose_5&#45;&gt;raw_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1632.065,-2528.5567C1624.3243,-2508.8592 1611.705,-2476.747 1602.6975,-2453.8258"/>
<polygon fill="#000000" stroke="#000000" points="1605.8785,-2452.3508 1598.9635,-2444.3238 1599.3635,-2454.9111 1605.8785,-2452.3508"/>
</g>
<!-- raw_19 -->
<g id="node20" class="node">
<title>raw_19</title>
<ellipse fill="none" stroke="#000000" cx="1664" cy="-2426.604" rx="27" ry="18"/>
<text text-anchor="middle" x="1664" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;raw_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1712.5895,-2528.5567C1703.1056,-2508.6572 1687.583,-2476.0869 1676.6388,-2453.1234"/>
<polygon fill="#000000" stroke="#000000" points="1679.7216,-2451.4564 1672.2597,-2443.935 1673.4025,-2454.468 1679.7216,-2451.4564"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1991,-2492.3044 1709,-2492.3044 1709,-2360.9036 1991,-2360.9036 1991,-2492.3044"/>
<text text-anchor="middle" x="1850" y="-2477.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">local Txtbuf = require &quot;txtbuf&quot;</text>
<text text-anchor="middle" x="1850" y="-2461.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local sql &#160;&#160;&#160;&#160;= require &quot;sqlayer&quot;</text>
<text text-anchor="middle" x="1850" y="-2446.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local color &#160;&#160;= require &quot;color&quot;</text>
<text text-anchor="middle" x="1850" y="-2430.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local L &#160;&#160;&#160;&#160;&#160;&#160;= require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1850" y="-2415.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local format &#160;= assert (string.format)</text>
<text text-anchor="middle" x="1850" y="-2400.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub &#160;&#160;&#160;&#160;= assert (string.sub)</text>
<text text-anchor="middle" x="1850" y="-2384.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local reverse = assert (table.reverse)</text>
<text text-anchor="middle" x="1850" y="-2369.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(meta)</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1850,-2528.0395C1850,-2520.7645 1850,-2511.8574 1850,-2502.372"/>
<polygon fill="#000000" stroke="#000000" points="1853.5001,-2502.322 1850,-2492.322 1846.5001,-2502.322 1853.5001,-2502.322"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2200.5,-2444.604 2009.5,-2444.604 2009.5,-2408.604 2200.5,-2408.604 2200.5,-2444.604"/>
<text text-anchor="middle" x="2105" y="-2423.104" font-family="Inconsolata" font-size="14.00" fill="#000000">local Historian = meta {}</text>
</g>
<!-- codeblock_8&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_8&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2070.227,-2528.0395C2076.9097,-2508.5456 2087.6096,-2477.3332 2095.3769,-2454.6753"/>
<polygon fill="#000000" stroke="#000000" points="2098.7823,-2455.5343 2098.7144,-2444.9397 2092.1606,-2453.2642 2098.7823,-2455.5343"/>
</g>
<!-- header_23 -->
<g id="node24" class="node">
<title>header_23</title>
<ellipse fill="none" stroke="#000000" cx="2287" cy="-2426.604" rx="68.6997" ry="18"/>
<text text-anchor="middle" x="2287" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Persistence</text>
</g>
<!-- section_9&#45;&gt;header_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;header_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2474.569,-2534.1281C2441.7843,-2525.2929 2399.4023,-2511.4702 2365,-2492.2042 2345.3309,-2481.189 2325.9201,-2464.8896 2311.3823,-2451.2941"/>
<polygon fill="#000000" stroke="#000000" points="2313.4802,-2448.4572 2303.8364,-2444.0699 2308.6394,-2453.5136 2313.4802,-2448.4572"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="2406" cy="-2426.604" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2406" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2496.6368,-2529.862C2480.6527,-2520.2893 2461.4321,-2507.1527 2447,-2492.2042 2435.8906,-2480.6972 2426.2443,-2465.6993 2419.1042,-2452.9489"/>
<polygon fill="#000000" stroke="#000000" points="2422.1857,-2451.2892 2414.3629,-2444.1439 2416.0224,-2454.608 2422.1857,-2451.2892"/>
</g>
<!-- section_25 -->
<g id="node26" class="node">
<title>section_25</title>
<ellipse fill="none" stroke="#000000" cx="2527" cy="-2426.604" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2527" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;141</text>
</g>
<!-- section_9&#45;&gt;section_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;section_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2527,-2528.0395C2527,-2508.6334 2527,-2477.6141 2527,-2454.982"/>
<polygon fill="#000000" stroke="#000000" points="2530.5001,-2454.9396 2527,-2444.9397 2523.5001,-2454.9397 2530.5001,-2454.9396"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2426.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2909" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 142&#45;220</text>
</g>
<!-- section_9&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2571.9436,-2532.1328C2641.9696,-2510.2084 2776.9656,-2467.9426 2853.1457,-2444.0914"/>
<polygon fill="#000000" stroke="#000000" points="2854.5424,-2447.3217 2863.0398,-2440.9937 2852.4509,-2440.6415 2854.5424,-2447.3217"/>
</g>
<!-- section_27 -->
<g id="node28" class="node">
<title>section_27</title>
<ellipse fill="none" stroke="#000000" cx="3968" cy="-2426.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="3968" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 221&#45;231</text>
</g>
<!-- section_9&#45;&gt;section_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;section_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2594.5697,-2540.596C2832.0521,-2520.8854 3627.9673,-2454.8261 3886.2873,-2433.386"/>
<polygon fill="#000000" stroke="#000000" points="3886.6739,-2436.8661 3896.3501,-2432.5508 3886.0948,-2429.89 3886.6739,-2436.8661"/>
</g>
<!-- section_28 -->
<g id="node29" class="node">
<title>section_28</title>
<ellipse fill="none" stroke="#000000" cx="4954" cy="-2426.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4954" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 232&#45;282</text>
</g>
<!-- section_9&#45;&gt;section_28 -->
<g id="edge28" class="edge">
<title>section_9&#45;&gt;section_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2597.3461,-2544.6444C2814.1868,-2539.6364 3491.5128,-2522.4984 4052,-2492.2042 4354.9919,-2475.8275 4714.5602,-2446.7919 4872.6132,-2433.5429"/>
<polygon fill="#000000" stroke="#000000" points="4873.0577,-2437.018 4882.7297,-2432.6933 4872.4718,-2430.0425 4873.0577,-2437.018"/>
</g>
<!-- header_87 -->
<g id="node88" class="node">
<title>header_87</title>
<ellipse fill="none" stroke="#000000" cx="5924" cy="-2426.604" rx="107.339" ry="18"/>
<text text-anchor="middle" x="5924" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:search(frag)</text>
</g>
<!-- section_10&#45;&gt;header_87 -->
<g id="edge87" class="edge">
<title>section_10&#45;&gt;header_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5991.1729,-2528.2988C5978.0251,-2508.394 5956.6569,-2476.0442 5941.5563,-2453.1829"/>
<polygon fill="#000000" stroke="#000000" points="5944.3399,-2451.0468 5935.908,-2444.6318 5938.4991,-2454.9049 5944.3399,-2451.0468"/>
</g>
<!-- prose_88 -->
<g id="node89" class="node">
<title>prose_88</title>
<ellipse fill="none" stroke="#000000" cx="6082" cy="-2426.604" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6082" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_88 -->
<g id="edge88" class="edge">
<title>section_10&#45;&gt;prose_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6015.4746,-2528.2993C6022.7161,-2517.8311 6031.9661,-2504.3311 6040,-2492.2042 6048.6297,-2479.1778 6058.0256,-2464.5463 6065.738,-2452.4124"/>
<polygon fill="#000000" stroke="#000000" points="6068.8701,-2454.0085 6071.2669,-2443.6883 6062.9575,-2450.2613 6068.8701,-2454.0085"/>
</g>
<!-- codeblock_89 -->
<g id="node90" class="node">
<title>codeblock_89</title>
<ellipse fill="none" stroke="#000000" cx="6309" cy="-2426.604" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6309" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 285&#45;326</text>
</g>
<!-- section_10&#45;&gt;codeblock_89 -->
<g id="edge89" class="edge">
<title>section_10&#45;&gt;codeblock_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6042.3777,-2530.8134C6097.5371,-2509.2543 6197.8341,-2470.0532 6258.4467,-2446.3628"/>
<polygon fill="#000000" stroke="#000000" points="6259.7811,-2449.5991 6267.8209,-2442.6989 6257.2329,-2443.0794 6259.7811,-2449.5991"/>
</g>
<!-- header_94 -->
<g id="node95" class="node">
<title>header_94</title>
<ellipse fill="none" stroke="#000000" cx="6781" cy="-2426.604" rx="82.6821" ry="18"/>
<text text-anchor="middle" x="6781" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Historian:prev()</text>
</g>
<!-- section_11&#45;&gt;header_94 -->
<g id="edge94" class="edge">
<title>section_11&#45;&gt;header_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6998.8916,-2530.3209C6974.9965,-2519.7203 6943.0197,-2505.3629 6915,-2492.2042 6884.2005,-2477.7399 6849.725,-2460.8462 6823.4566,-2447.8252"/>
<polygon fill="#000000" stroke="#000000" points="6824.6853,-2444.5276 6814.172,-2443.2149 6821.572,-2450.7972 6824.6853,-2444.5276"/>
</g>
<!-- prose_95 -->
<g id="node96" class="node">
<title>prose_95</title>
<ellipse fill="none" stroke="#000000" cx="6956" cy="-2426.604" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6956" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_95 -->
<g id="edge95" class="edge">
<title>section_11&#45;&gt;prose_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7023.1729,-2528.2988C7009.8731,-2508.1639 6988.1618,-2475.2945 6973.0351,-2452.3939"/>
<polygon fill="#000000" stroke="#000000" points="6975.8263,-2450.2692 6967.3944,-2443.8542 6969.9855,-2454.1273 6975.8263,-2450.2692"/>
</g>
<!-- codeblock_96 -->
<g id="node97" class="node">
<title>codeblock_96</title>
<ellipse fill="none" stroke="#000000" cx="7105" cy="-2426.604" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7105" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 331&#45;344</text>
</g>
<!-- section_11&#45;&gt;codeblock_96 -->
<g id="edge96" class="edge">
<title>section_11&#45;&gt;codeblock_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7045.4797,-2528.2988C7057.0781,-2508.4821 7075.8961,-2476.3302 7089.2659,-2453.4869"/>
<polygon fill="#000000" stroke="#000000" points="7092.418,-2455.0302 7094.4487,-2444.6318 7086.3767,-2451.4943 7092.418,-2455.0302"/>
</g>
<!-- section_97 -->
<g id="node98" class="node">
<title>section_97</title>
<ellipse fill="none" stroke="#000000" cx="7549" cy="-2426.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7549" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 347&#45;380</text>
</g>
<!-- section_11&#45;&gt;section_97 -->
<g id="edge97" class="edge">
<title>section_11&#45;&gt;section_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7089.0355,-2533.6309C7184.5721,-2511.401 7382.8455,-2465.2657 7485.0355,-2441.4876"/>
<polygon fill="#000000" stroke="#000000" points="7485.9706,-2444.8636 7494.9172,-2439.1883 7484.3842,-2438.0457 7485.9706,-2444.8636"/>
</g>
<!-- section_98 -->
<g id="node99" class="node">
<title>section_98</title>
<ellipse fill="none" stroke="#000000" cx="8482" cy="-2426.604" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="8482" y="-2422.404" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 381&#45;414</text>
</g>
<!-- section_11&#45;&gt;section_98 -->
<g id="edge98" class="edge">
<title>section_11&#45;&gt;section_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7106.757,-2540.2732C7350.1441,-2520.1563 8143.3794,-2454.5923 8400.644,-2433.3284"/>
<polygon fill="#000000" stroke="#000000" points="8400.9877,-2436.812 8410.6654,-2432.5001 8400.411,-2429.8358 8400.9877,-2436.812"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-2048.0045 0,-2048.0045 0,-1976.2022 324,-1976.2022 324,-2048.0045"/>
<text text-anchor="middle" x="162" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">This module is responsible for REPL history.</text>
</g>
<!-- raw_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>raw_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1443.2584,-2408.6346C1438.1083,-2393.0661 1428.2158,-2371.4484 1411,-2361.0039 1308.5373,-2298.8419 435.0441,-2387.8507 333,-2325.0039 235.9108,-2265.2087 190.0098,-2129.4771 171.8982,-2058.0358"/>
<polygon fill="#000000" stroke="#000000" points="175.2117,-2056.8533 169.4249,-2047.9785 168.4143,-2058.525 175.2117,-2056.8533"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="897.5,-2039.4037 342.5,-2039.4037 342.5,-1984.8029 897.5,-1984.8029 897.5,-2039.4037"/>
<text text-anchor="middle" x="620" y="-2008.3034" font-family="Inconsolata" font-size="14.00" fill="#000000">Eventually this will include persisting and restoring from a SQLite database,</text>
<text text-anchor="middle" x="620" y="-1992.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">fuzzy searching, and variable cacheing.</text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1515.4533,-2408.7667C1510.4874,-2393.2871 1500.8907,-2371.7258 1484,-2361.0039 1375.5357,-2292.153 1022.9361,-2380.3552 907,-2325.0039 778.4017,-2263.6073 680.3619,-2116.5033 640.0625,-2048.1493"/>
<polygon fill="#000000" stroke="#000000" points="643.0435,-2046.3132 634.986,-2039.4336 636.9947,-2049.8363 643.0435,-2046.3132"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1464,-2039.4037 916,-2039.4037 916,-1984.8029 1464,-1984.8029 1464,-2039.4037"/>
<text text-anchor="middle" x="1190" y="-2008.3034" font-family="Inconsolata" font-size="14.00" fill="#000000">Currently does the basic job of retaining history and not letting subsequent</text>
<text text-anchor="middle" x="1190" y="-1992.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">edits munge it.</text>
</g>
<!-- raw_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>raw_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1586.0028,-2408.9284C1580.2867,-2394.3961 1570.4026,-2374.1301 1556,-2361.0039 1526.2814,-2333.9189 1505.6696,-2348.4451 1473,-2325.0039 1360.1768,-2244.0507 1259.2531,-2111.3955 1214.4797,-2048.012"/>
<polygon fill="#000000" stroke="#000000" points="1217.1463,-2045.7187 1208.5392,-2039.5406 1211.415,-2049.7377 1217.1463,-2045.7187"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2030,-2047.4037 1482,-2047.4037 1482,-1976.803 2030,-1976.803 2030,-2047.4037"/>
<text text-anchor="middle" x="1756" y="-2016.3034" font-family="Inconsolata" font-size="14.00" fill="#000000">Next step: now that we clone a new txtbuf each time, we have an immutable</text>
<text text-anchor="middle" x="1756" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">record. &#160;We should store the line as a string, to facilitate fuzzy matching.</text>
</g>
<!-- raw_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>raw_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1667.9531,-2408.7934C1681.4152,-2348.1409 1725.7518,-2148.385 1745.8891,-2057.6573"/>
<polygon fill="#000000" stroke="#000000" points="1749.3564,-2058.1883 1748.1064,-2047.6675 1742.5227,-2056.6715 1749.3564,-2058.1883"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2162,-2030.1033 2048,-2030.1033 2048,-1994.1033 2162,-1994.1033 2162,-2030.1033"/>
<text text-anchor="middle" x="2105" y="-2008.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Persistence</text>
</g>
<!-- header_23&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>header_23&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2266.6905,-2409.3959C2234.2774,-2381.851 2174.1533,-2330.3898 2171,-2325.0039 2116.0548,-2231.1586 2106.5521,-2097.7385 2105.1193,-2040.2449"/>
<polygon fill="#000000" stroke="#000000" points="2108.6162,-2040.0396 2104.9328,-2030.1057 2101.6174,-2040.1684 2108.6162,-2040.0396"/>
</g>
<!-- raw_30 -->
<g id="node31" class="node">
<title>raw_30</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-2012.1033" rx="27" ry="18"/>
<text text-anchor="middle" x="2207" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_24&#45;&gt;raw_30 -->
<g id="edge30" class="edge">
<title>prose_24&#45;&gt;raw_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2399.1164,-2408.74C2392.5124,-2393.8892 2381.1497,-2373.27 2365,-2361.0039 2319.9797,-2326.81 2279.3855,-2368.2722 2243,-2325.0039 2173.28,-2242.0954 2189.9072,-2100.126 2200.9935,-2040.1533"/>
<polygon fill="#000000" stroke="#000000" points="2204.4426,-2040.7516 2202.9106,-2030.2681 2197.5706,-2039.4188 2204.4426,-2040.7516"/>
</g>
<!-- header_32 -->
<g id="node33" class="node">
<title>header_32</title>
<ellipse fill="none" stroke="#000000" cx="2331" cy="-2012.1033" rx="78.8488" ry="18"/>
<text text-anchor="middle" x="2331" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : SQLite battery</text>
</g>
<!-- section_25&#45;&gt;header_32 -->
<g id="edge32" class="edge">
<title>section_25&#45;&gt;header_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2505.8676,-2409.115C2477.9186,-2385.5968 2430.8116,-2344.4853 2419,-2325.0039 2361.8309,-2230.7124 2340.6649,-2098.0604 2333.848,-2040.547"/>
<polygon fill="#000000" stroke="#000000" points="2337.3016,-2039.9384 2332.7029,-2030.3937 2330.3457,-2040.7229 2337.3016,-2039.9384"/>
</g>
<!-- prose_33 -->
<g id="node34" class="node">
<title>prose_33</title>
<ellipse fill="none" stroke="#000000" cx="2460" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2460" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_25&#45;&gt;prose_33 -->
<g id="edge33" class="edge">
<title>section_25&#45;&gt;prose_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2521.8852,-2408.38C2516.3543,-2388.1463 2507.5825,-2354.4518 2502,-2325.0039 2482.2365,-2220.7515 2468.3455,-2095.2351 2462.7474,-2040.235"/>
<polygon fill="#000000" stroke="#000000" points="2466.2216,-2039.8022 2461.7391,-2030.2024 2459.2567,-2040.5023 2466.2216,-2039.8022"/>
</g>
<!-- codeblock_34 -->
<g id="node35" class="node">
<title>codeblock_34</title>
<ellipse fill="none" stroke="#000000" cx="2593" cy="-2012.1033" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2593" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;139</text>
</g>
<!-- section_25&#45;&gt;codeblock_34 -->
<g id="edge34" class="edge">
<title>section_25&#45;&gt;codeblock_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2529.8784,-2408.5269C2540.2573,-2343.3439 2575.8133,-2120.0411 2588.4766,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="2591.9904,-2040.7016 2590.1065,-2030.2756 2585.0775,-2039.6008 2591.9904,-2040.7016"/>
</g>
<!-- header_39 -->
<g id="node40" class="node">
<title>header_39</title>
<ellipse fill="none" stroke="#000000" cx="2776" cy="-2012.1033" rx="82.2147" ry="18"/>
<text text-anchor="middle" x="2776" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:load()</text>
</g>
<!-- section_26&#45;&gt;header_39 -->
<g id="edge39" class="edge">
<title>section_26&#45;&gt;header_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2901.0498,-2408.4537C2892.3629,-2388.2846 2878.3112,-2354.6463 2868,-2325.0039 2831.9109,-2221.2557 2797.6864,-2095.0614 2783.2251,-2040.0191"/>
<polygon fill="#000000" stroke="#000000" points="2786.5966,-2039.0774 2780.6801,-2030.2885 2779.8244,-2040.8487 2786.5966,-2039.0774"/>
</g>
<!-- prose_40 -->
<g id="node41" class="node">
<title>prose_40</title>
<ellipse fill="none" stroke="#000000" cx="2909" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2909" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_40 -->
<g id="edge40" class="edge">
<title>section_26&#45;&gt;prose_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2909,-2408.5269C2909,-2343.3439 2909,-2120.0411 2909,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="2912.5001,-2040.2756 2909,-2030.2756 2905.5001,-2040.2756 2912.5001,-2040.2756"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="2991" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2991" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_26&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2917.8358,-2408.7237C2927.298,-2388.7908 2942.025,-2355.3584 2950,-2325.0039 2976.9517,-2222.4204 2986.5873,-2096.0487 2989.6834,-2040.5325"/>
<polygon fill="#000000" stroke="#000000" points="2993.1861,-2040.5728 2990.2186,-2030.4021 2986.1958,-2040.2034 2993.1861,-2040.5728"/>
</g>
<!-- codeblock_42 -->
<g id="node43" class="node">
<title>codeblock_42</title>
<ellipse fill="none" stroke="#000000" cx="3211" cy="-2012.1033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3211" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;218</text>
</g>
<!-- section_26&#45;&gt;codeblock_42 -->
<g id="edge42" class="edge">
<title>section_26&#45;&gt;codeblock_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2934.8805,-2409.4494C2961.5166,-2390.8919 3003.094,-2359.3216 3032,-2325.0039 3111.3017,-2230.8553 3174.412,-2096.6685 3199.398,-2039.5457"/>
<polygon fill="#000000" stroke="#000000" points="3202.7197,-2040.6827 3203.4815,-2030.1153 3196.296,-2037.9011 3202.7197,-2040.6827"/>
</g>
<!-- header_49 -->
<g id="node50" class="node">
<title>header_49</title>
<ellipse fill="none" stroke="#000000" cx="3727" cy="-2012.1033" rx="190.9667" ry="18"/>
<text text-anchor="middle" x="3727" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:restore_session(modeS, session)</text>
</g>
<!-- section_27&#45;&gt;header_49 -->
<g id="edge49" class="edge">
<title>section_27&#45;&gt;header_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3957.4896,-2408.5269C3919.3582,-2342.944 3788.161,-2117.2953 3742.6758,-2039.0645"/>
<polygon fill="#000000" stroke="#000000" points="3745.6179,-2037.1613 3737.5658,-2030.2756 3739.5665,-2040.6798 3745.6179,-2037.1613"/>
</g>
<!-- prose_50 -->
<g id="node51" class="node">
<title>prose_50</title>
<ellipse fill="none" stroke="#000000" cx="3968" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3968" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_50 -->
<g id="edge50" class="edge">
<title>section_27&#45;&gt;prose_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968,-2408.5269C3968,-2343.3439 3968,-2120.0411 3968,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="3971.5001,-2040.2756 3968,-2030.2756 3964.5001,-2040.2756 3971.5001,-2040.2756"/>
</g>
<!-- prose_51 -->
<g id="node52" class="node">
<title>prose_51</title>
<ellipse fill="none" stroke="#000000" cx="4050" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4050" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_27&#45;&gt;prose_51 -->
<g id="edge51" class="edge">
<title>section_27&#45;&gt;prose_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3976.8358,-2408.7237C3986.298,-2388.7908 4001.025,-2355.3584 4009,-2325.0039 4035.9517,-2222.4204 4045.5873,-2096.0487 4048.6834,-2040.5325"/>
<polygon fill="#000000" stroke="#000000" points="4052.1861,-2040.5728 4049.2186,-2030.4021 4045.1958,-2040.2034 4052.1861,-2040.5728"/>
</g>
<!-- codeblock_52 -->
<g id="node53" class="node">
<title>codeblock_52</title>
<ellipse fill="none" stroke="#000000" cx="4188" cy="-2012.1033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4188" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 227&#45;229</text>
</g>
<!-- section_27&#45;&gt;codeblock_52 -->
<g id="edge52" class="edge">
<title>section_27&#45;&gt;codeblock_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3996.7711,-2409.8206C4024.7094,-2392.1092 4066.4033,-2361.7 4091,-2325.0039 4153.0256,-2232.467 4176.9223,-2098.353 4184.7257,-2040.4614"/>
<polygon fill="#000000" stroke="#000000" points="4188.2348,-2040.6145 4186.0399,-2030.2496 4181.2921,-2039.721 4188.2348,-2040.6145"/>
</g>
<!-- header_59 -->
<g id="node60" class="node">
<title>header_59</title>
<ellipse fill="none" stroke="#000000" cx="4708" cy="-2012.1033" rx="113.1277" ry="18"/>
<text text-anchor="middle" x="4708" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:persist(txtbuf)</text>
</g>
<!-- section_28&#45;&gt;header_59 -->
<g id="edge59" class="edge">
<title>section_28&#45;&gt;header_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4926.3155,-2409.7598C4898.8197,-2391.789 4857.0987,-2360.9901 4831,-2325.0039 4763.7369,-2232.2579 4727.3104,-2097.7874 4713.9761,-2040.0986"/>
<polygon fill="#000000" stroke="#000000" points="4717.3686,-2039.2318 4711.7528,-2030.2477 4710.5404,-2040.773 4717.3686,-2039.2318"/>
</g>
<!-- prose_60 -->
<g id="node61" class="node">
<title>prose_60</title>
<ellipse fill="none" stroke="#000000" cx="4872" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4872" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_60 -->
<g id="edge60" class="edge">
<title>section_28&#45;&gt;prose_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4945.1642,-2408.7237C4935.702,-2388.7908 4920.975,-2355.3584 4913,-2325.0039 4886.0483,-2222.4204 4876.4127,-2096.0487 4873.3166,-2040.5325"/>
<polygon fill="#000000" stroke="#000000" points="4876.8042,-2040.2034 4872.7814,-2030.4021 4869.8139,-2040.5728 4876.8042,-2040.2034"/>
</g>
<!-- prose_61 -->
<g id="node62" class="node">
<title>prose_61</title>
<ellipse fill="none" stroke="#000000" cx="4954" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4954" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_61 -->
<g id="edge61" class="edge">
<title>section_28&#45;&gt;prose_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4954,-2408.5269C4954,-2343.3439 4954,-2120.0411 4954,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="4957.5001,-2040.2756 4954,-2030.2756 4950.5001,-2040.2756 4957.5001,-2040.2756"/>
</g>
<!-- prose_62 -->
<g id="node63" class="node">
<title>prose_62</title>
<ellipse fill="none" stroke="#000000" cx="5508" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5508" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_62 -->
<g id="edge62" class="edge">
<title>section_28&#45;&gt;prose_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4977.0994,-2409.3212C5065.856,-2342.9138 5384.7864,-2104.2912 5480.5937,-2032.6086"/>
<polygon fill="#000000" stroke="#000000" points="5482.7361,-2035.377 5488.6462,-2026.5837 5478.5425,-2029.7721 5482.7361,-2035.377"/>
</g>
<!-- prose_63 -->
<g id="node64" class="node">
<title>prose_63</title>
<ellipse fill="none" stroke="#000000" cx="5590" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5590" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_28&#45;&gt;prose_63 -->
<g id="edge63" class="edge">
<title>section_28&#45;&gt;prose_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5029.1167,-2424.5146C5172.7769,-2418.8623 5478.4864,-2398.3105 5549,-2325.0039 5624.6008,-2246.4086 5607.4241,-2100.8673 5596.0401,-2040.0012"/>
<polygon fill="#000000" stroke="#000000" points="5599.4349,-2039.1245 5594.0735,-2029.9863 5592.566,-2040.4733 5599.4349,-2039.1245"/>
</g>
<!-- codeblock_64 -->
<g id="node65" class="node">
<title>codeblock_64</title>
<ellipse fill="none" stroke="#000000" cx="5728" cy="-2012.1033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5728" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 247&#45;280</text>
</g>
<!-- section_28&#45;&gt;codeblock_64 -->
<g id="edge64" class="edge">
<title>section_28&#45;&gt;codeblock_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5029.355,-2425.1088C5186.4664,-2420.4698 5541.8495,-2401.5655 5631,-2325.0039 5716.8823,-2251.249 5727.854,-2103.0209 5728.4853,-2040.7198"/>
<polygon fill="#000000" stroke="#000000" points="5731.9856,-2040.4674 5728.5011,-2030.4619 5724.9856,-2040.4565 5731.9856,-2040.4674"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="1887,-912.6029 1549,-912.6029 1549,-856.7999 1887,-856.7999 1887,-912.6029"/>
<text text-anchor="middle" x="1718" y="-865.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">This defines the persistence model for bridge.</text>
</g>
<!-- raw_30&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>raw_30&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2211.5573,-1994.1188C2223.9132,-1940.6727 2251.9447,-1781.4218 2171,-1699.2027 2084.5218,-1611.3631 1987.1858,-1746.1451 1896,-1663.2027 1675.285,-1462.4409 1699.8634,-1049.081 1713.304,-922.4225"/>
<polygon fill="#000000" stroke="#000000" points="1716.7885,-922.7546 1714.4054,-912.4313 1709.8306,-921.9875 1716.7885,-922.7546"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2047,-902.7014 1905,-902.7014 1905,-866.7014 2047,-866.7014 2047,-902.7014"/>
<text text-anchor="middle" x="1976" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** SQLite battery</text>
</g>
<!-- header_32&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>header_32&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2331.9238,-1993.9674C2333.5974,-1940.0985 2330.6537,-1779.7887 2243,-1699.2027 2180.6932,-1641.9199 2113.1639,-1725.6187 2056,-1663.2027 1853.5357,-1442.1367 1940.6354,-1023.8655 1968.5659,-912.514"/>
<polygon fill="#000000" stroke="#000000" points="1971.9856,-913.2685 1971.0725,-902.713 1965.2038,-911.534 1971.9856,-913.2685"/>
</g>
<!-- raw_36 -->
<g id="node37" class="node">
<title>raw_36</title>
<ellipse fill="none" stroke="#000000" cx="2092" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2092" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_33&#45;&gt;raw_36 -->
<g id="edge36" class="edge">
<title>prose_33&#45;&gt;raw_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.2493,-1994.0473C2475.6937,-1940.4015 2501.0364,-1780.6503 2419,-1699.2027 2326.519,-1607.3856 2216.5404,-1758.8255 2128,-1663.2027 2025.0568,-1552.0251 2074.6862,-1039.4922 2088.7156,-912.9877"/>
<polygon fill="#000000" stroke="#000000" points="2092.2071,-913.2583 2089.8469,-902.9298 2085.251,-912.4758 2092.2071,-913.2583"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2685,-1663.2041 2137,-1663.2041 2137,-106.1988 2685,-106.1988 2685,-1663.2041"/>
<text text-anchor="middle" x="2411" y="-1648.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.HISTORY_LIMIT = 1000</text>
<text text-anchor="middle" x="2411" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_project_table = [[</text>
<text text-anchor="middle" x="2411" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS project (</text>
<text text-anchor="middle" x="2411" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">project_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">directory TEXT UNIQUE,</text>
<text text-anchor="middle" x="2411" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP );</text>
<text text-anchor="middle" x="2411" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_repl_table = [[</text>
<text text-anchor="middle" x="2411" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS repl (</text>
<text text-anchor="middle" x="2411" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1462.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1446.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">line TEXT,</text>
<text text-anchor="middle" x="2411" y="-1431.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">time DATETIME DEFAULT CURRENT_TIMESTAMP,</text>
<text text-anchor="middle" x="2411" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2411" y="-1400.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2411" y="-1385.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-1369.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_result_table = [[</text>
<text text-anchor="middle" x="2411" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS result (</text>
<text text-anchor="middle" x="2411" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">result_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">line_id INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">repr text NOT NULL,</text>
<text text-anchor="middle" x="2411" y="-1261.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">value blob,</text>
<text text-anchor="middle" x="2411" y="-1245.802" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (line_id)</text>
<text text-anchor="middle" x="2411" y="-1230.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES repl (line_id)</text>
<text text-anchor="middle" x="2411" y="-1215.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-1199.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-1168.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local create_session_table = [[</text>
<text text-anchor="middle" x="2411" y="-1152.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">CREATE TABLE IF NOT EXISTS session (</text>
<text text-anchor="middle" x="2411" y="-1137.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">session_id INTEGER PRIMARY KEY AUTOINCREMENT,</text>
<text text-anchor="middle" x="2411" y="-1122.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">name TEXT,</text>
<text text-anchor="middle" x="2411" y="-1106.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">project INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1091.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; These two are line_ids</text>
<text text-anchor="middle" x="2411" y="-1075.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">start INTEGER NOT NULL,</text>
<text text-anchor="middle" x="2411" y="-1060.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end INTEGER,</text>
<text text-anchor="middle" x="2411" y="-1045.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">test BOOLEAN,</text>
<text text-anchor="middle" x="2411" y="-1029.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">sha TEXT,</text>
<text text-anchor="middle" x="2411" y="-1014.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">FOREIGN KEY (project)</text>
<text text-anchor="middle" x="2411" y="-998.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;REFERENCES project (project_id)</text>
<text text-anchor="middle" x="2411" y="-983.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ON DELETE CASCADE );</text>
<text text-anchor="middle" x="2411" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-936.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_line = [[</text>
<text text-anchor="middle" x="2411" y="-921.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO repl (project, line) VALUES (:project, :line);</text>
<text text-anchor="middle" x="2411" y="-905.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-874.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_result = [[</text>
<text text-anchor="middle" x="2411" y="-859.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO result (line_id, repr) VALUES (:line_id, :repr);</text>
<text text-anchor="middle" x="2411" y="-843.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local insert_project = [[</text>
<text text-anchor="middle" x="2411" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">INSERT INTO project (directory) VALUES (:dir);</text>
<text text-anchor="middle" x="2411" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_tables = [[</text>
<text text-anchor="middle" x="2411" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;</text>
<text text-anchor="middle" x="2411" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-687.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_recent = [[</text>
<text text-anchor="middle" x="2411" y="-672.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (line_id AS REAL), line FROM repl</text>
<text text-anchor="middle" x="2411" y="-657.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE project = %d</text>
<text text-anchor="middle" x="2411" y="-641.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ORDER BY time</text>
<text text-anchor="middle" x="2411" y="-626.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;DESC LIMIT %d;</text>
<text text-anchor="middle" x="2411" y="-610.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-579.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_project = [[</text>
<text text-anchor="middle" x="2411" y="-564.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT project_id FROM project</text>
<text text-anchor="middle" x="2411" y="-548.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;WHERE directory = %s;</text>
<text text-anchor="middle" x="2411" y="-533.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local get_reprs = [[</text>
<text text-anchor="middle" x="2411" y="-486.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">SELECT CAST (repl.line_id AS REAL), result.repr</text>
<text text-anchor="middle" x="2411" y="-471.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">FROM repl</text>
<text text-anchor="middle" x="2411" y="-455.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">LEFT OUTER JOIN result</text>
<text text-anchor="middle" x="2411" y="-440.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">ON repl.line_id = result.line_id</text>
<text text-anchor="middle" x="2411" y="-424.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">WHERE repl.project = %d</text>
<text text-anchor="middle" x="2411" y="-409.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">ORDER BY result.result_id</text>
<text text-anchor="middle" x="2411" y="-394.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">DESC LIMIT %d;</text>
<text text-anchor="middle" x="2411" y="-378.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2411" y="-347.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local home_dir = io.popen(&quot;echo $HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bridge_home = io.popen(&quot;echo $BRIDGE_HOME&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.bridge_home = bridge_home ~= &quot;&quot; and bridge_home</text>
<text text-anchor="middle" x="2411" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or home_dir .. &quot;/.bridge&quot;</text>
<text text-anchor="middle" x="2411" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.project = io.popen(&quot;pwd&quot;, &quot;r&quot;):read(&quot;*a&quot;):sub(1, &#45;2)</text>
<text text-anchor="middle" x="2411" y="-222.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function has(table, name)</text>
<text text-anchor="middle" x="2411" y="-206.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(table) do</text>
<text text-anchor="middle" x="2411" y="-191.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if name == v then</text>
<text text-anchor="middle" x="2411" y="-176.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="2411" y="-160.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2411" y="-145.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2411" y="-129.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return false</text>
<text text-anchor="middle" x="2411" y="-114.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_34&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>codeblock_34&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2590.0675,-1993.9379C2582.7694,-1948.7296 2562.6176,-1823.899 2538.3359,-1673.486"/>
<polygon fill="#000000" stroke="#000000" points="2541.7797,-1672.8565 2536.7307,-1663.5421 2534.8692,-1673.9721 2541.7797,-1672.8565"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="2119,-53.1 2065,-53.1 2065,-17.1 2119,-17.1 2119,-53.1"/>
</g>
<!-- raw_36&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>raw_36&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2092,-866.5632C2092,-758.2631 2092,-197.2221 2092,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="2095.5001,-63.4293 2092,-53.4293 2088.5001,-63.4293 2095.5001,-63.4293"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="2859,-902.7014 2703,-902.7014 2703,-866.7014 2859,-866.7014 2859,-902.7014"/>
<text text-anchor="middle" x="2781" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:load()</text>
</g>
<!-- header_39&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>header_39&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2776.0806,-1993.9379C2776.6577,-1863.8043 2780.1608,-1073.9236 2780.8735,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="2784.3754,-912.7717 2780.9199,-902.7562 2777.3755,-912.7405 2784.3754,-912.7717"/>
</g>
<!-- raw_44 -->
<g id="node45" class="node">
<title>raw_44</title>
<ellipse fill="none" stroke="#000000" cx="2904" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2904" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_40&#45;&gt;raw_44 -->
<g id="edge44" class="edge">
<title>prose_40&#45;&gt;raw_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2908.9194,-1993.9379C2908.3423,-1863.8043 2904.8392,-1073.9236 2904.1265,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="2907.6245,-912.7405 2904.0801,-902.7562 2900.6246,-912.7717 2907.6245,-912.7405"/>
</g>
<!-- raw_46 -->
<g id="node47" class="node">
<title>raw_46</title>
<ellipse fill="none" stroke="#000000" cx="2976" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="2976" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_46 -->
<g id="edge46" class="edge">
<title>prose_41&#45;&gt;raw_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2990.7583,-1993.9379C2989.0269,-1863.8043 2978.5176,-1073.9236 2976.3795,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="2979.873,-912.7087 2976.2402,-902.7562 2972.8737,-912.8019 2979.873,-912.7087"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3576.5,-1412.5035 3021.5,-1412.5035 3021.5,-356.8993 3576.5,-356.8993 3576.5,-1412.5035"/>
<text text-anchor="middle" x="3299" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.load(historian)</text>
<text text-anchor="middle" x="3299" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local conn = sql.open(historian.bridge_home)</text>
<text text-anchor="middle" x="3299" y="-1366.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.conn = conn</text>
<text text-anchor="middle" x="3299" y="-1351.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Set up bridge tables</text>
<text text-anchor="middle" x="3299" y="-1335.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn.pragma.foreign_keys(true)</text>
<text text-anchor="middle" x="3299" y="-1320.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_project_table)</text>
<text text-anchor="middle" x="3299" y="-1305.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_result_table)</text>
<text text-anchor="middle" x="3299" y="-1289.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_repl_table)</text>
<text text-anchor="middle" x="3299" y="-1274.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;conn:exec(create_session_table)</text>
<text text-anchor="middle" x="3299" y="-1258.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrive project id</text>
<text text-anchor="middle" x="3299" y="-1243.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3299" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3299" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3299" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local ins_proj_stmt = conn:prepare(insert_project)</text>
<text text-anchor="middle" x="3299" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;ins_proj_stmt:bindkv {dir = historian.project}</text>
<text text-anchor="middle" x="3299" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = ins_proj_stmt:step()</text>
<text text-anchor="middle" x="3299" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; retry</text>
<text text-anchor="middle" x="3299" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;proj_val, proj_row = sql.pexec(conn,</text>
<text text-anchor="middle" x="3299" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sql.format(get_project, historian.project),</text>
<text text-anchor="middle" x="3299" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not proj_val then</text>
<text text-anchor="middle" x="3299" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;Could not create project in .bridge&quot;</text>
<text text-anchor="middle" x="3299" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local project_id = proj_val[1][1]</text>
<text text-anchor="middle" x="3299" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.project_id = project_id</text>
<text text-anchor="middle" x="3299" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Create insert prepared statements</text>
<text text-anchor="middle" x="3299" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_line = conn:prepare(insert_line)</text>
<text text-anchor="middle" x="3299" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.insert_result = conn:prepare(insert_result)</text>
<text text-anchor="middle" x="3299" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Retrieve history</text>
<text text-anchor="middle" x="3299" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local pop_str = sql.format(get_recent, project_id,</text>
<text text-anchor="middle" x="3299" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT)</text>
<text text-anchor="middle" x="3299" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local repl_val, repl_row = sql.pexec(conn, pop_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_str = sql.format(get_reprs, project_id,</text>
<text text-anchor="middle" x="3299" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.HISTORY_LIMIT * 2)</text>
<text text-anchor="middle" x="3299" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local res_val, res_row = sql.pexec(conn, res_str, &quot;i&quot;)</text>
<text text-anchor="middle" x="3299" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if repl_val and res_val then</text>
<text text-anchor="middle" x="3299" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lines = reverse(repl_val[2])</text>
<text text-anchor="middle" x="3299" y="-780.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_ids = reverse(repl_val[1])</text>
<text text-anchor="middle" x="3299" y="-765.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local repl_map = {}</text>
<text text-anchor="middle" x="3299" y="-750.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i, v in ipairs(lines) do</text>
<text text-anchor="middle" x="3299" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = Txtbuf(v)</text>
<text text-anchor="middle" x="3299" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian[i] = buf</text>
<text text-anchor="middle" x="3299" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repl_map[line_ids[i]] = buf</text>
<text text-anchor="middle" x="3299" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian</text>
<text text-anchor="middle" x="3299" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; reuse line_id var for foreign keys</text>
<text text-anchor="middle" x="3299" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;line_ids = res_val[1]</text>
<text text-anchor="middle" x="3299" y="-626.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local reprs = res_val[2]</text>
<text text-anchor="middle" x="3299" y="-611.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; This is keyed by txtbuf with a string value.</text>
<text text-anchor="middle" x="3299" y="-596.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local result_map = {}</text>
<text text-anchor="middle" x="3299" y="-580.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, #reprs do</text>
<text text-anchor="middle" x="3299" y="-565.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local buf = repl_map[line_ids[i]]</text>
<text text-anchor="middle" x="3299" y="-549.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if buf then</text>
<text text-anchor="middle" x="3299" y="-534.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local result = result_map[buf] or {frozen = true}</text>
<text text-anchor="middle" x="3299" y="-519.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result[#result + 1] = reprs[i]</text>
<text text-anchor="middle" x="3299" y="-503.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result.n = #result &#45;&#45; for compat with nil in live use</text>
<text text-anchor="middle" x="3299" y="-488.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;result_map[buf] = result</text>
<text text-anchor="middle" x="3299" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-442.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = result_map</text>
<text text-anchor="middle" x="3299" y="-426.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3299" y="-411.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.results = {}</text>
<text text-anchor="middle" x="3299" y="-395.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = 0</text>
<text text-anchor="middle" x="3299" y="-380.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3299" y="-365.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_42&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_42&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3212.4179,-1993.9379C3217.801,-1924.973 3237.6471,-1670.7167 3256.9819,-1423.0114"/>
<polygon fill="#000000" stroke="#000000" points="3260.4967,-1422.9571 3257.7856,-1412.715 3253.5179,-1422.4123 3260.4967,-1422.9571"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="2708.5,-63.0015 2195.5,-63.0015 2195.5,-7.1986 2708.5,-7.1986 2708.5,-63.0015"/>
<text text-anchor="middle" x="2452" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Brings up the project history and (eventually) results and user config.</text>
</g>
<!-- raw_44&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>raw_44&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2906.0736,-866.545C2917.7592,-760.6092 2971.2729,-223.0342 2868,-106.2001 2860.288,-97.4755 2757.6271,-79.8796 2656.2314,-64.3762"/>
<polygon fill="#000000" stroke="#000000" points="2656.5228,-60.8804 2646.1098,-62.8348 2655.4688,-67.8006 2656.5228,-60.8804"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="3225.5,-62.4005 2726.5,-62.4005 2726.5,-7.7996 3225.5,-7.7996 3225.5,-62.4005"/>
<text text-anchor="middle" x="2976" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Most of the complexity serves to make a simple key/value relationship</text>
<text text-anchor="middle" x="2976" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">between the regenerated txtbufs and their associated result history.</text>
</g>
<!-- raw_46&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>raw_46&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2976,-866.5632C2976,-760.635 2976,-221.5794 2976,-73.0416"/>
<polygon fill="#000000" stroke="#000000" points="2979.5001,-72.6367 2976,-62.6367 2972.5001,-72.6368 2979.5001,-72.6367"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="3925.5,-902.7014 3594.5,-902.7014 3594.5,-866.7014 3925.5,-866.7014 3925.5,-902.7014"/>
<text text-anchor="middle" x="3760" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:restore_session(modeS, session)</text>
</g>
<!-- header_49&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>header_49&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3727.5317,-1993.9379C3731.3408,-1863.8043 3754.4613,-1073.9236 3759.1652,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="3762.6773,-912.8544 3759.4715,-902.7562 3755.6803,-912.6495 3762.6773,-912.8544"/>
</g>
<!-- raw_54 -->
<g id="node55" class="node">
<title>raw_54</title>
<ellipse fill="none" stroke="#000000" cx="3971" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="3971" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_50&#45;&gt;raw_54 -->
<g id="edge54" class="edge">
<title>prose_50&#45;&gt;raw_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3968.0483,-1993.9379C3968.3946,-1863.8043 3970.4965,-1073.9236 3970.9241,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="3974.4252,-912.7655 3970.952,-902.7562 3967.4253,-912.7468 3974.4252,-912.7655"/>
</g>
<!-- raw_56 -->
<g id="node57" class="node">
<title>raw_56</title>
<ellipse fill="none" stroke="#000000" cx="4048" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4048" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_51&#45;&gt;raw_56 -->
<g id="edge56" class="edge">
<title>prose_51&#45;&gt;raw_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4049.9678,-1993.9379C4049.7369,-1863.8043 4048.3357,-1073.9236 4048.0506,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="4051.5499,-912.7499 4048.032,-902.7562 4044.5499,-912.7624 4051.5499,-912.7499"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="4215,-902.7014 4161,-902.7014 4161,-866.7014 4215,-866.7014 4215,-902.7014"/>
</g>
<!-- codeblock_52&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>codeblock_52&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4188,-1993.9379C4188,-1863.8043 4188,-1073.9236 4188,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="4191.5001,-912.7562 4188,-902.7562 4184.5001,-912.7562 4191.5001,-912.7562"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3610,-63.0015 3244,-63.0015 3244,-7.1986 3610,-7.1986 3610,-63.0015"/>
<text text-anchor="middle" x="3427" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">If there is an open session, we want to replay it.</text>
</g>
<!-- raw_54&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>raw_54&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3973.1435,-866.4566C3985.2235,-760.0173 4040.5535,-220.0631 3934,-106.2001 3885.8589,-54.7566 3688.6927,-80.541 3619,-70.2001 3607.2815,-68.4613 3595.1829,-66.5428 3583.0264,-64.5261"/>
<polygon fill="#000000" stroke="#000000" points="3583.25,-61.0148 3572.8085,-62.8108 3582.0911,-67.9182 3583.25,-61.0148"/>
</g>
<!-- leaf_57 -->
<g id="node58" class="node">
<title>leaf_57</title>
<polygon fill="none" stroke="#c0c0c0" points="3973.5,-55.0021 3628.5,-55.0021 3628.5,-15.198 3973.5,-15.198 3973.5,-55.0021"/>
<text text-anchor="middle" x="3801" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">To do this, we need to borrow the modeselektor.</text>
</g>
<!-- raw_56&#45;&gt;leaf_57 -->
<g id="edge57" class="edge">
<title>raw_56&#45;&gt;leaf_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4053.4764,-867.0485C4080.6252,-775.7741 4192.2448,-352.1496 4007,-106.2001 3992.9481,-87.5434 3944.533,-70.3443 3898.1698,-57.5365"/>
<polygon fill="#000000" stroke="#000000" points="3898.8877,-54.1049 3888.3207,-54.8711 3897.0592,-60.8619 3898.8877,-54.1049"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4817.5,-902.7014 4598.5,-902.7014 4598.5,-866.7014 4817.5,-866.7014 4817.5,-902.7014"/>
<text text-anchor="middle" x="4708" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:persist(txtbuf)</text>
</g>
<!-- header_59&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>header_59&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4708,-1993.9379C4708,-1863.8043 4708,-1073.9236 4708,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="4711.5001,-912.7562 4708,-902.7562 4704.5001,-912.7562 4711.5001,-912.7562"/>
</g>
<!-- raw_66 -->
<g id="node67" class="node">
<title>raw_66</title>
<ellipse fill="none" stroke="#000000" cx="4867" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4867" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_60&#45;&gt;raw_66 -->
<g id="edge66" class="edge">
<title>prose_60&#45;&gt;raw_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4871.9194,-1993.9379C4871.3423,-1863.8043 4867.8392,-1073.9236 4867.1265,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="4870.6245,-912.7405 4867.0801,-902.7562 4863.6246,-912.7717 4870.6245,-912.7405"/>
</g>
<!-- raw_68 -->
<g id="node69" class="node">
<title>raw_68</title>
<ellipse fill="none" stroke="#000000" cx="4946" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="4946" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_61&#45;&gt;raw_68 -->
<g id="edge68" class="edge">
<title>prose_61&#45;&gt;raw_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4953.8711,-1993.9379C4952.9477,-1863.8043 4947.3427,-1073.9236 4946.2024,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="4949.6991,-912.7311 4946.1281,-902.7562 4942.6993,-912.7808 4949.6991,-912.7311"/>
</g>
<!-- raw_70 -->
<g id="node71" class="node">
<title>raw_70</title>
<ellipse fill="none" stroke="#000000" cx="5223" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5223" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_70 -->
<g id="edge70" class="edge">
<title>prose_62&#45;&gt;raw_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5498.5812,-1994.5095C5472.1018,-1944.2963 5396.3733,-1795.4095 5357,-1663.2027 5271.9266,-1377.5452 5234.7234,-1015.8276 5225.4253,-913.0699"/>
<polygon fill="#000000" stroke="#000000" points="5228.8917,-912.5354 5224.5191,-902.885 5221.9192,-913.1558 5228.8917,-912.5354"/>
</g>
<!-- prespace_71 -->
<g id="node72" class="node">
<title>prespace_71</title>
<ellipse fill="none" stroke="#000000" cx="5412" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5412" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_62&#45;&gt;prespace_71 -->
<g id="edge71" class="edge">
<title>prose_62&#45;&gt;prespace_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5505.6466,-1993.9705C5499.0049,-1942.3391 5479.8309,-1790.0792 5468,-1663.2027 5440.688,-1370.3043 5419.427,-1014.3329 5413.595,-912.8892"/>
<polygon fill="#000000" stroke="#000000" points="5417.085,-912.6131 5413.0194,-902.8294 5410.0964,-913.013 5417.085,-912.6131"/>
</g>
<!-- literal_72 -->
<g id="node73" class="node">
<title>literal_72</title>
<ellipse fill="none" stroke="#000000" cx="5508" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5508" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_62&#45;&gt;literal_72 -->
<g id="edge72" class="edge">
<title>prose_62&#45;&gt;literal_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5508,-1993.9379C5508,-1863.8043 5508,-1073.9236 5508,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="5511.5001,-912.7562 5508,-902.7562 5504.5001,-912.7562 5511.5001,-912.7562"/>
</g>
<!-- raw_73 -->
<g id="node74" class="node">
<title>raw_73</title>
<ellipse fill="none" stroke="#000000" cx="5584" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5584" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_73 -->
<g id="edge73" class="edge">
<title>prose_62&#45;&gt;raw_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5510.5177,-1993.9847C5517.5917,-1942.3909 5537.794,-1790.2202 5548,-1663.2027 5571.5252,-1370.4218 5581.0395,-1014.3686 5583.3882,-912.8974"/>
<polygon fill="#000000" stroke="#000000" points="5586.8887,-912.9117 5583.6168,-902.8347 5579.8905,-912.7527 5586.8887,-912.9117"/>
</g>
<!-- prespace_74 -->
<g id="node75" class="node">
<title>prespace_74</title>
<ellipse fill="none" stroke="#000000" cx="5675" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="5675" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_62&#45;&gt;prespace_74 -->
<g id="edge74" class="edge">
<title>prose_62&#45;&gt;prespace_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5505.0036,-1994.1561C5497.4532,-1942.7913 5482.6916,-1792.8913 5549,-1699.2027 5569.4392,-1670.3238 5600.4327,-1692.6794 5620,-1663.2027 5784.4411,-1415.4844 5707.3784,-1020.4198 5682.0157,-912.6392"/>
<polygon fill="#000000" stroke="#000000" points="5685.4019,-911.7508 5679.6647,-902.8438 5678.5952,-913.3845 5685.4019,-911.7508"/>
</g>
<!-- literal_75 -->
<g id="node76" class="node">
<title>literal_75</title>
<ellipse fill="none" stroke="#000000" cx="5771" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="5771" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_62&#45;&gt;literal_75 -->
<g id="edge75" class="edge">
<title>prose_62&#45;&gt;literal_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5503.9562,-1993.943C5493.2639,-1940.6906 5470.188,-1783.3995 5549,-1699.2027 5605.0506,-1639.3225 5676.3166,-1725.2141 5730,-1663.2027 5829.2023,-1548.6112 5786.205,-1038.638 5773.8936,-912.8274"/>
<polygon fill="#000000" stroke="#000000" points="5777.3714,-912.43 5772.8996,-902.8252 5770.4057,-913.1223 5777.3714,-912.43"/>
</g>
<!-- raw_76 -->
<g id="node77" class="node">
<title>raw_76</title>
<ellipse fill="none" stroke="#000000" cx="5847" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5847" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_62&#45;&gt;raw_76 -->
<g id="edge76" class="edge">
<title>prose_62&#45;&gt;raw_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5503.8017,-1994.0983C5492.4997,-1940.595 5467.5137,-1781.2007 5549,-1699.2027 5631.8518,-1615.8307 5731.7254,-1749.9832 5811,-1663.2027 5913.1924,-1551.3347 5864.126,-1039.3194 5850.2492,-912.9553"/>
<polygon fill="#000000" stroke="#000000" points="5853.7157,-912.4597 5849.1301,-902.9086 5846.7587,-913.2346 5853.7157,-912.4597"/>
</g>
<!-- raw_84 -->
<g id="node85" class="node">
<title>raw_84</title>
<ellipse fill="none" stroke="#000000" cx="5919" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="5919" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_63&#45;&gt;raw_84 -->
<g id="edge84" class="edge">
<title>prose_63&#45;&gt;raw_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5585.8909,-1994.1119C5574.8483,-1940.6465 5550.5933,-1781.3475 5632,-1699.2027 5711.3285,-1619.1551 5807.2367,-1746.6327 5883,-1663.2027 5984.8617,-1551.0334 5936.0432,-1039.244 5922.2336,-912.9411"/>
<polygon fill="#000000" stroke="#000000" points="5925.701,-912.4526 5921.12,-902.8994 5918.7437,-913.2243 5925.701,-912.4526"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6470,-1135.6025 5964,-1135.6025 5964,-633.8003 6470,-633.8003 6470,-1135.6025"/>
<text text-anchor="middle" x="6217" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.persist(historian, txtbuf, results)</text>
<text text-anchor="middle" x="6217" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="6217" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if lb ~= &quot;&quot; then</text>
<text text-anchor="middle" x="6217" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.insert_line:bindkv { project = historian.project_id,</text>
<text text-anchor="middle" x="6217" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;line &#160;&#160;&#160;= lb }</text>
<text text-anchor="middle" x="6217" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local err = historian.insert_line:step()</text>
<text text-anchor="middle" x="6217" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6217" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_line:clearbind():reset()</text>
<text text-anchor="middle" x="6217" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6217" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(err)</text>
<text text-anchor="middle" x="6217" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local line_id = sql.lastRowId(historian.conn)</text>
<text text-anchor="middle" x="6217" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if results and type(results) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6217" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _,v in ipairs(reverse(results)) do</text>
<text text-anchor="middle" x="6217" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; insert result repr</text>
<text text-anchor="middle" x="6217" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; tostring() just for compactness</text>
<text text-anchor="middle" x="6217" y="-873.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:bindkv { line_id = line_id,</text>
<text text-anchor="middle" x="6217" y="-858.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repr = color.ts(v) }</text>
<text text-anchor="middle" x="6217" y="-843.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;err = historian.insert_result:step()</text>
<text text-anchor="middle" x="6217" y="-827.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not err then</text>
<text text-anchor="middle" x="6217" y="-812.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;historian.insert_result:clearbind():reset()</text>
<text text-anchor="middle" x="6217" y="-796.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-781.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-766.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-734.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="6217" y="-719.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="6217" y="-703.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; A blank line can have no results and is uninteresting.</text>
<text text-anchor="middle" x="6217" y="-688.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="6217" y="-673.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6217" y="-657.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="6217" y="-642.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_64&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>codeblock_64&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5727.8871,-1993.86C5728.5875,-1940.3793 5738.1841,-1782.5237 5824,-1699.2027 5867.3207,-1657.1416 5911.1165,-1704.6764 5955,-1663.2027 6097.0117,-1528.9894 6162.061,-1315.4243 6191.8508,-1145.9005"/>
<polygon fill="#000000" stroke="#000000" points="6195.3382,-1146.2725 6193.5894,-1135.823 6188.4401,-1145.0823 6195.3382,-1146.2725"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="4266.5,-63.0015 3991.5,-63.0015 3991.5,-7.1986 4266.5,-7.1986 4266.5,-63.0015"/>
<text text-anchor="middle" x="4129" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Persists a line and results to store.</text>
</g>
<!-- raw_66&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>raw_66&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4869.084,-866.7177C4880.9532,-760.6233 4935.7109,-217.3182 4826,-106.2001 4782.9723,-62.6205 4336.5554,-79.3444 4276,-70.2001 4266.0713,-68.7008 4255.826,-66.8654 4245.5807,-64.8278"/>
<polygon fill="#000000" stroke="#000000" points="4246.2673,-61.3958 4235.7682,-62.8167 4244.8618,-68.2533 4246.2673,-61.3958"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="4847,-70.3004 4285,-70.3004 4285,.1003 4847,.1003 4847,-70.3004"/>
<text text-anchor="middle" x="4566" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">The hooks are in place to persist the results. I&#39;m starting with a string</text>
<text text-anchor="middle" x="4566" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">representation; the goal is to provide the sense of persistence across</text>
<text text-anchor="middle" x="4566" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">sessions, and supplement that over time with better and better approximations.</text>
</g>
<!-- raw_68&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>raw_68&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4951.8776,-866.9014C4981.3338,-774.0063 5103.7239,-340.1904 4903,-106.2001 4891.6267,-92.9418 4867.8909,-82.0319 4838.028,-73.089"/>
<polygon fill="#000000" stroke="#000000" points="4838.702,-69.6414 4828.1249,-70.2541 4836.7755,-76.3711 4838.702,-69.6414"/>
</g>
<!-- leaf_77 -->
<g id="node78" class="node">
<title>leaf_77</title>
<polygon fill="none" stroke="#c0c0c0" points="5385,-62.4005 4865,-62.4005 4865,-7.7996 5385,-7.7996 5385,-62.4005"/>
<text text-anchor="middle" x="5125" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">To really nail it down will require semantic analysis and hence thorough</text>
<text text-anchor="middle" x="5125" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">parsing. &#160;General&#45;purpose persistence tools belong in</text>
</g>
<!-- raw_70&#45;&gt;leaf_77 -->
<g id="edge77" class="edge">
<title>raw_70&#45;&gt;leaf_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5220.9078,-866.5632C5208.6769,-760.5289 5146.3855,-220.4998 5129.3252,-72.5967"/>
<polygon fill="#000000" stroke="#000000" points="5132.7992,-72.1698 5128.1763,-62.6367 5125.8453,-72.972 5132.7992,-72.1698"/>
</g>
<!-- leaf_78 -->
<g id="node79" class="node">
<title>leaf_78</title>
<polygon fill="none" stroke="#c0c0c0" points="5457,-53.1 5403,-53.1 5403,-17.1 5457,-17.1 5457,-53.1"/>
<text text-anchor="middle" x="5430" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_71&#45;&gt;leaf_78 -->
<g id="edge78" class="edge">
<title>prespace_71&#45;&gt;leaf_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5412.3843,-866.5632C5414.6788,-758.2631 5426.5652,-197.2221 5429.3949,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="5432.899,-63.5012 5429.6117,-53.4293 5425.9005,-63.3529 5432.899,-63.5012"/>
</g>
<!-- leaf_79 -->
<g id="node80" class="node">
<title>leaf_79</title>
<polygon fill="none" stroke="#c0c0c0" points="5540.5,-53.1 5475.5,-53.1 5475.5,-17.1 5540.5,-17.1 5540.5,-53.1"/>
<text text-anchor="middle" x="5508" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlayer</text>
</g>
<!-- literal_72&#45;&gt;leaf_79 -->
<g id="edge79" class="edge">
<title>literal_72&#45;&gt;leaf_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5508,-866.5632C5508,-758.2631 5508,-197.2221 5508,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="5511.5001,-63.4293 5508,-53.4293 5504.5001,-63.4293 5511.5001,-63.4293"/>
</g>
<!-- leaf_80 -->
<g id="node81" class="node">
<title>leaf_80</title>
<polygon fill="none" stroke="#c0c0c0" points="5827,-54.4006 5559,-54.4006 5559,-15.7995 5827,-15.7995 5827,-54.4006"/>
<text text-anchor="middle" x="5693" y="-39.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">, which will</text>
<text text-anchor="middle" x="5693" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">merge with our increasingly&#45;modified</text>
</g>
<!-- raw_73&#45;&gt;leaf_80 -->
<g id="edge80" class="edge">
<title>raw_73&#45;&gt;leaf_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5583.0647,-866.6337C5577.9846,-763.4262 5556.2139,-248.1207 5620,-106.2001 5627.8815,-88.6642 5642.2262,-73.204 5656.1266,-61.2173"/>
<polygon fill="#000000" stroke="#000000" points="5658.707,-63.6268 5664.2074,-54.5716 5654.2606,-58.2203 5658.707,-63.6268"/>
</g>
<!-- leaf_81 -->
<g id="node82" class="node">
<title>leaf_81</title>
<polygon fill="none" stroke="#c0c0c0" points="5899,-53.1 5845,-53.1 5845,-17.1 5899,-17.1 5899,-53.1"/>
<text text-anchor="middle" x="5872" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_74&#45;&gt;leaf_81 -->
<g id="edge81" class="edge">
<title>prespace_74&#45;&gt;leaf_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5673.697,-866.4082C5666.5531,-760.8315 5635.8279,-229.8066 5731,-106.2001 5761.097,-67.1111 5793.9813,-96.0499 5836,-70.2001 5840.5306,-67.4129 5844.9441,-63.9638 5849.0395,-60.3258"/>
<polygon fill="#000000" stroke="#000000" points="5851.661,-62.6618 5856.4704,-53.2215 5846.8236,-57.6021 5851.661,-62.6618"/>
</g>
<!-- leaf_82 -->
<g id="node83" class="node">
<title>leaf_82</title>
<polygon fill="none" stroke="#c0c0c0" points="5975,-53.1 5917,-53.1 5917,-17.1 5975,-17.1 5975,-53.1"/>
<text text-anchor="middle" x="5946" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">sqlite</text>
</g>
<!-- literal_75&#45;&gt;leaf_82 -->
<g id="edge82" class="edge">
<title>literal_75&#45;&gt;leaf_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5769.3337,-866.4682C5760.0909,-761.2292 5718.7841,-231.7834 5811,-106.2001 5838.2168,-69.1351 5868.8107,-94.2576 5908,-70.2001 5912.5708,-67.3942 5917.0769,-63.9873 5921.2999,-60.4126"/>
<polygon fill="#000000" stroke="#000000" points="5923.9389,-62.7453 5929.0142,-53.4451 5919.247,-57.5504 5923.9389,-62.7453"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="6079,-53.1 5993,-53.1 5993,-17.1 6079,-17.1 6079,-53.1"/>
<text text-anchor="middle" x="6036" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> bindings.</text>
</g>
<!-- raw_76&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>raw_76&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5845.2062,-866.4562C5835.2323,-761.1498 5790.3148,-231.3889 5883,-106.2001 5911.3563,-67.8995 5941.4707,-91.7006 5984,-70.2001 5990.5491,-66.8892 5997.2528,-62.8899 6003.5761,-58.7937"/>
<polygon fill="#000000" stroke="#000000" points="6005.5563,-61.68 6011.9127,-53.2037 6001.6578,-55.866 6005.5563,-61.68"/>
</g>
<!-- leaf_85 -->
<g id="node86" class="node">
<title>leaf_85</title>
<polygon fill="none" stroke="#c0c0c0" points="6631,-62.4005 6097,-62.4005 6097,-7.7996 6631,-7.7996 6631,-62.4005"/>
<text text-anchor="middle" x="6364" y="-31.3001" font-family="Inconsolata" font-size="14.00" fill="#000000">Medium&#45;term goal is to hash any Lua object in a way that will resolve to a</text>
<text text-anchor="middle" x="6364" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">common value for any identical semantics.</text>
</g>
<!-- raw_84&#45;&gt;leaf_85 -->
<g id="edge85" class="edge">
<title>raw_84&#45;&gt;leaf_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5916.9313,-866.5494C5905.2739,-760.6384 5851.8931,-223.1808 5955,-106.2001 5962.653,-97.5174 6065.6301,-79.643 6166.3284,-63.9893"/>
<polygon fill="#000000" stroke="#000000" points="6167.0303,-67.4225 6176.3769,-62.4334 6165.9591,-60.5049 6167.0303,-67.4225"/>
</g>
<!-- leaf_90 -->
<g id="node91" class="node">
<title>leaf_90</title>
<polygon fill="none" stroke="#c0c0c0" points="6024.5,-2030.1033 5833.5,-2030.1033 5833.5,-1994.1033 6024.5,-1994.1033 6024.5,-2030.1033"/>
<text text-anchor="middle" x="5929" y="-2008.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:search(frag)</text>
</g>
<!-- header_87&#45;&gt;leaf_90 -->
<g id="edge90" class="edge">
<title>header_87&#45;&gt;leaf_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5924.2181,-2408.5269C5925.0043,-2343.3439 5927.698,-2120.0411 5928.6573,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="5932.1598,-2040.3171 5928.7808,-2030.2756 5925.1603,-2040.2326 5932.1598,-2040.3171"/>
</g>
<!-- raw_91 -->
<g id="node92" class="node">
<title>raw_91</title>
<ellipse fill="none" stroke="#000000" cx="6078" cy="-2012.1033" rx="27" ry="18"/>
<text text-anchor="middle" x="6078" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_88&#45;&gt;raw_91 -->
<g id="edge91" class="edge">
<title>prose_88&#45;&gt;raw_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6081.8256,-2408.5269C6081.1965,-2343.3439 6079.0416,-2120.0411 6078.2741,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="6081.7718,-2040.2413 6078.1754,-2030.2756 6074.7721,-2040.3089 6081.7718,-2040.2413"/>
</g>
<!-- leaf_93 -->
<g id="node94" class="node">
<title>leaf_93</title>
<polygon fill="none" stroke="#c0c0c0" points="6678.5,-2324.9045 6123.5,-2324.9045 6123.5,-1699.3021 6678.5,-1699.3021 6678.5,-2324.9045"/>
<text text-anchor="middle" x="6401" y="-2309.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, match = L.P, L.match</text>
<text text-anchor="middle" x="6401" y="-2278.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; second_best is broke and I don&#39;t know why</text>
<text text-anchor="middle" x="6401" y="-2263.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; also this fails on a single key search &gt;.&lt;</text>
<text text-anchor="middle" x="6401" y="-2247.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fuzz_patt(frag)</text>
<text text-anchor="middle" x="6401" y="-2232.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;frag = type(frag) == &quot;string&quot; and codepoints(frag) or frag</text>
<text text-anchor="middle" x="6401" y="-2216.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = &#160;&#160;&#160;&#160;&#160;&#160;&#160;(P(1) &#45; P(frag[1]))^0</text>
<text text-anchor="middle" x="6401" y="-2201.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1 , #frag &#45; 1 do</text>
<text text-anchor="middle" x="6401" y="-2186.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local v = frag[i]</text>
<text text-anchor="middle" x="6401" y="-2170.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;patt = patt * (P(v) * (P(1) &#45; P(frag[i + 1]))^0)</text>
<text text-anchor="middle" x="6401" y="-2155.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6401" y="-2139.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;patt = patt * P(frag[#frag])</text>
<text text-anchor="middle" x="6401" y="-2124.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return patt</text>
<text text-anchor="middle" x="6401" y="-2109.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6401" y="-2077.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.search(historian, frag)</text>
<text text-anchor="middle" x="6401" y="-2062.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local collection = {}</text>
<text text-anchor="middle" x="6401" y="-2046.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local best = true</text>
<text text-anchor="middle" x="6401" y="-2031.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt = fuzz_patt(frag)</text>
<text text-anchor="middle" x="6401" y="-2016.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="6401" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local score = match(patt, tostring(historian[i]))</text>
<text text-anchor="middle" x="6401" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="6401" y="-1969.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="6401" y="-1954.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6401" y="-1939.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6401" y="-1923.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if #collection == 0 then</text>
<text text-anchor="middle" x="6401" y="-1908.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; try the transpose</text>
<text text-anchor="middle" x="6401" y="-1892.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;best = false</text>
<text text-anchor="middle" x="6401" y="-1877.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local slip = sub(frag, 1, &#45;3) .. sub(frag, &#45;1, &#45;1) .. sub(frag, &#45;2, &#45;2)</text>
<text text-anchor="middle" x="6401" y="-1862.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local second = fuzz_patt(slip)</text>
<text text-anchor="middle" x="6401" y="-1846.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = #historian, 1, &#45;1 do</text>
<text text-anchor="middle" x="6401" y="-1831.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local score = match(second, tostring(historian[i]))</text>
<text text-anchor="middle" x="6401" y="-1815.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if score then</text>
<text text-anchor="middle" x="6401" y="-1800.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;collection[#collection + 1] = tostring(historian[i])</text>
<text text-anchor="middle" x="6401" y="-1785.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6401" y="-1769.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6401" y="-1754.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="6401" y="-1722.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return collection, best</text>
<text text-anchor="middle" x="6401" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_89&#45;&gt;leaf_93 -->
<g id="edge93" class="edge">
<title>codeblock_89&#45;&gt;leaf_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6313.0123,-2408.5269C6316.6167,-2392.2876 6322.3993,-2366.2342 6329.3241,-2335.0349"/>
<polygon fill="#000000" stroke="#000000" points="6332.7587,-2335.7131 6331.5087,-2325.1923 6325.925,-2334.1963 6332.7587,-2335.7131"/>
</g>
<!-- leaf_92 -->
<g id="node93" class="node">
<title>leaf_92</title>
<polygon fill="none" stroke="#c0c0c0" points="6542,-902.7014 6488,-902.7014 6488,-866.7014 6542,-866.7014 6542,-902.7014"/>
</g>
<!-- raw_91&#45;&gt;leaf_92 -->
<g id="edge92" class="edge">
<title>raw_91&#45;&gt;leaf_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6073.3222,-1993.9983C6060.63,-1940.2158 6031.756,-1780.1221 6114,-1699.2027 6172.0985,-1642.04 6422.8883,-1722.3169 6479,-1663.2027 6684.7214,-1446.4735 6562.2787,-1024.274 6524.7825,-912.436"/>
<polygon fill="#000000" stroke="#000000" points="6528.0672,-911.2238 6521.5317,-902.8848 6521.4405,-913.4793 6528.0672,-911.2238"/>
</g>
<!-- leaf_99 -->
<g id="node100" class="node">
<title>leaf_99</title>
<polygon fill="none" stroke="#c0c0c0" points="6845.5,-2030.1033 6696.5,-2030.1033 6696.5,-1994.1033 6845.5,-1994.1033 6845.5,-2030.1033"/>
<text text-anchor="middle" x="6771" y="-2008.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">** Historian:prev()</text>
</g>
<!-- header_94&#45;&gt;leaf_99 -->
<g id="edge99" class="edge">
<title>header_94&#45;&gt;leaf_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6780.5639,-2408.5269C6778.9913,-2343.3439 6773.604,-2120.0411 6771.6854,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="6775.1787,-2040.1882 6771.4384,-2030.2756 6768.1807,-2040.3571 6775.1787,-2040.1882"/>
</g>
<!-- raw_100 -->
<g id="node101" class="node">
<title>raw_100</title>
<ellipse fill="none" stroke="#000000" cx="6891" cy="-2012.1033" rx="27" ry="18"/>
<text text-anchor="middle" x="6891" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_95&#45;&gt;raw_100 -->
<g id="edge100" class="edge">
<title>prose_95&#45;&gt;raw_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6949.9694,-2408.835C6943.3694,-2388.7228 6932.9388,-2354.8692 6927,-2325.0039 6906.3535,-2221.1771 6896.3463,-2095.4426 6892.6942,-2040.3109"/>
<polygon fill="#000000" stroke="#000000" points="6896.182,-2040.008 6892.0472,-2030.2533 6889.1965,-2040.4574 6896.182,-2040.008"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="7316,-2113.4836 6936,-2113.4836 6936,-1910.723 7316,-1910.723 7316,-2113.4836"/>
<text text-anchor="middle" x="7126" y="-2098.3435" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.prev(historian)</text>
<text text-anchor="middle" x="7126" y="-2082.9434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="7126" y="-2067.5434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="7126" y="-2052.1434" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7126" y="-2036.7433" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &gt; 1 and 1 or 0</text>
<text text-anchor="middle" x="7126" y="-2017.9833" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor &#45; Δ]</text>
<text text-anchor="middle" x="7126" y="-1999.2233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = 1</text>
<text text-anchor="middle" x="7126" y="-1983.8233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="7126" y="-1968.4233" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor &#45; Δ</text>
<text text-anchor="middle" x="7126" y="-1949.6633" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="7126" y="-1934.2632" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return txtbuf:clone(), result</text>
<text text-anchor="middle" x="7126" y="-1918.8632" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_96&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>codeblock_96&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7105.9158,-2408.5269C7108.3811,-2359.8684 7115.3103,-2223.0977 7120.3412,-2123.797"/>
<polygon fill="#000000" stroke="#000000" points="7123.842,-2123.868 7120.8526,-2113.7037 7116.851,-2123.5138 7123.842,-2123.868"/>
</g>
<!-- header_103 -->
<g id="node104" class="node">
<title>header_103</title>
<ellipse fill="none" stroke="#000000" cx="7416" cy="-2012.1033" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="7416" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:next()</text>
</g>
<!-- section_97&#45;&gt;header_103 -->
<g id="edge103" class="edge">
<title>section_97&#45;&gt;header_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7541.0498,-2408.4537C7532.3629,-2388.2846 7518.3112,-2354.6463 7508,-2325.0039 7471.9109,-2221.2557 7437.6864,-2095.0614 7423.2251,-2040.0191"/>
<polygon fill="#000000" stroke="#000000" points="7426.5966,-2039.0774 7420.6801,-2030.2885 7419.8244,-2040.8487 7426.5966,-2039.0774"/>
</g>
<!-- prose_104 -->
<g id="node105" class="node">
<title>prose_104</title>
<ellipse fill="none" stroke="#000000" cx="7549" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7549" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_97&#45;&gt;prose_104 -->
<g id="edge104" class="edge">
<title>section_97&#45;&gt;prose_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7549,-2408.5269C7549,-2343.3439 7549,-2120.0411 7549,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="7552.5001,-2040.2756 7549,-2030.2756 7545.5001,-2040.2756 7552.5001,-2040.2756"/>
</g>
<!-- prose_105 -->
<g id="node106" class="node">
<title>prose_105</title>
<ellipse fill="none" stroke="#000000" cx="7664" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="7664" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_97&#45;&gt;prose_105 -->
<g id="edge105" class="edge">
<title>section_97&#45;&gt;prose_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7557.2535,-2408.5547C7566.2059,-2388.4739 7580.4888,-2354.9126 7590,-2325.0039 7622.7499,-2222.0189 7648.2861,-2095.853 7658.79,-2040.4609"/>
<polygon fill="#000000" stroke="#000000" points="7662.2822,-2040.8282 7660.6881,-2030.354 7655.4024,-2039.5362 7662.2822,-2040.8282"/>
</g>
<!-- codeblock_106 -->
<g id="node107" class="node">
<title>codeblock_106</title>
<ellipse fill="none" stroke="#000000" cx="7861" cy="-2012.1033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7861" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 354&#45;378</text>
</g>
<!-- section_97&#45;&gt;codeblock_106 -->
<g id="edge106" class="edge">
<title>section_97&#45;&gt;codeblock_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7584.1661,-2410.5825C7618.5825,-2393.4567 7670.6983,-2363.4874 7705,-2325.0039 7784.6315,-2235.6645 7834.1362,-2098.3391 7852.6856,-2039.9339"/>
<polygon fill="#000000" stroke="#000000" points="7856.0557,-2040.8833 7855.6918,-2030.2947 7849.3732,-2038.7992 7856.0557,-2040.8833"/>
</g>
<!-- header_119 -->
<g id="node120" class="node">
<title>header_119</title>
<ellipse fill="none" stroke="#000000" cx="8255" cy="-2012.1033" rx="95.2951" ry="18"/>
<text text-anchor="middle" x="8255" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Historian:append()</text>
</g>
<!-- section_98&#45;&gt;header_119 -->
<g id="edge119" class="edge">
<title>section_98&#45;&gt;header_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8453.6482,-2409.8805C8425.8312,-2392.1108 8384.0457,-2361.563 8359,-2325.0039 8295.6279,-2232.5001 8268.3472,-2098.3686 8259.0284,-2040.4669"/>
<polygon fill="#000000" stroke="#000000" points="8262.4358,-2039.5993 8257.4456,-2030.2532 8255.5184,-2040.6713 8262.4358,-2039.5993"/>
</g>
<!-- prose_120 -->
<g id="node121" class="node">
<title>prose_120</title>
<ellipse fill="none" stroke="#000000" cx="8400" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8400" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_98&#45;&gt;prose_120 -->
<g id="edge120" class="edge">
<title>section_98&#45;&gt;prose_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8473.1642,-2408.7237C8463.702,-2388.7908 8448.975,-2355.3584 8441,-2325.0039 8414.0483,-2222.4204 8404.4127,-2096.0487 8401.3166,-2040.5325"/>
<polygon fill="#000000" stroke="#000000" points="8404.8042,-2040.2034 8400.7814,-2030.4021 8397.8139,-2040.5728 8404.8042,-2040.2034"/>
</g>
<!-- prose_121 -->
<g id="node122" class="node">
<title>prose_121</title>
<ellipse fill="none" stroke="#000000" cx="8482" cy="-2012.1033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="8482" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_98&#45;&gt;prose_121 -->
<g id="edge121" class="edge">
<title>section_98&#45;&gt;prose_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8482,-2408.5269C8482,-2343.3439 8482,-2120.0411 8482,-2040.5119"/>
<polygon fill="#000000" stroke="#000000" points="8485.5001,-2040.2756 8482,-2030.2756 8478.5001,-2040.2756 8485.5001,-2040.2756"/>
</g>
<!-- codeblock_122 -->
<g id="node123" class="node">
<title>codeblock_122</title>
<ellipse fill="none" stroke="#000000" cx="8677" cy="-2012.1033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8677" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 387&#45;401</text>
</g>
<!-- section_98&#45;&gt;codeblock_122 -->
<g id="edge122" class="edge">
<title>section_98&#45;&gt;codeblock_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8490.5043,-2408.5269C8521.2948,-2343.0773 8627.0817,-2118.2119 8664.091,-2039.5433"/>
<polygon fill="#000000" stroke="#000000" points="8667.361,-2040.8142 8668.4509,-2030.2756 8661.0269,-2037.8344 8667.361,-2040.8142"/>
</g>
<!-- codeblock_123 -->
<g id="node124" class="node">
<title>codeblock_123</title>
<ellipse fill="none" stroke="#000000" cx="8991" cy="-2012.1033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8991" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 403&#45;410</text>
</g>
<!-- section_98&#45;&gt;codeblock_123 -->
<g id="edge123" class="edge">
<title>section_98&#45;&gt;codeblock_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8544.4178,-2416.4695C8607.267,-2403.7568 8704.474,-2377 8773,-2325.0039 8878.1686,-2245.204 8951.7635,-2099.8829 8979.1655,-2039.524"/>
<polygon fill="#000000" stroke="#000000" points="8982.4214,-2040.8169 8983.3099,-2030.2593 8976.0315,-2037.9584 8982.4214,-2040.8169"/>
</g>
<!-- codeblock_124 -->
<g id="node125" class="node">
<title>codeblock_124</title>
<ellipse fill="none" stroke="#000000" cx="9305" cy="-2012.1033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9305" y="-2007.9033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 412&#45;414</text>
</g>
<!-- section_98&#45;&gt;codeblock_124 -->
<g id="edge124" class="edge">
<title>section_98&#45;&gt;codeblock_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8554.5483,-2421.4435C8695.328,-2410.3074 8999.4271,-2380.4377 9087,-2325.0039 9199.077,-2254.0589 9269.2485,-2102.5156 9294.4616,-2039.9788"/>
<polygon fill="#000000" stroke="#000000" points="9297.8303,-2040.9776 9298.2539,-2030.3913 9291.321,-2038.4029 9297.8303,-2040.9776"/>
</g>
<!-- leaf_101 -->
<g id="node102" class="node">
<title>leaf_101</title>
<polygon fill="none" stroke="#c0c0c0" points="6918,-902.7014 6864,-902.7014 6864,-866.7014 6918,-866.7014 6918,-902.7014"/>
</g>
<!-- raw_100&#45;&gt;leaf_101 -->
<g id="edge101" class="edge">
<title>raw_100&#45;&gt;leaf_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6891,-1993.9379C6891,-1863.8043 6891,-1073.9236 6891,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="6894.5001,-912.7562 6891,-902.7562 6887.5001,-912.7562 6894.5001,-912.7562"/>
</g>
<!-- leaf_107 -->
<g id="node108" class="node">
<title>leaf_107</title>
<polygon fill="none" stroke="#c0c0c0" points="7300,-902.7014 7144,-902.7014 7144,-866.7014 7300,-866.7014 7300,-902.7014"/>
<text text-anchor="middle" x="7222" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:next()</text>
</g>
<!-- header_103&#45;&gt;leaf_107 -->
<g id="edge107" class="edge">
<title>header_103&#45;&gt;leaf_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7411.6097,-1993.8376C7399.7288,-1945.2271 7365.1272,-1808.9198 7325,-1699.2027 7318.9859,-1682.7589 7313.5817,-1680.1017 7309,-1663.2027 7231.6577,-1377.9359 7222.9326,-1015.9456 7222.0614,-913.0967"/>
<polygon fill="#000000" stroke="#000000" points="7225.5601,-912.8793 7221.9945,-902.9025 7218.5603,-912.9253 7225.5601,-912.8793"/>
</g>
<!-- raw_108 -->
<g id="node109" class="node">
<title>raw_108</title>
<ellipse fill="none" stroke="#000000" cx="7345" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7345" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_104&#45;&gt;raw_108 -->
<g id="edge108" class="edge">
<title>prose_104&#45;&gt;raw_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7552.7115,-1993.859C7562.318,-1941.0468 7582.2854,-1786.2686 7507,-1699.2027 7468.9059,-1655.1478 7417.1372,-1708.8766 7381,-1663.2027 7287.0806,-1544.4981 7329.8343,-1038.5972 7342.098,-913.0065"/>
<polygon fill="#000000" stroke="#000000" points="7345.6165,-912.9921 7343.1204,-902.6955 7338.6506,-912.3013 7345.6165,-912.9921"/>
</g>
<!-- prespace_109 -->
<g id="node110" class="node">
<title>prespace_109</title>
<ellipse fill="none" stroke="#000000" cx="7436" cy="-884.7014" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="7436" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_104&#45;&gt;prespace_109 -->
<g id="edge109" class="edge">
<title>prose_104&#45;&gt;prespace_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7548.2104,-1993.7862C7545.7543,-1945.0498 7536.5466,-1808.4612 7507,-1699.2027 7502.4751,-1682.4704 7496.0073,-1680.0665 7492,-1663.2027 7423.9156,-1376.685 7431.0716,-1015.5677 7434.7868,-913.011"/>
<polygon fill="#000000" stroke="#000000" points="7438.2908,-912.9728 7435.1754,-902.8464 7431.2959,-912.7053 7438.2908,-912.9728"/>
</g>
<!-- literal_110 -->
<g id="node111" class="node">
<title>literal_110</title>
<ellipse fill="none" stroke="#000000" cx="7532" cy="-884.7014" rx="31.481" ry="18"/>
<text text-anchor="middle" x="7532" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_104&#45;&gt;literal_110 -->
<g id="edge110" class="edge">
<title>prose_104&#45;&gt;literal_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7548.7261,-1993.9379C7546.7638,-1863.8043 7534.8533,-1073.9236 7532.4301,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="7535.9227,-912.7023 7532.2722,-902.7562 7528.9235,-912.8079 7535.9227,-912.7023"/>
</g>
<!-- raw_111 -->
<g id="node112" class="node">
<title>raw_111</title>
<ellipse fill="none" stroke="#000000" cx="7608" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7608" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_104&#45;&gt;raw_111 -->
<g id="edge111" class="edge">
<title>prose_104&#45;&gt;raw_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7550.3228,-1993.9499C7554.0618,-1942.2645 7564.8966,-1789.8761 7572,-1663.2027 7588.4452,-1369.9389 7602.8873,-1014.2218 7606.8976,-912.8639"/>
<polygon fill="#000000" stroke="#000000" points="7610.3971,-912.9429 7607.294,-902.8127 7603.4025,-912.667 7610.3971,-912.9429"/>
</g>
<!-- raw_116 -->
<g id="node117" class="node">
<title>raw_116</title>
<ellipse fill="none" stroke="#000000" cx="7680" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="7680" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_105&#45;&gt;raw_116 -->
<g id="edge116" class="edge">
<title>prose_105&#45;&gt;raw_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7664.2578,-1993.9379C7666.1046,-1863.8043 7677.3146,-1073.9236 7679.5952,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="7683.1014,-912.8049 7679.7438,-902.7562 7676.1021,-912.7055 7683.1014,-912.8049"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="8113.4016,-1072.3422 7724.5984,-1072.3422 7724.5984,-697.0606 8113.4016,-697.0606 8113.4016,-1072.3422"/>
<text text-anchor="middle" x="7919" y="-1057.3217" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.next(historian)</text>
<text text-anchor="middle" x="7919" y="-1041.9217" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local Δ = historian.cursor &lt; #historian and 1 or 0</text>
<text text-anchor="middle" x="7919" y="-1023.1617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if historian.cursor == 0 or #historian == 0 then</text>
<text text-anchor="middle" x="7919" y="-1007.7617" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="7919" y="-992.3616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7919" y="-976.9616" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local txtbuf = historian[historian.cursor + Δ]</text>
<text text-anchor="middle" x="7919" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="7919" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="7919" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7919" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cur_row = #txtbuf.lines</text>
<text text-anchor="middle" x="7919" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local result = historian.results[txtbuf]</text>
<text text-anchor="middle" x="7919" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not txtbuf then</text>
<text text-anchor="middle" x="7919" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return Txtbuf()</text>
<text text-anchor="middle" x="7919" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7919" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian.cursor = historian.cursor + Δ</text>
<text text-anchor="middle" x="7919" y="-816.2413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;txtbuf.cursor = #txtbuf.lines[txtbuf.cur_row] + 1</text>
<text text-anchor="middle" x="7919" y="-800.8413" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if not (Δ &gt; 0) and #txtbuf.lines &gt; 0 then</text>
<text text-anchor="middle" x="7919" y="-782.0813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian.cursor = #historian + 1</text>
<text text-anchor="middle" x="7919" y="-766.6813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), nil, true</text>
<text text-anchor="middle" x="7919" y="-751.2812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="7919" y="-735.8812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return txtbuf:clone(), result, false</text>
<text text-anchor="middle" x="7919" y="-720.4812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7919" y="-705.0811" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_106&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>codeblock_106&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7861.9345,-1993.9379C7867.2427,-1890.758 7893.8881,-1372.8258 7908.819,-1082.5996"/>
<polygon fill="#000000" stroke="#000000" points="7912.3266,-1082.5391 7909.3451,-1072.3724 7905.3359,-1082.1794 7912.3266,-1082.5391"/>
</g>
<!-- leaf_112 -->
<g id="node113" class="node">
<title>leaf_112</title>
<polygon fill="none" stroke="#c0c0c0" points="7357.5,-63.0015 6886.5,-63.0015 6886.5,-7.1986 7357.5,-7.1986 7357.5,-63.0015"/>
<text text-anchor="middle" x="7122" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Returns the next txtbuf in history, and a second flag to tell the</text>
</g>
<!-- raw_108&#45;&gt;leaf_112 -->
<g id="edge112" class="edge">
<title>raw_108&#45;&gt;leaf_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7346.7539,-866.4855C7356.503,-761.3436 7400.3695,-232.3524 7309,-106.2001 7298.7109,-91.9941 7267.4311,-77.93 7233.3259,-66.1073"/>
<polygon fill="#000000" stroke="#000000" points="7234.241,-62.7221 7223.6467,-62.8339 7231.9984,-69.3531 7234.241,-62.7221"/>
</g>
<!-- leaf_113 -->
<g id="node114" class="node">
<title>leaf_113</title>
<polygon fill="none" stroke="#c0c0c0" points="7430,-53.1 7376,-53.1 7376,-17.1 7430,-17.1 7430,-53.1"/>
</g>
<!-- prespace_109&#45;&gt;leaf_113 -->
<g id="edge113" class="edge">
<title>prespace_109&#45;&gt;leaf_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7435.2955,-866.5632C7431.0889,-758.2631 7409.2971,-197.2221 7404.1093,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="7407.5975,-63.2859 7403.7119,-53.4293 7400.6028,-63.5576 7407.5975,-63.2859"/>
</g>
<!-- leaf_114 -->
<g id="node115" class="node">
<title>leaf_114</title>
<polygon fill="none" stroke="#c0c0c0" points="7548,-53.1 7448,-53.1 7448,-17.1 7548,-17.1 7548,-53.1"/>
<text text-anchor="middle" x="7498" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">modeselektor</text>
</g>
<!-- literal_110&#45;&gt;leaf_114 -->
<g id="edge114" class="edge">
<title>literal_110&#45;&gt;leaf_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7531.2741,-866.5632C7526.9401,-758.2631 7504.4879,-197.2221 7499.143,-63.6604"/>
<polygon fill="#000000" stroke="#000000" points="7502.6307,-63.2813 7498.7335,-53.4293 7495.6363,-63.5613 7502.6307,-63.2813"/>
</g>
<!-- leaf_115 -->
<g id="node116" class="node">
<title>leaf_115</title>
<polygon fill="none" stroke="#c0c0c0" points="7806,-53.1 7566,-53.1 7566,-17.1 7806,-17.1 7806,-53.1"/>
<text text-anchor="middle" x="7686" y="-31.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> it might be time for a new one.</text>
</g>
<!-- raw_111&#45;&gt;leaf_115 -->
<g id="edge115" class="edge">
<title>raw_111&#45;&gt;leaf_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7605.6974,-866.6335C7595.2861,-779.9167 7556.7878,-398.5735 7644,-106.2001 7648.7281,-90.3494 7657.7253,-74.3445 7666.1832,-61.5439"/>
<polygon fill="#000000" stroke="#000000" points="7669.114,-63.4589 7671.8935,-53.2351 7663.345,-59.4941 7669.114,-63.4589"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="8211.5,-55.0021 7824.5,-55.0021 7824.5,-15.198 8211.5,-15.198 8211.5,-55.0021"/>
<text text-anchor="middle" x="8018" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;d like to stop buffering blank lines at some point.</text>
</g>
<!-- raw_116&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>raw_116&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7678.0356,-866.6385C7666.9714,-761.2351 7616.3945,-226.1761 7716,-106.2001 7728.0433,-91.6938 7817.2481,-71.7875 7895.6095,-56.7271"/>
<polygon fill="#000000" stroke="#000000" points="7896.4304,-60.1337 7905.5976,-54.8221 7895.1189,-53.2576 7896.4304,-60.1337"/>
</g>
<!-- leaf_125 -->
<g id="node126" class="node">
<title>leaf_125</title>
<polygon fill="none" stroke="#c0c0c0" points="8340,-902.7014 8170,-902.7014 8170,-866.7014 8340,-866.7014 8340,-902.7014"/>
<text text-anchor="middle" x="8255" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Historian:append()</text>
</g>
<!-- header_119&#45;&gt;leaf_125 -->
<g id="edge125" class="edge">
<title>header_119&#45;&gt;leaf_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8255,-1993.9379C8255,-1863.8043 8255,-1073.9236 8255,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="8258.5001,-912.7562 8255,-902.7562 8251.5001,-912.7562 8258.5001,-912.7562"/>
</g>
<!-- raw_126 -->
<g id="node127" class="node">
<title>raw_126</title>
<ellipse fill="none" stroke="#000000" cx="8392" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8392" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_120&#45;&gt;raw_126 -->
<g id="edge126" class="edge">
<title>prose_120&#45;&gt;raw_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8399.8711,-1993.9379C8398.9477,-1863.8043 8393.3427,-1073.9236 8392.2024,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="8395.6991,-912.7311 8392.1281,-902.7562 8388.6993,-912.7808 8395.6991,-912.7311"/>
</g>
<!-- raw_128 -->
<g id="node129" class="node">
<title>raw_128</title>
<ellipse fill="none" stroke="#000000" cx="8464" cy="-884.7014" rx="27" ry="18"/>
<text text-anchor="middle" x="8464" y="-880.5014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_121&#45;&gt;raw_128 -->
<g id="edge128" class="edge">
<title>prose_121&#45;&gt;raw_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8481.71,-1993.9379C8479.6323,-1863.8043 8467.0211,-1073.9236 8464.4554,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="8467.9475,-912.699 8464.2883,-902.7562 8460.9484,-912.8108 8467.9475,-912.699"/>
</g>
<!-- leaf_130 -->
<g id="node131" class="node">
<title>leaf_130</title>
<polygon fill="none" stroke="#c0c0c0" points="8959,-988.9019 8509,-988.9019 8509,-780.5009 8959,-780.5009 8959,-988.9019"/>
<text text-anchor="middle" x="8734" y="-973.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">function Historian.append(historian, txtbuf, results, success)</text>
<text text-anchor="middle" x="8734" y="-958.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if tostring(historian[#historian]) == tostring(txtbuf) then</text>
<text text-anchor="middle" x="8734" y="-942.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; don&#39;t bother</text>
<text text-anchor="middle" x="8734" y="-927.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="8734" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8734" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian[#historian + 1] = txtbuf</text>
<text text-anchor="middle" x="8734" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if success then</text>
<text text-anchor="middle" x="8734" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf, results)</text>
<text text-anchor="middle" x="8734" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="8734" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;historian:persist(txtbuf)</text>
<text text-anchor="middle" x="8734" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8734" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return true</text>
<text text-anchor="middle" x="8734" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_122&#45;&gt;leaf_130 -->
<g id="edge130" class="edge">
<title>codeblock_122&#45;&gt;leaf_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8677.9184,-1993.9379C8683.6837,-1879.9061 8715.0613,-1259.2905 8728.2045,-999.3296"/>
<polygon fill="#000000" stroke="#000000" points="8731.7119,-999.2698 8728.7214,-989.1058 8724.7209,-998.9163 8731.7119,-999.2698"/>
</g>
<!-- leaf_131 -->
<g id="node132" class="node">
<title>leaf_131</title>
<polygon fill="none" stroke="#c0c0c0" points="9245,-935.1024 8977,-935.1024 8977,-834.3004 9245,-834.3004 9245,-935.1024"/>
<text text-anchor="middle" x="9111" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new()</text>
<text text-anchor="middle" x="9111" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local historian = meta(Historian)</text>
<text text-anchor="middle" x="9111" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;historian:load()</text>
<text text-anchor="middle" x="9111" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return historian</text>
<text text-anchor="middle" x="9111" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9111" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">Historian.idEst = new</text>
</g>
<!-- codeblock_123&#45;&gt;leaf_131 -->
<g id="edge131" class="edge">
<title>codeblock_123&#45;&gt;leaf_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8992.9335,-1993.9379C9006.0212,-1870.9791 9081.802,-1159.017 9104.5474,-945.3239"/>
<polygon fill="#000000" stroke="#000000" points="9108.0436,-945.5448 9105.6217,-935.2305 9101.0829,-944.8039 9108.0436,-945.5448"/>
</g>
<!-- leaf_132 -->
<g id="node133" class="node">
<title>leaf_132</title>
<polygon fill="none" stroke="#c0c0c0" points="9349,-902.7014 9263,-902.7014 9263,-866.7014 9349,-866.7014 9349,-902.7014"/>
<text text-anchor="middle" x="9306" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_124&#45;&gt;leaf_132 -->
<g id="edge132" class="edge">
<title>codeblock_124&#45;&gt;leaf_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9305.0161,-1993.9379C9305.1315,-1863.8043 9305.8322,-1073.9236 9305.9747,-913.2217"/>
<polygon fill="#000000" stroke="#000000" points="9309.475,-912.7593 9305.984,-902.7562 9302.475,-912.7531 9309.475,-912.7593"/>
</g>
<!-- leaf_127 -->
<g id="node128" class="node">
<title>leaf_127</title>
<polygon fill="none" stroke="#c0c0c0" points="8554,-63.0015 8230,-63.0015 8230,-7.1986 8554,-7.1986 8554,-63.0015"/>
<text text-anchor="middle" x="8392" y="-15.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Appends a txtbuf to history and persists it.</text>
</g>
<!-- raw_126&#45;&gt;leaf_127 -->
<g id="edge127" class="edge">
<title>raw_126&#45;&gt;leaf_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8392,-866.5632C8392,-760.6464 8392,-221.6953 8392,-73.0895"/>
<polygon fill="#000000" stroke="#000000" points="8395.5001,-73.0758 8392,-63.0758 8388.5001,-73.0759 8395.5001,-73.0758"/>
</g>
<!-- leaf_129 -->
<g id="node130" class="node">
<title>leaf_129</title>
<polygon fill="none" stroke="#c0c0c0" points="8770,-55.0021 8572,-55.0021 8572,-15.198 8770,-15.198 8770,-55.0021"/>
<text text-anchor="middle" x="8671" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Doesn&#39;t adjust the cursor.</text>
</g>
<!-- raw_128&#45;&gt;leaf_129 -->
<g id="edge129" class="edge">
<title>raw_128&#45;&gt;leaf_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8462.3052,-866.5276C8452.8888,-761.6229 8410.5782,-233.7404 8500,-106.2001 8506.6773,-96.6764 8560.4439,-75.2015 8605.9306,-58.3295"/>
<polygon fill="#000000" stroke="#000000" points="8607.3192,-61.548 8615.4914,-54.8051 8604.898,-54.98 8607.3192,-61.548"/>
</g>
</g>
</svg>
