<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="3142pt" height="3004pt"
 viewBox="0.00 0.00 3142.30 3003.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2999.6042)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2999.6042 3138.2972,-2999.6042 3138.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2977.6042" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="873" y="-2973.4042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 202</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2905.6042" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="873" y="-2901.4042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;127</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2959.4355C873,-2951.7351 873,-2942.5785 873,-2934.0208"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2934.0174 873,-2924.0174 869.5001,-2934.0175 876.5001,-2934.0174"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="371" cy="-2833.6042" rx="36.8096" ry="18"/>
<text text-anchor="middle" x="371" y="-2829.4042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Lex</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M814.4318,-2897.204C713.1974,-2882.6843 507.5905,-2853.1948 416.3577,-2840.1097"/>
<polygon fill="#000000" stroke="#000000" points="416.7273,-2836.6269 406.3317,-2838.6717 415.7334,-2843.556 416.7273,-2836.6269"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2833.6042" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="544" y="-2829.4042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M821.5938,-2894.3542C755.9905,-2879.9972 643.8757,-2855.4615 584.1773,-2842.3968"/>
<polygon fill="#000000" stroke="#000000" points="584.8789,-2838.9676 574.3618,-2840.2487 583.3823,-2845.8057 584.8789,-2838.9676"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2833.6042" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="873" y="-2829.4042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 8&#45;16</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2887.4355C873,-2879.7351 873,-2870.5785 873,-2862.0208"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2862.0174 873,-2852.0174 869.5001,-2862.0175 876.5001,-2862.0174"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="1218" cy="-2833.6042" rx="70.655" ry="18"/>
<text text-anchor="middle" x="1218" y="-2829.4042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 19&#45;127</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M925.3981,-2894.6689C986.4488,-2881.9279 1087.344,-2860.8715 1153.2464,-2847.118"/>
<polygon fill="#000000" stroke="#000000" points="1154.0348,-2850.5289 1163.1088,-2845.0597 1152.6047,-2843.6766 1154.0348,-2850.5289"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1996" cy="-2833.6042" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="1996" y="-2829.4042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 128&#45;132</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M937.0023,-2901.5007C1128.5949,-2889.217 1697.574,-2852.7375 1912.5175,-2838.9566"/>
<polygon fill="#000000" stroke="#000000" points="1913.0344,-2842.4307 1922.7899,-2838.298 1912.5865,-2835.4451 1913.0344,-2842.4307"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="312,-2739.7041 258,-2739.7041 258,-2703.7041 312,-2703.7041 312,-2739.7041"/>
<text text-anchor="middle" x="285" y="-2718.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">* Lex</text>
</g>
<!-- header_2&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>header_2&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M354.3707,-2817.3079C344.202,-2806.9517 331.2282,-2793.0138 321,-2779.6042 313.5803,-2769.8766 306.2835,-2758.5655 300.2199,-2748.5354"/>
<polygon fill="#000000" stroke="#000000" points="303.1352,-2746.5893 295.0298,-2739.7663 297.1113,-2750.1547 303.1352,-2746.5893"/>
</g>
<!-- raw_8 -->
<g id="node9" class="node">
<title>raw_8</title>
<ellipse fill="none" stroke="#000000" cx="357" cy="-2721.7041" rx="27" ry="18"/>
<text text-anchor="middle" x="357" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;raw_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M512.6773,-2828.6859C479.8763,-2822.2031 428.316,-2808.1037 393,-2779.6042 382.7408,-2771.3251 374.5943,-2759.2907 368.6642,-2748.3356"/>
<polygon fill="#000000" stroke="#000000" points="371.6441,-2746.4707 364.0259,-2739.1077 365.3897,-2749.6144 371.6441,-2746.4707"/>
</g>
<!-- prespace_9 -->
<g id="node10" class="node">
<title>prespace_9</title>
<ellipse fill="none" stroke="#000000" cx="448" cy="-2721.7041" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="448" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_3&#45;&gt;prespace_9 -->
<g id="edge9" class="edge">
<title>prose_3&#45;&gt;prespace_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M529.8349,-2817.0929C513.9256,-2798.5486 487.9266,-2768.2436 469.5069,-2746.773"/>
<polygon fill="#000000" stroke="#000000" points="472.0229,-2744.3305 462.8552,-2739.0197 466.7101,-2748.8884 472.0229,-2744.3305"/>
</g>
<!-- literal_10 -->
<g id="node11" class="node">
<title>literal_10</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2721.7041" rx="31.481" ry="18"/>
<text text-anchor="middle" x="544" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_3&#45;&gt;literal_10 -->
<g id="edge10" class="edge">
<title>prose_3&#45;&gt;literal_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M544,-2815.1262C544,-2797.4462 544,-2770.5274 544,-2750.1194"/>
<polygon fill="#000000" stroke="#000000" points="547.5001,-2749.8382 544,-2739.8383 540.5001,-2749.8383 547.5001,-2749.8382"/>
</g>
<!-- raw_11 -->
<g id="node12" class="node">
<title>raw_11</title>
<ellipse fill="none" stroke="#000000" cx="620" cy="-2721.7041" rx="27" ry="18"/>
<text text-anchor="middle" x="620" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_11 -->
<g id="edge11" class="edge">
<title>prose_3&#45;&gt;raw_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M556.97,-2816.8346C564.9794,-2806.3003 575.3437,-2792.3414 584,-2779.6042 591.0296,-2769.2606 598.3888,-2757.5924 604.6082,-2747.455"/>
<polygon fill="#000000" stroke="#000000" points="607.7526,-2749.0202 609.9573,-2738.6573 601.7714,-2745.3836 607.7526,-2749.0202"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="1080.5,-2779.5045 665.5,-2779.5045 665.5,-2663.9037 1080.5,-2663.9037 1080.5,-2779.5045"/>
<text text-anchor="middle" x="873" y="-2764.4042" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="873" y="-2749.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, R, S, match = L.P, L.R, L.S, L.match</text>
<text text-anchor="middle" x="873" y="-2733.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local Lex = meta {}</text>
<text text-anchor="middle" x="873" y="-2718.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub, gsub = assert(string.sub), assert(string.gsub)</text>
<text text-anchor="middle" x="873" y="-2702.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = assert(table.concat)</text>
<text text-anchor="middle" x="873" y="-2687.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local c = require &quot;color&quot;</text>
<text text-anchor="middle" x="873" y="-2672.004" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints)</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_4&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2815.1262C873,-2807.9234 873,-2799.1873 873,-2789.9828"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2789.8613 873,-2779.8614 869.5001,-2789.8614 876.5001,-2789.8613"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="1162" cy="-2721.7041" rx="63.3963" ry="18"/>
<text text-anchor="middle" x="1162" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Lua lexers</text>
</g>
<!-- section_5&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1209.0026,-2815.6255C1199.9403,-2797.5171 1185.8497,-2769.3609 1175.458,-2748.596"/>
<polygon fill="#000000" stroke="#000000" points="1178.5804,-2747.0144 1170.975,-2739.6381 1172.3205,-2750.1472 1178.5804,-2747.0144"/>
</g>
<!-- prose_18 -->
<g id="node19" class="node">
<title>prose_18</title>
<ellipse fill="none" stroke="#000000" cx="1275" cy="-2721.7041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1275" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;prose_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1227.158,-2815.6255C1236.4367,-2797.4099 1250.8943,-2769.0274 1261.4891,-2748.2282"/>
<polygon fill="#000000" stroke="#000000" points="1264.6324,-2749.7684 1266.0526,-2739.2692 1258.395,-2746.5912 1264.6324,-2749.7684"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="1497" cy="-2721.7041" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="1497" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 21&#45;125</text>
</g>
<!-- section_5&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_5&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1255.9175,-2818.3964C1305.6732,-2798.4406 1393.0852,-2763.3818 1447.864,-2741.4113"/>
<polygon fill="#000000" stroke="#000000" points="1449.3844,-2744.5726 1457.3628,-2737.6016 1446.7786,-2738.0757 1449.3844,-2744.5726"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="1922" cy="-2721.7041" rx="98.678" ry="18"/>
<text text-anchor="middle" x="1922" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Lex.lua_thor(txtbuf)</text>
</g>
<!-- section_6&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_6&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1984.1106,-2815.6255C1972.0276,-2797.3539 1953.1797,-2768.8528 1939.4138,-2748.0366"/>
<polygon fill="#000000" stroke="#000000" points="1942.2953,-2746.0486 1933.8599,-2739.6381 1936.4565,-2749.9099 1942.2953,-2746.0486"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2071" cy="-2721.7041" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2071" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_6&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2008.05,-2815.6255C2020.4413,-2797.1377 2039.8521,-2768.1768 2053.844,-2747.3009"/>
<polygon fill="#000000" stroke="#000000" points="2056.8123,-2749.1586 2059.4725,-2738.9031 2050.9975,-2745.2613 2056.8123,-2749.1586"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2474" cy="-2721.7041" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2474" y="-2717.5041" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 133&#45;202</text>
</g>
<!-- section_6&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_6&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2049.9035,-2820.9853C2138.6872,-2800.201 2315.2775,-2758.8611 2410.1675,-2736.6473"/>
<polygon fill="#000000" stroke="#000000" points="2410.9883,-2740.0499 2419.9273,-2734.3625 2409.3927,-2733.2341 2410.9883,-2740.0499"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="408,-1858.204 0,-1858.204 0,-1786.4016 408,-1786.4016 408,-1858.204"/>
<text text-anchor="middle" x="204" y="-1794.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">We&#39;re going to do this will straight el peg, and fold in</text>
</g>
<!-- raw_8&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>raw_8&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M353.9438,-2703.7382C335.6147,-2595.9921 240.1129,-2034.5903 211.8729,-1868.583"/>
<polygon fill="#000000" stroke="#000000" points="215.2391,-1867.5006 210.1115,-1858.2292 208.3382,-1868.6745 215.2391,-1867.5006"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="480,-1840.3028 426,-1840.3028 426,-1804.3028 480,-1804.3028 480,-1840.3028"/>
<text text-anchor="middle" x="453" y="-1818.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_9&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prespace_9&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M448.1021,-2703.3306C448.7305,-2590.3008 452.0702,-1989.5475 452.8411,-1850.8776"/>
<polygon fill="#000000" stroke="#000000" points="456.3423,-1850.6664 452.898,-1840.647 449.3424,-1850.6274 456.3423,-1850.6664"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="577,-1840.3028 505,-1840.3028 505,-1804.3028 577,-1804.3028 577,-1840.3028"/>
<text text-anchor="middle" x="541" y="-1818.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">espalier</text>
</g>
<!-- literal_10&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>literal_10&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M543.9387,-2703.3306C543.5617,-2590.3008 541.5579,-1989.5475 541.0953,-1850.8776"/>
<polygon fill="#000000" stroke="#000000" points="544.5946,-1850.6353 541.0612,-1840.647 537.5947,-1850.6587 544.5946,-1850.6353"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="653,-1840.3028 595,-1840.3028 595,-1804.3028 653,-1804.3028 653,-1840.3028"/>
<text text-anchor="middle" x="624" y="-1818.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> ASAP.</text>
</g>
<!-- raw_11&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_11&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M620.0817,-2703.3306C620.5844,-2590.3008 623.2562,-1989.5475 623.8729,-1850.8776"/>
<polygon fill="#000000" stroke="#000000" points="627.3738,-1850.6625 623.9184,-1840.647 620.3739,-1850.6313 627.3738,-1850.6625"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1174,-1840.3028 1060,-1840.3028 1060,-1804.3028 1174,-1804.3028 1174,-1840.3028"/>
<text text-anchor="middle" x="1117" y="-1818.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Lua lexers</text>
</g>
<!-- header_17&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>header_17&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1161.0807,-2703.3306C1155.4255,-2590.3008 1125.3678,-1989.5475 1118.4297,-1850.8776"/>
<polygon fill="#000000" stroke="#000000" points="1121.9133,-1850.4596 1117.9178,-1840.647 1114.922,-1850.8095 1121.9133,-1850.4596"/>
</g>
<!-- raw_21 -->
<g id="node22" class="node">
<title>raw_21</title>
<ellipse fill="none" stroke="#000000" cx="1219" cy="-1822.3028" rx="27" ry="18"/>
<text text-anchor="middle" x="1219" y="-1818.1028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_18&#45;&gt;raw_21 -->
<g id="edge21" class="edge">
<title>prose_18&#45;&gt;raw_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1270.2768,-2703.8541C1265.5257,-2685.0755 1258.427,-2654.5874 1255,-2627.804 1216.3065,-2325.3957 1217.3941,-1954.5316 1218.5806,-1850.5662"/>
<polygon fill="#000000" stroke="#000000" points="1222.0805,-1850.5888 1218.7052,-1840.5461 1215.0811,-1850.5018 1222.0805,-1850.5888"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1819.5,-2627.8051 1264.5,-2627.8051 1264.5,-1016.8005 1819.5,-1016.8005 1819.5,-2627.8051"/>
<text text-anchor="middle" x="1542" y="-2612.604" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = (P&quot; &quot;)^1</text>
<text text-anchor="middle" x="1542" y="-2581.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local NL = P&quot;\n&quot;</text>
<text text-anchor="middle" x="1542" y="-2549.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">local terminal = S&quot; \&quot;&#39;+&#45;*^~%#;,&lt;&gt;={}[]().:\n&quot; + &#45;P(1)</text>
<text text-anchor="middle" x="1542" y="-2518.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">local KW = (P&quot;function&quot; + &quot;local&quot; + &quot;for&quot; + &quot;in&quot; + &quot;do&quot;</text>
<text text-anchor="middle" x="1542" y="-2503.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;and&quot; + &quot;or&quot; + &quot;not&quot; + &quot;true&quot; + &quot;false&quot;</text>
<text text-anchor="middle" x="1542" y="-2487.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;while&quot; + &quot;break&quot; + &quot;if&quot; + &quot;then&quot; + &quot;else&quot; + &quot;elseif&quot;</text>
<text text-anchor="middle" x="1542" y="-2472.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;goto&quot; + &quot;repeat&quot; + &quot;until&quot; + &quot;return&quot; + &quot;nil&quot;</text>
<text text-anchor="middle" x="1542" y="-2456.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;end&quot;) * #terminal</text>
<text text-anchor="middle" x="1542" y="-2425.4037" font-family="Inconsolata" font-size="14.00" fill="#000000">local OP = P&quot;+&quot; + &quot;&#45;&quot; + &quot;*&quot; + &quot;/&quot; + &quot;%&quot; + &quot;^&quot; + &quot;#&quot;</text>
<text text-anchor="middle" x="1542" y="-2410.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;==&quot; + &quot;~=&quot; + &quot;&lt;=&quot; + &quot;&gt;=&quot; + &quot;&lt;&quot; + &quot;&gt;&quot;</text>
<text text-anchor="middle" x="1542" y="-2394.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;=&quot; + &quot;(&quot; + &quot;)&quot; + &quot;{&quot; + &quot;}&quot; + &quot;[&quot; + &quot;]&quot;</text>
<text text-anchor="middle" x="1542" y="-2379.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;;&quot; + &quot;:&quot; + &quot;...&quot; + &quot;..&quot; + &quot;.&quot; + &quot;,&quot;</text>
<text text-anchor="middle" x="1542" y="-2347.8036" font-family="Inconsolata" font-size="14.00" fill="#000000">local digit = R&quot;09&quot;</text>
<text text-anchor="middle" x="1542" y="-2316.4036" font-family="Inconsolata" font-size="14.00" fill="#000000">local _decimal = P&quot;&#45;&quot;^0 * ((digit^1 * P&quot;.&quot;^&#45;1 * digit^0</text>
<text text-anchor="middle" x="1542" y="-2301.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* ((P&quot;e&quot; + P&quot;E&quot;)^&#45;1 * P&quot;&#45;&quot;^&#45;1 * digit^1)^&#45;1</text>
<text text-anchor="middle" x="1542" y="-2285.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ digit^1)^1 + digit^1)</text>
<text text-anchor="middle" x="1542" y="-2254.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">local higit = R&quot;09&quot; + R&quot;af&quot; + R&quot;AF&quot;</text>
<text text-anchor="middle" x="1542" y="-2222.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; hexadecimal floats. are a thing. that exists. in luajit.</text>
<text text-anchor="middle" x="1542" y="-2207.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">local _hexadecimal = P&quot;&#45;&quot;^0 * P&quot;0&quot; * (P&quot;x&quot; + P&quot;X&quot;)</text>
<text text-anchor="middle" x="1542" y="-2192.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* ((higit^1 * P&quot;.&quot;^&#45;1 * higit^0</text>
<text text-anchor="middle" x="1542" y="-2176.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* ((P&quot;p&quot; + P&quot;P&quot;)^&#45;1 * P&quot;&#45;&quot;^&#45;1 * higit^1)^&#45;1</text>
<text text-anchor="middle" x="1542" y="-2161.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ higit^1)^1 + higit^1)</text>
<text text-anchor="middle" x="1542" y="-2129.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; long strings, straight from the LPEG docs</text>
<text text-anchor="middle" x="1542" y="-2114.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">local _equals = P&quot;=&quot;^0</text>
<text text-anchor="middle" x="1542" y="-2099.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">local _open = &quot;[&quot; * L.Cg(_equals, &quot;init&quot;) * &quot;[&quot; * P&quot;\n&quot;^&#45;1</text>
<text text-anchor="middle" x="1542" y="-2083.6032" font-family="Inconsolata" font-size="14.00" fill="#000000">local _close = &quot;]&quot; * L.C(_equals) * &quot;]&quot;</text>
<text text-anchor="middle" x="1542" y="-2068.2032" font-family="Inconsolata" font-size="14.00" fill="#000000">local _closeeq = L.Cmt(_close * L.Cb(&quot;init&quot;),</text>
<text text-anchor="middle" x="1542" y="-2052.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;function (s, i, a, b) return a == b end)</text>
<text text-anchor="middle" x="1542" y="-2021.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">local long_str = (_open * L.C((P(1) &#45; _closeeq)^0) * _close) / 0 * L.Cp()</text>
<text text-anchor="middle" x="1542" y="-1990.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">local str_esc = P&quot;\\&quot; * (S&quot;abfnrtvz\\\&quot;&#39;[]\n&quot;</text>
<text text-anchor="middle" x="1542" y="-1974.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ (R&quot;09&quot; * R&quot;09&quot;^&#45;2)</text>
<text text-anchor="middle" x="1542" y="-1959.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ (P&quot;x&quot; + P&quot;X&quot;) * higit * higit)</text>
<text text-anchor="middle" x="1542" y="-1927.803" font-family="Inconsolata" font-size="14.00" fill="#000000">local double_str = P&quot;\&quot;&quot; * (P(1) &#45; (P&quot;\&quot;&quot; + P&quot;\\&quot;) + str_esc)^0 * P&quot;\&quot;&quot;</text>
<text text-anchor="middle" x="1542" y="-1912.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">local single_str = P&quot;\&#39;&quot; * (P(1) &#45; (P&quot;\&#39;&quot; + P&quot;\\&quot;) + str_esc)^0 * P&quot;\&#39;&quot;</text>
<text text-anchor="middle" x="1542" y="-1881.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">local string_short = double_str + single_str</text>
<text text-anchor="middle" x="1542" y="-1849.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">local string_long = long_str</text>
<text text-anchor="middle" x="1542" y="-1818.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">local letter = R&quot;az&quot; + R&quot;AZ&quot;</text>
<text text-anchor="middle" x="1542" y="-1786.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local symbol = &#160;&#160;(letter^1 + P&quot;_&quot;^1)</text>
<text text-anchor="middle" x="1542" y="-1771.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* (letter + digit + P&quot;_&quot;)^0</text>
<text text-anchor="middle" x="1542" y="-1756.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* #terminal</text>
<text text-anchor="middle" x="1542" y="-1724.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local number = _hexadecimal + _decimal</text>
<text text-anchor="middle" x="1542" y="-1693.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local comment = P&quot;&#45;&#45;&quot; * long_str</text>
<text text-anchor="middle" x="1542" y="-1677.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ P&quot;&#45;&#45;&quot; * (P(1) &#45; NL)^0 * (NL + &#45; P(1))</text>
<text text-anchor="middle" x="1542" y="-1646.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local ERR = P(1)</text>
<text text-anchor="middle" x="1542" y="-1615.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local lua_toks = {comment, KW, string_long, string_short, number, OP, symbol,</text>
<text text-anchor="middle" x="1542" y="-1599.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS, NL, ERR}</text>
<text text-anchor="middle" x="1542" y="-1568.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_kv = { KW = KW,</text>
<text text-anchor="middle" x="1542" y="-1552.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;number = number,</text>
<text text-anchor="middle" x="1542" y="-1537.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OP = OP,</text>
<text text-anchor="middle" x="1542" y="-1522.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;symbol = symbol,</text>
<text text-anchor="middle" x="1542" y="-1506.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string_long = string_long,</text>
<text text-anchor="middle" x="1542" y="-1491.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string_short = string_short,</text>
<text text-anchor="middle" x="1542" y="-1475.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment = comment,</text>
<text text-anchor="middle" x="1542" y="-1460.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS = WS,</text>
<text text-anchor="middle" x="1542" y="-1445.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NL = NL,</text>
<text text-anchor="middle" x="1542" y="-1429.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ERR = ERR}</text>
<text text-anchor="middle" x="1542" y="-1398.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local color_map = {</text>
<text text-anchor="middle" x="1542" y="-1382.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;KW = c.color.keyword(),</text>
<text text-anchor="middle" x="1542" y="-1367.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;OP = c.color.operator(),</text>
<text text-anchor="middle" x="1542" y="-1352.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;number = c.color.number(),</text>
<text text-anchor="middle" x="1542" y="-1336.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;symbol = c.color.field(),</text>
<text text-anchor="middle" x="1542" y="-1321.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;string_short = c.color.string(),</text>
<text text-anchor="middle" x="1542" y="-1305.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;string_long = c.color.string(),</text>
<text text-anchor="middle" x="1542" y="-1290.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;comment = c.color.comment(),</text>
<text text-anchor="middle" x="1542" y="-1275.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ERR = c.color.error(),</text>
<text text-anchor="middle" x="1542" y="-1259.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;NL = a.clear(),</text>
<text text-anchor="middle" x="1542" y="-1244.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1542" y="-1196.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_map = {}</text>
<text text-anchor="middle" x="1542" y="-1165.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">for k, v in pairs(lex_kv) do</text>
<text text-anchor="middle" x="1542" y="-1150.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;lex_map[v] = k</text>
<text text-anchor="middle" x="1542" y="-1134.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1542" y="-1103.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">lex_kv = nil</text>
<text text-anchor="middle" x="1542" y="-1071.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.lex_map = lex_map</text>
<text text-anchor="middle" x="1542" y="-1040.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.long_str = long_str</text>
<text text-anchor="middle" x="1542" y="-1025.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.string = string_long</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_19&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1497.9193,-2703.3306C1498.6408,-2688.9106 1499.7594,-2666.5523 1501.1766,-2638.228"/>
<polygon fill="#000000" stroke="#000000" points="1504.686,-2638.1263 1501.6901,-2627.9639 1497.6947,-2637.7764 1504.686,-2638.1263"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1246,-554.1008 1192,-554.1008 1192,-518.1008 1246,-518.1008 1246,-554.1008"/>
</g>
<!-- raw_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>raw_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1219,-1804.1206C1219,-1662.7298 1219,-739.8604 1219,-564.757"/>
<polygon fill="#000000" stroke="#000000" points="1222.5001,-564.5378 1219,-554.5378 1215.5001,-564.5379 1222.5001,-564.5378"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="2014.5,-1840.3028 1837.5,-1840.3028 1837.5,-1804.3028 2014.5,-1804.3028 2014.5,-1840.3028"/>
<text text-anchor="middle" x="1926" y="-1818.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">** Lex.lua_thor(txtbuf)</text>
</g>
<!-- header_24&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>header_24&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1922.0817,-2703.3306C1922.5844,-2590.3008 1925.2562,-1989.5475 1925.8729,-1850.8776"/>
<polygon fill="#000000" stroke="#000000" points="1929.3738,-1850.6625 1925.9184,-1840.647 1922.3739,-1850.6313 1929.3738,-1850.6625"/>
</g>
<!-- raw_28 -->
<g id="node29" class="node">
<title>raw_28</title>
<ellipse fill="none" stroke="#000000" cx="2067" cy="-1822.3028" rx="27" ry="18"/>
<text text-anchor="middle" x="2067" y="-1818.1028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_28 -->
<g id="edge28" class="edge">
<title>prose_25&#45;&gt;raw_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2070.9183,-2703.3306C2070.4156,-2590.3008 2067.7438,-1989.5475 2067.1271,-1850.8776"/>
<polygon fill="#000000" stroke="#000000" points="2070.6261,-1850.6313 2067.0816,-1840.647 2063.6262,-1850.6625 2070.6261,-1850.6313"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="2291" cy="-1822.3028" rx="88.0294" ry="18"/>
<text text-anchor="middle" x="2291" y="-1818.1028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : chomp_token(lb)</text>
</g>
<!-- section_26&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_26&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2464.6704,-2703.8354C2455.3574,-2685.2929 2441.2742,-2655.2219 2433,-2627.804 2343.5506,-2331.3981 2303.4638,-1955.589 2293.5411,-1850.6396"/>
<polygon fill="#000000" stroke="#000000" points="2297.0119,-1850.1631 2292.6001,-1840.5305 2290.0421,-1850.8119 2297.0119,-1850.1631"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="2474" cy="-1822.3028" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2474" y="-1818.1028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_26&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2474,-2703.3306C2474,-2590.3008 2474,-1989.5475 2474,-1850.8776"/>
<polygon fill="#000000" stroke="#000000" points="2477.5001,-1850.647 2474,-1840.647 2470.5001,-1850.6471 2477.5001,-1850.647"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="2716" cy="-1822.3028" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2716" y="-1818.1028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 138&#45;196</text>
</g>
<!-- section_26&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>section_26&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2482.935,-2703.7088C2491.9338,-2685.0654 2505.7708,-2654.9154 2515,-2627.804 2616.2712,-2330.312 2690.8403,-1955.2669 2710.7309,-1850.5679"/>
<polygon fill="#000000" stroke="#000000" points="2714.2187,-1850.9593 2712.6359,-1840.4834 2707.3404,-1849.6599 2714.2187,-1850.9593"/>
</g>
<!-- codeblock_33 -->
<g id="node34" class="node">
<title>codeblock_33</title>
<ellipse fill="none" stroke="#000000" cx="3047" cy="-1822.3028" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3047" y="-1818.1028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 199&#45;201</text>
</g>
<!-- section_26&#45;&gt;codeblock_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;codeblock_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2537.1761,-2711.6596C2623.8327,-2696.6629 2773.2636,-2666.0444 2812,-2627.804 3041.229,-2401.5103 3049.7905,-1965.1938 3047.8676,-1850.4895"/>
<polygon fill="#000000" stroke="#000000" points="3051.3653,-1850.3352 3047.6559,-1840.411 3044.3668,-1850.4823 3051.3653,-1850.3352"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2097.5,-572.002 1990.5,-572.002 1990.5,-500.1997 2097.5,-500.1997 2097.5,-572.002"/>
<text text-anchor="middle" x="2044" y="-524.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">...it&#39;s late.</text>
</g>
<!-- raw_28&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>raw_28&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2066.6749,-1804.1206C2064.2211,-1666.8994 2048.6048,-793.611 2044.8236,-582.1599"/>
<polygon fill="#000000" stroke="#000000" points="2048.3207,-581.9592 2044.6424,-572.0234 2041.3218,-582.0844 2048.3207,-581.9592"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2264.5,-554.1008 2115.5,-554.1008 2115.5,-518.1008 2264.5,-518.1008 2264.5,-554.1008"/>
<text text-anchor="middle" x="2190" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">*** chomp_token(lb)</text>
</g>
<!-- header_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>header_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2289.5722,-1804.1206C2278.4694,-1662.7298 2206.0004,-739.8604 2192.2502,-564.757"/>
<polygon fill="#000000" stroke="#000000" points="2195.72,-564.2331 2191.4478,-554.5378 2188.7415,-564.7812 2195.72,-564.2331"/>
</g>
<!-- raw_35 -->
<g id="node36" class="node">
<title>raw_35</title>
<ellipse fill="none" stroke="#000000" cx="2310" cy="-536.1008" rx="27" ry="18"/>
<text text-anchor="middle" x="2310" y="-531.9008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_35 -->
<g id="edge35" class="edge">
<title>prose_31&#45;&gt;raw_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2476.703,-1804.2121C2489.3972,-1713.2429 2536.4661,-1299.032 2388,-1016.8016 2376.554,-995.0431 2357.1667,-1002.7048 2346,-980.8016 2273.7191,-839.0247 2294.2693,-638.3876 2305.2024,-564.6838"/>
<polygon fill="#000000" stroke="#000000" points="2308.7292,-564.7788 2306.7963,-554.3618 2301.8112,-563.7105 2308.7292,-564.7788"/>
</g>
<!-- prespace_36 -->
<g id="node37" class="node">
<title>prespace_36</title>
<ellipse fill="none" stroke="#000000" cx="2401" cy="-536.1008" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2401" y="-531.9008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_31&#45;&gt;prespace_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;prespace_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2472.968,-1804.1206C2464.9432,-1662.7298 2412.5646,-739.8604 2402.6264,-564.757"/>
<polygon fill="#000000" stroke="#000000" points="2406.1075,-564.3234 2402.0464,-554.5378 2399.1188,-564.7201 2406.1075,-564.3234"/>
</g>
<!-- literal_37 -->
<g id="node38" class="node">
<title>literal_37</title>
<ellipse fill="none" stroke="#000000" cx="2497" cy="-536.1008" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2497" y="-531.9008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_31&#45;&gt;literal_37 -->
<g id="edge37" class="edge">
<title>prose_31&#45;&gt;literal_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2474.3251,-1804.1206C2476.8535,-1662.7298 2493.3564,-739.8604 2496.4876,-564.757"/>
<polygon fill="#000000" stroke="#000000" points="2499.9909,-564.5989 2496.6703,-554.5378 2492.992,-564.4736 2499.9909,-564.5989"/>
</g>
<!-- raw_38 -->
<g id="node39" class="node">
<title>raw_38</title>
<ellipse fill="none" stroke="#000000" cx="2573" cy="-536.1008" rx="27" ry="18"/>
<text text-anchor="middle" x="2573" y="-531.9008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_38 -->
<g id="edge38" class="edge">
<title>prose_31&#45;&gt;raw_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2475.3995,-1804.1206C2486.294,-1662.5803 2557.4667,-737.9084 2570.8369,-564.2042"/>
<polygon fill="#000000" stroke="#000000" points="2574.3383,-564.3187 2571.6162,-554.0795 2567.359,-563.7814 2574.3383,-564.3187"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="3019.5,-981.0025 2618.5,-981.0025 2618.5,-91.1991 3019.5,-91.1991 3019.5,-981.0025"/>
<text text-anchor="middle" x="2819" y="-965.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function chomp_token(lb)</text>
<text text-anchor="middle" x="2819" y="-950.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(lua_toks) do</text>
<text text-anchor="middle" x="2819" y="-934.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite = match(v, lb)</text>
<text text-anchor="middle" x="2819" y="-919.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite ~= nil then</text>
<text text-anchor="middle" x="2819" y="-904.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return sub(lb, 1, bite &#45; 1), sub(lb, bite), v</text>
<text text-anchor="middle" x="2819" y="-888.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2819" y="-873.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2819" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="2819" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2819" y="-811.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.chomp = chomp_token</text>
<text text-anchor="middle" x="2819" y="-763.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; a bit of finesse to mark up strings with quotemarks.</text>
<text text-anchor="middle" x="2819" y="-748.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;</text>
<text text-anchor="middle" x="2819" y="-716.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _str_hl(str)</text>
<text text-anchor="middle" x="2819" y="-701.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local mark = sub(str,1,1) == &quot;&#39;&quot; and &quot;&#39;&quot; or &#39;&quot;&#39;</text>
<text text-anchor="middle" x="2819" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;mark = c.color.string(mark)</text>
<text text-anchor="middle" x="2819" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return mark .. ts(str) .. mark</text>
<text text-anchor="middle" x="2819" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2819" y="-607.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">function Lex.lua_thor(txtbuf)</text>
<text text-anchor="middle" x="2819" y="-592.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local toks = {}</text>
<text text-anchor="middle" x="2819" y="-577.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local wid = {}</text>
<text text-anchor="middle" x="2819" y="-561.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(txtbuf)</text>
<text text-anchor="middle" x="2819" y="-546.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while lb ~= &quot;&quot; do</text>
<text text-anchor="middle" x="2819" y="-530.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local len = #lb</text>
<text text-anchor="middle" x="2819" y="-515.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite, tok_t</text>
<text text-anchor="middle" x="2819" y="-500.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;bite, lb, tok_t = chomp_token(lb)</text>
<text text-anchor="middle" x="2819" y="-484.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite == nil then</text>
<text text-anchor="middle" x="2819" y="-469.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="2819" y="-453.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2819" y="-438.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; #todo add a color</text>
<text text-anchor="middle" x="2819" y="-423.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local col = color_map[lex_map[tok_t]]</text>
<text text-anchor="middle" x="2819" y="-407.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if col then</text>
<text text-anchor="middle" x="2819" y="-392.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = col</text>
<text text-anchor="middle" x="2819" y="-376.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wid[#wid + 1] &#160;&#160;= 0</text>
<text text-anchor="middle" x="2819" y="-361.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = bite</text>
<text text-anchor="middle" x="2819" y="-346.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wid[#wid + 1] &#160;&#160;= #bite</text>
<text text-anchor="middle" x="2819" y="-330.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif tok_t == string_short then</text>
<text text-anchor="middle" x="2819" y="-315.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = _str_hl(bite)</text>
<text text-anchor="middle" x="2819" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wid[#wid + 1] = #bite</text>
<text text-anchor="middle" x="2819" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2819" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = bite</text>
<text text-anchor="middle" x="2819" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;wid[#wid + 1] = #bite</text>
<text text-anchor="middle" x="2819" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2819" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2819" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if len == #lb then</text>
<text text-anchor="middle" x="2819" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;lua&#45;thor has failed you&quot;</text>
<text text-anchor="middle" x="2819" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2819" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2819" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;toks[#toks + 1] = a.clear()</text>
<text text-anchor="middle" x="2819" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;wid[#wid + 1] = 0</text>
<text text-anchor="middle" x="2819" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return toks, wid</text>
<text text-anchor="middle" x="2819" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>codeblock_32&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2717.456,-1804.1206C2724.571,-1715.2728 2756.3974,-1317.8447 2782.5485,-991.2854"/>
<polygon fill="#000000" stroke="#000000" points="2786.0499,-991.4066 2783.3594,-981.1591 2779.0722,-990.8477 2786.0499,-991.4066"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3124,-554.1008 3038,-554.1008 3038,-518.1008 3124,-518.1008 3124,-554.1008"/>
<text text-anchor="middle" x="3081" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">return Lex</text>
</g>
<!-- codeblock_33&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_33&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3047.4806,-1804.1206C3051.2182,-1662.7298 3075.6137,-739.8604 3080.2425,-564.757"/>
<polygon fill="#000000" stroke="#000000" points="3083.7471,-564.6269 3080.5126,-554.5378 3076.7495,-564.4418 3083.7471,-564.6269"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2361.5,-55.6015 2086.5,-55.6015 2086.5,.2015 2361.5,.2015 2361.5,-55.6015"/>
<text text-anchor="middle" x="2224" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an almost pessimal way to use</text>
</g>
<!-- raw_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>raw_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2312.0403,-517.9224C2318.2893,-455.7869 2333.2716,-247.0926 2273,-91.4 2269.26,-81.739 2263.5675,-72.3235 2257.3697,-63.8238"/>
<polygon fill="#000000" stroke="#000000" points="2259.941,-61.4272 2251.0571,-55.6543 2254.4019,-65.7073 2259.941,-61.4272"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="2434,-45.7 2380,-45.7 2380,-9.7 2434,-9.7 2434,-45.7"/>
<text text-anchor="middle" x="2407" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_36&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>prespace_36&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2401.2135,-518.0066C2402.1101,-442.0345 2405.5743,-148.5026 2406.6675,-55.874"/>
<polygon fill="#000000" stroke="#000000" points="2410.1675,-55.8829 2406.7859,-45.8422 2403.168,-55.8002 2410.1675,-55.8829"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="2518,-45.7 2464,-45.7 2464,-9.7 2518,-9.7 2518,-45.7"/>
<text text-anchor="middle" x="2491" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_37&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>literal_37&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2496.7865,-518.0066C2495.8899,-442.0345 2492.4257,-148.5026 2491.3325,-55.874"/>
<polygon fill="#000000" stroke="#000000" points="2494.832,-55.8002 2491.2141,-45.8422 2487.8325,-55.8829 2494.832,-55.8002"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="2783.5,-47.0006 2536.5,-47.0006 2536.5,-8.3994 2783.5,-8.3994 2783.5,-47.0006"/>
<text text-anchor="middle" x="2660" y="-31.9" font-family="Inconsolata" font-size="14.00" fill="#000000">, which is quite capable of</text>
<text text-anchor="middle" x="2660" y="-16.5" font-family="Inconsolata" font-size="14.00" fill="#000000">handling a full line in one pass.</text>
</g>
<!-- raw_38&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>raw_38&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2570.793,-517.8809C2564.0001,-455.6121 2547.4034,-246.5403 2609,-91.4 2614.2907,-78.0747 2623.3686,-65.3298 2632.4127,-54.7891"/>
<polygon fill="#000000" stroke="#000000" points="2635.1689,-56.9586 2639.2587,-47.185 2629.9666,-52.2749 2635.1689,-56.9586"/>
</g>
</g>
</svg>
