<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="3131pt" height="2787pt"
 viewBox="0.00 0.00 3131.30 2787.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2783.4038)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2783.4038 3127.2972,-2783.4038 3127.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2761.4038" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="873" y="-2757.2038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 186</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2689.4038" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="873" y="-2685.2038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;119</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2743.2351C873,-2735.5347 873,-2726.3781 873,-2717.8204"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2717.817 873,-2707.817 869.5001,-2717.8171 876.5001,-2717.817"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="371" cy="-2617.4038" rx="36.8096" ry="18"/>
<text text-anchor="middle" x="371" y="-2613.2038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Lex</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M814.9238,-2681.0741C713.9036,-2666.5852 507.8958,-2637.0382 416.4624,-2623.9243"/>
<polygon fill="#000000" stroke="#000000" points="416.8097,-2620.4384 406.4141,-2622.4831 415.8158,-2627.3675 416.8097,-2620.4384"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2617.4038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="544" y="-2613.2038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M821.9547,-2678.2328C756.4375,-2663.8947 644.1052,-2639.3113 584.273,-2626.2173"/>
<polygon fill="#000000" stroke="#000000" points="584.9524,-2622.7832 574.4353,-2624.0644 583.4558,-2629.6214 584.9524,-2622.7832"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2617.4038" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="873" y="-2613.2038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 6&#45;15</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2671.2351C873,-2663.5347 873,-2654.3781 873,-2645.8204"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2645.817 873,-2635.817 869.5001,-2645.8171 876.5001,-2645.817"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="1218" cy="-2617.4038" rx="69.851" ry="18"/>
<text text-anchor="middle" x="1218" y="-2613.2038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 18&#45;119</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M925.0235,-2678.5467C986.1686,-2665.786 1087.6512,-2644.607 1153.6785,-2630.8274"/>
<polygon fill="#000000" stroke="#000000" points="1154.4824,-2634.2351 1163.5564,-2628.7659 1153.0523,-2627.3828 1154.4824,-2634.2351"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1989" cy="-2617.4038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="1989" y="-2613.2038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 120&#45;124</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M936.6034,-2685.3003C1126.888,-2673.0239 1691.7592,-2636.5806 1905.655,-2622.7809"/>
<polygon fill="#000000" stroke="#000000" points="1906.1245,-2626.258 1915.8784,-2622.1213 1905.6738,-2619.2725 1906.1245,-2626.258"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="312,-2515.8037 258,-2515.8037 258,-2479.8037 312,-2479.8037 312,-2515.8037"/>
<text text-anchor="middle" x="285" y="-2494.3037" font-family="Inconsolata" font-size="14.00" fill="#000000">* Lex</text>
</g>
<!-- header_2&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>header_2&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M354.1115,-2601.2996C343.8453,-2591.0158 330.86,-2577.0864 321,-2563.4038 312.43,-2551.5112 304.4209,-2537.3579 298.1431,-2525.2472"/>
<polygon fill="#000000" stroke="#000000" points="301.1334,-2523.4041 293.502,-2516.0548 294.8846,-2526.559 301.1334,-2523.4041"/>
</g>
<!-- raw_8 -->
<g id="node9" class="node">
<title>raw_8</title>
<ellipse fill="none" stroke="#000000" cx="357" cy="-2497.8037" rx="27" ry="18"/>
<text text-anchor="middle" x="357" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;raw_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M512.6692,-2612.9179C479.6219,-2606.7771 427.6344,-2592.9429 393,-2563.4038 381.1063,-2553.2598 372.44,-2538.1588 366.5947,-2525.0018"/>
<polygon fill="#000000" stroke="#000000" points="369.7027,-2523.3561 362.668,-2515.4338 363.2269,-2526.0138 369.7027,-2523.3561"/>
</g>
<!-- prespace_9 -->
<g id="node10" class="node">
<title>prespace_9</title>
<ellipse fill="none" stroke="#000000" cx="448" cy="-2497.8037" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="448" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_3&#45;&gt;prespace_9 -->
<g id="edge9" class="edge">
<title>prose_3&#45;&gt;prespace_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M530.6516,-2600.7739C514.5001,-2580.6518 487.1404,-2546.5661 468.3536,-2523.1609"/>
<polygon fill="#000000" stroke="#000000" points="470.8459,-2520.6744 461.8567,-2515.0668 465.3869,-2525.0562 470.8459,-2520.6744"/>
</g>
<!-- literal_10 -->
<g id="node11" class="node">
<title>literal_10</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2497.8037" rx="31.481" ry="18"/>
<text text-anchor="middle" x="544" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_3&#45;&gt;literal_10 -->
<g id="edge10" class="edge">
<title>prose_3&#45;&gt;literal_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M544,-2599.2391C544,-2579.833 544,-2548.8138 544,-2526.1816"/>
<polygon fill="#000000" stroke="#000000" points="547.5001,-2526.1392 544,-2516.1393 540.5001,-2526.1393 547.5001,-2526.1392"/>
</g>
<!-- raw_11 -->
<g id="node12" class="node">
<title>raw_11</title>
<ellipse fill="none" stroke="#000000" cx="620" cy="-2497.8037" rx="27" ry="18"/>
<text text-anchor="middle" x="620" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_11 -->
<g id="edge11" class="edge">
<title>prose_3&#45;&gt;raw_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M557.2159,-2600.7965C565.3179,-2590.3232 575.6931,-2576.3715 584,-2563.4038 592.0728,-2550.8015 600.1703,-2536.2568 606.6354,-2524.0701"/>
<polygon fill="#000000" stroke="#000000" points="609.9065,-2525.3677 611.4387,-2514.8842 603.7033,-2522.124 609.9065,-2525.3677"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="1080.5,-2563.5041 665.5,-2563.5041 665.5,-2432.1032 1080.5,-2432.1032 1080.5,-2563.5041"/>
<text text-anchor="middle" x="873" y="-2548.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="873" y="-2532.8037" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, R, S, match = L.P, L.R, L.S, L.match</text>
<text text-anchor="middle" x="873" y="-2517.4037" font-family="Inconsolata" font-size="14.00" fill="#000000">local Lex = meta {}</text>
<text text-anchor="middle" x="873" y="-2502.0037" font-family="Inconsolata" font-size="14.00" fill="#000000">local Rainbuf = require &quot;rainbuf&quot;</text>
<text text-anchor="middle" x="873" y="-2486.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub, gsub = assert(string.sub), assert(string.gsub)</text>
<text text-anchor="middle" x="873" y="-2471.2036" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = assert(table.concat)</text>
<text text-anchor="middle" x="873" y="-2455.8036" font-family="Inconsolata" font-size="14.00" fill="#000000">local c = require &quot;color&quot;</text>
<text text-anchor="middle" x="873" y="-2440.4036" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints)</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_4&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2599.2391C873,-2591.9641 873,-2583.0571 873,-2573.5716"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2573.5216 873,-2563.5216 869.5001,-2573.5217 876.5001,-2573.5216"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="1162" cy="-2497.8037" rx="63.3963" ry="18"/>
<text text-anchor="middle" x="1162" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Lua lexers</text>
</g>
<!-- section_5&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1209.6162,-2599.4984C1200.3787,-2579.7698 1185.4168,-2547.8154 1174.7302,-2524.9917"/>
<polygon fill="#000000" stroke="#000000" points="1177.8513,-2523.4036 1170.4411,-2515.8314 1171.5118,-2526.372 1177.8513,-2523.4036"/>
</g>
<!-- prose_18 -->
<g id="node19" class="node">
<title>prose_18</title>
<ellipse fill="none" stroke="#000000" cx="1275" cy="-2497.8037" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1275" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;prose_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1226.5335,-2599.4984C1235.9903,-2579.6557 1251.3413,-2547.4456 1262.2307,-2524.5968"/>
<polygon fill="#000000" stroke="#000000" points="1265.4515,-2525.974 1266.5942,-2515.441 1259.1324,-2522.9624 1265.4515,-2525.974"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="1493" cy="-2497.8037" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1493" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 20&#45;117</text>
</g>
<!-- section_5&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_5&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1253.6695,-2601.8908C1302.8874,-2580.4854 1391.7074,-2541.8568 1446.2053,-2518.1551"/>
<polygon fill="#000000" stroke="#000000" points="1447.8601,-2521.2522 1455.6345,-2514.0543 1445.0683,-2514.833 1447.8601,-2521.2522"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="1913" cy="-2497.8037" rx="103.0387" ry="18"/>
<text text-anchor="middle" x="1913" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Lex.lua_thor(linebuf)</text>
</g>
<!-- section_6&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_6&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1977.622,-2599.4984C1964.9735,-2579.5936 1944.4168,-2547.2438 1929.8896,-2524.3826"/>
<polygon fill="#000000" stroke="#000000" points="1932.7731,-2522.3944 1924.4557,-2515.8314 1926.865,-2526.1487 1932.7731,-2522.3944"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2066" cy="-2497.8037" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2066" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_6&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2001.133,-2599.491C2008.1773,-2589.0201 2017.1773,-2575.5201 2025,-2563.4038 2033.4173,-2550.3666 2042.5888,-2535.7341 2050.1188,-2523.6023"/>
<polygon fill="#000000" stroke="#000000" points="2053.2304,-2525.2254 2055.5175,-2514.8803 2047.2783,-2521.5411 2053.2304,-2525.2254"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2469" cy="-2497.8037" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2469" y="-2493.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 125&#45;186</text>
</g>
<!-- section_6&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_6&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2041.2822,-2604.3768C2130.4585,-2582.157 2311.5626,-2537.0318 2406.9817,-2513.2566"/>
<polygon fill="#000000" stroke="#000000" points="2407.9252,-2516.6286 2416.7823,-2510.8146 2406.2327,-2509.8362 2407.9252,-2516.6286"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="408,-1680.2036 0,-1680.2036 0,-1608.4013 408,-1608.4013 408,-1680.2036"/>
<text text-anchor="middle" x="204" y="-1616.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">We&#39;re going to do this will straight el peg, and fold in</text>
</g>
<!-- raw_8&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>raw_8&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M353.7336,-2479.5822C334.9817,-2374.9757 240.8582,-1849.9138 212.2563,-1690.3598"/>
<polygon fill="#000000" stroke="#000000" points="215.6783,-1689.6127 210.4686,-1680.3872 208.7881,-1690.8479 215.6783,-1689.6127"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="480,-1662.3025 426,-1662.3025 426,-1626.3025 480,-1626.3025 480,-1662.3025"/>
<text text-anchor="middle" x="453" y="-1640.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_9&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prespace_9&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M448.1067,-2479.5822C448.7448,-2370.6675 452.053,-1805.9508 452.8345,-1672.5608"/>
<polygon fill="#000000" stroke="#000000" points="456.3355,-1672.3737 452.8943,-1662.3534 449.3356,-1672.3327 456.3355,-1672.3737"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="577,-1662.3025 505,-1662.3025 505,-1626.3025 577,-1626.3025 577,-1662.3025"/>
<text text-anchor="middle" x="541" y="-1640.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">espalier</text>
</g>
<!-- literal_10&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>literal_10&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M543.936,-2479.5822C543.5531,-2370.6675 541.5682,-1805.9508 541.0993,-1672.5608"/>
<polygon fill="#000000" stroke="#000000" points="544.5987,-1672.341 541.0634,-1662.3534 537.5987,-1672.3657 544.5987,-1672.341"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="653,-1662.3025 595,-1662.3025 595,-1626.3025 653,-1626.3025 653,-1662.3025"/>
<text text-anchor="middle" x="624" y="-1640.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> ASAP.</text>
</g>
<!-- raw_11&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_11&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M620.0854,-2479.5822C620.5958,-2370.6675 623.2424,-1805.9508 623.8676,-1672.5608"/>
<polygon fill="#000000" stroke="#000000" points="627.3684,-1672.3697 623.9154,-1662.3534 620.3685,-1672.3368 627.3684,-1672.3697"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1175,-1662.3025 1061,-1662.3025 1061,-1626.3025 1175,-1626.3025 1175,-1662.3025"/>
<text text-anchor="middle" x="1118" y="-1640.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Lua lexers</text>
</g>
<!-- header_17&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>header_17&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1161.0606,-2479.5822C1155.4458,-2370.6675 1126.3334,-1805.9508 1119.4568,-1672.5608"/>
<polygon fill="#000000" stroke="#000000" points="1122.9409,-1672.1599 1118.9306,-1662.3534 1115.9501,-1672.5203 1122.9409,-1672.1599"/>
</g>
<!-- raw_21 -->
<g id="node22" class="node">
<title>raw_21</title>
<ellipse fill="none" stroke="#000000" cx="1220" cy="-1644.3025" rx="27" ry="18"/>
<text text-anchor="middle" x="1220" y="-1640.1025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_18&#45;&gt;raw_21 -->
<g id="edge21" class="edge">
<title>prose_18&#45;&gt;raw_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1270.8885,-2479.9313C1266.4205,-2459.7266 1259.4583,-2425.7903 1256,-2396.2035 1223.1692,-2115.3225 1220.1188,-1772.0654 1219.9609,-1672.5635"/>
<polygon fill="#000000" stroke="#000000" points="1223.4609,-1672.4147 1219.9539,-1662.4171 1216.4609,-1672.4196 1223.4609,-1672.4147"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1806.5,-2396.1046 1265.5,-2396.1046 1265.5,-892.5004 1806.5,-892.5004 1806.5,-2396.1046"/>
<text text-anchor="middle" x="1536" y="-2381.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = (P&quot; &quot;)^0</text>
<text text-anchor="middle" x="1536" y="-2349.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">local NL = P&quot;\n&quot;</text>
<text text-anchor="middle" x="1536" y="-2318.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">local terminal = S&quot; \&quot;&#39;+&#45;*^~%#;,&lt;&gt;={}[]().:\n&quot; + &#45;P(1)</text>
<text text-anchor="middle" x="1536" y="-2286.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">local KW = (P&quot;function&quot; + &quot;local&quot; + &quot;for&quot; + &quot;in&quot; + &quot;do&quot;</text>
<text text-anchor="middle" x="1536" y="-2271.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;and&quot; + &quot;or&quot; + &quot;not&quot; + &quot;true&quot; + &quot;false&quot;</text>
<text text-anchor="middle" x="1536" y="-2256.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;while&quot; + &quot;break&quot; + &quot;if&quot; + &quot;then&quot; + &quot;else&quot; + &quot;elseif&quot;</text>
<text text-anchor="middle" x="1536" y="-2240.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;goto&quot; + &quot;repeat&quot; + &quot;until&quot; + &quot;return&quot; + &quot;nil&quot;</text>
<text text-anchor="middle" x="1536" y="-2225.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;end&quot;) * #terminal</text>
<text text-anchor="middle" x="1536" y="-2193.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">local OP = P&quot;+&quot; + &quot;&#45;&quot; + &quot;*&quot; + &quot;/&quot; + &quot;%&quot; + &quot;^&quot; + &quot;#&quot;</text>
<text text-anchor="middle" x="1536" y="-2178.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;==&quot; + &quot;~=&quot; + &quot;&lt;=&quot; + &quot;&gt;=&quot; + &quot;&lt;&quot; + &quot;&gt;&quot;</text>
<text text-anchor="middle" x="1536" y="-2163.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;=&quot; + &quot;(&quot; + &quot;)&quot; + &quot;{&quot; + &quot;}&quot; + &quot;[&quot; + &quot;]&quot;</text>
<text text-anchor="middle" x="1536" y="-2147.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;;&quot; + &quot;;&quot; + &quot;...&quot; + &quot;..&quot; + &quot;.&quot; + &quot;,&quot;</text>
<text text-anchor="middle" x="1536" y="-2116.2032" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; long strings, straight from the LPEG docs</text>
<text text-anchor="middle" x="1536" y="-2084.8031" font-family="Inconsolata" font-size="14.00" fill="#000000">local _equals = P&quot;=&quot;^0</text>
<text text-anchor="middle" x="1536" y="-2069.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">local _open = &quot;[&quot; * L.Cg(_equals, &quot;init&quot;) * &quot;[&quot; * P&quot;\n&quot;^&#45;1</text>
<text text-anchor="middle" x="1536" y="-2054.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">local _close = &quot;]&quot; * L.C(_equals) * &quot;]&quot;</text>
<text text-anchor="middle" x="1536" y="-2038.603" font-family="Inconsolata" font-size="14.00" fill="#000000">local _closeeq = L.Cmt(_close * L.Cb(&quot;init&quot;),</text>
<text text-anchor="middle" x="1536" y="-2023.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;function (s, i, a, b) return a == b end)</text>
<text text-anchor="middle" x="1536" y="-1991.803" font-family="Inconsolata" font-size="14.00" fill="#000000">local long_str = (_open * L.C((P(1) &#45; _closeeq)^0) * _close) / 0 * L.Cp()</text>
<text text-anchor="middle" x="1536" y="-1960.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">local str_esc = P&quot;\\&quot; * (S&quot;abfnrtv\\\&quot;&#39;[]\n&quot; + (R&quot;09&quot; * R&quot;09&quot;^&#45;2))</text>
<text text-anchor="middle" x="1536" y="-1929.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">local double_str = P&quot;\&quot;&quot; * (P(1) &#45; (P&quot;\&quot;&quot; + P&quot;\\&quot;) + str_esc)^0 * P&quot;\&quot;&quot;</text>
<text text-anchor="middle" x="1536" y="-1913.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">local single_str = P&quot;\&#39;&quot; * (P(1) &#45; (P&quot;\&#39;&quot; + P&quot;\\&quot;) + str_esc)^0 * P&quot;\&#39;&quot;</text>
<text text-anchor="middle" x="1536" y="-1882.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">local string_esc = double_str + single_str</text>
<text text-anchor="middle" x="1536" y="-1850.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local string_long = long_str</text>
<text text-anchor="middle" x="1536" y="-1819.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">local digit = R&quot;09&quot;</text>
<text text-anchor="middle" x="1536" y="-1788.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">local letter = R&quot;az&quot; + R&quot;AZ&quot;</text>
<text text-anchor="middle" x="1536" y="-1756.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local symbol = &#160;&#160;(letter^1 + P&quot;_&quot;^1)</text>
<text text-anchor="middle" x="1536" y="-1741.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* (letter + digit + P&quot;_&quot;)^0</text>
<text text-anchor="middle" x="1536" y="-1725.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* #terminal</text>
<text text-anchor="middle" x="1536" y="-1694.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local _decimal = P&quot;&#45;&quot;^0 * ((digit^1 * P&quot;.&quot;^&#45;1 * digit^0</text>
<text text-anchor="middle" x="1536" y="-1679.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* ((P&quot;e&quot; + P&quot;E&quot;)^&#45;1 * P&quot;&#45;&quot;^&#45;1 * digit^1)^&#45;1</text>
<text text-anchor="middle" x="1536" y="-1663.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ digit^1)^1 + digit^1)</text>
<text text-anchor="middle" x="1536" y="-1632.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local _hexadecimal = P&quot;0&quot; * (P&quot;x&quot; + P&quot;X&quot;) * (digit + R&quot;af&quot; + R&quot;AF&quot;)^1</text>
<text text-anchor="middle" x="1536" y="-1600.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local number = _hexadecimal + _decimal</text>
<text text-anchor="middle" x="1536" y="-1569.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local comment = P&quot;&#45;&#45;&quot; * long_str</text>
<text text-anchor="middle" x="1536" y="-1554.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ P&quot;&#45;&#45;&quot; * (P(1) &#45; NL)^0 * (NL + &#45; P(1))</text>
<text text-anchor="middle" x="1536" y="-1506.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local ERR = P(1)</text>
<text text-anchor="middle" x="1536" y="-1475.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local lua_toks = {comment, KW, string_long, string_esc, number, OP, symbol,</text>
<text text-anchor="middle" x="1536" y="-1459.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS, NL, ERR}</text>
<text text-anchor="middle" x="1536" y="-1428.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_kv = { KW = KW,</text>
<text text-anchor="middle" x="1536" y="-1413.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;number = number,</text>
<text text-anchor="middle" x="1536" y="-1397.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OP = OP,</text>
<text text-anchor="middle" x="1536" y="-1382.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;symbol = symbol,</text>
<text text-anchor="middle" x="1536" y="-1366.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string_long = string_long,</text>
<text text-anchor="middle" x="1536" y="-1351.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string_esc = string_esc,</text>
<text text-anchor="middle" x="1536" y="-1336.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment = comment,</text>
<text text-anchor="middle" x="1536" y="-1320.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS = WS,</text>
<text text-anchor="middle" x="1536" y="-1305.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NL = NL,</text>
<text text-anchor="middle" x="1536" y="-1289.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ERR = ERR}</text>
<text text-anchor="middle" x="1536" y="-1258.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local color_map = {</text>
<text text-anchor="middle" x="1536" y="-1243.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;KW = c.color.keyword(),</text>
<text text-anchor="middle" x="1536" y="-1227.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;OP = c.color.operator(),</text>
<text text-anchor="middle" x="1536" y="-1212.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;number = c.color.number(),</text>
<text text-anchor="middle" x="1536" y="-1196.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;symbol = c.color.field(),</text>
<text text-anchor="middle" x="1536" y="-1181.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;string_esc = c.color.string(),</text>
<text text-anchor="middle" x="1536" y="-1166.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;string_long = c.color.string(),</text>
<text text-anchor="middle" x="1536" y="-1150.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;comment = c.color.comment(),</text>
<text text-anchor="middle" x="1536" y="-1135.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ERR = c.color.error(),</text>
<text text-anchor="middle" x="1536" y="-1119.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1536" y="-1072.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_map = {}</text>
<text text-anchor="middle" x="1536" y="-1041.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">for k, v in pairs(lex_kv) do</text>
<text text-anchor="middle" x="1536" y="-1025.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;lex_map[v] = k</text>
<text text-anchor="middle" x="1536" y="-1010.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1536" y="-978.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">lex_kv = nil</text>
<text text-anchor="middle" x="1536" y="-947.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.lex_map = lex_map</text>
<text text-anchor="middle" x="1536" y="-916.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.long_str = long_str</text>
<text text-anchor="middle" x="1536" y="-900.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.string = string_long</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_19&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1493.918,-2479.5822C1494.7122,-2463.8185 1495.9874,-2438.5067 1497.6082,-2406.3364"/>
<polygon fill="#000000" stroke="#000000" points="1501.1144,-2406.2987 1498.1221,-2396.1353 1494.1233,-2405.9465 1501.1144,-2406.2987"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1247,-491.9007 1193,-491.9007 1193,-455.9007 1247,-455.9007 1247,-491.9007"/>
</g>
<!-- raw_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>raw_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1220,-1625.9183C1220,-1492.0183 1220,-667.3405 1220,-502.5426"/>
<polygon fill="#000000" stroke="#000000" points="1223.5001,-502.2444 1220,-492.2445 1216.5001,-502.2445 1223.5001,-502.2444"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="2009,-1662.3025 1825,-1662.3025 1825,-1626.3025 2009,-1626.3025 2009,-1662.3025"/>
<text text-anchor="middle" x="1917" y="-1640.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">** Lex.lua_thor(linebuf)</text>
</g>
<!-- header_24&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>header_24&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1913.0854,-2479.5822C1913.5958,-2370.6675 1916.2424,-1805.9508 1916.8676,-1672.5608"/>
<polygon fill="#000000" stroke="#000000" points="1920.3684,-1672.3697 1916.9154,-1662.3534 1913.3685,-1672.3368 1920.3684,-1672.3697"/>
</g>
<!-- raw_28 -->
<g id="node29" class="node">
<title>raw_28</title>
<ellipse fill="none" stroke="#000000" cx="2062" cy="-1644.3025" rx="27" ry="18"/>
<text text-anchor="middle" x="2062" y="-1640.1025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_28 -->
<g id="edge28" class="edge">
<title>prose_25&#45;&gt;raw_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2065.9146,-2479.5822C2065.4042,-2370.6675 2062.7576,-1805.9508 2062.1324,-1672.5608"/>
<polygon fill="#000000" stroke="#000000" points="2065.6315,-1672.3368 2062.0846,-1662.3534 2058.6316,-1672.3697 2065.6315,-1672.3368"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="2286" cy="-1644.3025" rx="88.0294" ry="18"/>
<text text-anchor="middle" x="2286" y="-1640.1025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : chomp_token(lb)</text>
</g>
<!-- section_26&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_26&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2460.4873,-2479.8335C2451.3079,-2459.8221 2436.8272,-2426.3212 2428,-2396.2035 2347.0583,-2120.0379 2301.422,-1772.8474 2289.2994,-1672.5888"/>
<polygon fill="#000000" stroke="#000000" points="2292.7402,-1671.8848 2288.0773,-1662.3713 2285.7898,-1672.7162 2292.7402,-1671.8848"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="2469" cy="-1644.3025" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2469" y="-1640.1025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_26&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2469,-2479.5822C2469,-2370.6675 2469,-1805.9508 2469,-1672.5608"/>
<polygon fill="#000000" stroke="#000000" points="2472.5001,-1672.3533 2469,-1662.3534 2465.5001,-1672.3534 2472.5001,-1672.3533"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="2709" cy="-1644.3025" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2709" y="-1640.1025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 130&#45;180</text>
</g>
<!-- section_26&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>section_26&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2477.1036,-2479.7055C2485.9248,-2459.5821 2500.0934,-2425.9836 2510,-2396.2035 2602.4282,-2118.3569 2681.0573,-1771.7152 2702.9458,-1672.1865"/>
<polygon fill="#000000" stroke="#000000" points="2706.3891,-1672.8238 2705.1104,-1662.3064 2699.5513,-1671.3256 2706.3891,-1672.8238"/>
</g>
<!-- codeblock_33 -->
<g id="node34" class="node">
<title>codeblock_33</title>
<ellipse fill="none" stroke="#000000" cx="3036" cy="-1644.3025" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3036" y="-1640.1025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 183&#45;185</text>
</g>
<!-- section_26&#45;&gt;codeblock_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;codeblock_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2528.9104,-2486.7012C2614.5537,-2469.697 2765.9691,-2435.0619 2805,-2396.2035 3017.6214,-2184.5217 3035.432,-1782.3717 3036.2084,-1672.594"/>
<polygon fill="#000000" stroke="#000000" points="3039.7089,-1672.3469 3036.2353,-1662.3377 3032.709,-1672.3284 3039.7089,-1672.3469"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2092.5,-509.8019 1985.5,-509.8019 1985.5,-437.9996 2092.5,-437.9996 2092.5,-509.8019"/>
<text text-anchor="middle" x="2039" y="-462.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">...it&#39;s late.</text>
</g>
<!-- raw_28&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>raw_28&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2061.6387,-1625.9183C2059.0897,-1496.2065 2043.8019,-718.2544 2039.904,-519.9021"/>
<polygon fill="#000000" stroke="#000000" points="2043.4017,-519.7479 2039.7058,-509.8187 2036.4031,-519.8855 2043.4017,-519.7479"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2259.5,-491.9007 2110.5,-491.9007 2110.5,-455.9007 2259.5,-455.9007 2259.5,-491.9007"/>
<text text-anchor="middle" x="2185" y="-470.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">*** chomp_token(lb)</text>
</g>
<!-- header_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>header_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2284.4135,-1625.9183C2272.8586,-1492.0183 2201.6929,-667.3405 2187.4717,-502.5426"/>
<polygon fill="#000000" stroke="#000000" points="2190.9299,-501.9065 2186.583,-492.2445 2183.9558,-502.5084 2190.9299,-501.9065"/>
</g>
<!-- raw_35 -->
<g id="node36" class="node">
<title>raw_35</title>
<ellipse fill="none" stroke="#000000" cx="2305" cy="-473.9007" rx="27" ry="18"/>
<text text-anchor="middle" x="2305" y="-469.7007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_35 -->
<g id="edge35" class="edge">
<title>prose_31&#45;&gt;raw_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2471.5071,-1626.2619C2482.7442,-1539.0202 2522.0762,-1154.3867 2383,-892.4014 2371.4723,-870.6861 2352.3095,-878.2312 2341,-856.4014 2279.0926,-736.9071 2292.4076,-568.1681 2300.8274,-502.0376"/>
<polygon fill="#000000" stroke="#000000" points="2304.3168,-502.3493 2302.1743,-491.9733 2297.3787,-501.4207 2304.3168,-502.3493"/>
</g>
<!-- prespace_36 -->
<g id="node37" class="node">
<title>prespace_36</title>
<ellipse fill="none" stroke="#000000" cx="2396" cy="-473.9007" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2396" y="-469.7007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_31&#45;&gt;prespace_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;prespace_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2467.8533,-1625.9183C2459.5018,-1492.0183 2408.0652,-667.3405 2397.7864,-502.5426"/>
<polygon fill="#000000" stroke="#000000" points="2401.2599,-502.0072 2397.1441,-492.2445 2394.2735,-502.443 2401.2599,-502.0072"/>
</g>
<!-- literal_37 -->
<g id="node38" class="node">
<title>literal_37</title>
<ellipse fill="none" stroke="#000000" cx="2492" cy="-473.9007" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2492" y="-469.7007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_31&#45;&gt;literal_37 -->
<g id="edge37" class="edge">
<title>prose_31&#45;&gt;literal_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2469.3613,-1625.9183C2471.9926,-1492.0183 2488.1986,-667.3405 2491.4371,-502.5426"/>
<polygon fill="#000000" stroke="#000000" points="2494.9423,-502.3113 2491.6395,-492.2445 2487.9436,-502.1737 2494.9423,-502.3113"/>
</g>
<!-- raw_38 -->
<g id="node39" class="node">
<title>raw_38</title>
<ellipse fill="none" stroke="#000000" cx="2568" cy="-473.9007" rx="27" ry="18"/>
<text text-anchor="middle" x="2568" y="-469.7007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_38 -->
<g id="edge38" class="edge">
<title>prose_31&#45;&gt;raw_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2470.5551,-1625.9183C2481.8812,-1492.0183 2551.6376,-667.3405 2565.5773,-502.5426"/>
<polygon fill="#000000" stroke="#000000" points="2569.093,-502.5039 2566.4484,-492.2445 2562.1179,-501.9139 2569.093,-502.5039"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="3007,-856.4021 2613,-856.4021 2613,-91.3993 3007,-91.3993 3007,-856.4021"/>
<text text-anchor="middle" x="2810" y="-841.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local function chomp_token(lb)</text>
<text text-anchor="middle" x="2810" y="-825.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(lua_toks) do</text>
<text text-anchor="middle" x="2810" y="-810.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite = match(v, lb)</text>
<text text-anchor="middle" x="2810" y="-795.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite ~= nil then</text>
<text text-anchor="middle" x="2810" y="-779.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return sub(lb, 1, bite &#45; 1), sub(lb, bite), v</text>
<text text-anchor="middle" x="2810" y="-764.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2810" y="-748.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2810" y="-733.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="2810" y="-718.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2810" y="-686.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.chomp = chomp_token</text>
<text text-anchor="middle" x="2810" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _str_hl(str)</text>
<text text-anchor="middle" x="2810" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local mark = sub(str,1,1) == &quot;&#39;&quot; and &quot;&#39;&quot; or &#39;&quot;&#39;</text>
<text text-anchor="middle" x="2810" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;mark = c.color.string(mark)</text>
<text text-anchor="middle" x="2810" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return mark .. ts(str) .. mark</text>
<text text-anchor="middle" x="2810" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2810" y="-546.201" font-family="Inconsolata" font-size="14.00" fill="#000000">function Lex.lua_thor(linebuf)</text>
<text text-anchor="middle" x="2810" y="-530.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local toks = {}</text>
<text text-anchor="middle" x="2810" y="-515.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="2810" y="-500.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while lb ~= &quot;&quot; do</text>
<text text-anchor="middle" x="2810" y="-484.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local len = #lb</text>
<text text-anchor="middle" x="2810" y="-469.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite, tok_t</text>
<text text-anchor="middle" x="2810" y="-453.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;bite, lb, tok_t = chomp_token(lb)</text>
<text text-anchor="middle" x="2810" y="-438.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite == nil then</text>
<text text-anchor="middle" x="2810" y="-423.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="2810" y="-407.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2810" y="-392.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; #todo add a color</text>
<text text-anchor="middle" x="2810" y="-376.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local col = color_map[lex_map[tok_t]]</text>
<text text-anchor="middle" x="2810" y="-361.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if col then</text>
<text text-anchor="middle" x="2810" y="-346.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = col</text>
<text text-anchor="middle" x="2810" y="-330.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = bite</text>
<text text-anchor="middle" x="2810" y="-315.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif tok_t == string_esc then</text>
<text text-anchor="middle" x="2810" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = _str_hl(bite)</text>
<text text-anchor="middle" x="2810" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2810" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = bite</text>
<text text-anchor="middle" x="2810" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2810" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2810" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if len == #lb then</text>
<text text-anchor="middle" x="2810" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = a.clear .. color_map.ERR</text>
<text text-anchor="middle" x="2810" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = sub(lb, 1, 1)</text>
<text text-anchor="middle" x="2810" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lb = sub(lb,2)</text>
<text text-anchor="middle" x="2810" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2810" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2810" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;toks[#toks + 1] = a.clear()</text>
<text text-anchor="middle" x="2810" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return toks</text>
<text text-anchor="middle" x="2810" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>codeblock_32&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2710.5865,-1625.9183C2718.0432,-1539.5081 2750.3253,-1165.4194 2776.108,-866.6457"/>
<polygon fill="#000000" stroke="#000000" points="2779.6112,-866.7588 2776.984,-856.4949 2772.6371,-866.1569 2779.6112,-866.7588"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3111,-491.9007 3025,-491.9007 3025,-455.9007 3111,-455.9007 3111,-491.9007"/>
<text text-anchor="middle" x="3068" y="-470.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">return Lex</text>
</g>
<!-- codeblock_33&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_33&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3036.5026,-1625.9183C3040.1636,-1492.0183 3062.7112,-667.3405 3067.2169,-502.5426"/>
<polygon fill="#000000" stroke="#000000" points="3070.7238,-502.3364 3067.4985,-492.2445 3063.7264,-502.1451 3070.7238,-502.3364"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2356.5,-55.6015 2081.5,-55.6015 2081.5,.2015 2356.5,.2015 2356.5,-55.6015"/>
<text text-anchor="middle" x="2219" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an almost pessimal way to use</text>
</g>
<!-- raw_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>raw_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2306.7002,-455.5453C2311.2304,-398.9374 2319.945,-222.9546 2268,-91.4 2264.1953,-81.7643 2258.4756,-72.3594 2252.2718,-63.8621"/>
<polygon fill="#000000" stroke="#000000" points="2254.8433,-61.4657 2245.9597,-55.6923 2249.304,-65.7455 2254.8433,-61.4657"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="2429,-45.7 2375,-45.7 2375,-9.7 2429,-9.7 2429,-45.7"/>
<text text-anchor="middle" x="2402" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_36&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>prespace_36&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2396.2426,-455.8565C2397.1689,-386.9747 2400.4866,-140.2434 2401.6185,-56.0716"/>
<polygon fill="#000000" stroke="#000000" points="2405.1195,-56.015 2401.7543,-45.9688 2398.1201,-55.9208 2405.1195,-56.015"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="2513,-45.7 2459,-45.7 2459,-9.7 2513,-9.7 2513,-45.7"/>
<text text-anchor="middle" x="2486" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_37&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>literal_37&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2491.7574,-455.8565C2490.8311,-386.9747 2487.5134,-140.2434 2486.3815,-56.0716"/>
<polygon fill="#000000" stroke="#000000" points="2489.8799,-55.9208 2486.2457,-45.9688 2482.8805,-56.015 2489.8799,-55.9208"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="2778.5,-47.0006 2531.5,-47.0006 2531.5,-8.3994 2778.5,-8.3994 2778.5,-47.0006"/>
<text text-anchor="middle" x="2655" y="-31.9" font-family="Inconsolata" font-size="14.00" fill="#000000">, which is quite capable of</text>
<text text-anchor="middle" x="2655" y="-16.5" font-family="Inconsolata" font-size="14.00" fill="#000000">handling a full line in one pass.</text>
</g>
<!-- raw_38&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>raw_38&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2566.1601,-455.9027C2561.1279,-399.6062 2550.8373,-222.7893 2604,-91.4 2609.3776,-78.1095 2618.4738,-65.372 2627.508,-54.8273"/>
<polygon fill="#000000" stroke="#000000" points="2630.2638,-56.9969 2634.3418,-47.2183 2625.0559,-52.3195 2630.2638,-56.9969"/>
</g>
</g>
</svg>
