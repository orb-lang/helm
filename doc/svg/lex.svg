<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="3052pt" height="2540pt"
 viewBox="0.00 0.00 3052.30 2539.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2535.8033)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2535.8033 3048.2972,-2535.8033 3048.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="831" cy="-2513.8033" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="831" y="-2509.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 170</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="831" cy="-2441.8033" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="831" y="-2437.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;113</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M831,-2495.6347C831,-2487.9343 831,-2478.7777 831,-2470.22"/>
<polygon fill="#000000" stroke="#000000" points="834.5001,-2470.2166 831,-2460.2166 827.5001,-2470.2166 834.5001,-2470.2166"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="371" cy="-2369.8033" rx="36.8096" ry="18"/>
<text text-anchor="middle" x="371" y="-2365.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Lex</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M774.1336,-2432.9025C681.6016,-2418.4192 500.3296,-2390.0462 416.0605,-2376.8563"/>
<polygon fill="#000000" stroke="#000000" points="416.4569,-2373.3758 406.0359,-2375.2872 415.3743,-2380.2916 416.4569,-2373.3758"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2369.8033" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="544" y="-2365.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M782.6389,-2429.6709C726.626,-2415.6189 635.4153,-2392.7368 583.4831,-2379.7085"/>
<polygon fill="#000000" stroke="#000000" points="584.1936,-2376.2784 573.6425,-2377.2398 582.4903,-2383.068 584.1936,-2376.2784"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="831" cy="-2369.8033" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="831" y="-2365.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 6&#45;13</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M831,-2423.6347C831,-2415.9343 831,-2406.7777 831,-2398.22"/>
<polygon fill="#000000" stroke="#000000" points="834.5001,-2398.2166 831,-2388.2166 827.5001,-2398.2166 834.5001,-2398.2166"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="1134" cy="-2369.8033" rx="69.851" ry="18"/>
<text text-anchor="middle" x="1134" y="-2365.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 16&#45;113</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M880.3565,-2430.0751C932.798,-2417.6137 1015.803,-2397.8897 1072.472,-2384.4239"/>
<polygon fill="#000000" stroke="#000000" points="1073.4623,-2387.7861 1082.3823,-2382.0689 1071.844,-2380.9757 1073.4623,-2387.7861"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1910" cy="-2369.8033" rx="74.3839" ry="18"/>
<text text-anchor="middle" x="1910" y="-2365.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 114&#45;118</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M894.4681,-2437.5682C1079.9378,-2425.1921 1620.9728,-2389.0897 1828.0601,-2375.2711"/>
<polygon fill="#000000" stroke="#000000" points="1828.5146,-2378.7486 1838.2593,-2374.5905 1828.0485,-2371.7641 1828.5146,-2378.7486"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="312,-2283.6032 258,-2283.6032 258,-2247.6032 312,-2247.6032 312,-2283.6032"/>
<text text-anchor="middle" x="285" y="-2262.1033" font-family="Inconsolata" font-size="14.00" fill="#000000">* Lex</text>
</g>
<!-- header_2&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>header_2&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M354.6775,-2353.2649C344.6244,-2342.8176 331.6642,-2328.8689 321,-2315.8033 314.8904,-2308.3179 308.6223,-2299.8837 303.064,-2292.0956"/>
<polygon fill="#000000" stroke="#000000" points="305.7503,-2289.8308 297.1364,-2283.6621 300.0234,-2293.856 305.7503,-2289.8308"/>
</g>
<!-- raw_8 -->
<g id="node9" class="node">
<title>raw_8</title>
<ellipse fill="none" stroke="#000000" cx="357" cy="-2265.6032" rx="27" ry="18"/>
<text text-anchor="middle" x="357" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;raw_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M513.0413,-2364.4186C480.5442,-2357.5461 429.2353,-2343.1246 393,-2315.8033 384.4835,-2309.382 377.1509,-2300.3735 371.3677,-2291.7571"/>
<polygon fill="#000000" stroke="#000000" points="374.1881,-2289.6661 365.9171,-2283.0448 368.2537,-2293.3788 374.1881,-2289.6661"/>
</g>
<!-- prespace_9 -->
<g id="node10" class="node">
<title>prespace_9</title>
<ellipse fill="none" stroke="#000000" cx="448" cy="-2265.6032" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="448" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_3&#45;&gt;prespace_9 -->
<g id="edge9" class="edge">
<title>prose_3&#45;&gt;prespace_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M529,-2353.5221C513.3577,-2336.5436 488.653,-2309.7287 470.6367,-2290.1735"/>
<polygon fill="#000000" stroke="#000000" points="473.2023,-2287.7928 463.8524,-2282.8098 468.0541,-2292.5359 473.2023,-2287.7928"/>
</g>
<!-- literal_10 -->
<g id="node11" class="node">
<title>literal_10</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2265.6032" rx="31.481" ry="18"/>
<text text-anchor="middle" x="544" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_3&#45;&gt;literal_10 -->
<g id="edge10" class="edge">
<title>prose_3&#45;&gt;literal_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M544,-2351.6531C544,-2335.7631 544,-2312.4105 544,-2294.0409"/>
<polygon fill="#000000" stroke="#000000" points="547.5001,-2293.8951 544,-2283.8951 540.5001,-2293.8952 547.5001,-2293.8951"/>
</g>
<!-- raw_11 -->
<g id="node12" class="node">
<title>raw_11</title>
<ellipse fill="none" stroke="#000000" cx="620" cy="-2265.6032" rx="27" ry="18"/>
<text text-anchor="middle" x="620" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_11 -->
<g id="edge11" class="edge">
<title>prose_3&#45;&gt;raw_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M556.6781,-2352.8283C564.5777,-2342.2167 574.929,-2328.2486 584,-2315.8033 590.0308,-2307.5292 596.5701,-2298.4449 602.4,-2290.3053"/>
<polygon fill="#000000" stroke="#000000" points="605.4213,-2292.0973 608.3899,-2281.9269 599.7269,-2288.0262 605.4213,-2292.0973"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="996.5,-2316.0042 665.5,-2316.0042 665.5,-2215.2023 996.5,-2215.2023 996.5,-2316.0042"/>
<text text-anchor="middle" x="831" y="-2300.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="831" y="-2285.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, R, S, match = L.P, L.R, L.S, L.match</text>
<text text-anchor="middle" x="831" y="-2269.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">local Lex = meta {}</text>
<text text-anchor="middle" x="831" y="-2254.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">local Rainbuf = require &quot;rainbuf&quot;</text>
<text text-anchor="middle" x="831" y="-2239.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub = assert(string.sub)</text>
<text text-anchor="middle" x="831" y="-2223.6032" font-family="Inconsolata" font-size="14.00" fill="#000000">local c = require &quot;color&quot;</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_4&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M831,-2351.6531C831,-2344.3736 831,-2335.528 831,-2326.3127"/>
<polygon fill="#000000" stroke="#000000" points="834.5001,-2326.2248 831,-2316.2248 827.5001,-2326.2248 834.5001,-2326.2248"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="1078" cy="-2265.6032" rx="63.3963" ry="18"/>
<text text-anchor="middle" x="1078" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Lua lexers</text>
</g>
<!-- section_5&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1124.2455,-2351.6531C1115.4527,-2335.292 1102.4079,-2311.0194 1092.4125,-2292.4208"/>
<polygon fill="#000000" stroke="#000000" points="1095.4596,-2290.6971 1087.6427,-2283.5455 1089.2937,-2294.0109 1095.4596,-2290.6971"/>
</g>
<!-- prose_18 -->
<g id="node19" class="node">
<title>prose_18</title>
<ellipse fill="none" stroke="#000000" cx="1191" cy="-2265.6032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1191" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;prose_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1143.9286,-2351.6531C1152.9877,-2335.0925 1166.4807,-2310.4263 1176.7009,-2291.7429"/>
<polygon fill="#000000" stroke="#000000" points="1179.8351,-2293.3065 1181.5636,-2282.8536 1173.6938,-2289.9471 1179.8351,-2293.3065"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="1410" cy="-2265.6032" rx="81.1496" ry="18"/>
<text text-anchor="middle" x="1410" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 18&#45;111</text>
</g>
<!-- section_5&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_5&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1173.5441,-2354.874C1222.3761,-2336.4381 1305.5272,-2305.0456 1359.0855,-2284.8253"/>
<polygon fill="#000000" stroke="#000000" points="1360.6074,-2287.992 1368.7266,-2281.1855 1358.1349,-2281.4431 1360.6074,-2287.992"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="1834" cy="-2265.6032" rx="103.0387" ry="18"/>
<text text-anchor="middle" x="1834" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Lex.lua_thor(linebuf)</text>
</g>
<!-- section_6&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_6&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1896.7618,-2351.6531C1884.6652,-2335.0679 1866.6389,-2310.353 1853.0047,-2291.6597"/>
<polygon fill="#000000" stroke="#000000" points="1855.8071,-2289.5624 1847.0865,-2283.5455 1850.1515,-2293.6873 1855.8071,-2289.5624"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="1987" cy="-2265.6032" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1987" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_6&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1923.4124,-2351.6531C1935.8924,-2334.7645 1954.6018,-2309.446 1968.4988,-2290.64"/>
<polygon fill="#000000" stroke="#000000" points="1971.3773,-2292.6339 1974.5055,-2282.5114 1965.7476,-2288.4737 1971.3773,-2292.6339"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2390" cy="-2265.6032" rx="74.6878" ry="18"/>
<text text-anchor="middle" x="2390" y="-2261.4032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 119&#45;170</text>
</g>
<!-- section_6&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_6&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1965.531,-2357.7485C2054.6717,-2338.3975 2229.3066,-2300.4871 2324.4349,-2279.8364"/>
<polygon fill="#000000" stroke="#000000" points="2325.1986,-2283.2522 2334.2284,-2277.7103 2323.7135,-2276.4115 2325.1986,-2283.2522"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="408,-1494.5033 0,-1494.5033 0,-1422.701 408,-1422.701 408,-1494.5033"/>
<text text-anchor="middle" x="204" y="-1431.1022" font-family="Inconsolata" font-size="14.00" fill="#000000">We&#39;re going to do this will straight el peg, and fold in</text>
</g>
<!-- raw_8&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>raw_8&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M353.5899,-2247.6164C334.6037,-2147.4738 241.7444,-1657.6855 212.7,-1504.4904"/>
<polygon fill="#000000" stroke="#000000" points="216.1022,-1503.6454 210.8007,-1494.4724 209.2247,-1504.9494 216.1022,-1503.6454"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="480,-1476.6022 426,-1476.6022 426,-1440.6022 480,-1440.6022 480,-1476.6022"/>
<text text-anchor="middle" x="453" y="-1455.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_9&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prespace_9&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M448.1138,-2247.2316C448.7657,-2142.0236 452.0239,-1616.1519 452.8229,-1487.1894"/>
<polygon fill="#000000" stroke="#000000" points="456.3242,-1486.9666 452.8864,-1476.9451 449.3244,-1486.9232 456.3242,-1486.9666"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="577,-1476.6022 505,-1476.6022 505,-1440.6022 577,-1440.6022 577,-1476.6022"/>
<text text-anchor="middle" x="541" y="-1455.1022" font-family="Inconsolata" font-size="14.00" fill="#000000">espalier</text>
</g>
<!-- literal_10&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>literal_10&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M543.9317,-2247.2316C543.5406,-2142.0236 541.5857,-1616.1519 541.1063,-1487.1894"/>
<polygon fill="#000000" stroke="#000000" points="544.6054,-1486.932 541.0682,-1476.9451 537.6055,-1486.958 544.6054,-1486.932"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="653,-1476.6022 595,-1476.6022 595,-1440.6022 653,-1440.6022 653,-1476.6022"/>
<text text-anchor="middle" x="624" y="-1455.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> ASAP.</text>
</g>
<!-- raw_11&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_11&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M620.0911,-2247.2316C620.6125,-2142.0236 623.2191,-1616.1519 623.8583,-1487.1894"/>
<polygon fill="#000000" stroke="#000000" points="627.3594,-1486.9623 623.9091,-1476.9451 620.3595,-1486.9276 627.3594,-1486.9623"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1090,-1476.6022 976,-1476.6022 976,-1440.6022 1090,-1440.6022 1090,-1476.6022"/>
<text text-anchor="middle" x="1033" y="-1455.1022" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Lua lexers</text>
</g>
<!-- header_17&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>header_17&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1076.9756,-2247.2316C1071.109,-2142.0236 1041.7853,-1616.1519 1034.5941,-1487.1894"/>
<polygon fill="#000000" stroke="#000000" points="1038.0743,-1486.7347 1034.0228,-1476.9451 1031.0851,-1487.1245 1038.0743,-1486.7347"/>
</g>
<!-- raw_21 -->
<g id="node22" class="node">
<title>raw_21</title>
<ellipse fill="none" stroke="#000000" cx="1135" cy="-1458.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="1135" y="-1454.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_18&#45;&gt;raw_21 -->
<g id="edge21" class="edge">
<title>prose_18&#45;&gt;raw_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1185.839,-2247.6169C1181.1059,-2230.2995 1174.3405,-2203.2903 1171,-2179.4032 1133.6135,-1912.0605 1133.6573,-1584.1799 1134.6094,-1487.0089"/>
<polygon fill="#000000" stroke="#000000" points="1138.1112,-1486.8567 1134.7214,-1476.8188 1131.1116,-1486.7796 1138.1112,-1486.8567"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1728,-2179.2042 1180,-2179.2042 1180,-738.0001 1728,-738.0001 1728,-2179.2042"/>
<text text-anchor="middle" x="1454" y="-2164.2032" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = (P&quot; &quot;)^0</text>
<text text-anchor="middle" x="1454" y="-2132.8031" font-family="Inconsolata" font-size="14.00" fill="#000000">local NL = P&quot;\n&quot;</text>
<text text-anchor="middle" x="1454" y="-2101.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">local terminal = S&quot; \&quot;&#39;+&#45;*^~%#;,&lt;&gt;={}[]().:\n&quot; + &#45;P(1)</text>
<text text-anchor="middle" x="1454" y="-2070.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">local KW = (P&quot;function&quot; + &quot;local&quot; + &quot;for&quot; + &quot;in&quot; + &quot;do&quot;</text>
<text text-anchor="middle" x="1454" y="-2054.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;and&quot; + &quot;or&quot; + &quot;not&quot; + &quot;true&quot; + &quot;false&quot;</text>
<text text-anchor="middle" x="1454" y="-2039.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;while&quot; + &quot;break&quot; + &quot;if&quot; + &quot;then&quot; + &quot;else&quot; + &quot;elseif&quot;</text>
<text text-anchor="middle" x="1454" y="-2023.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;goto&quot; + &quot;repeat&quot; + &quot;until&quot; + &quot;return&quot; + &quot;nil&quot;</text>
<text text-anchor="middle" x="1454" y="-2008.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;end&quot;) * #terminal</text>
<text text-anchor="middle" x="1454" y="-1977.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">local OP = P&quot;+&quot; + &quot;&#45;&quot; + &quot;*&quot; + &quot;/&quot; + &quot;%&quot; + &quot;^&quot; + &quot;#&quot;</text>
<text text-anchor="middle" x="1454" y="-1961.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;==&quot; + &quot;~=&quot; + &quot;&lt;=&quot; + &quot;&gt;=&quot; + &quot;&lt;&quot; + &quot;&gt;&quot;</text>
<text text-anchor="middle" x="1454" y="-1946.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;=&quot; + &quot;(&quot; + &quot;)&quot; + &quot;{&quot; + &quot;}&quot; + &quot;[&quot; + &quot;]&quot;</text>
<text text-anchor="middle" x="1454" y="-1930.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;;&quot; + &quot;;&quot; + &quot;...&quot; + &quot;..&quot; + &quot;.&quot; + &quot;,&quot;</text>
<text text-anchor="middle" x="1454" y="-1899.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; long strings, straight from the LPEG docs</text>
<text text-anchor="middle" x="1454" y="-1868.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">local _equals = P&quot;=&quot;^0</text>
<text text-anchor="middle" x="1454" y="-1852.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local _open = &quot;[&quot; * L.Cg(_equals, &quot;init&quot;) * &quot;[&quot; * P&quot;\n&quot;^&#45;1</text>
<text text-anchor="middle" x="1454" y="-1837.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local _close = &quot;]&quot; * L.C(_equals) * &quot;]&quot;</text>
<text text-anchor="middle" x="1454" y="-1821.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local _closeeq = L.Cmt(_close * L.Cb(&quot;init&quot;),</text>
<text text-anchor="middle" x="1454" y="-1806.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;function (s, i, a, b) return a == b end)</text>
<text text-anchor="middle" x="1454" y="-1775.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local long_str = (_open * L.C((P(1) &#45; _closeeq)^0) * _close) / 0 * L.Cp()</text>
<text text-anchor="middle" x="1454" y="-1743.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; #todo valid escape sequences instead of P(1)s in below &#160;&#160;&#160;â†“</text>
<text text-anchor="middle" x="1454" y="-1712.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local double_str = P&quot;\&quot;&quot; * (P(1) &#45; (P&quot;\&quot;&quot; + P&quot;\\&quot;) + P&quot;\\&quot; * P(1))^0 * P&quot;\&quot;&quot;</text>
<text text-anchor="middle" x="1454" y="-1696.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local single_str = P&quot;\&#39;&quot; * (P(1) &#45; (P&quot;\&#39;&quot; + P&quot;\\&quot;) + P&quot;\\&quot; * P(1))^0 * P&quot;\&#39;&quot;</text>
<text text-anchor="middle" x="1454" y="-1665.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local string_P = double_str + single_str + long_str</text>
<text text-anchor="middle" x="1454" y="-1634.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local digit = R&quot;09&quot;</text>
<text text-anchor="middle" x="1454" y="-1602.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local letter = R&quot;az&quot; + R&quot;AZ&quot;</text>
<text text-anchor="middle" x="1454" y="-1571.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local symbol = &#160;&#160;(letter^1 + P&quot;_&quot;^1)</text>
<text text-anchor="middle" x="1454" y="-1555.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* (letter + digit + P&quot;_&quot;)^0</text>
<text text-anchor="middle" x="1454" y="-1540.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* #terminal</text>
<text text-anchor="middle" x="1454" y="-1509.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local _digital = P&quot;&#45;&quot;^0 * ((digit^1 * P&quot;.&quot;^&#45;1 * digit^0</text>
<text text-anchor="middle" x="1454" y="-1493.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* ((P&quot;e&quot; + P&quot;E&quot;)^&#45;1 * P&quot;&#45;&quot;^&#45;1 * digit^1)^&#45;1</text>
<text text-anchor="middle" x="1454" y="-1478.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ digit^1)^1 + digit^1)</text>
<text text-anchor="middle" x="1454" y="-1446.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">local _hexadecimal = P&quot;0&quot; * (P&quot;x&quot; + P&quot;X&quot;) * (digit + R&quot;af&quot; + R&quot;AF&quot;)^1</text>
<text text-anchor="middle" x="1454" y="-1415.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local number = _digital</text>
<text text-anchor="middle" x="1454" y="-1384.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local comment = P&quot;&#45;&#45;&quot; * long_str</text>
<text text-anchor="middle" x="1454" y="-1368.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ P&quot;&#45;&#45;&quot; * (P(1) &#45; NL)^0 * (NL + &#45; P(1))</text>
<text text-anchor="middle" x="1454" y="-1321.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local ERR = P(1)</text>
<text text-anchor="middle" x="1454" y="-1289.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local lua_toks = {comment, KW, string_P, number, OP, symbol,</text>
<text text-anchor="middle" x="1454" y="-1274.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS, NL, ERR}</text>
<text text-anchor="middle" x="1454" y="-1243.002" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_kv = { KW = KW,</text>
<text text-anchor="middle" x="1454" y="-1227.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;number = number,</text>
<text text-anchor="middle" x="1454" y="-1212.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OP = OP,</text>
<text text-anchor="middle" x="1454" y="-1196.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;symbol = symbol,</text>
<text text-anchor="middle" x="1454" y="-1181.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string = string_P,</text>
<text text-anchor="middle" x="1454" y="-1166.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment = comment,</text>
<text text-anchor="middle" x="1454" y="-1150.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS = WS,</text>
<text text-anchor="middle" x="1454" y="-1135.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NL = NL,</text>
<text text-anchor="middle" x="1454" y="-1119.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ERR = ERR}</text>
<text text-anchor="middle" x="1454" y="-1088.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">local color_map = {</text>
<text text-anchor="middle" x="1454" y="-1073.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;KW = c.color.keyword(),</text>
<text text-anchor="middle" x="1454" y="-1057.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;OP = c.color.operator(),</text>
<text text-anchor="middle" x="1454" y="-1042.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;number = c.color.number(),</text>
<text text-anchor="middle" x="1454" y="-1026.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;symbol = c.color.field(),</text>
<text text-anchor="middle" x="1454" y="-1011.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;string = c.color.string(),</text>
<text text-anchor="middle" x="1454" y="-996.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;comment = c.color.comment(),</text>
<text text-anchor="middle" x="1454" y="-980.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ERR = c.color.error(),</text>
<text text-anchor="middle" x="1454" y="-965.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1454" y="-917.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_map = {}</text>
<text text-anchor="middle" x="1454" y="-886.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">for k, v in pairs(lex_kv) do</text>
<text text-anchor="middle" x="1454" y="-871.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;lex_map[v] = k</text>
<text text-anchor="middle" x="1454" y="-855.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1454" y="-824.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">lex_kv = nil</text>
<text text-anchor="middle" x="1454" y="-792.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.lex_map = lex_map</text>
<text text-anchor="middle" x="1454" y="-761.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.long_str = long_str</text>
<text text-anchor="middle" x="1454" y="-746.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.string = string_P</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_19&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1411.0017,-2247.2316C1411.7216,-2234.0277 1412.8028,-2214.198 1414.1571,-2189.3585"/>
<polygon fill="#000000" stroke="#000000" points="1417.6609,-2189.3814 1414.7106,-2179.2056 1410.6713,-2189.0002 1417.6609,-2189.3814"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1162,-414.6006 1108,-414.6006 1108,-378.6006 1162,-378.6006 1162,-414.6006"/>
</g>
<!-- raw_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>raw_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1135,-1440.1691C1135,-1314.0177 1135,-578.4853 1135,-424.7593"/>
<polygon fill="#000000" stroke="#000000" points="1138.5001,-424.7128 1135,-414.7128 1131.5001,-424.7129 1138.5001,-424.7128"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="1930,-1476.6022 1746,-1476.6022 1746,-1440.6022 1930,-1440.6022 1930,-1476.6022"/>
<text text-anchor="middle" x="1838" y="-1455.1022" font-family="Inconsolata" font-size="14.00" fill="#000000">** Lex.lua_thor(linebuf)</text>
</g>
<!-- header_24&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>header_24&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1834.0911,-2247.2316C1834.6125,-2142.0236 1837.2191,-1616.1519 1837.8583,-1487.1894"/>
<polygon fill="#000000" stroke="#000000" points="1841.3594,-1486.9623 1837.9091,-1476.9451 1834.3595,-1486.9276 1841.3594,-1486.9623"/>
</g>
<!-- raw_28 -->
<g id="node29" class="node">
<title>raw_28</title>
<ellipse fill="none" stroke="#000000" cx="1983" cy="-1458.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="1983" y="-1454.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_28 -->
<g id="edge28" class="edge">
<title>prose_25&#45;&gt;raw_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1986.9089,-2247.2316C1986.3875,-2142.0236 1983.7809,-1616.1519 1983.1417,-1487.1894"/>
<polygon fill="#000000" stroke="#000000" points="1986.6405,-1486.9276 1983.0909,-1476.9451 1979.6406,-1486.9623 1986.6405,-1486.9276"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="2207" cy="-1458.6022" rx="88.0294" ry="18"/>
<text text-anchor="middle" x="2207" y="-1454.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : chomp_token(lb)</text>
</g>
<!-- section_26&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_26&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2379.8334,-2247.6561C2370.5636,-2230.589 2357.1136,-2203.9491 2349,-2179.4032 2262.5745,-1917.9407 2220.9247,-1584.8016 2209.9985,-1486.865"/>
<polygon fill="#000000" stroke="#000000" points="2213.4703,-1486.4162 2208.8985,-1476.8586 2206.5123,-1487.1812 2213.4703,-1486.4162"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="2390" cy="-1458.6022" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2390" y="-1454.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_26&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2390,-2247.2316C2390,-2142.0236 2390,-1616.1519 2390,-1487.1894"/>
<polygon fill="#000000" stroke="#000000" points="2393.5001,-1486.945 2390,-1476.9451 2386.5001,-1486.9451 2393.5001,-1486.945"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="2630" cy="-1458.6022" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2630" y="-1454.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 124&#45;164</text>
</g>
<!-- section_26&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>section_26&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2399.7488,-2247.5092C2408.7233,-2230.3384 2421.9736,-2203.6283 2431,-2179.4032 2528.8652,-1916.7525 2603.2025,-1584.4294 2624.0868,-1486.7775"/>
<polygon fill="#000000" stroke="#000000" points="2627.5518,-1487.3101 2626.2086,-1476.8008 2620.7049,-1485.8539 2627.5518,-1487.3101"/>
</g>
<!-- codeblock_33 -->
<g id="node34" class="node">
<title>codeblock_33</title>
<ellipse fill="none" stroke="#000000" cx="2957" cy="-1458.6022" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2957" y="-1454.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 167&#45;169</text>
</g>
<!-- section_26&#45;&gt;codeblock_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;codeblock_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2454.7988,-2256.5438C2541.03,-2243.2508 2687.1634,-2216.0133 2726,-2179.4032 2935.6196,-1981.8008 2955.6246,-1594.0576 2957.0461,-1486.7242"/>
<polygon fill="#000000" stroke="#000000" points="2960.5463,-1486.7071 2957.1337,-1476.6769 2953.5465,-1486.6459 2960.5463,-1486.7071"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2013.5,-432.5018 1906.5,-432.5018 1906.5,-360.6994 2013.5,-360.6994 2013.5,-432.5018"/>
<text text-anchor="middle" x="1960" y="-385.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">...it&#39;s late.</text>
</g>
<!-- raw_28&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>raw_28&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1982.6008,-1440.1691C1979.9632,-1318.381 1965.0253,-628.637 1960.9994,-442.7491"/>
<polygon fill="#000000" stroke="#000000" points="1964.4933,-442.4227 1960.7775,-432.5009 1957.4949,-442.5743 1964.4933,-442.4227"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2180.5,-414.6006 2031.5,-414.6006 2031.5,-378.6006 2180.5,-378.6006 2180.5,-414.6006"/>
<text text-anchor="middle" x="2106" y="-393.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">*** chomp_token(lb)</text>
</g>
<!-- header_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>header_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2205.247,-1440.1691C2193.2495,-1314.0177 2123.2979,-578.4853 2108.678,-424.7593"/>
<polygon fill="#000000" stroke="#000000" points="2112.1537,-424.3365 2107.7225,-414.7128 2105.1851,-424.9993 2112.1537,-424.3365"/>
</g>
<!-- raw_35 -->
<g id="node36" class="node">
<title>raw_35</title>
<ellipse fill="none" stroke="#000000" cx="2226" cy="-396.6006" rx="27" ry="18"/>
<text text-anchor="middle" x="2226" y="-392.4006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_35 -->
<g id="edge35" class="edge">
<title>prose_31&#45;&gt;raw_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2392.3979,-1440.4568C2402.7809,-1355.1818 2437.5657,-987.9339 2304,-737.8012 2292.4195,-716.1139 2273.566,-723.4961 2262,-701.8012 2213.1732,-610.2142 2217.7647,-481.5871 2222.7847,-425.0975"/>
<polygon fill="#000000" stroke="#000000" points="2226.3022,-425.0837 2223.7787,-414.7938 2219.3346,-424.4115 2226.3022,-425.0837"/>
</g>
<!-- prespace_36 -->
<g id="node37" class="node">
<title>prespace_36</title>
<ellipse fill="none" stroke="#000000" cx="2317" cy="-396.6006" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2317" y="-392.4006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_31&#45;&gt;prespace_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;prespace_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2388.7636,-1440.6147C2380.1824,-1315.7761 2329.5276,-578.8512 2318.9395,-424.8169"/>
<polygon fill="#000000" stroke="#000000" points="2322.4252,-424.4866 2318.2476,-414.7502 2315.4417,-424.9667 2322.4252,-424.4866"/>
</g>
<!-- literal_37 -->
<g id="node38" class="node">
<title>literal_37</title>
<ellipse fill="none" stroke="#000000" cx="2413" cy="-396.6006" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2413" y="-392.4006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_31&#45;&gt;literal_37 -->
<g id="edge37" class="edge">
<title>prose_31&#45;&gt;literal_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2390.3992,-1440.1691C2393.1313,-1314.0177 2409.0609,-578.4853 2412.3902,-424.7593"/>
<polygon fill="#000000" stroke="#000000" points="2415.8903,-424.7863 2412.6077,-414.7128 2408.8919,-424.6347 2415.8903,-424.7863"/>
</g>
<!-- raw_38 -->
<g id="node39" class="node">
<title>raw_38</title>
<ellipse fill="none" stroke="#000000" cx="2489" cy="-396.6006" rx="27" ry="18"/>
<text text-anchor="middle" x="2489" y="-392.4006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_38 -->
<g id="edge38" class="edge">
<title>prose_31&#45;&gt;raw_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2391.6768,-1440.6147C2403.3143,-1315.7761 2472.0106,-578.8512 2486.3697,-424.8169"/>
<polygon fill="#000000" stroke="#000000" points="2489.8647,-425.0319 2487.3081,-414.7502 2482.8949,-424.3821 2489.8647,-425.0319"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="2928,-702.0018 2534,-702.0018 2534,-91.1993 2928,-91.1993 2928,-702.0018"/>
<text text-anchor="middle" x="2731" y="-686.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function chomp_token(lb)</text>
<text text-anchor="middle" x="2731" y="-671.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(lua_toks) do</text>
<text text-anchor="middle" x="2731" y="-655.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite = match(v, lb)</text>
<text text-anchor="middle" x="2731" y="-640.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite ~= nil then</text>
<text text-anchor="middle" x="2731" y="-625.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return sub(lb, 1, bite &#45; 1), sub(lb, bite), v</text>
<text text-anchor="middle" x="2731" y="-609.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2731" y="-594.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2731" y="-578.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="2731" y="-563.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2731" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.chomp = chomp_token</text>
<text text-anchor="middle" x="2731" y="-500.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">function Lex.lua_thor(linebuf)</text>
<text text-anchor="middle" x="2731" y="-485.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local toks = {}</text>
<text text-anchor="middle" x="2731" y="-469.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="2731" y="-454.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while lb ~= &quot;&quot; do</text>
<text text-anchor="middle" x="2731" y="-439.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local len = #lb</text>
<text text-anchor="middle" x="2731" y="-423.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite, tok_t</text>
<text text-anchor="middle" x="2731" y="-408.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;bite, lb, tok_t = chomp_token(lb)</text>
<text text-anchor="middle" x="2731" y="-392.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite == nil then</text>
<text text-anchor="middle" x="2731" y="-377.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="2731" y="-362.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2731" y="-346.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; #todo add a color</text>
<text text-anchor="middle" x="2731" y="-331.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local col = color_map[lex_map[tok_t]]</text>
<text text-anchor="middle" x="2731" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if col then</text>
<text text-anchor="middle" x="2731" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = col</text>
<text text-anchor="middle" x="2731" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2731" y="-269.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = bite</text>
<text text-anchor="middle" x="2731" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2731" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if len == #lb then</text>
<text text-anchor="middle" x="2731" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = a.clear .. color_map.ERR</text>
<text text-anchor="middle" x="2731" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = sub(lb, 1, 1)</text>
<text text-anchor="middle" x="2731" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lb = sub(lb,2)</text>
<text text-anchor="middle" x="2731" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2731" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2731" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;toks[#toks + 1] = a.clear()</text>
<text text-anchor="middle" x="2731" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return toks</text>
<text text-anchor="middle" x="2731" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>codeblock_32&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2631.753,-1440.1691C2639.9102,-1354.3982 2674.8578,-986.9283 2700.9902,-712.1497"/>
<polygon fill="#000000" stroke="#000000" points="2704.4923,-712.2923 2701.9549,-702.0058 2697.5238,-711.6295 2704.4923,-712.2923"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3032,-414.6006 2946,-414.6006 2946,-378.6006 3032,-378.6006 3032,-414.6006"/>
<text text-anchor="middle" x="2989" y="-393.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">return Lex</text>
</g>
<!-- codeblock_33&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_33&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2957.5554,-1440.1691C2961.3566,-1314.0177 2983.5195,-578.4853 2988.1515,-424.7593"/>
<polygon fill="#000000" stroke="#000000" points="2991.6514,-424.8137 2988.4542,-414.7128 2984.6546,-424.6028 2991.6514,-424.8137"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2277.5,-55.6015 2002.5,-55.6015 2002.5,.2015 2277.5,.2015 2277.5,-55.6015"/>
<text text-anchor="middle" x="2140" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an almost pessimal way to use</text>
</g>
<!-- raw_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>raw_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2227.0484,-378.5765C2229.1999,-330.0957 2230.8178,-193.6649 2189,-91.4 2184.9981,-81.6133 2179.0716,-72.0388 2172.7108,-63.4085"/>
<polygon fill="#000000" stroke="#000000" points="2175.4259,-61.1983 2166.5278,-55.4473 2169.8974,-65.492 2175.4259,-61.1983"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="2350,-45.7 2296,-45.7 2296,-9.7 2350,-9.7 2350,-45.7"/>
<text text-anchor="middle" x="2323" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_36&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>prespace_36&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2317.2935,-378.558C2318.2625,-318.9803 2321.3651,-128.2212 2322.5417,-55.8789"/>
<polygon fill="#000000" stroke="#000000" points="2326.0439,-55.7635 2322.7071,-45.7079 2319.0449,-55.6496 2326.0439,-55.7635"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="2434,-45.7 2380,-45.7 2380,-9.7 2434,-9.7 2434,-45.7"/>
<text text-anchor="middle" x="2407" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_37&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>literal_37&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2412.7065,-378.558C2411.7375,-318.9803 2408.6349,-128.2212 2407.4583,-55.8789"/>
<polygon fill="#000000" stroke="#000000" points="2410.9551,-55.6496 2407.2929,-45.7079 2403.9561,-55.7635 2410.9551,-55.6496"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="2699.5,-47.0006 2452.5,-47.0006 2452.5,-8.3994 2699.5,-8.3994 2699.5,-47.0006"/>
<text text-anchor="middle" x="2576" y="-31.9" font-family="Inconsolata" font-size="14.00" fill="#000000">, which is quite capable of</text>
<text text-anchor="middle" x="2576" y="-16.5" font-family="Inconsolata" font-size="14.00" fill="#000000">handling a full line in one pass.</text>
</g>
<!-- raw_38&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>raw_38&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2487.7666,-378.5346C2485.1437,-329.9497 2482.3718,-193.2835 2525,-91.4 2530.5774,-78.0697 2539.8067,-65.2494 2548.8924,-54.649"/>
<polygon fill="#000000" stroke="#000000" points="2551.678,-56.7851 2555.7494,-47.0038 2546.4669,-52.1113 2551.678,-56.7851"/>
</g>
</g>
</svg>
