<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: lpegNode Pages: 1 -->
<svg width="3203pt" height="2834pt"
 viewBox="0.00 0.00 3203.00 2834.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2830.2038)">
<title>lpegNode</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2830.2038 3199,-2830.2038 3199,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2808.2038" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="873" y="-2804.0038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 189</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2736.2038" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="873" y="-2732.0038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;119</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2790.0352C873,-2782.3348 873,-2773.1782 873,-2764.6205"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2764.6171 873,-2754.6171 869.5001,-2764.6171 876.5001,-2764.6171"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="371" cy="-2664.2038" rx="36.8096" ry="18"/>
<text text-anchor="middle" x="371" y="-2660.0038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Lex</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M814.9238,-2727.8742C713.9036,-2713.3852 507.8958,-2683.8383 416.4624,-2670.7243"/>
<polygon fill="#000000" stroke="#000000" points="416.8097,-2667.2384 406.4141,-2669.2831 415.8158,-2674.1675 416.8097,-2667.2384"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2664.2038" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="544" y="-2660.0038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M821.9547,-2725.0328C756.4375,-2710.6947 644.1052,-2686.1114 584.273,-2673.0174"/>
<polygon fill="#000000" stroke="#000000" points="584.9524,-2669.5833 574.4353,-2670.8644 583.4558,-2676.4215 584.9524,-2669.5833"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="873" cy="-2664.2038" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="873" y="-2660.0038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 6&#45;15</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2718.0352C873,-2710.3348 873,-2701.1782 873,-2692.6205"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2692.6171 873,-2682.6171 869.5001,-2692.6171 876.5001,-2692.6171"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="1218" cy="-2664.2038" rx="69.851" ry="18"/>
<text text-anchor="middle" x="1218" y="-2660.0038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 18&#45;119</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M925.0235,-2725.3468C986.1686,-2712.586 1087.6512,-2691.4071 1153.6785,-2677.6275"/>
<polygon fill="#000000" stroke="#000000" points="1154.4824,-2681.0352 1163.5564,-2675.566 1153.0523,-2674.1828 1154.4824,-2681.0352"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1989" cy="-2664.2038" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="1989" y="-2660.0038" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 120&#45;124</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M936.6034,-2732.1004C1126.888,-2719.824 1691.7592,-2683.3807 1905.655,-2669.5809"/>
<polygon fill="#000000" stroke="#000000" points="1906.1245,-2673.058 1915.8784,-2668.9214 1905.6738,-2666.0725 1906.1245,-2673.058"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="312,-2562.6037 258,-2562.6037 258,-2526.6037 312,-2526.6037 312,-2562.6037"/>
<text text-anchor="middle" x="285" y="-2541.1037" font-family="Inconsolata" font-size="14.00" fill="#000000">* Lex</text>
</g>
<!-- header_2&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>header_2&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M354.1115,-2648.0997C343.8453,-2637.8158 330.86,-2623.8865 321,-2610.2038 312.43,-2598.3113 304.4209,-2584.158 298.1431,-2572.0473"/>
<polygon fill="#000000" stroke="#000000" points="301.1334,-2570.2042 293.502,-2562.8548 294.8846,-2573.3591 301.1334,-2570.2042"/>
</g>
<!-- raw_8 -->
<g id="node9" class="node">
<title>raw_8</title>
<ellipse fill="none" stroke="#000000" cx="357" cy="-2544.6037" rx="27" ry="18"/>
<text text-anchor="middle" x="357" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;raw_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M512.6692,-2659.718C479.6219,-2653.5772 427.6344,-2639.743 393,-2610.2038 381.1063,-2600.0599 372.44,-2584.9589 366.5947,-2571.8018"/>
<polygon fill="#000000" stroke="#000000" points="369.7027,-2570.1562 362.668,-2562.2338 363.2269,-2572.8139 369.7027,-2570.1562"/>
</g>
<!-- prespace_9 -->
<g id="node10" class="node">
<title>prespace_9</title>
<ellipse fill="none" stroke="#000000" cx="448" cy="-2544.6037" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="448" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_3&#45;&gt;prespace_9 -->
<g id="edge9" class="edge">
<title>prose_3&#45;&gt;prespace_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M530.6516,-2647.574C514.5001,-2627.4519 487.1404,-2593.3662 468.3536,-2569.961"/>
<polygon fill="#000000" stroke="#000000" points="470.8459,-2567.4745 461.8567,-2561.8669 465.3869,-2571.8563 470.8459,-2567.4745"/>
</g>
<!-- literal_10 -->
<g id="node11" class="node">
<title>literal_10</title>
<ellipse fill="none" stroke="#000000" cx="544" cy="-2544.6037" rx="31.481" ry="18"/>
<text text-anchor="middle" x="544" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_3&#45;&gt;literal_10 -->
<g id="edge10" class="edge">
<title>prose_3&#45;&gt;literal_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M544,-2646.0392C544,-2626.6331 544,-2595.6138 544,-2572.9817"/>
<polygon fill="#000000" stroke="#000000" points="547.5001,-2572.9393 544,-2562.9393 540.5001,-2572.9394 547.5001,-2572.9393"/>
</g>
<!-- raw_11 -->
<g id="node12" class="node">
<title>raw_11</title>
<ellipse fill="none" stroke="#000000" cx="620" cy="-2544.6037" rx="27" ry="18"/>
<text text-anchor="middle" x="620" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_11 -->
<g id="edge11" class="edge">
<title>prose_3&#45;&gt;raw_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M557.2159,-2647.5965C565.3179,-2637.1233 575.6931,-2623.1716 584,-2610.2038 592.0728,-2597.6016 600.1703,-2583.0569 606.6354,-2570.8702"/>
<polygon fill="#000000" stroke="#000000" points="609.9065,-2572.1677 611.4387,-2561.6843 603.7033,-2568.9241 609.9065,-2572.1677"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="1080.5,-2610.3041 665.5,-2610.3041 665.5,-2478.9033 1080.5,-2478.9033 1080.5,-2610.3041"/>
<text text-anchor="middle" x="873" y="-2595.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="873" y="-2579.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">local P, R, S, match = L.P, L.R, L.S, L.match</text>
<text text-anchor="middle" x="873" y="-2564.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">local Lex = meta {}</text>
<text text-anchor="middle" x="873" y="-2548.8037" font-family="Inconsolata" font-size="14.00" fill="#000000">local Rainbuf = require &quot;rainbuf&quot;</text>
<text text-anchor="middle" x="873" y="-2533.4037" font-family="Inconsolata" font-size="14.00" fill="#000000">local sub, gsub = assert(string.sub), assert(string.gsub)</text>
<text text-anchor="middle" x="873" y="-2518.0037" font-family="Inconsolata" font-size="14.00" fill="#000000">local concat = assert(table.concat)</text>
<text text-anchor="middle" x="873" y="-2502.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">local c = require &quot;color&quot;</text>
<text text-anchor="middle" x="873" y="-2487.2036" font-family="Inconsolata" font-size="14.00" fill="#000000">local codepoints = assert(string.codepoints)</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_4&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M873,-2646.0392C873,-2638.7642 873,-2629.8571 873,-2620.3717"/>
<polygon fill="#000000" stroke="#000000" points="876.5001,-2620.3217 873,-2610.3217 869.5001,-2620.3217 876.5001,-2620.3217"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="1162" cy="-2544.6037" rx="63.3963" ry="18"/>
<text text-anchor="middle" x="1162" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Lua lexers</text>
</g>
<!-- section_5&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1209.6162,-2646.2985C1200.3787,-2626.5698 1185.4168,-2594.6155 1174.7302,-2571.7918"/>
<polygon fill="#000000" stroke="#000000" points="1177.8513,-2570.2037 1170.4411,-2562.6315 1171.5118,-2573.1721 1177.8513,-2570.2037"/>
</g>
<!-- prose_18 -->
<g id="node19" class="node">
<title>prose_18</title>
<ellipse fill="none" stroke="#000000" cx="1275" cy="-2544.6037" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1275" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;prose_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1226.5335,-2646.2985C1235.9903,-2626.4558 1251.3413,-2594.2456 1262.2307,-2571.3969"/>
<polygon fill="#000000" stroke="#000000" points="1265.4515,-2572.7741 1266.5942,-2562.2411 1259.1324,-2569.7625 1265.4515,-2572.7741"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="1493" cy="-2544.6037" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1493" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 20&#45;117</text>
</g>
<!-- section_5&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_5&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1253.6695,-2648.6908C1302.8874,-2627.2855 1391.7074,-2588.6568 1446.2053,-2564.9552"/>
<polygon fill="#000000" stroke="#000000" points="1447.8601,-2568.0522 1455.6345,-2560.8543 1445.0683,-2561.633 1447.8601,-2568.0522"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="1913" cy="-2544.6037" rx="103.0387" ry="18"/>
<text text-anchor="middle" x="1913" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Lex.lua_thor(linebuf)</text>
</g>
<!-- section_6&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_6&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1977.622,-2646.2985C1964.9735,-2626.3937 1944.4168,-2594.0439 1929.8896,-2571.1826"/>
<polygon fill="#000000" stroke="#000000" points="1932.7731,-2569.1944 1924.4557,-2562.6315 1926.865,-2572.9487 1932.7731,-2569.1944"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2066" cy="-2544.6037" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2066" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_6&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2001.133,-2646.2911C2008.1773,-2635.8202 2017.1773,-2622.3202 2025,-2610.2038 2033.4173,-2597.1666 2042.5888,-2582.5341 2050.1188,-2570.4023"/>
<polygon fill="#000000" stroke="#000000" points="2053.2304,-2572.0254 2055.5175,-2561.6804 2047.2783,-2568.3412 2053.2304,-2572.0254"/>
</g>
<!-- section_26 -->
<g id="node27" class="node">
<title>section_26</title>
<ellipse fill="none" stroke="#000000" cx="2469" cy="-2544.6037" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="2469" y="-2540.4037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 125&#45;189</text>
</g>
<!-- section_6&#45;&gt;section_26 -->
<g id="edge26" class="edge">
<title>section_6&#45;&gt;section_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2041.2822,-2651.1769C2130.4585,-2628.9571 2311.5626,-2583.8319 2406.9817,-2560.0566"/>
<polygon fill="#000000" stroke="#000000" points="2407.9252,-2563.4286 2416.7823,-2557.6146 2406.2327,-2556.6363 2407.9252,-2563.4286"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="408,-1727.0037 0,-1727.0037 0,-1655.2014 408,-1655.2014 408,-1727.0037"/>
<text text-anchor="middle" x="204" y="-1663.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">We&#39;re going to do this will straight el peg, and fold in</text>
</g>
<!-- raw_8&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>raw_8&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M353.7336,-2526.3823C334.9817,-2421.7758 240.8582,-1896.7139 212.2563,-1737.1599"/>
<polygon fill="#000000" stroke="#000000" points="215.6783,-1736.4127 210.4686,-1727.1872 208.7881,-1737.6479 215.6783,-1736.4127"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="480,-1709.1025 426,-1709.1025 426,-1673.1025 480,-1673.1025 480,-1709.1025"/>
<text text-anchor="middle" x="453" y="-1687.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_9&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prespace_9&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M448.1067,-2526.3823C448.7448,-2417.4675 452.053,-1852.7509 452.8345,-1719.3608"/>
<polygon fill="#000000" stroke="#000000" points="456.3355,-1719.1738 452.8943,-1709.1534 449.3356,-1719.1327 456.3355,-1719.1738"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="577,-1709.1025 505,-1709.1025 505,-1673.1025 577,-1673.1025 577,-1709.1025"/>
<text text-anchor="middle" x="541" y="-1687.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">espalier</text>
</g>
<!-- literal_10&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>literal_10&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M543.936,-2526.3823C543.5531,-2417.4675 541.5682,-1852.7509 541.0993,-1719.3608"/>
<polygon fill="#000000" stroke="#000000" points="544.5987,-1719.141 541.0634,-1709.1534 537.5987,-1719.1657 544.5987,-1719.141"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="653,-1709.1025 595,-1709.1025 595,-1673.1025 653,-1673.1025 653,-1709.1025"/>
<text text-anchor="middle" x="624" y="-1687.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> ASAP.</text>
</g>
<!-- raw_11&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>raw_11&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M620.0854,-2526.3823C620.5958,-2417.4675 623.2424,-1852.7509 623.8676,-1719.3608"/>
<polygon fill="#000000" stroke="#000000" points="627.3684,-1719.1698 623.9154,-1709.1534 620.3685,-1719.1369 627.3684,-1719.1698"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1175,-1709.1025 1061,-1709.1025 1061,-1673.1025 1175,-1673.1025 1175,-1709.1025"/>
<text text-anchor="middle" x="1118" y="-1687.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Lua lexers</text>
</g>
<!-- header_17&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>header_17&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1161.0606,-2526.3823C1155.4458,-2417.4675 1126.3334,-1852.7509 1119.4568,-1719.3608"/>
<polygon fill="#000000" stroke="#000000" points="1122.9409,-1718.96 1118.9306,-1709.1534 1115.9501,-1719.3204 1122.9409,-1718.96"/>
</g>
<!-- raw_21 -->
<g id="node22" class="node">
<title>raw_21</title>
<ellipse fill="none" stroke="#000000" cx="1220" cy="-1691.1025" rx="27" ry="18"/>
<text text-anchor="middle" x="1220" y="-1686.9025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_18&#45;&gt;raw_21 -->
<g id="edge21" class="edge">
<title>prose_18&#45;&gt;raw_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1270.8885,-2526.7314C1266.4205,-2506.5267 1259.4583,-2472.5904 1256,-2443.0036 1223.1692,-2162.1226 1220.1188,-1818.8655 1219.9609,-1719.3636"/>
<polygon fill="#000000" stroke="#000000" points="1223.4609,-1719.2147 1219.9539,-1709.2172 1216.4609,-1719.2196 1223.4609,-1719.2147"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1806.5,-2442.9046 1265.5,-2442.9046 1265.5,-939.3004 1806.5,-939.3004 1806.5,-2442.9046"/>
<text text-anchor="middle" x="1536" y="-2427.8036" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = (P&quot; &quot;)^0</text>
<text text-anchor="middle" x="1536" y="-2396.4036" font-family="Inconsolata" font-size="14.00" fill="#000000">local NL = P&quot;\n&quot;</text>
<text text-anchor="middle" x="1536" y="-2365.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">local terminal = S&quot; \&quot;&#39;+&#45;*^~%#;,&lt;&gt;={}[]().:\n&quot; + &#45;P(1)</text>
<text text-anchor="middle" x="1536" y="-2333.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">local KW = (P&quot;function&quot; + &quot;local&quot; + &quot;for&quot; + &quot;in&quot; + &quot;do&quot;</text>
<text text-anchor="middle" x="1536" y="-2318.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;and&quot; + &quot;or&quot; + &quot;not&quot; + &quot;true&quot; + &quot;false&quot;</text>
<text text-anchor="middle" x="1536" y="-2302.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;while&quot; + &quot;break&quot; + &quot;if&quot; + &quot;then&quot; + &quot;else&quot; + &quot;elseif&quot;</text>
<text text-anchor="middle" x="1536" y="-2287.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;goto&quot; + &quot;repeat&quot; + &quot;until&quot; + &quot;return&quot; + &quot;nil&quot;</text>
<text text-anchor="middle" x="1536" y="-2272.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;end&quot;) * #terminal</text>
<text text-anchor="middle" x="1536" y="-2240.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">local OP = P&quot;+&quot; + &quot;&#45;&quot; + &quot;*&quot; + &quot;/&quot; + &quot;%&quot; + &quot;^&quot; + &quot;#&quot;</text>
<text text-anchor="middle" x="1536" y="-2225.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;==&quot; + &quot;~=&quot; + &quot;&lt;=&quot; + &quot;&gt;=&quot; + &quot;&lt;&quot; + &quot;&gt;&quot;</text>
<text text-anchor="middle" x="1536" y="-2209.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;=&quot; + &quot;(&quot; + &quot;)&quot; + &quot;{&quot; + &quot;}&quot; + &quot;[&quot; + &quot;]&quot;</text>
<text text-anchor="middle" x="1536" y="-2194.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ &quot;;&quot; + &quot;;&quot; + &quot;...&quot; + &quot;..&quot; + &quot;.&quot; + &quot;,&quot;</text>
<text text-anchor="middle" x="1536" y="-2163.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; long strings, straight from the LPEG docs</text>
<text text-anchor="middle" x="1536" y="-2131.6032" font-family="Inconsolata" font-size="14.00" fill="#000000">local _equals = P&quot;=&quot;^0</text>
<text text-anchor="middle" x="1536" y="-2116.2032" font-family="Inconsolata" font-size="14.00" fill="#000000">local _open = &quot;[&quot; * L.Cg(_equals, &quot;init&quot;) * &quot;[&quot; * P&quot;\n&quot;^&#45;1</text>
<text text-anchor="middle" x="1536" y="-2100.8031" font-family="Inconsolata" font-size="14.00" fill="#000000">local _close = &quot;]&quot; * L.C(_equals) * &quot;]&quot;</text>
<text text-anchor="middle" x="1536" y="-2085.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">local _closeeq = L.Cmt(_close * L.Cb(&quot;init&quot;),</text>
<text text-anchor="middle" x="1536" y="-2070.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;function (s, i, a, b) return a == b end)</text>
<text text-anchor="middle" x="1536" y="-2038.603" font-family="Inconsolata" font-size="14.00" fill="#000000">local long_str = (_open * L.C((P(1) &#45; _closeeq)^0) * _close) / 0 * L.Cp()</text>
<text text-anchor="middle" x="1536" y="-2007.203" font-family="Inconsolata" font-size="14.00" fill="#000000">local str_esc = P&quot;\\&quot; * (S&quot;abfnrtv\\\&quot;&#39;[]\n&quot; + (R&quot;09&quot; * R&quot;09&quot;^&#45;2))</text>
<text text-anchor="middle" x="1536" y="-1975.803" font-family="Inconsolata" font-size="14.00" fill="#000000">local double_str = P&quot;\&quot;&quot; * (P(1) &#45; (P&quot;\&quot;&quot; + P&quot;\\&quot;) + str_esc)^0 * P&quot;\&quot;&quot;</text>
<text text-anchor="middle" x="1536" y="-1960.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">local single_str = P&quot;\&#39;&quot; * (P(1) &#45; (P&quot;\&#39;&quot; + P&quot;\\&quot;) + str_esc)^0 * P&quot;\&#39;&quot;</text>
<text text-anchor="middle" x="1536" y="-1929.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">local string_esc = double_str + single_str</text>
<text text-anchor="middle" x="1536" y="-1897.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">local string_long = long_str</text>
<text text-anchor="middle" x="1536" y="-1866.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">local digit = R&quot;09&quot;</text>
<text text-anchor="middle" x="1536" y="-1834.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local letter = R&quot;az&quot; + R&quot;AZ&quot;</text>
<text text-anchor="middle" x="1536" y="-1803.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">local symbol = &#160;&#160;(letter^1 + P&quot;_&quot;^1)</text>
<text text-anchor="middle" x="1536" y="-1788.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* (letter + digit + P&quot;_&quot;)^0</text>
<text text-anchor="middle" x="1536" y="-1772.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* #terminal</text>
<text text-anchor="middle" x="1536" y="-1741.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local _decimal = P&quot;&#45;&quot;^0 * ((digit^1 * P&quot;.&quot;^&#45;1 * digit^0</text>
<text text-anchor="middle" x="1536" y="-1725.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* ((P&quot;e&quot; + P&quot;E&quot;)^&#45;1 * P&quot;&#45;&quot;^&#45;1 * digit^1)^&#45;1</text>
<text text-anchor="middle" x="1536" y="-1710.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ digit^1)^1 + digit^1)</text>
<text text-anchor="middle" x="1536" y="-1679.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local _hexadecimal = P&quot;0&quot; * (P&quot;x&quot; + P&quot;X&quot;) * (digit + R&quot;af&quot; + R&quot;AF&quot;)^1</text>
<text text-anchor="middle" x="1536" y="-1647.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local number = _hexadecimal + _decimal</text>
<text text-anchor="middle" x="1536" y="-1616.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local comment = P&quot;&#45;&#45;&quot; * long_str</text>
<text text-anchor="middle" x="1536" y="-1600.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ P&quot;&#45;&#45;&quot; * (P(1) &#45; NL)^0 * (NL + &#45; P(1))</text>
<text text-anchor="middle" x="1536" y="-1553.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local ERR = P(1)</text>
<text text-anchor="middle" x="1536" y="-1522.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local lua_toks = {comment, KW, string_long, string_esc, number, OP, symbol,</text>
<text text-anchor="middle" x="1536" y="-1506.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS, NL, ERR}</text>
<text text-anchor="middle" x="1536" y="-1475.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_kv = { KW = KW,</text>
<text text-anchor="middle" x="1536" y="-1459.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;number = number,</text>
<text text-anchor="middle" x="1536" y="-1444.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;OP = OP,</text>
<text text-anchor="middle" x="1536" y="-1429.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;symbol = symbol,</text>
<text text-anchor="middle" x="1536" y="-1413.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string_long = string_long,</text>
<text text-anchor="middle" x="1536" y="-1398.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;string_esc = string_esc,</text>
<text text-anchor="middle" x="1536" y="-1382.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment = comment,</text>
<text text-anchor="middle" x="1536" y="-1367.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;WS = WS,</text>
<text text-anchor="middle" x="1536" y="-1352.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NL = NL,</text>
<text text-anchor="middle" x="1536" y="-1336.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ERR = ERR}</text>
<text text-anchor="middle" x="1536" y="-1305.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local color_map = {</text>
<text text-anchor="middle" x="1536" y="-1289.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;KW = c.color.keyword(),</text>
<text text-anchor="middle" x="1536" y="-1274.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;OP = c.color.operator(),</text>
<text text-anchor="middle" x="1536" y="-1259.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;number = c.color.number(),</text>
<text text-anchor="middle" x="1536" y="-1243.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;symbol = c.color.field(),</text>
<text text-anchor="middle" x="1536" y="-1228.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;string_esc = c.color.string(),</text>
<text text-anchor="middle" x="1536" y="-1212.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;string_long = c.color.string(),</text>
<text text-anchor="middle" x="1536" y="-1197.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;comment = c.color.comment(),</text>
<text text-anchor="middle" x="1536" y="-1182.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ERR = c.color.error(),</text>
<text text-anchor="middle" x="1536" y="-1166.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1536" y="-1119.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">local lex_map = {}</text>
<text text-anchor="middle" x="1536" y="-1087.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">for k, v in pairs(lex_kv) do</text>
<text text-anchor="middle" x="1536" y="-1072.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;lex_map[v] = k</text>
<text text-anchor="middle" x="1536" y="-1057.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1536" y="-1025.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">lex_kv = nil</text>
<text text-anchor="middle" x="1536" y="-994.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.lex_map = lex_map</text>
<text text-anchor="middle" x="1536" y="-962.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.long_str = long_str</text>
<text text-anchor="middle" x="1536" y="-947.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.string = string_long</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_19&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1493.918,-2526.3823C1494.7122,-2510.6186 1495.9874,-2485.3067 1497.6082,-2453.1364"/>
<polygon fill="#000000" stroke="#000000" points="1501.1144,-2453.0988 1498.1221,-2442.9353 1494.1233,-2452.7465 1501.1144,-2453.0988"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1247,-515.3008 1193,-515.3008 1193,-479.3008 1247,-479.3008 1247,-515.3008"/>
</g>
<!-- raw_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>raw_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1220,-1672.8285C1220,-1537.6206 1220,-693.2141 1220,-526.0408"/>
<polygon fill="#000000" stroke="#000000" points="1223.5001,-525.6068 1220,-515.6068 1216.5001,-525.6069 1223.5001,-525.6068"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="2009,-1709.1025 1825,-1709.1025 1825,-1673.1025 2009,-1673.1025 2009,-1709.1025"/>
<text text-anchor="middle" x="1917" y="-1687.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">** Lex.lua_thor(linebuf)</text>
</g>
<!-- header_24&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>header_24&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1913.0854,-2526.3823C1913.5958,-2417.4675 1916.2424,-1852.7509 1916.8676,-1719.3608"/>
<polygon fill="#000000" stroke="#000000" points="1920.3684,-1719.1698 1916.9154,-1709.1534 1913.3685,-1719.1369 1920.3684,-1719.1698"/>
</g>
<!-- raw_28 -->
<g id="node29" class="node">
<title>raw_28</title>
<ellipse fill="none" stroke="#000000" cx="2062" cy="-1691.1025" rx="27" ry="18"/>
<text text-anchor="middle" x="2062" y="-1686.9025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_25&#45;&gt;raw_28 -->
<g id="edge28" class="edge">
<title>prose_25&#45;&gt;raw_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2065.9146,-2526.3823C2065.4042,-2417.4675 2062.7576,-1852.7509 2062.1324,-1719.3608"/>
<polygon fill="#000000" stroke="#000000" points="2065.6315,-1719.1369 2062.0846,-1709.1534 2058.6316,-1719.1698 2065.6315,-1719.1369"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="2286" cy="-1691.1025" rx="88.0294" ry="18"/>
<text text-anchor="middle" x="2286" y="-1686.9025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : chomp_token(lb)</text>
</g>
<!-- section_26&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_26&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2460.4873,-2526.6336C2451.3079,-2506.6222 2436.8272,-2473.1213 2428,-2443.0036 2347.0583,-2166.838 2301.422,-1819.6475 2289.2994,-1719.3889"/>
<polygon fill="#000000" stroke="#000000" points="2292.7402,-1718.6849 2288.0773,-1709.1714 2285.7898,-1719.5163 2292.7402,-1718.6849"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="2469" cy="-1691.1025" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2469" y="-1686.9025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_26&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_26&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2469,-2526.3823C2469,-2417.4675 2469,-1852.7509 2469,-1719.3608"/>
<polygon fill="#000000" stroke="#000000" points="2472.5001,-1719.1534 2469,-1709.1534 2465.5001,-1719.1535 2472.5001,-1719.1534"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="2730" cy="-1691.1025" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2730" y="-1686.9025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 130&#45;183</text>
</g>
<!-- section_26&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>section_26&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2476.9576,-2526.456C2485.651,-2506.2891 2499.7083,-2472.6528 2510,-2443.0036 2606.6089,-2164.6834 2697.235,-1819.0455 2722.8381,-1719.264"/>
<polygon fill="#000000" stroke="#000000" points="2726.2864,-1719.9067 2725.375,-1709.3511 2719.5049,-1718.1712 2726.2864,-1719.9067"/>
</g>
<!-- codeblock_33 -->
<g id="node34" class="node">
<title>codeblock_33</title>
<ellipse fill="none" stroke="#000000" cx="3099" cy="-1691.1025" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3099" y="-1686.9025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 186&#45;188</text>
</g>
<!-- section_26&#45;&gt;codeblock_33 -->
<g id="edge33" class="edge">
<title>section_26&#45;&gt;codeblock_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2530.4877,-2534.062C2620.7528,-2517.4615 2783.0889,-2482.9706 2826,-2443.0036 3049.4995,-2234.838 3090.4703,-1829.4104 3097.579,-1719.2845"/>
<polygon fill="#000000" stroke="#000000" points="3101.0737,-1719.4761 3098.182,-1709.2836 3094.0864,-1719.0548 3101.0737,-1719.4761"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2092.5,-533.2019 1985.5,-533.2019 1985.5,-461.3996 2092.5,-461.3996 2092.5,-533.2019"/>
<text text-anchor="middle" x="2039" y="-485.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">...it&#39;s late.</text>
</g>
<!-- raw_28&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>raw_28&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2061.6479,-1672.8285C2059.123,-1541.7725 2043.7607,-744.4044 2039.8866,-543.3168"/>
<polygon fill="#000000" stroke="#000000" points="2043.3818,-543.0335 2039.6898,-533.1028 2036.3831,-543.1684 2043.3818,-543.0335"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2259.5,-515.3008 2110.5,-515.3008 2110.5,-479.3008 2259.5,-479.3008 2259.5,-515.3008"/>
<text text-anchor="middle" x="2185" y="-493.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">*** chomp_token(lb)</text>
</g>
<!-- header_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>header_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2284.4539,-1672.8285C2273.0149,-1537.6206 2201.575,-693.2141 2187.4315,-526.0408"/>
<polygon fill="#000000" stroke="#000000" points="2190.8794,-525.2761 2186.5488,-515.6068 2183.9043,-525.8663 2190.8794,-525.2761"/>
</g>
<!-- raw_35 -->
<g id="node36" class="node">
<title>raw_35</title>
<ellipse fill="none" stroke="#000000" cx="2305" cy="-497.3008" rx="27" ry="18"/>
<text text-anchor="middle" x="2305" y="-493.1008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_35 -->
<g id="edge35" class="edge">
<title>prose_31&#45;&gt;raw_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2471.5071,-1673.062C2482.7442,-1585.8203 2522.0762,-1201.1868 2383,-939.2015 2371.4723,-917.4861 2352.2508,-925.0616 2341,-903.2015 2275.0832,-775.1258 2291.2467,-594.0181 2300.6236,-525.2521"/>
<polygon fill="#000000" stroke="#000000" points="2304.1094,-525.5995 2302.0567,-515.2055 2297.1795,-524.611 2304.1094,-525.5995"/>
</g>
<!-- prespace_36 -->
<g id="node37" class="node">
<title>prespace_36</title>
<ellipse fill="none" stroke="#000000" cx="2396" cy="-497.3008" rx="46.4736" ry="18"/>
<text text-anchor="middle" x="2396" y="-493.1008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prespace</text>
</g>
<!-- prose_31&#45;&gt;prespace_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;prespace_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2467.8826,-1672.8285C2459.6147,-1537.6206 2407.9799,-693.2141 2397.7574,-526.0408"/>
<polygon fill="#000000" stroke="#000000" points="2401.2233,-525.3745 2397.1194,-515.6068 2394.2364,-525.8018 2401.2233,-525.3745"/>
</g>
<!-- literal_37 -->
<g id="node38" class="node">
<title>literal_37</title>
<ellipse fill="none" stroke="#000000" cx="2492" cy="-497.3008" rx="31.481" ry="18"/>
<text text-anchor="middle" x="2492" y="-493.1008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">literal</text>
</g>
<!-- prose_31&#45;&gt;literal_37 -->
<g id="edge37" class="edge">
<title>prose_31&#45;&gt;literal_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2469.3521,-1672.8285C2471.957,-1537.6206 2488.2255,-693.2141 2491.4463,-526.0408"/>
<polygon fill="#000000" stroke="#000000" points="2494.9539,-525.6724 2491.6473,-515.6068 2487.9552,-525.5375 2494.9539,-525.6724"/>
</g>
<!-- raw_38 -->
<g id="node39" class="node">
<title>raw_38</title>
<ellipse fill="none" stroke="#000000" cx="2568" cy="-497.3008" rx="27" ry="18"/>
<text text-anchor="middle" x="2568" y="-493.1008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_31&#45;&gt;raw_38 -->
<g id="edge38" class="edge">
<title>prose_31&#45;&gt;raw_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2470.5154,-1672.8285C2481.728,-1537.6206 2551.7532,-693.2141 2565.6166,-526.0408"/>
<polygon fill="#000000" stroke="#000000" points="2569.1434,-525.8619 2566.4819,-515.6068 2562.1673,-525.2833 2569.1434,-525.8619"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="3091,-903.1023 2613,-903.1023 2613,-91.4993 3091,-91.4993 3091,-903.1023"/>
<text text-anchor="middle" x="2852" y="-888.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function chomp_token(lb)</text>
<text text-anchor="middle" x="2852" y="-872.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(lua_toks) do</text>
<text text-anchor="middle" x="2852" y="-857.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite = match(v, lb)</text>
<text text-anchor="middle" x="2852" y="-841.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite ~= nil then</text>
<text text-anchor="middle" x="2852" y="-826.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return sub(lb, 1, bite &#45; 1), sub(lb, bite), v</text>
<text text-anchor="middle" x="2852" y="-811.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2852" y="-795.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2852" y="-780.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="2852" y="-764.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2852" y="-733.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">Lex.chomp = chomp_token</text>
<text text-anchor="middle" x="2852" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; Not using this. Want to replace it with a less&#45;dumb match&#45;based</text>
<text text-anchor="middle" x="2852" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; lpeg system but kind over it for now.</text>
<text text-anchor="middle" x="2852" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function _str_hl(str)</text>
<text text-anchor="middle" x="2852" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local mark = sub(str,1,1) == &quot;&#39;&quot; and &quot;&#39;&quot; or &#39;&quot;&#39;</text>
<text text-anchor="middle" x="2852" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;mark = c.color.string(mark)</text>
<text text-anchor="middle" x="2852" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return mark .. ts(str) .. mark</text>
<text text-anchor="middle" x="2852" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2852" y="-546.201" font-family="Inconsolata" font-size="14.00" fill="#000000">function Lex.lua_thor(linebuf)</text>
<text text-anchor="middle" x="2852" y="-530.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local toks = {}</text>
<text text-anchor="middle" x="2852" y="-515.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local lb = tostring(linebuf)</text>
<text text-anchor="middle" x="2852" y="-500.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;while lb ~= &quot;&quot; do</text>
<text text-anchor="middle" x="2852" y="-484.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local len = #lb</text>
<text text-anchor="middle" x="2852" y="-469.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bite, tok_t</text>
<text text-anchor="middle" x="2852" y="-453.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;bite, lb, tok_t = chomp_token(lb)</text>
<text text-anchor="middle" x="2852" y="-438.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if bite == nil then</text>
<text text-anchor="middle" x="2852" y="-423.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="2852" y="-407.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2852" y="-392.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; #todo add a color</text>
<text text-anchor="middle" x="2852" y="-376.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local col = color_map[lex_map[tok_t]]</text>
<text text-anchor="middle" x="2852" y="-361.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if col then</text>
<text text-anchor="middle" x="2852" y="-346.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = col</text>
<text text-anchor="middle" x="2852" y="-330.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = bite</text>
<text text-anchor="middle" x="2852" y="-315.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif tok_t == string_esc then</text>
<text text-anchor="middle" x="2852" y="-299.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = _str_hl(bite)</text>
<text text-anchor="middle" x="2852" y="-284.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2852" y="-269.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = bite</text>
<text text-anchor="middle" x="2852" y="-253.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2852" y="-238.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2852" y="-222.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if len == #lb then</text>
<text text-anchor="middle" x="2852" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = a.clear .. color_map.ERR</text>
<text text-anchor="middle" x="2852" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;toks[#toks + 1] = sub(lb, 1, 1)</text>
<text text-anchor="middle" x="2852" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lb = sub(lb,2)</text>
<text text-anchor="middle" x="2852" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2852" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2852" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;toks[#toks + 1] = a.clear()</text>
<text text-anchor="middle" x="2852" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return toks</text>
<text text-anchor="middle" x="2852" y="-99.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>codeblock_32&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2731.8675,-1672.8285C2740.6305,-1587.0808 2778.5432,-1216.0942 2809.466,-913.5075"/>
<polygon fill="#000000" stroke="#000000" points="2812.982,-913.5282 2810.5169,-903.2241 2806.0183,-912.8165 2812.982,-913.5282"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3195,-515.3008 3109,-515.3008 3109,-479.3008 3195,-479.3008 3195,-515.3008"/>
<text text-anchor="middle" x="3152" y="-493.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">return Lex</text>
</g>
<!-- codeblock_33&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_33&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3099.8113,-1672.8285C3105.814,-1537.6206 3143.3022,-693.2141 3150.7241,-526.0408"/>
<polygon fill="#000000" stroke="#000000" points="3154.2402,-525.7523 3151.1873,-515.6068 3147.2471,-525.4417 3154.2402,-525.7523"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2356.5,-55.6015 2081.5,-55.6015 2081.5,.2015 2356.5,.2015 2356.5,-55.6015"/>
<text text-anchor="middle" x="2219" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">This is an almost pessimal way to use</text>
</g>
<!-- raw_35&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>raw_35&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2306.8348,-479.085C2312.028,-420.423 2323.0955,-232.0702 2268,-91.4 2264.2219,-81.7538 2258.5134,-72.3446 2252.3121,-63.8463"/>
<polygon fill="#000000" stroke="#000000" points="2254.8835,-61.4498 2245.9998,-55.6766 2249.3443,-65.7297 2254.8835,-61.4498"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="2429,-45.7 2375,-45.7 2375,-9.7 2429,-9.7 2429,-45.7"/>
<text text-anchor="middle" x="2402" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- prespace_36&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>prespace_36&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2396.2315,-479.1796C2397.1475,-407.4902 2400.5221,-143.3669 2401.6387,-55.9809"/>
<polygon fill="#000000" stroke="#000000" points="2405.141,-55.8111 2401.7692,-45.7672 2398.1416,-55.7216 2405.141,-55.8111"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="2513,-45.7 2459,-45.7 2459,-9.7 2513,-9.7 2513,-45.7"/>
<text text-anchor="middle" x="2486" y="-24.2" font-family="Inconsolata" font-size="14.00" fill="#000000">lpeg</text>
</g>
<!-- literal_37&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>literal_37&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2491.7685,-479.1796C2490.8525,-407.4902 2487.4779,-143.3669 2486.3613,-55.9809"/>
<polygon fill="#000000" stroke="#000000" points="2489.8584,-55.7216 2486.2308,-45.7672 2482.859,-55.8111 2489.8584,-55.7216"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="2778.5,-47.0006 2531.5,-47.0006 2531.5,-8.3994 2778.5,-8.3994 2778.5,-47.0006"/>
<text text-anchor="middle" x="2655" y="-31.9" font-family="Inconsolata" font-size="14.00" fill="#000000">, which is quite capable of</text>
<text text-anchor="middle" x="2655" y="-16.5" font-family="Inconsolata" font-size="14.00" fill="#000000">handling a full line in one pass.</text>
</g>
<!-- raw_38&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>raw_38&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2565.9941,-479.0434C2560.2756,-420.2558 2547.7243,-231.5664 2604,-91.4 2609.3418,-78.0951 2618.4305,-65.3545 2627.4688,-54.8115"/>
<polygon fill="#000000" stroke="#000000" points="2630.2247,-56.9811 2634.3076,-47.2045 2625.0192,-52.3011 2630.2247,-56.9811"/>
</g>
</g>
</svg>
